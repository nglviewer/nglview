/*! For license information please see index.js.LICENSE.txt */
define(["@jupyter-widgets/base"],(__WEBPACK_EXTERNAL_MODULE__2055__=>(()=>{var __webpack_modules__={2555:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseView=void 0;const widgets=__webpack_require__(2055);var NGL=__webpack_require__(485);class BaseView extends widgets.DOMWidgetView{render(){this.isEmbeded()||(this.handleMessage(),this.displayed.then((()=>{this.model.set("_ready",!0),this.touch()})))}executeCode(code){eval(code)}handleMessage(){this.model.on("msg:custom",function(e){this.on_msg(e)}.bind(this))}on_msg(e){"callMethod"==e.type&&(console.log("from BaseView",e),this[e.methodName].apply(this,e.args,e.kwargs))}isEmbeded(){return null==this.model.comm}}exports.BaseView=BaseView},5211:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColormakerRegistryView=t.ColormakerRegistryModel=void 0;const i=n(431),r=n(485),s=n(2555),o=n(2055);class a extends o.DOMWidgetModel{defaults(){return i.extend(o.DOMWidgetModel.prototype.defaults(),{_model_name:"ColormakerRegistryModel",_model_module:"nglview-js-widgets",_model_module_version:n(8330).version,_view_name:"ColormakerRegistryView",_view_module:"nglview-js-widgets",_view_module_version:n(8330).version})}}t.ColormakerRegistryModel=a;class l extends s.BaseView{render(){super.render(),this.isEmbeded()&&(console.log("Embed mode for ColormakerRegistryView"),this.handleEmbed())}handleEmbed(){this.model.get("_msg_ar").forEach((e=>{this.on_msg(e)}))}addSelectionScheme(e,t){var n=r.ColormakerRegistry.addSelectionScheme(t,e);this._updateId(n,e)}addSelectionSchemeOriginal(e,t){var n=r.ColormakerRegistry.addSelectionScheme(t,e),i=r.ColormakerRegistry.userSchemes[n];r.ColormakerRegistry.removeScheme(n),r.ColormakerRegistry.add(e,i)}addScheme(e,t){var n=Function("return "+t)(),i=r.ColormakerRegistry.addScheme((function(e){this.atomColor=n}));this._updateId(i,e)}_updateId(e,t){var n=r.ColormakerRegistry.userSchemes[e];r.ColormakerRegistry.add(t,n),r.ColormakerRegistry.removeScheme(e)}}t.ColormakerRegistryView=l},6219:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FullscreenView=exports.ABC=exports.FullscreenModel=void 0;const widgets=__webpack_require__(2055),NGL=__webpack_require__(485),base_1=__webpack_require__(2555);class FullscreenModel extends widgets.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:"FullscreenModel",_model_module:"nglview-js-widgets",_model_module_version:__webpack_require__(8330).version,_view_name:"FullscreenView",_view_module:"nglview-js-widgets",_view_module_version:__webpack_require__(8330).version})}}exports.FullscreenModel=FullscreenModel;class ABC{}exports.ABC=ABC;class FullscreenView extends base_1.BaseView{render(){this.stage=new NGL.Stage(null,null);var e=this;this.model.on("msg:custom",(function(t){e.on_msg(t)})),this.handleSignals()}fullscreen(e){var t=this;this.model.widget_manager.get_model(e).then((e=>{var n=Object.keys(e.views)[0];e.views[n].then((e=>{t.stage.toggleFullscreen(e.el)}))}))}handleSignals(){var e=this;this.stage.signals.fullscreenChanged.add((function(t){e.model.set("_is_fullscreen",t),e.touch()}))}executeCode(code){eval(code)}on_msg(e){"executeCode"in e&&this.executeCode(e.executeCode)}}exports.FullscreenView=FullscreenView},5587:(e,t,n)=>{var i,r=n(485),s=n(4197).UI,o=n(1147);HTMLElement.prototype.getBoundingClientRect=(i=HTMLElement.prototype.getBoundingClientRect,function(){try{return i.apply(this,arguments)}catch(e){return{top:0,left:0,width:this.width,height:this.height}}}),r.Widget=function(){},r.Widget.prototype={constructor:r.Widget},r.createParameterInput=function(e,t){if(e){var n,i=void 0===t?e.value:t;return"number"===e.type?n=new s.Number(0).setRange(e.min,e.max).setPrecision(e.precision).setValue(parseFloat(i)):"integer"===e.type?n=new s.Integer(parseInt(i)).setRange(e.min,e.max):"range"===e.type?n=new s.Range(e.min,e.max,i,e.step).setValue(parseFloat(i)):"boolean"===e.type?n=new s.Checkbox(i):"text"===e.type?n=new s.Input(i):"select"===e.type?n=(new s.Select).setWidth("").setOptions(e.options).setValue(i):"color"===e.type?n=new s.ColorPopupMenu(e.label).setValue(i):"vector3"===e.type?n=new s.Vector3(i).setPrecision(e.precision):"hidden"===e.type||console.warn("NGL.createParameterInput: unknown parameter type '"+e.type+"'"),n}},r.Preferences=function(e,t){this.signals={keyChanged:new o.Signal},this.id=e||"ngl-gui";var n=Object.assign({},t);for(var i in this.storage={impostor:!0,quality:"auto",sampleLevel:0,theme:"dark",backgroundColor:"black",overview:!1,rotateSpeed:2,zoomSpeed:1.2,panSpeed:.8,clipNear:0,clipFar:100,clipDist:10,fogNear:50,fogFar:100,cameraFov:40,cameraType:"perspective",lightColor:14540253,lightIntensity:1,ambientColor:14540253,ambientIntensity:.2,hoverTimeout:0},this.storage)void 0!==n[i]&&(this.storage[i]=n[i])},r.Preferences.prototype={constructor:r.Preferences,getKey:function(e){return this.storage[e]},setKey:function(e,t){this.storage[e]=t,this.signals.keyChanged.dispatch(e,t)}},r.ViewportWidget=function(e){var t=e.viewer,n=(t.renderer,new s.Panel);n.dom=t.container,n.setPosition("absolute");var i=r.flatten([r.ParserRegistry.getStructureExtensions(),r.ParserRegistry.getVolumeExtensions(),r.ParserRegistry.getSurfaceExtensions(),r.DecompressorRegistry.names]);return n.dom.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),!1),n.dom.addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault(),new r.Queue((function(t,n){var s=t.name.split(".").pop().toLowerCase();r.ScriptExtensions.includes(s)?e.loadScript(t).then(n):i.includes(s)?e.loadFile(t,{defaultRepresentation:!0}).then(n):(console.error("unknown filetype: "+s),n())}),t.dataTransfer.files)}),!1),n},r.ToolbarWidget=function(e){var t=new s.Panel,n=new s.Text,i=(new s.Panel).setDisplay("inline").setFloat("left").add(n),o=new s.Text,a=(new s.Panel).setDisplay("inline").setFloat("right").add(o);return e.signals.clicked.add((function(e){n.setValue(e?e.getLabel():"nothing")})),e.viewer.stats.signals.updated.add((function(){r.Debug?o.setValue(e.viewer.stats.lastDuration.toFixed(2)+" ms | "+e.viewer.stats.lastFps+" fps"):o.setValue("")})),t.add(i,a),t},r.MenubarWidget=function(e,t){var n=new s.Panel;return n.add(new r.MenubarFileWidget(e)),n.add(new r.MenubarViewWidget(e,t)),r.examplesListUrl&&r.examplesScriptUrl&&n.add(new r.MenubarExamplesWidget(e)),n.add(new r.MenubarHelpWidget(e,t)),n.add((new s.Panel).setClass("menu").setFloat("right").add(new s.Text("NGL Viewer "+r.Version).setClass("title"))),n},r.MenubarFileWidget=function(e){var t=r.flatten([r.ParserRegistry.getStructureExtensions(),r.ParserRegistry.getVolumeExtensions(),r.ParserRegistry.getSurfaceExtensions(),r.DecompressorRegistry.names,r.ScriptExtensions]),n=document.createElement("input");n.type="file",n.multiple=!0,n.style.display="none",n.accept="."+t.join(",."),n.addEventListener("change",(function(n){new r.Queue((function(n,i){var s=n.name.split(".").pop().toLowerCase();r.ScriptExtensions.includes(s)?e.loadScript(n).then(i):t.includes(s)?e.loadFile(n,{defaultRepresentation:!0}).then(i):(console.error("unknown filetype: "+s),i())}),n.target.files)}),!1);var i=new r.ExportImageWidget(e).setDisplay("none").attach(e.viewer.container.parentElement),o=s.MenubarHelper.createOption,a=s.MenubarHelper.createInput,l=s.MenubarHelper.createCheckbox,c=s.MenubarHelper.createDivider,u=[o("Open...",(function(){n.click()})),a("PDB",(function(t){13===t.keyCode&&(e.loadFile("rcsb://"+t.target.value.trim(),{defaultRepresentation:!0}),t.target.value="")})),l("firstModelOnly",!1,(function(t){e.defaultFileParams.firstModelOnly=t.target.checked})),l("cAlphaOnly",!1,(function(t){e.defaultFileParams.cAlphaOnly=t.target.checked})),c(),o("Screenshot",(function(){e.makeImage({factor:1,antialias:!0,trim:!1,transparent:!1}).then((function(e){r.download(e,"screenshot.png")}))}),"camera"),o("Export image...",(function(){i.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")}))];r.ListingDatasource&&u.splice(1,0,o("Import...",(function(){var n;(n=new r.DirectoryListingWidget(r.ListingDatasource,e,"Import file",t,(function(i){var s=i.path.split(".").pop().toLowerCase();r.ScriptExtensions.includes(s)?(e.loadScript(r.ListingDatasource.getUrl(i.path)),n.dispose()):t.includes(s)?(e.loadFile(r.ListingDatasource.getUrl(i.path),{defaultRepresentation:!0}),n.dispose()):console.error("unknown filetype: "+s)}))).setOpacity("0.9").setLeft("50px").setTop("80px").attach()})));var h=s.MenubarHelper.createOptionsPanel(u);return h.dom.appendChild(n),s.MenubarHelper.createMenuContainer("File",h)},r.MenubarViewWidget=function(e,t){e.signals.fullscreenChanged.add((function(e){var t=r[4].children[0];e?t.switchClass("compress","expand"):t.switchClass("expand","compress")}));var n=s.MenubarHelper.createOption,i=s.MenubarHelper.createDivider,r=[n("Perspective",(function(){e.setParameters({cameraType:"perspective"})})),n("Orthographic",(function(){e.setParameters({cameraType:"orthographic"})})),n("Stereo",(function(){e.setParameters({cameraType:"stereo"})})),i(),n("Full screen",(function(){e.toggleFullscreen(e.viewer.container.parentElement)}),"expand"),n("Center",(function(){e.autoView(1e3)}),"bullseye"),i(),n("Toggle spin",(function(){e.toggleSpin()})),n("Toggle rock",(function(){e.toggleRock()}))],o=s.MenubarHelper.createOptionsPanel(r);return s.MenubarHelper.createMenuContainer("View",o)},r.MenubarExamplesWidget=function(e){var t=s.MenubarHelper.createOption,n=s.MenubarHelper.createOptionsPanel([]);n.setWidth("300px");var i=new XMLHttpRequest;return i.open("GET",r.examplesListUrl),i.responseType="json",i.onload=function(i){var s=this.response;"string"==typeof s&&(s=JSON.parse(s)),s.sort().forEach((function(i){var s=t(i,(function(){e.loadScript(r.examplesScriptUrl+i+".js")}));n.add(s)}))},i.send(),s.MenubarHelper.createMenuContainer("Examples",n)},r.MenubarHelpWidget=function(e,t){function n(){o.setOpacity("0.9").setDisplay("block").setWidgetPosition(50,80)}var i=new r.PreferencesWidget(e,t).setDisplay("none").attach(e.viewer.container.parentElement),o=new r.OverviewWidget(e,t).setDisplay("none").attach(e.viewer.container.parentElement);t.getKey("overview")&&n();var a=s.MenubarHelper.createOption,l=(s.MenubarHelper.createDivider,[a("Overview",n),a("Preferences",(function(){i.setOpacity("0.9").setDisplay("block").setWidgetPosition(50,80)}),"sliders")]),c=s.MenubarHelper.createOptionsPanel(l);return s.MenubarHelper.createMenuContainer("Help",c)},r.OverviewWidget=function(e,t){var n=new s.OverlayPanel,i=0,o=0,a=0,l=0;function c(e){0===a&&(a=e.clientX,l=e.clientY),i-=a-e.clientX,o-=l-e.clientY,a=e.clientX,l=e.clientY,n.dom.style.top=o+"px",n.dom.style.left=i+"px"}n.setWidgetPosition=function(e,t){i=e,o=t,a=0,l=0,n.dom.style.top=o+"px",n.dom.style.left=i+"px"};var u=(new s.Panel).setBorderBottom("1px solid #555").setHeight("25px").setCursor("move").onMouseDown((function(e){1===e.which&&document.addEventListener("mousemove",c),document.addEventListener("mouseup",(function(e){document.removeEventListener("mousemove",c)}))})),h=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setMaxWidth("600px").setOverflow("auto");function d(e,t){var n=new s.Panel,i=new s.Icon(e).setWidth("20px").setFloat("left"),r=new s.Text(t).setDisplay("inline").setMarginLeft("5px");n.setMarginLeft("20px").add(i,r),h.add(n)}u.add(new s.Text("NGL Viewer").setFontStyle("italic"),new s.Html("&nbsp;&mdash;&nbsp;Overview")),u.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){n.setDisplay("none")}))),n.add(u),n.add(h),h.add((new s.Panel).add(new s.Html("To load a new structure use the <i>File</i> menu in the top left via drag'n'drop."))).add(new s.Break),h.add((new s.Panel).add(new s.Text("A number of clickable icons provide common actions. Most icons can be clicked on, just try it or hover the mouse pointer over it to see a tooltip."))).add(new s.Break),d("eye","Controls the visibility of a component."),d("trash-o","Deletes a component. Note that a second click is required to confirm the action."),d("bullseye","Centers a component."),d("bars","Opens a menu with further options."),d("square","Opens a menu with coloring options."),d("filter","Indicates atom-selection input fields."),h.add(new s.Text("Mouse controls")).add(new s.Html("<ul><li>Left button hold and move to rotate camera around center.</li><li>Left button click to pick atom.</li><li>Middle button hold and move to zoom camera in and out.</li><li>Middle button click to center camera on atom.</li><li>Right button hold and move to translate camera in the screen plane.</li></ul>")),h.add((new s.Panel).add(new s.Html("For more information please visit the <a href='"+r.documentationUrl+"' target='_blank'>documentation pages</a>.")));var p=t.getKey("overview"),f=new s.Checkbox(p).onClick((function(){t.setKey("overview",f.getValue())}));return h.add((new s.HorizontalRule).setBorderTop("1px solid #555").setMarginTop("15px")).add((new s.Panel).add(f,new s.Text("Show on startup. Always available from Menu > Help > Overview.").setMarginLeft("5px"))),n},r.PreferencesWidget=function(e,t){var n=new s.OverlayPanel,i=0,o=0,a=0,l=0;function c(e){0===a&&(a=e.clientX,l=e.clientY),i-=a-e.clientX,o-=l-e.clientY,a=e.clientX,l=e.clientY,n.dom.style.top=o+"px",n.dom.style.left=i+"px"}n.setWidgetPosition=function(e,t){i=e,o=t,a=0,l=0,n.dom.style.top=o+"px",n.dom.style.left=i+"px"};var u=(new s.Panel).setBorderBottom("1px solid #555").setHeight("25px").setCursor("move").onMouseDown((function(e){1===e.which&&document.addEventListener("mousemove",c),document.addEventListener("mouseup",(function(e){document.removeEventListener("mousemove",c)}))})),h=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");return u.add(new s.Text("Preferences")),u.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){n.setDisplay("none")}))),n.add(u),n.add(h),Object.keys(r.UIStageParameters).forEach((function(n){var i=r.UIStageParameters[n];void 0===i.label&&(i.label=n);var o=r.createParameterInput(i,e.parameters[n]);if(o){t.signals.keyChanged.add((function(e,t){e===n&&o.setValue(t)}));var a=navigator.userAgent;"range"!==i.type||/Trident/.test(a)||/MSIE/.test(a)?o.onChange(l):o.onInput(l),h.add(new s.Text(n).setWidth("120px")).add(o).add(new s.Break)}function l(){var e={};e[n]=o.getValue(),t.setKey(n,e[n])}})),n},r.ExportImageWidget=function(e){var t=new s.OverlayPanel,n=(new s.Panel).setBorderBottom("1px solid #555").setHeight("25px"),i=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");n.add(new s.Text("Image export")),n.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){t.setDisplay("none")}))),t.add(n),t.add(i);var o=(new s.Select).setOptions({1:"1x",2:"2x",3:"3x",4:"4x",5:"5x",6:"6x",7:"7x",8:"8x",9:"9x",10:"10x"}).setValue("4"),a=(new s.Checkbox).setValue(!0),l=(new s.Checkbox).setValue(!1),c=(new s.Checkbox).setValue(!1),u=(new s.Progress).setDisplay("none"),h=new s.Button("export").onClick((function(){function t(e,t,n){1===e&&u.setMax(t),e>=t?u.setIndeterminate():u.setValue(e),n&&(u.setDisplay("none"),h.setDisplay("inline-block"))}h.setDisplay("none"),u.setDisplay("inline-block"),setTimeout((function(){e.makeImage({factor:parseInt(o.getValue()),antialias:a.getValue(),trim:l.getValue(),transparent:c.getValue(),onProgress:t}).then((function(e){r.download(e,"screenshot.png")}))}),50)}));function d(e,t){i.add(new s.Text(e).setWidth("80px")).add(t||new s.Panel).add(new s.Break)}return d("scale",o),d("antialias",a),d("trim",l),d("transparent",c),i.add(new s.Break,h,u),t},r.SidebarWidget=function(e,t=void 0){var n=e.signals,i=new s.Panel;i.view=t;var o=(new s.Panel).setClass("Content"),a=[],l=[];function c(t){var n;switch(t.type){case"structure":n=new r.StructureComponentWidget(t,e);break;case"surface":n=new r.SurfaceComponentWidget(t,e);break;case"volume":n=new r.VolumeComponentWidget(t,e);break;case"shape":n=new r.ShapeComponentWidget(t,e);break;default:return void console.warn("NGL.SidebarWidget: component type unknown",t)}o.add(n),a.push(t),l.push(n)}e.compList.forEach((function(e){c(e)})),n.componentAdded.add(c),n.componentRemoved.add((function(e){var t=a.indexOf(e);-1!==t&&(l[t].dispose(),a.splice(t,1),l.splice(t,1))}));var u=new s.Icon("plus-square").setTitle("expand all").setCursor("pointer").onClick((function(){l.forEach((function(e){e.expand()}))})),h=new s.Icon("minus-square").setTitle("collapse all").setCursor("pointer").setMarginLeft("10px").onClick((function(){l.forEach((function(e){e.collapse()}))})),d=new s.Icon("bullseye").setTitle("center all").setCursor("pointer").setMarginLeft("10px").onClick((function(){e.autoView(1e3)})),p=(new s.DisposeIcon).setMarginLeft("10px").setDisposeFunction((function(){e.removeAllComponents()})),f=new s.Icon("superpowers").setTitle("sync representation").setCursor("pointer").setMarginLeft("10px").onClick((function(){t&&t.syncReprWithMe()})),m=new s.PopupMenu("cogs","Settings","window").setIconTitle("settings").setMarginLeft("10px");m.entryLabelWidth="120px";var g=(new s.Panel).setDisplay("inline").add(new s.Icon("spinner").addClass("spin").setMarginLeft("45px"));e.tasks.signals.countChanged.add((function(e,t){if(t>0)_.add(g);else try{_.remove(g)}catch(e){}})),["clipNear","clipFar","clipDist","fogNear","fogFar","lightColor","lightIntensity","ambientColor","ambientIntensity"].forEach((function(t){var n=r.UIStageParameters[t];void 0===n.label&&(n.label=t);var i=r.createParameterInput(n,e.parameters[t]);if(i){e.signals.parametersChanged.add((function(e){i.setValue(e[t])}));var s=navigator.userAgent;"range"!==n.type||/Trident/.test(s)||/MSIE/.test(s)?i.onChange(o):i.onInput(o),m.addEntry(t,i)}function o(){var n={};n[t]=i.getValue(),e.setParameters(n)}}));var _=(new s.Panel).setClass("Panel Sticky").add(u,h,d,p,f,m);return i.add(_,o),i},r.StructureComponentWidget=function(e,t){var n=e.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel,a=new s.Panel;function l(n){o.add(new r.RepresentationElementWidget(n,t,e))}e.reprList.forEach((function(e){l(e)})),n.representationAdded.add(l),n.trajectoryAdded.add((function(e){a.add(new r.TrajectoryElementWidget(e,t))})),n.defaultAssemblyChanged.add((function(){f.setValue(e.parameters.defaultAssembly)})),i.add(new s.SelectionPanel(e.selection).setMarginLeft("20px").setInputWidth("214px"));var c,u,h,d=new s.Button("export").onClick((function(){new r.PdbWriter(e.structure).download("structure"),D.setMenuDisplay("none")})),p=(new s.Select).setColor("#444").setOptions((c={"":"[ add ]"},r.RepresentationRegistry.names.forEach((function(e){c[e]=e})),c)).onChange((function(){e.addRepresentation(p.getValue()),p.setValue(""),D.setMenuDisplay("none")})),f=(new s.Select).setColor("#444").setOptions((u=e.structure.biomolDict,h={"":e.structure.unitcell?"AU":"FULL"},Object.keys(u).forEach((function(e){h[e]=e})),h)).setValue(e.parameters.defaultAssembly).onChange((function(){e.setDefaultAssembly(f.getValue()),D.setMenuDisplay("none")})),m=[];r.ParserRegistry.getTrajectoryExtensions().forEach((function(e){m.push("."+e,"."+e+".gz")}));var g=document.createElement("input");g.type="file",g.multiple=!0,g.style.display="none",g.accept=m.join(","),g.addEventListener("change",(function(t){new r.Queue((function(t,n){r.autoLoad(t).then((function(t){e.addTrajectory(t),n()}))}),t.target.files),t.target.value=""}),!1);var _=new s.Button("open").onClick((function(){g.click(),D.setMenuDisplay("none")})),v=new s.Button("import").onClick((function(){D.setMenuDisplay("none");var n,i=["xtc","trr","netcdf","dcd","ncdf","nc","gro","pdb","lammpstrj","xyz","mdcrd","gz","binpos","h5","dtr","arc","tng","trj","trz"];(n=new r.DirectoryListingWidget(r.ListingDatasource,t,"Import trajectory",i,(function(t){var s=t.path.split(".").pop().toLowerCase();-1!==i.indexOf(s)?(e.addTrajectory(t.path+"?struc="+e.structure.path),n.dispose()):r.log("unknown trajectory type: "+s)}))).setOpacity("0.9").setLeft("50px").setTop("80px").attach()}));function y(){var n={"":"[ structure ]"};t.eachComponent((function(t,i){t!==e&&(n[i]=t.name)}),r.StructureComponent),b.setOptions(n)}t.signals.componentAdded.add(y),t.signals.componentRemoved.add(y);var b=(new s.Select).setColor("#444").onChange((function(){e.superpose(t.compList[b.getValue()],!0),e.autoView(1e3),b.setValue(""),D.setMenuDisplay("none")}));y();var x=new s.Button("align").onClick((function(){var n=e.structure.getPrincipalAxes().getRotationQuaternion();n.multiply(e.quaternion.clone().inverse()),t.animationControls.rotate(n),t.animationControls.move(e.getCenter())})),w=new s.Button("remove").onClick((function(){e.removeAllMeasurements()})),S=new s.Button("show").onClick((function(){e.annotationList.forEach((function(e){e.setVisibility(!0)}))})),A=new s.Button("hide").onClick((function(){e.annotationList.forEach((function(e){e.setVisibility(!1)}))})),M=(new s.Panel).setDisplay("inline-block").add(S,A),C=document.createElement("input");C.type="file",C.style.display="none",C.accept=".xml",C.addEventListener("change",(function(t){new r.Queue((function(t,n){r.autoLoad(t,{ext:"validation"}).then((function(t){e.structure.validation=t,n()}))}),t.target.files)}),!1);var T=new s.Button("open").onClick((function(){C.click(),D.setMenuDisplay("none")})),E=(new s.Vector3).onChange((function(){e.setPosition(E.getValue())})),P=new r.Quaternion,I=new r.Euler,k=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){I.setFromVector3(k.getValue()),P.setFromEuler(I),e.setRotation(P)})),R=new s.Number(1).setRange(.01,100).onChange((function(){e.setScale(R.getValue())}));n.matrixChanged.add((function(){E.setValue(e.position),k.setValue(I.setFromQuaternion(e.quaternion)),R.setValue(e.scale.x)}));var D=new s.ComponentPanel(e).setDisplay("inline-block").setMargin("0px").addMenuEntry("PDB file",d).addMenuEntry("Representation",p).addMenuEntry("Assembly",f).addMenuEntry("Superpose",b).addMenuEntry("File",new s.Text(e.structure.path).setMaxWidth("100px").setOverflow("auto")).addMenuEntry("Trajectory",_).addMenuEntry("Principal axes",x).addMenuEntry("Measurements",w).addMenuEntry("Annotations",M).addMenuEntry("Validation",T).addMenuEntry("Position",E).addMenuEntry("Rotation",k).addMenuEntry("Scale",R);return r.ListingDatasource&&r.TrajectoryDatasource&&D.addMenuEntry("Remote trajectory",v),i.addStatic(D).add(a).add(o),i},r.SurfaceComponentWidget=function(e,t){var n=e.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel;n.representationAdded.add((function(e){o.add(new r.RepresentationElementWidget(e,t))}));var a=(new s.Select).setColor("#444").setOptions({"":"[ add ]",surface:"surface",dot:"dot"}).onChange((function(){e.addRepresentation(a.getValue()),a.setValue(""),p.setMenuDisplay("none")})),l=(new s.Vector3).onChange((function(){e.setPosition(l.getValue())})),c=new r.Quaternion,u=new r.Euler,h=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){u.setFromVector3(h.getValue()),c.setFromEuler(u),e.setRotation(c)})),d=new s.Number(1).setRange(.01,100).onChange((function(){e.setScale(d.getValue())}));n.matrixChanged.add((function(){l.setValue(e.position),h.setValue(u.setFromQuaternion(e.quaternion)),d.setValue(e.scale.x)}));var p=new s.ComponentPanel(e).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",a).addMenuEntry("File",new s.Text(e.surface.path).setMaxWidth("100px").setWordWrap("break-word")).addMenuEntry("Position",l).addMenuEntry("Rotation",h).addMenuEntry("Scale",d);return i.addStatic(p).add(o),i},r.VolumeComponentWidget=function(e,t){var n=e.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel;n.representationAdded.add((function(e){o.add(new r.RepresentationElementWidget(e,t))}));var a=(new s.Select).setColor("#444").setOptions({"":"[ add ]",surface:"surface",dot:"dot",slice:"slice"}).onChange((function(){e.addRepresentation(a.getValue()),a.setValue(""),p.setMenuDisplay("none")})),l=(new s.Vector3).onChange((function(){e.setPosition(l.getValue())})),c=new r.Quaternion,u=new r.Euler,h=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){u.setFromVector3(h.getValue()),c.setFromEuler(u),e.setRotation(c)})),d=new s.Number(1).setRange(.01,100).onChange((function(){e.setScale(d.getValue())}));n.matrixChanged.add((function(){l.setValue(e.position),h.setValue(u.setFromQuaternion(e.quaternion)),d.setValue(e.scale.x)}));var p=new s.ComponentPanel(e).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",a).addMenuEntry("File",new s.Text(e.volume.path).setMaxWidth("100px").setWordWrap("break-word")).addMenuEntry("Position",l).addMenuEntry("Rotation",h).addMenuEntry("Scale",d);return i.addStatic(p).add(o),i},r.ShapeComponentWidget=function(e,t){var n=e.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel;n.representationAdded.add((function(e){o.add(new r.RepresentationElementWidget(e,t))}));var a=(new s.Select).setColor("#444").setOptions({"":"[ add ]",buffer:"buffer"}).onChange((function(){e.addRepresentation(a.getValue()),a.setValue(""),p.setMenuDisplay("none")})),l=(new s.Vector3).onChange((function(){e.setPosition(l.getValue())})),c=new r.Quaternion,u=new r.Euler,h=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){u.setFromVector3(h.getValue()),c.setFromEuler(u),e.setRotation(c)})),d=new s.Number(1).setRange(.01,100).onChange((function(){e.setScale(d.getValue())}));n.matrixChanged.add((function(){l.setValue(e.position),h.setValue(u.setFromQuaternion(e.quaternion)),d.setValue(e.scale.x)}));var p=new s.ComponentPanel(e).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",a).addMenuEntry("File",new s.Text(e.shape.path).setMaxWidth("100px").setWordWrap("break-word")).addMenuEntry("Position",l).addMenuEntry("Rotation",h).addMenuEntry("Scale",d);return i.addStatic(p).add(o),i},r.RepresentationElementWidget=function(e,t,n=void 0){var i=e.signals,o=new s.CollapsibleIconPanel("minus-square","plus-square").setMarginLeft("20px");i.visibilityChanged.add((function(e){l.setValue(e)})),i.nameChanged.add((function(e){a.setValue(e)})),i.disposed.add((function(){h.dispose(),o.dispose()}));var a=new s.EllipsisText(e.name).setWidth("103px"),l=new s.ToggleIcon(e.visible,"eye","eye-slash").setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick((function(){e.setVisibility(!e.visible)})),c=new s.Icon("bullseye").setTitle("center").setCursor("pointer").setMarginLeft("10px").onClick((function(){n.autoView(e.repr.selection.string,1e3)})),u=(new s.DisposeIcon).setMarginLeft("10px").setDisposeFunction((function(){e.dispose()}));n?o.addStatic(a).addStatic(l).addStatic(c).addStatic(u):o.addStatic(a).addStatic(l).addStatic(u),"structure"!==e.parent.type&&"trajectory"!==e.parent.type||!e.repr.selection||"selection"!==e.repr.selection.type||o.add(new s.SelectionPanel(e.repr.selection).setMarginLeft("20px").setInputWidth("194px"));var h=new s.PopupMenu("bars","Representation").setMarginLeft("45px").setEntryLabelWidth("190px");h.addEntry("type",new s.Text(e.repr.type));var d=e.repr,p=d.getParameters();return Object.keys(d.parameters).forEach((function(n){if(d.parameters[n]){var s=Object.assign({},d.parameters[n]);s.value=p[n],void 0===s.label&&(s.label=n);var o=r.createParameterInput(s);if(o){i.parametersChanged.add((function(e){"function"==typeof o.setValue&&o.setValue(e[n])}));var a=navigator.userAgent;"range"!==s.type||/Trident/.test(a)||/MSIE/.test(a)?o.onChange(l):o.onInput(l),h.addEntry(n,o)}}function l(){var i={};i[n]=o.getValue(),e.setParameters(i),t.viewer.requestRender()}})),o.addStatic(h),o},r.TrajectoryElementWidget=function(e,t){var n=e.signals,i=e.trajectory,o=new s.CollapsibleIconPanel("minus-square","plus-square").setMarginLeft("20px");n.disposed.add((function(){k.dispose(),o.dispose()}));var a=(new s.Panel).setDisplay("inline").add(new s.Icon("spinner").addClass("spin").setMarginRight("99px")),l=(new s.Panel).setMarginLeft("5px").setDisplay("inline");function c(e){if(d.setValue(e),i.deltaTime&&e>=0){var t=i.getFrameTime(e)/1e3;p.setValue(t.toFixed(9).replace(/\.?0+$/g,"")+"ns")}else p.setValue("");g.setValue(e),a.clear().add(d.setWidth("40px")),l.clear().add(p.setWidth("90px"))}function u(t){d.setRange(-1,t-1),g.setRange(-1,t-1),c(i.currentFrame),void 0!==e.parameters.defaultStep?f.setValue(e.parameters.defaultStep):f.setValue(Math.ceil((t+1)/100)),w.setParameters({step:f.getValue()}),w.setParameters({end:t-1})}n.countChanged.add(u),n.frameChanged.add(c);var h=new s.EllipsisText(e.parameters.name).setWidth("103px");n.nameChanged.add((function(e){h.setValue(e)})),o.addStatic(h),o.addStatic(l);var d=new s.Integer(-1).setWidth("40px").setTextAlign("right").setMarginLeft("5px").setRange(-1,-1).onChange((function(e){i.setFrame(d.getValue()),k.setMenuDisplay("none")})),p=(new s.Text).setTextAlign("right").setWidth("90px"),f=new s.Integer(1).setWidth("50px").setRange(1,1e4).onChange((function(){w.setParameters({step:f.getValue()})})),m=new s.Panel,g=new s.Range(-1,-1,-1,1).setWidth("147px").setMargin("0px").setPadding("0px").setBorder("0px").onInput((function(e){var t=g.getValue();t!==i.currentFrame&&(i.player&&i.player.isRunning?(i.setPlayer(),i.setFrame(t)):i.inProgress||i.setFrame(t))})),_=(new s.Select).setColor("#444").setOptions({"":"none",linear:"linear",spline:"spline"}).setValue(e.parameters.defaultInterpolateType).onChange((function(){w.setParameters({interpolateType:_.getValue()})})),v=new s.Integer(e.parameters.defaultInterpolateStep).setWidth("30px").setRange(1,50).onChange((function(){w.setParameters({interpolateStep:v.getValue()})})),y=(new s.Select).setColor("#444").setOptions({forward:"forward",backward:"backward",bounce:"bounce"}).setValue(e.parameters.defaultDirection).onChange((function(){w.setParameters({direction:y.getValue()})})),b=(new s.Select).setColor("#444").setOptions({loop:"loop",once:"once"}).setValue(e.parameters.defaultMode).onChange((function(){w.setParameters({mode:b.getValue()})})),x=new s.Integer(e.parameters.defaultTimeout).setWidth("30px").setRange(10,1e3).onChange((function(){w.setParameters({timeout:x.getValue()})})),w=new r.TrajectoryPlayer(i,{step:f.getValue(),timeout:x.getValue(),start:0,end:i.frameCount-1,interpolateType:_.getValue(),interpolateStep:v.getValue(),direction:y.getValue(),mode:b.getValue()});i.setPlayer(w);var S=new s.ToggleIcon(!0,"play","pause").setMarginRight("10px").setMarginLeft("20px").setCursor("pointer").setWidth("12px").setTitle("play").onClick((function(){w.toggle()}));w.signals.startedRunning.add((function(){S.setTitle("pause").setValue(!1)})),w.signals.haltedRunning.add((function(){S.setTitle("play").setValue(!0)})),m.add(S,g,a),o.add(new s.SelectionPanel(i.selection).setMarginLeft("20px").setInputWidth("194px"));var A=new s.Checkbox(i.centerPbc).onChange((function(){e.setParameters({centerPbc:A.getValue()})})),M=new s.Checkbox(i.removePeriodicity).onChange((function(){e.setParameters({removePeriodicity:M.getValue()})})),C=new s.Checkbox(i.removePbc).onChange((function(){e.setParameters({removePbc:C.getValue()})})),T=new s.Checkbox(i.superpose).onChange((function(){e.setParameters({superpose:T.getValue()})})),E=new s.Number(i.deltaTime).setWidth("55px").setRange(0,1e6).onChange((function(){e.setParameters({deltaTime:E.getValue()})})),P=new s.Number(i.timeOffset).setWidth("55px").setRange(0,1e9).onChange((function(){e.setParameters({timeOffset:P.getValue()})}));n.parametersChanged.add((function(e){A.setValue(i.centerPbc),M.setValue(i.removePeriodicity),C.setValue(i.removePbc),T.setValue(i.superpose),E.setValue(i.deltaTime),P.setValue(i.timeOffset),i.setFrame(d.getValue())}));var I=(new s.DisposeIcon).setDisposeFunction((function(){e.parent.removeTrajectory(e)}));i.frameCount&&u(i.frameCount);var k=new s.PopupMenu("bars","Trajectory").setMarginLeft("10px").setEntryLabelWidth("130px").addEntry("Center",A).addEntry("Remove Periodicity",M).addEntry("Remove PBC",C).addEntry("Superpose",T).addEntry("Step size",f).addEntry("Interpolation type",_).addEntry("Interpolation steps",v).addEntry("Play timeout",x).addEntry("Play direction",y).addEntry("Play mode",b).addEntry("Delta time [ps]",E).addEntry("Time offset [ps]",P).addEntry("File",new s.Text(i.trajPath).setMaxWidth("100px").setWordWrap("break-word")).addEntry("Dispose",I);return o.addStatic(k),o.add(m),o},r.DirectoryListingWidget=function(e,t,n,i,o){function a(e){var t={"":""},n=[];return(e=e||"").split("/").forEach((function(e){n.push(e),t[n.join("/")]=e})),t}var l=new s.OverlayPanel,c=(new s.Panel).setBorderBottom("1px solid #555").setHeight("30px"),u=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setPaddingRight("15px").setOverflow("auto"),h=(new s.Select).setColor("#444").setMarginLeft("20px").setWidth("").setMaxWidth("200px").setOptions(a()).onChange((function(){e.getListing(h.getValue()).then(d)}));function d(t){var n=t.path,l=t.data;r.lastUsedDirectory=n,u.clear(),h.setOptions(a(n)).setValue(n),l.forEach((function(t){var n=t.path.split(".").pop().toLowerCase();if(!i||t.dir||-1!==i.indexOf(n)){var r,a,l,c,h,p;t.dir?(r="folder-o",a=t.name):(r="file-o",a=t.name+String.fromCharCode(160)+"("+(l=t.size,(c=Math,h=c.log,p=h(l)/h(1e3)|0,l/c.pow(1e3,p)).toFixed(2)+String.fromCharCode(160)+(p?"kMGTPEZY"[--p]+"B":"Bytes")+")"));var f=(new s.Panel).setDisplay("block").setWhiteSpace("nowrap").add(new s.Icon(r).setWidth("20px")).add(new s.Text(a)).onClick((function(){t.dir?e.getListing(t.path).then(d):o(t)}));t.restricted&&f.add(new s.Icon("lock").setMarginLeft("5px")),u.add(f)}}))}return n=n||"Directoy listing",c.add(new s.Text(n)),c.add(h),c.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){l.dispose()}))),l.add(c),l.add(u),e.getListing(r.lastUsedDirectory).then(d),l},e.exports={StageWidget:class{constructor(e){var t,n=e.stage,i=new s.Panel;t=e.options.parent?e.el.parentElement:e.el,i.setPosition("absolute"),i.dom=n.viewer.container,this.el=t,this.widgetList=[];var o=new r.Preferences("ngl-stage-widget",n.getParameters()),a={};for(var l in o.storage)a[l]=o.getKey(l);n.setParameters(a),o.signals.keyChanged.add((function(e,t){var i={};i[e]=t,n.setParameters(i)}),this);var c=document.createElement("link");c.rel="stylesheet",c.id="theme",t.appendChild(c);var u=new r.ToolbarWidget(n).setId("toolbar_ngl");t.appendChild(u.dom);var h=new r.MenubarWidget(n,o).setId("menubar_ngl");t.appendChild(h.dom);var d=new r.SidebarWidget(n).setId("sidebar_ngl");t.appendChild(d.dom),this.widgetList.push(u),this.widgetList.push(h),this.widgetList.push(d),t.style.touchAction="none",n.handleResize(),setTimeout((function(){n.handleResize()}),500);var p=!1,f=!1,m=!1,g=function(e){e>=50&&e<=window.innerWidth-10&&(d.setWidth(window.innerWidth-e+"px"),i.setWidth(e+"px"),u.setWidth(e+"px"),n.handleResize());var t=d.dom.getBoundingClientRect().width;if(void 0===e){var r=window.innerWidth-t;i.setWidth(r+"px"),u.setWidth(r+"px"),n.handleResize()}m=t<=10,_()};g=r.throttle(g,50,{leading:!0,trailing:!0});var _=function(){var e=d.dom.getBoundingClientRect().width,i=t.getBoundingClientRect().width;i==e&&(e=i/4);var r=i-e+"px";n.viewer.container.style.width=r,n.handleResize()},v=(new s.Panel).setClass("ResizeLeft").onMouseDown((function(){p=!0,f=!1})).onClick((function(){m?g(window.innerWidth-300):p||f||g(window.innerWidth-10)}));d.add(v),this.viewport=i,this.toolbar=u,this.menubar=h,this.sidebar=d,_(),n.signals.fullscreenChanged.add((function(t){const i=n.viewer.container.parentElement.getBoundingClientRect();n.setSize(i.width+"px",t?i.height+"px":"300px"),e.handleResize()})),window.addEventListener("mousemove",(function(e){p&&(document.body.style.cursor="col-resize",f=!0,g(e.clientX))}),!1),window.addEventListener("mouseup",(function(e){p=!1,document.body.style.cursor=""}),!1),window.addEventListener("resize",(function(e){g()}),!1),document.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="none"}),!1),document.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault()}),!1)}dispose(){for(var e in this.widgetList)this.widgetList[e].dispose()}}}},9012:(e,t,n)=>{e.exports={};var i=[n(7412)];for(var r in i)if(i&&Object.prototype.hasOwnProperty.call(i,r)){var s=i[r];for(var o in s)s&&Object.prototype.hasOwnProperty.call(s,o)&&(e.exports[o]=s[o])}e.exports.version=n(8330).version},3199:()=>{"function"!=typeof importScripts&&function(e,t,n){function i(e,t){var n=t.getBoundingClientRect();return{x:Math.max(Math.min(e.clientX-n.left,t.clientWidth),0),y:Math.max(Math.min(e.clientY-n.top,t.clientHeight),0)}}function r(e,n,i){for(var r in e=t.createElementNS("http://www.w3.org/2000/svg",e),n)e.setAttribute(r,n[r]);for(Array.isArray(i)||(i=[i]),n=0,r=i[0]&&i.length||0;n<r;n++)e.appendChild(i[n]);return e}function s(e){var t,n,i,r,s=e.h%360/60;return i=(r=e.v*e.s)*(1-Math.abs(s%2-1)),t=n=e=e.v-r,t+=[r,i,0,0,i,r][s=~~s],n+=[i,r,r,i,0,0][s],e+=[0,0,i,r,r,i][s],{r:i=Math.floor(255*t),g:n=Math.floor(255*n),b:e=Math.floor(255*e),hex:"#"+(16777216|e|n<<8|i<<16).toString(16).slice(1)}}function o(e){var t,n=e.r,i=e.g,r=e.b;return(1<e.r||1<e.g||1<e.b)&&(n/=255,i/=255,r/=255),{h:n=(0==(t=(e=Math.max(n,i,r))-Math.min(n,i,r))?0:e==n?(i-r)/t+(i<r?6:0):e==i?(r-n)/t+2:(n-i)/t+4)%6*60,s:0==t?0:t/e,v:e}}function a(e,t,r){if(!(this instanceof a))return new a(e,t,r);this.h=0,this.v=this.s=1,r?(this.callback=r,this.pickerElement=t,this.slideElement=e):(e.innerHTML='<div class="picker-wrapper"><div class="picker"></div><div class="picker-indicator"></div></div><div class="slide-wrapper"><div class="slide"></div><div class="slide-indicator"></div></div>',this.slideElement=e.getElementsByClassName("slide")[0],this.pickerElement=e.getElementsByClassName("picker")[0],this.slideIndicator=e.getElementsByClassName("slide-indicator")[0],this.pickerIndicator=e.getElementsByClassName("picker-indicator")[0],a.positionIndicators(this.slideIndicator,this.pickerIndicator,{x:0,y:0},{x:0,y:0}),this.callback=function(e,n,i,r,s){a.positionIndicators(this.slideIndicator,this.pickerIndicator,s,r),t(e,n,i)}),this.slide_listener=function(e,t,r){return function(o){o=i(o,t),e.h=o.y/t.offsetHeight*360;var a=s({h:e.h,s:1,v:1}),l=s({h:e.h,s:e.s,v:e.v});r.style.backgroundColor=a.hex,e.callback&&e.callback(l.hex,{h:e.h,s:e.s,v:e.v},{r:l.r,g:l.g,b:l.b},n,o)}}(this,this.slideElement,this.pickerElement),this.picker_listener=function(e,t){return function(n){n=i(n,t);var r=t.offsetHeight;e.s=n.x/t.offsetWidth,e.v=(r-n.y)/r,r=s(e),e.callback&&e.callback(r.hex,{h:e.h,s:e.s,v:e.v},{r:r.r,g:r.g,b:r.b},n)}}(this,this.pickerElement),r||this.fixIndicators(this.slideIndicator,this.pickerIndicator),e=h.cloneNode(!0),r=u.cloneNode(!0);var o=e.getElementsByTagName("defs")[0].firstChild,c=e.getElementsByTagName("rect")[0];o.id="gradient-hsv-"+p,c.setAttribute("fill","url(#"+o.id+")"),o=[(o=r.getElementsByTagName("defs")[0]).firstChild,o.lastChild],c=r.getElementsByTagName("rect"),o[0].id="gradient-black-"+p,o[1].id="gradient-white-"+p,c[0].setAttribute("fill","url(#"+o[1].id+")"),c[1].setAttribute("fill","url(#"+o[0].id+")"),this.slideElement.appendChild(e),this.pickerElement.appendChild(r),p++,l(this.slideElement,this.slide_listener),l(this.pickerElement,this.picker_listener)}function l(e,n){function i(e){s&&n(e)}function r(e){i(e),s=!1,t.removeEventListener("mouseup",r,!1),t.removeEventListener("mousemove",i,!1)}var s=!1;e.addEventListener("mousedown",(function(e){s=!0,e.preventDefault(),t.addEventListener("mouseup",r,!0),t.addEventListener("mousemove",i,!1)}),!1)}function c(e,t,n,i){e.h=t.h%360,e.s=t.s,e.v=t.v,t=s(e);var r={y:e.h*e.slideElement.offsetHeight/360,x:0},o=e.pickerElement.offsetHeight;return o={x:e.s*e.pickerElement.offsetWidth,y:o-e.v*o},e.pickerElement.style.backgroundColor=s({h:e.h,s:1,v:1}).hex,e.callback&&e.callback(i||t.hex,{h:e.h,s:e.s,v:e.v},n||{r:t.r,g:t.g,b:t.b},o,r),e}var u,h,d={xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"};h=r("svg",d,[r("defs",{},r("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[r("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),r("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),r("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),r("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),r("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),r("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),r("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),r("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]),u=r("svg",d,[r("defs",{},[r("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[r("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),r("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[r("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})]);var p=0;a.hsv2rgb=function(e){return delete(e=s(e)).hex,e},a.hsv2hex=function(e){return s(e).hex},a.rgb2hsv=o,a.rgb2hex=function(e){return s(o(e)).hex},a.hex2hsv=function(e){return o(a.hex2rgb(e))},a.hex2rgb=function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}},a.prototype.setHsv=function(e){return c(this,e)},a.prototype.setRgb=function(e){return c(this,o(e),e)},a.prototype.setHex=function(e){return c(this,a.hex2hsv(e),n,e)},a.positionIndicators=function(e,t,n,i){n&&(e.style.top=n.y-e.offsetHeight/2+"px"),i&&(t.style.top=i.y-t.offsetHeight/2+"px",t.style.left=i.x-t.offsetWidth/2+"px")},a.prototype.fixIndicators=function(e,t){l(e,this.slide_listener),l(t,this.picker_listener)},e.ColorPicker=a}(window,window.document)},1147:function(e,t,n){var i;!function(){function r(e,t,n,i,r){this._listener=t,this._isOnce=n,this.context=i,this._signal=e,this._priority=r||0}function s(e,t){if("function"!=typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function o(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){o.prototype.dispatch.apply(e,arguments)}}r.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},o.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,i){var s=this._indexOfListener(e,n);if(-1!==s){if((e=this._bindings[s]).isOnce()!==t)throw Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else e=new r(this,e,t,n,i),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===e&&n.context===t)return i;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return s(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return s(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){s(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var a=o;a.Signal=o,void 0===(i=function(){return a}.call(t,n,t,e))||(e.exports=i)}()},5080:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IMessageSchema=void 0;const i=n(6495);t.IMessageSchema=i.object().shape({type:i.string().required(),data:i.mixed(),ID:i.string(),render_params:i.mixed(),methodName:i.string(),target:i.string(),args:i.array(),kwargs:i.object(),component_index:i.number(),repr_index:i.number(),last_child:i.boolean(),reconstruc_color_scheme:i.boolean(),movie_making:i.boolean(),buffers:i.array(),content:i.mixed()})},4649:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeManagerView=t.ThemeManagerModel=void 0;const i=n(431),r=n(2555),s=n(2055);class o extends s.DOMWidgetModel{defaults(){return i.extend(s.DOMWidgetModel.prototype.defaults(),{_model_name:"ThemeManagerModel",_model_module:"nglview-js-widgets",_model_module_version:n(8330).version,_view_name:"ThemeManagerView",_view_module:"nglview-js-widgets",_view_module_version:n(8330).version})}}t.ThemeManagerModel=o;class a extends r.BaseView{render(){super.render(),this.displayed.then((()=>this.handleThemeChanged()))}handleThemeChanged(){console.log("ThemeManagerView: handleThemeChanged"),this.setTheme(this.model.get("_theme_css"))}handleEmbed(){this.handleThemeChanged()}setTheme(e){if(null!=e){var t=document.getElementById("nglview_style");t&&document.head.removeChild(t),(t=document.createElement("style")).id="nglview_style",t.appendChild(document.createTextNode(e)),document.head.appendChild(t),this.send({type:"call_method",data:"handle_resize"})}}}t.ThemeManagerView=a},6237:(e,t,n)=>{var i=n(4197).UI;i.Html=function(e){i.Element.call(this);var t=document.createElement("span");return t.className="Html",t.style.cursor="default",t.style.display="inline-block",t.style.verticalAlign="middle",this.dom=t,this.setValue(e),this},i.Html.prototype=Object.create(i.Element.prototype),i.Html.prototype.setValue=function(e){return void 0!==e&&(this.dom.innerHTML=e),this},i.Form=function(){i.Panel.call(this);var e=document.createElement("form");return e.className="Form",e.method="post",e.action="",e.target="_blank",e.enctype="multipart/form-data",this.dom=e,this},i.Form.prototype=Object.create(i.Panel.prototype),i.Form.prototype.setMethod=function(e){return this.dom.method=e,this},i.Form.prototype.setAction=function(e){return this.dom.action=e,this},i.Form.prototype.setTarget=function(e){return this.dom.target=e,this},i.Form.prototype.setEnctype=function(e){return this.dom.enctype=e,this},i.File=function(){return i.Input.call(this),this.dom.className="File",this.dom.type="file",this.dom.multiple=!1,this},i.File.prototype=Object.create(i.Input.prototype),i.File.prototype.setMultiple=function(e){return this.dom.multiple=e,this},i.File.prototype.getFiles=function(e){return this.dom.files},i.Hidden=function(){return i.Input.call(this),this.dom.type="hidden",this},i.Hidden.prototype=Object.create(i.Input.prototype),i.ToggleButton=function(e,t,n,r){i.Button.call(this,t);var s=!0;return this.onClick(function(){s?(s=!1,this.setLabel(e),r()):(s=!0,this.setLabel(t),n())}.bind(this)),this},i.ToggleButton.prototype=Object.create(i.Button.prototype),i.EllipsisText=function(e){return i.Text.call(this,e),this.setWhiteSpace("nowrap"),this.setOverflow("hidden"),this.setTextOverflow("ellipsis"),this},i.EllipsisText.prototype=Object.create(i.Text.prototype),i.EllipsisText.prototype.setValue=function(e){return void 0!==e&&(this.dom.textContent=e,this.setTitle(e)),this},i.EllipsisMultilineText=function(e){i.Element.call(this);var t=document.createElement("span");t.className="EllipsisMultilineText",t.style.cursor="default",t.style.display="inline-block",t.style.verticalAlign="middle";var n=document.createElement("p");return t.appendChild(n),this.dom=t,this.content=n,this.setValue(e),this},i.EllipsisMultilineText.prototype=Object.create(i.Element.prototype),i.EllipsisMultilineText.prototype.setValue=function(e){return void 0!==e&&(this.content.textContent=e,this.setTitle(e)),this},i.OverlayPanel=function(){return i.Panel.call(this),this.dom.className="Panel OverlayPanel",this.dom.tabIndex="-1",this.dom.style.outline="none",this},i.OverlayPanel.prototype=Object.create(i.Panel.prototype),i.OverlayPanel.prototype.attach=function(e){return(e=e||document.body).appendChild(this.dom),this},i.Icon=function(e){i.Panel.call(this);var t=document.createElement("span");return t.className="Icon fa",this.dom=t,e&&this.addClass.apply(this,arguments),this},i.Icon.prototype=Object.create(i.Panel.prototype),i.Icon.prototype.hasClass=function(e){return this.dom.classList.contains("fa-"+e)},i.Icon.prototype.addClass=function(e){for(var t=0;t<arguments.length;t++)this.dom.classList.add("fa-"+arguments[t]);return this},i.Icon.prototype.setClass=function(e){this.dom.className="Icon fa";for(var t=0;t<arguments.length;t++)this.dom.classList.add("fa-"+arguments[t]);return this},i.Icon.prototype.removeClass=function(e){for(var t=0;t<arguments.length;t++)this.dom.classList.remove("fa-"+arguments[t]);return this},i.Icon.prototype.switchClass=function(e,t){return this.removeClass(t,e),this.addClass(e),this},i.ToggleIcon=function(e,t,n){return i.Icon.call(this,e?t:n),this.value=e,this.classTrue=t,this.classFalse=n,this},i.ToggleIcon.prototype=Object.create(i.Icon.prototype),i.ToggleIcon.prototype.setValue=function(e){return this.value=e,e?this.switchClass(this.classTrue,this.classFalse):this.switchClass(this.classFalse,this.classTrue),this},i.ToggleIcon.prototype.getValue=function(){return this.value},i.DisposeIcon=function(){i.Icon.call(this,"trash-o");var e=!1,t=this;return this.setTitle("delete"),this.setCursor("pointer"),this.onClick((function(){!0===e?"function"==typeof t.disposeFunction&&t.disposeFunction():(t.setColor("rgb(178, 34, 34)"),t.dom.classList.add("deleteInfo"),e=!0,setTimeout((function(){t.setColor("#888"),t.dom.classList.remove("deleteInfo"),e=!1}),1500))})),this},i.DisposeIcon.prototype=Object.create(i.Icon.prototype),i.DisposeIcon.prototype.setDisposeFunction=function(e){return this.disposeFunction=e,this},i.Progress=function(e,t){i.Element.call(this);var n=document.createElement("progress");return n.className="Progress",n.max=e||1,void 0!==t&&(n.value=t),this.dom=n,this},i.Progress.prototype=Object.create(i.Element.prototype),i.Progress.prototype.getValue=function(){return this.dom.value},i.Progress.prototype.setValue=function(e){return this.dom.value=e,this},i.Progress.prototype.setMax=function(e){return this.dom.max=e,this},i.Progress.prototype.setIndeterminate=function(){return this.dom.removeAttribute("value"),this},i.Range=function(e,t,n,r){i.Element.call(this);var s=document.createElement("input");return s.className="Range",s.type="range",s.min=e.toPrecision(3),s.max=t.toPrecision(3),s.value=n.toPrecision(3),s.step=r.toPrecision(3),this.dom=s,this},i.Range.prototype=Object.create(i.Element.prototype),i.Range.prototype.getValue=function(){return parseFloat(this.dom.value)},i.Range.prototype.setRange=function(e,t){return this.dom.min=e,this.dom.max=t,this},i.Range.prototype.setValue=function(e){return this.dom.value=e,this},i.Range.prototype.setStep=function(e){return this.dom.step=e,this},i.AdaptiveTextArea=function(){i.Element.call(this);var e=document.createElement("div");e.className="AdaptiveTextAreaContainer";var t=document.createElement("textarea");t.className="AdaptiveTextArea";var n=document.createElement("div");return n.className="AdaptiveTextAreaSize",e.appendChild(t),e.appendChild(n),t.addEventListener("input",(function(e){n.innerHTML=t.value+"\n"}),!1),this.textarea=t,this.size=n,this.dom=e,this},i.AdaptiveTextArea.prototype=Object.create(i.Element.prototype),i.AdaptiveTextArea.prototype.getValue=function(){return this.textarea.value},i.AdaptiveTextArea.prototype.setValue=function(e){return this.textarea.value=e,this.size.innerHTML=e+"\n",this},i.AdaptiveTextArea.prototype.setSpellcheck=function(e){return this.textarea.spellcheck=e,this},i.AdaptiveTextArea.prototype.setBackgroundColor=function(e){return this.textarea.style.backgroundColor=e,this},i.VirtualList=function(e,t,n,r){i.Element.call(this),e=e||[],t=t||20,n=n||300,r=r||function(){};var s=document.createElement("div");s.className="VirtualList",s.style.height=n+"px";var o,a=e.length,l=Math.ceil(n/t),c=3*l,u=l*t,h=0,d=function(){},p=document.createElement("div");p.style.width="100%",p.style.height=n+"px",p.style["overflow-y"]="auto",p.style.position="relative",p.style.padding=0;var f=document.createElement("div");function m(e){var n=r(e);return n.classList.add("VirtualListRow"),n.style.height=t+"px",n.style.top=e*t+"px",n}function g(e){var t=Math.min(a,e+c);d(e,t);for(var n=document.createDocumentFragment(),i=e;i<t;i++)n.appendChild(m(i));for(var r=1,s=p.childNodes.length;r<s;r++)p.childNodes[r].style.display="none",p.childNodes[r].setAttribute("data-rm","1");p.appendChild(n)}f.style.opacity=0,f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.width="1px",f.style.height=t*a+"px";var _=setInterval((function(){for(var e=s;e!==document&&e.parentNode;)e=e.parentNode;if(e!==document&&clearInterval(_),Date.now()-h>100)for(var t=p.querySelectorAll('[data-rm="1"]'),n=0,i=t.length;n<i;n++)p.removeChild(t[n])}),500);return this.setItems=function(n){return a=(e=n).length,f.style.height=t*a+"px",g(0),this},this.setItemHeight=function(e){return t=e,l=Math.ceil(n/t),c=3*l,u=l*t,f.style.height=t*a+"px",g(0),this},this.setHeight=function(e){return i.Element.prototype.setHeight.call(this,e+"px"),n=e,l=Math.ceil(n/t),c=3*l,u=l*t,p.style.height=n+"px",f.style.height=n+"px",g(0),this},this.setGeneratorFn=function(e){return r=e,g(0),this},this.setRenderChunkCallback=function(e){d=e},this.redraw=function(){var e=Math.floor(p.scrollTop/t);return g(Math.max(0,e-l)),o=p.scrollTop,this},p.appendChild(f),s.appendChild(p),p.addEventListener("scroll",(function(e){var n=e.target.scrollTop;if(!o||Math.abs(n-o)>u){var i=Math.floor(n/t);g(Math.max(0,i-l)),o=n}h=Date.now(),e.preventDefault&&e.preventDefault()})),g(0),this.dom=s,this},i.VirtualList.prototype=Object.create(i.Element.prototype),i.VirtualTable=function(e,t,n,r,s){var o=s||{};i.Panel.call(this);var a=void 0!==o.defaultWidth?o.defaultWidth:30,l=void 0!==o.defaultMargin?o.defaultMargin:5,c=void 0!==o.defaultAlign?o.defaultAlign:"left",u=o.onRowSelect,h=(new i.Panel).setWhiteSpace("nowrap").setDisplay("inline-block").setOverflow("").setWidth("100%"),d=0,p=[],f=function(e,t){return e-t},m=function(e,t){return e.localeCompare(t)},g=function(t,n){var i;return i="string"==typeof e[0][t]?m:f,e.sort((function(e,r){return n?i(r[t],e[t]):i(e[t],r[t])})),v.redraw(),this},_=function(t,n){return p.length=0,u&&u(t,n),void 0!==n&&p.push(e[n][0]),v.redraw(),this};r.forEach((function(e){var t=e.width||a,n=e.margin||l,r=(new i.EllipsisText).setValue(e.name).setWidth(t+"px").setTextAlign(e.align||c).setMarginLeft(n+"px").setMarginRight(n+"px").setCursor("pointer").onClick((function(t){var n="ASC"===e.__sortFlag;g(e.index,n),e.__sortFlag=n?"DESC":"ASC"}));h.add(r),d+=t+2*n}));var v=new i.VirtualList(e,t,n,(function(t){var n=new i.Panel;return r.forEach((function(r){var s=e[t][r.index];r.format&&(s=r.format(s));var o,u=r.width||a,h=r.margin||l;(o="object"==typeof s?s:(new i.Text).setValue(s)).setWidth(u+"px").setTextAlign(r.align||c).setMarginLeft(h+"px").setMarginRight(h+"px").onClick((function(e){"function"==typeof r.onClick&&r.onClick(e,t,s)})).onMouseOver((function(e){"function"==typeof r.onMouseOver&&r.onMouseOver(e,t,s)})).onMouseOut((function(e){"function"==typeof r.onMouseOut&&r.onMouseOut(e,t,s)})),n.add(o)})),n.setCursor("pointer").onClick((function(e){_(e,t)})),-1!==p.indexOf(e[t][0])&&n.dom.classList.add("highlight"),n.dom})).setWidth(d+20+"px");return this.add(h,v),this.header=h,this.list=v,this.sortColumn=g,this.selectRow=function(e){_(void 0,e)},this},i.VirtualTable.prototype=Object.create(i.Panel.prototype),i.PopupMenu=function(e,t,n){n=n||"scrollParent",i.Panel.call(this);var r=new i.Icon(e||"bars"),s=(new i.OverlayPanel).setDisplay("none").attach(this.dom),o=0;function a(e){0===o&&(o=e.clientX,e.clientY),e.clientX,e.clientY,o=e.clientX,e.clientY}var l=(new i.Panel).setBorderBottom("1px solid #555").setMarginBottom("10px").setHeight("25px").setCursor("move").onMouseDown((function(e){1===e.which&&document.addEventListener("mousemove",a),document.addEventListener("mouseup",(function(e){document.removeEventListener("mousemove",a)}))}));return l.add(new i.Icon("times").setFloat("right").setCursor("pointer").onClick(function(){this.setMenuDisplay("none")}.bind(this))).add(new i.Text(t)),s.add(l),r.setTitle("menu"),r.setCursor("pointer"),r.onClick(function(e){"block"!==s.getDisplay()?(s.setMaxHeight(window.innerHeight/1.2+"px"),this.setMenuDisplay("block")):this.setMenuDisplay("none")}.bind(this)),this.add(r),this.setClass("").setDisplay("inline"),this.icon=r,this.panel=s,this.entryLabelWidth="100px",this},i.PopupMenu.prototype=Object.create(i.Panel.prototype),i.PopupMenu.prototype.addEntry=function(e,t){return this.panel.add(new i.Text(e).setWidth(this.entryLabelWidth)).add(t||new i.Panel).add(new i.Break),this},i.PopupMenu.prototype.setEntryLabelWidth=function(e){return this.entryLabelWidth=e,this},i.PopupMenu.prototype.setMenuDisplay=function(e){return this.panel.setDisplay(e),"none"!==e&&this.panel.dom.focus(),this},i.PopupMenu.prototype.setIconTitle=function(e){return this.icon.setTitle(e),this},i.PopupMenu.prototype.dispose=function(){this.panel.dispose(),i.Element.prototype.dispose.call(this)},i.CollapsibleIconPanel=function(e,t){i.Panel.call(this),this.dom.className="Panel CollapsiblePanel",void 0===e&&(e=e||"chevron-down",t=t||"chevron-right"),this.button=new i.Icon(e).setTitle("expand/collapse").setCursor("pointer").setWidth("12px").setMarginRight("6px"),this.addStatic(this.button);var n=this;return this.button.dom.addEventListener("click",(function(e){n.toggle()}),!1),this.content=document.createElement("div"),this.content.className="CollapsibleContent",this.dom.appendChild(this.content),this.isCollapsed=!1,this.iconClass1=e,this.iconClass2=t,this},i.CollapsibleIconPanel.prototype=Object.create(i.CollapsiblePanel.prototype),i.CollapsibleIconPanel.prototype.setCollapsed=function(e){e?(this.dom.classList.add("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass2,this.iconClass1):this.button.addClass("rotate-90")):(this.dom.classList.remove("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass1,this.iconClass2):this.button.removeClass("rotate-90")),this.isCollapsed=e},i.ColorPicker=function(){var e=this;i.Panel.call(this),this.slideWrapper=(new i.Panel).setClass("slide-wrapper"),this.sliderIndicator=(new i.Panel).setClass("slide-indicator"),this.slider=(new i.Panel).setClass("slide").setWidth("25px").setHeight("80px"),this.slideWrapper.add(this.slider,this.sliderIndicator),this.pickerWrapper=(new i.Panel).setClass("picker-wrapper"),this.pickerIndicator=(new i.Panel).setClass("picker-indicator"),this.picker=(new i.Panel).setClass("picker").setWidth("130px").setHeight("80px"),this.pickerWrapper.add(this.picker,this.pickerIndicator);var t=document.createEvent("Event");return t.initEvent("change",!0,!0),this.add(this.pickerWrapper,this.slideWrapper),this.colorPicker=ColorPicker(this.slider.dom,this.picker.dom,(function(n,i,r,s,o){if(!s&&o&&i.s<.05)return i.s=.5,i.v=.7,void e.colorPicker.setHsv(i);ColorPicker.positionIndicators(e.sliderIndicator.dom,e.pickerIndicator.dom,o,s),e.hex=n,e.hsv=i,e.rgb=r,e._settingValue||e.dom.dispatchEvent(t)})),this.colorPicker.fixIndicators(this.sliderIndicator.dom,this.pickerIndicator.dom),this},i.ColorPicker.prototype=Object.create(i.Panel.prototype),i.ColorPicker.prototype.setValue=function(e){return e!==this.hex&&(this._settingValue=!0,this.colorPicker.setHex(e),this._settingValue=!1),this},i.ColorPicker.prototype.getValue=function(){return this.hex},e.exports={UI:i}},4197:e=>{var t={Element:function(){}};t.Element.prototype={setId:function(e){return this.dom.id=e,this},setTitle:function(e){return this.dom.title=e,this},setClass:function(e){return this.dom.className=e,this},setStyle:function(e,t){for(var n=0;n<t.length;n++)this.dom.style[e]=t[n]},getStyle:function(e){return this.dom.style[e]},getBox:function(){return this.dom.getBoundingClientRect()},setDisabled:function(e){return this.dom.disabled=e,this},setTextContent:function(e){return this.dom.textContent=e,this},dispose:function(){this.dom.parentNode.removeChild(this.dom)}},["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","overflowX","overflowY","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","backgroundColor","opacity","fontSize","fontWeight","fontStyle","fontFamily","textTransform","cursor","verticalAlign","clear","float","zIndex","minHeight","maxHeight","minWidth","maxWidth","wordBreak","wordWrap","spellcheck","lineHeight","whiteSpace","textOverflow","textAlign","pointerEvents"].forEach((function(e){var n=e.substr(0,1).toUpperCase()+e.substr(1,e.length);t.Element.prototype["set"+n]=function(){return this.setStyle(e,arguments),this},t.Element.prototype["get"+n]=function(){return this.getStyle(e)}})),["KeyUp","KeyDown","KeyPress","MouseOver","MouseOut","MouseDown","MouseUp","MouseMove","Click","Change","Input","Scroll"].forEach((function(e){var n="on"+e;t.Element.prototype[n]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this),!1),this}})),t.Panel=function(){t.Element.call(this);var e=document.createElement("div");return e.className="Panel",this.dom=e,this.children=[],this},t.Panel.prototype=Object.create(t.Element.prototype),t.Panel.prototype.add=function(){for(var e=0;e<arguments.length;e++)this.dom.appendChild(arguments[e].dom),this.children.push(arguments[e]);return this},t.Panel.prototype.remove=function(){for(var e=0;e<arguments.length;e++){this.dom.removeChild(arguments[e].dom);var t=this.children.indexOf(arguments[e]);-1!==t&&this.children.splice(t,1)}return this},t.Panel.prototype.clear=function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild);return this.children.length=0,this},t.CollapsiblePanel=function(){t.Panel.call(this),this.dom.className="Panel CollapsiblePanel",this.button=document.createElement("div"),this.button.className="CollapsiblePanelButton",this.dom.appendChild(this.button);var e=this;return this.button.addEventListener("click",(function(t){e.toggle()}),!1),this.content=document.createElement("div"),this.content.className="CollapsibleContent",this.dom.appendChild(this.content),this.isCollapsed=!1,this},t.CollapsiblePanel.prototype=Object.create(t.Panel.prototype),t.CollapsiblePanel.prototype.addStatic=function(){for(var e=0;e<arguments.length;e++)this.dom.insertBefore(arguments[e].dom,this.content);return this},t.CollapsiblePanel.prototype.removeStatic=t.Panel.prototype.remove,t.CollapsiblePanel.prototype.clearStatic=function(){this.dom.childNodes.forEach((function(e){e!==this.content&&this.dom.removeChild(e)}))},t.CollapsiblePanel.prototype.add=function(){for(var e=0;e<arguments.length;e++)this.content.appendChild(arguments[e].dom);return this},t.CollapsiblePanel.prototype.remove=function(){for(var e=0;e<arguments.length;e++)this.content.removeChild(arguments[e].dom);return this},t.CollapsiblePanel.prototype.clear=function(){for(;this.content.children.length;)this.content.removeChild(this.content.lastChild)},t.CollapsiblePanel.prototype.toggle=function(){this.setCollapsed(!this.isCollapsed)},t.CollapsiblePanel.prototype.collapse=function(){this.setCollapsed(!0)},t.CollapsiblePanel.prototype.expand=function(){this.setCollapsed(!1)},t.CollapsiblePanel.prototype.setCollapsed=function(e){e?this.dom.classList.add("collapsed"):this.dom.classList.remove("collapsed"),this.isCollapsed=e},t.Text=function(e){t.Element.call(this);var n=document.createElement("span");return n.className="Text",n.style.display="inline-block",n.style.verticalAlign="middle",this.dom=n,this.setValue(e),this},t.Text.prototype=Object.create(t.Element.prototype),t.Text.prototype.setValue=function(e){return void 0!==e&&(this.dom.textContent=e),this},t.Text.prototype.setName=function(e){return this.dom.name=e,this},t.Input=function(e){t.Element.call(this);var n=document.createElement("input");return n.className="Input",n.style.padding="2px",n.style.border="1px solid #ccc",n.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.dom=n,this.setValue(e||""),this},t.Input.prototype=Object.create(t.Element.prototype),t.Input.prototype.getValue=function(){return this.dom.value},t.Input.prototype.setValue=function(e){return this.dom.value=e,this},t.Input.prototype.setName=function(e){return this.dom.name=e,this},t.TextArea=function(){t.Element.call(this);var e=document.createElement("textarea");return e.className="TextArea",e.style.padding="2px",e.style.border="1px solid #ccc",e.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.dom=e,this},t.TextArea.prototype=Object.create(t.Element.prototype),t.TextArea.prototype.getValue=function(){return this.dom.value},t.TextArea.prototype.setValue=function(e){return this.dom.value=e,this},t.Select=function(){t.Element.call(this);var e=document.createElement("select");return e.className="Select",e.style.width="64px",e.style.height="16px",e.style.border="0px",e.style.padding="0px",this.dom=e,this},t.Select.prototype=Object.create(t.Element.prototype),t.Select.prototype.setMultiple=function(e){return this.dom.multiple=e,this},t.Select.prototype.setOptions=function(e){for(var t=this.dom.value;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var n in e){var i=document.createElement("option");i.value=n,i.innerHTML=e[n],this.dom.appendChild(i)}return this.dom.value=t,this},t.Select.prototype.getValue=function(){return this.dom.value},t.Select.prototype.setValue=function(e){return this.dom.value=e,this},t.Select.prototype.setName=function(e){return this.dom.name=e,this},t.FancySelect=function(){t.Element.call(this);var e=this,n=document.createElement("div");n.className="FancySelect",n.tabIndex=0;var i=document.createEvent("HTMLEvents");return i.initEvent("change",!0,!0),n.addEventListener("keydown",(function(e){switch(e.keyCode){case 38:case 40:e.preventDefault(),e.stopPropagation()}}),!1),n.addEventListener("keyup",(function(t){switch(t.keyCode){case 38:case 40:e.selectedIndex+=38==t.keyCode?-1:1,e.selectedIndex>=0&&e.selectedIndex<e.options.length&&(e.setValue(e.options[e.selectedIndex].value),e.dom.dispatchEvent(i))}}),!1),this.dom=n,this.options=[],this.selectedIndex=-1,this.selectedValue=null,this},t.FancySelect.prototype=Object.create(t.Element.prototype),t.FancySelect.prototype.setOptions=function(e){var t=this,n=document.createEvent("HTMLEvents");for(n.initEvent("change",!0,!0);t.dom.children.length>0;)t.dom.removeChild(t.dom.firstChild);t.options=[];for(var i=0;i<e.length;i++){var r=e[i],s=document.createElement("div");s.className="option",s.innerHTML=r.html,s.value=r.value,t.dom.appendChild(s),t.options.push(s),s.addEventListener("click",(function(e){t.setValue(this.value),t.dom.dispatchEvent(n)}),!1)}return t},t.FancySelect.prototype.getValue=function(){return this.selectedValue},t.FancySelect.prototype.setValue=function(e){for(var t=0;t<this.options.length;t++){var n=this.options[t];if(n.value===e){n.classList.add("active");var i=n.offsetTop-this.dom.offsetTop,r=i+n.offsetHeight-this.dom.offsetHeight;this.dom.scrollTop>i?this.dom.scrollTop=i:this.dom.scrollTop<r&&(this.dom.scrollTop=r),this.selectedIndex=t}else n.classList.remove("active")}return this.selectedValue=e,this},t.Checkbox=function(e){t.Element.call(this);var n=document.createElement("input");return n.className="Checkbox",n.type="checkbox",this.dom=n,this.setValue(e),this},t.Checkbox.prototype=Object.create(t.Element.prototype),t.Checkbox.prototype.getValue=function(){return this.dom.checked},t.Checkbox.prototype.setValue=function(e){return void 0!==e&&(this.dom.checked=e),this},t.Checkbox.prototype.setName=function(e){return this.dom.name=e,this},t.Color=function(){t.Element.call(this);var e=document.createElement("input");e.className="Color",e.style.width="64px",e.style.height="16px",e.style.border="0px",e.style.padding="0px",e.style.backgroundColor="transparent";try{e.type="color",e.value="#ffffff"}catch(e){}return this.dom=e,this},t.Color.prototype=Object.create(t.Element.prototype),t.Color.prototype.getValue=function(){return this.dom.value},t.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},t.Color.prototype.setValue=function(e){return this.dom.value=e,this},t.Color.prototype.setHexValue=function(e){return this.dom.value="#"+("000000"+e.toString(16)).slice(-6),this},t.Number=function(e){t.Element.call(this);var n=this,i=document.createElement("input");i.className="Number",i.value="0.00",i.addEventListener("keydown",(function(e){e.stopPropagation(),13===e.keyCode&&i.blur()}),!1),this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.dom=i,this.setValue(e);var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0);var s=0,o=0,a=[0,0],l=[0,0],c=function(e){var t=i.value;a=[e.clientX,e.clientY],s+=a[0]-l[0]-(a[1]-l[1]);var c=50;e.shiftKey&&(c=5),e.ctrlKey&&(c=500);var u=o+s/c*n.step;i.value=Math.min(n.max,Math.max(n.min,u)).toFixed(n.precision),t!==i.value&&i.dispatchEvent(r),l=[e.clientX,e.clientY]},u=function(e){document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",u,!1),Math.abs(s)<2&&(i.focus(),i.select())};return i.addEventListener("mousedown",(function(e){e.preventDefault(),s=0,o=parseFloat(i.value),l=[e.clientX,e.clientY],document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1)}),!1),i.addEventListener("change",(function(e){var t=parseFloat(i.value);i.value=!1===isNaN(t)?t:0}),!1),i.addEventListener("focus",(function(e){i.style.backgroundColor="",i.style.borderColor="#ccc",i.style.cursor=""}),!1),i.addEventListener("blur",(function(e){i.style.backgroundColor="transparent",i.style.borderColor="transparent",i.style.cursor="col-resize"}),!1),this},t.Number.prototype=Object.create(t.Element.prototype),t.Number.prototype.getValue=function(){return parseFloat(this.dom.value)},t.Number.prototype.setValue=function(e){return isNaN(e)?this.dom.value=NaN:void 0!==e&&(this.dom.value=e.toFixed(this.precision)),this},t.Number.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},t.Number.prototype.setPrecision=function(e){return this.precision=e,this.setValue(parseFloat(this.dom.value)),this},t.Number.prototype.setName=function(e){return this.dom.name=e,this},t.Integer=function(e){t.Element.call(this);var n=this,i=document.createElement("input");i.className="Number",i.value="0.00",i.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.min=-1/0,this.max=1/0,this.step=1,this.dom=i,this.setValue(e);var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0);var s=0,o=0,a=[0,0],l=[0,0],c=function(e){var t=i.value;a=[e.clientX,e.clientY],s+=a[0]-l[0]-(a[1]-l[1]);var c=50;e.shiftKey&&(c=5),e.ctrlKey&&(c=500);var u=o+s/c*n.step;i.value=0|Math.min(n.max,Math.max(n.min,u)),t!==i.value&&i.dispatchEvent(r),l=[e.clientX,e.clientY]},u=function(e){document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",u,!1),Math.abs(s)<2&&(i.focus(),i.select())};return i.addEventListener("mousedown",(function(e){e.preventDefault(),s=0,o=parseFloat(i.value),l=[e.clientX,e.clientY],document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1)}),!1),i.addEventListener("change",(function(e){var t=parseInt(i.value);!1===isNaN(t)&&(i.value=t)}),!1),i.addEventListener("focus",(function(e){i.style.backgroundColor="",i.style.borderColor="#ccc",i.style.cursor=""}),!1),i.addEventListener("blur",(function(e){i.style.backgroundColor="transparent",i.style.borderColor="transparent",i.style.cursor="col-resize"}),!1),this},t.Integer.prototype=Object.create(t.Element.prototype),t.Integer.prototype.getValue=function(){return parseInt(this.dom.value)},t.Integer.prototype.setValue=function(e){return void 0!==e&&(this.dom.value=0|e),this},t.Integer.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},t.Integer.prototype.setName=function(e){return this.dom.name=e,this},t.Integer.prototype.setStep=function(e){return this.step=e,this},t.Break=function(){t.Element.call(this);var e=document.createElement("br");return e.className="Break",this.dom=e,this},t.Break.prototype=Object.create(t.Element.prototype),t.HorizontalRule=function(){t.Element.call(this);var e=document.createElement("hr");return e.className="HorizontalRule",this.dom=e,this},t.HorizontalRule.prototype=Object.create(t.Element.prototype),t.Button=function(e){t.Element.call(this);var n=document.createElement("button");return n.className="Button",this.dom=n,this.dom.textContent=e,this},t.Button.prototype=Object.create(t.Element.prototype),t.Button.prototype.setLabel=function(e){return this.dom.textContent=e,this},t.MenubarHelper={createMenuContainer:function(e,n){var i=new t.Panel,r=new t.Panel;return r.setClass("title"),r.setTextContent(e),r.setMargin("0px"),r.setPadding("8px"),i.setClass("menu"),i.add(r),i.add(n),i},createOption:function(e,n,i){var r=new t.Panel;return r.setClass("option"),i?(r.add(new t.Icon(i).setWidth("20px")),r.add(new t.Text(e))):r.setTextContent(e),r.onClick(n),r},createOptionsPanel:function(e){var n=new t.Panel;return n.setClass("options"),e.forEach((function(e){n.add(e)})),n},createInput:function(e,n){var i=(new t.Panel).setClass("option"),r=(new t.Text).setWidth("70px").setValue(e),s=(new t.Input).setWidth("40px").onKeyDown(n);return i.add(r),i.add(s),i},createCheckbox:function(e,n,i){var r=(new t.Panel).setClass("option"),s=(new t.Text).setWidth("70px").setValue(e),o=(new t.Checkbox).setValue(n).onClick(i);return r.add(o),r.add(s),r},createDivider:function(){return new t.HorizontalRule}},e.exports={UI:t}},6870:(e,t,n)=>{var i,r=n(485),s=n(6237).UI;s.ColorPopupMenu=function(){var e=this;s.Panel.call(this),this.iconText=new s.Text("").setCursor("pointer").setClass("fa-stack-1x").setFontFamily("Arial, sans-serif").setColor("#111"),this.iconSquare=new s.Icon("square","stack-1x"),this.menu=new s.PopupMenu("stack","Color"),this.menu.icon.setTitle("color").setWidth("1em").setHeight("1em").setLineHeight("1em").add(this.iconSquare).add(this.iconText);var t=document.createEvent("Event");return t.initEvent("change",!0,!0),this.colorInput=(new s.Input).onChange((function(){e.setColor(e.colorInput.getValue()),e.dom.dispatchEvent(t)})),this.colorPicker=(new s.ColorPicker).setDisplay("inline-block").onChange((function(n){e.setColor(e.colorPicker.getValue()),e.dom.dispatchEvent(t)})),this.menu.addEntry("Input",this.colorInput).addEntry("Picker",this.colorPicker),this.add(this.menu),this.setClass("").setDisplay("inline"),this},s.ColorPopupMenu.prototype=Object.create(s.Panel.prototype),s.ColorPopupMenu.prototype.setColor=(i=new r.Color,function(e){return i.set(e),e="#"+i.getHexString(),this.colorInput.setBackgroundColor(e).setValue(e),this.colorPicker.setValue(e),this.iconSquare.setColor(e),Math.sqrt(255*i.r*i.r*255*.241+255*i.g*i.g*255*.691+255*i.b*i.b*255*.068)>130?(this.iconText.setColor("#000000"),this.colorInput.setColor("#000000")):(this.iconText.setColor("#FFFFFF"),this.colorInput.setColor("#FFFFFF")),this}),s.ColorPopupMenu.prototype.getColor=function(){return this.colorInput.getValue()},s.ColorPopupMenu.prototype.getValue=function(){return this.getColor()},s.ColorPopupMenu.prototype.setValue=function(e){return this.setColor(e),this},s.ColorPopupMenu.prototype.dispose=function(){this.menu.dispose(),s.Panel.prototype.dispose.call(this)},s.Vector3=function(e){s.Panel.call(this).setDisplay("inline-block"),this.xNumber=new s.Number(0).setWidth("40px"),this.yNumber=new s.Number(0).setWidth("40px"),this.zNumber=new s.Number(0).setWidth("40px"),this.add(this.xNumber,this.yNumber,this.zNumber),this.setValue(e);var t=document.createEvent("Event");return t.initEvent("change",!0,!0),this.xNumber.onChange(function(){this.dom.dispatchEvent(t)}.bind(this)),this.yNumber.onChange(function(){this.dom.dispatchEvent(t)}.bind(this)),this.zNumber.onChange(function(){this.dom.dispatchEvent(t)}.bind(this)),this},s.Vector3.prototype=Object.create(s.Panel.prototype),s.Vector3.prototype.getValue=function(){return{x:this.xNumber.getValue(),y:this.yNumber.getValue(),z:this.zNumber.getValue()}},s.Vector3.prototype.setValue=function(e){return e&&(this.xNumber.setValue(e.x),this.yNumber.setValue(e.y),this.zNumber.setValue(e.z)),this},s.Vector3.prototype.setPrecision=function(e){return this.xNumber.setPrecision(e),this.yNumber.setPrecision(e),this.zNumber.setPrecision(e),this},s.Vector3.prototype.setRange=function(e,t){return this.xNumber.setRange(e,t),this.yNumber.setRange(e,t),this.zNumber.setRange(e,t),this},s.SelectionInput=function(e){if(s.AdaptiveTextArea.call(this),this.setSpellcheck(!1),"selection"!==e.type)return r.error("UI.SelectionInput: not a selection",e),this;this.setValue(e.string),this.selection=e;var t=this;return e.signals.stringChanged.add((function(e){t.setValue(e)})),this.onEnter(),this},s.SelectionInput.prototype=Object.create(s.AdaptiveTextArea.prototype),s.SelectionInput.prototype.setValue=function(e){return s.AdaptiveTextArea.prototype.setValue.call(this,e),this},s.SelectionInput.prototype.onEnter=function(e){var t=this,n=function(e){return!new r.Selection(e).selection.error};return this.onKeyPress((function(i){var r=t.getValue(),s=String.fromCharCode(i.which);13===i.keyCode?(i.preventDefault(),n(r)?("function"==typeof e?e(r):t.selection.setString(r),t.setBackgroundColor("white")):t.setBackgroundColor("tomato")):t.selection.string!==r+s?t.setBackgroundColor("skyblue"):t.setBackgroundColor("white")})),this.onKeyUp((function(e){var i=t.getValue();n(i)?t.selection.string===t.getValue()?t.setBackgroundColor("white"):t.setBackgroundColor("skyblue"):t.setBackgroundColor("tomato")})),this},s.SelectionPanel=function(e){return s.Panel.call(this),this.icon=new s.Icon("filter").setTitle("filter selection").addClass("lg").setMarginRight("10px"),this.input=new s.SelectionInput(e),this.add(this.icon,this.input),this},s.SelectionPanel.prototype=Object.create(s.Panel.prototype),s.SelectionPanel.prototype.setInputWidth=function(e){return this.input.setWidth(e),this},s.ComponentPanel=function(e){s.Panel.call(this);var t=e.stage,n=e.signals;n.nameChanged.add((function(e){i.setValue(e)})),n.visibilityChanged.add((function(e){r.setValue(e)})),n.disposed.add((function(){l.dispose()}));var i=new s.EllipsisText(e.name).setWidth("100px"),r=new s.ToggleIcon(e.visible,"eye","eye-slash").setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick((function(){e.setVisibility(!e.visible)})),o=new s.Icon("bullseye").setTitle("center").setCursor("pointer").setMarginLeft("10px").onClick((function(){e.autoView(1e3)})),a=(new s.DisposeIcon).setMarginLeft("10px").setDisposeFunction((function(){t.removeComponent(e)})),l=new s.PopupMenu("bars",e.type).setMarginLeft("46px").setEntryLabelWidth("110px");return this.add(i,r,o,a,l),this.menu=l,this},s.ComponentPanel.prototype=Object.create(s.Panel.prototype),s.ComponentPanel.prototype.addMenuEntry=function(e,t){return this.menu.addEntry(e,t),this},s.ComponentPanel.prototype.setMenuDisplay=function(e){return this.menu.setMenuDisplay(e),this},e.exports={UI:s}},7412:function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))},Jupyter;Object.defineProperty(exports,"__esModule",{value:!0}),exports.NGLView=exports.NGLModel=void 0;var widgets=__webpack_require__(2055),NGL=__webpack_require__(485),BaseView=__webpack_require__(2555).BaseView;const $=__webpack_require__(1929),_=__webpack_require__(431);__webpack_require__(1147),__webpack_require__(3199),__webpack_require__(4197),__webpack_require__(6237),__webpack_require__(6870),__webpack_require__(4374),__webpack_require__(9446);const gui_1=__webpack_require__(5587),fullscreen_1=__webpack_require__(6219),color_1=__webpack_require__(5211),theme_1=__webpack_require__(4649),messageInterface_1=__webpack_require__(5080);NGL.nglview_debug=!1;const chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid=new Array(36);function generateUUID(){let e,t=0;for(let n=0;n<36;n++)8===n||13===n||18===n||23===n?uuid[n]="-":14===n?uuid[n]="4":(t<=2&&(t=33554432+16777216*Math.random()|0),e=15&t,t>>=4,uuid[n]=chars[19===n?3&e|8:e]);return uuid.join("")}function createView(e,t){return __awaiter(this,void 0,void 0,(function*(){console.log("Creating view for model "+t);var n=e.model.widget_manager,i=e.model.get(t).replace("IPY_MODEL_","");return yield n.create_view(yield n.get_model(i))}))}class NGLModel extends widgets.DOMWidgetModel{defaults(){return _.extend(widgets.DOMWidgetModel.prototype.defaults(),{_model_name:"NGLModel",_model_module:"nglview-js-widgets",_model_module_version:__webpack_require__(8330).version,_view_name:"NGLView",_view_module:"nglview-js-widgets",_view_module_version:__webpack_require__(8330).version})}}exports.NGLModel=NGLModel;class NGLView extends widgets.DOMWidgetView{render(){this.beforeDisplay(),this.displayed.then(function(){this.createStage(),this.handlePicking(),this.handleSignals(),this.handleMessage(),this.finalizeDisplay()}.bind(this))}beforeDisplay(){this.model.on("change:_parameters",this.parametersChanged,this),this.model.on("change:gui_style",this.GUIStyleChanged,this),this.model.set("_ngl_version",NGL.Version),this._ngl_focused=0,this.uuid=generateUUID(),this.stage_widget=void 0,this.comp_uuids=[],this._synced_model_ids=this.model.get("_synced_model_ids"),this._synced_repr_model_ids=this.model.get("_synced_repr_model_ids"),this.isEmbeded()&&this._handleEmbedBeforeStage()}createStage(){var e=Object.assign({},this.model.get("_ngl_full_stage_parameters"));"backgroundColor"in e||(e.backgroundColor="white"),NGL.useWorker=!1,this.options.parent,this.stage=new NGL.Stage(void 0),this.$container=$(this.stage.viewer.container),this.$el.append(this.$container),this.stage.setParameters(e),this.$container=$(this.stage.viewer.container),this.handleResizable(),this.ngl_view_id=this.uuid,this.touch();var t=this.model.get("_view_width")||this.$el.parent().width()+"px",n=this.model.get("_view_height")||"300px";this.setSize(t,n),this.createFullscreenBtn(),this.createIPlayer(),this.GUIStyleChanged(),this.$container.resizable("option","maxWidth",this.$el.parent().width()),this.isEmbeded()?(console.log("Embed mode for NGLView"),this.handleEmbed()):(this.requestUpdateStageParameters(),1==this.model.views.length?this.serialize_camera_orientation():this.set_camera_orientation(this.model.get("_camera_orientation")))}isEmbeded(){return this.model.get("_ngl_serialize")||null==this.model.comm}handleMessage(){this.model.on("msg:custom",(e=>{this.on_msg(e)})),this.model.comm&&this.model.comm.on_msg((e=>{var t=e.buffers,n=e.content.data.content;t.length&&n&&(n.buffers=t),this.model._handle_comm_msg.call(this.model,e)}))}finalizeDisplay(){this.send({type:"request_loaded",data:!0});var e=this.stage.getParameters();this.model.set("_ngl_original_stage_parameters",e),this.touch(),!this.isEmbeded()&&this.stage.compList.length<this.model.get("n_components")&&this.handleEmbed();var t=this.model.get("_ngl_view_id");t.push(this.ngl_view_id),this.send({type:"updateIDs",data:t})}handleSignals(){var e=this.stage.viewer.container,t=this;e.addEventListener("mouseover",(function(e){t._ngl_focused=1,t.mouseOverDisplay("block")}),!1),e.addEventListener("mouseout",(function(e){t._ngl_focused=0,t.mouseOverDisplay("none")}),!1),e.addEventListener("contextmenu",(function(e){e.stopPropagation(),e.preventDefault()}),!0),this.stage.signals.componentAdded.add((function(e){this.comp_uuids.push(e.uuid);var n=this.stage.compList.length;this.model.set("n_components",n),this.touch();var i=this.stage.compList[n-1];i.signals.representationRemoved.add((function(){t.request_repr_dict()})),i.signals.representationAdded.add((function(e){t.request_repr_dict(),e.signals.parametersChanged.add((function(){console.log("repr.parametersChanged"),t.request_repr_dict()}))}))}),this),this.stage.signals.componentRemoved.add((function(e){return __awaiter(this,void 0,void 0,(function*(){var t=this.comp_uuids.indexOf(e.uuid);this.comp_uuids.splice(t,1);var n=this.stage.compList.length;this.model.set("n_components",n),this.touch(),console.log("componentRemoved",e,e.uuid);var i=[];for(var r in this.model.views)i.push(this.model.views[r]);var s=yield Promise.all(i);console.log(s);var o=!1;for(var r in s){var a=s[r];a.uuid!=this.uuid&&a.stage.compList.length>n&&(a.stage.removeComponent(a.stage.compList[t]),o=!0)}o&&(console.log("should update backend"),this.send({type:"removeComponent",data:t}))}))}),this),this.stage.signals.parametersChanged.add((function(){this.requestUpdateStageParameters()}),this),this.stage.viewerControls.signals.changed.add(function(){this.serialize_camera_orientation();var e=this.stage.viewerControls.getOrientation();t._synced_model_ids.length>0&&1==t._ngl_focused&&t._synced_model_ids.forEach((function(n){return __awaiter(this,void 0,void 0,(function*(){var i=yield t.model.widget_manager.get_model(n);for(var r in i.views){i.views[r];var s=yield i.views[r];s.uuid!=t.uuid&&s.stage.viewerControls.orient(e)}}))}))}.bind(this))}handlePicking(){this.$pickingInfo=$("<div></div>").css("position","absolute").css("top","5%").css("left","3%").css("background-color","white").css("padding","2px 5px 2px 5px").css("opacity","0.7").appendTo(this.$container),this.stage.signals.clicked.add((function(e){if(e){this.model.set("picked",{}),this.touch();var t={},n="";e.atom?(t.atom1=e.atom.toObject(),t.atom1.name=e.atom.qualifiedName(),n="Atom: "+t.atom1.name):e.bond&&(t.bond=e.bond.toObject(),t.atom1=e.bond.atom1.toObject(),t.atom1.name=e.bond.atom1.qualifiedName(),t.atom2=e.bond.atom2.toObject(),t.atom2.name=e.bond.atom2.qualifiedName(),n="Bond: "+t.atom1.name+" - "+t.atom2.name),e.instance&&(t.instance=e.instance);for(var i=this.stage.compList.length,r=0;r<i;r++)this.stage.compList[r].uuid==e.component.uuid&&(t.component=r);this.model.set("picked",t),this.touch(),this.$pickingInfo.text(n)}}),this)}mouseOverDisplay(e){return __awaiter(this,void 0,void 0,(function*(){var t=this;if(this.btn_pview_fullscreen){var n=yield this.btn_pview_fullscreen;n.el.style.display=e,t.stage_widget&&(n.el.style.display="none")}if(t=this,this.player_pview){var i=yield this.player_pview;i.el.style.display=e,t.model.get("max_frame")&&0!=t.model.get("max_frame")||(i.el.style.display="none")}}))}updateNGLTheme(e){var t=document.getElementById("nglview_style");null!=t&&document.head.removeChild(t);var n=document.createElement("style");n.id="nglview_style",n.type="text/css",n.appendChild(document.createTextNode(e)),document.head.appendChild(n)}serialize_camera_orientation(){var e=this.stage.viewerControls.getOrientation();this.model.set("_camera_orientation",e.elements),this.touch()}set_camera_orientation(e){e.length>0&&(this.stage.viewerControls.orient(e),this.serialize_camera_orientation())}executeCode(code){eval(code)}_handleEmbedBeforeStage(){var e,t=this.model.get("_ngl_color_dict");for(e in t)NGL.ColormakerRegistry.hasScheme(e)||this.addColorScheme(t[e],e)}handleEmbed(){return __awaiter(this,void 0,void 0,(function*(){var e=this,t=e.model.get("_ngl_msg_archive"),n=e.model.get("_ngl_full_stage_parameters");const i=e.model.get("_camera_orientation");if(0!==Object.keys(n).length||0!==i.length){var r=[];if(_.each(t,(function(t){"loadFile"==t.methodName&&(t.kwargs&&t.kwargs.defaultRepresentation&&(t.kwargs.defaultRepresentation=!1),r.push(e._getLoadFilePromise(t)))})),yield Promise.all(r),e.stage.setParameters(n),e.set_camera_orientation(i),e.touch(),void 0===e.model.comm){var s=e.model.get("_ngl_coordinate_resource"),o=s.n_frames||1;e.model.set("max_frame",o-1),e.touch();var a=(yield e.getPlayerModel()).get("children")[0];e.listenTo(a,"change:value",(function(){e.updateCoordinatesFromDict(s,a.get("value"))}))}for(const t of e.model.get("_ngl_msg_archive"))t.fire_embed&&(yield e.on_msg(t));e._set_representation_from_repr_dict(e.model.get("_ngl_repr_dict")),e.handleResize()}else{console.log("No state stored; initializing embedded widget for the first time.");for(const n of t)yield e.on_msg(n)}}))}updateCoordinatesFromDict(e,t){for(var n=Object.keys(e).filter((e=>"n_frames"!==e)),i=0;i<n.length;i++){var r=n[i],s=this.decode_base64(e[r][t]);s&&s.byteLength>0&&this.updateCoordinates(s,r)}}requestFrame(){this.send({type:"request_frame",data:"frame"})}requestUpdateStageParameters(){var e=this.stage.getParameters();this.model.set("_ngl_full_stage_parameters",e),this.touch()}requestReprParameters(e,t){var n=this.stage.compList[e].reprList[t],i=n.repr.getParameters();i&&(i.name=n.name,this.send({type:"repr_parameters",data:i}))}request_repr_dict(){var e=this.getReprDictFrontEnd();this.send({type:"request_repr_dict",data:e});var t=this;t._synced_repr_model_ids.length>0&&t._synced_repr_model_ids.forEach((function(n){return __awaiter(this,void 0,void 0,(function*(){var i=yield t.model.widget_manager.get_model(n);for(var r in i.views){var s=yield i.views[r];s.uuid!=t.uuid&&s._set_representation_from_repr_dict(e)}}))}))}getReprDictFrontEnd(){for(var e={},t=this.stage.compList.length,n=0;n<t;n++){var i=this.stage.compList[n];e[n]={};for(var r=e[n],s=0;s<i.reprList.length;s++){var o=i.reprList[s];r[s]={},r[s].type=o.name,r[s].params=o.repr.getParameters()}}return e}syncReprForAllViews(){var e=this.model.get("_ngl_repr_dict"),t=this.getReprDictFrontEnd();JSON.stringify(t)!==JSON.stringify(e)&&this._set_representation_from_repr_dict(e)}syncReprWithMe(){return __awaiter(this,void 0,void 0,(function*(){var e=this.getReprDictFrontEnd();for(var t in this.model.views){var n=yield this.model.views[t];n.uuid!=this.uuid&&n._set_representation_from_repr_dict(e)}this.request_repr_dict()}))}setSyncRepr(e){this._synced_repr_model_ids=e}setSyncCamera(e){this._synced_model_ids=e}viewXZPlane(){var e=(new NGL.Matrix4).makeRotationX(Math.PI/2),t=(new NGL.Quaternion).setFromRotationMatrix(e);this.stage.viewerControls.rotate(t)}set_representation_from_backend(){var e=this.model.get("_ngl_repr_dict");this._set_representation_from_repr_dict(e)}_set_representation_from_repr_dict(e){var t=this.stage.compList;if(t.length>0)for(var n in e){var i=t[n];i.removeAllRepresentations();var r=e[n];for(var s in r){var o=r[s];o&&i.addRepresentation(o.type,o.params)}}}createView(e){return __awaiter(this,void 0,void 0,(function*(){console.log("Creating view for model "+e);var t=this.model.widget_manager,n=this.model.get(e).replace("IPY_MODEL_","");return yield t.create_view(yield t.get_model(n))}))}getPlayerModel(){var e=this.model.get("_iplayer").replace("IPY_MODEL_","");return this.model.widget_manager.get_model(e)}createIPlayer(){return __awaiter(this,void 0,void 0,(function*(){this.player_pview=this.createView("_iplayer");var e=yield this.player_pview,t=e.el;t.style.position="absolute",t.style.zIndex=100,t.style.bottom="5%",t.style.left="10%",t.style.opacity="0.7",this.stage.viewer.container.append(e.el),t.style.display="none"}))}createImageBtn(){return __awaiter(this,void 0,void 0,(function*(){this.image_btn_pview=this.createView("_ibtn_image");var e=yield this.image_btn_pview,t=e.el;t.style.position="absolute",t.style.zIndex=100,t.style.top="5%",t.style.right="10%",t.style.opacity="0.7",t.style.width="35px",this.stage.viewer.container.append(e.el)}))}createFullscreenBtn(){return __awaiter(this,void 0,void 0,(function*(){this.btn_pview_fullscreen=this.createView("_ibtn_fullscreen");var e=yield this.btn_pview_fullscreen,t=this.stage,n=e.el;n.style.position="absolute",n.style.zIndex=100,n.style.top="5%",n.style.right="5%",n.style.opacity="0.7",n.style.width="35px",n.style.background="white",n.style.opacity="0.3",n.style.display="none",n.onclick=function(){this.stage.toggleFullscreen()}.bind(this),t.viewer.container.append(e.el),t.signals.fullscreenChanged.add((function(t){t?e.model.set("icon","compress"):e.model.set("icon","expand")}))}))}createGUI(){return __awaiter(this,void 0,void 0,(function*(){this.pgui_view=this.createView("_igui");var e=yield this.pgui_view,t=e.el;t.style.position="absolute",t.style.zIndex=100,t.style.top="5%",t.style.right="10%",t.style.width="300px",this.stage.viewer.container.append(e.el)}))}createNglGUI(){this.stage_widget=new gui_1.StageWidget(this)}setVisibilityForRepr(e,t,n){var i=this.stage.compList[e].reprList[t];i&&i.setVisibility(n)}removeRepresentation(e,t){var n=this.stage.compList[e],i=n.reprList[t];i&&n.removeRepresentation(i)}removeRepresentationsByName(e,t){var n=this.stage.compList[t];n&&n.reprList.forEach((function(t){t.name==e&&n.removeRepresentation(t)}))}updateRepresentationForComponent(e,t,n){var i=this.stage.compList[t].reprList[e];i&&i.setParameters(n)}updateRepresentationsByName(e,t,n){var i=this.stage.compList[t],r=this;i&&i.reprList.forEach((function(t){t.name==e&&(t.setParameters(n),r.request_repr_dict())}))}setRepresentation(e,t,n,i){var r=this.stage.compList[n],s=r.reprList[i];if(s){t.useWorker=!1;var o=NGL.makeRepresentation(e,r.structure,this.stage.viewer,t);o&&(s.setRepresentation(o),s.name=e,r.reprList[i]=s,this.request_repr_dict())}}setColorByResidue(e,t,n){var i=this.stage.compList[t].reprList[n],r=NGL.ColormakerRegistry.addScheme((function(t){this.atomColor=function(t){return e[t.residueIndex]}}));i.setColor(r)}addShape(e,t){for(var n=new NGL.Shape(e),i={sphere:n.addSphere,ellipsoid:n.addEllipsoid,cylinder:n.addCylinder,cone:n.addCone,mesh:n.addMesh,arrow:n.addArrow,text:n.addText,label:n.addText,tetrahedron:n.addTetrahedron,octahedron:n.addOctahedron,torus:n.addTorus},r=0;r<t.length;r++){var s=t[r],o=s[0],a=s.slice(1,s.length);i[o].apply(n,a)}this.stage.addComponentFromObject(n).addRepresentation("buffer")}addBuffer(e,t){var n={arrow:NGL.ArrowBuffer,box:NGL.BoXbuffer,cone:NGL.ConeBuffer,cylinder:NGL.CylinderBuffer,ellipsoid:NGL.EllipsoidBuffer,octahedron:NGL.OctahedronBuffer,sphere:NGL.SphereBuffer,text:NGL.TextBuffer,tetrahedron:NGL.TetrahedronBuffer,torus:NGL.TorusBuffer},i={};for(var r in t)i[r]=new Float32Array(t[r]);var s=new NGL.Shape("shape"),o=new(0,n[e])(i);s.addBuffer(o),this.stage.addComponentFromObject(s).addRepresentation("buffer")}replaceStructure(e){return __awaiter(this,void 0,void 0,(function*(){var t=new Blob([e.data],{type:"text/plain"}),n=this.stage,i=e.params||{};i.ext=e.ext,i.defaultRepresentation=!1;var r=this.stage.compList[0],s=r.reprList.slice(),o=this.stage.viewerControls.getOrientation(),a=yield this.stage.loadFile(t,i);n.viewerControls.orient(o),s.forEach((function(e){var t=e.name,n=e.repr.getParameters();a.addRepresentation(t,n)})),n.removeComponent(r),this._handleLoadFileFinished()}))}superpose(e,t,n,i,r){var s=this.stage.compList[e];this.stage.compList[t].superpose(s,n,i,r)}decode_base64(e){var t,n,i,r,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=.75*e.length,l=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(t=0;t<l;t+=4)n=o.indexOf(e[t]),i=o.indexOf(e[t+1]),r=o.indexOf(e[t+2]),s=o.indexOf(e[t+3]),h[c++]=n<<2|i>>4,h[c++]=(15&i)<<4|r>>2,h[c++]=(3&r)<<6|63&s;return u}updateCoordinates(e,t){var n=this.stage.compList[t];if(e&&n){var i=new Float32Array(e);n.structure.updatePosition(i),n.updateRepresentations({position:!0})}}handleResizable(){this.$container.resizable({resize:function(e,t){this.setSize(t.size.width+"px",t.size.height+"px")}.bind(this)})}handleResize(){var e=this.$el.width(),t=this.$el.height()+"px";this.stage_widget&&(e-=$(this.stage_widget.sidebar.dom).width()),e+="px",this.setSize(e,t)}setSize(e,t){this.stage.viewer.container.style.width=e,this.stage.viewer.container.style.height=t,this.stage.handleResize()}GUIStyleChanged(){if("ngl"===this.model.get("gui_style"))this.createNglGUI();else if(this.stage_widget){this.stage_widget.dispose(),this.stage_widget=void 0,this.$container.resizable("enable");var e=this.$el.parent().width()+"px",t=this.$el.parent().height()+"px";this.setSize(e,t)}}parametersChanged(){var e=this.model.get("_parameters");this.setParameters(e)}setParameters(e){this.stage.setParameters(e);var t=this.stage.getParameters();this.send({type:"stage_parameters",data:t})}_downloadImage(e,t){return __awaiter(this,void 0,void 0,(function*(){if(this.ngl_view_id==this.get_last_child_id()){var n=yield this.stage.makeImage(t);NGL.download(n,e)}}))}_exportImage(e,t){return __awaiter(this,void 0,void 0,(function*(){if(this.ngl_view_id==this.get_last_child_id()){var n,i=yield this.stage.makeImage(t),r=new FileReader;r.onload=function(){n=r.result.replace("data:image/png;base64,",""),this.send({data:n,type:"image_data",ID:e}),this.send({type:"async_message",data:"ok"})}.bind(this),r.readAsDataURL(i)}}))}handleMovieMaking(e){return __awaiter(this,void 0,void 0,(function*(){if(console.log("handleMovieMaking: render_params",e),this.ngl_view_id==this.get_last_child_id()){var t,n=yield this.stage.makeImage(e),i=new FileReader;i.onload=function(){t=i.result.replace("data:image/png;base64,",""),this.send({data:t,type:"movie_image_data"}),this.send({type:"async_message",data:"ok"})}.bind(this),i.readAsDataURL(n)}}))}_handleLoadFileFinished(){return __awaiter(this,void 0,void 0,(function*(){this.send({type:"async_message",data:"ok"})}))}_getLoadFilePromise(e){var t,n=e.args[0];if("blob"==n.type){var i;if(n.binary){var r=this.decode_base64(n.data);i=new Blob([r],{type:"application/octet-binary"})}else i=new Blob([n.data],{type:"text/plain"});return this.stage.loadFile(i,e.kwargs)}return new File([""],n.data),t=n.data,this.stage.loadFile(t,e.kwargs)}get_last_child_id(){var e=this.model.get("_ngl_view_id");return e[e.length-1]}_handleStageLoadFile(e){return __awaiter(this,void 0,void 0,(function*(){this.ngl_view_id!=this.get_last_child_id()&&e.last_child||(yield this._getLoadFilePromise(e),this._handleLoadFileFinished())}))}addColorScheme(e,t){var n=NGL.ColormakerRegistry.addSelectionScheme(e,t),i=NGL.ColormakerRegistry.userSchemes[n];return NGL.ColormakerRegistry.removeScheme(n),NGL.ColormakerRegistry.add(t,i),t}on_msg(e){return __awaiter(this,void 0,void 0,(function*(){try{yield messageInterface_1.IMessageSchema.validate(e)}catch(e){return void console.error("Invalid message:",e)}switch(e.type){case"call_method":yield this.handleCallMethod(e);break;case"base64_single":this.handleBase64Single(e.data);break;case"binary_single":this.handleBinarySingle(e);break;case"movie_image_data":this.handleMovieMaking(e.render_params);break;case"get":this.handleGetRequest(e.data);break;case"request_frame":this.requestFrame();break;case"updateIDs":this.updateIDs(e.data);break;case"removeComponent":this.removeComponent(e.data);break;case"repr_parameters":this.requestReprParameters(e.component_index,e.repr_index);break;case"request_loaded":this.requestLoaded();break;case"request_repr_dict":this.request_repr_dict();break;case"stage_parameters":this.requestUpdateStageParameters();break;case"async_message":this.sendAsyncMessage(e.data);break;case"image_data":this.handleImageData(e.ID,e.data);break;default:console.log("Unknown message type: "+e.type)}}))}handleCallMethod(e){return __awaiter(this,void 0,void 0,(function*(){var t,n,i=e.args.slice();switch(i.push(e.kwargs),"addRepresentation"===e.methodName&&e.reconstruc_color_scheme&&(e.kwargs.color=this.addColorScheme(e.kwargs.color,e.kwargs.color_label)),"colorVolume"in e.kwargs&&(t=e.kwargs.colorVolume,e.kwargs.colorVolume=this.stage.compList[t].volume),e.target){case"Stage":yield this.handleStageMethod(e,i);break;case"Viewer":this.stage.viewer[e.methodName].apply(this.stage.viewer,i);break;case"viewerControls":this.stage.viewerControls[e.methodName].apply(this.stage.viewerControls,i);break;case"compList":(n=this.stage.compList[e.component_index])[e.methodName].apply(n,i);break;case"Widget":this[e.methodName].apply(this,i);break;case"Representation":var r=(n=this.stage.compList[e.component_index]).reprList[e.repr_index];r[e.methodName].apply(r,i);break;default:console.log("Unknown target: "+e.target)}}))}handleStageMethod(e,t){return __awaiter(this,void 0,void 0,(function*(){var n=this.stage[e.methodName];if("screenshot"===e.methodName)NGL.screenshot(this.stage.viewer,e.kwargs);else if("removeComponent"===e.methodName){var i=this.stage.compList[e.args[0]];this.stage.removeComponent(i)}else"loadFile"===e.methodName?(this.model.views.length>1&&e.kwargs&&e.kwargs.defaultRepresentation&&(e.kwargs.defaultRepresentation=!1),yield this._handleStageLoadFile(e)):n.apply(this.stage,t)}))}handleBase64Single(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n],r=this.decode_base64(e[i]);r&&r.byteLength>0&&this.updateCoordinates(r,i)}}handleBinarySingle(e){for(var t=e.data,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],s=new Float32Array(e.buffers[i].buffer);s.byteLength>0&&this.updateCoordinates(s,r)}e.movie_making&&this.handleMovieMaking(e.render_params)}handleGetRequest(e){"camera"===e?this.send(JSON.stringify(this.stage.viewer.camera)):"parameters"===e?this.send(JSON.stringify(this.stage.parameters)):(console.log("Number of components",this.stage.compList.length),console.log("ngl_view_id",this.ngl_view_id))}updateIDs(e){var t=this.model.get("_ngl_view_id");t.push(this.ngl_view_id),this.send({type:"updateIDs",data:t})}removeComponent(e){var t=this.stage.compList[e];this.stage.removeComponent(t)}requestLoaded(){this.send({type:"request_loaded",data:!0})}sendAsyncMessage(e){this.send({type:"async_message",data:e})}handleImageData(e,t){this.send({data:t,type:"image_data",ID:e})}}exports.NGLView=NGLView,module.exports={NGLView,NGLModel,NGL,FullscreenModel:fullscreen_1.FullscreenModel,FullscreenView:fullscreen_1.FullscreenView,ColormakerRegistryModel:color_1.ColormakerRegistryModel,ColormakerRegistryView:color_1.ColormakerRegistryView,ThemeManagerModel:theme_1.ThemeManagerModel,ThemeManagerView:theme_1.ThemeManagerView}},9894:function(e,t,n){var i;e=n.nmd(e),function(){var n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C,T,E,P,I,k,R,D,L,O,N,F,B,U,z,V,H,$,G,j,W,q,X,Y,K,Z,Q,J,ee,te,ne,ie,re,se,oe,ae,le,ce,ue,he,de,pe,fe,me,ge,_e,ve,ye,be,xe,we,Se,Ae,Me,Ce,Te,Ee,Pe=[].slice;Ae=function(){var e,t,n,i,r;for(e={},i=0,t=(r="Boolean Number String Function Array Date RegExp Undefined Null".split(" ")).length;i<t;i++)n=r[i],e["[object "+n+"]"]=n.toLowerCase();return function(t){var n;return n=Object.prototype.toString.call(t),e[n]||"object"}}(),Y=function(e,t,n){return null==t&&(t=0),null==n&&(n=1),e<t&&(e=t),e>n&&(e=n),e},Me=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},S=function(e){var t,n;for(e._clipped=!1,e._unclipped=e.slice(0),t=n=0;n<3;t=++n)t<3?((e[t]<0||e[t]>255)&&(e._clipped=!0),e[t]<0&&(e[t]=0),e[t]>255&&(e[t]=255)):3===t&&(e[t]<0&&(e[t]=0),e[t]>1&&(e[t]=1));return e._clipped||delete e._unclipped,e},o=Math.PI,ye=Math.round,M=Math.cos,I=Math.floor,ie=Math.pow,K=Math.log,xe=Math.sin,we=Math.sqrt,g=Math.atan2,J=Math.max,m=Math.abs,c=2*o,a=o/3,r=o/180,l=180/o,w=function(){return arguments[0]instanceof n?arguments[0]:function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,arguments,(function(){}))},w.default=w,f=[],null!==e&&null!=e.exports&&(e.exports=w),void 0===(i=function(){return w}.apply(t,[]))||(e.exports=i),w.version="1.4.1",p={},h=[],d=!1,n=function(){function e(){var e,t,n,i,r,s,o,a,l;for(s=this,t=[],a=0,i=arguments.length;a<i;a++)null!=(e=arguments[a])&&t.push(e);if(t.length>1&&(o=t[t.length-1]),null!=p[o])s._rgb=S(p[o](Me(t.slice(0,-1))));else{for(d||(h=h.sort((function(e,t){return t.p-e.p})),d=!0),l=0,r=h.length;l<r&&!(o=(n=h[l]).test.apply(n,t));l++);o&&(s._rgb=S(p[o].apply(p,t)))}null==s._rgb&&console.warn("unknown format: "+t),null==s._rgb&&(s._rgb=[0,0,0]),3===s._rgb.length&&s._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),w._input=p,w.brewer=b={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,t;for(e in t=[],b)t.push(b[e.toLowerCase()]=b[e])}(),w.colors=Ce={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},G=function(){var e,t,n,i,r,o,a;return i=(t=Me(arguments))[0],e=t[1],n=t[2],o=(i+16)/116,r=isNaN(e)?o:o+e/500,a=isNaN(n)?o:o-n/200,o=s.Yn*j(o),r=s.Xn*j(r),a=s.Zn*j(a),[Ee(3.2404542*r-1.5371385*o-.4985314*a),Ee(-.969266*r+1.8760108*o+.041556*a),n=Ee(.0556434*r-.2040259*o+1.0572252*a),t.length>3?t[3]:1]},Ee=function(e){return 255*(e<=.00304?12.92*e:1.055*ie(e,1/2.4)-.055)},j=function(e){return e>s.t1?e*e*e:s.t2*(e-s.t0)},s={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},he=function(){var e,t,n,i,r,s,o;return n=(i=Me(arguments))[0],t=i[1],e=i[2],s=(r=ge(n,t,e))[0],[116*(o=r[1])-16,500*(s-o),200*(o-r[2])]},_e=function(e){return(e/=255)<=.04045?e/12.92:ie((e+.055)/1.055,2.4)},Te=function(e){return e>s.t3?ie(e,1/3):e/s.t2+s.t0},ge=function(){var e,t,n,i;return n=(i=Me(arguments))[0],t=i[1],e=i[2],n=_e(n),t=_e(t),e=_e(e),[Te((.4124564*n+.3575761*t+.1804375*e)/s.Xn),Te((.2126729*n+.7151522*t+.072175*e)/s.Yn),Te((.0193339*n+.119192*t+.9503041*e)/s.Zn)]},w.lab=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["lab"]),(function(){}))},p.lab=G,n.prototype.lab=function(){return he(this._rgb)},_=function(e){var t,n,i,r,s,o,a,l,c,u,h;return 2===(e=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(w(r));return i}()).length?(c=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(r.lab());return i}(),s=c[0],o=c[1],t=function(e){var t,n;return n=function(){var n,i;for(i=[],t=n=0;n<=2;t=++n)i.push(s[t]+e*(o[t]-s[t]));return i}(),w.lab.apply(w,n)}):3===e.length?(u=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(r.lab());return i}(),s=u[0],o=u[1],a=u[2],t=function(e){var t,n;return n=function(){var n,i;for(i=[],t=n=0;n<=2;t=++n)i.push((1-e)*(1-e)*s[t]+2*(1-e)*e*o[t]+e*e*a[t]);return i}(),w.lab.apply(w,n)}):4===e.length?(h=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(r.lab());return i}(),s=h[0],o=h[1],a=h[2],l=h[3],t=function(e){var t,n;return n=function(){var n,i;for(i=[],t=n=0;n<=2;t=++n)i.push((1-e)*(1-e)*(1-e)*s[t]+3*(1-e)*(1-e)*e*o[t]+3*(1-e)*e*e*a[t]+e*e*e*l[t]);return i}(),w.lab.apply(w,n)}):5===e.length&&(n=_(e.slice(0,3)),i=_(e.slice(2,5)),t=function(e){return e<.5?n(2*e):i(2*(e-.5))}),t},w.bezier=function(e){var t;return(t=_(e)).scale=function(){return w.scale(t)},t},w.cubehelix=function(e,t,n,i,r){var s,o,a;return null==e&&(e=300),null==t&&(t=-1.5),null==n&&(n=1),null==i&&(i=1),null==r&&(r=[0,1]),s=0,"array"===Ae(r)?o=r[1]-r[0]:(o=0,r=[r,r]),(a=function(a){var l,u,h,d,p;return l=c*((e+120)/360+t*a),d=ie(r[0]+o*a,i),u=(0!==s?n[0]+a*s:n)*d*(1-d)/2,h=M(l),p=xe(l),w(S([255*(d+u*(-.14861*h+1.78277*p)),255*(d+u*(-.29227*h-.90649*p)),255*(d+u*(1.97294*h)),1]))}).start=function(t){return null==t?e:(e=t,a)},a.rotations=function(e){return null==e?t:(t=e,a)},a.gamma=function(e){return null==e?i:(i=e,a)},a.hue=function(e){return null==e?n:("array"===Ae(n=e)?0==(s=n[1]-n[0])&&(n=n[1]):s=0,a)},a.lightness=function(e){return null==e?r:("array"===Ae(e)?(r=e,o=e[1]-e[0]):(r=[e,e],o=0),a)},a.scale=function(){return w.scale(a)},a.hue(n),a},w.random=function(){var e,t;for(e="#",t=0;t<6;++t)e+="0123456789abcdef".charAt(I(16*Math.random()));return new n(e)},f=[],F=function(e,t,n,i){var r,s,o,a;for(null==n&&(n=.5),null==i&&(i="rgb"),"object"!==Ae(e)&&(e=w(e)),"object"!==Ae(t)&&(t=w(t)),o=0,s=f.length;o<s;o++)if(i===(r=f[o])[0]){a=r[1](e,t,n,i);break}if(null==a)throw"color mode "+i+" is not supported";return a.alpha(e.alpha()+n*(t.alpha()-e.alpha()))},w.interpolate=F,n.prototype.interpolate=function(e,t,n){return F(this,e,t,n)},w.mix=F,n.prototype.mix=n.prototype.interpolate,p.rgb=function(){var e,t,n,i;for(e in n=[],t=Me(arguments))i=t[e],n.push(i);return n},w.rgb=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["rgb"]),(function(){}))},n.prototype.rgb=function(e){return null==e&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},n.prototype.rgba=function(e){return null==e&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},h.push({p:3,test:function(e){var t;return t=Me(arguments),"array"===Ae(t)&&3===t.length||4===t.length&&"number"===Ae(t[3])&&t[3]>=0&&t[3]<=1?"rgb":void 0}}),p.lrgb=p.rgb,z=function(e,t,i,r){var s,o;return s=e._rgb,o=t._rgb,new n(we(ie(s[0],2)*(1-i)+ie(o[0],2)*i),we(ie(s[1],2)*(1-i)+ie(o[1],2)*i),we(ie(s[2],2)*(1-i)+ie(o[2],2)*i),r)},u=function(e){var t,i,r,s,o;for(t=1/e.length,o=[0,0,0,0],r=0,i=e.length;r<i;r++)s=e[r]._rgb,o[0]+=ie(s[0],2)*t,o[1]+=ie(s[1],2)*t,o[2]+=ie(s[2],2)*t,o[3]+=s[3]*t;return o[0]=we(o[0]),o[1]=we(o[1]),o[2]=we(o[2]),o[3]>1&&(o[3]=1),new n(S(o))},f.push(["lrgb",z]),w.average=function(e,t){var n,i,r,s,a,l,c,h,d,p,f,m,_;if(null==t&&(t="rgb"),d=e.length,e=e.map((function(e){return w(e)})),c=e.splice(0,1)[0],"lrgb"===t)return u(e);for(h in s=[],a=0,l=0,m=c.get(t))m[h]=m[h]||0,s.push(isNaN(m[h])?0:1),"h"!==t.charAt(h)||isNaN(m[h])||(n=m[h]/180*o,a+=M(n),l+=xe(n));for(i=c.alpha(),f=0,p=e.length;f<p;f++)for(h in _=(r=e[f]).get(t),i+=r.alpha(),m)isNaN(_[h])||(s[h]+=1,"h"===t.charAt(h)?(n=_[h]/180*o,a+=M(n),l+=xe(n)):m[h]+=_[h]);for(h in m)if("h"===t.charAt(h)){for(n=g(l/s[h],a/s[h])/o*180;n<0;)n+=360;for(;n>=360;)n-=360;m[h]=n}else m[h]=m[h]/s[h];return w(m,t).alpha(i/d)},R=function(e){var t,n;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return 4!==e.length&&7!==e.length||(e=e.substr(1)),3===e.length&&(e=(e=e.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]),[(n=parseInt(e,16))>>16,n>>8&255,255&n,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return 9===e.length&&(e=e.substr(1)),[(n=parseInt(e,16))>>24&255,n>>16&255,n>>8&255,ye((255&n)/255*100)/100];if(null!=p.css&&(t=p.css(e)))return t;throw"unknown color: "+e},ae=function(e,t){var n,i,r,s,o,a;return null==t&&(t="auto"),o=e[0],r=e[1],i=e[2],n=e[3],"auto"===t&&(t=n<1?"rgba":"rgb"),o=Math.round(o),r=Math.round(r),i=Math.round(i),a=(a="000000"+(o<<16|r<<8|i).toString(16)).substr(a.length-6),s=(s="0"+ye(255*n).toString(16)).substr(s.length-2),"#"+function(){switch(t.toLowerCase()){case"rgba":return a+s;case"argb":return s+a;default:return a}}()},p.hex=function(e){return R(e)},w.hex=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["hex"]),(function(){}))},n.prototype.hex=function(e){return null==e&&(e="auto"),ae(this._rgb,e)},h.push({p:4,test:function(e){if(1===arguments.length&&"string"===Ae(e))return"hex"}}),O=function(){var e,t,n,i,r,s,o,a,l,c,u,h,d,p;if(r=(e=Me(arguments))[0],u=e[1],o=e[2],0===u)l=i=t=255*o;else{for(n=[0,0,0],h=2*o-(d=o<.5?o*(1+u):o+u-o*u),(p=[0,0,0])[0]=(r/=360)+1/3,p[1]=r,p[2]=r-1/3,s=a=0;a<=2;s=++a)p[s]<0&&(p[s]+=1),p[s]>1&&(p[s]-=1),6*p[s]<1?n[s]=h+6*(d-h)*p[s]:2*p[s]<1?n[s]=d:3*p[s]<2?n[s]=h+(d-h)*(2/3-p[s])*6:n[s]=h;l=(c=[ye(255*n[0]),ye(255*n[1]),ye(255*n[2])])[0],i=c[1],t=c[2]}return e.length>3?[l,i,t,e[3]]:[l,i,t]},ce=function(e,t,n){var i,r,s,o,a;return void 0!==e&&e.length>=3&&(e=(o=e)[0],t=o[1],n=o[2]),e/=255,t/=255,n/=255,s=Math.min(e,t,n),r=((J=Math.max(e,t,n))+s)/2,J===s?(a=0,i=Number.NaN):a=r<.5?(J-s)/(J+s):(J-s)/(2-J-s),e===J?i=(t-n)/(J-s):t===J?i=2+(n-e)/(J-s):n===J&&(i=4+(e-t)/(J-s)),(i*=60)<0&&(i+=360),[i,a,r]},w.hsl=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["hsl"]),(function(){}))},p.hsl=O,n.prototype.hsl=function(){return ce(this._rgb)},N=function(){var e,t,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_;if(r=(e=Me(arguments))[0],m=e[1],_=e[2],_*=255,0===m)l=i=t=_;else switch(360===r&&(r=0),r>360&&(r-=360),r<0&&(r+=360),o=_*(1-m),a=_*(1-m*(n=(r/=60)-(s=I(r)))),g=_*(1-m*(1-n)),s){case 0:l=(c=[_,g,o])[0],i=c[1],t=c[2];break;case 1:l=(u=[a,_,o])[0],i=u[1],t=u[2];break;case 2:l=(h=[o,_,g])[0],i=h[1],t=h[2];break;case 3:l=(d=[o,a,_])[0],i=d[1],t=d[2];break;case 4:l=(p=[g,o,_])[0],i=p[1],t=p[2];break;case 5:l=(f=[_,o,a])[0],i=f[1],t=f[2]}return[l,i,t,e.length>3?e[3]:1]},ue=function(){var e,t,n,i,r,s,o,a,l;return s=(o=Me(arguments))[0],n=o[1],e=o[2],r=Math.min(s,n,e),t=(J=Math.max(s,n,e))-r,l=J/255,0===J?(i=Number.NaN,a=0):(a=t/J,s===J&&(i=(n-e)/t),n===J&&(i=2+(e-s)/t),e===J&&(i=4+(s-n)/t),(i*=60)<0&&(i+=360)),[i,a,l]},w.hsv=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["hsv"]),(function(){}))},p.hsv=N,n.prototype.hsv=function(){return ue(this._rgb)},te=function(e){return"number"===Ae(e)&&e>=0&&e<=16777215?[e>>16,e>>8&255,255&e,1]:(console.warn("unknown num color: "+e),[0,0,0,1])},fe=function(){var e;return((e=Me(arguments))[0]<<16)+(e[1]<<8)+e[2]},w.num=function(e){return new n(e,"num")},n.prototype.num=function(e){return null==e&&(e="rgb"),fe(this._rgb,e)},p.num=te,h.push({p:1,test:function(e){if(1===arguments.length&&"number"===Ae(e)&&e>=0&&e<=16777215)return"num"}}),k=function(){var e,t,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y;if(a=(n=Me(arguments))[0],r=n[1],t=n[2],o=o/100*255,e=255*(r/=100),0===r)h=o=i=t;else switch(360===a&&(a=0),a>360&&(a-=360),a<0&&(a+=360),u=(c=t*(1-r))+e*(1-(s=(a/=60)-(l=I(a)))),v=c+e*s,y=c+e,l){case 0:h=(d=[y,v,c])[0],o=d[1],i=d[2];break;case 1:h=(p=[u,y,c])[0],o=p[1],i=p[2];break;case 2:h=(f=[c,y,v])[0],o=f[1],i=f[2];break;case 3:h=(m=[c,u,y])[0],o=m[1],i=m[2];break;case 4:h=(g=[v,c,y])[0],o=g[1],i=g[2];break;case 5:h=(_=[y,c,u])[0],o=_[1],i=_[2]}return[h,o,i,n.length>3?n[3]:1]},oe=function(){var e,t,n,i,r,s,o,a,l;return a=(l=Me(arguments))[0],r=l[1],t=l[2],o=Math.min(a,r,t),n=100*(i=(J=Math.max(a,r,t))-o)/255,e=o/(255-i)*100,0===i?s=Number.NaN:(a===J&&(s=(r-t)/i),r===J&&(s=2+(t-a)/i),t===J&&(s=4+(a-r)/i),(s*=60)<0&&(s+=360)),[s,n,e]},w.hcg=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["hcg"]),(function(){}))},p.hcg=k,n.prototype.hcg=function(){return oe(this._rgb)},C=function(e){var t,n,i,r,s,o,a,l;if(e=e.toLowerCase(),null!=w.colors&&w.colors[e])return R(w.colors[e]);if(s=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(a=s.slice(1,4),r=o=0;o<=2;r=++o)a[r]=+a[r];a[3]=1}else if(s=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(a=s.slice(1,5),r=l=0;l<=3;r=++l)a[r]=+a[r];else if(s=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(a=s.slice(1,4),r=t=0;t<=2;r=++t)a[r]=ye(2.55*a[r]);a[3]=1}else if(s=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(a=s.slice(1,5),r=n=0;n<=2;r=++n)a[r]=ye(2.55*a[r]);a[3]=+a[3]}else(s=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?((i=s.slice(1,4))[1]*=.01,i[2]*=.01,(a=O(i))[3]=1):(s=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&((i=s.slice(1,4))[1]*=.01,i[2]*=.01,(a=O(i))[3]=+s[4]);return a},se=function(e){var t;return"rgb"==(t=e[3]<1?"rgba":"rgb")?t+"("+e.slice(0,3).map(ye).join(",")+")":"rgba"===t?t+"("+e.slice(0,3).map(ye).join(",")+","+e[3]+")":void 0},ve=function(e){return ye(100*e)/100},L=function(e,t){var n;return n=t<1?"hsla":"hsl",e[0]=ve(e[0]||0),e[1]=ve(100*e[1])+"%",e[2]=ve(100*e[2])+"%","hsla"===n&&(e[3]=t),n+"("+e.join(",")+")"},p.css=function(e){return C(e)},w.css=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["css"]),(function(){}))},n.prototype.css=function(e){return null==e&&(e="rgb"),"rgb"===e.slice(0,3)?se(this._rgb):"hsl"===e.slice(0,3)?L(this.hsl(),this.alpha()):void 0},p.named=function(e){return R(Ce[e])},h.push({p:5,test:function(e){if(1===arguments.length&&null!=Ce[e])return"named"}}),n.prototype.name=function(e){var t,n;for(n in arguments.length&&(Ce[e]&&(this._rgb=R(Ce[e])),this._rgb[3]=1),t=this.hex("rgb"),Ce)if(t===Ce[n])return n;return t},W=function(){var e,t,n,i;return n=(i=Me(arguments))[0],e=i[1],t=i[2],[n,M(t*=r)*e,xe(t)*e]},q=function(){var e,t,n,i,r,s,o,a,l;return o=(n=Me(arguments))[0],r=n[1],s=n[2],e=(a=W(o,r,s))[0],t=a[1],i=a[2],[(l=G(e,t,i))[0],l[1],i=l[2],n.length>3?n[3]:1]},$=function(){var e,t,n,i,r,s;return r=(s=Me(arguments))[0],e=s[1],t=s[2],n=we(e*e+t*t),i=(g(t,e)*l+360)%360,0===ye(1e4*n)&&(i=Number.NaN),[r,n,i]},de=function(){var e,t,n,i,r,s,o;return r=(s=Me(arguments))[0],n=s[1],t=s[2],i=(o=he(r,n,t))[0],e=o[1],t=o[2],$(i,e,t)},w.lch=function(){var e;return e=Me(arguments),new n(e,"lch")},w.hcl=function(){var e;return e=Me(arguments),new n(e,"hcl")},p.lch=q,p.hcl=function(){var e,t,n,i;return t=(i=Me(arguments))[0],e=i[1],n=i[2],q([n,e,t])},n.prototype.lch=function(){return de(this._rgb)},n.prototype.hcl=function(){return de(this._rgb).reverse()},re=function(e){var t,n,i,r,s,o;return null==e&&(e="rgb"),s=(o=Me(arguments))[0],i=o[1],t=o[2],i/=255,t/=255,[(1-(s/=255)-(r=1-Math.max(s,Math.max(i,t))))*(n=r<1?1/(1-r):0),(1-i-r)*n,(1-t-r)*n,r]},A=function(){var e,t,n,i,r,s;return n=(t=Me(arguments))[0],r=t[1],s=t[2],i=t[3],e=t.length>4?t[4]:1,1===i?[0,0,0,e]:[n>=1?0:255*(1-n)*(1-i),r>=1?0:255*(1-r)*(1-i),s>=1?0:255*(1-s)*(1-i),e]},p.cmyk=function(){return A(Me(arguments))},w.cmyk=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["cmyk"]),(function(){}))},n.prototype.cmyk=function(){return re(this._rgb)},p.gl=function(){var e,t,n,i,r;for(i=function(){var e,n;for(t in n=[],e=Me(arguments))r=e[t],n.push(r);return n}.apply(this,arguments),e=n=0;n<=2;e=++n)i[e]*=255;return i},w.gl=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["gl"]),(function(){}))},n.prototype.gl=function(){var e;return[(e=this._rgb)[0]/255,e[1]/255,e[2]/255,e[3]]},pe=function(e,t,n){var i;return e=(i=Me(arguments))[0],t=i[1],n=i[2],.2126*(e=Z(e))+.7152*(t=Z(t))+.0722*Z(n)},Z=function(e){return(e/=255)<=.03928?e/12.92:ie((e+.055)/1.055,2.4)},H=function(e,t,i,r){var s,o;return s=e._rgb,o=t._rgb,new n(s[0]+i*(o[0]-s[0]),s[1]+i*(o[1]-s[1]),s[2]+i*(o[2]-s[2]),r)},f.push(["rgb",H]),n.prototype.luminance=function(e,t){var n,i,r,s;return null==t&&(t="rgb"),arguments.length?(r=this._rgb,0===e?r=[0,0,0,this._rgb[3]]:1===e?r=[255,255,255,this[3]]:(n=pe(this._rgb),i=20,s=function(n,r){var o,a;return o=(a=n.interpolate(r,.5,t)).luminance(),Math.abs(e-o)<1e-7||!i--?a:o>e?s(n,a):s(a,r)},r=n>e?s(w("black"),this).rgba():s(this,w("white")).rgba()),w(r).alpha(this.alpha())):pe(this._rgb)},Se=function(e){var t,n,i,r;return(r=e/100)<66?(i=255,n=-155.25485562709179-.44596950469579133*(n=r-2)+104.49216199393888*K(n),t=r<20?0:.8274096064007395*(t=r-10)-254.76935184120902+115.67994401066147*K(t)):(i=351.97690566805693+.114206453784165*(i=r-55)-40.25366309332127*K(i),n=325.4494125711974+.07943456536662342*(n=r-50)-28.0852963507957*K(n),t=255),[i,n,t]},me=function(){var e,t,n,i,r,s,o;for(i=(r=Me(arguments))[0],r[1],e=r[2],n=1e3,t=4e4;t-n>.4;)(s=Se(o=.5*(t+n)))[2]/s[0]>=e/i?t=o:n=o;return ye(o)},w.temperature=w.kelvin=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["temperature"]),(function(){}))},p.temperature=p.kelvin=p.K=Se,n.prototype.temperature=function(){return me(this._rgb)},n.prototype.kelvin=n.prototype.temperature,w.contrast=function(e,t){var i,r,s,o;return"string"!==(s=Ae(e))&&"number"!==s||(e=new n(e)),"string"!==(o=Ae(t))&&"number"!==o||(t=new n(t)),(i=e.luminance())>(r=t.luminance())?(i+.05)/(r+.05):(r+.05)/(i+.05)},w.distance=function(e,t,i){var r,s,o,a,l,c,u;for(s in null==i&&(i="lab"),"string"!==(l=Ae(e))&&"number"!==l||(e=new n(e)),"string"!==(c=Ae(t))&&"number"!==c||(t=new n(t)),o=e.get(i),a=t.get(i),u=0,o)u+=(r=(o[s]||0)-(a[s]||0))*r;return Math.sqrt(u)},w.deltaE=function(e,t,i,r){var s,a,l,c,u,h,d,p,f,_,v,y,b,x,w,S,A,C,T,E,P,I,k,R;for(null==i&&(i=1),null==r&&(r=1),"string"!==(w=Ae(e))&&"number"!==w||(e=new n(e)),"string"!==(S=Ae(t))&&"number"!==S||(t=new n(t)),s=(A=e.lab())[0],l=A[1],u=A[2],a=(C=t.lab())[0],c=C[1],h=C[2],d=we(l*l+u*u),p=we(c*c+h*h),E=s<16?.511:.040975*s/(1+.01765*s),T=.0638*d/(1+.0131*d)+.638,x=d<1e-6?0:180*g(u,l)/o;x<0;)x+=360;for(;x>=360;)x-=360;return P=x>=164&&x<=345?.56+m(.2*M(o*(x+168)/180)):.36+m(.4*M(o*(x+35)/180)),b=we((f=d*d*d*d)/(f+1900)),we((I=(s-a)/(i*E))*I+(k=(y=d-p)/(r*T))*k+((_=l-c)*_+(v=u-h)*v-y*y)/((R=T*(b*P+1-b))*R))},n.prototype.get=function(e){var t,n,i,r,s;return i=(r=e.split("."))[0],t=r[1],s=this[i](),t?(n=i.indexOf(t))>-1?s[n]:console.warn("unknown channel "+t+" in mode "+i):s},n.prototype.set=function(e,t){var n,i,r,s,o;if(r=(s=e.split("."))[0],n=s[1])if(o=this[r](),(i=r.indexOf(n))>-1)if("string"===Ae(t))switch(t.charAt(0)){case"+":case"-":o[i]+=+t;break;case"*":o[i]*=+t.substr(1);break;case"/":o[i]/=+t.substr(1);break;default:o[i]=+t}else o[i]=t;else console.warn("unknown channel "+n+" in mode "+r);else o=t;return w(o,r).alpha(this.alpha())},n.prototype.clipped=function(){return this._rgb._clipped||!1},n.prototype.alpha=function(e){return arguments.length?w.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},n.prototype.darken=function(e){var t;return null==e&&(e=1),(t=this.lab())[0]-=s.Kn*e,w.lab(t).alpha(this.alpha())},n.prototype.brighten=function(e){return null==e&&(e=1),this.darken(-e)},n.prototype.darker=n.prototype.darken,n.prototype.brighter=n.prototype.brighten,n.prototype.saturate=function(e){var t;return null==e&&(e=1),(t=this.lch())[1]+=e*s.Kn,t[1]<0&&(t[1]=0),w.lch(t).alpha(this.alpha())},n.prototype.desaturate=function(e){return null==e&&(e=1),this.saturate(-e)},n.prototype.premultiply=function(){var e,t;return t=this.rgb(),e=this.alpha(),w(t[0]*e,t[1]*e,t[2]*e,e)},ee=function(e,t){return e*t/255},T=function(e,t){return e>t?t:e},X=function(e,t){return e>t?e:t},be=function(e,t){return 255*(1-(1-e/255)*(1-t/255))},ne=function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))},x=function(e,t){return 255*(1-(1-t/255)/(e/255))},E=function(e,t){return 255===e||(e=t/255*255/(1-e/255))>255?255:e},(v=function(e,t,n){if(!v[n])throw"unknown blend mode "+n;return v[n](e,t)}).normal=(y=function(e){return function(t,n){var i,r;return i=w(n).rgb(),r=w(t).rgb(),w(e(i,r),"rgb")}})((P=function(e){return function(t,n){var i,r,s;for(s=[],i=r=0;r<=3;i=++r)s[i]=e(t[i],n[i]);return s}})((function(e,t){return e}))),v.multiply=y(P(ee)),v.screen=y(P(be)),v.overlay=y(P(ne)),v.darken=y(P(T)),v.lighten=y(P(X)),v.dodge=y(P(E)),v.burn=y(P(x)),w.blend=v,w.analyze=function(e){var t,n,i,r;for(i={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},n=0,t=e.length;n<t;n++)null==(r=e[n])||isNaN(r)||(i.values.push(r),i.sum+=r,r<i.min&&(i.min=r),r>i.max&&(i.max=r),i.count+=1);return i.domain=[i.min,i.max],i.limits=function(e,t){return w.limits(i,e,t)},i},w.scale=function(e,t){var n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,S;return u="rgb",h=w("#ccc"),m=0,o=[0,1],f=[],p=[0,0],n=!1,r=[],d=!1,c=0,l=1,s=!1,i={},g=!0,a=1,x=function(e){var t,n,i,s,o,a;if(null==e&&(e=["#fff","#000"]),null!=e&&"string"===Ae(e)&&null!=w.brewer&&(e=w.brewer[e]||w.brewer[e.toLowerCase()]||e),"array"===Ae(e)){for(1===e.length&&(e=[e[0],e[0]]),t=i=0,s=(e=e.slice(0)).length-1;0<=s?i<=s:i>=s;t=0<=s?++i:--i)n=e[t],"string"===Ae(n)&&(e[t]=w(n));for(f.length=0,t=a=0,o=e.length-1;0<=o?a<=o:a>=o;t=0<=o?++a:--a)f.push(t/(e.length-1))}return b(),r=e},v=function(e){var t,i;if(null!=n){for(i=n.length-1,t=0;t<i&&e>=n[t];)t++;return t-1}return 0},S=function(e){return e},y=function(e,t){var s,o,d,m,_,y,b;if(null==t&&(t=!1),isNaN(e)||null===e)return h;if(b=t?e:n&&n.length>2?v(e)/(n.length-2):l!==c?(e-c)/(l-c):1,t||(b=S(b)),1!==a&&(b=ie(b,a)),b=p[0]+b*(1-p[0]-p[1]),b=Math.min(1,Math.max(0,b)),d=Math.floor(1e4*b),g&&i[d])s=i[d];else{if("array"===Ae(r))for(o=m=0,y=f.length-1;0<=y?m<=y:m>=y;o=0<=y?++m:--m){if(b<=(_=f[o])){s=r[o];break}if(b>=_&&o===f.length-1){s=r[o];break}if(b>_&&b<f[o+1]){b=(b-_)/(f[o+1]-_),s=w.interpolate(r[o],r[o+1],b,u);break}}else"function"===Ae(r)&&(s=r(b));g&&(i[d]=s)}return s},b=function(){return i={}},x(e),(_=function(e){var t;return t=w(y(e)),d&&t[d]?t[d]():t}).classes=function(e){var t;return null!=e?("array"===Ae(e)?(n=e,o=[e[0],e[e.length-1]]):(t=w.analyze(o),n=0===e?[t.min,t.max]:w.limits(t,"e",e)),_):n},_.domain=function(e){var t,n,i,s,a,u,h;if(!arguments.length)return o;if(c=e[0],l=e[e.length-1],f=[],i=r.length,e.length===i&&c!==l)for(a=0,s=e.length;a<s;a++)n=e[a],f.push((n-c)/(l-c));else for(t=h=0,u=i-1;0<=u?h<=u:h>=u;t=0<=u?++h:--h)f.push(t/(i-1));return o=[c,l],_},_.mode=function(e){return arguments.length?(u=e,b(),_):u},_.range=function(e,t){return x(e),_},_.out=function(e){return d=e,_},_.spread=function(e){return arguments.length?(m=e,_):m},_.correctLightness=function(e){return null==e&&(e=!0),s=e,b(),S=s?function(e){var t,n,i,r,s,o,a,l;for(o=(t=y(0,!0).lab()[0])>(n=y(1,!0).lab()[0]),i=y(e,!0).lab()[0]-(r=t+(n-t)*e),a=0,l=1,s=20;Math.abs(i)>.01&&s-- >0;)o&&(i*=-1),i<0?(a=e,e+=.5*(l-e)):(l=e,e+=.5*(a-e)),i=y(e,!0).lab()[0]-r;return e}:function(e){return e},_},_.padding=function(e){return null!=e?("number"===Ae(e)&&(e=[e,e]),p=e,_):p},_.colors=function(t,i){var s,a,l,c,u,h,d,p;if(arguments.length<2&&(i="hex"),u=[],0===arguments.length)u=r.slice(0);else if(1===t)u=[_(.5)];else if(t>1)a=o[0],s=o[1]-a,u=function(){h=[];for(var e=0;0<=t?e<t:e>t;0<=t?e++:e--)h.push(e);return h}.apply(this).map((function(e){return _(a+e/(t-1)*s)}));else{if(e=[],d=[],n&&n.length>2)for(l=p=1,c=n.length;1<=c?p<c:p>c;l=1<=c?++p:--p)d.push(.5*(n[l-1]+n[l]));else d=o;u=d.map((function(e){return _(e)}))}return w[i]&&(u=u.map((function(e){return e[i]()}))),u},_.cache=function(e){return null!=e?(g=e,_):g},_.gamma=function(e){return null!=e?(a=e,_):a},_.nodata=function(e){return null!=e?(h=w(e),_):h},_},null==w.scales&&(w.scales={}),w.scales.cool=function(){return w.scale([w.hsl(180,1,.9),w.hsl(250,.7,.4)])},w.scales.hot=function(){return w.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},w.analyze=function(e,t,n){var i,r,s,o,a,l;if(a={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==n&&(n=function(){return!0}),i=function(e){null==e||isNaN(e)||(a.values.push(e),a.sum+=e,e<a.min&&(a.min=e),e>a.max&&(a.max=e),a.count+=1)},l=function(e,r){if(n(e,r))return null!=t&&"function"===Ae(t)?i(t(e)):null!=t&&"string"===Ae(t)||"number"===Ae(t)?i(e[t]):i(e)},"array"===Ae(e))for(o=0,s=e.length;o<s;o++)l(e[o]);else for(r in e)l(e[r],r);return a.domain=[a.min,a.max],a.limits=function(e,t){return w.limits(a,e,t)},a},w.limits=function(e,t,n){var i,r,s,o,a,l,c,u,h,d,p,f,g,_,v,y,b,x,S,A,M,C,T,E,P,k,R,D,L,O,N,F,B,U,z,V,H,$,G,j,W,q,X,Y,Z,Q,ee,te,ne,re,se,oe,ae,le,ce;if(null==t&&(t="equal"),null==n&&(n=7),"array"===Ae(e)&&(e=w.analyze(e)),P=e.min,J=e.max,e.sum,le=e.values.sort((function(e,t){return e-t})),1===n)return[P,J];if(T=[],"c"===t.substr(0,1)&&(T.push(P),T.push(J)),"e"===t.substr(0,1)){for(T.push(P),A=N=1,z=n-1;1<=z?N<=z:N>=z;A=1<=z?++N:--N)T.push(P+A/n*(J-P));T.push(J)}else if("l"===t.substr(0,1)){if(P<=0)throw"Logarithmic scales are only possible for values > 0";for(k=Math.LOG10E*K(P),E=Math.LOG10E*K(J),T.push(P),A=ce=1,V=n-1;1<=V?ce<=V:ce>=V;A=1<=V?++ce:--ce)T.push(ie(10,k+A/n*(E-k)));T.push(J)}else if("q"===t.substr(0,1)){for(T.push(P),A=i=1,q=n-1;1<=q?i<=q:i>=q;A=1<=q?++i:--i)F=(le.length-1)*A/n,(B=I(F))===F?T.push(le[B]):(U=F-B,T.push(le[B]*(1-U)+le[B+1]*U));T.push(J)}else if("k"===t.substr(0,1)){for(D=le.length,_=new Array(D),x=new Array(n),re=!0,L=0,y=null,(y=[]).push(P),A=r=1,X=n-1;1<=X?r<=X:r>=X;A=1<=X?++r:--r)y.push(P+A/n*(J-P));for(y.push(J);re;){for(M=s=0,Y=n-1;0<=Y?s<=Y:s>=Y;M=0<=Y?++s:--s)x[M]=0;for(A=o=0,Z=D-1;0<=Z?o<=Z:o>=Z;A=0<=Z?++o:--o){for(ae=le[A],R=Number.MAX_VALUE,M=a=0,Q=n-1;0<=Q?a<=Q:a>=Q;M=0<=Q?++a:--a)(S=m(y[M]-ae))<R&&(R=S,v=M);x[v]++,_[A]=v}for(O=new Array(n),M=l=0,ee=n-1;0<=ee?l<=ee:l>=ee;M=0<=ee?++l:--l)O[M]=null;for(A=c=0,te=D-1;0<=te?c<=te:c>=te;A=0<=te?++c:--c)null===O[b=_[A]]?O[b]=le[A]:O[b]+=le[A];for(M=u=0,ne=n-1;0<=ne?u<=ne:u>=ne;M=0<=ne?++u:--u)O[M]*=1/x[M];for(re=!1,M=h=0,H=n-1;0<=H?h<=H:h>=H;M=0<=H?++h:--h)if(O[M]!==y[A]){re=!0;break}y=O,++L>200&&(re=!1)}for(C={},M=d=0,$=n-1;0<=$?d<=$:d>=$;M=0<=$?++d:--d)C[M]=[];for(A=p=0,G=D-1;0<=G?p<=G:p>=G;A=0<=G?++p:--p)C[b=_[A]].push(le[A]);for(se=[],M=f=0,j=n-1;0<=j?f<=j:f>=j;M=0<=j?++f:--f)se.push(C[M][0]),se.push(C[M][C[M].length-1]);for(se=se.sort((function(e,t){return e-t})),T.push(se[0]),A=g=1,W=se.length-1;g<=W;A=g+=2)oe=se[A],isNaN(oe)||-1!==T.indexOf(oe)||T.push(oe)}return T},D=function(e,t,n){var i,r,s,o;return e=(i=Me(arguments))[0],t=i[1],n=i[2],isNaN(e)&&(e=0),(e/=360)<1/3?s=1-((r=(1-t)/3)+(o=(1+t*M(c*e)/M(a-c*e))/3)):e<2/3?r=1-((o=(1-t)/3)+(s=(1+t*M(c*(e-=1/3))/M(a-c*e))/3)):o=1-((s=(1-t)/3)+(r=(1+t*M(c*(e-=2/3))/M(a-c*e))/3)),[255*(o=Y(n*o*3)),255*(s=Y(n*s*3)),255*(r=Y(n*r*3)),i.length>3?i[3]:1]},le=function(){var e,t,n,i,r,s,o;return r=(s=Me(arguments))[0],t=s[1],e=s[2],c=2*Math.PI,r/=255,t/=255,e/=255,0==(o=1-Math.min(r,t,e)/(i=(r+t+e)/3))?n=0:(n=(r-t+(r-e))/2,n/=Math.sqrt((r-t)*(r-t)+(r-e)*(t-e)),n=Math.acos(n),e>t&&(n=c-n),n/=c),[360*n,o,i]},w.hsi=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Pe.call(arguments).concat(["hsi"]),(function(){}))},p.hsi=D,n.prototype.hsi=function(){return le(this._rgb)},B=function(e,t,n,i){var r,s,o,a,l,c,u,h,d,p;return"hsl"===i?(d=e.hsl(),p=t.hsl()):"hsv"===i?(d=e.hsv(),p=t.hsv()):"hcg"===i?(d=e.hcg(),p=t.hcg()):"hsi"===i?(d=e.hsi(),p=t.hsi()):"lch"!==i&&"hcl"!==i||(i="hcl",d=e.hcl(),p=t.hcl()),"h"===i.substr(0,1)&&(s=d[0],u=d[1],a=d[2],o=p[0],h=p[1],l=p[2]),isNaN(s)||isNaN(o)?isNaN(s)?isNaN(o)?r=Number.NaN:(r=o,1!==a&&0!==a||"hsv"===i||(c=h)):(r=s,1!==l&&0!==l||"hsv"===i||(c=u)):r=s+n*(o>s&&o-s>180?o-(s+360):o<s&&s-o>180?o+360-s:o-s),null==c&&(c=u+n*(h-u)),w[i](r,c,a+n*(l-a))},V=function(e,t,n,i){var r,s;return r=e.num(),s=t.num(),w.num(r+(s-r)*n,"num")},(f=f.concat(function(){var e,t,n,i;for(i=[],t=0,e=(n=["hsv","hsl","hsi","hcl","lch","hcg"]).length;t<e;t++)Q=n[t],i.push([Q,B]);return i}())).push(["num",V]),U=function(e,t,i,r){var s,o;return s=e.lab(),o=t.lab(),new n(s[0]+i*(o[0]-s[0]),s[1]+i*(o[1]-s[1]),s[2]+i*(o[2]-s[2]),r)},f.push(["lab",U])}.call(this)},742:e=>{e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var s=this[r][0];"number"==typeof s&&(i[s]=!0)}for(r=0;r<t.length;r++){var o=t[r];"number"==typeof o[0]&&i[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},2812:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.extend(e.expr.pseudos,{data:e.expr.createPseudo((function(t){return function(n){return!!e.data(n,t)}}))})})?i.apply(t,r):i)||(e.exports=s)}()},1677:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.fn.extend({disableSelection:(t="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(t+".ui-disableSelection",(function(e){e.preventDefault()}))}),enableSelection:function(){return this.off(".ui-disableSelection")}});var t})?i.apply(t,r):i)||(e.exports=s)}()},2402:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.ui.focusable=function(t,n){var i,r,s,o,a,l=t.nodeName.toLowerCase();return"area"===l?(r=(i=t.parentNode).name,!(!t.href||!r||"map"!==i.nodeName.toLowerCase())&&(s=e("img[usemap='#"+r+"']")).length>0&&s.is(":visible")):(/^(input|select|textarea|button|object)$/.test(l)?(o=!t.disabled)&&(a=e(t).closest("fieldset")[0])&&(o=!a.disabled):o="a"===l&&t.href||n,o&&e(t).is(":visible")&&"visible"===e(t).css("visibility"))},e.extend(e.expr.pseudos,{focusable:function(t){return e.ui.focusable(t,null!=e.attr(t,"tabindex"))}}),e.ui.focusable})?i.apply(t,r):i)||(e.exports=s)}()},9996:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.ui.formResetMixin={_formResetHandler:function(){var t=e(this);setTimeout((function(){var n=t.data("ui-form-reset-instances");e.each(n,(function(){this.refresh()}))}))},_bindFormResetHandler:function(){if(this.form=e(this.element.prop("form")),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var t=this.form.data("ui-form-reset-instances");t.splice(e.inArray(this,t),1),t.length?this.form.data("ui-form-reset-instances",t):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}}})?i.apply(t,r):i)||(e.exports=s)}()},7584:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}})?i.apply(t,r):i)||(e.exports=s)}()},4915:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.fn.labels=function(){var e,t,n,i,r;return this.length?this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(i=this.eq(0).parents("label"),(n=this.attr("id"))&&(r=(e=this.eq(0).parents().last()).add(e.length?e.siblings():this.siblings()),t="label[for='"+CSS.escape(n)+"']",i=i.add(r.find(t).addBack(t))),this.pushStack(i)):this.pushStack([])}})?i.apply(t,r):i)||(e.exports=s)}()},9587:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],i=function(e){return e.ui.plugin={add:function(t,n,i){var r,s=e.ui[t].prototype;for(r in i)s.plugins[r]=s.plugins[r]||[],s.plugins[r].push([n,i[r]])},call:function(e,t,n,i){var r,s=e.plugins[t];if(s&&(i||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(r=0;r<s.length;r++)e.options[s[r][0]]&&s[r][1].apply(e.element,n)}}},void 0===(s=i.apply(t,r))||(e.exports=s)}()},8075:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],i=function(e){return function(){var t,n=Math.max,i=Math.abs,r=/left|center|right/,s=/top|center|bottom/,o=/[\+\-]\d+(\.[\d]+)?%?/,a=/^\w+/,l=/%$/,c=e.fn.position;function u(e,t,n){return[parseFloat(e[0])*(l.test(e[0])?t/100:1),parseFloat(e[1])*(l.test(e[1])?n/100:1)]}function h(t,n){return parseInt(e.css(t,n),10)||0}function d(e){return null!=e&&e===e.window}e.position={scrollbarWidth:function(){if(void 0!==t)return t;var n,i,r=e("<div style='display:block;position:absolute;width:200px;height:200px;overflow:hidden;'><div style='height:300px;width:auto;'></div></div>"),s=r.children()[0];return e("body").append(r),n=s.offsetWidth,r.css("overflow","scroll"),n===(i=s.offsetWidth)&&(i=r[0].clientWidth),r.remove(),t=n-i},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),i=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),r="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth;return{width:"scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=d(n[0]),r=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:r,offset:i||r?{left:0,top:0}:e(t).offset(),scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:n.outerWidth(),height:n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);var l,p,f,m,g,_,v,y,b="string"==typeof(t=e.extend({},t)).of?e(document).find(t.of):e(t.of),x=e.position.getWithinInfo(t.within),w=e.position.getScrollInfo(x),S=(t.collision||"flip").split(" "),A={};return _=9===(y=(v=b)[0]).nodeType?{width:v.width(),height:v.height(),offset:{top:0,left:0}}:d(y)?{width:v.width(),height:v.height(),offset:{top:v.scrollTop(),left:v.scrollLeft()}}:y.preventDefault?{width:0,height:0,offset:{top:y.pageY,left:y.pageX}}:{width:v.outerWidth(),height:v.outerHeight(),offset:v.offset()},b[0].preventDefault&&(t.at="left top"),p=_.width,f=_.height,m=_.offset,g=e.extend({},m),e.each(["my","at"],(function(){var e,n,i=(t[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):s.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=s.test(i[1])?i[1]:"center",e=o.exec(i[0]),n=o.exec(i[1]),A[this]=[e?e[0]:0,n?n[0]:0],t[this]=[a.exec(i[0])[0],a.exec(i[1])[0]]})),1===S.length&&(S[1]=S[0]),"right"===t.at[0]?g.left+=p:"center"===t.at[0]&&(g.left+=p/2),"bottom"===t.at[1]?g.top+=f:"center"===t.at[1]&&(g.top+=f/2),l=u(A.at,p,f),g.left+=l[0],g.top+=l[1],this.each((function(){var r,s,o=e(this),a=o.outerWidth(),c=o.outerHeight(),d=h(this,"marginLeft"),_=h(this,"marginTop"),v=a+d+h(this,"marginRight")+w.width,y=c+_+h(this,"marginBottom")+w.height,M=e.extend({},g),C=u(A.my,o.outerWidth(),o.outerHeight());"right"===t.my[0]?M.left-=a:"center"===t.my[0]&&(M.left-=a/2),"bottom"===t.my[1]?M.top-=c:"center"===t.my[1]&&(M.top-=c/2),M.left+=C[0],M.top+=C[1],r={marginLeft:d,marginTop:_},e.each(["left","top"],(function(n,i){e.ui.position[S[n]]&&e.ui.position[S[n]][i](M,{targetWidth:p,targetHeight:f,elemWidth:a,elemHeight:c,collisionPosition:r,collisionWidth:v,collisionHeight:y,offset:[l[0]+C[0],l[1]+C[1]],my:t.my,at:t.at,within:x,elem:o})})),t.using&&(s=function(e){var r=m.left-M.left,s=r+p-a,l=m.top-M.top,u=l+f-c,h={target:{element:b,left:m.left,top:m.top,width:p,height:f},element:{element:o,left:M.left,top:M.top,width:a,height:c},horizontal:s<0?"left":r>0?"right":"center",vertical:u<0?"top":l>0?"bottom":"middle"};p<a&&i(r+s)<p&&(h.horizontal="center"),f<c&&i(l+u)<f&&(h.vertical="middle"),n(i(r),i(s))>n(i(l),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),o.offset(e.extend(M,{using:s}))}))},e.ui.position={fit:{left:function(e,t){var i,r=t.within,s=r.isWindow?r.scrollLeft:r.offset.left,o=r.width,a=e.left-t.collisionPosition.marginLeft,l=s-a,c=a+t.collisionWidth-o-s;t.collisionWidth>o?l>0&&c<=0?(i=e.left+l+t.collisionWidth-o-s,e.left+=l-i):e.left=c>0&&l<=0?s:l>c?s+o-t.collisionWidth:s:l>0?e.left+=l:c>0?e.left-=c:e.left=n(e.left-a,e.left)},top:function(e,t){var i,r=t.within,s=r.isWindow?r.scrollTop:r.offset.top,o=t.within.height,a=e.top-t.collisionPosition.marginTop,l=s-a,c=a+t.collisionHeight-o-s;t.collisionHeight>o?l>0&&c<=0?(i=e.top+l+t.collisionHeight-o-s,e.top+=l-i):e.top=c>0&&l<=0?s:l>c?s+o-t.collisionHeight:s:l>0?e.top+=l:c>0?e.top-=c:e.top=n(e.top-a,e.top)}},flip:{left:function(e,t){var n,r,s=t.within,o=s.offset.left+s.scrollLeft,a=s.width,l=s.isWindow?s.scrollLeft:s.offset.left,c=e.left-t.collisionPosition.marginLeft,u=c-l,h=c+t.collisionWidth-a-l,d="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];u<0?((n=e.left+d+p+f+t.collisionWidth-a-o)<0||n<i(u))&&(e.left+=d+p+f):h>0&&((r=e.left-t.collisionPosition.marginLeft+d+p+f-l)>0||i(r)<h)&&(e.left+=d+p+f)},top:function(e,t){var n,r,s=t.within,o=s.offset.top+s.scrollTop,a=s.height,l=s.isWindow?s.scrollTop:s.offset.top,c=e.top-t.collisionPosition.marginTop,u=c-l,h=c+t.collisionHeight-a-l,d="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,p="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,f=-2*t.offset[1];u<0?((r=e.top+d+p+f+t.collisionHeight-a-o)<0||r<i(u))&&(e.top+=d+p+f):h>0&&((n=e.top-t.collisionPosition.marginTop+d+p+f-l)>0||i(n)<h)&&(e.top+=d+p+f)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.ui.position},void 0===(s=i.apply(t,r))||(e.exports=s)}()},2362:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.fn.scrollParent=function(t){var n=this.css("position"),i="absolute"===n,r=t?/(auto|scroll|hidden)/:/(auto|scroll)/,s=this.parents().filter((function(){var t=e(this);return(!i||"static"!==t.css("position"))&&r.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))})).eq(0);return"fixed"!==n&&s.length?s:e(this[0].ownerDocument||document)}})?i.apply(t,r):i)||(e.exports=s)}()},7819:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642),n(2402)],void 0===(s="function"==typeof(i=function(e){return e.extend(e.expr.pseudos,{tabbable:function(t){var n=e.attr(t,"tabindex"),i=null!=n;return(!i||n>=0)&&e.ui.focusable(t,i)}})})?i.apply(t,r):i)||(e.exports=s)}()},2121:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(e){return e.fn.extend({uniqueId:(t=0,function(){return this.each((function(){this.id||(this.id="ui-id-"+ ++t)}))}),removeUniqueId:function(){return this.each((function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")}))}});var t})?i.apply(t,r):i)||(e.exports=s)}()},1642:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929)],void 0===(s="function"==typeof(i=function(e){return e.ui=e.ui||{},e.ui.version="1.14.1"})?i.apply(t,r):i)||(e.exports=s)}()},2628:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],i=function(e){var t,n=0,i=Array.prototype.hasOwnProperty,r=Array.prototype.slice;return e.cleanData=(t=e.cleanData,function(n){var i,r,s;for(s=0;null!=(r=n[s]);s++)(i=e._data(r,"events"))&&i.remove&&e(r).triggerHandler("remove");t(n)}),e.widget=function(t,n,i){var r,s,o,a={},l=t.split(".")[0];if("__proto__"===(t=t.split(".")[1])||"constructor"===t)return e.error("Invalid widget name: "+t);var c=l+"-"+t;return i||(i=n,n=e.Widget),Array.isArray(i)&&(i=e.extend.apply(null,[{}].concat(i))),e.expr.pseudos[c.toLowerCase()]=function(t){return!!e.data(t,c)},e[l]=e[l]||{},r=e[l][t],s=e[l][t]=function(e,t){if(!this||!this._createWidget)return new s(e,t);arguments.length&&this._createWidget(e,t)},e.extend(s,r,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),(o=new n).options=e.widget.extend({},o.options),e.each(i,(function(e,t){a[e]="function"==typeof t?function(){function i(){return n.prototype[e].apply(this,arguments)}function r(t){return n.prototype[e].apply(this,t)}return function(){var e,n=this._super,s=this._superApply;return this._super=i,this._superApply=r,e=t.apply(this,arguments),this._super=n,this._superApply=s,e}}():t})),s.prototype=e.widget.extend(o,{widgetEventPrefix:r&&o.widgetEventPrefix||t},a,{constructor:s,namespace:l,widgetName:t,widgetFullName:c}),r?(e.each(r._childConstructors,(function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,s,n._proto)})),delete r._childConstructors):n._childConstructors.push(s),e.widget.bridge(t,s),s},e.widget.extend=function(t){for(var n,s,o=r.call(arguments,1),a=0,l=o.length;a<l;a++)for(n in o[a])s=o[a][n],i.call(o[a],n)&&void 0!==s&&(e.isPlainObject(s)?t[n]=e.isPlainObject(t[n])?e.widget.extend({},t[n],s):e.widget.extend({},s):t[n]=s);return t},e.widget.bridge=function(t,n){var i=n.prototype.widgetFullName||t;e.fn[t]=function(s){var o="string"==typeof s,a=r.call(arguments,1),l=this;return o?this.length||"instance"!==s?this.each((function(){var n,r=e.data(this,i);return"instance"===s?(l=r,!1):r?"function"!=typeof r[s]||"_"===s.charAt(0)?e.error("no such method '"+s+"' for "+t+" widget instance"):(n=r[s].apply(r,a))!==r&&void 0!==n?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0:e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+s+"'")})):l=void 0:(a.length&&(s=e.widget.extend.apply(null,[s].concat(a))),this.each((function(){var t=e.data(this,i);t?(t.option(s||{}),t._init&&t._init()):e.data(this,i,new n(s,this))}))),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,(function(e,n){t._removeClass(n,e)})),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var i,r,s,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},i=t.split("."),t=i.shift(),i.length){for(r=o[t]=e.widget.extend({},this.options[t]),s=0;s<i.length-1;s++)r[i[s]]=r[i[s]]||{},r=r[i[s]];if(t=i.pop(),1===arguments.length)return void 0===r[t]?null:r[t];r[t]=n}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=n}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var n,i,r;for(n in t)r=this.classesElementLookup[n],t[n]!==this.options.classes[n]&&r&&r.length&&(i=e(r.get()),this._removeClass(r,n),i.addClass(this._classes({element:i,keys:n,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){var n=[],i=this;function r(){var n=[];t.element.each((function(t,r){e.map(i.classesElementLookup,(function(e){return e})).some((function(e){return e.is(r)}))||n.push(r)})),i._on(e(n),{remove:"_untrackClassesElement"})}function s(s,o){var a,l;for(l=0;l<s.length;l++)a=i.classesElementLookup[s[l]]||e(),t.add?(r(),a=e(e.uniqueSort(a.get().concat(t.element.get())))):a=e(a.not(t.element).get()),i.classesElementLookup[s[l]]=a,n.push(s[l]),o&&t.classes[s[l]]&&n.push(t.classes[s[l]])}return(t=e.extend({element:this.element,classes:this.options.classes||{}},t)).keys&&s(t.keys.match(/\S+/g)||[],!0),t.extra&&s(t.extra.match(/\S+/g)||[]),n.join(" ")},_untrackClassesElement:function(t){var n=this;e.each(n.classesElementLookup,(function(i,r){-1!==e.inArray(t.target,r)&&(n.classesElementLookup[i]=e(r.not(t.target).get()))})),this._off(e(t.target))},_removeClass:function(e,t,n){return this._toggleClass(e,t,n,!1)},_addClass:function(e,t,n){return this._toggleClass(e,t,n,!0)},_toggleClass:function(e,t,n,i){i="boolean"==typeof i?i:n;var r="string"==typeof e||null===e,s={extra:r?t:n,keys:r?e:t,element:r?this.element:e,add:i};return s.element.toggleClass(this._classes(s),i),this},_on:function(t,n,i){var r,s=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=r=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,r=this.widget()),e.each(i,(function(i,o){function a(){if(t||!0!==s.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof o?s[o]:o).apply(s,arguments)}"string"!=typeof o&&(a.guid=o.guid=o.guid||a.guid||e.guid++);var l=i.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+s.eventNamespace,u=l[2];u?r.on(c,u,a):n.on(c,a)}))},_off:function(t,n){n=(n||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(n),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var n=this;return setTimeout((function(){return("string"==typeof e?n[e]:e).apply(n,arguments)}),t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,n,i){var r,s,o=this.options[t];if(i=i||{},(n=e.Event(n)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(r in s)r in n||(n[r]=s[r]);return this.element.trigger(n,i),!("function"==typeof o&&!1===o.apply(this.element[0],[n].concat(i))||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},(function(t,n){e.Widget.prototype["_"+t]=function(i,r,s){var o;"string"==typeof r&&(r={effect:r});var a=r?!0===r||"number"==typeof r?n:r.effect||n:t;"number"==typeof(r=r||{})?r={duration:r}:!0===r&&(r={}),o=!e.isEmptyObject(r),r.complete=s,r.delay&&i.delay(r.delay),o&&e.effects&&e.effects.effect[a]?i[t](r):a!==t&&i[a]?i[a](r.duration,r.easing,s):i.queue((function(n){e(this)[t](),s&&s.call(i[0]),n()}))}})),e.widget},void 0===(s=i.apply(t,r))||(e.exports=s)}()},9998:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(8958),n(3492),n(7584),n(2628)],i=function(e){var t;return e.widget("ui.button",{version:"1.14.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var e,t=this._super()||{};return this.isInput=this.element.is("input"),null!=(e=this.element[0].disabled)&&(t.disabled=e),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(t.label=this.originalLabel),t},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(t){t.keyCode===e.ui.keyCode.SPACE&&(t.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(t,n){var i="iconPosition"!==t,r=i?this.options.iconPosition:n,s="top"===r||"bottom"===r;this.icon?i&&this._removeClass(this.icon,null,this.options.icon):(this.icon=e("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),i&&this._addClass(this.icon,null,n),this._attachIcon(r),s?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(r))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(e){this.icon[/^(?:end|bottom)/.test(e)?"before":"after"](this.iconSpace)},_attachIcon:function(e){this.element[/^(?:end|bottom)/.test(e)?"append":"prepend"](this.icon)},_setOptions:function(e){var t=void 0===e.showLabel?this.options.showLabel:e.showLabel,n=void 0===e.icon?this.options.icon:e.icon;t||n||(e.showLabel=!0),this._super(e)},_setOption:function(e,t){"icon"===e&&(t?this._updateIcon(e,t):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===e&&this._updateIcon(e,t),"showLabel"===e&&(this._toggleClass("ui-button-icon-only",null,!t),this._updateTooltip()),"label"===e&&(this.isInput?this.element.val(t):(this.element.html(t),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(e,t),"disabled"===e&&(this._toggleClass(null,"ui-state-disabled",t),this.element[0].disabled=t,t&&this.element.trigger("blur"))},refresh:function(){var e=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOptions({disabled:e}),this._updateTooltip()}}),!0===e.uiBackCompat&&(e.widget("ui.button",e.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(e,t){"text"!==e?("showLabel"===e&&(this.options.text=t),"icon"===e&&(this.options.icons.primary=t),"icons"===e&&(t.primary?(this._super("icon",t.primary),this._super("iconPosition","beginning")):t.secondary&&(this._super("icon",t.secondary),this._super("iconPosition","end"))),this._superApply(arguments)):this._super("showLabel",t)}}),e.fn.button=(t=e.fn.button,function(n){var i="string"==typeof n,r=Array.prototype.slice.call(arguments,1),s=this;return i?this.length||"instance"!==n?this.each((function(){var t,i=e(this).attr("type"),o="checkbox"!==i&&"radio"!==i?"button":"checkboxradio",a=e.data(this,"ui-"+o);return"instance"===n?(s=a,!1):a?"function"!=typeof a[n]||"_"===n.charAt(0)?e.error("no such method '"+n+"' for button widget instance"):(t=a[n].apply(a,r))!==a&&void 0!==t?(s=t&&t.jquery?s.pushStack(t.get()):t,!1):void 0:e.error("cannot call methods on button prior to initialization; attempted to call method '"+n+"'")})):s=void 0:(r.length&&(n=e.widget.extend.apply(null,[n].concat(r))),this.each((function(){var i=e(this).attr("type"),r="checkbox"!==i&&"radio"!==i?"button":"checkboxradio",s=e.data(this,"ui-"+r);if(s)s.option(n||{}),s._init&&s._init();else{if("button"===r)return void t.call(e(this),n);e(this).checkboxradio(e.extend({icon:!1},n))}}))),s}),e.fn.buttonset=function(){return e.ui.controlgroup||e.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),e.ui.button},void 0===(s=i.apply(t,r))||(e.exports=s)}()},3492:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(9996),n(4915),n(2628)],void 0===(s="function"==typeof(i=function(e){return e.widget("ui.checkboxradio",[e.ui.formResetMixin,{version:"1.14.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var t,n,i,r=this._super()||{};return this._readType(),n=this.element.labels(),this.label=e(n[n.length-1]),this.label.length||e.error("No label found for checkboxradio widget"),this.originalLabel="",(i=this.label.contents().not(this.element[0])).length&&(this.originalLabel+=i.clone().wrapAll("<div></div>").parent().html()),this.originalLabel&&(r.label=this.originalLabel),null!=(t=this.element[0].disabled)&&(r.disabled=t),r},_create:function(){var e=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),e&&this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var t=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===t&&/radio|checkbox/.test(this.type)||e.error("Can't create checkboxradio on element.nodeName="+t+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var t=this.element[0].name,n="input[name='"+CSS.escape(t)+"']";return t?(this.form.length?e(this.form[0].elements).filter(n):e(n).filter((function(){return 0===e(e(this).prop("form")).length}))).not(this.element):e([])},_toggleClasses:function(){var t=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",t)._toggleClass(this.icon,null,"ui-icon-blank",!t),"radio"===this.type&&this._getRadioGroup().each((function(){var t=e(this).checkboxradio("instance");t&&t._removeClass(t.label,"ui-checkboxradio-checked","ui-state-active")}))},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(e,t){if("label"!==e||t){if(this._super(e,t),"disabled"===e)return this._toggleClass(this.label,null,"ui-state-disabled",t),void(this.element[0].disabled=t);this.refresh()}},_updateIcon:function(t){var n="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=e("<span>"),this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(n+=t?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,t?"ui-icon-blank":"ui-icon-check")):n+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",n),t||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var e=this.label.contents().not(this.element[0]);this.icon&&(e=e.not(this.icon[0])),this.iconSpace&&(e=e.not(this.iconSpace[0])),e.remove(),this.label.append(this.options.label)},refresh:function(){var e=this.element[0].checked,t=this.element[0].disabled;this._updateIcon(e),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),null!==this.options.label&&this._updateLabel(),t!==this.options.disabled&&this._setOptions({disabled:t})}}]),e.ui.checkboxradio})?i.apply(t,r):i)||(e.exports=s)}()},8958:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(2628)],void 0===(s="function"==typeof(i=function(e){var t=/ui-corner-([a-z]){2,6}/g;return e.widget("ui.controlgroup",{version:"1.14.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var t=this,n=[];e.each(this.options.items,(function(i,r){var s,o={};if(r)return"controlgroupLabel"===i?((s=t.element.find(r)).each((function(){var t=e(this);t.children(".ui-controlgroup-label-contents").length||t.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")})),t._addClass(s,null,"ui-widget ui-widget-content ui-state-default"),void(n=n.concat(s.get()))):void(e.fn[i]&&(o=t["_"+i+"Options"]?t["_"+i+"Options"]("middle"):{classes:{}},t.element.find(r).each((function(){var r=e(this),s=r[i]("instance"),a=e.widget.extend({},o);if("button"!==i||!r.parent(".ui-spinner").length){s||(s=r[i]()[i]("instance")),s&&(a.classes=t._resolveClassesValues(a.classes,s)),r[i](a);var l=r[i]("widget");e.data(l[0],"ui-controlgroup-data",s||r[i]("instance")),n.push(l[0])}}))))})),this.childWidgets=e(e.uniqueSort(n)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(t){this.childWidgets.each((function(){var n=e(this).data("ui-controlgroup-data");n&&n[t]&&n[t]()}))},_updateCornerClass:function(e,t){var n=this._buildSimpleOptions(t,"label").classes.label;this._removeClass(e,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(e,null,n)},_buildSimpleOptions:function(e,t){var n="vertical"===this.options.direction,i={classes:{}};return i.classes[t]={middle:"",first:"ui-corner-"+(n?"top":"left"),last:"ui-corner-"+(n?"bottom":"right"),only:"ui-corner-all"}[e],i},_spinnerOptions:function(e){var t=this._buildSimpleOptions(e,"ui-spinner");return t.classes["ui-spinner-up"]="",t.classes["ui-spinner-down"]="",t},_buttonOptions:function(e){return this._buildSimpleOptions(e,"ui-button")},_checkboxradioOptions:function(e){return this._buildSimpleOptions(e,"ui-checkboxradio-label")},_selectmenuOptions:function(e){var t="vertical"===this.options.direction;return{width:!!t&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(t?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(t?"top":"left")},last:{"ui-selectmenu-button-open":t?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(t?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[e]}},_resolveClassesValues:function(n,i){var r={};return e.each(n,(function(e){var s=i.options.classes[e]||"";s=String.prototype.trim.call(s.replace(t,"")),r[e]=(s+" "+n[e]).replace(/\s+/g," ")})),r},_setOption:function(e,t){"direction"===e&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(e,t),"disabled"!==e?this.refresh():this._callChildMethod(t?"disable":"enable")},refresh:function(){var t,n=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),t=this.childWidgets,this.options.onlyVisible&&(t=t.filter(":visible")),t.length&&(e.each(["first","last"],(function(e,i){var r=t[i]().data("ui-controlgroup-data");if(r&&n["_"+r.widgetName+"Options"]){var s=n["_"+r.widgetName+"Options"](1===t.length?"only":i);s.classes=n._resolveClassesValues(s.classes,r),r.element[r.widgetName](s)}else n._updateCornerClass(t[i](),i)})),this._callChildMethod("refresh"))}})})?i.apply(t,r):i)||(e.exports=s)}()},4374:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(9998),n(4719),n(191),n(3049),n(2402),n(7584),n(8075),n(7819),n(2121),n(1642),n(2628)],i=function(e){return e.widget("ui.dialog",{version:"1.14.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;n<0&&e(this).css("top",t.top-n)}},resizable:!0,show:null,title:null,uiDialogTitleHeadingLevel:0,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var n=this;this._isOpen&&!1!==this._trigger("beforeClose",t)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||e(this.document[0].activeElement).trigger("blur"),this._hide(this.uiDialog,this.options.hide,(function(){n._trigger("close",t)})))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,n){var i=!1,r=this.uiDialog.siblings(".ui-front:visible").map((function(){return+e(this).css("z-index")})).get(),s=Math.max.apply(null,r);return s>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",s+1),i=!0),i&&!n&&this._trigger("focus",t),i},open:function(){var t=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,(function(){t._focusTabbable(),t._trigger("focus")})),this._makeFocusTarget(),this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).trigger("focus")},_restoreTabbableFocus:function(){var t=this.document[0].activeElement;this.uiDialog[0]===t||e.contains(this.uiDialog[0],t)||this._focusTabbable()},_keepFocus:function(e){e.preventDefault(),this._restoreTabbableFocus()},_createWrapper:function(){this.uiDialog=e("<div>").hide().attr({tabIndex:-1,role:"dialog","aria-modal":this.options.modal?"true":null}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var n=this.uiDialog.find(":tabbable"),i=n.first(),r=n.last();t.target!==r[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==i[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay((function(){r.trigger("focus")})),t.preventDefault()):(this._delay((function(){i.trigger("focus")})),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:e("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}});var n=Number.isInteger(this.options.uiDialogTitleHeadingLevel)&&this.options.uiDialogTitleHeadingLevel>0&&this.options.uiDialogTitleHeadingLevel<=6?"h"+this.options.uiDialogTitleHeadingLevel:"span";t=e("<"+n+">").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(t,"ui-dialog-title"),this._title(t),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title?e.text(this.options.title):e.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var t=this,n=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(n)||Array.isArray(n)&&!n.length?this._removeClass(this.uiDialog,"ui-dialog-buttons"):(e.each(n,(function(n,i){var r,s;i="function"==typeof i?{click:i,text:n}:i,i=e.extend({type:"button"},i),r=i.click,s={icon:i.icon,iconPosition:i.iconPosition,showLabel:i.showLabel,icons:i.icons,text:i.text},delete i.click,delete i.icon,delete i.iconPosition,delete i.showLabel,delete i.icons,"boolean"==typeof i.text&&delete i.text,e("<button></button>",i).button(s).appendTo(t.uiButtonSet).on("click",(function(){r.apply(t.element[0],arguments)}))})),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var t=this,n=this.options;function i(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){t._addClass(e(this),"ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",n,i(r))},drag:function(e,n){t._trigger("drag",e,i(n))},stop:function(r,s){var o=s.offset.left-t.document.scrollLeft(),a=s.offset.top-t.document.scrollTop();n.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" top"+(a>=0?"+":"")+a,of:t.window},t._removeClass(e(this),"ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",r,i(s))}})},_makeResizable:function(){var t=this,n=this.options,i=n.resizable,r=this.uiDialog.css("position"),s="string"==typeof i?i:"n,e,s,w,se,sw,ne,nw";function o(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,i){t._addClass(e(this),"ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",n,o(i))},resize:function(e,n){t._trigger("resize",e,o(n))},stop:function(i,r){var s=t.uiDialog.offset(),a=s.left-t.document.scrollLeft(),l=s.top-t.document.scrollTop();n.height=t.uiDialog.height(),n.width=t.uiDialog.width(),n.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(l>=0?"+":"")+l,of:t.window},t._removeClass(e(this),"ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",i,o(r))}}).css("position",r)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),n=e.inArray(this,t);-1!==n&&t.splice(n,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var n=this,i=!1,r={};e.each(t,(function(e,t){n._setOption(e,t),e in n.sizeRelatedOptions&&(i=!0),e in n.resizableRelatedOptions&&(r[e]=t)})),i&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",r)},_setOption:function(t,n){var i,r,s=this.uiDialog;"disabled"!==t&&(this._super(t,n),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:e("<a>").text(""+this.options.closeText).html()}),"draggable"===t&&((i=s.is(":data(ui-draggable)"))&&!n&&s.draggable("destroy"),!i&&n&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&((r=s.is(":data(ui-resizable)"))&&!n&&s.resizable("destroy"),r&&"string"==typeof n&&s.resizable("option","handles",n),r||!1===n||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")),"modal"===t&&s.attr("aria-modal",n?"true":null))},_size:function(){var e,t,n,i=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),i.minWidth>i.width&&(i.width=i.minWidth),e=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),t=Math.max(0,i.minHeight-e),n="number"==typeof i.maxHeight?Math.max(0,i.maxHeight-e):"none","auto"===i.height?this.element.css({minHeight:t,maxHeight:n,height:"auto"}):this.element.height(Math.max(0,i.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map((function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]}))},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay((function(){t=!1})),this.document.data("ui-dialog-overlays")||this.document.on("focusin.ui-dialog",function(e){if(!t){var n=this._trackingInstances()[0];n._allowInteraction(e)||(e.preventDefault(),n._focusTabbable())}}.bind(this)),this.overlay=e("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):(this.document.off("focusin.ui-dialog"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!0===e.uiBackCompat&&e.widget("ui.dialog",e.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(e,t){"dialogClass"===e&&this.uiDialog.removeClass(this.options.dialogClass).addClass(t),this._superApply(arguments)}}),e.ui.dialog},void 0===(s=i.apply(t,r))||(e.exports=s)}()},4719:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(191),n(2812),n(9587),n(2362),n(1642),n(2628)],void 0===(s="function"==typeof(i=function(e){return e.widget("ui.draggable",e.ui.mouse,{version:"1.14.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(t){var n=this.options;return!(this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(t),!this.handle||(this._blurActiveElement(t),this._blockFrames(!0===n.iframeFix?"iframe":n.iframeFix),0)))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map((function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]}))},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var n=this.document[0].activeElement;e(t.target).closest(n).length||e(n).trigger("blur")},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter((function(){return"fixed"===e(this).css("position")})).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,n){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(!1===this._trigger("drag",t,i))return this._mouseUp(new e.Event("mouseup",t)),!1;this.position=i.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,i=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||!0===this.options.revert||"function"==typeof this.options.revert&&this.options.revert.call(this.element,i)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),(function(){!1!==n._trigger("stop",t)&&n._clear()})):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var n=this.options,i="function"==typeof n.helper,r=i?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i&&r[0]===this.element[0]&&this._setPositionRelative(),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),Array.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),n=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==n&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,r=this.options,s=this.document[0];this.relativeContainer=null,r.containment?"window"!==r.containment?"document"!==r.containment?r.containment.constructor!==Array?("parent"===r.containment&&(r.containment=this.helper[0].parentNode),(i=(n=e(r.containment))[0])&&(t=/(scroll|auto)/.test(n.css("overflow")),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=n)):this.containment=r.containment:this.containment=[0,0,e(s).width()-this.helperProportions.width-this.margins.left,(e(s).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(e,t){t||(t=this.position);var n="absolute"===e?1:-1,i=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.offset.scroll.top:i?0:this.offset.scroll.top)*n,left:t.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.offset.scroll.left:i?0:this.offset.scroll.left)*n}},_generatePosition:function(e,t){var n,i,r,s,o=this.options,a=this._isRootNode(this.scrollParent[0]),l=e.pageX,c=e.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(i=this.relativeContainer.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,e.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),e.pageY-this.offset.click.top<n[1]&&(c=n[1]+this.offset.click.top),e.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),e.pageY-this.offset.click.top>n[3]&&(c=n[3]+this.offset.click.top)),o.grid&&(r=o.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,c=n?r-this.offset.click.top>=n[1]||r-this.offset.click.top>n[3]?r:r-this.offset.click.top>=n[1]?r-o.grid[1]:r+o.grid[1]:r,s=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s),"y"===o.axis&&(l=this.originalPageX),"x"===o.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(t,n,i){return i=i||this._uiHash(),e.ui.plugin.call(this,t,[n,i,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),i.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n,i){var r=e.extend({},n,{item:i.element});i.sortables=[],e(i.options.connectToSortable).each((function(){var n=e(this).sortable("instance");n&&!n.options.disabled&&(i.sortables.push(n),n.refreshPositions(),n._trigger("activate",t,r))}))},stop:function(t,n,i){var r=e.extend({},n,{item:i.element});i.cancelHelperRemoval=!1,e.each(i.sortables,(function(){var e=this;e.isOver?(e.isOver=0,i.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,r))}))},drag:function(t,n,i){e.each(i.sortables,(function(){var r=!1,s=this;s.positionAbs=i.positionAbs,s.helperProportions=i.helperProportions,s.offset.click=i.offset.click,s._intersectsWith(s.containerCache)&&(r=!0,e.each(i.sortables,(function(){return this.positionAbs=i.positionAbs,this.helperProportions=i.helperProportions,this.offset.click=i.offset.click,this!==s&&this._intersectsWith(this.containerCache)&&e.contains(s.element[0],this.element[0])&&(r=!1),r}))),r?(s.isOver||(s.isOver=1,i._parent=n.helper.parent(),s.currentItem=n.helper.appendTo(s.element).data("ui-sortable-item",!0),s.options._helper=s.options.helper,s.options.helper=function(){return n.helper[0]},t.target=s.currentItem[0],s._mouseCapture(t,!0),s._mouseStart(t,!0,!0),s.offset.click.top=i.offset.click.top,s.offset.click.left=i.offset.click.left,s.offset.parent.left-=i.offset.parent.left-s.offset.parent.left,s.offset.parent.top-=i.offset.parent.top-s.offset.parent.top,i._trigger("toSortable",t),i.dropped=s.element,e.each(i.sortables,(function(){this.refreshPositions()})),i.currentItem=i.element,s.fromOutside=i),s.currentItem&&(s._mouseDrag(t),n.position=s.position)):s.isOver&&(s.isOver=0,s.cancelHelperRemoval=!0,s.options._revert=s.options.revert,s.options.revert=!1,s._trigger("out",t,s._uiHash(s)),s._mouseStop(t,!0),s.options.revert=s.options._revert,s.options.helper=s.options._helper,s.placeholder&&s.placeholder.remove(),n.helper.appendTo(i._parent),i._refreshOffsets(t),n.position=i._generatePosition(t,!0),i._trigger("fromSortable",t),i.dropped=!1,e.each(i.sortables,(function(){this.refreshPositions()})))}))}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n,i){var r=e("body"),s=i.options;r.css("cursor")&&(s._cursor=r.css("cursor")),r.css("cursor",s.cursor)},stop:function(t,n,i){var r=i.options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n,i){var r=e(n.helper),s=i.options;r.css("opacity")&&(s._opacity=r.css("opacity")),r.css("opacity",s.opacity)},stop:function(t,n,i){var r=i.options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,n){n.scrollParentNotHidden||(n.scrollParentNotHidden=n.helper.scrollParent(!1)),n.scrollParentNotHidden[0]!==n.document[0]&&"HTML"!==n.scrollParentNotHidden[0].tagName&&(n.overflowOffset=n.scrollParentNotHidden.offset())},drag:function(t,n,i){var r=i.options,s=!1,o=i.scrollParentNotHidden[0],a=i.document[0];o!==a&&"HTML"!==o.tagName?(r.axis&&"x"===r.axis||(i.overflowOffset.top+o.offsetHeight-t.pageY<r.scrollSensitivity?o.scrollTop=s=o.scrollTop+r.scrollSpeed:t.pageY-i.overflowOffset.top<r.scrollSensitivity&&(o.scrollTop=s=o.scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(i.overflowOffset.left+o.offsetWidth-t.pageX<r.scrollSensitivity?o.scrollLeft=s=o.scrollLeft+r.scrollSpeed:t.pageX-i.overflowOffset.left<r.scrollSensitivity&&(o.scrollLeft=s=o.scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(t.pageY-e(a).scrollTop()<r.scrollSensitivity?s=e(a).scrollTop(e(a).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(a).scrollTop())<r.scrollSensitivity&&(s=e(a).scrollTop(e(a).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(t.pageX-e(a).scrollLeft()<r.scrollSensitivity?s=e(a).scrollLeft(e(a).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(a).scrollLeft())<r.scrollSensitivity&&(s=e(a).scrollLeft(e(a).scrollLeft()+r.scrollSpeed)))),!1!==s&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,n,i){var r=i.options;i.snapElements=[],e(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each((function(){var t=e(this),n=t.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})}))},drag:function(t,n,i){var r,s,o,a,l,c,u,h,d,p,f=i.options,m=f.snapTolerance,g=n.offset.left,_=g+i.helperProportions.width,v=n.offset.top,y=v+i.helperProportions.height;for(d=i.snapElements.length-1;d>=0;d--)c=(l=i.snapElements[d].left-i.margins.left)+i.snapElements[d].width,h=(u=i.snapElements[d].top-i.margins.top)+i.snapElements[d].height,_<l-m||g>c+m||y<u-m||v>h+m||!e.contains(i.snapElements[d].item.ownerDocument,i.snapElements[d].item)?(i.snapElements[d].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,t,e.extend(i._uiHash(),{snapItem:i.snapElements[d].item})),i.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(r=Math.abs(u-y)<=m,s=Math.abs(h-v)<=m,o=Math.abs(l-_)<=m,a=Math.abs(c-g)<=m,r&&(n.position.top=i._convertPositionTo("relative",{top:u-i.helperProportions.height,left:0}).top),s&&(n.position.top=i._convertPositionTo("relative",{top:h,left:0}).top),o&&(n.position.left=i._convertPositionTo("relative",{top:0,left:l-i.helperProportions.width}).left),a&&(n.position.left=i._convertPositionTo("relative",{top:0,left:c}).left)),p=r||s||o||a,"outer"!==f.snapMode&&(r=Math.abs(u-v)<=m,s=Math.abs(h-y)<=m,o=Math.abs(l-g)<=m,a=Math.abs(c-_)<=m,r&&(n.position.top=i._convertPositionTo("relative",{top:u,left:0}).top),s&&(n.position.top=i._convertPositionTo("relative",{top:h-i.helperProportions.height,left:0}).top),o&&(n.position.left=i._convertPositionTo("relative",{top:0,left:l}).left),a&&(n.position.left=i._convertPositionTo("relative",{top:0,left:c-i.helperProportions.width}).left)),!i.snapElements[d].snapping&&(r||s||o||a||p)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,t,e.extend(i._uiHash(),{snapItem:i.snapElements[d].item})),i.snapElements[d].snapping=r||s||o||a||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,n,i){var r,s=i.options,o=e.makeArray(e(s.stack)).sort((function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)}));o.length&&(r=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each((function(t){e(this).css("zIndex",r+t)})),this.css("zIndex",r+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n,i){var r=e(n.helper),s=i.options;r.css("zIndex")&&(s._zIndex=r.css("zIndex")),r.css("zIndex",s.zIndex)},stop:function(t,n,i){var r=i.options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}}),e.ui.draggable})?i.apply(t,r):i)||(e.exports=s)}()},191:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642),n(2628)],void 0===(s="function"==typeof(i=function(e){var t=!1;return e(document).on("mouseup",(function(){t=!1})),e.widget("ui.mouse",{version:"1.14.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,(function(e){return t._mouseDown(e)})).on("click."+this.widgetName,(function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1})),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,r=1===n.which,s="string"==typeof this.options.cancel&&e(n.target).closest(this.options.cancel).length;return!(r&&!s&&this._mouseCapture(n)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout((function(){i.mouseDelayMet=!0}),this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=!1!==this._mouseStart(n),!this._mouseStarted)?(n.preventDefault(),0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,0)))}},_mouseMove:function(e){if(this._mouseMoved&&!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e);return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(n){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,n.target===this._mouseDownEvent.target&&e.data(n.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(n)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,t=!1,n.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})?i.apply(t,r):i)||(e.exports=s)}()},3049:(e,t,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(191),n(1677),n(9587),n(1642),n(2628)],i=function(e){return e.widget("ui.resizable",e.ui.mouse,{version:"1.14.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(t,n){var i,r=!1,s=e(t).css("overflow");if("hidden"===s)return!1;if("scroll"===s)return!0;if(t[i=n&&"left"===n?"scrollLeft":"scrollTop"]>0)return!0;try{t[i]=1,r=t[i]>0,t[i]=0}catch(e){}return r},_create:function(){var t,n=this.options,i=this;this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper'></div>").css({overflow:"hidden",position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,t={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(t),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this._proportionallyResize()),this._setupHandles(),n.autoHide&&e(this.element).on("mouseenter",(function(){n.disabled||(i._removeClass("ui-resizable-autohide"),i._handles.show())})).on("mouseleave",(function(){n.disabled||i.resizing||(i._addClass("ui-resizable-autohide"),i._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy(),this._addedHandles.remove();var t,n=function(t){e(t).removeData("resizable").removeData("ui-resizable").off(".resizable")};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles();break;case"aspectRatio":this._aspectRatio=!!t}},_setupHandles:function(){var t,n,i,r,s,o=this.options,a=this;if(this.handles=o.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this._addedHandles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),i=this.handles.split(","),this.handles={},n=0;n<i.length;n++)r="ui-resizable-"+(t=String.prototype.trim.call(i[n])),s=e("<div>"),this._addClass(s,"ui-resizable-handle "+r),s.css({zIndex:o.zIndex}),this.handles[t]=".ui-resizable-"+t,this.element.children(this.handles[t]).length||(this.element.append(s),this._addedHandles=this._addedHandles.add(s));this._renderAxis=function(t){var n,i,r,s;for(n in t=t||this.element,this.handles)this.handles[n].constructor===String?this.handles[n]=this.element.children(this.handles[n]).first().show():(this.handles[n].jquery||this.handles[n].nodeType)&&(this.handles[n]=e(this.handles[n]),this._on(this.handles[n],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(i=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),r=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(r,s),this._proportionallyResize()),this._handles=this._handles.add(this.handles[n])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",(function(){a.resizing||(this.className&&(s=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=s&&s[1]?s[1]:"se")})),o.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._addedHandles.remove()},_mouseCapture:function(t){var n,i,r=!1;for(n in this.handles)((i=e(this.handles[n])[0])===t.target||e.contains(i,t.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(t){var n,i,r,s,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),n=this._num(this.helper.css("left")),i=this._num(this.helper.css("top")),o.containment&&(n+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:i},this._helper||(s=this._calculateAdjustedElementDimensions(a)),this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width,height:s.height},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:s.width,height:s.height},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:n,top:i},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===r?this.axis+"-resize":r),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n,i,r=this.originalMousePosition,s=this.axis,o=t.pageX-r.left||0,a=t.pageY-r.top||0,l=this._change[s];return this._updatePrevProperties(),!!l&&(n=l.apply(this,[t,o,a]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),i=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var n,i,r,s,o,a,l,c=this.options,u=this;return this._helper&&(r=(i=(n=this._proportionallyResizeElements).length&&/textarea/i.test(n[0].nodeName))&&this._hasScroll(n[0],"left")?0:u.sizeDiff.height,s=i?0:u.sizeDiff.width,o={width:u.helper.width()-s,height:u.helper.height()-r},a=parseFloat(u.element.css("left"))+(u.position.left-u.originalPosition.left)||null,l=parseFloat(u.element.css("top"))+(u.position.top-u.originalPosition.top)||null,c.animate||this.element.css(e.extend(o,{top:l,left:a})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.helper.css(e),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px",this.helper.width(e.width)),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px",this.helper.height(e.height)),e},_updateVirtualBoundaries:function(e){var t,n,i,r,s,o=this.options;s={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,i=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),i>s.minHeight&&(s.minHeight=i),n<s.maxWidth&&(s.maxWidth=n),r<s.maxHeight&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,i=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===i&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"===i&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,i=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,r=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,c=/sw|nw|w/.test(n),u=/nw|ne|n/.test(n);return s&&(e.width=t.minWidth),o&&(e.height=t.minHeight),i&&(e.width=t.maxWidth),r&&(e.height=t.maxHeight),s&&c&&(e.left=a-t.minWidth),i&&c&&(e.left=a-t.maxWidth),o&&u&&(e.top=l-t.minHeight),r&&u&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,n=[],i=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],r=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];t<4;t++)n[t]=parseFloat(i[t])||0,n[t]+=parseFloat(r[t])||0;return{height:n[0]+n[2],width:n[1]+n[3]}},_calculateAdjustedElementDimensions:function(e){var t,n,i,r=e.get(0);return"content-box"!==e.css("box-sizing")||!this._hasScroll(r)&&!this._hasScroll(r,"left")?{height:parseFloat(e.css("height")),width:parseFloat(e.css("width"))}:(t=parseFloat(r.style.width),n=parseFloat(r.style.height),i=this._getPaddingPlusBorderDimensions(e),t=isNaN(t)?this._getElementTheoreticalSize(e,i,"width"):t,{height:n=isNaN(n)?this._getElementTheoreticalSize(e,i,"height"):n,width:t})},_getElementTheoreticalSize:function(e,t,n){return Math.max(0,Math.ceil(e.get(0)["offset"+n[0].toUpperCase()+n.slice(1)]-t[n]-.5))||0},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,n=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:n.height()-this.outerDimensions.height||0,width:n.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div></div>").css({overflow:"hidden"}),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize;return{left:this.originalPosition.left+t,width:n.width-t}},n:function(e,t,n){var i=this.originalSize;return{top:this.originalPosition.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},sw:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,i]))},ne:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},nw:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,i]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).resizable("instance"),i=n.options,r=n._proportionallyResizeElements,s=r.length&&/textarea/i.test(r[0].nodeName),o=s&&n._hasScroll(r[0],"left")?0:n.sizeDiff.height,a=s?0:n.sizeDiff.width,l={width:n.size.width-a,height:n.size.height-o},c=parseFloat(n.element.css("left"))+(n.position.left-n.originalPosition.left)||null,u=parseFloat(n.element.css("top"))+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(l,u&&c?{top:u,left:c}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseFloat(n.element.css("width")),height:parseFloat(n.element.css("height")),top:parseFloat(n.element.css("top")),left:parseFloat(n.element.css("left"))};r&&r.length&&e(r[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,n,i,r,s,o,a,l=e(this).resizable("instance"),c=l.options,u=l.element,h=c.containment,d=h instanceof e?h.get(0):/parent/.test(h)?u.parent().get(0):h;d&&(l.containerElement=e(d),/document/.test(h)||h===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(d),n=[],e(["Top","Right","Left","Bottom"]).each((function(e,i){n[e]=l._num(t.css("padding"+i))})),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-n[3],width:t.innerWidth()-n[1]},i=l.containerOffset,r=l.containerSize.height,s=l.containerSize.width,o=l._hasScroll(d,"left")?d.scrollWidth:s,a=l._hasScroll(d)?d.scrollHeight:r,l.parentData={element:d,left:i.left,top:i.top,width:o,height:a}))},resize:function(t){var n,i,r,s,o=e(this).resizable("instance"),a=o.options,l=o.containerOffset,c=o.position,u=o._aspectRatio||t.shiftKey,h={top:0,left:0},d=o.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(h=l),c.left<(o._helper?l.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-l.left:o.position.left-h.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=a.helper?l.left:0),c.top<(o._helper?l.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-l.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?l.top:0),r=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),r&&s?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),n=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-h.left:o.offset.left-l.left)),i=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-h.top:o.offset.top-l.top)),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),i+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-i,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),n=t.options,i=t.containerOffset,r=t.containerPosition,s=t.containerElement,o=e(t.helper),a=o.offset(),l=o.outerWidth()-t.sizeDiff.width,c=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:a.left-r.left-i.left,width:l,height:c}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:a.left-r.left-i.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),n=t.options;e(n.alsoResize).each((function(){var n=e(this),i=t._calculateAdjustedElementDimensions(n);n.data("ui-resizable-alsoresize",{width:i.width,height:i.height,left:parseFloat(n.css("left")),top:parseFloat(n.css("top"))})}))},resize:function(t,n){var i=e(this).resizable("instance"),r=i.options,s=i.originalSize,o=i.originalPosition,a={height:i.size.height-s.height||0,width:i.size.width-s.width||0,top:i.position.top-o.top||0,left:i.position.left-o.left||0};e(r.alsoResize).each((function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),r={},s=t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,(function(e,t){var n=(i[t]||0)+(a[t]||0);n&&n>=0&&(r[t]=n||null)})),t.css(r)}))},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}),t._addClass(t.ghost,"ui-resizable-ghost"),!0===e.uiBackCompat&&"string"==typeof t.options.ghost&&t.ghost.addClass(this.options.ghost),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,n=e(this).resizable("instance"),i=n.options,r=n.size,s=n.originalSize,o=n.originalPosition,a=n.axis,l="number"==typeof i.grid?[i.grid,i.grid]:i.grid,c=l[0]||1,u=l[1]||1,h=Math.round((r.width-s.width)/c)*c,d=Math.round((r.height-s.height)/u)*u,p=s.width+h,f=s.height+d,m=i.maxWidth&&i.maxWidth<p,g=i.maxHeight&&i.maxHeight<f,_=i.minWidth&&i.minWidth>p,v=i.minHeight&&i.minHeight>f;i.grid=l,_&&(p+=c),v&&(f+=u),m&&(p-=c),g&&(f-=u),/^(se|s|e)$/.test(a)?(n.size.width=p,n.size.height=f):/^(ne)$/.test(a)?(n.size.width=p,n.size.height=f,n.position.top=o.top-d):/^(sw)$/.test(a)?(n.size.width=p,n.size.height=f,n.position.left=o.left-h):((f-u<=0||p-c<=0)&&(t=n._getPaddingPlusBorderDimensions(this)),f-u>0?(n.size.height=f,n.position.top=o.top-d):(f=u-t.height,n.size.height=f,n.position.top=o.top+s.height-f),p-c>0?(n.size.width=p,n.position.left=o.left-h):(p=c-t.width,n.size.width=p,n.position.left=o.left+s.width-p))}}),e.ui.resizable},void 0===(s=i.apply(t,r))||(e.exports=s)}()},1929:function(e,t){var n;!function(t,n){"use strict";"object"==typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(t)}("undefined"!=typeof window?window:this,(function(i,r){"use strict";var s=[],o=Object.getPrototypeOf,a=s.slice,l=s.flat?function(e){return s.flat.call(e)}:function(e){return s.concat.apply([],e)},c=s.push,u=s.indexOf,h={},d=h.toString,p=h.hasOwnProperty,f=p.toString,m=f.call(Object),g={},_=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},v=function(e){return null!=e&&e===e.window},y=i.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function x(e,t,n){var i,r,s=(n=n||y).createElement("script");if(s.text=e,t)for(i in b)(r=t[i]||t.getAttribute&&t.getAttribute(i))&&s.setAttribute(i,r);n.head.appendChild(s).parentNode.removeChild(s)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[d.call(e)]||"object":typeof e}var S="3.7.1",A=/HTML$/i,M=function(e,t){return new M.fn.init(e,t)};function C(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!_(e)&&!v(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function T(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}M.fn=M.prototype={jquery:S,constructor:M,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=M.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return M.each(this,e)},map:function(e){return this.pushStack(M.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(M.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(M.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:s.sort,splice:s.splice},M.extend=M.fn.extend=function(){var e,t,n,i,r,s,o=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[a]||{},a++),"object"==typeof o||_(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)i=e[t],"__proto__"!==t&&o!==i&&(c&&i&&(M.isPlainObject(i)||(r=Array.isArray(i)))?(n=o[t],s=r&&!Array.isArray(n)?[]:r||M.isPlainObject(n)?n:{},r=!1,o[t]=M.extend(c,s,i)):void 0!==i&&(o[t]=i));return o},M.extend({expando:"jQuery"+(S+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==d.call(e)||(t=o(e))&&("function"!=typeof(n=p.call(t,"constructor")&&t.constructor)||f.call(n)!==m))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){x(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,i=0;if(C(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},text:function(e){var t,n="",i=0,r=e.nodeType;if(!r)for(;t=e[i++];)n+=M.text(t);return 1===r||11===r?e.textContent:9===r?e.documentElement.textContent:3===r||4===r?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(C(Object(e))?M.merge(n,"string"==typeof e?[e]:e):c.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!A.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;i<n;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i=[],r=0,s=e.length,o=!n;r<s;r++)!t(e[r],r)!==o&&i.push(e[r]);return i},map:function(e,t,n){var i,r,s=0,o=[];if(C(e))for(i=e.length;s<i;s++)null!=(r=t(e[s],s,n))&&o.push(r);else for(s in e)null!=(r=t(e[s],s,n))&&o.push(r);return l(o)},guid:1,support:g}),"function"==typeof Symbol&&(M.fn[Symbol.iterator]=s[Symbol.iterator]),M.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){h["[object "+t+"]"]=t.toLowerCase()}));var E=s.pop,P=s.sort,I=s.splice,k="[\\x20\\t\\r\\n\\f]",R=new RegExp("^"+k+"+|((?:^|[^\\\\])(?:\\\\.)*)"+k+"+$","g");M.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var D=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function L(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}M.escapeSelector=function(e){return(e+"").replace(D,L)};var O=y,N=c;!function(){var e,t,n,r,o,l,c,h,d,f,m=N,_=M.expando,v=0,y=0,b=ee(),x=ee(),w=ee(),S=ee(),A=function(e,t){return e===t&&(o=!0),0},C="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",D="(?:\\\\[\\da-fA-F]{1,6}"+k+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",L="\\["+k+"*("+D+")(?:"+k+"*([*^$|!~]?=)"+k+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+D+"))|)"+k+"*\\]",F=":("+D+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+L+")*)|.*)\\)|)",B=new RegExp(k+"+","g"),U=new RegExp("^"+k+"*,"+k+"*"),z=new RegExp("^"+k+"*([>+~]|"+k+")"+k+"*"),V=new RegExp(k+"|>"),H=new RegExp(F),$=new RegExp("^"+D+"$"),G={ID:new RegExp("^#("+D+")"),CLASS:new RegExp("^\\.("+D+")"),TAG:new RegExp("^("+D+"|[*])"),ATTR:new RegExp("^"+L),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+k+"*(even|odd|(([+-]|)(\\d*)n|)"+k+"*(?:([+-]|)"+k+"*(\\d+)|))"+k+"*\\)|)","i"),bool:new RegExp("^(?:"+C+")$","i"),needsContext:new RegExp("^"+k+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+k+"*((?:-\\d)?\\d*)"+k+"*\\)|)(?=[^-]|$)","i")},j=/^(?:input|select|textarea|button)$/i,W=/^h\d$/i,q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,Y=new RegExp("\\\\[\\da-fA-F]{1,6}"+k+"?|\\\\([^\\r\\n\\f])","g"),K=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},Z=function(){le()},Q=de((function(e){return!0===e.disabled&&T(e,"fieldset")}),{dir:"parentNode",next:"legend"});try{m.apply(s=a.call(O.childNodes),O.childNodes),s[O.childNodes.length].nodeType}catch(e){m={apply:function(e,t){N.apply(e,a.call(t))},call:function(e){N.apply(e,a.call(arguments,1))}}}function J(e,t,n,i){var r,s,o,a,c,u,p,f=t&&t.ownerDocument,v=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==v&&9!==v&&11!==v)return n;if(!i&&(le(t),t=t||l,h)){if(11!==v&&(c=q.exec(e)))if(r=c[1]){if(9===v){if(!(o=t.getElementById(r)))return n;if(o.id===r)return m.call(n,o),n}else if(f&&(o=f.getElementById(r))&&J.contains(t,o)&&o.id===r)return m.call(n,o),n}else{if(c[2])return m.apply(n,t.getElementsByTagName(e)),n;if((r=c[3])&&t.getElementsByClassName)return m.apply(n,t.getElementsByClassName(r)),n}if(!(S[e+" "]||d&&d.test(e))){if(p=e,f=t,1===v&&(V.test(e)||z.test(e))){for((f=X.test(e)&&ae(t.parentNode)||t)==t&&g.scope||((a=t.getAttribute("id"))?a=M.escapeSelector(a):t.setAttribute("id",a=_)),s=(u=ue(e)).length;s--;)u[s]=(a?"#"+a:":scope")+" "+he(u[s]);p=u.join(",")}try{return m.apply(n,f.querySelectorAll(p)),n}catch(t){S(e,!0)}finally{a===_&&t.removeAttribute("id")}}}return ve(e.replace(R,"$1"),t,n,i)}function ee(){var e=[];return function n(i,r){return e.push(i+" ")>t.cacheLength&&delete n[e.shift()],n[i+" "]=r}}function te(e){return e[_]=!0,e}function ne(e){var t=l.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ie(e){return function(t){return T(t,"input")&&t.type===e}}function re(e){return function(t){return(T(t,"input")||T(t,"button"))&&t.type===e}}function se(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Q(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function oe(e){return te((function(t){return t=+t,te((function(n,i){for(var r,s=e([],n.length,t),o=s.length;o--;)n[r=s[o]]&&(n[r]=!(i[r]=n[r]))}))}))}function ae(e){return e&&void 0!==e.getElementsByTagName&&e}function le(e){var n,i=e?e.ownerDocument||e:O;return i!=l&&9===i.nodeType&&i.documentElement?(c=(l=i).documentElement,h=!M.isXMLDoc(l),f=c.matches||c.webkitMatchesSelector||c.msMatchesSelector,c.msMatchesSelector&&O!=l&&(n=l.defaultView)&&n.top!==n&&n.addEventListener("unload",Z),g.getById=ne((function(e){return c.appendChild(e).id=M.expando,!l.getElementsByName||!l.getElementsByName(M.expando).length})),g.disconnectedMatch=ne((function(e){return f.call(e,"*")})),g.scope=ne((function(){return l.querySelectorAll(":scope")})),g.cssHas=ne((function(){try{return l.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),g.getById?(t.filter.ID=function(e){var t=e.replace(Y,K);return function(e){return e.getAttribute("id")===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&h){var n=t.getElementById(e);return n?[n]:[]}}):(t.filter.ID=function(e){var t=e.replace(Y,K);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&h){var n,i,r,s=t.getElementById(e);if(s){if((n=s.getAttributeNode("id"))&&n.value===e)return[s];for(r=t.getElementsByName(e),i=0;s=r[i++];)if((n=s.getAttributeNode("id"))&&n.value===e)return[s]}return[]}}),t.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},t.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&h)return t.getElementsByClassName(e)},d=[],ne((function(e){var t;c.appendChild(e).innerHTML="<a id='"+_+"' href='' disabled='disabled'></a><select id='"+_+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+k+"*(?:value|"+C+")"),e.querySelectorAll("[id~="+_+"-]").length||d.push("~="),e.querySelectorAll("a#"+_+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=l.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),c.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=l.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+k+"*name"+k+"*="+k+"*(?:''|\"\")")})),g.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),A=function(e,t){if(e===t)return o=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!g.sortDetached&&t.compareDocumentPosition(e)===n?e===l||e.ownerDocument==O&&J.contains(O,e)?-1:t===l||t.ownerDocument==O&&J.contains(O,t)?1:r?u.call(r,e)-u.call(r,t):0:4&n?-1:1)},l):l}for(e in J.matches=function(e,t){return J(e,null,null,t)},J.matchesSelector=function(e,t){if(le(e),h&&!S[t+" "]&&(!d||!d.test(t)))try{var n=f.call(e,t);if(n||g.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){S(t,!0)}return J(t,l,null,[e]).length>0},J.contains=function(e,t){return(e.ownerDocument||e)!=l&&le(e),M.contains(e,t)},J.attr=function(e,n){(e.ownerDocument||e)!=l&&le(e);var i=t.attrHandle[n.toLowerCase()],r=i&&p.call(t.attrHandle,n.toLowerCase())?i(e,n,!h):void 0;return void 0!==r?r:e.getAttribute(n)},J.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},M.uniqueSort=function(e){var t,n=[],i=0,s=0;if(o=!g.sortStable,r=!g.sortStable&&a.call(e,0),P.call(e,A),o){for(;t=e[s++];)t===e[s]&&(i=n.push(s));for(;i--;)I.call(e,n[i],1)}return r=null,e},M.fn.uniqueSort=function(){return this.pushStack(M.uniqueSort(a.apply(this)))},t=M.expr={cacheLength:50,createPseudo:te,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Y,K),e[3]=(e[3]||e[4]||e[5]||"").replace(Y,K),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||J.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&J.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&H.test(n)&&(t=ue(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Y,K).toLowerCase();return"*"===e?function(){return!0}:function(e){return T(e,t)}},CLASS:function(e){var t=b[e+" "];return t||(t=new RegExp("(^|"+k+")"+e+"("+k+"|$)"))&&b(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(i){var r=J.attr(i,e);return null==r?"!="===t:!t||(r+="","="===t?r===n:"!="===t?r!==n:"^="===t?n&&0===r.indexOf(n):"*="===t?n&&r.indexOf(n)>-1:"$="===t?n&&r.slice(-n.length)===n:"~="===t?(" "+r.replace(B," ")+" ").indexOf(n)>-1:"|="===t&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,r){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,l){var c,u,h,d,p,f=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=a&&t.nodeName.toLowerCase(),y=!l&&!a,b=!1;if(m){if(s){for(;f;){for(h=t;h=h[f];)if(a?T(h,g):1===h.nodeType)return!1;p=f="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?m.firstChild:m.lastChild],o&&y){for(b=(d=(c=(u=m[_]||(m[_]={}))[e]||[])[0]===v&&c[1])&&c[2],h=d&&m.childNodes[d];h=++d&&h&&h[f]||(b=d=0)||p.pop();)if(1===h.nodeType&&++b&&h===t){u[e]=[v,d,b];break}}else if(y&&(b=d=(c=(u=t[_]||(t[_]={}))[e]||[])[0]===v&&c[1]),!1===b)for(;(h=++d&&h&&h[f]||(b=d=0)||p.pop())&&(!(a?T(h,g):1===h.nodeType)||!++b||(y&&((u=h[_]||(h[_]={}))[e]=[v,b]),h!==t)););return(b-=r)===i||b%i==0&&b/i>=0}}},PSEUDO:function(e,n){var i,r=t.pseudos[e]||t.setFilters[e.toLowerCase()]||J.error("unsupported pseudo: "+e);return r[_]?r(n):r.length>1?(i=[e,e,"",n],t.setFilters.hasOwnProperty(e.toLowerCase())?te((function(e,t){for(var i,s=r(e,n),o=s.length;o--;)e[i=u.call(e,s[o])]=!(t[i]=s[o])})):function(e){return r(e,0,i)}):r}},pseudos:{not:te((function(e){var t=[],n=[],i=_e(e.replace(R,"$1"));return i[_]?te((function(e,t,n,r){for(var s,o=i(e,null,r,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,r,s){return t[0]=e,i(t,null,s,n),t[0]=null,!n.pop()}})),has:te((function(e){return function(t){return J(e,t).length>0}})),contains:te((function(e){return e=e.replace(Y,K),function(t){return(t.textContent||M.text(t)).indexOf(e)>-1}})),lang:te((function(e){return $.test(e||"")||J.error("unsupported lang: "+e),e=e.replace(Y,K).toLowerCase(),function(t){var n;do{if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===c},focus:function(e){return e===function(){try{return l.activeElement}catch(e){}}()&&l.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:se(!1),disabled:se(!0),checked:function(e){return T(e,"input")&&!!e.checked||T(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!t.pseudos.empty(e)},header:function(e){return W.test(e.nodeName)},input:function(e){return j.test(e.nodeName)},button:function(e){return T(e,"input")&&"button"===e.type||T(e,"button")},text:function(e){var t;return T(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:oe((function(){return[0]})),last:oe((function(e,t){return[t-1]})),eq:oe((function(e,t,n){return[n<0?n+t:n]})),even:oe((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:oe((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:oe((function(e,t,n){var i;for(i=n<0?n+t:n>t?t:n;--i>=0;)e.push(i);return e})),gt:oe((function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e}))}},t.pseudos.nth=t.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})t.pseudos[e]=ie(e);for(e in{submit:!0,reset:!0})t.pseudos[e]=re(e);function ce(){}function ue(e,n){var i,r,s,o,a,l,c,u=x[e+" "];if(u)return n?0:u.slice(0);for(a=e,l=[],c=t.preFilter;a;){for(o in i&&!(r=U.exec(a))||(r&&(a=a.slice(r[0].length)||a),l.push(s=[])),i=!1,(r=z.exec(a))&&(i=r.shift(),s.push({value:i,type:r[0].replace(R," ")}),a=a.slice(i.length)),t.filter)!(r=G[o].exec(a))||c[o]&&!(r=c[o](r))||(i=r.shift(),s.push({value:i,type:o,matches:r}),a=a.slice(i.length));if(!i)break}return n?a.length:a?J.error(e):x(e,l).slice(0)}function he(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function de(e,t,n){var i=t.dir,r=t.next,s=r||i,o=n&&"parentNode"===s,a=y++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||o)return e(t,n,r);return!1}:function(t,n,l){var c,u,h=[v,a];if(l){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,n,l))return!0}else for(;t=t[i];)if(1===t.nodeType||o)if(u=t[_]||(t[_]={}),r&&T(t,r))t=t[i]||t;else{if((c=u[s])&&c[0]===v&&c[1]===a)return h[2]=c[2];if(u[s]=h,h[2]=e(t,n,l))return!0}return!1}}function pe(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function fe(e,t,n,i,r){for(var s,o=[],a=0,l=e.length,c=null!=t;a<l;a++)(s=e[a])&&(n&&!n(s,i,r)||(o.push(s),c&&t.push(a)));return o}function me(e,t,n,i,r,s){return i&&!i[_]&&(i=me(i)),r&&!r[_]&&(r=me(r,s)),te((function(s,o,a,l){var c,h,d,p,f=[],g=[],_=o.length,v=s||function(e,t,n){for(var i=0,r=t.length;i<r;i++)J(e,t[i],n);return n}(t||"*",a.nodeType?[a]:a,[]),y=!e||!s&&t?v:fe(v,f,e,a,l);if(n?n(y,p=r||(s?e:_||i)?[]:o,a,l):p=y,i)for(c=fe(p,g),i(c,[],a,l),h=c.length;h--;)(d=c[h])&&(p[g[h]]=!(y[g[h]]=d));if(s){if(r||e){if(r){for(c=[],h=p.length;h--;)(d=p[h])&&c.push(y[h]=d);r(null,p=[],c,l)}for(h=p.length;h--;)(d=p[h])&&(c=r?u.call(s,d):f[h])>-1&&(s[c]=!(o[c]=d))}}else p=fe(p===o?p.splice(_,p.length):p),r?r(null,o,p,l):m.apply(o,p)}))}function ge(e){for(var i,r,s,o=e.length,a=t.relative[e[0].type],l=a||t.relative[" "],c=a?1:0,h=de((function(e){return e===i}),l,!0),d=de((function(e){return u.call(i,e)>-1}),l,!0),p=[function(e,t,r){var s=!a&&(r||t!=n)||((i=t).nodeType?h(e,t,r):d(e,t,r));return i=null,s}];c<o;c++)if(r=t.relative[e[c].type])p=[de(pe(p),r)];else{if((r=t.filter[e[c].type].apply(null,e[c].matches))[_]){for(s=++c;s<o&&!t.relative[e[s].type];s++);return me(c>1&&pe(p),c>1&&he(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(R,"$1"),r,c<s&&ge(e.slice(c,s)),s<o&&ge(e=e.slice(s)),s<o&&he(e))}p.push(r)}return pe(p)}function _e(e,i){var r,s=[],o=[],a=w[e+" "];if(!a){for(i||(i=ue(e)),r=i.length;r--;)(a=ge(i[r]))[_]?s.push(a):o.push(a);a=w(e,function(e,i){var r=i.length>0,s=e.length>0,o=function(o,a,c,u,d){var p,f,g,_=0,y="0",b=o&&[],x=[],w=n,S=o||s&&t.find.TAG("*",d),A=v+=null==w?1:Math.random()||.1,C=S.length;for(d&&(n=a==l||a||d);y!==C&&null!=(p=S[y]);y++){if(s&&p){for(f=0,a||p.ownerDocument==l||(le(p),c=!h);g=e[f++];)if(g(p,a||l,c)){m.call(u,p);break}d&&(v=A)}r&&((p=!g&&p)&&_--,o&&b.push(p))}if(_+=y,r&&y!==_){for(f=0;g=i[f++];)g(b,x,a,c);if(o){if(_>0)for(;y--;)b[y]||x[y]||(x[y]=E.call(u));x=fe(x)}m.apply(u,x),d&&!o&&x.length>0&&_+i.length>1&&M.uniqueSort(u)}return d&&(v=A,n=w),b};return r?te(o):o}(o,s)),a.selector=e}return a}function ve(e,n,i,r){var s,o,a,l,c,u="function"==typeof e&&e,d=!r&&ue(e=u.selector||e);if(i=i||[],1===d.length){if((o=d[0]=d[0].slice(0)).length>2&&"ID"===(a=o[0]).type&&9===n.nodeType&&h&&t.relative[o[1].type]){if(!(n=(t.find.ID(a.matches[0].replace(Y,K),n)||[])[0]))return i;u&&(n=n.parentNode),e=e.slice(o.shift().value.length)}for(s=G.needsContext.test(e)?0:o.length;s--&&(a=o[s],!t.relative[l=a.type]);)if((c=t.find[l])&&(r=c(a.matches[0].replace(Y,K),X.test(o[0].type)&&ae(n.parentNode)||n))){if(o.splice(s,1),!(e=r.length&&he(o)))return m.apply(i,r),i;break}}return(u||_e(e,d))(r,n,!h,i,!n||X.test(e)&&ae(n.parentNode)||n),i}ce.prototype=t.filters=t.pseudos,t.setFilters=new ce,g.sortStable=_.split("").sort(A).join("")===_,le(),g.sortDetached=ne((function(e){return 1&e.compareDocumentPosition(l.createElement("fieldset"))})),M.find=J,M.expr[":"]=M.expr.pseudos,M.unique=M.uniqueSort,J.compile=_e,J.select=ve,J.setDocument=le,J.tokenize=ue,J.escape=M.escapeSelector,J.getText=M.text,J.isXML=M.isXMLDoc,J.selectors=M.expr,J.support=M.support,J.uniqueSort=M.uniqueSort}();var F=function(e,t,n){for(var i=[],r=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&M(e).is(n))break;i.push(e)}return i},B=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},U=M.expr.match.needsContext,z=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function V(e,t,n){return _(t)?M.grep(e,(function(e,i){return!!t.call(e,i,e)!==n})):t.nodeType?M.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?M.grep(e,(function(e){return u.call(t,e)>-1!==n})):M.filter(t,e,n)}M.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?M.find.matchesSelector(i,e)?[i]:[]:M.find.matches(e,M.grep(t,(function(e){return 1===e.nodeType})))},M.fn.extend({find:function(e){var t,n,i=this.length,r=this;if("string"!=typeof e)return this.pushStack(M(e).filter((function(){for(t=0;t<i;t++)if(M.contains(r[t],this))return!0})));for(n=this.pushStack([]),t=0;t<i;t++)M.find(e,r[t],n);return i>1?M.uniqueSort(n):n},filter:function(e){return this.pushStack(V(this,e||[],!1))},not:function(e){return this.pushStack(V(this,e||[],!0))},is:function(e){return!!V(this,"string"==typeof e&&U.test(e)?M(e):e||[],!1).length}});var H,$=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(M.fn.init=function(e,t,n){var i,r;if(!e)return this;if(n=n||H,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:$.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof M?t[0]:t,M.merge(this,M.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:y,!0)),z.test(i[1])&&M.isPlainObject(t))for(i in t)_(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(r=y.getElementById(i[2]))&&(this[0]=r,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):_(e)?void 0!==n.ready?n.ready(e):e(M):M.makeArray(e,this)}).prototype=M.fn,H=M(y);var G=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function W(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}M.fn.extend({has:function(e){var t=M(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(M.contains(this,t[e]))return!0}))},closest:function(e,t){var n,i=0,r=this.length,s=[],o="string"!=typeof e&&M(e);if(!U.test(e))for(;i<r;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&M.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?M.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?u.call(M(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(M.uniqueSort(M.merge(this.get(),M(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),M.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return F(e,"parentNode")},parentsUntil:function(e,t,n){return F(e,"parentNode",n)},next:function(e){return W(e,"nextSibling")},prev:function(e){return W(e,"previousSibling")},nextAll:function(e){return F(e,"nextSibling")},prevAll:function(e){return F(e,"previousSibling")},nextUntil:function(e,t,n){return F(e,"nextSibling",n)},prevUntil:function(e,t,n){return F(e,"previousSibling",n)},siblings:function(e){return B((e.parentNode||{}).firstChild,e)},children:function(e){return B(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(T(e,"template")&&(e=e.content||e),M.merge([],e.childNodes))}},(function(e,t){M.fn[e]=function(n,i){var r=M.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=M.filter(i,r)),this.length>1&&(j[e]||M.uniqueSort(r),G.test(e)&&r.reverse()),this.pushStack(r)}}));var q=/[^\x20\t\r\n\f]+/g;function X(e){return e}function Y(e){throw e}function K(e,t,n,i){var r;try{e&&_(r=e.promise)?r.call(e).done(t).fail(n):e&&_(r=e.then)?r.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}M.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return M.each(e.match(q)||[],(function(e,n){t[n]=!0})),t}(e):M.extend({},e);var t,n,i,r,s=[],o=[],a=-1,l=function(){for(r=r||e.once,i=t=!0;o.length;a=-1)for(n=o.shift();++a<s.length;)!1===s[a].apply(n[0],n[1])&&e.stopOnFalse&&(a=s.length,n=!1);e.memory||(n=!1),t=!1,r&&(s=n?[]:"")},c={add:function(){return s&&(n&&!t&&(a=s.length-1,o.push(n)),function t(n){M.each(n,(function(n,i){_(i)?e.unique&&c.has(i)||s.push(i):i&&i.length&&"string"!==w(i)&&t(i)}))}(arguments),n&&!t&&l()),this},remove:function(){return M.each(arguments,(function(e,t){for(var n;(n=M.inArray(t,s,n))>-1;)s.splice(n,1),n<=a&&a--})),this},has:function(e){return e?M.inArray(e,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=o=[],s=n="",this},disabled:function(){return!s},lock:function(){return r=o=[],n||t||(s=n=""),this},locked:function(){return!!r},fireWith:function(e,n){return r||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},M.extend({Deferred:function(e){var t=[["notify","progress",M.Callbacks("memory"),M.Callbacks("memory"),2],["resolve","done",M.Callbacks("once memory"),M.Callbacks("once memory"),0,"resolved"],["reject","fail",M.Callbacks("once memory"),M.Callbacks("once memory"),1,"rejected"]],n="pending",r={state:function(){return n},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return r.then(null,e)},pipe:function(){var e=arguments;return M.Deferred((function(n){M.each(t,(function(t,i){var r=_(e[i[4]])&&e[i[4]];s[i[1]]((function(){var e=r&&r.apply(this,arguments);e&&_(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this,r?[e]:arguments)}))})),e=null})).promise()},then:function(e,n,r){var s=0;function o(e,t,n,r){return function(){var a=this,l=arguments,c=function(){var i,c;if(!(e<s)){if((i=n.apply(a,l))===t.promise())throw new TypeError("Thenable self-resolution");c=i&&("object"==typeof i||"function"==typeof i)&&i.then,_(c)?r?c.call(i,o(s,t,X,r),o(s,t,Y,r)):(s++,c.call(i,o(s,t,X,r),o(s,t,Y,r),o(s,t,X,t.notifyWith))):(n!==X&&(a=void 0,l=[i]),(r||t.resolveWith)(a,l))}},u=r?c:function(){try{c()}catch(i){M.Deferred.exceptionHook&&M.Deferred.exceptionHook(i,u.error),e+1>=s&&(n!==Y&&(a=void 0,l=[i]),t.rejectWith(a,l))}};e?u():(M.Deferred.getErrorHook?u.error=M.Deferred.getErrorHook():M.Deferred.getStackHook&&(u.error=M.Deferred.getStackHook()),i.setTimeout(u))}}return M.Deferred((function(i){t[0][3].add(o(0,i,_(r)?r:X,i.notifyWith)),t[1][3].add(o(0,i,_(e)?e:X)),t[2][3].add(o(0,i,_(n)?n:Y))})).promise()},promise:function(e){return null!=e?M.extend(e,r):r}},s={};return M.each(t,(function(e,i){var o=i[2],a=i[5];r[i[1]]=o.add,a&&o.add((function(){n=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(i[3].fire),s[i[0]]=function(){return s[i[0]+"With"](this===s?void 0:this,arguments),this},s[i[0]+"With"]=o.fireWith})),r.promise(s),e&&e.call(s,s),s},when:function(e){var t=arguments.length,n=t,i=Array(n),r=a.call(arguments),s=M.Deferred(),o=function(e){return function(n){i[e]=this,r[e]=arguments.length>1?a.call(arguments):n,--t||s.resolveWith(i,r)}};if(t<=1&&(K(e,s.done(o(n)).resolve,s.reject,!t),"pending"===s.state()||_(r[n]&&r[n].then)))return s.then();for(;n--;)K(r[n],o(n),s.reject);return s.promise()}});var Z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;M.Deferred.exceptionHook=function(e,t){i.console&&i.console.warn&&e&&Z.test(e.name)&&i.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},M.readyException=function(e){i.setTimeout((function(){throw e}))};var Q=M.Deferred();function J(){y.removeEventListener("DOMContentLoaded",J),i.removeEventListener("load",J),M.ready()}M.fn.ready=function(e){return Q.then(e).catch((function(e){M.readyException(e)})),this},M.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--M.readyWait:M.isReady)||(M.isReady=!0,!0!==e&&--M.readyWait>0||Q.resolveWith(y,[M]))}}),M.ready.then=Q.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?i.setTimeout(M.ready):(y.addEventListener("DOMContentLoaded",J),i.addEventListener("load",J));var ee=function(e,t,n,i,r,s,o){var a=0,l=e.length,c=null==n;if("object"===w(n))for(a in r=!0,n)ee(e,t,a,n[a],!0,s,o);else if(void 0!==i&&(r=!0,_(i)||(o=!0),c&&(o?(t.call(e,i),t=null):(c=t,t=function(e,t,n){return c.call(M(e),n)})),t))for(;a<l;a++)t(e[a],n,o?i:i.call(e[a],a,t(e[a],n)));return r?e:c?t.call(e):l?t(e[0],n):s},te=/^-ms-/,ne=/-([a-z])/g;function ie(e,t){return t.toUpperCase()}function re(e){return e.replace(te,"ms-").replace(ne,ie)}var se=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function oe(){this.expando=M.expando+oe.uid++}oe.uid=1,oe.prototype={cache:function(e){var t=e[this.expando];return t||(t={},se(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,r=this.cache(e);if("string"==typeof t)r[re(t)]=n;else for(i in t)r[re(i)]=t[i];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][re(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){n=(t=Array.isArray(t)?t.map(re):(t=re(t))in i?[t]:t.match(q)||[]).length;for(;n--;)delete i[t[n]]}(void 0===t||M.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!M.isEmptyObject(t)}};var ae=new oe,le=new oe,ce=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ue=/[A-Z]/g;function he(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(ue,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ce.test(e)?JSON.parse(e):e)}(n)}catch(e){}le.set(e,t,n)}else n=void 0;return n}M.extend({hasData:function(e){return le.hasData(e)||ae.hasData(e)},data:function(e,t,n){return le.access(e,t,n)},removeData:function(e,t){le.remove(e,t)},_data:function(e,t,n){return ae.access(e,t,n)},_removeData:function(e,t){ae.remove(e,t)}}),M.fn.extend({data:function(e,t){var n,i,r,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(r=le.get(s),1===s.nodeType&&!ae.get(s,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(i=o[n].name).indexOf("data-")&&(i=re(i.slice(5)),he(s,i,r[i]));ae.set(s,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each((function(){le.set(this,e)})):ee(this,(function(t){var n;if(s&&void 0===t)return void 0!==(n=le.get(s,e))||void 0!==(n=he(s,e))?n:void 0;this.each((function(){le.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){le.remove(this,e)}))}}),M.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=ae.get(e,t),n&&(!i||Array.isArray(n)?i=ae.access(e,t,M.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=M.queue(e,t),i=n.length,r=n.shift(),s=M._queueHooks(e,t);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete s.stop,r.call(e,(function(){M.dequeue(e,t)}),s)),!i&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ae.get(e,n)||ae.access(e,n,{empty:M.Callbacks("once memory").add((function(){ae.remove(e,[t+"queue",n])}))})}}),M.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?M.queue(this[0],e):void 0===t?this:this.each((function(){var n=M.queue(this,e,t);M._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&M.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){M.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,r=M.Deferred(),s=this,o=this.length,a=function(){--i||r.resolveWith(s,[s])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(n=ae.get(s[o],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(a));return a(),r.promise(t)}});var de=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pe=new RegExp("^(?:([+-])=|)("+de+")([a-z%]*)$","i"),fe=["Top","Right","Bottom","Left"],me=y.documentElement,ge=function(e){return M.contains(e.ownerDocument,e)},_e={composed:!0};me.getRootNode&&(ge=function(e){return M.contains(e.ownerDocument,e)||e.getRootNode(_e)===e.ownerDocument});var ve=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ge(e)&&"none"===M.css(e,"display")};function ye(e,t,n,i){var r,s,o=20,a=i?function(){return i.cur()}:function(){return M.css(e,t,"")},l=a(),c=n&&n[3]||(M.cssNumber[t]?"":"px"),u=e.nodeType&&(M.cssNumber[t]||"px"!==c&&+l)&&pe.exec(M.css(e,t));if(u&&u[3]!==c){for(l/=2,c=c||u[3],u=+l||1;o--;)M.style(e,t,u+c),(1-s)*(1-(s=a()/l||.5))<=0&&(o=0),u/=s;u*=2,M.style(e,t,u+c),n=n||[]}return n&&(u=+u||+l||0,r=n[1]?u+(n[1]+1)*n[2]:+n[2],i&&(i.unit=c,i.start=u,i.end=r)),r}var be={};function xe(e){var t,n=e.ownerDocument,i=e.nodeName,r=be[i];return r||(t=n.body.appendChild(n.createElement(i)),r=M.css(t,"display"),t.parentNode.removeChild(t),"none"===r&&(r="block"),be[i]=r,r)}function we(e,t){for(var n,i,r=[],s=0,o=e.length;s<o;s++)(i=e[s]).style&&(n=i.style.display,t?("none"===n&&(r[s]=ae.get(i,"display")||null,r[s]||(i.style.display="")),""===i.style.display&&ve(i)&&(r[s]=xe(i))):"none"!==n&&(r[s]="none",ae.set(i,"display",n)));for(s=0;s<o;s++)null!=r[s]&&(e[s].style.display=r[s]);return e}M.fn.extend({show:function(){return we(this,!0)},hide:function(){return we(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ve(this)?M(this).show():M(this).hide()}))}});var Se,Ae,Me=/^(?:checkbox|radio)$/i,Ce=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Te=/^$|^module$|\/(?:java|ecma)script/i;Se=y.createDocumentFragment().appendChild(y.createElement("div")),(Ae=y.createElement("input")).setAttribute("type","radio"),Ae.setAttribute("checked","checked"),Ae.setAttribute("name","t"),Se.appendChild(Ae),g.checkClone=Se.cloneNode(!0).cloneNode(!0).lastChild.checked,Se.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!Se.cloneNode(!0).lastChild.defaultValue,Se.innerHTML="<option></option>",g.option=!!Se.lastChild;var Ee={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Pe(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&T(e,t)?M.merge([e],n):n}function Ie(e,t){for(var n=0,i=e.length;n<i;n++)ae.set(e[n],"globalEval",!t||ae.get(t[n],"globalEval"))}Ee.tbody=Ee.tfoot=Ee.colgroup=Ee.caption=Ee.thead,Ee.th=Ee.td,g.option||(Ee.optgroup=Ee.option=[1,"<select multiple='multiple'>","</select>"]);var ke=/<|&#?\w+;/;function Re(e,t,n,i,r){for(var s,o,a,l,c,u,h=t.createDocumentFragment(),d=[],p=0,f=e.length;p<f;p++)if((s=e[p])||0===s)if("object"===w(s))M.merge(d,s.nodeType?[s]:s);else if(ke.test(s)){for(o=o||h.appendChild(t.createElement("div")),a=(Ce.exec(s)||["",""])[1].toLowerCase(),l=Ee[a]||Ee._default,o.innerHTML=l[1]+M.htmlPrefilter(s)+l[2],u=l[0];u--;)o=o.lastChild;M.merge(d,o.childNodes),(o=h.firstChild).textContent=""}else d.push(t.createTextNode(s));for(h.textContent="",p=0;s=d[p++];)if(i&&M.inArray(s,i)>-1)r&&r.push(s);else if(c=ge(s),o=Pe(h.appendChild(s),"script"),c&&Ie(o),n)for(u=0;s=o[u++];)Te.test(s.type||"")&&n.push(s);return h}var De=/^([^.]*)(?:\.(.+)|)/;function Le(){return!0}function Oe(){return!1}function Ne(e,t,n,i,r,s){var o,a;if("object"==typeof t){for(a in"string"!=typeof n&&(i=i||n,n=void 0),t)Ne(e,a,n,i,t[a],s);return e}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),!1===r)r=Oe;else if(!r)return e;return 1===s&&(o=r,r=function(e){return M().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=M.guid++)),e.each((function(){M.event.add(this,t,r,i,n)}))}function Fe(e,t,n){n?(ae.set(e,t,!1),M.event.add(e,t,{namespace:!1,handler:function(e){var n,i=ae.get(this,t);if(1&e.isTrigger&&this[t]){if(i)(M.event.special[t]||{}).delegateType&&e.stopPropagation();else if(i=a.call(arguments),ae.set(this,t,i),this[t](),n=ae.get(this,t),ae.set(this,t,!1),i!==n)return e.stopImmediatePropagation(),e.preventDefault(),n}else i&&(ae.set(this,t,M.event.trigger(i[0],i.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Le)}})):void 0===ae.get(e,t)&&M.event.add(e,t,Le)}M.event={global:{},add:function(e,t,n,i,r){var s,o,a,l,c,u,h,d,p,f,m,g=ae.get(e);if(se(e))for(n.handler&&(n=(s=n).handler,r=s.selector),r&&M.find.matchesSelector(me,r),n.guid||(n.guid=M.guid++),(l=g.events)||(l=g.events=Object.create(null)),(o=g.handle)||(o=g.handle=function(t){return void 0!==M&&M.event.triggered!==t.type?M.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(q)||[""]).length;c--;)p=m=(a=De.exec(t[c])||[])[1],f=(a[2]||"").split(".").sort(),p&&(h=M.event.special[p]||{},p=(r?h.delegateType:h.bindType)||p,h=M.event.special[p]||{},u=M.extend({type:p,origType:m,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&M.expr.match.needsContext.test(r),namespace:f.join(".")},s),(d=l[p])||((d=l[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,i,f,o)||e.addEventListener&&e.addEventListener(p,o)),h.add&&(h.add.call(e,u),u.handler.guid||(u.handler.guid=n.guid)),r?d.splice(d.delegateCount++,0,u):d.push(u),M.event.global[p]=!0)},remove:function(e,t,n,i,r){var s,o,a,l,c,u,h,d,p,f,m,g=ae.hasData(e)&&ae.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(q)||[""]).length;c--;)if(p=m=(a=De.exec(t[c])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=M.event.special[p]||{},d=l[p=(i?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=d.length;s--;)u=d[s],!r&&m!==u.origType||n&&n.guid!==u.guid||a&&!a.test(u.namespace)||i&&i!==u.selector&&("**"!==i||!u.selector)||(d.splice(s,1),u.selector&&d.delegateCount--,h.remove&&h.remove.call(e,u));o&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,f,g.handle)||M.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)M.event.remove(e,p+t[c],n,i,!0);M.isEmptyObject(l)&&ae.remove(e,"handle events")}},dispatch:function(e){var t,n,i,r,s,o,a=new Array(arguments.length),l=M.event.fix(e),c=(ae.get(this,"events")||Object.create(null))[l.type]||[],u=M.event.special[l.type]||{};for(a[0]=l,t=1;t<arguments.length;t++)a[t]=arguments[t];if(l.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,l)){for(o=M.event.handlers.call(this,l,c),t=0;(r=o[t++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,n=0;(s=r.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==s.namespace&&!l.rnamespace.test(s.namespace)||(l.handleObj=s,l.data=s.data,void 0!==(i=((M.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,a))&&!1===(l.result=i)&&(l.preventDefault(),l.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,l),l.result}},handlers:function(e,t){var n,i,r,s,o,a=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(s=[],o={},n=0;n<l;n++)void 0===o[r=(i=t[n]).selector+" "]&&(o[r]=i.needsContext?M(r,this).index(c)>-1:M.find(r,this,null,[c]).length),o[r]&&s.push(i);s.length&&a.push({elem:c,handlers:s})}return c=this,l<t.length&&a.push({elem:c,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(M.Event.prototype,e,{enumerable:!0,configurable:!0,get:_(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[M.expando]?e:new M.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return Me.test(t.type)&&t.click&&T(t,"input")&&Fe(t,"click",!0),!1},trigger:function(e){var t=this||e;return Me.test(t.type)&&t.click&&T(t,"input")&&Fe(t,"click"),!0},_default:function(e){var t=e.target;return Me.test(t.type)&&t.click&&T(t,"input")&&ae.get(t,"click")||T(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},M.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},M.Event=function(e,t){if(!(this instanceof M.Event))return new M.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Le:Oe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&M.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[M.expando]=!0},M.Event.prototype={constructor:M.Event,isDefaultPrevented:Oe,isPropagationStopped:Oe,isImmediatePropagationStopped:Oe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Le,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Le,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Le,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},M.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},M.event.addProp),M.each({focus:"focusin",blur:"focusout"},(function(e,t){function n(e){if(y.documentMode){var n=ae.get(this,"handle"),i=M.event.fix(e);i.type="focusin"===e.type?"focus":"blur",i.isSimulated=!0,n(e),i.target===i.currentTarget&&n(i)}else M.event.simulate(t,e.target,M.event.fix(e))}M.event.special[e]={setup:function(){var i;if(Fe(this,e,!0),!y.documentMode)return!1;(i=ae.get(this,t))||this.addEventListener(t,n),ae.set(this,t,(i||0)+1)},trigger:function(){return Fe(this,e),!0},teardown:function(){var e;if(!y.documentMode)return!1;(e=ae.get(this,t)-1)?ae.set(this,t,e):(this.removeEventListener(t,n),ae.remove(this,t))},_default:function(t){return ae.get(t.target,e)},delegateType:t},M.event.special[t]={setup:function(){var i=this.ownerDocument||this.document||this,r=y.documentMode?this:i,s=ae.get(r,t);s||(y.documentMode?this.addEventListener(t,n):i.addEventListener(e,n,!0)),ae.set(r,t,(s||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,r=y.documentMode?this:i,s=ae.get(r,t)-1;s?ae.set(r,t,s):(y.documentMode?this.removeEventListener(t,n):i.removeEventListener(e,n,!0),ae.remove(r,t))}}})),M.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){M.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=e.relatedTarget,r=e.handleObj;return i&&(i===this||M.contains(this,i))||(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}})),M.fn.extend({on:function(e,t,n,i){return Ne(this,e,t,n,i)},one:function(e,t,n,i){return Ne(this,e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,M(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Oe),this.each((function(){M.event.remove(this,e,n,t)}))}});var Be=/<script|<style|<link/i,Ue=/checked\s*(?:[^=]|=\s*.checked.)/i,ze=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Ve(e,t){return T(e,"table")&&T(11!==t.nodeType?t:t.firstChild,"tr")&&M(e).children("tbody")[0]||e}function He(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function $e(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ge(e,t){var n,i,r,s,o,a;if(1===t.nodeType){if(ae.hasData(e)&&(a=ae.get(e).events))for(r in ae.remove(t,"handle events"),a)for(n=0,i=a[r].length;n<i;n++)M.event.add(t,r,a[r][n]);le.hasData(e)&&(s=le.access(e),o=M.extend({},s),le.set(t,o))}}function je(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Me.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function We(e,t,n,i){t=l(t);var r,s,o,a,c,u,h=0,d=e.length,p=d-1,f=t[0],m=_(f);if(m||d>1&&"string"==typeof f&&!g.checkClone&&Ue.test(f))return e.each((function(r){var s=e.eq(r);m&&(t[0]=f.call(this,r,s.html())),We(s,t,n,i)}));if(d&&(s=(r=Re(t,e[0].ownerDocument,!1,e,i)).firstChild,1===r.childNodes.length&&(r=s),s||i)){for(a=(o=M.map(Pe(r,"script"),He)).length;h<d;h++)c=r,h!==p&&(c=M.clone(c,!0,!0),a&&M.merge(o,Pe(c,"script"))),n.call(e[h],c,h);if(a)for(u=o[o.length-1].ownerDocument,M.map(o,$e),h=0;h<a;h++)c=o[h],Te.test(c.type||"")&&!ae.access(c,"globalEval")&&M.contains(u,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?M._evalUrl&&!c.noModule&&M._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},u):x(c.textContent.replace(ze,""),c,u))}return e}function qe(e,t,n){for(var i,r=t?M.filter(t,e):e,s=0;null!=(i=r[s]);s++)n||1!==i.nodeType||M.cleanData(Pe(i)),i.parentNode&&(n&&ge(i)&&Ie(Pe(i,"script")),i.parentNode.removeChild(i));return e}M.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var i,r,s,o,a=e.cloneNode(!0),l=ge(e);if(!(g.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||M.isXMLDoc(e)))for(o=Pe(a),i=0,r=(s=Pe(e)).length;i<r;i++)je(s[i],o[i]);if(t)if(n)for(s=s||Pe(e),o=o||Pe(a),i=0,r=s.length;i<r;i++)Ge(s[i],o[i]);else Ge(e,a);return(o=Pe(a,"script")).length>0&&Ie(o,!l&&Pe(e,"script")),a},cleanData:function(e){for(var t,n,i,r=M.event.special,s=0;void 0!==(n=e[s]);s++)if(se(n)){if(t=n[ae.expando]){if(t.events)for(i in t.events)r[i]?M.event.remove(n,i):M.removeEvent(n,i,t.handle);n[ae.expando]=void 0}n[le.expando]&&(n[le.expando]=void 0)}}}),M.fn.extend({detach:function(e){return qe(this,e,!0)},remove:function(e){return qe(this,e)},text:function(e){return ee(this,(function(e){return void 0===e?M.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return We(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ve(this,e).appendChild(e)}))},prepend:function(){return We(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ve(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return We(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return We(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(M.cleanData(Pe(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return M.clone(this,e,t)}))},html:function(e){return ee(this,(function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Be.test(e)&&!Ee[(Ce.exec(e)||["",""])[1].toLowerCase()]){e=M.htmlPrefilter(e);try{for(;n<i;n++)1===(t=this[n]||{}).nodeType&&(M.cleanData(Pe(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return We(this,arguments,(function(t){var n=this.parentNode;M.inArray(this,e)<0&&(M.cleanData(Pe(this)),n&&n.replaceChild(t,this))}),e)}}),M.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){M.fn[e]=function(e){for(var n,i=[],r=M(e),s=r.length-1,o=0;o<=s;o++)n=o===s?this:this.clone(!0),M(r[o])[t](n),c.apply(i,n.get());return this.pushStack(i)}}));var Xe=new RegExp("^("+de+")(?!px)[a-z%]+$","i"),Ye=/^--/,Ke=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=i),t.getComputedStyle(e)},Ze=function(e,t,n){var i,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];for(r in i=n.call(e),t)e.style[r]=s[r];return i},Qe=new RegExp(fe.join("|"),"i");function Je(e,t,n){var i,r,s,o,a=Ye.test(t),l=e.style;return(n=n||Ke(e))&&(o=n.getPropertyValue(t)||n[t],a&&o&&(o=o.replace(R,"$1")||void 0),""!==o||ge(e)||(o=M.style(e,t)),!g.pixelBoxStyles()&&Xe.test(o)&&Qe.test(t)&&(i=l.width,r=l.minWidth,s=l.maxWidth,l.minWidth=l.maxWidth=l.width=o,o=n.width,l.width=i,l.minWidth=r,l.maxWidth=s)),void 0!==o?o+"":o}function et(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(u){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",me.appendChild(c).appendChild(u);var e=i.getComputedStyle(u);n="1%"!==e.top,l=12===t(e.marginLeft),u.style.right="60%",o=36===t(e.right),r=36===t(e.width),u.style.position="absolute",s=12===t(u.offsetWidth/3),me.removeChild(c),u=null}}function t(e){return Math.round(parseFloat(e))}var n,r,s,o,a,l,c=y.createElement("div"),u=y.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===u.style.backgroundClip,M.extend(g,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=y.createElement("table"),t=y.createElement("tr"),n=y.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",me.appendChild(e).appendChild(t).appendChild(n),r=i.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,me.removeChild(e)),a}}))}();var tt=["Webkit","Moz","ms"],nt=y.createElement("div").style,it={};function rt(e){return M.cssProps[e]||it[e]||(e in nt?e:it[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=tt.length;n--;)if((e=tt[n]+t)in nt)return e}(e)||e)}var st=/^(none|table(?!-c[ea]).+)/,ot={position:"absolute",visibility:"hidden",display:"block"},at={letterSpacing:"0",fontWeight:"400"};function lt(e,t,n){var i=pe.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function ct(e,t,n,i,r,s){var o="width"===t?1:0,a=0,l=0,c=0;if(n===(i?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(c+=M.css(e,n+fe[o],!0,r)),i?("content"===n&&(l-=M.css(e,"padding"+fe[o],!0,r)),"margin"!==n&&(l-=M.css(e,"border"+fe[o]+"Width",!0,r))):(l+=M.css(e,"padding"+fe[o],!0,r),"padding"!==n?l+=M.css(e,"border"+fe[o]+"Width",!0,r):a+=M.css(e,"border"+fe[o]+"Width",!0,r));return!i&&s>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-l-a-.5))||0),l+c}function ut(e,t,n){var i=Ke(e),r=(!g.boxSizingReliable()||n)&&"border-box"===M.css(e,"boxSizing",!1,i),s=r,o=Je(e,t,i),a="offset"+t[0].toUpperCase()+t.slice(1);if(Xe.test(o)){if(!n)return o;o="auto"}return(!g.boxSizingReliable()&&r||!g.reliableTrDimensions()&&T(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===M.css(e,"display",!1,i))&&e.getClientRects().length&&(r="border-box"===M.css(e,"boxSizing",!1,i),(s=a in e)&&(o=e[a])),(o=parseFloat(o)||0)+ct(e,t,n||(r?"border":"content"),s,i,o)+"px"}function ht(e,t,n,i,r){return new ht.prototype.init(e,t,n,i,r)}M.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Je(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,s,o,a=re(t),l=Ye.test(t),c=e.style;if(l||(t=rt(a)),o=M.cssHooks[t]||M.cssHooks[a],void 0===n)return o&&"get"in o&&void 0!==(r=o.get(e,!1,i))?r:c[t];"string"==(s=typeof n)&&(r=pe.exec(n))&&r[1]&&(n=ye(e,t,r),s="number"),null!=n&&n==n&&("number"!==s||l||(n+=r&&r[3]||(M.cssNumber[a]?"":"px")),g.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,i))||(l?c.setProperty(t,n):c[t]=n))}},css:function(e,t,n,i){var r,s,o,a=re(t);return Ye.test(t)||(t=rt(a)),(o=M.cssHooks[t]||M.cssHooks[a])&&"get"in o&&(r=o.get(e,!0,n)),void 0===r&&(r=Je(e,t,i)),"normal"===r&&t in at&&(r=at[t]),""===n||n?(s=parseFloat(r),!0===n||isFinite(s)?s||0:r):r}}),M.each(["height","width"],(function(e,t){M.cssHooks[t]={get:function(e,n,i){if(n)return!st.test(M.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ut(e,t,i):Ze(e,ot,(function(){return ut(e,t,i)}))},set:function(e,n,i){var r,s=Ke(e),o=!g.scrollboxSize()&&"absolute"===s.position,a=(o||i)&&"border-box"===M.css(e,"boxSizing",!1,s),l=i?ct(e,t,i,a,s):0;return a&&o&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(s[t])-ct(e,t,"border",!1,s)-.5)),l&&(r=pe.exec(n))&&"px"!==(r[3]||"px")&&(e.style[t]=n,n=M.css(e,t)),lt(0,n,l)}}})),M.cssHooks.marginLeft=et(g.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Je(e,"marginLeft"))||e.getBoundingClientRect().left-Ze(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),M.each({margin:"",padding:"",border:"Width"},(function(e,t){M.cssHooks[e+t]={expand:function(n){for(var i=0,r={},s="string"==typeof n?n.split(" "):[n];i<4;i++)r[e+fe[i]+t]=s[i]||s[i-2]||s[0];return r}},"margin"!==e&&(M.cssHooks[e+t].set=lt)})),M.fn.extend({css:function(e,t){return ee(this,(function(e,t,n){var i,r,s={},o=0;if(Array.isArray(t)){for(i=Ke(e),r=t.length;o<r;o++)s[t[o]]=M.css(e,t[o],!1,i);return s}return void 0!==n?M.style(e,t,n):M.css(e,t)}),e,t,arguments.length>1)}}),M.Tween=ht,ht.prototype={constructor:ht,init:function(e,t,n,i,r,s){this.elem=e,this.prop=n,this.easing=r||M.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=s||(M.cssNumber[n]?"":"px")},cur:function(){var e=ht.propHooks[this.prop];return e&&e.get?e.get(this):ht.propHooks._default.get(this)},run:function(e){var t,n=ht.propHooks[this.prop];return this.options.duration?this.pos=t=M.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ht.propHooks._default.set(this),this}},ht.prototype.init.prototype=ht.prototype,ht.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=M.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){M.fx.step[e.prop]?M.fx.step[e.prop](e):1!==e.elem.nodeType||!M.cssHooks[e.prop]&&null==e.elem.style[rt(e.prop)]?e.elem[e.prop]=e.now:M.style(e.elem,e.prop,e.now+e.unit)}}},ht.propHooks.scrollTop=ht.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},M.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},M.fx=ht.prototype.init,M.fx.step={};var dt,pt,ft=/^(?:toggle|show|hide)$/,mt=/queueHooks$/;function gt(){pt&&(!1===y.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(gt):i.setTimeout(gt,M.fx.interval),M.fx.tick())}function _t(){return i.setTimeout((function(){dt=void 0})),dt=Date.now()}function vt(e,t){var n,i=0,r={height:e};for(t=t?1:0;i<4;i+=2-t)r["margin"+(n=fe[i])]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function yt(e,t,n){for(var i,r=(bt.tweeners[t]||[]).concat(bt.tweeners["*"]),s=0,o=r.length;s<o;s++)if(i=r[s].call(n,t,e))return i}function bt(e,t,n){var i,r,s=0,o=bt.prefilters.length,a=M.Deferred().always((function(){delete l.elem})),l=function(){if(r)return!1;for(var t=dt||_t(),n=Math.max(0,c.startTime+c.duration-t),i=1-(n/c.duration||0),s=0,o=c.tweens.length;s<o;s++)c.tweens[s].run(i);return a.notifyWith(e,[c,i,n]),i<1&&o?n:(o||a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:M.extend({},t),opts:M.extend(!0,{specialEasing:{},easing:M.easing._default},n),originalProperties:t,originalOptions:n,startTime:dt||_t(),duration:n.duration,tweens:[],createTween:function(t,n){var i=M.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(i),i},stop:function(t){var n=0,i=t?c.tweens.length:0;if(r)return this;for(r=!0;n<i;n++)c.tweens[n].run(1);return t?(a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c,t])):a.rejectWith(e,[c,t]),this}}),u=c.props;for(function(e,t){var n,i,r,s,o;for(n in e)if(r=t[i=re(n)],s=e[n],Array.isArray(s)&&(r=s[1],s=e[n]=s[0]),n!==i&&(e[i]=s,delete e[n]),(o=M.cssHooks[i])&&"expand"in o)for(n in s=o.expand(s),delete e[i],s)n in e||(e[n]=s[n],t[n]=r);else t[i]=r}(u,c.opts.specialEasing);s<o;s++)if(i=bt.prefilters[s].call(c,e,u,c.opts))return _(i.stop)&&(M._queueHooks(c.elem,c.opts.queue).stop=i.stop.bind(i)),i;return M.map(u,yt,c),_(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),M.fx.timer(M.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}M.Animation=M.extend(bt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ye(n.elem,e,pe.exec(t),n),n}]},tweener:function(e,t){_(e)?(t=e,e=["*"]):e=e.match(q);for(var n,i=0,r=e.length;i<r;i++)n=e[i],bt.tweeners[n]=bt.tweeners[n]||[],bt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var i,r,s,o,a,l,c,u,h="width"in t||"height"in t,d=this,p={},f=e.style,m=e.nodeType&&ve(e),g=ae.get(e,"fxshow");for(i in n.queue||(null==(o=M._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,d.always((function(){d.always((function(){o.unqueued--,M.queue(e,"fx").length||o.empty.fire()}))}))),t)if(r=t[i],ft.test(r)){if(delete t[i],s=s||"toggle"===r,r===(m?"hide":"show")){if("show"!==r||!g||void 0===g[i])continue;m=!0}p[i]=g&&g[i]||M.style(e,i)}if((l=!M.isEmptyObject(t))||!M.isEmptyObject(p))for(i in h&&1===e.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=g&&g.display)&&(c=ae.get(e,"display")),"none"===(u=M.css(e,"display"))&&(c?u=c:(we([e],!0),c=e.style.display||c,u=M.css(e,"display"),we([e]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===M.css(e,"float")&&(l||(d.done((function(){f.display=c})),null==c&&(u=f.display,c="none"===u?"":u)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),l=!1,p)l||(g?"hidden"in g&&(m=g.hidden):g=ae.access(e,"fxshow",{display:c}),s&&(g.hidden=!m),m&&we([e],!0),d.done((function(){for(i in m||we([e]),ae.remove(e,"fxshow"),p)M.style(e,i,p[i])}))),l=yt(m?g[i]:0,i,d),i in g||(g[i]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?bt.prefilters.unshift(e):bt.prefilters.push(e)}}),M.speed=function(e,t,n){var i=e&&"object"==typeof e?M.extend({},e):{complete:n||!n&&t||_(e)&&e,duration:e,easing:n&&t||t&&!_(t)&&t};return M.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in M.fx.speeds?i.duration=M.fx.speeds[i.duration]:i.duration=M.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){_(i.old)&&i.old.call(this),i.queue&&M.dequeue(this,i.queue)},i},M.fn.extend({fadeTo:function(e,t,n,i){return this.filter(ve).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=M.isEmptyObject(e),s=M.speed(t,n,i),o=function(){var t=bt(this,M.extend({},e),s);(r||ae.get(this,"finish"))&&t.stop(!0)};return o.finish=o,r||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,r=null!=e&&e+"queueHooks",s=M.timers,o=ae.get(this);if(r)o[r]&&o[r].stop&&i(o[r]);else for(r in o)o[r]&&o[r].stop&&mt.test(r)&&i(o[r]);for(r=s.length;r--;)s[r].elem!==this||null!=e&&s[r].queue!==e||(s[r].anim.stop(n),t=!1,s.splice(r,1));!t&&n||M.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=ae.get(this),i=n[e+"queue"],r=n[e+"queueHooks"],s=M.timers,o=i?i.length:0;for(n.finish=!0,M.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish}))}}),M.each(["toggle","show","hide"],(function(e,t){var n=M.fn[t];M.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(vt(t,!0),e,i,r)}})),M.each({slideDown:vt("show"),slideUp:vt("hide"),slideToggle:vt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){M.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}})),M.timers=[],M.fx.tick=function(){var e,t=0,n=M.timers;for(dt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||M.fx.stop(),dt=void 0},M.fx.timer=function(e){M.timers.push(e),M.fx.start()},M.fx.interval=13,M.fx.start=function(){pt||(pt=!0,gt())},M.fx.stop=function(){pt=null},M.fx.speeds={slow:600,fast:200,_default:400},M.fn.delay=function(e,t){return e=M.fx&&M.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,n){var r=i.setTimeout(t,e);n.stop=function(){i.clearTimeout(r)}}))},function(){var e=y.createElement("input"),t=y.createElement("select").appendChild(y.createElement("option"));e.type="checkbox",g.checkOn=""!==e.value,g.optSelected=t.selected,(e=y.createElement("input")).value="t",e.type="radio",g.radioValue="t"===e.value}();var xt,wt=M.expr.attrHandle;M.fn.extend({attr:function(e,t){return ee(this,M.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){M.removeAttr(this,e)}))}}),M.extend({attr:function(e,t,n){var i,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?M.prop(e,t,n):(1===s&&M.isXMLDoc(e)||(r=M.attrHooks[t.toLowerCase()]||(M.expr.match.bool.test(t)?xt:void 0)),void 0!==n?null===n?void M.removeAttr(e,t):r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):r&&"get"in r&&null!==(i=r.get(e,t))?i:null==(i=M.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){if(!g.radioValue&&"radio"===t&&T(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,i=0,r=t&&t.match(q);if(r&&1===e.nodeType)for(;n=r[i++];)e.removeAttribute(n)}}),xt={set:function(e,t,n){return!1===t?M.removeAttr(e,n):e.setAttribute(n,n),n}},M.each(M.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=wt[t]||M.find.attr;wt[t]=function(e,t,i){var r,s,o=t.toLowerCase();return i||(s=wt[o],wt[o]=r,r=null!=n(e,t,i)?o:null,wt[o]=s),r}}));var St=/^(?:input|select|textarea|button)$/i,At=/^(?:a|area)$/i;function Mt(e){return(e.match(q)||[]).join(" ")}function Ct(e){return e.getAttribute&&e.getAttribute("class")||""}function Tt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(q)||[]}M.fn.extend({prop:function(e,t){return ee(this,M.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[M.propFix[e]||e]}))}}),M.extend({prop:function(e,t,n){var i,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&M.isXMLDoc(e)||(t=M.propFix[t]||t,r=M.propHooks[t]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:e[t]=n:r&&"get"in r&&null!==(i=r.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=M.find.attr(e,"tabindex");return t?parseInt(t,10):St.test(e.nodeName)||At.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(M.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),M.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){M.propFix[this.toLowerCase()]=this})),M.fn.extend({addClass:function(e){var t,n,i,r,s,o;return _(e)?this.each((function(t){M(this).addClass(e.call(this,t,Ct(this)))})):(t=Tt(e)).length?this.each((function(){if(i=Ct(this),n=1===this.nodeType&&" "+Mt(i)+" "){for(s=0;s<t.length;s++)r=t[s],n.indexOf(" "+r+" ")<0&&(n+=r+" ");o=Mt(n),i!==o&&this.setAttribute("class",o)}})):this},removeClass:function(e){var t,n,i,r,s,o;return _(e)?this.each((function(t){M(this).removeClass(e.call(this,t,Ct(this)))})):arguments.length?(t=Tt(e)).length?this.each((function(){if(i=Ct(this),n=1===this.nodeType&&" "+Mt(i)+" "){for(s=0;s<t.length;s++)for(r=t[s];n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");o=Mt(n),i!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(e,t){var n,i,r,s,o=typeof e,a="string"===o||Array.isArray(e);return _(e)?this.each((function(n){M(this).toggleClass(e.call(this,n,Ct(this),t),t)})):"boolean"==typeof t&&a?t?this.addClass(e):this.removeClass(e):(n=Tt(e),this.each((function(){if(a)for(s=M(this),r=0;r<n.length;r++)i=n[r],s.hasClass(i)?s.removeClass(i):s.addClass(i);else void 0!==e&&"boolean"!==o||((i=Ct(this))&&ae.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===e?"":ae.get(this,"__className__")||""))})))},hasClass:function(e){var t,n,i=0;for(t=" "+e+" ";n=this[i++];)if(1===n.nodeType&&(" "+Mt(Ct(n))+" ").indexOf(t)>-1)return!0;return!1}});var Et=/\r/g;M.fn.extend({val:function(e){var t,n,i,r=this[0];return arguments.length?(i=_(e),this.each((function(n){var r;1===this.nodeType&&(null==(r=i?e.call(this,n,M(this).val()):e)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=M.map(r,(function(e){return null==e?"":e+""}))),(t=M.valHooks[this.type]||M.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))}))):r?(t=M.valHooks[r.type]||M.valHooks[r.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(r,"value"))?n:"string"==typeof(n=r.value)?n.replace(Et,""):null==n?"":n:void 0}}),M.extend({valHooks:{option:{get:function(e){var t=M.find.attr(e,"value");return null!=t?t:Mt(M.text(e))}},select:{get:function(e){var t,n,i,r=e.options,s=e.selectedIndex,o="select-one"===e.type,a=o?null:[],l=o?s+1:r.length;for(i=s<0?l:o?s:0;i<l;i++)if(((n=r[i]).selected||i===s)&&!n.disabled&&(!n.parentNode.disabled||!T(n.parentNode,"optgroup"))){if(t=M(n).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var n,i,r=e.options,s=M.makeArray(t),o=r.length;o--;)((i=r[o]).selected=M.inArray(M.valHooks.option.get(i),s)>-1)&&(n=!0);return n||(e.selectedIndex=-1),s}}}}),M.each(["radio","checkbox"],(function(){M.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=M.inArray(M(e).val(),t)>-1}},g.checkOn||(M.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}));var Pt=i.location,It={guid:Date.now()},kt=/\?/;M.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new i.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||M.error("Invalid XML: "+(n?M.map(n.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var Rt=/^(?:focusinfocus|focusoutblur)$/,Dt=function(e){e.stopPropagation()};M.extend(M.event,{trigger:function(e,t,n,r){var s,o,a,l,c,u,h,d,f=[n||y],m=p.call(e,"type")?e.type:e,g=p.call(e,"namespace")?e.namespace.split("."):[];if(o=d=a=n=n||y,3!==n.nodeType&&8!==n.nodeType&&!Rt.test(m+M.event.triggered)&&(m.indexOf(".")>-1&&(g=m.split("."),m=g.shift(),g.sort()),c=m.indexOf(":")<0&&"on"+m,(e=e[M.expando]?e:new M.Event(m,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=g.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:M.makeArray(t,[e]),h=M.event.special[m]||{},r||!h.trigger||!1!==h.trigger.apply(n,t))){if(!r&&!h.noBubble&&!v(n)){for(l=h.delegateType||m,Rt.test(l+m)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(n.ownerDocument||y)&&f.push(a.defaultView||a.parentWindow||i)}for(s=0;(o=f[s++])&&!e.isPropagationStopped();)d=o,e.type=s>1?l:h.bindType||m,(u=(ae.get(o,"events")||Object.create(null))[e.type]&&ae.get(o,"handle"))&&u.apply(o,t),(u=c&&o[c])&&u.apply&&se(o)&&(e.result=u.apply(o,t),!1===e.result&&e.preventDefault());return e.type=m,r||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(f.pop(),t)||!se(n)||c&&_(n[m])&&!v(n)&&((a=n[c])&&(n[c]=null),M.event.triggered=m,e.isPropagationStopped()&&d.addEventListener(m,Dt),n[m](),e.isPropagationStopped()&&d.removeEventListener(m,Dt),M.event.triggered=void 0,a&&(n[c]=a)),e.result}},simulate:function(e,t,n){var i=M.extend(new M.Event,n,{type:e,isSimulated:!0});M.event.trigger(i,null,t)}}),M.fn.extend({trigger:function(e,t){return this.each((function(){M.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return M.event.trigger(e,t,n,!0)}});var Lt=/\[\]$/,Ot=/\r?\n/g,Nt=/^(?:submit|button|image|reset|file)$/i,Ft=/^(?:input|select|textarea|keygen)/i;function Bt(e,t,n,i){var r;if(Array.isArray(t))M.each(t,(function(t,r){n||Lt.test(e)?i(e,r):Bt(e+"["+("object"==typeof r&&null!=r?t:"")+"]",r,n,i)}));else if(n||"object"!==w(t))i(e,t);else for(r in t)Bt(e+"["+r+"]",t[r],n,i)}M.param=function(e,t){var n,i=[],r=function(e,t){var n=_(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!M.isPlainObject(e))M.each(e,(function(){r(this.name,this.value)}));else for(n in e)Bt(n,e[n],t,r);return i.join("&")},M.fn.extend({serialize:function(){return M.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=M.prop(this,"elements");return e?M.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!M(this).is(":disabled")&&Ft.test(this.nodeName)&&!Nt.test(e)&&(this.checked||!Me.test(e))})).map((function(e,t){var n=M(this).val();return null==n?null:Array.isArray(n)?M.map(n,(function(e){return{name:t.name,value:e.replace(Ot,"\r\n")}})):{name:t.name,value:n.replace(Ot,"\r\n")}})).get()}});var Ut=/%20/g,zt=/#.*$/,Vt=/([?&])_=[^&]*/,Ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,$t=/^(?:GET|HEAD)$/,Gt=/^\/\//,jt={},Wt={},qt="*/".concat("*"),Xt=y.createElement("a");function Yt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,s=t.toLowerCase().match(q)||[];if(_(n))for(;i=s[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function Kt(e,t,n,i){var r={},s=e===Wt;function o(a){var l;return r[a]=!0,M.each(e[a]||[],(function(e,a){var c=a(t,n,i);return"string"!=typeof c||s||r[c]?s?!(l=c):void 0:(t.dataTypes.unshift(c),o(c),!1)})),l}return o(t.dataTypes[0])||!r["*"]&&o("*")}function Zt(e,t){var n,i,r=M.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i||(i={}))[n]=t[n]);return i&&M.extend(!0,e,i),e}Xt.href=Pt.href,M.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Pt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Pt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":M.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Zt(Zt(e,M.ajaxSettings),t):Zt(M.ajaxSettings,e)},ajaxPrefilter:Yt(jt),ajaxTransport:Yt(Wt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,s,o,a,l,c,u,h,d,p=M.ajaxSetup({},t),f=p.context||p,m=p.context&&(f.nodeType||f.jquery)?M(f):M.event,g=M.Deferred(),_=M.Callbacks("once memory"),v=p.statusCode||{},b={},x={},w="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(c){if(!o)for(o={};t=Ht.exec(s);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return c?s:null},setRequestHeader:function(e,t){return null==c&&(e=x[e.toLowerCase()]=x[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)S.always(e[S.status]);else for(t in e)v[t]=[v[t],e[t]];return this},abort:function(e){var t=e||w;return n&&n.abort(t),A(0,t),this}};if(g.promise(S),p.url=((e||p.url||Pt.href)+"").replace(Gt,Pt.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(q)||[""],null==p.crossDomain){l=y.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Xt.protocol+"//"+Xt.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=M.param(p.data,p.traditional)),Kt(jt,p,t,S),c)return S;for(h in(u=M.event&&p.global)&&0==M.active++&&M.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!$t.test(p.type),r=p.url.replace(zt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Ut,"+")):(d=p.url.slice(r.length),p.data&&(p.processData||"string"==typeof p.data)&&(r+=(kt.test(r)?"&":"?")+p.data,delete p.data),!1===p.cache&&(r=r.replace(Vt,"$1"),d=(kt.test(r)?"&":"?")+"_="+It.guid+++d),p.url=r+d),p.ifModified&&(M.lastModified[r]&&S.setRequestHeader("If-Modified-Since",M.lastModified[r]),M.etag[r]&&S.setRequestHeader("If-None-Match",M.etag[r])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&S.setRequestHeader("Content-Type",p.contentType),S.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+qt+"; q=0.01":""):p.accepts["*"]),p.headers)S.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(f,S,p)||c))return S.abort();if(w="abort",_.add(p.complete),S.done(p.success),S.fail(p.error),n=Kt(Wt,p,t,S)){if(S.readyState=1,u&&m.trigger("ajaxSend",[S,p]),c)return S;p.async&&p.timeout>0&&(a=i.setTimeout((function(){S.abort("timeout")}),p.timeout));try{c=!1,n.send(b,A)}catch(e){if(c)throw e;A(-1,e)}}else A(-1,"No Transport");function A(e,t,o,l){var h,d,y,b,x,w=t;c||(c=!0,a&&i.clearTimeout(a),n=void 0,s=l||"",S.readyState=e>0?4:0,h=e>=200&&e<300||304===e,o&&(b=function(e,t,n){for(var i,r,s,o,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(r in a)if(a[r]&&a[r].test(i)){l.unshift(r);break}if(l[0]in n)s=l[0];else{for(r in n){if(!l[0]||e.converters[r+" "+l[0]]){s=r;break}o||(o=r)}s=s||o}if(s)return s!==l[0]&&l.unshift(s),n[s]}(p,S,o)),!h&&M.inArray("script",p.dataTypes)>-1&&M.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),b=function(e,t,n,i){var r,s,o,a,l,c={},u=e.dataTypes.slice();if(u[1])for(o in e.converters)c[o.toLowerCase()]=e.converters[o];for(s=u.shift();s;)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=s,s=u.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(o=c[l+" "+s]||c["* "+s]))for(r in c)if((a=r.split(" "))[1]===s&&(o=c[l+" "+a[0]]||c["* "+a[0]])){!0===o?o=c[r]:!0!==c[r]&&(s=a[0],u.unshift(a[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+l+" to "+s}}}return{state:"success",data:t}}(p,b,S,h),h?(p.ifModified&&((x=S.getResponseHeader("Last-Modified"))&&(M.lastModified[r]=x),(x=S.getResponseHeader("etag"))&&(M.etag[r]=x)),204===e||"HEAD"===p.type?w="nocontent":304===e?w="notmodified":(w=b.state,d=b.data,h=!(y=b.error))):(y=w,!e&&w||(w="error",e<0&&(e=0))),S.status=e,S.statusText=(t||w)+"",h?g.resolveWith(f,[d,w,S]):g.rejectWith(f,[S,w,y]),S.statusCode(v),v=void 0,u&&m.trigger(h?"ajaxSuccess":"ajaxError",[S,p,h?d:y]),_.fireWith(f,[S,w]),u&&(m.trigger("ajaxComplete",[S,p]),--M.active||M.event.trigger("ajaxStop")))}return S},getJSON:function(e,t,n){return M.get(e,t,n,"json")},getScript:function(e,t){return M.get(e,void 0,t,"script")}}),M.each(["get","post"],(function(e,t){M[t]=function(e,n,i,r){return _(n)&&(r=r||i,i=n,n=void 0),M.ajax(M.extend({url:e,type:t,dataType:r,data:n,success:i},M.isPlainObject(e)&&e))}})),M.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),M._evalUrl=function(e,t,n){return M.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){M.globalEval(e,t,n)}})},M.fn.extend({wrapAll:function(e){var t;return this[0]&&(_(e)&&(e=e.call(this[0])),t=M(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return _(e)?this.each((function(t){M(this).wrapInner(e.call(this,t))})):this.each((function(){var t=M(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=_(e);return this.each((function(n){M(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){M(this).replaceWith(this.childNodes)})),this}}),M.expr.pseudos.hidden=function(e){return!M.expr.pseudos.visible(e)},M.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},M.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(e){}};var Qt={0:200,1223:204},Jt=M.ajaxSettings.xhr();g.cors=!!Jt&&"withCredentials"in Jt,g.ajax=Jt=!!Jt,M.ajaxTransport((function(e){var t,n;if(g.cors||Jt&&!e.crossDomain)return{send:function(r,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)a.setRequestHeader(o,r[o]);t=function(e){return function(){t&&(t=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(Qt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),n=a.onerror=a.ontimeout=t("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){t&&n()}))},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),M.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),M.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return M.globalEval(e),e}}}),M.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),M.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(i,r){t=M("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&r("error"===e.type?404:200,e.type)}),y.head.appendChild(t[0])},abort:function(){n&&n()}}}));var en,tn=[],nn=/(=)\?(?=&|$)|\?\?/;M.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tn.pop()||M.expando+"_"+It.guid++;return this[e]=!0,e}}),M.ajaxPrefilter("json jsonp",(function(e,t,n){var r,s,o,a=!1!==e.jsonp&&(nn.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&nn.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=_(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(nn,"$1"+r):!1!==e.jsonp&&(e.url+=(kt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||M.error(r+" was not called"),o[0]},e.dataTypes[0]="json",s=i[r],i[r]=function(){o=arguments},n.always((function(){void 0===s?M(i).removeProp(r):i[r]=s,e[r]&&(e.jsonpCallback=t.jsonpCallback,tn.push(r)),o&&_(s)&&s(o[0]),o=s=void 0})),"script"})),g.createHTMLDocument=((en=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===en.childNodes.length),M.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(g.createHTMLDocument?((i=(t=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,t.head.appendChild(i)):t=y),s=!n&&[],(r=z.exec(e))?[t.createElement(r[1])]:(r=Re([e],t,s),s&&s.length&&M(s).remove(),M.merge([],r.childNodes)));var i,r,s},M.fn.load=function(e,t,n){var i,r,s,o=this,a=e.indexOf(" ");return a>-1&&(i=Mt(e.slice(a)),e=e.slice(0,a)),_(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),o.length>0&&M.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done((function(e){s=arguments,o.html(i?M("<div>").append(M.parseHTML(e)).find(i):e)})).always(n&&function(e,t){o.each((function(){n.apply(this,s||[e.responseText,t,e])}))}),this},M.expr.pseudos.animated=function(e){return M.grep(M.timers,(function(t){return e===t.elem})).length},M.offset={setOffset:function(e,t,n){var i,r,s,o,a,l,c=M.css(e,"position"),u=M(e),h={};"static"===c&&(e.style.position="relative"),a=u.offset(),s=M.css(e,"top"),l=M.css(e,"left"),("absolute"===c||"fixed"===c)&&(s+l).indexOf("auto")>-1?(o=(i=u.position()).top,r=i.left):(o=parseFloat(s)||0,r=parseFloat(l)||0),_(t)&&(t=t.call(e,n,M.extend({},a))),null!=t.top&&(h.top=t.top-a.top+o),null!=t.left&&(h.left=t.left-a.left+r),"using"in t?t.using.call(e,h):u.css(h)}},M.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){M.offset.setOffset(this,e,t)}));var t,n,i=this[0];return i?i.getClientRects().length?(t=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,i=this[0],r={top:0,left:0};if("fixed"===M.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),n=i.ownerDocument,e=i.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===M.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((r=M(e).offset()).top+=M.css(e,"borderTopWidth",!0),r.left+=M.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-M.css(i,"marginTop",!0),left:t.left-r.left-M.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===M.css(e,"position");)e=e.offsetParent;return e||me}))}}),M.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;M.fn[e]=function(i){return ee(this,(function(e,i,r){var s;if(v(e)?s=e:9===e.nodeType&&(s=e.defaultView),void 0===r)return s?s[t]:e[i];s?s.scrollTo(n?s.pageXOffset:r,n?r:s.pageYOffset):e[i]=r}),e,i,arguments.length)}})),M.each(["top","left"],(function(e,t){M.cssHooks[t]=et(g.pixelPosition,(function(e,n){if(n)return n=Je(e,t),Xe.test(n)?M(e).position()[t]+"px":n}))})),M.each({Height:"height",Width:"width"},(function(e,t){M.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,i){M.fn[i]=function(r,s){var o=arguments.length&&(n||"boolean"!=typeof r),a=n||(!0===r||!0===s?"margin":"border");return ee(this,(function(t,n,r){var s;return v(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===r?M.css(t,n,a):M.style(t,n,r,a)}),t,o?r:void 0,o)}}))})),M.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){M.fn[t]=function(e){return this.on(t,e)}})),M.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),M.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){M.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var rn=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;M.proxy=function(e,t){var n,i,r;if("string"==typeof t&&(n=e[t],t=e,e=n),_(e))return i=a.call(arguments,2),r=function(){return e.apply(t||this,i.concat(a.call(arguments)))},r.guid=e.guid=e.guid||M.guid++,r},M.holdReady=function(e){e?M.readyWait++:M.ready(!0)},M.isArray=Array.isArray,M.parseJSON=JSON.parse,M.nodeName=T,M.isFunction=_,M.isWindow=v,M.camelCase=re,M.type=w,M.now=Date.now,M.isNumeric=function(e){var t=M.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},M.trim=function(e){return null==e?"":(e+"").replace(rn,"$1")},void 0===(n=function(){return M}.apply(t,[]))||(e.exports=n);var sn=i.jQuery,on=i.$;return M.noConflict=function(e){return i.$===M&&(i.$=on),e&&i.jQuery===M&&(i.jQuery=sn),M},void 0===r&&(i.jQuery=i.$=M),M}))},485:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AngleRepresentation:()=>$_,ArrowBuffer:()=>py,Assembly:()=>Kf,AxesRepresentation:()=>rv,BackboneRepresentation:()=>ov,BallAndStickRepresentation:()=>sv,BaseRepresentation:()=>av,Box3:()=>pt,BoxBuffer:()=>vy,BufferRepresentation:()=>Hm,CartoonRepresentation:()=>fv,Collection:()=>wg,Color:()=>Pn,Colormaker:()=>sl,ColormakerRegistry:()=>ic,Component:()=>xg,ComponentCollection:()=>Gg,ConeBuffer:()=>uy,ContactRepresentation:()=>mv,Counter:()=>Rc,CylinderBuffer:()=>iv,DatasourceRegistry:()=>rc,Debug:()=>Ql,DecompressorRegistry:()=>lc,DihedralHistogramRepresentation:()=>yv,DihedralRepresentation:()=>gv,DistanceRepresentation:()=>xv,EllipsoidBuffer:()=>Ay,Euler:()=>Kt,Frames:()=>Cg,HelixorientRepresentation:()=>Mv,HyperballRepresentation:()=>Lv,Kdtree:()=>jf,KeyActions:()=>df,LabelRepresentation:()=>Nv,LeftMouseButton:()=>yu,LicoriceRepresentation:()=>Cv,LineRepresentation:()=>Bv,ListingDatasource:()=>dc,Matrix3:()=>Fe,Matrix4:()=>zt,MdsrvDatasource:()=>YM,MeasurementDefaultParams:()=>Kl,MeshBuffer:()=>ef,MiddleMouseButton:()=>bu,MolecularSurface:()=>$v,MolecularSurfaceRepresentation:()=>Gv,MouseActions:()=>lf,OctahedronBuffer:()=>Py,ParserRegistry:()=>oc,PdbWriter:()=>Tc,PickingProxy:()=>Fu,Plane:()=>Ei,PointBuffer:()=>rg,PointRepresentation:()=>jv,Quaternion:()=>ct,Queue:()=>rh,RepresentationCollection:()=>Sg,RepresentationElement:()=>_g,RepresentationRegistry:()=>sc,RibbonRepresentation:()=>Yv,RightMouseButton:()=>xu,RocketRepresentation:()=>Kv,RopeRepresentation:()=>Zv,ScriptExtensions:()=>tc,SdfWriter:()=>Ec,Selection:()=>Ll,Shape:()=>Vm,ShapeComponent:()=>Yg,Signal:()=>va.Signal,SpacefillRepresentation:()=>Qv,SpatialHash:()=>Yh,SphereBuffer:()=>eg,Stage:()=>Xg,StaticDatasource:()=>XM,StlWriter:()=>kc,Structure:()=>Fm,StructureComponent:()=>Vg,StructureComponentDefaultParameters:()=>zg,StructureRepresentation:()=>T_,Superposition:()=>Tg,SurfaceComponent:()=>Hg,TetrahedronBuffer:()=>Ly,TextBuffer:()=>U_,TorusBuffer:()=>zy,TraceRepresentation:()=>ty,TrajectoryDatasource:()=>pc,TrajectoryPlayer:()=>Pg,TubeRepresentation:()=>ny,UIStageParameters:()=>eC,UnitcellRepresentation:()=>iy,ValidationRepresentation:()=>ry,Vector2:()=>Ne,Vector3:()=>ut,Version:()=>tC,Viewer:()=>vu,Volume:()=>qp,VolumeComponent:()=>$g,WidelineBuffer:()=>H_,autoLoad:()=>Mc,concatStructures:()=>fm,download:()=>Ia,flatten:()=>Ta,getDataInfo:()=>Ac,getFileInfo:()=>Sc,getQuery:()=>Sa,guessElement:()=>dm,setDebug:()=>ec,setListingDatasource:()=>fc,setMeasurementDefaultParams:()=>Zl,setTrajectoryDatasource:()=>mc,superpose:()=>Ug,throttle:()=>ka,uniqueArray:()=>Oa});const i="158",r=0,s=1,o=2,a=100,l=101,c=102,u=200,h=201,d=202,p=203,f=204,m=205,g=206,_=207,v=208,y=209,b=210,x=211,w=212,S=213,A=214,M=301,C=302,T=306,E=1e3,P=1001,I=1002,k=1003,R=1004,D=1005,L=1006,O=1007,N=1008,F=1009,B=1012,U=1014,z=1015,V=1016,H=1020,$=1023,G=1026,j=1027,W=33776,q=33777,X=33778,Y=33779,K=36492,Z=2300,Q=2301,J=2302,ee=3001,te="",ne="srgb",ie="srgb-linear",re="display-p3",se="display-p3-linear",oe="linear",ae="srgb",le="rec709",ce="p3",ue=7680,he=512,de=513,pe=514,fe=515,me=516,ge=517,_e=518,ve=519,ye=35044,be=35048,xe="300 es",we=1035,Se=2e3,Ae=2001;class Me{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const Ce=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Te=Math.PI/180,Ee=180/Math.PI;function Pe(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Ce[255&e]+Ce[e>>8&255]+Ce[e>>16&255]+Ce[e>>24&255]+"-"+Ce[255&t]+Ce[t>>8&255]+"-"+Ce[t>>16&15|64]+Ce[t>>24&255]+"-"+Ce[63&n|128]+Ce[n>>8&255]+"-"+Ce[n>>16&255]+Ce[n>>24&255]+Ce[255&i]+Ce[i>>8&255]+Ce[i>>16&255]+Ce[i>>24&255]).toLowerCase()}function Ie(e,t,n){return Math.max(t,Math.min(n,e))}function ke(e,t,n){return(1-n)*e+n*t}function Re(e){return!(e&e-1)&&0!==e}function De(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Le(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Oe(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class Ne{constructor(e=0,t=0){Ne.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ie(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Fe{constructor(e,t,n,i,r,s,o,a,l){Fe.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,o,a,l)}set(e,t,n,i,r,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],_=i[1],v=i[4],y=i[7],b=i[2],x=i[5],w=i[8];return r[0]=s*f+o*_+a*b,r[3]=s*m+o*v+a*x,r[6]=s*g+o*y+a*w,r[1]=l*f+c*_+u*b,r[4]=l*m+c*v+u*x,r[7]=l*g+c*y+u*w,r[2]=h*f+d*_+p*b,r[5]=h*m+d*v+p*x,r[8]=h*g+d*y+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-n*r*c+n*o*a+i*r*l-i*s*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=c*s-o*l,h=o*a-c*r,d=l*r-s*a,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(o*n-i*s)*f,e[3]=h*f,e[4]=(c*t-i*a)*f,e[5]=(i*r-o*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*s+l*o)+s+e,-i*l,i*a,-i*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Be.makeScale(e,t)),this}rotate(e){return this.premultiply(Be.makeRotation(-e)),this}translate(e,t){return this.premultiply(Be.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Be=new Fe;function Ue(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function ze(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ve(){const e=ze("canvas");return e.style.display="block",e}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const He={};function $e(e){e in He||(He[e]=!0,console.warn(e))}const Ge=(new Fe).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),je=(new Fe).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),We={[ie]:{transfer:oe,primaries:le,toReference:e=>e,fromReference:e=>e},[ne]:{transfer:ae,primaries:le,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[se]:{transfer:oe,primaries:ce,toReference:e=>e.applyMatrix3(je),fromReference:e=>e.applyMatrix3(Ge)},[re]:{transfer:ae,primaries:ce,toReference:e=>e.convertSRGBToLinear().applyMatrix3(je),fromReference:e=>e.applyMatrix3(Ge).convertLinearToSRGB()}},qe=new Set([ie,se]),Xe={enabled:!0,_workingColorSpace:ie,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!qe.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=We[t].toReference;return(0,We[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return We[e].primaries},getTransfer:function(e){return e===te?oe:We[e].transfer}};function Ye(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ke(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Ze;class Qe{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ze&&(Ze=ze("canvas")),Ze.width=e.width,Ze.height=e.height;const n=Ze.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Ze}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=ze("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*Ye(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Ye(t[e]/255)):t[e]=Ye(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Je=0;class et{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Je++}),this.uuid=Pe(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(tt(i[t].image)):e.push(tt(i[t]))}else e=tt(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function tt(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Qe.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let nt=0;class it extends Me{constructor(e=it.DEFAULT_IMAGE,t=it.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,o=1023,a=1009,l=it.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:nt++}),this.uuid=Pe(),this.name="",this.source=new et(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Ne(0,0),this.repeat=new Ne(1,1),this.center=new Ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Fe,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:($e("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===ee?ne:te),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case E:e.x=e.x-Math.floor(e.x);break;case P:e.x=e.x<0?0:1;break;case I:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case E:e.y=e.y-Math.floor(e.y);break;case P:e.y=e.y<0?0:1;break;case I:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return $e("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===ne?ee:3e3}set encoding(e){$e("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ee?ne:te}}it.DEFAULT_IMAGE=null,it.DEFAULT_MAPPING=300,it.DEFAULT_ANISOTROPY=1;class rt{constructor(e=0,t=0,n=0,i=1){rt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,o=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,_=(g+1)/2,v=(c+h)/4,y=(u+f)/4,b=(p+m)/4;return e>a&&e>_?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=v/n,r=y/n):a>_?a<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=v/i,r=b/i):_<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=y/r,i=b/r),this.set(n,i,r,t),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class st extends Me{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new rt(0,0,e,t),this.scissorTest=!1,this.viewport=new rt(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==n.encoding&&($e("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===ee?ne:te),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:L,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new it(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new et(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ot extends st{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class at extends it{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=k,this.minFilter=k,this.wrapR=P,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class lt extends it{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=k,this.minFilter=k,this.wrapR=P,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ct{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,o){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-o;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,s){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=o*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-o*d,e[t+2]=l*p+c*d+o*h-a*u,e[t+3]=c*p-o*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+o+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ie(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+s*o+i*l-r*a,this._y=i*c+s*a+r*o-n*l,this._z=r*c+s*l+n*a-i*o,this._w=s*c-n*o-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ut{constructor(e=0,t=0,n=0){ut.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(dt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(dt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=2*(s*i-o*n),c=2*(o*t-r*i),u=2*(r*n-s*t);return this.x=t+a*l+s*u-o*c,this.y=n+a*c+o*l-r*u,this.z=i+a*u+r*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ht.copy(this).projectOnVector(e),this.sub(ht)}reflect(e){return this.sub(ht.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ie(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ht=new ut,dt=new ct;class pt{constructor(e=new ut(1/0,1/0,1/0),t=new ut(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(mt.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(mt.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=mt.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,mt):mt.fromBufferAttribute(i,t),mt.applyMatrix4(e.matrixWorld),this.expandByPoint(mt);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),gt.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),gt.copy(n.boundingBox)),gt.applyMatrix4(e.matrixWorld),this.union(gt)}const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,mt),mt.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(St),At.subVectors(this.max,St),_t.subVectors(e.a,St),vt.subVectors(e.b,St),yt.subVectors(e.c,St),bt.subVectors(vt,_t),xt.subVectors(yt,vt),wt.subVectors(_t,yt);let t=[0,-bt.z,bt.y,0,-xt.z,xt.y,0,-wt.z,wt.y,bt.z,0,-bt.x,xt.z,0,-xt.x,wt.z,0,-wt.x,-bt.y,bt.x,0,-xt.y,xt.x,0,-wt.y,wt.x,0];return!!Tt(t,_t,vt,yt,At)&&(t=[1,0,0,0,1,0,0,0,1],!!Tt(t,_t,vt,yt,At)&&(Mt.crossVectors(bt,xt),t=[Mt.x,Mt.y,Mt.z],Tt(t,_t,vt,yt,At)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,mt).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(mt).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ft[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ft[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ft[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ft[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ft[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ft[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ft[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ft[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ft)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ft=[new ut,new ut,new ut,new ut,new ut,new ut,new ut,new ut],mt=new ut,gt=new pt,_t=new ut,vt=new ut,yt=new ut,bt=new ut,xt=new ut,wt=new ut,St=new ut,At=new ut,Mt=new ut,Ct=new ut;function Tt(e,t,n,i,r){for(let s=0,o=e.length-3;s<=o;s+=3){Ct.fromArray(e,s);const o=r.x*Math.abs(Ct.x)+r.y*Math.abs(Ct.y)+r.z*Math.abs(Ct.z),a=t.dot(Ct),l=n.dot(Ct),c=i.dot(Ct);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Et=new pt,Pt=new ut,It=new ut;class kt{constructor(e=new ut,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Et.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Pt.subVectors(e,this.center);const t=Pt.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Pt,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(It.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Pt.copy(e.center).add(It)),this.expandByPoint(Pt.copy(e.center).sub(It))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Rt=new ut,Dt=new ut,Lt=new ut,Ot=new ut,Nt=new ut,Ft=new ut,Bt=new ut;class Ut{constructor(e=new ut,t=new ut(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Rt)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Rt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Rt.copy(this.origin).addScaledVector(this.direction,t),Rt.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Dt.copy(e).add(t).multiplyScalar(.5),Lt.copy(t).sub(e).normalize(),Ot.copy(this.origin).sub(Dt);const r=.5*e.distanceTo(t),s=-this.direction.dot(Lt),o=Ot.dot(this.direction),a=-Ot.dot(Lt),l=Ot.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*a-o,h=s*o-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-s*r+o)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(s*r+o)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Dt).addScaledVector(Lt,h),d}intersectSphere(e,t){Rt.subVectors(e.center,this.origin);const n=Rt.dot(this.direction),i=Rt.dot(Rt)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),u>=0?(o=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Rt)}intersectTriangle(e,t,n,i,r){Nt.subVectors(t,e),Ft.subVectors(n,e),Bt.crossVectors(Nt,Ft);let s,o=this.direction.dot(Bt);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Ot.subVectors(this.origin,e);const a=s*this.direction.dot(Ft.crossVectors(Ot,Ft));if(a<0)return null;const l=s*this.direction.dot(Nt.cross(Ot));if(l<0)return null;if(a+l>o)return null;const c=-s*Ot.dot(Bt);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class zt{constructor(e,t,n,i,r,s,o,a,l,c,u,h,d,p,f,m){zt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,o,a,l,c,u,h,d,p,f,m)}set(e,t,n,i,r,s,o,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new zt).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Vt.setFromMatrixColumn(e,0).length(),r=1/Vt.setFromMatrixColumn(e,1).length(),s=1/Vt.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*u,i=o*c,r=o*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-o*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*o,t[4]=i*o-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-o,t[2]=n*o-i,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*o,t[4]=-s*u,t[8]=i+n*o,t[1]=n+i*o,t[5]=s*c,t[9]=r-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,n=s*u,i=o*c,r=o*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,n=s*l,i=o*a,r=o*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=s*a,n=s*l,i=o*a,r=o*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=s*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=o*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($t,e,Gt)}lookAt(e,t,n){const i=this.elements;return qt.subVectors(e,t),0===qt.lengthSq()&&(qt.z=1),qt.normalize(),jt.crossVectors(n,qt),0===jt.lengthSq()&&(1===Math.abs(n.z)?qt.x+=1e-4:qt.z+=1e-4,qt.normalize(),jt.crossVectors(n,qt)),jt.normalize(),Wt.crossVectors(qt,jt),i[0]=jt.x,i[4]=Wt.x,i[8]=qt.x,i[1]=jt.y,i[5]=Wt.y,i[9]=qt.y,i[2]=jt.z,i[6]=Wt.z,i[10]=qt.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],b=n[15],x=i[0],w=i[4],S=i[8],A=i[12],M=i[1],C=i[5],T=i[9],E=i[13],P=i[2],I=i[6],k=i[10],R=i[14],D=i[3],L=i[7],O=i[11],N=i[15];return r[0]=s*x+o*M+a*P+l*D,r[4]=s*w+o*C+a*I+l*L,r[8]=s*S+o*T+a*k+l*O,r[12]=s*A+o*E+a*R+l*N,r[1]=c*x+u*M+h*P+d*D,r[5]=c*w+u*C+h*I+d*L,r[9]=c*S+u*T+h*k+d*O,r[13]=c*A+u*E+h*R+d*N,r[2]=p*x+f*M+m*P+g*D,r[6]=p*w+f*C+m*I+g*L,r[10]=p*S+f*T+m*k+g*O,r[14]=p*A+f*E+m*R+g*N,r[3]=_*x+v*M+y*P+b*D,r[7]=_*w+v*C+y*I+b*L,r[11]=_*S+v*T+y*k+b*O,r[15]=_*A+v*E+y*R+b*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-i*l*u-r*o*h+n*l*h+i*o*d-n*a*d)+e[7]*(+t*a*d-t*l*h+r*s*h-i*s*d+i*l*c-r*a*c)+e[11]*(+t*l*u-t*o*d-r*s*u+n*s*d+r*o*c-n*l*c)+e[15]*(-i*o*c-t*a*u+t*o*h+i*s*u-n*s*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,v=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,y=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,b=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,x=t*_+n*v+i*y+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=_*w,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,e[2]=(o*m*r-f*a*r+f*i*l-n*m*l-o*i*g+n*a*g)*w,e[3]=(u*a*r-o*h*r-u*i*l+n*h*l+o*i*d-n*a*d)*w,e[4]=v*w,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*w,e[6]=(p*a*r-s*m*r-p*i*l+t*m*l+s*i*g-t*a*g)*w,e[7]=(s*h*r-c*a*r+c*i*l-t*h*l-s*i*d+t*a*d)*w,e[8]=y*w,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(s*f*r-p*o*r+p*n*l-t*f*l-s*n*g+t*o*g)*w,e[11]=(c*o*r-s*u*r-c*n*l+t*u*l+s*n*d-t*o*d)*w,e[12]=b*w,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*o*i-s*f*i-p*n*a+t*f*a+s*n*m-t*o*m)*w,e[15]=(s*u*i-c*o*i+c*n*a-t*u*a-s*n*h+t*o*h)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,o=e.y,a=e.z,l=r*s,c=r*o;return this.set(l*s+n,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+n,c*a-i*s,0,l*a-i*o,c*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,c=s+s,u=o+o,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=o*u,_=a*l,v=a*c,y=a*u,b=n.x,x=n.y,w=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+y)*b,i[2]=(p-v)*b,i[3]=0,i[4]=(d-y)*x,i[5]=(1-(h+g))*x,i[6]=(m+_)*x,i[7]=0,i[8]=(p+v)*w,i[9]=(m-_)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Vt.set(i[0],i[1],i[2]).length();const s=Vt.set(i[4],i[5],i[6]).length(),o=Vt.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Ht.copy(this);const a=1/r,l=1/s,c=1/o;return Ht.elements[0]*=a,Ht.elements[1]*=a,Ht.elements[2]*=a,Ht.elements[4]*=l,Ht.elements[5]*=l,Ht.elements[6]*=l,Ht.elements[8]*=c,Ht.elements[9]*=c,Ht.elements[10]*=c,t.setFromRotationMatrix(Ht),n.x=r,n.y=s,n.z=o,this}makePerspective(e,t,n,i,r,s,o=2e3){const a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i);let d,p;if(o===Se)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(o!==Ae)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-r),p=-s*r/(s-r)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,s,o=2e3){const a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),h=(t+e)*l,d=(n+i)*c;let p,f;if(o===Se)p=(s+r)*u,f=-2*u;else{if(o!==Ae)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=r*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Vt=new ut,Ht=new zt,$t=new ut(0,0,0),Gt=new ut(1,1,1),jt=new ut,Wt=new ut,qt=new ut,Xt=new zt,Yt=new ct;class Kt{constructor(e=0,t=0,n=0,i=Kt.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Ie(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ie(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ie(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Ie(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Ie(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Ie(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Xt.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Xt,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Yt.setFromEuler(this),this.setFromQuaternion(Yt,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Kt.DEFAULT_ORDER="XYZ";class Zt{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let Qt=0;const Jt=new ut,en=new ct,tn=new zt,nn=new ut,rn=new ut,sn=new ut,on=new ct,an=new ut(1,0,0),ln=new ut(0,1,0),cn=new ut(0,0,1),un={type:"added"},hn={type:"removed"};class dn extends Me{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Qt++}),this.uuid=Pe(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=dn.DEFAULT_UP.clone();const e=new ut,t=new Kt,n=new ct,i=new ut(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new zt},normalMatrix:{value:new Fe}}),this.matrix=new zt,this.matrixWorld=new zt,this.matrixAutoUpdate=dn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=dn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Zt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return en.setFromAxisAngle(e,t),this.quaternion.multiply(en),this}rotateOnWorldAxis(e,t){return en.setFromAxisAngle(e,t),this.quaternion.premultiply(en),this}rotateX(e){return this.rotateOnAxis(an,e)}rotateY(e){return this.rotateOnAxis(ln,e)}rotateZ(e){return this.rotateOnAxis(cn,e)}translateOnAxis(e,t){return Jt.copy(e).applyQuaternion(this.quaternion),this.position.add(Jt.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(an,e)}translateY(e){return this.translateOnAxis(ln,e)}translateZ(e){return this.translateOnAxis(cn,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(tn.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?nn.copy(e):nn.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),rn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tn.lookAt(rn,nn,this.up):tn.lookAt(nn,rn,this.up),this.quaternion.setFromRotationMatrix(tn),i&&(tn.extractRotation(i.matrixWorld),en.setFromRotationMatrix(tn),this.quaternion.premultiply(en.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(un)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(hn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),tn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),tn.multiply(e.parent.matrixWorld)),e.applyMatrix4(tn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectsByProperty(e,t);r.length>0&&(n=n.concat(r))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rn,e,sn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rn,on,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}dn.DEFAULT_UP=new ut(0,1,0),dn.DEFAULT_MATRIX_AUTO_UPDATE=!0,dn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const pn=new ut,fn=new ut,mn=new ut,gn=new ut,_n=new ut,vn=new ut,yn=new ut,bn=new ut,xn=new ut,wn=new ut;let Sn=!1;class An{constructor(e=new ut,t=new ut,n=new ut){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),pn.subVectors(e,t),i.cross(pn);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){pn.subVectors(i,t),fn.subVectors(n,t),mn.subVectors(e,t);const s=pn.dot(pn),o=pn.dot(fn),a=pn.dot(mn),l=fn.dot(fn),c=fn.dot(mn),u=s*l-o*o;if(0===u)return r.set(-2,-1,-1);const h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,gn),gn.x>=0&&gn.y>=0&&gn.x+gn.y<=1}static getUV(e,t,n,i,r,s,o,a){return!1===Sn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Sn=!0),this.getInterpolation(e,t,n,i,r,s,o,a)}static getInterpolation(e,t,n,i,r,s,o,a){return this.getBarycoord(e,t,n,i,gn),a.setScalar(0),a.addScaledVector(r,gn.x),a.addScaledVector(s,gn.y),a.addScaledVector(o,gn.z),a}static isFrontFacing(e,t,n,i){return pn.subVectors(n,t),fn.subVectors(e,t),pn.cross(fn).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pn.subVectors(this.c,this.b),fn.subVectors(this.a,this.b),.5*pn.cross(fn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return An.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return An.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return!1===Sn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Sn=!0),An.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}getInterpolation(e,t,n,i,r){return An.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return An.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return An.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,o;_n.subVectors(i,n),vn.subVectors(r,n),bn.subVectors(e,n);const a=_n.dot(bn),l=vn.dot(bn);if(a<=0&&l<=0)return t.copy(n);xn.subVectors(e,i);const c=_n.dot(xn),u=vn.dot(xn);if(c>=0&&u<=c)return t.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(n).addScaledVector(_n,s);wn.subVectors(e,r);const d=_n.dot(wn),p=vn.dot(wn);if(p>=0&&d<=p)return t.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector(vn,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return yn.subVectors(r,i),o=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(yn,o);const g=1/(m+f+h);return s=f*g,o=h*g,t.copy(n).addScaledVector(_n,s).addScaledVector(vn,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Mn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Cn={h:0,s:0,l:0},Tn={h:0,s:0,l:0};function En(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Pn{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ne){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Xe.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Xe.workingColorSpace){return this.r=e,this.g=t,this.b=n,Xe.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Xe.workingColorSpace){if(e=(e%(r=1)+r)%r,t=Ie(t,0,1),n=Ie(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=En(r,i,e+1/3),this.g=En(r,i,e),this.b=En(r,i,e-1/3)}var r;return Xe.toWorkingColorSpace(this,i),this}setStyle(e,t=ne){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ne){const n=Mn[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ye(e.r),this.g=Ye(e.g),this.b=Ye(e.b),this}copyLinearToSRGB(e){return this.r=Ke(e.r),this.g=Ke(e.g),this.b=Ke(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ne){return Xe.fromWorkingColorSpace(In.copy(this),e),65536*Math.round(Ie(255*In.r,0,255))+256*Math.round(Ie(255*In.g,0,255))+Math.round(Ie(255*In.b,0,255))}getHexString(e=ne){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Xe.workingColorSpace){Xe.fromWorkingColorSpace(In.copy(this),t);const n=In.r,i=In.g,r=In.b,s=Math.max(n,i,r),o=Math.min(n,i,r);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const e=s-o;switch(l=c<=.5?e/(s+o):e/(2-s-o),s){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=Xe.workingColorSpace){return Xe.fromWorkingColorSpace(In.copy(this),t),e.r=In.r,e.g=In.g,e.b=In.b,e}getStyle(e=ne){Xe.fromWorkingColorSpace(In.copy(this),e);const t=In.r,n=In.g,i=In.b;return e!==ne?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(Cn),this.setHSL(Cn.h+e,Cn.s+t,Cn.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Cn),e.getHSL(Tn);const n=ke(Cn.h,Tn.h,t),i=ke(Cn.s,Tn.s,t),r=ke(Cn.l,Tn.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const In=new Pn;Pn.NAMES=Mn;let kn=0;class Rn extends Me{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:kn++}),this.uuid=Pe(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=a,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Pn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ue,this.stencilZFail=ue,this.stencilZPass=ue,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==a&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ue&&(n.stencilFail=this.stencilFail),this.stencilZFail!==ue&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==ue&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class Dn extends Rn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Pn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ln=new ut,On=new Ne;class Nn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=ye,this.updateRange={offset:0,count:-1},this.gpuType=z,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)On.fromBufferAttribute(this,t),On.applyMatrix3(e),this.setXY(t,On.x,On.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ln.fromBufferAttribute(this,t),Ln.applyMatrix3(e),this.setXYZ(t,Ln.x,Ln.y,Ln.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ln.fromBufferAttribute(this,t),Ln.applyMatrix4(e),this.setXYZ(t,Ln.x,Ln.y,Ln.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ln.fromBufferAttribute(this,t),Ln.applyNormalMatrix(e),this.setXYZ(t,Ln.x,Ln.y,Ln.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ln.fromBufferAttribute(this,t),Ln.transformDirection(e),this.setXYZ(t,Ln.x,Ln.y,Ln.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Le(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Oe(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Le(t,this.array)),t}setX(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Le(t,this.array)),t}setY(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Le(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Le(t,this.array)),t}setW(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Oe(t,this.array),n=Oe(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Oe(t,this.array),n=Oe(n,this.array),i=Oe(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Oe(t,this.array),n=Oe(n,this.array),i=Oe(i,this.array),r=Oe(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ye&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class Fn extends Nn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Bn extends Nn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Un extends Nn{constructor(e,t,n){super(new Float32Array(e),t,n)}}let zn=0;const Vn=new zt,Hn=new dn,$n=new ut,Gn=new pt,jn=new pt,Wn=new ut;class qn extends Me{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zn++}),this.uuid=Pe(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ue(e)?Bn:Fn)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Fe).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Vn.makeRotationFromQuaternion(e),this.applyMatrix4(Vn),this}rotateX(e){return Vn.makeRotationX(e),this.applyMatrix4(Vn),this}rotateY(e){return Vn.makeRotationY(e),this.applyMatrix4(Vn),this}rotateZ(e){return Vn.makeRotationZ(e),this.applyMatrix4(Vn),this}translate(e,t,n){return Vn.makeTranslation(e,t,n),this.applyMatrix4(Vn),this}scale(e,t,n){return Vn.makeScale(e,t,n),this.applyMatrix4(Vn),this}lookAt(e){return Hn.lookAt(e),Hn.updateMatrix(),this.applyMatrix4(Hn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($n).negate(),this.translate($n.x,$n.y,$n.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Un(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new pt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ut(-1/0,-1/0,-1/0),new ut(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Gn.setFromBufferAttribute(n),this.morphTargetsRelative?(Wn.addVectors(this.boundingBox.min,Gn.min),this.boundingBox.expandByPoint(Wn),Wn.addVectors(this.boundingBox.max,Gn.max),this.boundingBox.expandByPoint(Wn)):(this.boundingBox.expandByPoint(Gn.min),this.boundingBox.expandByPoint(Gn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new kt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ut,1/0);if(e){const n=this.boundingSphere.center;if(Gn.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];jn.setFromBufferAttribute(n),this.morphTargetsRelative?(Wn.addVectors(Gn.min,jn.min),Gn.expandByPoint(Wn),Wn.addVectors(Gn.max,jn.max),Gn.expandByPoint(Wn)):(Gn.expandByPoint(jn.min),Gn.expandByPoint(jn.max))}Gn.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Wn.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Wn));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)Wn.fromBufferAttribute(s,t),o&&($n.fromBufferAttribute(e,t),Wn.add($n)),i=Math.max(i,n.distanceToSquared(Wn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Nn(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new ut,c[e]=new ut;const u=new ut,h=new ut,d=new ut,p=new Ne,f=new Ne,m=new Ne,g=new ut,_=new ut;function v(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),_.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(_),c[t].add(_),c[n].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)v(n[e+0],n[e+1],n[e+2])}const b=new ut,x=new ut,w=new ut,S=new ut;function A(e){w.fromArray(r,3*e),S.copy(w);const t=l[e];b.copy(t),b.sub(w.multiplyScalar(w.dot(t))).normalize(),x.crossVectors(S,t);const n=x.dot(c[e])<0?-1:1;a[4*e]=b.x,a[4*e+1]=b.y,a[4*e+2]=b.z,a[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)A(n[e+0]),A(n[e+1]),A(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Nn(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new ut,r=new ut,s=new ut,o=new ut,a=new ut,l=new ut,c=new ut,u=new ut;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Wn.fromBufferAttribute(e,t),Wn.normalize(),e.setXYZ(t,Wn.x,Wn.y,Wn.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let o=0,a=0;for(let r=0,l=t.length;r<l;r++){o=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)s[a++]=n[o++]}return new Nn(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new qn,n=this.index.array,i=this.attributes;for(const r in i){const s=e(i[r],n);t.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],o=r[i];for(let t=0,i=o.length;t<i;t++){const i=e(o[t],n);s.push(i)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];s.push(i.toJSON(e.data))}s.length>0&&(i[t]=s,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Xn=new zt,Yn=new Ut,Kn=new kt,Zn=new ut,Qn=new ut,Jn=new ut,ei=new ut,ti=new ut,ni=new ut,ii=new Ne,ri=new Ne,si=new Ne,oi=new ut,ai=new ut,li=new ut,ci=new ut,ui=new ut;class hi extends dn{constructor(e=new qn,t=new Dn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(r&&o){ni.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=o[n],a=r[n];0!==i&&(ti.fromBufferAttribute(a,e),s?ni.addScaledVector(ti,i):ni.addScaledVector(ti.sub(t),i))}t.add(ni)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Kn.copy(n.boundingSphere),Kn.applyMatrix4(r),Yn.copy(e.ray).recast(e.near),!1===Kn.containsPoint(Yn.origin)){if(null===Yn.intersectSphere(Kn,Zn))return;if(Yn.origin.distanceToSquared(Zn)>(e.far-e.near)**2)return}Xn.copy(r).invert(),Yn.copy(e.ray).applyMatrix4(Xn),null!==n.boundingBox&&!1===Yn.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Yn)}}_computeIntersections(e,t,n){let i;const r=this.geometry,s=this.material,o=r.index,a=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(s))for(let r=0,a=h.length;r<a;r++){const a=h[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3)i=di(this,p,e,n,l,c,u,o.getX(r),o.getX(r+1),o.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,t.push(i))}else for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3)i=di(this,s,e,n,l,c,u,o.getX(r),o.getX(r+1),o.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i));else if(void 0!==a)if(Array.isArray(s))for(let r=0,o=h.length;r<o;r++){const o=h[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3)i=di(this,p,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,t.push(i))}else for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3)i=di(this,s,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}function di(e,t,n,i,r,s,o,a,l,c){e.getVertexPosition(a,Qn),e.getVertexPosition(l,Jn),e.getVertexPosition(c,ei);const u=function(e,t,n,i,r,s,o,a){let l;if(l=1===t.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,0===t.side,a),null===l)return null;ui.copy(a),ui.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(ui);return c<n.near||c>n.far?null:{distance:c,point:ui.clone(),object:e}}(e,t,n,i,Qn,Jn,ei,ci);if(u){r&&(ii.fromBufferAttribute(r,a),ri.fromBufferAttribute(r,l),si.fromBufferAttribute(r,c),u.uv=An.getInterpolation(ci,Qn,Jn,ei,ii,ri,si,new Ne)),s&&(ii.fromBufferAttribute(s,a),ri.fromBufferAttribute(s,l),si.fromBufferAttribute(s,c),u.uv1=An.getInterpolation(ci,Qn,Jn,ei,ii,ri,si,new Ne),u.uv2=u.uv1),o&&(oi.fromBufferAttribute(o,a),ai.fromBufferAttribute(o,l),li.fromBufferAttribute(o,c),u.normal=An.getInterpolation(ci,Qn,Jn,ei,oi,ai,li,new ut),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const e={a,b:l,c,normal:new ut,materialIndex:0};An.getNormal(Qn,Jn,ei,e.normal),u.face=e}return u}class pi extends qn{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,i,r,s,p,f,m,g,_){const v=s/m,y=p/g,b=s/2,x=p/2,w=f/2,S=m+1,A=g+1;let M=0,C=0;const T=new ut;for(let s=0;s<A;s++){const o=s*y-x;for(let a=0;a<S;a++){const h=a*v-b;T[e]=h*i,T[t]=o*r,T[n]=w,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=f>0?1:-1,c.push(T.x,T.y,T.z),u.push(a/m),u.push(1-s/g),M+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+S*e,i=h+t+S*(e+1),r=h+(t+1)+S*(e+1),s=h+(t+1)+S*e;a.push(n,i,s),a.push(i,r,s),C+=6}o.addGroup(d,C,_),d+=C,h+=M}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new Un(l,3)),this.setAttribute("normal",new Un(c,3)),this.setAttribute("uv",new Un(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function fi(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function mi(e){const t={};for(let n=0;n<e.length;n++){const i=fi(e[n]);for(const e in i)t[e]=i[e]}return t}function gi(e){return null===e.getRenderTarget()?e.outputColorSpace:Xe.workingColorSpace}const _i={clone:fi,merge:mi};class vi extends Rn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=fi(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class yi extends dn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new zt,this.projectionMatrix=new zt,this.projectionMatrixInverse=new zt,this.coordinateSystem=Se}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class bi extends yi{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ee*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Te*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ee*Math.atan(Math.tan(.5*Te*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Te*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/o,i*=s.width/e,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const xi=-90;class wi extends dn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new bi(xi,1,e,t);i.layers=this.layers,this.add(i);const r=new bi(xi,1,e,t);r.layers=this.layers,this.add(r);const s=new bi(xi,1,e,t);s.layers=this.layers,this.add(s);const o=new bi(xi,1,e,t);o.layers=this.layers,this.add(o);const a=new bi(xi,1,e,t);a.layers=this.layers,this.add(a);const l=new bi(xi,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,s,o,a]=t;for(const e of t)this.remove(e);if(e===Se)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==Ae)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,o,a,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,s),e.setRenderTarget(n,2,i),e.render(t,o),e.setRenderTarget(n,3,i),e.render(t,a),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Si extends it{constructor(e,t,n,i,r,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:M,n,i,r,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ai extends ot{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];void 0!==t.encoding&&($e("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ee?ne:te),this.texture=new Si(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:L}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new pi(5,5,5),o=new vi({name:"CubemapFromEquirect",uniforms:fi(n),vertexShader:i,fragmentShader:r,side:1,blending:0});o.uniforms.tEquirect.value=t;const a=new hi(s,o),l=t.minFilter;return t.minFilter===N&&(t.minFilter=L),new wi(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}const Mi=new ut,Ci=new ut,Ti=new Fe;class Ei{constructor(e=new ut(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Mi.subVectors(n,t).cross(Ci.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Mi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Ti.getNormalMatrix(e),i=this.coplanarPoint(Mi).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Pi=new kt,Ii=new ut;class ki{constructor(e=new Ei,t=new Ei,n=new Ei,i=new Ei,r=new Ei,s=new Ei){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],_=i[13],v=i[14],y=i[15];if(n[0].setComponents(a-r,h-l,m-d,y-g).normalize(),n[1].setComponents(a+r,h+l,m+d,y+g).normalize(),n[2].setComponents(a+s,h+c,m+p,y+_).normalize(),n[3].setComponents(a-s,h-c,m-p,y-_).normalize(),n[4].setComponents(a-o,h-u,m-f,y-v).normalize(),t===Se)n[5].setComponents(a+o,h+u,m+f,y+v).normalize();else{if(t!==Ae)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(o,u,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Pi.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Pi.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Pi)}intersectsSprite(e){return Pi.center.set(0,0,0),Pi.radius=.7071067811865476,Pi.applyMatrix4(e.matrixWorld),this.intersectsSphere(Pi)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Ii.x=i.normal.x>0?e.max.x:e.min.x,Ii.y=i.normal.y>0?e.max.y:e.min.y,Ii.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Ii)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ri(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Di(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,function(t,i){const r=t.array,s=t.usage,o=e.createBuffer();let a;if(e.bindBuffer(i,o),e.bufferData(i,r,s),t.onUploadCallback(),r instanceof Float32Array)a=e.FLOAT;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=e.HALF_FLOAT}else a=e.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=e.SHORT;else if(r instanceof Uint32Array)a=e.UNSIGNED_INT;else if(r instanceof Int32Array)a=e.INT;else if(r instanceof Int8Array)a=e.BYTE;else if(r instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=e.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,i,r){const s=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(n?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),i.onUploadCallback()}(s.buffer,t,r),s.version=t.version)}}}class Li extends qn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,o=Math.floor(n),a=Math.floor(i),l=o+1,c=a+1,u=e/o,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-s;for(let n=0;n<l;n++){const i=n*u-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/o),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Un(p,3)),this.setAttribute("normal",new Un(f,3)),this.setAttribute("uv",new Un(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Li(e.width,e.height,e.widthSegments,e.heightSegments)}}const Oi={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Ni={common:{diffuse:{value:new Pn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Fe},alphaMap:{value:null},alphaMapTransform:{value:new Fe},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Fe}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Fe}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Fe}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Fe},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Fe},normalScale:{value:new Ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Fe},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Fe}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Fe}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Fe}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Pn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Pn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Fe},alphaTest:{value:0},uvTransform:{value:new Fe}},sprite:{diffuse:{value:new Pn(16777215)},opacity:{value:1},center:{value:new Ne(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Fe},alphaMap:{value:null},alphaMapTransform:{value:new Fe},alphaTest:{value:0}}},Fi={basic:{uniforms:mi([Ni.common,Ni.specularmap,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.fog]),vertexShader:Oi.meshbasic_vert,fragmentShader:Oi.meshbasic_frag},lambert:{uniforms:mi([Ni.common,Ni.specularmap,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)}}]),vertexShader:Oi.meshlambert_vert,fragmentShader:Oi.meshlambert_frag},phong:{uniforms:mi([Ni.common,Ni.specularmap,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)},specular:{value:new Pn(1118481)},shininess:{value:30}}]),vertexShader:Oi.meshphong_vert,fragmentShader:Oi.meshphong_frag},standard:{uniforms:mi([Ni.common,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.roughnessmap,Ni.metalnessmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Oi.meshphysical_vert,fragmentShader:Oi.meshphysical_frag},toon:{uniforms:mi([Ni.common,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.gradientmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)}}]),vertexShader:Oi.meshtoon_vert,fragmentShader:Oi.meshtoon_frag},matcap:{uniforms:mi([Ni.common,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.fog,{matcap:{value:null}}]),vertexShader:Oi.meshmatcap_vert,fragmentShader:Oi.meshmatcap_frag},points:{uniforms:mi([Ni.points,Ni.fog]),vertexShader:Oi.points_vert,fragmentShader:Oi.points_frag},dashed:{uniforms:mi([Ni.common,Ni.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Oi.linedashed_vert,fragmentShader:Oi.linedashed_frag},depth:{uniforms:mi([Ni.common,Ni.displacementmap]),vertexShader:Oi.depth_vert,fragmentShader:Oi.depth_frag},normal:{uniforms:mi([Ni.common,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,{opacity:{value:1}}]),vertexShader:Oi.meshnormal_vert,fragmentShader:Oi.meshnormal_frag},sprite:{uniforms:mi([Ni.sprite,Ni.fog]),vertexShader:Oi.sprite_vert,fragmentShader:Oi.sprite_frag},background:{uniforms:{uvTransform:{value:new Fe},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Oi.background_vert,fragmentShader:Oi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Oi.backgroundCube_vert,fragmentShader:Oi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Oi.cube_vert,fragmentShader:Oi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Oi.equirect_vert,fragmentShader:Oi.equirect_frag},distanceRGBA:{uniforms:mi([Ni.common,Ni.displacementmap,{referencePosition:{value:new ut},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Oi.distanceRGBA_vert,fragmentShader:Oi.distanceRGBA_frag},shadow:{uniforms:mi([Ni.lights,Ni.fog,{color:{value:new Pn(0)},opacity:{value:1}}]),vertexShader:Oi.shadow_vert,fragmentShader:Oi.shadow_frag}};Fi.physical={uniforms:mi([Fi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Fe},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Fe},clearcoatNormalScale:{value:new Ne(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Fe},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Fe},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Fe},sheen:{value:0},sheenColor:{value:new Pn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Fe},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Fe},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Fe},transmissionSamplerSize:{value:new Ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Fe},attenuationDistance:{value:0},attenuationColor:{value:new Pn(0)},specularColor:{value:new Pn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Fe},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Fe},anisotropyVector:{value:new Ne},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Fe}}]),vertexShader:Oi.meshphysical_vert,fragmentShader:Oi.meshphysical_frag};const Bi={r:0,b:0,g:0};function Ui(e,t,n,i,r,s,o){const a=new Pn(0);let l,c,u=!0===s?0:1,h=null,d=0,p=null;function f(t,n){t.getRGB(Bi,gi(e)),i.buffers.color.setClear(Bi.r,Bi.g,Bi.b,n,o)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),u=t,f(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,f(a,u)},render:function(s,m){let g=!1,_=!0===m.isScene?m.background:null;_&&_.isTexture&&(_=(m.backgroundBlurriness>0?n:t).get(_)),null===_?f(a,u):_&&_.isColor&&(f(_,1),g=!0);const v=e.xr.getEnvironmentBlendMode();"additive"===v?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===v&&i.buffers.color.setClear(0,0,0,0,o),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===T)?(void 0===c&&(c=new hi(new pi(1,1,1),new vi({name:"BackgroundCubeMaterial",uniforms:fi(Fi.backgroundCube.uniforms),vertexShader:Fi.backgroundCube.vertexShader,fragmentShader:Fi.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=Xe.getTransfer(_.colorSpace)!==ae,h===_&&d===_.version&&p===e.toneMapping||(c.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new hi(new Li(2,2),new vi({name:"BackgroundMaterial",uniforms:fi(Fi.background.uniforms),vertexShader:Fi.background.vertexShader,fragmentShader:Fi.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=Xe.getTransfer(_.colorSpace)!==ae,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),h===_&&d===_.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null))}}}function zi(e,t,n,i){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=p(null);let c=l,u=!1;function h(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),a[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r)}function _(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,i,r,s,o,a){!0===a?e.vertexAttribIPointer(t,n,i,s,o):e.vertexAttribPointer(t,n,i,r,s,o)}function y(){b(),u=!0,c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,y,b){let x=!1;if(o){const t=function(t,n,r){const o=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];return void 0===u&&(u=p(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(y,d,l);c!==t&&(c=t,h(c.object)),x=function(e,t,n,i){const r=c.attributes,s=t.attributes;let o=0;const a=n.getAttributes();for(const t in a)if(a[t].location>=0){const n=r[t];let i=s[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;o++}return c.attributesNum!==o||c.index!==i}(r,y,d,b),x&&function(e,t,n,i){const r={},s=t.attributes;let o=0;const a=n.getAttributes();for(const t in a)if(a[t].location>=0){let n=s[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[t]=i,o++}c.attributes=r,c.attributesNum=o,c.index=i}(r,y,d,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,x=!0)}null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),(x||u)&&(u=!1,function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const t in c){const s=c[t];if(s.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&r.instanceMatrix&&(o=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(o=r.instanceColor)),void 0!==o){const t=o.normalized,l=o.itemSize,c=n.get(o);if(void 0===c)continue;const u=c.buffer,h=c.type,d=c.bytesPerElement,p=!0===i.isWebGL2&&(h===e.INT||h===e.UNSIGNED_INT||1013===o.gpuType);if(o.isInterleavedBufferAttribute){const n=o.data,i=n.stride,c=o.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)g(s.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,h,t,i*d,(c+l/s.locationSize*e)*d,p)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)g(s.location+e,o.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,h,t,l*d,l/s.locationSize*e*d,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(s.location,n);break;case 3:e.vertexAttrib3fv(s.location,n);break;case 4:e.vertexAttrib4fv(s.location,n);break;default:e.vertexAttrib1fv(s.location,n)}}}}_()}(r,l,d,y),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)d(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function Vi(e,t,n,i){const r=i.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,i){e.drawArrays(s,t,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,o,a),n.update(o,s,a)}}function Hi(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}function $i(e){const t=this;let n=null,i=0,r=!1,s=!1;const o=new Ei,a=new Fe,l={value:null,needsUpdate:!1};function c(e,n,i,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==s;++t,n+=4)o.copy(e[t]).applyMatrix4(r,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,a,u){const h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=e.get(o);if(!r||null===h||0===h.length||s&&!p)s?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0);else{const e=s?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(h,a,t,u);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Gi(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=M:304===t&&(e.mapping=C),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(303===s||304===s){if(t.has(r))return n(t.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const o=new Ai(s.height/2);return o.fromEquirectangularTexture(e,r),t.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class ji extends yi{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,o=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const Wi=[.125,.215,.35,.446,.526,.582],qi=new ji,Xi=new Pn;let Yi=null,Ki=0,Zi=0;const Qi=(1+Math.sqrt(5))/2,Ji=1/Qi,er=[new ut(1,1,1),new ut(-1,1,1),new ut(1,1,-1),new ut(-1,1,-1),new ut(0,Qi,Ji),new ut(0,Qi,-Ji),new ut(Ji,0,Qi),new ut(-Ji,0,Qi),new ut(Qi,Ji,0),new ut(-Qi,Ji,0)];class tr{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Yi=this._renderer.getRenderTarget(),Ki=this._renderer.getActiveCubeFace(),Zi=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=sr(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=rr(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Yi,Ki,Zi),e.scissorTest=!1,ir(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===M||e.mapping===C?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Yi=this._renderer.getRenderTarget(),Ki=this._renderer.getActiveCubeFace(),Zi=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:L,minFilter:L,generateMipmaps:!1,type:V,format:$,colorSpace:ie,depthBuffer:!1},i=nr(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=nr(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const s=e-4+1+Wi.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>e-4?a=Wi[o-e+4-1]:0===o&&(a=0),i.push(a);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*d),v=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];_.set(i,f*p*e),v.set(h,m*p*e);const r=[e,e,e,e,e,e];y.set(r,g*p*e)}const b=new qn;b.setAttribute("position",new Nn(_,f)),b.setAttribute("uv",new Nn(v,m)),b.setAttribute("faceIndex",new Nn(y,g)),t.push(b),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(20),r=new ut(0,1,0);return new vi({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){const t=new hi(this._lodPlanes[0],e);this._renderer.compile(t,qi)}_sceneToCubeUV(e,t,n,i){const r=new bi(90,1,t,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(Xi),a.toneMapping=0,a.autoClear=!1;const u=new Dn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new hi(new pi,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(Xi),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(r.up.set(0,s[t],0),r.lookAt(o[t],0,0)):1===n?(r.up.set(0,0,s[t]),r.lookAt(0,o[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,o[t]));const l=this._cubeSize;ir(i,n*l,t>2?l:0,l,l),a.setRenderTarget(i),d&&a.render(h,r),a.render(e,r)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===M||e.mapping===C;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=sr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=rr());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new hi(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const o=this._cubeSize;ir(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(s,qi)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=er[(t-1)%er.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new hi(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=d,u.mipInt.value=_-n;const v=this._sizeLods[i];ir(t,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(t),a.render(c,qi)}}function nr(e,t,n){const i=new ot(e,t,n);return i.texture.mapping=T,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ir(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function rr(){return new vi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function sr(){return new vi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function or(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=303===s||304===s,a=s===M||s===C;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new tr(e)),i=o?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(s)){null===n&&(n=new tr(e));const s=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ar(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function lr(e,t,n,i){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);for(const e in a.morphAttributes){const n=a.morphAttributes[e];for(let e=0,i=n.length;e<i;e++)t.remove(n[e])}a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let o=0;if(null!==i){const e=i.array;o=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const e=r.array;o=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const a=new(Ue(n)?Bn:Fn)(n,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const n in i)t.update(i[n],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)t.update(i[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return s.get(e)}}}function cr(e,t,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(s,i,o,t*a),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,h;if(r)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,i*a,c),n.update(l,s,c)}}function ur(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function hr(e,t){return e[0]-t[0]}function dr(e,t){return Math.abs(t[1])-Math.abs(e[1])}function pr(e,t,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new rt,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(l,c,u){const h=l.morphTargetInfluences;if(!0===t.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let f=s.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const _=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],x=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let S=0;!0===_&&(S=1),!0===v&&(S=2),!0===y&&(S=3);let A=c.attributes.position.count*S,M=1;A>t.maxTextureSize&&(M=Math.ceil(A/t.maxTextureSize),A=t.maxTextureSize);const C=new Float32Array(A*M*4*p),T=new at(C,A,M,p);T.type=z,T.needsUpdate=!0;const E=4*S;for(let I=0;I<p;I++){const k=b[I],R=x[I],D=w[I],L=A*M*4*I;for(let O=0;O<k.count;O++){const N=O*E;!0===_&&(o.fromBufferAttribute(k,O),C[L+N+0]=o.x,C[L+N+1]=o.y,C[L+N+2]=o.z,C[L+N+3]=0),!0===v&&(o.fromBufferAttribute(R,O),C[L+N+4]=o.x,C[L+N+5]=o.y,C[L+N+6]=o.z,C[L+N+7]=0),!0===y&&(o.fromBufferAttribute(D,O),C[L+N+8]=o.x,C[L+N+9]=o.y,C[L+N+10]=o.z,C[L+N+11]=4===D.itemSize?o.w:1)}}function P(){T.dispose(),s.delete(c),c.removeEventListener("dispose",P)}f={count:p,texture:T,size:new Ne(A,M)},s.set(c,f),c.addEventListener("dispose",P)}let m=0;for(let F=0;F<h.length;F++)m+=h[F];const g=c.morphTargetsRelative?1:1-m;u.getUniforms().setValue(e,"morphTargetBaseInfluence",g),u.getUniforms().setValue(e,"morphTargetInfluences",h),u.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const B=void 0===h?0:h.length;let U=i[c.id];if(void 0===U||U.length!==B){U=[];for(let j=0;j<B;j++)U[j]=[j,0];i[c.id]=U}for(let W=0;W<B;W++){const q=U[W];q[0]=W,q[1]=h[W]}U.sort(dr);for(let X=0;X<8;X++)X<B&&U[X][1]?(a[X][0]=U[X][0],a[X][1]=U[X][1]):(a[X][0]=Number.MAX_SAFE_INTEGER,a[X][1]=0);a.sort(hr);const V=c.morphAttributes.position,H=c.morphAttributes.normal;let $=0;for(let Y=0;Y<8;Y++){const K=a[Y],Z=K[0],Q=K[1];Z!==Number.MAX_SAFE_INTEGER&&Q?(V&&c.getAttribute("morphTarget"+Y)!==V[Z]&&c.setAttribute("morphTarget"+Y,V[Z]),H&&c.getAttribute("morphNormal"+Y)!==H[Z]&&c.setAttribute("morphNormal"+Y,H[Z]),r[Y]=Q,$+=Q):(V&&!0===c.hasAttribute("morphTarget"+Y)&&c.deleteAttribute("morphTarget"+Y),H&&!0===c.hasAttribute("morphNormal"+Y)&&c.deleteAttribute("morphNormal"+Y),r[Y]=0)}const G=c.morphTargetsRelative?1:1-$;u.getUniforms().setValue(e,"morphTargetBaseInfluence",G),u.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function fr(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const a=i.render.frame,l=o.geometry,c=t.get(o,l);if(r.get(c)!==a&&(t.update(c),r.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),r.get(o)!==a&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),r.set(o,a))),o.isSkinnedMesh){const e=o.skeleton;r.get(e)!==a&&(e.update(),r.set(e,a))}return c},dispose:function(){r=new WeakMap}}}const mr=new it,gr=new at,_r=new lt,vr=new Si,yr=[],br=[],xr=new Float32Array(16),wr=new Float32Array(9),Sr=new Float32Array(4);function Ar(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=yr[r];if(void 0===s&&(s=new Float32Array(r),yr[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function Mr(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Cr(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function Tr(e,t){let n=br[t];void 0===n&&(n=new Int32Array(t),br[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Er(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Pr(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Mr(n,t))return;e.uniform2fv(this.addr,t),Cr(n,t)}}function Ir(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Mr(n,t))return;e.uniform3fv(this.addr,t),Cr(n,t)}}function kr(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Mr(n,t))return;e.uniform4fv(this.addr,t),Cr(n,t)}}function Rr(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Mr(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Cr(n,t)}else{if(Mr(n,i))return;Sr.set(i),e.uniformMatrix2fv(this.addr,!1,Sr),Cr(n,i)}}function Dr(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Mr(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Cr(n,t)}else{if(Mr(n,i))return;wr.set(i),e.uniformMatrix3fv(this.addr,!1,wr),Cr(n,i)}}function Lr(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Mr(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Cr(n,t)}else{if(Mr(n,i))return;xr.set(i),e.uniformMatrix4fv(this.addr,!1,xr),Cr(n,i)}}function Or(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Nr(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Mr(n,t))return;e.uniform2iv(this.addr,t),Cr(n,t)}}function Fr(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Mr(n,t))return;e.uniform3iv(this.addr,t),Cr(n,t)}}function Br(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Mr(n,t))return;e.uniform4iv(this.addr,t),Cr(n,t)}}function Ur(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function zr(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Mr(n,t))return;e.uniform2uiv(this.addr,t),Cr(n,t)}}function Vr(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Mr(n,t))return;e.uniform3uiv(this.addr,t),Cr(n,t)}}function Hr(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Mr(n,t))return;e.uniform4uiv(this.addr,t),Cr(n,t)}}function $r(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||mr,r)}function Gr(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||_r,r)}function jr(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||vr,r)}function Wr(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||gr,r)}function qr(e,t){e.uniform1fv(this.addr,t)}function Xr(e,t){const n=Ar(t,this.size,2);e.uniform2fv(this.addr,n)}function Yr(e,t){const n=Ar(t,this.size,3);e.uniform3fv(this.addr,n)}function Kr(e,t){const n=Ar(t,this.size,4);e.uniform4fv(this.addr,n)}function Zr(e,t){const n=Ar(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Qr(e,t){const n=Ar(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Jr(e,t){const n=Ar(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function es(e,t){e.uniform1iv(this.addr,t)}function ts(e,t){e.uniform2iv(this.addr,t)}function ns(e,t){e.uniform3iv(this.addr,t)}function is(e,t){e.uniform4iv(this.addr,t)}function rs(e,t){e.uniform1uiv(this.addr,t)}function ss(e,t){e.uniform2uiv(this.addr,t)}function os(e,t){e.uniform3uiv(this.addr,t)}function as(e,t){e.uniform4uiv(this.addr,t)}function ls(e,t,n){const i=this.cache,r=t.length,s=Tr(n,r);Mr(i,s)||(e.uniform1iv(this.addr,s),Cr(i,s));for(let e=0;e!==r;++e)n.setTexture2D(t[e]||mr,s[e])}function cs(e,t,n){const i=this.cache,r=t.length,s=Tr(n,r);Mr(i,s)||(e.uniform1iv(this.addr,s),Cr(i,s));for(let e=0;e!==r;++e)n.setTexture3D(t[e]||_r,s[e])}function us(e,t,n){const i=this.cache,r=t.length,s=Tr(n,r);Mr(i,s)||(e.uniform1iv(this.addr,s),Cr(i,s));for(let e=0;e!==r;++e)n.setTextureCube(t[e]||vr,s[e])}function hs(e,t,n){const i=this.cache,r=t.length,s=Tr(n,r);Mr(i,s)||(e.uniform1iv(this.addr,s),Cr(i,s));for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||gr,s[e])}class ds{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Er;case 35664:return Pr;case 35665:return Ir;case 35666:return kr;case 35674:return Rr;case 35675:return Dr;case 35676:return Lr;case 5124:case 35670:return Or;case 35667:case 35671:return Nr;case 35668:case 35672:return Fr;case 35669:case 35673:return Br;case 5125:return Ur;case 36294:return zr;case 36295:return Vr;case 36296:return Hr;case 35678:case 36198:case 36298:case 36306:case 35682:return $r;case 35679:case 36299:case 36307:return Gr;case 35680:case 36300:case 36308:case 36293:return jr;case 36289:case 36303:case 36311:case 36292:return Wr}}(t.type)}}class ps{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return qr;case 35664:return Xr;case 35665:return Yr;case 35666:return Kr;case 35674:return Zr;case 35675:return Qr;case 35676:return Jr;case 5124:case 35670:return es;case 35667:case 35671:return ts;case 35668:case 35672:return ns;case 35669:case 35673:return is;case 5125:return rs;case 36294:return ss;case 36295:return os;case 36296:return as;case 35678:case 36198:case 36298:case 36306:case 35682:return ls;case 35679:case 36299:case 36307:return cs;case 35680:case 36300:case 36308:case 36293:return us;case 36289:case 36303:case 36311:case 36292:return hs}}(t.type)}}class fs{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}}}const ms=/(\w+)(\])?(\[|\.)?/g;function gs(e,t){e.seq.push(t),e.map[t.id]=t}function _s(e,t,n){const i=e.name,r=i.length;for(ms.lastIndex=0;;){const s=ms.exec(i),o=ms.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){gs(n,void 0===c?new ds(a,e,t):new ps(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new fs(a),gs(n,e)),n=e}}}class vs{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);_s(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function ys(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let bs=0;function xs(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=r;e<s;e++){const r=e+1;i.push(`${r===t?">":" "} ${r}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function ws(e,t){const n=function(e){const t=Xe.getPrimaries(Xe.workingColorSpace),n=Xe.getPrimaries(e);let i;switch(t===n?i="":t===ce&&n===le?i="LinearDisplayP3ToLinearSRGB":t===le&&n===ce&&(i="LinearSRGBToLinearDisplayP3"),e){case ie:case se:return[i,"LinearTransferOETF"];case ne:case re:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function Ss(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function As(e){return""!==e}function Ms(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Cs(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ts=/^[ \t]*#include +<([\w\d./]+)>/gm;function Es(e){return e.replace(Ts,Is)}const Ps=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Is(e,t){let n=Oi[t];if(void 0===n){const e=Ps.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=Oi[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return Es(n)}const ks=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Rs(e){return e.replace(ks,Ds)}function Ds(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function Ls(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Os(e,t,n,i){const r=e.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case M:case C:t="ENVMAP_TYPE_CUBE";break;case T:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===C&&(t="ENVMAP_MODE_REFRACTION"),t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(As).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),m=r.createProgram();let g,_,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(As).join("\n"),g.length>0&&(g+="\n"),_=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(As).join("\n"),_.length>0&&(_+="\n")):(g=[Ls(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(As).join("\n"),_=[p,Ls(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Oi.tonemapping_pars_fragment:"",0!==n.toneMapping?Ss("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Oi.colorspace_pars_fragment,ws("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(As).join("\n")),o=Es(o),o=Ms(o,n),o=Cs(o,n),a=Es(a),a=Ms(a,n),a=Cs(a,n),o=Rs(o),a=Rs(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===xe?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===xe?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const y=v+g+o,b=v+_+a,x=ys(r,r.VERTEX_SHADER,y),w=ys(r,r.FRAGMENT_SHADER,b);function S(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(x).trim(),s=r.getShaderInfoLog(w).trim();let o=!0,a=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(o=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,m,x,w);else{const e=xs(r,x,"vertex"),t=xs(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+t)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==s||(a=!1);a&&(t.diagnostics={runnable:o,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:s,prefix:_}})}r.deleteShader(x),r.deleteShader(w),A=new vs(r,m),E=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),s=i.name;let o=1;i.type===e.FLOAT_MAT2&&(o=2),i.type===e.FLOAT_MAT3&&(o=3),i.type===e.FLOAT_MAT4&&(o=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:o}}return n}(r,m)}let A,E;r.attachShader(m,x),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===A&&S(this),A},this.getAttributes=function(){return void 0===E&&S(this),E};let P=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===P&&(P=r.getProgramParameter(m,37297)),P},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=bs++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}let Ns=0;class Fs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Bs(e),t.set(e,n)),n}}class Bs{constructor(e){this.id=Ns++,this.code=e,this.usedTimes=0}}function Us(e,t,n,i,r,s,o){const a=new Zt,l=new Fs,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(s,a,c,g,_){const v=g.fog,y=_.geometry,b=s.isMeshStandardMaterial?g.environment:null,x=(s.isMeshStandardMaterial?n:t).get(s.envMap||b),w=x&&x.mapping===T?x.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const A=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,M=void 0!==A?A.length:0;let C,E,P,I,k=0;if(void 0!==y.morphAttributes.position&&(k=1),void 0!==y.morphAttributes.normal&&(k=2),void 0!==y.morphAttributes.color&&(k=3),S){const e=Fi[S];C=e.vertexShader,E=e.fragmentShader}else C=s.vertexShader,E=s.fragmentShader,l.update(s),P=l.getVertexShaderID(s),I=l.getFragmentShaderID(s);const R=e.getRenderTarget(),D=!0===_.isInstancedMesh,L=!!s.map,O=!!s.matcap,N=!!x,F=!!s.aoMap,B=!!s.lightMap,U=!!s.bumpMap,z=!!s.normalMap,V=!!s.displacementMap,H=!!s.emissiveMap,$=!!s.metalnessMap,G=!!s.roughnessMap,j=s.anisotropy>0,W=s.clearcoat>0,q=s.iridescence>0,X=s.sheen>0,Y=s.transmission>0,K=j&&!!s.anisotropyMap,Z=W&&!!s.clearcoatMap,Q=W&&!!s.clearcoatNormalMap,J=W&&!!s.clearcoatRoughnessMap,ee=q&&!!s.iridescenceMap,te=q&&!!s.iridescenceThicknessMap,ne=X&&!!s.sheenColorMap,re=X&&!!s.sheenRoughnessMap,se=!!s.specularMap,oe=!!s.specularColorMap,le=!!s.specularIntensityMap,ce=Y&&!!s.transmissionMap,ue=Y&&!!s.thicknessMap,he=!!s.gradientMap,de=!!s.alphaMap,pe=s.alphaTest>0,fe=!!s.alphaHash,me=!!s.extensions,ge=!!y.attributes.uv1,_e=!!y.attributes.uv2,ve=!!y.attributes.uv3;let ye=0;return s.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(ye=e.toneMapping)),{isWebGL2:u,shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:C,fragmentShader:E,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:I,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:D,instancingColor:D&&null!==_.instanceColor,supportsVertexTextures:d,outputColorSpace:null===R?e.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:ie,map:L,matcap:O,envMap:N,envMapMode:N&&x.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:B,bumpMap:U,normalMap:z,displacementMap:d&&V,emissiveMap:H,normalMapObjectSpace:z&&1===s.normalMapType,normalMapTangentSpace:z&&0===s.normalMapType,metalnessMap:$,roughnessMap:G,anisotropy:j,anisotropyMap:K,clearcoat:W,clearcoatMap:Z,clearcoatNormalMap:Q,clearcoatRoughnessMap:J,iridescence:q,iridescenceMap:ee,iridescenceThicknessMap:te,sheen:X,sheenColorMap:ne,sheenRoughnessMap:re,specularMap:se,specularColorMap:oe,specularIntensityMap:le,transmission:Y,transmissionMap:ce,thicknessMap:ue,gradientMap:he,opaque:!1===s.transparent&&1===s.blending,alphaMap:de,alphaTest:pe,alphaHash:fe,combine:s.combine,mapUv:L&&m(s.map.channel),aoMapUv:F&&m(s.aoMap.channel),lightMapUv:B&&m(s.lightMap.channel),bumpMapUv:U&&m(s.bumpMap.channel),normalMapUv:z&&m(s.normalMap.channel),displacementMapUv:V&&m(s.displacementMap.channel),emissiveMapUv:H&&m(s.emissiveMap.channel),metalnessMapUv:$&&m(s.metalnessMap.channel),roughnessMapUv:G&&m(s.roughnessMap.channel),anisotropyMapUv:K&&m(s.anisotropyMap.channel),clearcoatMapUv:Z&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:Q&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:J&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:ee&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:te&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:ne&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:re&&m(s.sheenRoughnessMap.channel),specularMapUv:se&&m(s.specularMap.channel),specularColorMapUv:oe&&m(s.specularColorMap.channel),specularIntensityMapUv:le&&m(s.specularIntensityMap.channel),transmissionMapUv:ce&&m(s.transmissionMap.channel),thicknessMapUv:ue&&m(s.thicknessMap.channel),alphaMapUv:de&&m(s.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(z||j),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUv1s:ge,vertexUv2s:_e,vertexUv3s:ve,pointsUvs:!0===_.isPoints&&!!y.attributes.uv&&(L||de),fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:M,morphTextureStride:k,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ye,useLegacyLights:e._useLegacyLights,decodeVideoTexture:L&&!0===s.map.isVideoTexture&&Xe.getTransfer(s.map.colorSpace)===ae,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:me&&!0===s.extensions.derivatives,extensionFragDepth:me&&!0===s.extensions.fragDepth,extensionDrawBuffers:me&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:me&&!0===s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0),t.supportsVertexTextures&&a.enable(1),t.instancing&&a.enable(2),t.instancingColor&&a.enable(3),t.matcap&&a.enable(4),t.envMap&&a.enable(5),t.normalMapObjectSpace&&a.enable(6),t.normalMapTangentSpace&&a.enable(7),t.clearcoat&&a.enable(8),t.iridescence&&a.enable(9),t.alphaTest&&a.enable(10),t.vertexColors&&a.enable(11),t.vertexAlphas&&a.enable(12),t.vertexUv1s&&a.enable(13),t.vertexUv2s&&a.enable(14),t.vertexUv3s&&a.enable(15),t.vertexTangents&&a.enable(16),t.anisotropy&&a.enable(17),t.alphaHash&&a.enable(18),e.push(a.mask),a.disableAll(),t.fog&&a.enable(0),t.useFog&&a.enable(1),t.flatShading&&a.enable(2),t.logarithmicDepthBuffer&&a.enable(3),t.skinning&&a.enable(4),t.morphTargets&&a.enable(5),t.morphNormals&&a.enable(6),t.morphColors&&a.enable(7),t.premultipliedAlpha&&a.enable(8),t.shadowMapEnabled&&a.enable(9),t.useLegacyLights&&a.enable(10),t.doubleSided&&a.enable(11),t.flipSided&&a.enable(12),t.useDepthPacking&&a.enable(13),t.dithering&&a.enable(14),t.transmission&&a.enable(15),t.sheen&&a.enable(16),t.opaque&&a.enable(17),t.pointsUvs&&a.enable(18),t.decodeVideoTexture&&a.enable(19),e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=Fi[t];n=_i.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Os(e,n,t,s),c.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function zs(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Vs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Hs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function $s(){const e=[];let t=0;const n=[],i=[],r=[];function s(n,i,r,s,o,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Vs),i.length>1&&i.sort(t||Hs),r.length>1&&r.sort(t||Hs)}}}function Gs(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new $s,e.set(t,[r])):n>=i.length?(r=new $s,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function js(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new ut,color:new Pn};break;case"SpotLight":n={position:new ut,direction:new ut,color:new Pn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ut,color:new Pn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ut,skyColor:new Pn,groundColor:new Pn};break;case"RectAreaLight":n={color:new Pn,position:new ut,halfWidth:new ut,halfHeight:new ut}}return e[t.id]=n,n}}}let Ws=0;function qs(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Xs(e,t){const n=new js,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new ut);const s=new ut,o=new zt,a=new zt;return{setup:function(s,o){let a=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0,v=0,y=0,b=0;s.sort(qs);const x=!0===o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,w=t.intensity,S=t.distance,A=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*w*x,l+=o.g*w*x,c+=o.b*w*x;else if(t.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],w);b++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=A,r.directionalShadowMatrix[u]=t.shadow.matrix,m++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(w*x),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;const s=t.shadow;if(t.map&&(r.spotLightMap[v]=t.map,v++,s.updateMatrices(t),t.castShadow&&y++),r.spotLightMatrix[d]=s.matrix,t.castShadow){const e=i.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=A,_++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=A,r.pointShadowMatrix[h]=t.shadow.matrix,g++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(w*x),e.groundColor.copy(t.groundColor).multiplyScalar(w*x),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Ni.LTC_FLOAT_1,r.rectAreaLTC2=Ni.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Ni.LTC_HALF_1,r.rectAreaLTC2=Ni.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const w=r.hash;w.directionalLength===u&&w.pointLength===h&&w.spotLength===d&&w.rectAreaLength===p&&w.hemiLength===f&&w.numDirectionalShadows===m&&w.numPointShadows===g&&w.numSpotShadows===_&&w.numSpotMaps===v&&w.numLightProbes===b||(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=_+v-y,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=y,r.numLightProbes=b,w.directionalLength=u,w.pointLength=h,w.spotLength=d,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=_,w.numSpotMaps=v,w.numLightProbes=b,r.version=Ws++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),o.copy(d.matrixWorld),o.premultiply(h),a.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),i++}else if(d.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),u++}}},state:r}}function Ys(e,t){const n=new Xs(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Ks(e,t){let n=new WeakMap;return{get:function(i,r=0){const s=n.get(i);let o;return void 0===s?(o=new Ys(e,t),n.set(i,[o])):r>=s.length?(o=new Ys(e,t),s.push(o)):o=s[r],o},dispose:function(){n=new WeakMap}}}class Zs extends Rn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Qs extends Rn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Js(e,t,n){let i=new ki;const a=new Ne,l=new Ne,c=new rt,u=new Zs({depthPacking:3201}),h=new Qs,d={},p=n.maxTextureSize,f={[r]:1,[s]:0,[o]:2},m=new vi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ne},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),g=m.clone();g.defines.HORIZONTAL_PASS=1;const _=new qn;_.setAttribute("position",new Nn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new hi(_,m),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let b=this.type;function x(n,i){const r=t.update(v);m.defines.VSM_SAMPLES!==n.blurSamples&&(m.defines.VSM_SAMPLES=n.blurSamples,g.defines.VSM_SAMPLES=n.blurSamples,m.needsUpdate=!0,g.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new ot(a.x,a.y)),m.uniforms.shadow_pass.value=n.map.texture,m.uniforms.resolution.value=n.mapSize,m.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,m,v,null),g.uniforms.shadow_pass.value=n.mapPass.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,g,v,null)}function w(t,n,i,r){let s=null;const o=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===i.isPointLight?h:u,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let i=d[e];void 0===i&&(i={},d[e]=i);let r=i[t];void 0===r&&(r=s.clone(),i[t]=r),s=r}return s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:f[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial&&(e.properties.get(s).light=i),s}function S(n,r,s,o,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=r[c.materialIndex];if(u&&u.visible){const t=w(n,u,o,a);e.renderBufferDirect(s,null,i,t,n,c)}}}else if(r.visible){const t=w(n,r,o,a);e.renderBufferDirect(s,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)S(l[e],r,s,o,a)}this.render=function(t,n,r){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===t.length)return;const s=e.getRenderTarget(),o=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const d=3!==b&&3===this.type,f=3===b&&3!==this.type;for(let s=0,o=t.length;s<o;s++){const o=t[s],u=o.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",o,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;a.copy(u.mapSize);const m=u.getFrameExtents();if(a.multiply(m),l.copy(u.mapSize),(a.x>p||a.y>p)&&(a.x>p&&(l.x=Math.floor(p/m.x),a.x=l.x*m.x,u.mapSize.x=l.x),a.y>p&&(l.y=Math.floor(p/m.y),a.y=l.y*m.y,u.mapSize.y=l.y)),null===u.map||!0===d||!0===f){const e=3!==this.type?{minFilter:k,magFilter:k}:{};null!==u.map&&u.map.dispose(),u.map=new ot(a.x,a.y,e),u.map.texture.name=o.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const g=u.getViewportCount();for(let e=0;e<g;e++){const t=u.getViewport(e);c.set(l.x*t.x,l.y*t.y,l.x*t.z,l.y*t.w),h.viewport(c),u.updateMatrices(o,e),i=u.getFrustum(),S(n,r,u.camera,o,this.type)}!0!==u.isPointLightShadow&&3===this.type&&x(u,r),u.needsUpdate=!1}b=this.type,y.needsUpdate=!1,e.setRenderTarget(s,o,u)}}function eo(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new rt;let i=null;const r=new rt(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,o,a){!0===a&&(t*=o,i*=o,s*=o),n.set(t,i,s,o),!1===r.equals(n)&&(e.clearColor(t,i,s,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(t){t?oe(e.DEPTH_TEST):ae(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},o=new function(){let t=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?oe(e.STENCIL_TEST):ae(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&s===o||(e.stencilFunc(t,n,o),i=t,r=n,s=o)},setOp:function(t,n,i){o===t&&a===n&&l===i||(e.stencilOp(t,n,i),o=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null}}},M=new WeakMap,C=new WeakMap;let T={},E={},P=new WeakMap,I=[],k=null,R=!1,D=null,L=null,O=null,N=null,F=null,B=null,U=null,z=new Pn(0,0,0),V=0,H=!1,$=null,G=null,j=null,W=null,q=null;const X=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Y=!1,K=0;const Z=e.getParameter(e.VERSION);-1!==Z.indexOf("WebGL")?(K=parseFloat(/^WebGL (\d)/.exec(Z)[1]),Y=K>=1):-1!==Z.indexOf("OpenGL ES")&&(K=parseFloat(/^OpenGL ES (\d)/.exec(Z)[1]),Y=K>=2);let Q=null,J={};const ee=e.getParameter(e.SCISSOR_BOX),te=e.getParameter(e.VIEWPORT),ne=(new rt).fromArray(ee),ie=(new rt).fromArray(te);function re(t,n,r,s){const o=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<r;a++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,o);return a}const se={};function oe(t){!0!==T[t]&&(e.enable(t),T[t]=!0)}function ae(t){!1!==T[t]&&(e.disable(t),T[t]=!1)}se[e.TEXTURE_2D]=re(e.TEXTURE_2D,e.TEXTURE_2D,1),se[e.TEXTURE_CUBE_MAP]=re(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(se[e.TEXTURE_2D_ARRAY]=re(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),se[e.TEXTURE_3D]=re(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),oe(e.DEPTH_TEST),s.setFunc(3),he(!1),de(1),oe(e.CULL_FACE),ue(0);const le={[a]:e.FUNC_ADD,[l]:e.FUNC_SUBTRACT,[c]:e.FUNC_REVERSE_SUBTRACT};if(i)le[103]=e.MIN,le[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(le[103]=e.MIN_EXT,le[104]=e.MAX_EXT)}const ce={[u]:e.ZERO,[h]:e.ONE,[d]:e.SRC_COLOR,[f]:e.SRC_ALPHA,[b]:e.SRC_ALPHA_SATURATE,[v]:e.DST_COLOR,[g]:e.DST_ALPHA,[p]:e.ONE_MINUS_SRC_COLOR,[m]:e.ONE_MINUS_SRC_ALPHA,[y]:e.ONE_MINUS_DST_COLOR,[_]:e.ONE_MINUS_DST_ALPHA,[x]:e.CONSTANT_COLOR,[w]:e.ONE_MINUS_CONSTANT_COLOR,[S]:e.CONSTANT_ALPHA,[A]:e.ONE_MINUS_CONSTANT_ALPHA};function ue(t,n,i,r,s,o,l,c,u,h){if(0!==t){if(!1===R&&(oe(e.BLEND),R=!0),5===t)s=s||n,o=o||i,l=l||r,n===L&&s===F||(e.blendEquationSeparate(le[n],le[s]),L=n,F=s),i===O&&r===N&&o===B&&l===U||(e.blendFuncSeparate(ce[i],ce[r],ce[o],ce[l]),O=i,N=r,B=o,U=l),!1!==c.equals(z)&&u===V||(e.blendColor(c.r,c.g,c.b,u),z.copy(c),V=u),D=t,H=!1;else if(t!==D||h!==H){if(L===a&&F===a||(e.blendEquation(e.FUNC_ADD),L=a,F=a),h)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}O=null,N=null,B=null,U=null,z.set(0,0,0),V=0,D=t,H=h}}else!0===R&&(ae(e.BLEND),R=!1)}function he(t){$!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),$=t)}function de(t){0!==t?(oe(e.CULL_FACE),t!==G&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):ae(e.CULL_FACE),G=t}function pe(t,n,i){t?(oe(e.POLYGON_OFFSET_FILL),W===n&&q===i||(e.polygonOffset(n,i),W=n,q=i)):ae(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:s,stencil:o},enable:oe,disable:ae,bindFramebuffer:function(t,n){return E[t]!==n&&(e.bindFramebuffer(t,n),E[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(E[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(E[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let s=I,o=!1;if(i)if(s=P.get(r),void 0===s&&(s=[],P.set(r,s)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(s.length!==t.length||s[0]!==e.COLOR_ATTACHMENT0){for(let n=0,i=t.length;n<i;n++)s[n]=e.COLOR_ATTACHMENT0+n;s.length=t.length,o=!0}}else s[0]!==e.COLOR_ATTACHMENT0&&(s[0]=e.COLOR_ATTACHMENT0,o=!0);else s[0]!==e.BACK&&(s[0]=e.BACK,o=!0);o&&(n.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return k!==t&&(e.useProgram(t),k=t,!0)},setBlending:ue,setMaterial:function(t,n){2===t.side?ae(e.CULL_FACE):oe(e.CULL_FACE);let i=1===t.side;n&&(i=!i),he(i),1===t.blending&&!1===t.transparent?ue(0):ue(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);const a=t.stencilWrite;o.setTest(a),a&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),pe(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?oe(e.SAMPLE_ALPHA_TO_COVERAGE):ae(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:he,setCullFace:de,setLineWidth:function(t){t!==j&&(Y&&e.lineWidth(t),j=t)},setPolygonOffset:pe,setScissorTest:function(t){t?oe(e.SCISSOR_TEST):ae(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+X-1),Q!==t&&(e.activeTexture(t),Q=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===Q?e.TEXTURE0+X-1:Q);let r=J[i];void 0===r&&(r={type:void 0,texture:void 0},J[i]=r),r.type===t&&r.texture===n||(Q!==i&&(e.activeTexture(i),Q=i),e.bindTexture(t,n||se[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=J[Q];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=C.get(n);void 0===i&&(i=new WeakMap,C.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=C.get(n).get(t);M.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),M.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===ne.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ne.copy(t))},viewport:function(t){!1===ie.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ie.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),T={},Q=null,J={},E={},P=new WeakMap,I=[],k=null,R=!1,D=null,L=null,O=null,N=null,F=null,B=null,U=null,z=new Pn(0,0,0),V=0,H=!1,$=null,G=null,j=null,W=null,q=null,ne.set(0,0,e.canvas.width,e.canvas.height),ie.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),o.reset()}}}function to(e,t,n,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return _?new OffscreenCanvas(e,t):ze("canvas")}function y(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?De:Math.floor,s=i(r*e.width),o=i(r*e.height);void 0===m&&(m=v(s,o));const a=n?v(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return Re(e.width)&&Re(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==k&&e.minFilter!==L}function w(t){e.generateMipmap(t)}function S(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;if(i===e.RED&&(r===e.FLOAT&&(l=e.R32F),r===e.HALF_FLOAT&&(l=e.R16F),r===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(l=e.R8UI),r===e.UNSIGNED_SHORT&&(l=e.R16UI),r===e.UNSIGNED_INT&&(l=e.R32UI),r===e.BYTE&&(l=e.R8I),r===e.SHORT&&(l=e.R16I),r===e.INT&&(l=e.R32I)),i===e.RG&&(r===e.FLOAT&&(l=e.RG32F),r===e.HALF_FLOAT&&(l=e.RG16F),r===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RGBA){const t=o?oe:Xe.getTransfer(s);r===e.FLOAT&&(l=e.RGBA32F),r===e.HALF_FLOAT&&(l=e.RGBA16F),r===e.UNSIGNED_BYTE&&(l=t===ae?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function A(e,t,n){return!0===x(e,n)||e.isFramebufferTexture&&e.minFilter!==k&&e.minFilter!==L?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function M(t){return t===k||1004===t||t===D?e.NEAREST:e.LINEAR}function C(e){const t=e.target;t.removeEventListener("dispose",C),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=g.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&W(e),0===Object.keys(r).length&&g.delete(n)}i.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function T(t){const n=t.target;n.removeEventListener("dispose",T),function(t){const n=t.texture,r=i.get(t),s=i.get(n);if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(r.__webglFramebuffer[t]))for(let n=0;n<r.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(r.__webglFramebuffer[t][n]);else e.deleteFramebuffer(r.__webglFramebuffer[t]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}(n)}function W(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete g.get(r)[n.__cacheKey],o.memory.textures--}let q=0;function X(t,r){const s=i.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void ee(s,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+r)}const Y={[E]:e.REPEAT,[P]:e.CLAMP_TO_EDGE,[I]:e.MIRRORED_REPEAT},K={[k]:e.NEAREST,[R]:e.NEAREST_MIPMAP_NEAREST,[D]:e.NEAREST_MIPMAP_LINEAR,[L]:e.LINEAR,[O]:e.LINEAR_MIPMAP_NEAREST,[N]:e.LINEAR_MIPMAP_LINEAR},Z={[he]:e.NEVER,[ve]:e.ALWAYS,[de]:e.LESS,[fe]:e.LEQUAL,[pe]:e.EQUAL,[_e]:e.GEQUAL,[me]:e.GREATER,[ge]:e.NOTEQUAL};function Q(n,s,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,Y[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,Y[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,Y[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,K[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,K[s.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),s.wrapS===P&&s.wrapT===P||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,M(s.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,M(s.minFilter)),s.minFilter!==k&&s.minFilter!==L&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,Z[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===k)return;if(s.minFilter!==D&&s.minFilter!==N)return;if(s.type===z&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===V&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function J(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",C));const r=n.source;let s=g.get(r);void 0===s&&(s={},g.set(r,s));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===s[a]&&(s[a]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&W(n)),t.__cacheKey=a,t.__webglTexture=s[a].texture}return i}function ee(t,r,o){let l=e.TEXTURE_2D;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),r.isData3DTexture&&(l=e.TEXTURE_3D);const c=J(t,r),h=r.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const d=i.get(h);if(h.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=Xe.getPrimaries(Xe.workingColorSpace),i=r.colorSpace===te?null:Xe.getPrimaries(r.colorSpace),p=r.colorSpace===te||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const f=function(e){return!a&&(e.wrapS!==P||e.wrapT!==P||e.minFilter!==k&&e.minFilter!==L)}(r)&&!1===b(r.image);let m=y(r.image,f,!1,u);m=ue(r,m);const g=b(m)||a,_=s.convert(r.format,r.colorSpace);let v,M=s.convert(r.type),C=S(r.internalFormat,_,M,r.colorSpace,r.isVideoTexture);Q(l,r,g);const T=r.mipmaps,E=a&&!0!==r.isVideoTexture,I=void 0===d.__version||!0===c,R=A(r,m,g);if(r.isDepthTexture)C=e.DEPTH_COMPONENT,a?C=r.type===z?e.DEPTH_COMPONENT32F:r.type===U?e.DEPTH_COMPONENT24:r.type===H?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===z&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===G&&C===e.DEPTH_COMPONENT&&r.type!==B&&r.type!==U&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=U,M=s.convert(r.type)),r.format===j&&C===e.DEPTH_COMPONENT&&(C=e.DEPTH_STENCIL,r.type!==H&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=H,M=s.convert(r.type))),I&&(E?n.texStorage2D(e.TEXTURE_2D,1,C,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,C,m.width,m.height,0,_,M,null));else if(r.isDataTexture)if(T.length>0&&g){E&&I&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)v=T[t],E?n.texSubImage2D(e.TEXTURE_2D,t,0,0,v.width,v.height,_,M,v.data):n.texImage2D(e.TEXTURE_2D,t,C,v.width,v.height,0,_,M,v.data);r.generateMipmaps=!1}else E?(I&&n.texStorage2D(e.TEXTURE_2D,R,C,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,_,M,m.data)):n.texImage2D(e.TEXTURE_2D,0,C,m.width,m.height,0,_,M,m.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){E&&I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,T[0].width,T[0].height,m.depth);for(let t=0,i=T.length;t<i;t++)v=T[t],r.format!==$?null!==_?E?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,v.width,v.height,m.depth,_,v.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,C,v.width,v.height,m.depth,0,v.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,v.width,v.height,m.depth,_,M,v.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,C,v.width,v.height,m.depth,0,_,M,v.data)}else{E&&I&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)v=T[t],r.format!==$?null!==_?E?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,v.width,v.height,_,v.data):n.compressedTexImage2D(e.TEXTURE_2D,t,C,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?n.texSubImage2D(e.TEXTURE_2D,t,0,0,v.width,v.height,_,M,v.data):n.texImage2D(e.TEXTURE_2D,t,C,v.width,v.height,0,_,M,v.data)}else if(r.isDataArrayTexture)E?(I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,_,M,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,C,m.width,m.height,m.depth,0,_,M,m.data);else if(r.isData3DTexture)E?(I&&n.texStorage3D(e.TEXTURE_3D,R,C,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,_,M,m.data)):n.texImage3D(e.TEXTURE_3D,0,C,m.width,m.height,m.depth,0,_,M,m.data);else if(r.isFramebufferTexture){if(I)if(E)n.texStorage2D(e.TEXTURE_2D,R,C,m.width,m.height);else{let t=m.width,i=m.height;for(let r=0;r<R;r++)n.texImage2D(e.TEXTURE_2D,r,C,t,i,0,_,M,null),t>>=1,i>>=1}}else if(T.length>0&&g){E&&I&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)v=T[t],E?n.texSubImage2D(e.TEXTURE_2D,t,0,0,_,M,v):n.texImage2D(e.TEXTURE_2D,t,C,_,M,v);r.generateMipmaps=!1}else E?(I&&n.texStorage2D(e.TEXTURE_2D,R,C,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,_,M,m)):n.texImage2D(e.TEXTURE_2D,0,C,_,M,m);x(r,g)&&w(l),d.__version=h.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function ne(t,r,o,a,l,c){const u=s.convert(o.format,o.colorSpace),h=s.convert(o.type),p=S(o.internalFormat,u,h,o.colorSpace);if(!i.get(r).__hasExternalTextures){const t=Math.max(1,r.width>>c),i=Math.max(1,r.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,p,t,i,r.depth,0,u,h,null):n.texImage2D(l,c,p,t,i,0,u,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),ce(r)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,l,i.get(o).__webglTexture,0,le(r)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,a,l,i.get(o).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function re(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let r=!0===a?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(i||ce(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===z?r=e.DEPTH_COMPONENT32F:t.type===U&&(r=e.DEPTH_COMPONENT24));const i=le(n);ce(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=le(n);i&&!1===ce(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):ce(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const o=t[r],a=s.convert(o.format,o.colorSpace),l=s.convert(o.type),c=S(o.internalFormat,a,l,o.colorSpace),u=le(n);i&&!1===ce(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,n.width,n.height):ce(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function se(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),X(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=le(r);if(r.depthTexture.format===G)ce(r)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==j)throw new Error("Unknown depthTexture format");ce(r)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),re(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),re(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function le(e){return Math.min(h,e.samples)}function ce(e){const n=i.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function ue(e,n){const i=e.colorSpace,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===we||i!==ie&&i!==te&&(Xe.getTransfer(i)===ae?!1===a?!0===t.has("EXT_sRGB")&&r===$?(e.format=we,e.minFilter=L,e.generateMipmaps=!1):n=Qe.sRGBToLinear(n):r===$&&s===F||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const e=q;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),q+=1,e},this.resetTextureUnits=function(){q=0},this.setTexture2D=X,this.setTexture2DArray=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?ee(s,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?ee(s,t,r):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,r,o){if(6!==r.image.length)return;const l=J(t,r),u=r.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const h=i.get(u);if(u.version!==h.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=Xe.getPrimaries(Xe.workingColorSpace),i=r.colorSpace===te?null:Xe.getPrimaries(r.colorSpace),d=r.colorSpace===te||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const p=r.isCompressedTexture||r.image[0].isCompressedTexture,f=r.image[0]&&r.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=p||f?f?r.image[e].image:r.image[e]:y(r.image[e],!1,!0,c),m[e]=ue(r,m[e]);const g=m[0],_=b(g)||a,v=s.convert(r.format,r.colorSpace),M=s.convert(r.type),C=S(r.internalFormat,v,M,r.colorSpace),T=a&&!0!==r.isVideoTexture,E=void 0===h.__version||!0===l;let P,I=A(r,g,_);if(Q(e.TEXTURE_CUBE_MAP,r,_),p){T&&E&&n.texStorage2D(e.TEXTURE_CUBE_MAP,I,C,g.width,g.height);for(let t=0;t<6;t++){P=m[t].mipmaps;for(let i=0;i<P.length;i++){const s=P[i];r.format!==$?null!==v?T?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,s.width,s.height,v,s.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,C,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,s.width,s.height,v,M,s.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,C,s.width,s.height,0,v,M,s.data)}}}else{P=r.mipmaps,T&&E&&(P.length>0&&I++,n.texStorage2D(e.TEXTURE_CUBE_MAP,I,C,m[0].width,m[0].height));for(let t=0;t<6;t++)if(f){T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,v,M,m[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,m[t].width,m[t].height,0,v,M,m[t].data);for(let i=0;i<P.length;i++){const r=P[i].image[t].image;T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,v,M,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,C,r.width,r.height,0,v,M,r.data)}}else{T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,v,M,m[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,v,M,m[t]);for(let i=0;i<P.length;i++){const r=P[i];T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,v,M,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,C,v,M,r.image[t])}}}x(r,_)&&w(e.TEXTURE_CUBE_MAP),h.__version=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,r):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+r)},this.rebindTextures=function(t,n,r){const s=i.get(t);void 0!==n&&ne(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&se(t)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),u=i.get(l);t.addEventListener("dispose",T),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=b(t)||a;if(h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(d)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===ce(t)){const i=d?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const o=s.convert(r.format,r.colorSpace),a=s.convert(r.type),l=S(r.internalFormat,o,a,r.colorSpace,!0===t.isXRRenderTarget),u=le(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),re(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),Q(e.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(a&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)ne(c.__webglFramebuffer[n][i],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else ne(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);x(l,p)&&w(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){const r=t.texture;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i.get(o);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),Q(e.TEXTURE_2D,o,p),ne(c.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,0),x(o,p)&&w(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,u.__webglTexture),Q(i,l,p),a&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)ne(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,i,n);else ne(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i,0);x(l,p)&&w(i),n.unbindTexture()}t.depthBuffer&&se(t)},this.updateRenderTargetMipmap=function(t){const r=b(t)||a,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let o=0,a=s.length;o<a;o++){const a=s[o];if(x(a,r)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=i.get(a).__webglTexture;n.bindTexture(r,s),w(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===ce(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,o=t.height;let a=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const d=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),h){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,o,0,0,s,o,a,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=se,this.setupFrameBufferTexture=ne,this.useMultisampledRTT=ce}function no(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=""){let s;const o=Xe.getTransfer(r);if(n===F)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===B)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(n===U)return e.UNSIGNED_INT;if(n===z)return e.FLOAT;if(n===V)return i?e.HALF_FLOAT:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===$)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===G)return e.DEPTH_COMPONENT;if(n===j)return e.DEPTH_STENCIL;if(n===we)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===W||n===q||n===X||n===Y)if(o===ae){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===W)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===q)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===X)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Y)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===W)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===q)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===X)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Y)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===n)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===n)return o===ae?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return o===ae?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===K||36494===n||36495===n){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(n===K)return o===ae?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(s=t.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===K)return s.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===H?i?e.UNSIGNED_INT_24_8:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class io extends bi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ro extends dn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const so={type:"move"};class oo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ro,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ro,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ut,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ut),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ro,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ut,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ut),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),r=this._getHandJoint(l,i);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(so)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new ro;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class ao extends it{constructor(e,t,n,i,r,s,o,a,l,c){if((c=void 0!==c?c:G)!==G&&c!==j)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===G&&(n=U),void 0===n&&c===j&&(n=H),super(null,i,r,s,o,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:k,this.minFilter=void 0!==a?a:k,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class lo extends Me{constructor(e,t){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=1,l=null,c=null,u=null,h=null,d=null,p=null;const f=t.getContextAttributes();let m=null,g=null;const _=[],v=[],y=new bi;y.layers.enable(1),y.viewport=new rt;const b=new bi;b.layers.enable(2),b.viewport=new rt;const x=[y,b],w=new io;w.layers.enable(1),w.layers.enable(2);let S=null,A=null;function M(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function C(){i.removeEventListener("select",M),i.removeEventListener("selectstart",M),i.removeEventListener("selectend",M),i.removeEventListener("squeeze",M),i.removeEventListener("squeezestart",M),i.removeEventListener("squeezeend",M),i.removeEventListener("end",C),i.removeEventListener("inputsourceschange",T);for(let e=0;e<_.length;e++){const t=v[e];null!==t&&(v[e]=null,_[e].disconnect(t))}S=null,A=null,e.setRenderTarget(m),d=null,h=null,u=null,i=null,g=null,R.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function T(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=v.indexOf(n);i>=0&&(v[i]=null,_[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=v.indexOf(n);if(-1===i){for(let e=0;e<_.length;e++){if(e>=v.length){v.push(n),i=e;break}if(null===v[e]){v[e]=n,i=e;break}}if(-1===i)break}const r=_[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new oo,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new oo,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new oo,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",M),i.addEventListener("selectstart",M),i.addEventListener("selectend",M),i.addEventListener("squeeze",M),i.addEventListener("squeezestart",M),i.addEventListener("squeezeend",M),i.addEventListener("end",C),i.addEventListener("inputsourceschange",T),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),g=new ot(d.framebufferWidth,d.framebufferHeight,{format:$,type:F,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,s=null,o=null;f.depth&&(o=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?j:G,s=f.stencil?H:U);const a={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:r};u=new XRWebGLBinding(i,t),h=u.createProjectionLayer(a),i.updateRenderState({layers:[h]}),g=new ot(h.textureWidth,h.textureHeight,{format:$,type:F,depthTexture:new ao(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await i.requestReferenceSpace(o),R.setContext(i),R.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const E=new ut,P=new ut;function I(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;w.near=b.near=y.near=e.near,w.far=b.far=y.far=e.far,S===w.near&&A===w.far||(i.updateRenderState({depthNear:w.near,depthFar:w.far}),S=w.near,A=w.far);const t=e.parent,n=w.cameras;I(w,t);for(let e=0;e<n.length;e++)I(n[e],t);2===n.length?function(e,t,n){E.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const i=E.distanceTo(P),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,_=a+f,v=d-m,y=p+(i-m),b=l*a/_*g,x=c*a/_*g;e.projectionMatrix.makePerspective(v,y,b,x,g,_),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(w,y,b):w.projectionMatrix.copy(y.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Ee*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,w,t)},this.getCamera=function(){return w},this.getFoveation=function(){if(null!==h||null!==d)return a},this.setFoveation=function(e){a=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let k=null;const R=new Ri;R.setAnimationLoop((function(t,i){if(c=i.getViewerPose(l||s),p=i,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==w.cameras.length&&(w.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let s=null;if(null!==d)s=d.getViewport(r);else{const t=u.getViewSubImage(h,r);s=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let o=x[i];void 0===o&&(o=new bi,o.layers.enable(i),o.viewport=new rt,x[i]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&(w.matrix.copy(o.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),!0===n&&w.cameras.push(o)}}for(let e=0;e<_.length;e++){const t=v[e],n=_[e];null!==t&&void 0!==n&&n.update(t,i,l||s)}k&&k(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function co(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,1===r.side&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),1===r.side&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const s=t.get(r).envMap;if(s&&(i.envMap.value=s,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,gi(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,s,o,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform)),e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform));t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,a)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,s,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function uo(e,t,n,i){let r={},s={},o=[];const a=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const i=e.value;if(void 0===n[t]){if("number"==typeof i)n[t]=i;else{const e=Array.isArray(i)?i:[i],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());n[t]=r}return!0}if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],r=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(r[t]))return n.copy(r[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let d=r[n.id];void 0===d&&(function(e){const t=e.uniforms;let n=0;let i=0;for(let e=0,r=t.length;e<r;e++){const r=t[e],s={boundary:0,storage:0},o=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]);s.boundary+=t.boundary,s.storage+=t.storage}r.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,e>0&&(i=n%16,0!==i&&16-i-s.boundary<0&&(n+=16-i,r.__offset=n)),n+=s.storage}i=n%16,i>0&&(n+=16-i),e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=t.render.frame;s[n.id]!==f&&(function(t){const n=r[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=i.length;t<n;t++){const n=i[t];if(!0===l(n,t,s)){const t=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let r=0;for(let s=0;s<i.length;s++){const o=i[s],a=c(o);"number"==typeof o?(n.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+r,n.__data)):o.isMatrix3?(n.__data[0]=o.elements[0],n.__data[1]=o.elements[1],n.__data[2]=o.elements[2],n.__data[3]=o.elements[0],n.__data[4]=o.elements[3],n.__data[5]=o.elements[4],n.__data[6]=o.elements[5],n.__data[7]=o.elements[0],n.__data[8]=o.elements[6],n.__data[9]=o.elements[7],n.__data[10]=o.elements[8],n.__data[11]=o.elements[0]):(o.toArray(n.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);o=[],r={},s={}}}}class ho{constructor(e={}){const{canvas:t=Ve(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:o;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const _=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ne,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let b=!1,x=0,w=0,S=null,A=-1,M=null;const C=new rt,T=new rt;let E=null;const P=new Pn(0);let I=0,k=t.width,R=t.height,D=1,L=null,O=null;const G=new rt(0,0,k,R),j=new rt(0,0,k,R);let W=!1;const q=new ki;let X=!1,Y=!1,K=null;const Z=new zt,Q=new Ne,J=new ut,ee={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function te(){return null===S?D:1}let re,se,oe,ae,le,ce,ue,he,de,pe,fe,me,ge,_e,ve,ye,be,xe,we,Se,Ae,Me,Ce,Te,Ee=n;function Pe(e,n){for(let i=0;i<e.length;i++){const r=e[i],s=t.getContext(r,n);if(null!==s)return s}return null}try{const e={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${i}`),t.addEventListener("webglcontextlost",Re,!1),t.addEventListener("webglcontextrestored",Le,!1),t.addEventListener("webglcontextcreationerror",Oe,!1),null===Ee){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),Ee=Pe(t,e),null===Ee)throw Pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&Ee instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Ee.getShaderPrecisionFormat&&(Ee.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Ie(){re=new ar(Ee),se=new Hi(Ee,re,e),re.init(se),Me=new no(Ee,re,se),oe=new eo(Ee,re,se),ae=new ur(Ee),le=new zs,ce=new to(Ee,re,oe,le,se,Me,ae),ue=new Gi(y),he=new or(y),de=new Di(Ee,se),Ce=new zi(Ee,re,de,se),pe=new lr(Ee,de,ae,Ce),fe=new fr(Ee,pe,de,ae),we=new pr(Ee,se,ce),ye=new $i(le),me=new Us(y,ue,he,re,se,Ce,ye),ge=new co(y,le),_e=new Gs,ve=new Ks(re,se),xe=new Ui(y,ue,he,oe,fe,d,l),be=new Js(y,fe,se),Te=new uo(Ee,ae,se,oe),Se=new Vi(Ee,re,ae,se),Ae=new cr(Ee,re,ae,se),ae.programs=me.programs,y.capabilities=se,y.extensions=re,y.properties=le,y.renderLists=_e,y.shadowMap=be,y.state=oe,y.info=ae}Ie();const ke=new lo(y,Ee);function Re(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Le(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=ae.autoReset,t=be.enabled,n=be.autoUpdate,i=be.needsUpdate,r=be.type;Ie(),ae.autoReset=e,be.enabled=t,be.autoUpdate=n,be.needsUpdate=i,be.type=r}function Oe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Fe(e){const t=e.target;t.removeEventListener("dispose",Fe),function(e){(function(e){const t=le.get(e).programs;void 0!==t&&(t.forEach((function(e){me.releaseProgram(e)})),e.isShaderMaterial&&me.releaseShaderCache(e))})(e),le.remove(e)}(t)}function Be(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Xe(e,t,n),e.side=0,e.needsUpdate=!0,Xe(e,t,n),e.side=2):Xe(e,t,n)}this.xr=ke,this.getContext=function(){return Ee},this.getContextAttributes=function(){return Ee.getContextAttributes()},this.forceContextLoss=function(){const e=re.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=re.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(e){void 0!==e&&(D=e,this.setSize(k,R,!1))},this.getSize=function(e){return e.set(k,R)},this.setSize=function(e,n,i=!0){ke.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(k=e,R=n,t.width=Math.floor(e*D),t.height=Math.floor(n*D),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(k*D,R*D).floor()},this.setDrawingBufferSize=function(e,n,i){k=e,R=n,D=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(G)},this.setViewport=function(e,t,n,i){e.isVector4?G.set(e.x,e.y,e.z,e.w):G.set(e,t,n,i),oe.viewport(C.copy(G).multiplyScalar(D).floor())},this.getScissor=function(e){return e.copy(j)},this.setScissor=function(e,t,n,i){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,n,i),oe.scissor(T.copy(j).multiplyScalar(D).floor())},this.getScissorTest=function(){return W},this.setScissorTest=function(e){oe.setScissorTest(W=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(e){return e.copy(xe.getClearColor())},this.setClearColor=function(){xe.setClearColor.apply(xe,arguments)},this.getClearAlpha=function(){return xe.getClearAlpha()},this.setClearAlpha=function(){xe.setClearAlpha.apply(xe,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==S){const t=S.texture.format;e=1033===t||1031===t||1029===t}if(e){const e=S.texture.type,t=e===F||e===U||e===B||e===H||1017===e||1018===e,n=xe.getClearColor(),i=xe.getClearAlpha(),r=n.r,s=n.g,o=n.b;t?(p[0]=r,p[1]=s,p[2]=o,p[3]=i,Ee.clearBufferuiv(Ee.COLOR,0,p)):(f[0]=r,f[1]=s,f[2]=o,f[3]=i,Ee.clearBufferiv(Ee.COLOR,0,f))}else i|=Ee.COLOR_BUFFER_BIT}t&&(i|=Ee.DEPTH_BUFFER_BIT),n&&(i|=Ee.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ee.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Re,!1),t.removeEventListener("webglcontextrestored",Le,!1),t.removeEventListener("webglcontextcreationerror",Oe,!1),_e.dispose(),ve.dispose(),le.dispose(),ue.dispose(),he.dispose(),fe.dispose(),Ce.dispose(),Te.dispose(),me.dispose(),ke.dispose(),ke.removeEventListener("sessionstart",ze),ke.removeEventListener("sessionend",He),K&&(K.dispose(),K=null),$e.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=ee);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,n,i,r){!0!==t.isScene&&(t=ee),ce.resetTextureUnits();const s=t.fog,o=i.isMeshStandardMaterial?t.environment:null,a=null===S?y.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:ie,l=(i.isMeshStandardMaterial?he:ue).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;i.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=y.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,_=void 0!==m?m.length:0,v=le.get(i),b=g.state.lights;if(!0===X&&(!0===Y||e!==M)){const t=e===M&&i.id===A;ye.setState(i,e,t)}let x=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==b.state.version||v.outputColorSpace!==a||r.isInstancedMesh&&!1===v.instancing?x=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?x=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||v.envMap!==l||!0===i.fog&&v.fog!==s?x=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===ye.numPlanes&&v.numIntersection===ye.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==h||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||!0===se.isWebGL2&&v.morphTargetsCount!==_)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,v.__version=i.version);let w=v.currentProgram;!0===x&&(w=Xe(i,t,r));let C=!1,T=!1,E=!1;const P=w.getUniforms(),I=v.uniforms;if(oe.useProgram(w.program)&&(C=!0,T=!0,E=!0),i.id!==A&&(A=i.id,T=!0),C||M!==e){P.setValue(Ee,"projectionMatrix",e.projectionMatrix),P.setValue(Ee,"viewMatrix",e.matrixWorldInverse);const t=P.map.cameraPosition;void 0!==t&&t.setValue(Ee,J.setFromMatrixPosition(e.matrixWorld)),se.logarithmicDepthBuffer&&P.setValue(Ee,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(Ee,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,T=!0,E=!0)}if(r.isSkinnedMesh){P.setOptional(Ee,r,"bindMatrix"),P.setOptional(Ee,r,"bindMatrixInverse");const e=r.skeleton;e&&(se.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),P.setValue(Ee,"boneTexture",e.boneTexture,ce),P.setValue(Ee,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const k=n.morphAttributes;var L,O;if((void 0!==k.position||void 0!==k.normal||void 0!==k.color&&!0===se.isWebGL2)&&we.update(r,n,w),(T||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,P.setValue(Ee,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),T&&(P.setValue(Ee,"toneMappingExposure",y.toneMappingExposure),v.needsLights&&(O=E,(L=I).ambientLightColor.needsUpdate=O,L.lightProbe.needsUpdate=O,L.directionalLights.needsUpdate=O,L.directionalLightShadows.needsUpdate=O,L.pointLights.needsUpdate=O,L.pointLightShadows.needsUpdate=O,L.spotLights.needsUpdate=O,L.spotLightShadows.needsUpdate=O,L.rectAreaLights.needsUpdate=O,L.hemisphereLights.needsUpdate=O),s&&!0===i.fog&&ge.refreshFogUniforms(I,s),ge.refreshMaterialUniforms(I,i,D,R,K),vs.upload(Ee,Ye(v),I,ce)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(vs.upload(Ee,Ye(v),I,ce),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&P.setValue(Ee,"center",r.center),P.setValue(Ee,"modelViewMatrix",r.modelViewMatrix),P.setValue(Ee,"normalMatrix",r.normalMatrix),P.setValue(Ee,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(se.isWebGL2){const n=e[t];Te.update(n,w),Te.bind(n,w)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return w}(e,t,n,i,r);oe.setMaterial(i,o);let l=n.index,c=1;if(!0===i.wireframe){if(l=pe.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==s&&(d=Math.max(d,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;Ce.setup(r,i,a,n,l);let _=Se;if(null!==l&&(m=de.get(l),_=Ae,_.setIndex(m)),r.isMesh)!0===i.wireframe?(oe.setLineWidth(i.wireframeLinewidth*te()),_.setMode(Ee.LINES)):_.setMode(Ee.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),oe.setLineWidth(e*te()),r.isLineSegments?_.setMode(Ee.LINES):r.isLineLoop?_.setMode(Ee.LINE_LOOP):_.setMode(Ee.LINE_STRIP)}else r.isPoints?_.setMode(Ee.POINTS):r.isSprite&&_.setMode(Ee.TRIANGLES);if(r.isInstancedMesh)_.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);_.renderInstances(d,f,t)}else _.render(d,f)},this.compile=function(e,t,n=null){null===n&&(n=e),g=ve.get(n),g.init(),v.push(g),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),g.setupLights(y._useLegacyLights);const i=new Set;return e.traverse((function(e){const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const s=t[r];Be(s,n,e),i.add(s)}else Be(t,n,e),i.add(t)})),v.pop(),g=null,i},this.compileAsync=function(e,t,n=null){const i=this.compile(e,t,n);return new Promise((t=>{function n(){i.forEach((function(e){le.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(n,10):t(e)}null!==re.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ue=null;function ze(){$e.stop()}function He(){$e.start()}const $e=new Ri;function Ge(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||q.intersectsSprite(e)){i&&J.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Z);const t=fe.update(e),r=e.material;r.visible&&m.push(e,t,r,n,J.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||q.intersectsObject(e))){const t=fe.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),J.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),J.copy(t.boundingSphere.center)),J.applyMatrix4(e.matrixWorld).applyMatrix4(Z)),Array.isArray(r)){const i=t.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r[o.materialIndex];a&&a.visible&&m.push(e,t,a,n,J.z,o)}}else r.visible&&m.push(e,t,r,n,J.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)Ge(r[e],t,n,i)}function je(e,t,n,i){const r=e.opaque,s=e.transmissive,o=e.transparent;g.setupLightsView(n),!0===X&&ye.setGlobalState(y.clippingPlanes,n),s.length>0&&function(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;const r=se.isWebGL2;null===K&&(K=new ot(1,1,{generateMipmaps:!0,type:re.has("EXT_color_buffer_half_float")?V:F,minFilter:N,samples:r?4:0})),y.getDrawingBufferSize(Q),r?K.setSize(Q.x,Q.y):K.setSize(De(Q.x),De(Q.y));const s=y.getRenderTarget();y.setRenderTarget(K),y.getClearColor(P),I=y.getClearAlpha(),I<1&&y.setClearColor(16777215,.5),y.clear();const o=y.toneMapping;y.toneMapping=0,We(e,n,i),ce.updateMultisampleRenderTarget(K),ce.updateRenderTargetMipmap(K);let a=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.object,o=r.geometry,l=r.material,c=r.group;if(2===l.side&&s.layers.test(i.layers)){const e=l.side;l.side=1,l.needsUpdate=!0,qe(s,n,i,o,l,c),l.side=e,l.needsUpdate=!0,a=!0}}!0===a&&(ce.updateMultisampleRenderTarget(K),ce.updateRenderTargetMipmap(K)),y.setRenderTarget(s),y.setClearColor(P,I),y.toneMapping=o}(r,s,t,n),i&&oe.viewport(C.copy(i)),r.length>0&&We(r,t,n),s.length>0&&We(s,t,n),o.length>0&&We(o,t,n),oe.buffers.depth.setTest(!0),oe.buffers.depth.setMask(!0),oe.buffers.color.setMask(!0),oe.setPolygonOffset(!1)}function We(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,l=null===i?s.material:i,c=s.group;o.layers.test(n.layers)&&qe(o,t,n,a,l,c)}}function qe(e,t,n,i,r,s){e.onBeforeRender(y,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=2):y.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(y,t,n,i,r,s)}function Xe(e,t,n){!0!==t.isScene&&(t=ee);const i=le.get(e),r=g.state.lights,s=g.state.shadowsArray,o=r.state.version,a=me.getParameters(e,r.state,s,t,n),l=me.getProgramCacheKey(a);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?he:ue).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Fe),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Ke(e,a),u}else a.uniforms=me.getUniforms(e),e.onBuild(n,a,y),e.onBeforeCompile(a,y),u=me.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const h=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ye.uniform),Ke(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Ye(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=vs.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ke(e,t){const n=le.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}$e.setAnimationLoop((function(e){Ue&&Ue(e)})),"undefined"!=typeof self&&$e.setContext(self),this.setAnimationLoop=function(e){Ue=e,ke.setAnimationLoop(e),null===e?$e.stop():$e.start()},ke.addEventListener("sessionstart",ze),ke.addEventListener("sessionend",He),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===ke.enabled&&!0===ke.isPresenting&&(!0===ke.cameraAutoUpdate&&ke.updateCamera(t),t=ke.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,S),g=ve.get(e,v.length),g.init(),v.push(g),Z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),q.setFromProjectionMatrix(Z),Y=this.localClippingEnabled,X=ye.init(this.clippingPlanes,Y),m=_e.get(e,_.length),m.init(),_.push(m),Ge(e,t,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(L,O),this.info.render.frame++,!0===X&&ye.beginShadows();const n=g.state.shadowsArray;if(be.render(n,e,t),!0===X&&ye.endShadows(),!0===this.info.autoReset&&this.info.reset(),xe.render(m,e),g.setupLights(y._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];je(m,e,i,i.viewport)}}else je(m,e,t);null!==S&&(ce.updateMultisampleRenderTarget(S),ce.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(y,e,t),Ce.resetDefaultState(),A=-1,M=null,v.pop(),g=v.length>0?v[v.length-1]:null,_.pop(),m=_.length>0?_[_.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,n){le.get(e.texture).__webglTexture=t,le.get(e.depthTexture).__webglTexture=n;const i=le.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===re.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=le.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){S=e,x=t,w=n;let i=!0,r=null,s=!1,o=!1;if(e){const a=le.get(e);void 0!==a.__useDefaultFramebuffer?(oe.bindFramebuffer(Ee.FRAMEBUFFER,null),i=!1):void 0===a.__webglFramebuffer?ce.setupRenderTarget(e):a.__hasExternalTextures&&ce.rebindTextures(e,le.get(e.texture).__webglTexture,le.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=le.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],s=!0):r=se.isWebGL2&&e.samples>0&&!1===ce.useMultisampledRTT(e)?le.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,C.copy(e.viewport),T.copy(e.scissor),E=e.scissorTest}else C.copy(G).multiplyScalar(D).floor(),T.copy(j).multiplyScalar(D).floor(),E=W;if(oe.bindFramebuffer(Ee.FRAMEBUFFER,r)&&se.drawBuffers&&i&&oe.drawBuffers(e,r),oe.viewport(C),oe.scissor(T),oe.setScissorTest(E),s){const i=le.get(e.texture);Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(o){const i=le.get(e.texture),r=t||0;Ee.framebufferTextureLayer(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}A=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=le.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){oe.bindFramebuffer(Ee.FRAMEBUFFER,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==$&&Me.convert(a)!==Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===V&&(re.has("EXT_color_buffer_half_float")||se.isWebGL2&&re.has("EXT_color_buffer_float"));if(!(l===F||Me.convert(l)===Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_TYPE)||l===z&&(se.isWebGL2||re.has("OES_texture_float")||re.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&Ee.readPixels(t,n,i,r,Me.convert(a),Me.convert(l),s)}finally{const e=null!==S?le.get(S).__webglFramebuffer:null;oe.bindFramebuffer(Ee.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);ce.setTexture2D(t,0),Ee.copyTexSubImage2D(Ee.TEXTURE_2D,n,0,0,e.x,e.y,r,s),oe.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,s=t.image.height,o=Me.convert(n.format),a=Me.convert(n.type);ce.setTexture2D(n,0),Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,n.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?Ee.texSubImage2D(Ee.TEXTURE_2D,i,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?Ee.compressedTexSubImage2D(Ee.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Ee.texSubImage2D(Ee.TEXTURE_2D,i,e.x,e.y,o,a,t.image),0===i&&n.generateMipmaps&&Ee.generateMipmap(Ee.TEXTURE_2D),oe.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=Me.convert(i.format),c=Me.convert(i.type);let u;if(i.isData3DTexture)ce.setTexture3D(i,0),u=Ee.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ce.setTexture2DArray(i,0),u=Ee.TEXTURE_2D_ARRAY}Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,i.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,i.unpackAlignment);const h=Ee.getParameter(Ee.UNPACK_ROW_LENGTH),d=Ee.getParameter(Ee.UNPACK_IMAGE_HEIGHT),p=Ee.getParameter(Ee.UNPACK_SKIP_PIXELS),f=Ee.getParameter(Ee.UNPACK_SKIP_ROWS),m=Ee.getParameter(Ee.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,g.width),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,g.height),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,e.min.x),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,e.min.y),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?Ee.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ee.compressedTexSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,g.data)):Ee.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,c,g),Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,h),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,d),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,p),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,f),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,m),0===r&&i.generateMipmaps&&Ee.generateMipmap(u),oe.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?ce.setTextureCube(e,0):e.isData3DTexture?ce.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ce.setTexture2DArray(e,0):ce.setTexture2D(e,0),oe.unbindTexture()},this.resetState=function(){x=0,w=0,S=null,oe.reset(),Ce.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Se}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===re?"display-p3":"srgb",t.unpackColorSpace=Xe.workingColorSpace===se?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===ne?ee:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ee?ne:ie}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class extends ho{}).prototype.isWebGL1Renderer=!0;class po{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Pn(e),this.near=t,this.far=n}clone(){return new po(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class fo extends dn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class mo extends it{constructor(e=null,t=1,n=1,i,r,s,o,a,l=1003,c=1003,u,h){super(null,s,o,a,l,c,i,r,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class go extends Rn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Pn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _o=new ut,vo=new ut,yo=new zt,bo=new Ut,xo=new kt;class wo extends dn{constructor(e=new qn,t=new go){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)_o.fromBufferAttribute(t,e-1),vo.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=_o.distanceTo(vo);e.setAttribute("lineDistance",new Un(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),xo.copy(n.boundingSphere),xo.applyMatrix4(i),xo.radius+=r,!1===e.ray.intersectsSphere(xo))return;yo.copy(i).invert(),bo.copy(e.ray).applyMatrix4(yo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new ut,c=new ut,u=new ut,h=new ut,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p)for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){const i=p.getX(n),r=p.getX(n+1);if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,r),bo.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(h);s<e.near||s>e.far||t.push({distance:s,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count)-1;n<i;n+=d){if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1),bo.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(h);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const So=new ut,Ao=new ut;class Mo extends wo{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)So.fromBufferAttribute(t,e),Ao.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+So.distanceTo(Ao);e.setAttribute("lineDistance",new Un(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Co extends Rn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Pn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const To=new zt,Eo=new Ut,Po=new kt,Io=new ut;class ko extends dn{constructor(e=new qn,t=new Co){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Po.copy(n.boundingSphere),Po.applyMatrix4(i),Po.radius+=r,!1===e.ray.intersectsSphere(Po))return;To.copy(i).invert(),Eo.copy(e.ray).applyMatrix4(To);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);Io.fromBufferAttribute(c,r),Ro(Io,r,a,i,e,t,this)}else for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)Io.fromBufferAttribute(c,n),Ro(Io,n,a,i,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Ro(e,t,n,i,r,s,o){const a=Eo.distanceSqToPoint(e);if(a<n){const n=new ut;Eo.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:o})}}class Do extends it{constructor(e,t,n,i,r,s,o,a,l){super(e,t,n,i,r,s,o,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Lo extends qn{constructor(e=1,t=1,n=1,i=32,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function _(n){const r=p,s=new Ne,f=new ut;let _=0;const v=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*y,0),h.push(0,y,0),d.push(.5,.5),p++;const b=p;for(let e=0;e<=i;e++){const t=e/i*a+o,n=Math.cos(t),r=Math.sin(t);f.x=v*r,f.y=m*y,f.z=v*n,u.push(f.x,f.y,f.z),h.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),p++}for(let e=0;e<i;e++){const t=r+e,i=b+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),_+=3}l.addGroup(g,_,!0===n?1:2),g+=_}!function(){const s=new ut,_=new ut;let v=0;const y=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+o,l=Math.sin(r),f=Math.cos(r);_.x=v*l,_.y=-g*n+m,_.z=v*f,u.push(_.x,_.y,_.z),s.set(l,y,f).normalize(),h.push(s.x,s.y,s.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],s=f[t][e+1];c.push(n,i,s),c.push(i,r,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Un(u,3)),this.setAttribute("normal",new Un(h,3)),this.setAttribute("uv",new Un(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lo(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Oo extends Lo{constructor(e=1,t=1,n=32,i=1,r=!1,s=0,o=2*Math.PI){super(0,e,t,n,i,r,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(e){return new Oo(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class No extends qn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],s=[];function o(e,t,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const o=e.clone().lerp(n,i/r),a=t.clone().lerp(n,i/r),l=r-i;for(let e=0;e<=l;e++)s[i][e]=0===e&&i===r?o:o.clone().lerp(a,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(s[e][n+1]),a(s[e+1][n]),a(s[e][n])):(a(s[e][n+1]),a(s[e+1][n+1]),a(s[e+1][n]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new ut,i=new ut,r=new ut;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],i),l(t[s+2],r),o(n,i,r,e)}(i),function(e){const t=new ut;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new ut;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=u(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(i,1-o)}var t;(function(){const e=new ut,t=new ut,n=new ut,i=new ut,o=new Ne,a=new Ne,l=new Ne;for(let h=0,d=0;h<r.length;h+=9,d+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=u(i);c(o,d+0,e,p),c(a,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new Un(r,3)),this.setAttribute("normal",new Un(r.slice(),3)),this.setAttribute("uv",new Un(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new No(e.vertices,e.indices,e.radius,e.details)}}class Fo extends No{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Fo(e.radius,e.detail)}}class Bo extends No{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Bo(e.radius,e.detail)}}class Uo extends No{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Uo(e.radius,e.detail)}}class zo extends qn{constructor(e=1,t=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],o=[],a=[],l=[],c=new ut,u=new ut,h=new ut;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),o.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/i),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,r=(i+1)*(e-1)+t-1,o=(i+1)*(e-1)+t,a=(i+1)*e+t;s.push(n,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new Un(o,3)),this.setAttribute("normal",new Un(a,3)),this.setAttribute("uv",new Un(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zo(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}function Vo(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}class Ho{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{const o=t[1];e<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class $o extends Ho{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=e,o=2*t-n;break;case 2402:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=e,a=2*n-t;break;case 2402:s=1,a=n+i[1]-i[0];break;default:s=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let e=0;e!==o;++e)r[e]=g*s[c+e]+_*s[l+e]+v*s[a+e]+y*s[u+e];return r}}class Go extends Ho{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(n-t)/(i-t),u=1-c;for(let e=0;e!==o;++e)r[e]=s[l+e]*u+s[a+e]*c;return r}}class jo extends Ho{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Wo{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Vo(t,this.TimeBufferType),this.values=Vo(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Vo(e.times,Array),values:Vo(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new jo(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Go(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new $o(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Z:t=this.InterpolantFactoryMethodDiscrete;break;case Q:t=this.InterpolantFactoryMethodLinear;break;case J:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Z;case this.InterpolantFactoryMethodLinear:return Q;case this.InterpolantFactoryMethodSmooth:return J}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,s),e=!1;break}s=i}if(void 0!==i&&(o=i,ArrayBuffer.isView(o)&&!(o instanceof DataView)))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}var o;return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===J,r=e.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(i)r=!0;else{const e=o*n,i=e-n,s=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[i+o]||n!==t[s+o]){r=!0;break}}}if(r){if(o!==s){e[s]=e[o];const i=o*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,o=0;o!==n;++o)t[i+o]=t[e+o];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Wo.prototype.TimeBufferType=Float32Array,Wo.prototype.ValueBufferType=Float32Array,Wo.prototype.DefaultInterpolation=Q;class qo extends Wo{}qo.prototype.ValueTypeName="bool",qo.prototype.ValueBufferType=Array,qo.prototype.DefaultInterpolation=Z,qo.prototype.InterpolantFactoryMethodLinear=void 0,qo.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Wo{}).prototype.ValueTypeName="color";(class extends Wo{}).prototype.ValueTypeName="number";class Xo extends Ho{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-t)/(i-t);let l=e*o;for(let e=l+o;l!==e;l+=4)ct.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Yo extends Wo{InterpolantFactoryMethodLinear(e){return new Xo(this.times,this.values,this.getValueSize(),e)}}Yo.prototype.ValueTypeName="quaternion",Yo.prototype.DefaultInterpolation=Q,Yo.prototype.InterpolantFactoryMethodSmooth=void 0;class Ko extends Wo{}Ko.prototype.ValueTypeName="string",Ko.prototype.ValueBufferType=Array,Ko.prototype.DefaultInterpolation=Z,Ko.prototype.InterpolantFactoryMethodLinear=void 0,Ko.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Wo{}).prototype.ValueTypeName="vector";Error;class Zo extends dn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Pn(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const Qo=new zt,Jo=new ut,ea=new ut;class ta{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ne(512,512),this.map=null,this.mapPass=null,this.matrix=new zt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ki,this._frameExtents=new Ne(1,1),this._viewportCount=1,this._viewports=[new rt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Jo.setFromMatrixPosition(e.matrixWorld),t.position.copy(Jo),ea.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ea),t.updateMatrixWorld(),Qo.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qo),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Qo)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class na extends ta{constructor(){super(new ji(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ia extends Zo{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(dn.DEFAULT_UP),this.updateMatrix(),this.target=new dn,this.shadow=new na}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ra extends Zo{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const sa=new zt,oa=new zt,aa=new zt;class la{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new bi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new bi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,aa.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,r=t.near*Math.tan(Te*t.fov*.5)/t.zoom;let s,o;oa.elements[12]=-n,sa.elements[12]=n,s=-r*t.aspect+i,o=r*t.aspect+i,aa.elements[0]=2*t.near/(o-s),aa.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(aa),s=-r*t.aspect-i,o=r*t.aspect-i,aa.elements[0]=2*t.near/(o-s),aa.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(aa)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(oa),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(sa)}}const ca="\\[\\]\\.:\\/",ua=new RegExp("["+ca+"]","g"),ha="[^"+ca+"]",da="[^"+ca.replace("\\.","")+"]",pa=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",ha)+/(WCOD+)?/.source.replace("WCOD",da)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ha)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ha)+"$"),fa=["material","materials","bones","map"];class ma{constructor(e,t,n){this.path=t,this.parsedPath=n||ma.parseTrackName(t),this.node=ma.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new ma.Composite(e,t,n):new ma(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ua,"")}static parseTrackName(e){const t=pa.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==fa.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=ma.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ma.Composite=class{constructor(e,t,n){const i=n||ma.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},ma.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ma.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ma.prototype.GetterByBindingType=[ma.prototype._getValue_direct,ma.prototype._getValue_array,ma.prototype._getValue_arrayElement,ma.prototype._getValue_toArray],ma.prototype.SetterByBindingTypeAndVersioning=[[ma.prototype._setValue_direct,ma.prototype._setValue_direct_setNeedsUpdate,ma.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ma.prototype._setValue_array,ma.prototype._setValue_array_setNeedsUpdate,ma.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ma.prototype._setValue_arrayElement,ma.prototype._setValue_arrayElement_setNeedsUpdate,ma.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ma.prototype._setValue_fromArray,ma.prototype._setValue_fromArray_setNeedsUpdate,ma.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class ga{constructor(e){this.value=e}clone(){return new ga(void 0===this.value.clone?this.value:this.value.clone())}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i);var _a=n(9894),va=n(6407),ya=n(2917);function ba(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ba(Object(n),!0).forEach((function(t){wa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ba(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wa(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sa(e){if("undefined"==typeof window)return;const t=new RegExp(`${e}=([^&#=]*)`).exec(window.location.search);return t?decodeURIComponent(t[1]):void 0}function Aa(e,t){return void 0!==e?e:t}function Ma(e,t){const n=Object.assign({},e);for(const i in t)void 0===e[i]&&(n[i]=t[i]);return n}function Ca(e,t){for(const n in t){const i=t[n];void 0!==i&&(e[n]=i)}return e}function Ta(e,t){t=Aa(t,[]);for(let n=0;n<e.length;n++)Array.isArray(e[n])?Ta(e[n],t):t.push(e[n]);return t}function Ea(){if("undefined"==typeof window)return!1;const e=window.navigator.userAgent;return/Opera|OPR/.test(e)?"Opera":/Chrome/i.test(e)?"Chrome":/Firefox/i.test(e)?"Firefox":/Mobile(\/.*)? Safari/i.test(e)?"Mobile Safari":/MSIE/i.test(e)?"Internet Explorer":!!/Safari/i.test(e)&&"Safari"}function Pa(e){window.open(e,"_blank")||(window.location.href=e)}function Ia(e,t="download"){if(!e)return;const n="Safari"===Ea(),i=/CriOS\/[\d]+/.test(window.navigator.userAgent),r=document.createElement("a");function s(e){Pa(i?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"))}if("undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else if((n||i)&&FileReader)if(e instanceof Blob){var o=new FileReader;o.onloadend=function(){s(o.result)},o.readAsDataURL(e)}else s(e);else{let n=!1;e instanceof Blob&&(e=URL.createObjectURL(e),n=!0),"download"in r?(r.style.display="hidden",document.body.appendChild(r),r.href=e,r.download=t,r.target="_blank",r.click(),document.body.removeChild(r)):Pa(e),n&&window.URL.revokeObjectURL(e)}}function ka(e,t,n){let i,r,s,o=null,a=0;function l(){a=!1===n.leading?0:Date.now(),o=null,s=e.apply(i,r),o||(i=r=null)}return n||(n={}),function(){var c=Date.now();a||!1!==n.leading||(a=c);var u=t-(c-a);return i=this,r=arguments,u<=0||u>t?(o&&(clearTimeout(o),o=null),a=c,s=e.apply(i,r),o||(i=r=null)):o||!1===n.trailing||(o=setTimeout(l,u)),s}}function Ra(e,t){return e<t?-1:e>t?1:0}function Da(e,t,n=Ra){let i=0,r=e.length-1;for(;i<=r;){const s=i+r>>1,o=n(t,e[s]);if(o>0)i=s+1;else{if(!(o<0))return s;r=s-1}}return-i-1}function La(e,t,n){const i=function(e,t){let n=e.length-1;if(e[n]<t)return-1;let i=0;for(;i<=n;){const r=i+n>>1;e[r]>=t?n=r-1:i=r+1}return n+1}(e,t),r=function(e,t){if(e[0]>t)return-1;let n=0,i=e.length-1;for(;n<=i;){const r=n+i>>1;e[r]>t?i=r-1:n=r+1}return n-1}(e,n);return-1===i||-1===r||i>r?0:r-i+1}function Oa(e){return e.sort().filter((function(e,t,n){return 0===t||e!==n[t-1]}))}function Na(e){const t=28672;if(e.length>t){const n=[];for(let i=0;i<e.length;i+=t)n.push(String.fromCharCode.apply(null,e.subarray(i,i+t)));return n.join("")}return String.fromCharCode.apply(null,e)}function Fa(e,t){switch(e){case"int8":return new Int8Array(t);case"int16":return new Int16Array(t);case"int32":return new Int32Array(t);case"uint8":return new Uint8Array(t);case"uint16":return new Uint16Array(t);case"uint32":return new Uint32Array(t);case"float32":return new Float32Array(t);default:throw new Error("arrayType unknown: "+e)}}function Ba(e,t){return new(t>65535?Uint32Array:Uint16Array)(e)}function Ua(e){return e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e}function za(e,t){return void 0===e?e=new t:Array.isArray(e)&&(e=(new t).fromArray(e)),e}function Va(e){return za(e,ut)}function Ha(e){return za(e,zt)}function $a(e){return za(e,ct)}function Ga(e){return(t=e)instanceof(n=Float32Array)?t:new n(t);var t,n}function ja(e){return Aa(e,"").toString().toLowerCase()}class Wa{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[ja(e)]=t}get(e){return this._dict[ja(e)]}get names(){return Object.keys(this._dict)}}function qa(e){return.01745*e}const Xa="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Ya=new Array(36);function Ka(){let e,t=0;for(let n=0;n<36;n++)8===n||13===n||18===n||23===n?Ya[n]="-":14===n?Ya[n]="4":(t<=2&&(t=33554432+16777216*Math.random()|0),e=15&t,t>>=4,Ya[n]=Xa[19===n?3&e|8:e]);return Ya.join("")}function Za(e,t,n){return Math.max(t,Math.min(n,e))}function Qa(e,t,n){return e+(t-e)*n}function Ja(e,t,n,i,r,s){const o=(n-e)*s,a=(i-t)*s,l=r*r;return(2*t-2*n+o+a)*(r*l)+(-3*t+3*n-2*o-a)*l+o*r+t}function el(e,t,n){var i;return i=function(e,t,n){return(e-t)/(n-t)}(n,e,t),(n=Za(i,0,1))*n*(3-2*n)}var tl="sRGB";const nl={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},il=new Pn;function rl(e,t,n){const i=n.value;return n.value=function(e,t){let n=i.bind(this,e,t)();return"linear"==tl?(il.set(n),il.convertSRGBToLinear(),il.getHex()):n},n}class sl{constructor(e={}){this.parameters=Ma(e,nl),"string"==typeof this.parameters.value&&(this.parameters.value=il.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(e={}){const t=Ma(e,this.parameters);return"rainbow"===t.scale?t.scale=["red","orange","yellow","green","blue"]:"rwb"===t.scale&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),_a.scale(t.scale).mode(t.mode).domain(t.domain).out("num")}colorToArray(e,t=[],n=0){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t}atomColorToArray(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,n,i){return this.colorToArray(this.bondColor(e,t),n,i)}volumeColorToArray(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)}positionColorToArray(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)}}var ol,al;(al=ol||(ol={}))[al.PROTEIN=1]="PROTEIN",al[al.NUCLEIC=2]="NUCLEIC",al[al.RNA=3]="RNA",al[al.DNA=4]="DNA",al[al.POLYMER=5]="POLYMER",al[al.WATER=6]="WATER",al[al.HELIX=7]="HELIX",al[al.SHEET=8]="SHEET",al[al.TURN=9]="TURN",al[al.BACKBONE=10]="BACKBONE",al[al.SIDECHAIN=11]="SIDECHAIN",al[al.ALL=12]="ALL",al[al.HETERO=13]="HETERO",al[al.ION=14]="ION",al[al.SACCHARIDE=15]="SACCHARIDE",al[al.SUGAR=15]="SUGAR",al[al.BONDED=16]="BONDED",al[al.RING=17]="RING",al[al.AROMATICRING=18]="AROMATICRING",al[al.METAL=19]="METAL",al[al.POLARH=20]="POLARH",al[al.NONE=21]="NONE";const ll=["*","","ALL"],cl=["NONE"],ul=[ol.BACKBONE,ol.SIDECHAIN,ol.BONDED,ol.RING,ol.AROMATICRING,ol.METAL,ol.POLARH],hl=[ol.POLYMER,ol.WATER],dl=["ALA","GLY","SER"],pl=["CYS","SER","THR"],fl=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],ml=["PHE","TRP","TYR","HIS"],gl=["ASN","GLN"],_l=["ASP","GLU"],vl=["ARG","HIS","LYS"],yl=["ARG","ASP","GLU","HIS","LYS"],bl=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],xl=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],wl=["HIS","PHE","PRO","TRP","TYR"],Sl=["ALA","GLY","ILE","LEU","VAL"];function Al(e,t){if(void 0===t.atomname&&void 0===t.element&&void 0===t.altloc&&void 0===t.atomindex&&void 0===t.keyword&&void 0===t.inscode&&void 0===t.resname&&void 0===t.sstruc&&void 0===t.resno&&void 0===t.chainname&&void 0===t.model)return-1;if(void 0!==t.keyword){if(t.keyword===ol.BACKBONE&&!e.isBackbone())return!1;if(t.keyword===ol.SIDECHAIN&&!e.isSidechain())return!1;if(t.keyword===ol.BONDED&&!e.isBonded())return!1;if(t.keyword===ol.RING&&!e.isRing())return!1;if(t.keyword===ol.AROMATICRING&&!e.isAromatic())return!1;if(t.keyword===ol.HETERO&&!e.isHetero())return!1;if(t.keyword===ol.PROTEIN&&!e.isProtein())return!1;if(t.keyword===ol.NUCLEIC&&!e.isNucleic())return!1;if(t.keyword===ol.RNA&&!e.isRna())return!1;if(t.keyword===ol.DNA&&!e.isDna())return!1;if(t.keyword===ol.POLYMER&&!e.isPolymer())return!1;if(t.keyword===ol.WATER&&!e.isWater())return!1;if(t.keyword===ol.HELIX&&!e.isHelix())return!1;if(t.keyword===ol.SHEET&&!e.isSheet())return!1;if(t.keyword===ol.TURN&&!e.isTurn())return!1;if(t.keyword===ol.ION&&!e.isIon())return!1;if(t.keyword===ol.SACCHARIDE&&!e.isSaccharide())return!1;if(t.keyword===ol.METAL&&!e.isMetal())return!1;if(t.keyword===ol.POLARH&&!e.isPolarHydrogen())return!1}if(void 0!==t.atomname&&t.atomname!==e.atomname)return!1;if(void 0!==t.element&&t.element!==e.element)return!1;if(void 0!==t.altloc&&t.altloc!==e.altloc)return!1;if(void 0!==t.atomindex&&Da(t.atomindex,e.index)<0)return!1;if(void 0!==t.resname)if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1;if(void 0!==t.sstruc&&t.sstruc!==e.sstruc)return!1;if(void 0!==t.resno)if(Array.isArray(t.resno)&&2===t.resno.length){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1;return!(void 0!==t.inscode&&t.inscode!==e.inscode||void 0!==t.chainname&&t.chainname!==e.chainname||void 0!==t.model&&t.model!==e.modelIndex)}function Ml(e,t){if(void 0===t.resname&&void 0===t.resno&&void 0===t.inscode&&void 0===t.sstruc&&void 0===t.model&&void 0===t.chainname&&void 0===t.atomindex&&(void 0===t.keyword||ul.includes(t.keyword)))return-1;if(void 0!==t.keyword){if(t.keyword===ol.HETERO&&!e.isHetero())return!1;if(t.keyword===ol.PROTEIN&&!e.isProtein())return!1;if(t.keyword===ol.NUCLEIC&&!e.isNucleic())return!1;if(t.keyword===ol.RNA&&!e.isRna())return!1;if(t.keyword===ol.DNA&&!e.isDna())return!1;if(t.keyword===ol.POLYMER&&!e.isPolymer())return!1;if(t.keyword===ol.WATER&&!e.isWater())return!1;if(t.keyword===ol.HELIX&&!e.isHelix())return!1;if(t.keyword===ol.SHEET&&!e.isSheet())return!1;if(t.keyword===ol.TURN&&!e.isTurn())return!1;if(t.keyword===ol.ION&&!e.isIon())return!1;if(t.keyword===ol.SACCHARIDE&&!e.isSaccharide())return!1}if(void 0!==t.atomindex&&0===La(t.atomindex,e.atomOffset,e.atomEnd))return!1;if(void 0!==t.resname)if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1;if(void 0!==t.sstruc&&t.sstruc!==e.sstruc)return!1;if(void 0!==t.resno)if(Array.isArray(t.resno)&&2===t.resno.length){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1;return!(void 0!==t.inscode&&t.inscode!==e.inscode||void 0!==t.chainname&&t.chainname!==e.chainname||void 0!==t.model&&t.model!==e.modelIndex)}function Cl(e,t){if(!(void 0!==t.chainname||void 0!==t.model||void 0!==t.atomindex||void 0!==t.keyword&&hl.includes(t.keyword)&&e.entity))return-1;if(void 0!==t.keyword){if(t.keyword===ol.POLYMER&&!e.entity.isPolymer())return!1;if(t.keyword===ol.WATER&&!e.entity.isWater())return!1}return!(void 0!==t.atomindex&&0===La(t.atomindex,e.atomOffset,e.atomEnd)||void 0!==t.chainname&&t.chainname!==e.chainname||void 0!==t.model&&t.model!==e.modelIndex)}function Tl(e,t){return void 0===t.model&&void 0===t.atomindex?-1:!(void 0!==t.atomindex&&0===La(t.atomindex,e.atomOffset,e.atomEnd)||void 0!==t.model&&t.model!==e.index)}function El(e,t){if(null===e)return!1;if(e.error)return!1;if(!e.rules||0===e.rules.length)return!1;const n=e.rules.length,i=!e.negate,r=!!e.negate,s=[];for(let i=0;i<n;++i){const n=e.rules[i];n.hasOwnProperty("operator")&&(s[i]=El(n,t))}return function(o){const a="AND"===e.operator;let l=!1;for(let c=0;c<n;++c){const n=e.rules[c];let u;if(n.hasOwnProperty("operator")){const e=s[c];if(u=!1!==e?e(o):-1,-1===u){l=!0;continue}if(!0===u){if(a)continue;return i}if(a)return r}else{if(n.keyword===ol.ALL){if(a)continue;return i}if(n.keyword===ol.NONE){if(a)continue;return r}if(u=t(o,n),-1!==u){if(!0===u){if(a)continue;return i}if(a)return r}else l=!0}}return l?-1:a?i:r}}function Pl(e,t){if(e.error)return e;if(!e.rules||0===e.rules.length)return e;const n=e.rules.length,i={operator:e.operator,rules:[]};e.hasOwnProperty("negate")&&(i.negate=e.negate);for(let r=0;r<n;++r){const n=e.rules[r];if(n.hasOwnProperty("operator")){const e=Pl(n,t);null!==e&&i.rules.push(e)}else t(n)||i.rules.push(n)}return i.rules.length>0?e:null}function Il(e,t=!1){let n=e;return t&&(n=Pl(e,(function(e){return void 0!==e.keyword&&!ul.includes(e.keyword)||void 0!==e.model||void 0!==e.chainname||void 0!==e.resname||void 0!==e.resno||void 0!==e.sstruc}))),El(n,Al)}function kl(e,t=!1){let n=e;return t&&(n=Pl(e,(function(e){return!(void 0===e.keyword||!ul.includes(e.keyword))||void 0!==e.model||void 0!==e.chainname||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc}))),El(n,Ml)}function Rl(e,t=!1){let n=e;return t&&(n=Pl(e,(function(e){return void 0!==e.keyword&&!hl.includes(e.keyword)||void 0!==e.resname||void 0!==e.resno||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc||void 0!==e.sstruc||void 0!==e.inscode}))),El(n,Cl)}function Dl(e,t=!1){let n=e;return t&&(n=Pl(e,(function(e){return void 0!==e.keyword||void 0!==e.chainname||void 0!==e.resname||void 0!==e.resno||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc||void 0!==e.sstruc||void 0!==e.inscode}))),El(n,Tl)}class Ll{constructor(e){this.signals={stringChanged:new va.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(void 0===e&&(e=this.string||""),e===this.string)return;try{this.selection=function(e){let t={operator:void 0,rules:[]};if(!e)return t;let n,i,r=t;const s=[];"("===(e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)&&")"===e.substr(-1)&&(e=e.slice(1,-1).trim());const o=e.split(/\s+/),a=e=>{n={operator:e,rules:[]},void 0===r?(r=n,t=n):(r.rules.push(n),s.push(r),r=n)},l=function(e){i=r,r=s.pop(),void 0===r&&(a(e),c(i))},c=function(e){r.rules.push(e)};let u=!1;for(let e=0;e<o.length;++e){const t=o[e],n=t.toUpperCase();if("("===t){u=!1,a();continue}if(")"===t){l(),r.negate&&l();continue}if(u>0)if("NOT"===n)u=1;else if(1===u)u=2;else{if(2!==u)throw new Error("something went wrong with 'not'");u=!1,l()}if("AND"===n){if("OR"===r.operator){const e=r.rules.pop();a("AND"),c(e)}else r.operator="AND";continue}if("OR"===n){"AND"===r.operator?l("OR"):r.operator="OR";continue}if("NOT"===t.toUpperCase()){u=1,a(),r.negate=!0;continue}if(+n!=+n){const e=ol[n];if(void 0!==e){c({keyword:e});continue}}if("HYDROGEN"===n){c({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if("SMALL"===n){c({resname:dl});continue}if("NUCLEOPHILIC"===n){c({resname:pl});continue}if("HYDROPHOBIC"===n){c({resname:fl});continue}if("AROMATIC"===n){c({resname:ml});continue}if("AMIDE"===n){c({resname:gl});continue}if("ACIDIC"===n){c({resname:_l});continue}if("BASIC"===n){c({resname:vl});continue}if("CHARGED"===n){c({resname:yl});continue}if("POLAR"===n){c({resname:bl});continue}if("NONPOLAR"===n){c({resname:xl});continue}if("CYCLIC"===n){c({resname:wl});continue}if("ALIPHATIC"===n){c({resname:Sl});continue}if("SIDECHAINATTACHED"===n){c({operator:"OR",rules:[{keyword:ol.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:ol.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:ol.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if("APOLARH"===n){c({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:ol.POLARH}]}]});continue}if("LIGAND"===n){c({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:ol.HETERO},{negate:!0,operator:void 0,rules:[{keyword:ol.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:ol.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:ol.WATER},{keyword:ol.ION}]}]}]});continue}if(-1!==ll.indexOf(n)){c({keyword:ol.ALL});continue}if("@"===t.charAt(0)){const e=t.substr(1).split(",").map((e=>parseInt(e)));e.sort((function(e,t){return e-t})),c({atomindex:e});continue}if("#"===t.charAt(0)){console.error("# for element selection deprecated, use _"),c({element:n.substr(1)});continue}if("_"===t.charAt(0)){c({element:n.substr(1)});continue}if("["===t[0]&&"]"===t[t.length-1]){const e=n.substr(1,t.length-2).split(","),i=e.length>1?e:e[0];c({resname:i});continue}if(t.length>=1&&t.length<=4&&"^"!==t[0]&&":"!==t[0]&&"."!==t[0]&&"%"!==t[0]&&"/"!==t[0]&&isNaN(parseInt(t))){c({resname:n});continue}const i={operator:"AND",rules:[]},s=t.split("/");if(s.length>1&&s[1]){if(isNaN(parseInt(s[1])))throw new Error("model must be an integer");i.rules.push({model:parseInt(s[1])})}const h=s[0].split("%");h.length>1&&i.rules.push({altloc:h[1]});const d=h[0].split(".");if(d.length>1&&d[1]){if(d[1].length>4)throw new Error("atomname must be one to four characters");i.rules.push({atomname:d[1].substring(0,4).toUpperCase()})}const p=d[0].split(":");p.length>1&&p[1]&&i.rules.push({chainname:p[1]});const f=p[0].split("^");if(f.length>1&&i.rules.push({inscode:f[1]}),f[0]){let e,t;"-"===f[0][0]&&(f[0]=f[0].substr(1),e=!0),f[0].includes("--")&&(f[0]=f[0].replace("--","-"),t=!0);let n=f[0].split("-");if(1===n.length){let t=parseInt(n[0]);if(isNaN(t))throw new Error("resi must be an integer");e&&(t*=-1),i.rules.push({resno:t})}else{if(2!==n.length)throw new Error("resi range must contain one '-'");{const r=n.map((e=>parseInt(e)));e&&(r[0]*=-1),t&&(r[1]*=-1),i.rules.push({resno:[r[0],r[1]]})}}}if(1===i.rules.length)c(i.rules[0]);else{if(!(i.rules.length>1))throw new Error("empty selection chunk");c(i)}}return void 0===t.operator&&1===t.rules.length&&t.rules[0].hasOwnProperty("operator")&&(t=t.rules[0]),t}(e)}catch(e){this.selection={error:e.message}}const n=this.selection;this.string=e,this.test=Il(n),this.residueTest=kl(n),this.chainTest=Rl(n),this.modelTest=Dl(n),this.atomOnlyTest=Il(n,!0),this.residueOnlyTest=kl(n,!0),this.chainOnlyTest=Rl(n,!0),this.modelOnlyTest=Dl(n,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return ll.includes(this.string.toUpperCase())}isNoneSelection(){return cl.includes(this.string.toUpperCase())}}class Ol extends sl{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach((e=>{const[t,n,i={}]=e;ic.hasScheme(t)?Object.assign(i,{scheme:t,structure:this.parameters.structure}):Object.assign(i,{scheme:"uniform",value:new Pn(t).getHex()}),this.colormakerList.push(ic.getScheme(i)),this.selectionList.push(new Ll(n))}))}atomColor(e){for(let t=0,n=this.selectionList.length;t<n;++t){const n=this.selectionList[t].test;if(n&&n(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const Nl={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},Fl={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function Bl(e){const t=e;return e.forEach((function(e){e.__deps&&Array.prototype.push.apply(t,Bl(e.__deps))})),t}function Ul(e){return Oa(Bl(e)).map((function(e){return e.toString()})).join("\n\n\n")}function zl(e){const t=e.data.__name,n=e.data.__postId;if(void 0===t)console.error("message __name undefined");else if(void 0===self.func)console.error("worker func undefined",t);else{const t=function(e,t){e=e||{},void 0!==n&&(e.__postId=n);try{self.postMessage(e,t)}catch(t){console.error("self.postMessage:",t),self.postMessage(e)}};self.func(e,t)}}function Vl(e,t){let n="'use strict';\n\n"+Ul(t);return n+="\n\n\nself.func = "+e.toString()+";",n+="\n\n\nself.onmessage = "+zl.toString()+";",new Blob([n],{type:"application/javascript"})}const Hl=Ea();let $l=!1;try{const e=Object.defineProperty({},"passive",{get:function(){$l=!0}});window.addEventListener("test",(e=>{}),e)}catch(al){}const Gl="undefined"!=typeof window&&void 0!==window.orientation;let jl=!1;function Wl(e){jl=e}let ql=!1;function Xl(e){ql=e}const Yl={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let Kl={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1};function Zl(e={}){Object.assign(Kl,e)}let Ql=!!(Jl=Sa("debug"))&&("string"!=typeof Jl||/^1|true|t|yes|y$/i.test(Jl));var Jl;function ec(e){Ql=e}const tc=["ngl","js"],nc=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(e,t,n){this._funcDict[e]=t,this._depsDict[e]=n}get(e){return this._blobDict[e]||(this._blobDict[e]=Vl(this._funcDict[e],this._depsDict[e])),this._blobDict[e]}},ic=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(e){const t=((e||{}).scheme||"").toLowerCase();let n;return n=t in this.schemes?this.schemes[t]:t in this.userSchemes?this.userSchemes[t]:sl,new n(e)}getSchemes(){const e={};return Object.keys(this.schemes).forEach((function(t){e[t]=t})),Object.keys(this.userSchemes).forEach((function(t){e[t]=t.split("|")[1]})),e}getScales(){return Nl}getModes(){return Fl}add(e,t){e=e.toLowerCase(),this.schemes[e]=t}addScheme(e,t){return function(e){return e instanceof sl}(e)||(e=this._createScheme(e)),this._addUserScheme(e,t)}_addUserScheme(e,t){t=t||"";const n=`${Ka()}|${t}`.toLowerCase();return this.userSchemes[n]=e,n}removeScheme(e){e=e.toLowerCase(),delete this.userSchemes[e]}_createScheme(e){return class extends sl{constructor(t){super(t),e.call(this,t)}}}addSelectionScheme(e,t){return this._addUserScheme(class extends Ol{constructor(t){super(Object.assign({dataList:e},t))}},t)}hasScheme(e){return(e=e.toLowerCase())in this.schemes||e in this.userSchemes}},rc=new Wa("datasource"),sc=new Wa("representatation"),oc=new class extends Wa{constructor(){super("parser")}__hasObjName(e,t){const n=this.get(e);return n&&n.prototype.__objName===t}isTrajectory(e){return this.__hasObjName(e,"frames")}isStructure(e){return this.__hasObjName(e,"structure")}isVolume(e){return this.__hasObjName(e,"volume")}isSurface(e){return this.__hasObjName(e,"surface")}isBinary(e){const t=this.get(e);return t&&t.prototype.isBinary}isXml(e){const t=this.get(e);return t&&t.prototype.isXml}isJson(e){const t=this.get(e);return t&&t.prototype.isJson}getTrajectoryExtensions(){return this.names.filter((e=>this.isTrajectory(e)))}getStructureExtensions(){return this.names.filter((e=>this.isStructure(e)))}getVolumeExtensions(){return this.names.filter((e=>this.isVolume(e)))}getSurfaceExtensions(){return this.names.filter((e=>this.isSurface(e)))}},ac=new Wa("shader"),lc=new Wa("decompressor"),cc=new Wa("component"),uc=new Wa("buffer"),hc=new Wa("picker");let dc,pc;function fc(e){dc=e}function mc(e){pc=e}class gc{constructor(e,t={}){this.chunkSize=10485760,this.newline="\n",this.__pointer=0,this.__partialLine="",this.compressed=Aa(t.compressed,!1),this.binary=Aa(t.binary,!1),this.json=Aa(t.json,!1),this.xml=Aa(t.xml,!1),this.src=e}isBinary(){return this.binary||this.compressed}read(){return this._read().then((e=>{const t=this.compressed?lc.get(this.compressed):void 0;return this.compressed&&t?this.data=t(e):((this.binary||this.compressed)&&e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.data=e),this.data}))}_chunk(e,t){return t=Math.min(this.data.length,t),0===e&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)}chunk(e){const t=e+this.chunkSize;return this._chunk(e,t)}peekLines(e){const t=this.data,n=t.length,i=this.isBinary()?this.newline.charCodeAt(0):this.newline;let r,s=0;for(r=0;r<n&&(t[r]===i&&++s,s!==e);++r);const o=this._chunk(0,r+1);return this.chunkToLines(o,"",r>n).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?Na(this.data):this.data}chunkToLines(e,t,n){const i=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(i),partialLine:""};let r=[];const s=this.isBinary()?Na(e):e,o=s.lastIndexOf(i);if(-1===o)t+=s;else{const e=t+s.substr(0,o);r=r.concat(e.split(i)),t=o===s.length-i.length?"":s.substr(o+i.length)}return n&&""!==t&&r.push(t),{lines:r,partialLine:t}}nextChunk(){const e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)}nextChunkOfLines(){const e=this.nextChunk();if(void 0===e)return;const t=this.__pointer>this.data.length,n=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=n.partialLine,n.lines}eachChunk(e){const t=this.chunkSize,n=this.data.length,i=this.chunkCount();for(let r=0;r<n;r+=t)e(this.chunk(r),Math.round(r/t),i)}eachChunkOfLines(e){this.eachChunk(((t,n,i)=>{const r=n===i+1,s=this.chunkToLines(t,this.__partialLine,r);this.__partialLine=s.partialLine,e(s.lines,n,i)}))}dispose(){delete this.src}}class _c extends gc{_read(){return new Promise(((e,t)=>{const n=this.src,i=new FileReader;i.onload=t=>{t.target&&e(t.target.result)},i.onerror=e=>t(e),this.binary||this.compressed?i.readAsArrayBuffer(n):i.readAsText(n)}))}}class vc extends gc{_read(){return new Promise(((e,t)=>{const n=this.src,i=new XMLHttpRequest;i.open("GET",n,!0),i.addEventListener("load",(()=>{if(200===i.status||304===i.status||0===i.status)try{e(i.response)}catch(e){t(e)}else t(i.statusText)}),!1),i.addEventListener("error",(e=>t("network error")),!1),this.isBinary()?i.responseType="arraybuffer":this.json?i.responseType="json":this.xml?i.responseType="document":i.responseType="text",i.send()}))}}class yc{constructor(e,t={}){this.parameters=Ma(t,{ext:"",compressed:!1,binary:oc.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});const n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:oc.isJson(this.parameters.ext),xml:oc.isXml(this.parameters.ext)};"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Blob&&e instanceof Blob?this.streamer=new _c(e,n):this.streamer=new vc(e,n)}}class bc extends yc{constructor(e,t={}){super(e,t),this.parserParams={voxelSize:t.voxelSize,firstModelOnly:t.firstModelOnly,asTrajectory:t.asTrajectory,cAlphaOnly:t.cAlphaOnly,delimiter:t.delimiter,comment:t.comment,columnNames:t.columnNames,inferBonds:t.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(oc.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class xc{constructor(e,t,n){this.name=t,this.path=n,this.signals={elementAdded:new va.Signal,elementRemoved:new va.Signal,nameChanged:new va.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(e){Yl.error("Script compilation failed",e),this.fn=function(){}}}run(e){return new Promise(((t,n)=>{try{this.fn.apply(null,[e,this.name,this.path,this.dir]),t()}catch(e){Yl.error("Script.fn",e),n(e)}}))}}class wc extends yc{load(){return this.streamer.read().then((()=>new xc(this.streamer.asText(),this.parameters.name,this.parameters.path)))}}function Sc(e){const t=lc.names;let n,i,r="";n=e instanceof File?e.name:e instanceof Blob?"":e;const s=n.lastIndexOf("?"),o=-1!==s?n.substring(s):"";n=n.substring(0,-1===s?n.length:s);const a=n.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const c=a.split(".");let u=c.length>1?(c.pop()||"").toLowerCase():"";const h=n.match(/^(.+):\/\/(.+)$/);h&&(r=h[1].toLowerCase(),n=h[2]||"");const d=n.substring(0,n.lastIndexOf("/")+1);if(t.includes(u)){i=u;const e=n.length-u.length-1;u=(n.substr(0,e).split(".").pop()||"").toLowerCase();const t=l.length-u.length-1;l=l.substr(0,t)}else i=!1;return{path:n,name:a,ext:u,base:l,dir:d,compressed:i,protocol:r,query:o,src:e}}function Ac(e){let t=Sc(e);const n=rc.get(t.protocol);return n&&(t=Sc(n.getUrl(t.src)),!t.ext&&n.getExt&&(t.ext=n.getExt(e))),t}function Mc(e,t={}){const n=Object.assign(Ac(e),t);let i;return oc.names.includes(n.ext)?i=new bc(n.src,n):tc.includes(n.ext)&&(i=new wc(n.src,n)),i?i.load():Promise.reject(new Error(`autoLoad: ext '${n.ext}' unknown`))}class Cc{getBlob(){return new Blob([this.getData()],{type:this.mimeType})}download(e,t){e=Aa(e,this.defaultName),t=Aa(t,this.defaultExt),Ia(this.getBlob(),`${e}.${t}`)}}class Tc extends Cc{constructor(e,t){super(),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="pdb";const n=Object.assign({},t);this.renumberSerial=Aa(n.renumberSerial,!0),this.remarks=function(e){return Array.isArray(e)?e:[e]}(Aa(n.remarks,[])),this.structure=e,this._records=[]}_writeRecords(){this._records.length=0,this._writeTitle(),this._writeRemarks(),this._writeAtoms()}_writeTitle(){this._records.push((0,ya.sprintf)("TITLE %-74s",this.structure.name))}_writeRemarks(){this.remarks.forEach((e=>{this._records.push((0,ya.sprintf)("REMARK %-73s",e))})),this.structure.trajectory&&(this._records.push((0,ya.sprintf)("REMARK %-73s","Trajectory '"+this.structure.trajectory.name+"'")),this._records.push((0,ya.sprintf)("REMARK %-73s",`Frame ${this.structure.trajectory.frame}`)))}_writeAtoms(){let e=1,t=1,n=" ",i=" ";const r=this.structure.modelStore.count>1;this.structure.eachModel((s=>{r&&this._records.push((0,ya.sprintf)("MODEL     %4d%-66s",t++,"")),s.eachAtom((t=>{const r=t.hetero?"HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s":"ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s",s=this.renumberSerial?e:t.serial;let o=t.atomname;(1===o.length||o.length<4&&1===t.element.length&&o[0]===t.element)&&(o=" "+o),t.formalCharge?(n=Math.abs(t.formalCharge).toPrecision(1),i=t.formalCharge>0?"+":"-"):(n=" ",i=" "),this._records.push((0,ya.sprintf)(r,s,o,t.resname,Aa(t.chainname," "),t.resno,t.x,t.y,t.z,Aa(t.occupancy,1),Aa(t.bfactor,0),"",Aa(t.element,""),n,i)),e+=1}),this.structure.getSelection()),r&&this._records.push((0,ya.sprintf)("%-80s","ENDMDL"))})),this._records.push((0,ya.sprintf)("%-80s","END"))}getString(){return console.warn("PdbWriter.getString() is deprecated, use .getData instead"),this.getData()}getData(){return this._writeRecords(),this._records.join("\n")}}class Ec extends Cc{constructor(e){super(),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="sdf",this.structure=e,this._records=[]}get idString(){return this.structure.id}get titleString(){return"  "+this.structure.title}get countsString(){return(0,ya.sprintf)("%3i%3i  0  0  0  0  0  0  0  0999 V2000",this.structure.atomCount,this.structure.bondCount)}get chargeLines(){const e=[];this.structure.eachAtom((t=>{null!=t.formalCharge&&0!==t.formalCharge&&e.push([t.index,t.formalCharge])}));const t=[];for(let n=0;n<e.length;n+=8){const i=Math.min(8,e.length-n);let r=(0,ya.sprintf)("M  CHG%3i",i);for(let t=n;t<n+i;t++)r+=(0,ya.sprintf)(" %3i %3i",e[t][0]+1,e[t][1]);t.push(r)}return t}formatAtom(e){let t=0;null!=e.formalCharge&&0!==e.formalCharge&&(t=4-e.formalCharge);const n=(0,ya.sprintf)("%10.4f%10.4f%10.4f %-3s 0%3i  0  0  0",e.x,e.y,e.z,e.element,t);if(48!==n.length)throw new Error("Incompatible atom for sdf format");return n}formatBond(e){return(0,ya.sprintf)("%3i%3i%3i  0  0  0",e.atomIndex1+1,e.atomIndex2+1,e.bondOrder)}_writeRecords(){this._records.length=0,this._writeHeader(),this._writeCTab(),this._writeFooter()}_writeHeader(){this._records.push(this.idString,this.titleString,"")}_writeCTab(){this._records.push(this.countsString),this.structure.eachAtom((e=>{this._records.push(this.formatAtom(e))})),this.structure.eachBond((e=>{this._records.push(this.formatBond(e))})),this.chargeLines.forEach((e=>{this._records.push(e)})),this._records.push("M  END")}_writeFooter(){this._records.push("$$$$")}getData(){return this._writeRecords(),this._records.join("\n")}}const Pc=[];class Ic{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;void 0===e&&(e=8192),"number"==typeof e?e=new ArrayBuffer(e):n=!0;const i=t.offset?t.offset>>>0:0;let r=e.byteLength-i,s=i;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(s=e.byteOffset+i),e=e.buffer),this._lastWrittenByte=n?r:0,this.buffer=e,this.length=r,this.byteLength=r,this.byteOffset=s,this._data=new DataView(this.buffer,s,r)}available(e){return void 0===e&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return void 0===e&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(void 0===e&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){void 0===e&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){Pc.length=e;for(var t=0;t<e;t++)Pc[t]=this.readChar();return Pc.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class kc extends Cc{constructor(e){super(),this.mimeType="application/vnd.ms-pki.stl",this.defaultName="surface",this.defaultExt="stl",this.surface=e}getData(){const e=this.surface.index.length/3,t=new Ic(2*e+3*e*4*4+80+4);t.skip(80),t.writeUint32(e);const n=new ut,i=new ut,r=new ut,s=new ut;for(let o=0;o<e;o++){const e=[this.surface.index[3*o],this.surface.index[3*o+1],this.surface.index[3*o+2]];i.fromArray(this.surface.normal,3*e[0]),r.fromArray(this.surface.normal,3*e[1]),s.fromArray(this.surface.normal,3*e[2]),n.addVectors(i,r).add(s).normalize(),t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z);for(let i=0;i<3;i++)n.fromArray(this.surface.position,3*e[i]),t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z);t.writeUint16(0)}return new DataView(t.buffer)}}class Rc{constructor(){this.count=0,this.signals={countChanged:new va.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&Yl.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(0===this.count)e.call(t);else{const n=()=>{0===this.count&&(this.signals.countChanged.remove(n,this),e.call(t))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}ac.add("shader/BasicLine.vert","void main(){\n#include begin_vertex\n#include project_vertex\n}"),ac.add("shader/BasicLine.frag","uniform vec3 uColor;\n#include common\n#include fog_pars_fragment\nvoid main(){\ngl_FragColor = vec4( uColor, 1.0 );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n}"),ac.add("shader/Quad.vert","varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),ac.add("shader/Quad.frag","varying vec2 vUv;\nuniform sampler2D tForeground;\nuniform float scale;\nvoid main() {\nvec4 foreground = texture2D( tForeground, vUv );\ngl_FragColor = foreground * scale;\n}");class Dc{constructor(){this.signals={updated:new va.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e}}ac.add("shader/chunk/fog_fragment.glsl","#ifdef USE_FOG\nfloat depth = length( vViewPosition );\n#ifdef FOG_EXP2\nfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif"),ac.add("shader/chunk/interior_fragment.glsl","if( gl_FrontFacing == false ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}"),ac.add("shader/chunk/matrix_scale.glsl","float matrixScale( in mat4 m ){\nvec4 r = m[ 0 ];\nreturn sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );\n}"),ac.add("shader/chunk/nearclip_vertex.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear - 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),ac.add("shader/chunk/nearclip_fragment.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear )\ndiscard;\n#endif"),ac.add("shader/chunk/opaque_back_fragment.glsl","#ifdef OPAQUE_BACK\n#ifdef FLIP_SIDED\nif( gl_FrontFacing == true ){\ngl_FragColor.a = 1.0;\n}\n#else\nif( gl_FrontFacing == false ){\ngl_FragColor.a = 1.0;\n}\n#endif\n#endif"),ac.add("shader/chunk/radiusclip_vertex.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),ac.add("shader/chunk/radiusclip_fragment.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius )\ndiscard;\n#endif"),ac.add("shader/chunk/unpack_color.glsl","vec3 unpackColor(float f) {\nvec3 color;\ncolor.r = floor(f / 256.0 / 256.0);\ncolor.g = floor((f - color.r * 256.0 * 256.0) / 256.0);\ncolor.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);\nreturn color / 255.0;\n}");const Lc=/^(?!\/\/)\s*#include\s+(\S+)/gim,Oc={};function Nc(e,t={}){let n=e+"|";for(const e in t)n+=e+":"+t[e];if(!Oc[n]){const i=function(e){if(void 0===e)return"";const t=[];for(const n in e){const i=e[n];i&&t.push(`#define ${n} ${i}`)}return t.join("\n")+"\n"}(t);let r=ac.get(`shader/${e}`);if(!r)throw new Error(`empty shader, '${e}'`);r=r.replace(Lc,(function(e,t){const n=`shader/chunk/${t}.glsl`,i=ac.get(n)||Oi[t];if(!i)throw new Error(`empty chunk, '${t}'`);return i})),Oc[n]=i+r}return Oc[n]}if("undefined"!=typeof WebGLRenderingContext){const e=WebGLRenderingContext.prototype,t=e.getShaderParameter;e.getShaderParameter=function(){return!Ql||t.apply(this,arguments)};const n=e.getShaderInfoLog;e.getShaderInfoLog=function(){return Ql?n.apply(this,arguments):""};const i=e.getProgramParameter;e.getProgramParameter=function(t,n){return!Ql&&n===e.LINK_STATUS||i.apply(this,arguments)};const r=e.getProgramInfoLog;e.getProgramInfoLog=function(){return Ql?r.apply(this,arguments):""}}const Fc=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];Fc.forEach((e=>{e.forEach((e=>{e[0]*=.0625,e[1]*=.0625}))}));class Bc{constructor(e,t,n,i){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=Aa(i.factor,2),this._antialias=Aa(i.antialias,!1),this._onProgress=i.onProgress,this._onFinish=i.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)}_renderTile(e){const t=this._viewer,n=this._width,i=this._height,r=this._factor,s=e%r*n,o=Math.floor(e/r)*i;if(t.camera.setViewOffset(n*r,i*r,s,o,n,i),t.render(),this._antialias){const e=Math.round((s+n)/2)-Math.round(s/2),r=Math.round((o+i)/2)-Math.round(o/2);this._ctx.drawImage(t.renderer.domElement,Math.round(s/2),Math.round(o/2),e,r)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(s),Math.floor(o),Math.ceil(n),Math.ceil(i));"function"==typeof this._onProgress&&this._onProgress(e+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,"function"==typeof this._onFinish&&this._onFinish(this._n+1,this._n,!1)}render(){for(let e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)}renderAsync(){let e=0;const t=this._n,n=()=>{e===t?this._finalize():this._renderTile(e),e+=1};for(let e=0;e<=t;++e)setTimeout(n,0)}}const Uc=2*Math.PI,zc=180/Math.PI;function Vc(e,t,n=1,i=0,r){const s=r?r.length:e.length/n;let o=0,a=0;if(r)for(let l=0;l<s;++l){const s=(e[r[l]*n+i]+t)%t/t*Uc-Math.PI;o+=Math.cos(s),a+=Math.sin(s)}else for(let r=i;r<s;r+=n){const n=(e[r]+t)%t/t*Uc-Math.PI;o+=Math.cos(n),a+=Math.sin(n)}return o/=s,a/=s,(Math.atan2(a,o)+Math.PI)/Uc*t}function Hc(e,t,n,i=0){const r=e.length,s=n||new Float32Array(r);for(let n=0;n<r;n+=3)s[i+n+0]=(e[n+0]+t[n+0])/2,s[i+n+1]=(e[n+1]+t[n+1])/2,s[i+n+2]=(e[n+2]+t[n+2])/2;return s}function $c(e,t){const n=e.length,i=new Float32Array(n);for(let r=0;r<n;r+=3)i[r+0]=t[r+0]-e[r+0],i[r+1]=t[r+1]-e[r+1],i[r+2]=t[r+2]-e[r+2];return i}function Gc(e,t,n){const i=n||new Float32Array(e);for(let n=0;n<e;++n)i[n]=t;return i}function jc(e,t,n,i,r){const s=r||new Float32Array(3*e);for(let r=0;r<e;++r){const e=3*r;s[e+0]=t,s[e+1]=n,s[e+2]=i}return s}function Wc(e){const t=new Float32Array(e);for(let n=0;n<e;++n)t[n]=n;return t}function qc(e,t,n=0,i){const r=i||new Float32Array(e*t);for(let i=0;i<e;++i){const e=n+i*t;for(let n=0;n<t;++n)r[e+n]=i}return r}function Xc(e,t){const n=e.length,i=new Float32Array(n*t);for(let r=0;r<n;++r){const n=r*t,s=e[r];for(let e=0;e<t;++e)i[n+e]=s}return i}function Yc(e,t,n,i,r){for(let s=0;s<r;++s)t[i+s]=e[n+s]}function Kc(e,t,n,i){Yc(e,e,t,n,i)}function Zc(e){let t=-1/0;for(let n=0,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}function Qc(e){let t=1/0;for(let n=0,i=e.length;n<i;++n)e[n]<t&&(t=e[n]);return t}function Jc(e,t=1,n=0){const i=e.length;let r=0;for(let s=n;s<i;s+=t)r+=e[s];return r}function eu(e,t=1,n=0){return Jc(e,t,n)/(e.length/t)}const tu={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0},nu=new ut,iu=new zt,ru=new zt,su=new Ne,ou=new zt,au=new zt;function lu(e,t){ou.copy(t.projectionMatrix).invert(),au.copy(t.projectionMatrix).transpose(),e.traverse((function(e){const t=e.material;if(!t)return;const n=t.uniforms;n&&(n.projectionMatrixInverse&&n.projectionMatrixInverse.value.copy(ou),n.projectionMatrixTranspose&&n.projectionMatrixTranspose.value.copy(au))}))}function cu(e,t,n){const i=e.createShader(n);if(i)return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.log(`error compiling shader ${i}: ${e.getShaderInfoLog(i)}`),e.deleteShader(i),null);console.log(`error creating WebGL shader ${n}`)}function uu(e,t){const n=e.getExtension(t);return n||console.log(`extension '${t}' not available`),n}const hu=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function du(e){const t=document.createElement("canvas");t.width=16,t.height=16,t.style.width="16px",t.style.height="16px";const n=t.getContext("webgl")||t.getContext("experimental-webgl");if(!n)return console.log(`error creating webgl context for ${e}`),!1;if(!(n instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;uu(n,"OES_texture_float"),uu(n,"OES_texture_half_float"),uu(n,"WEBGL_color_buffer_float");const i=cu(n,"\nattribute vec4 a_position;\n\nvoid main() {\n  gl_Position = a_position;\n}",n.VERTEX_SHADER),r=cu(n,"\nprecision mediump float;\nuniform vec4 u_color;\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;\n}",n.FRAGMENT_SHADER);if(!i||!r)return!1;const s=function(e,t){const n=e.createProgram();return n?(t.forEach((t=>e.attachShader(n,t))),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)?n:(console.log(`error linking program: ${e.getProgramInfoLog(n)}`),e.deleteProgram(n),null)):void console.log("error creating WebGL program")}(n,[i,r]);if(!s)return console.log("error creating WebGL program"),!1;n.useProgram(s);const o=n.getAttribLocation(s,"a_position"),a=n.getUniformLocation(s,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,hu,n.STATIC_DRAW),n.enableVertexAttribArray(o),n.vertexAttribPointer(o,2,n.FLOAT,!1,0,0);const c=n.createTexture(),u=new Uint8Array([255,255,255,255]);n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,u);const h=n.createTexture();n.bindTexture(n.TEXTURE_2D,h),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,e,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);const d=n.createFramebuffer();if(n.bindFramebuffer(n.FRAMEBUFFER,d),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,h,0),n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE)return console.log(`error creating framebuffer for ${e}`),!1;n.bindTexture(n.TEXTURE_2D,c),n.uniform4fv(a,[0,10,20,1]),n.drawArrays(n.TRIANGLES,0,6),n.bindTexture(n.TEXTURE_2D,h),n.bindFramebuffer(n.FRAMEBUFFER,null),n.clearColor(1,0,0,1),n.clear(n.COLOR_BUFFER_BIT),n.uniform4fv(a,[0,.1,.05,1]),n.drawArrays(n.TRIANGLES,0,6);const p=new Uint8Array(4);if(n.readPixels(0,0,1,1,n.RGBA,n.UNSIGNED_BYTE,p),0!==p[0]||p[1]<248||p[2]<248||p[3]<254)return console.log(`not able to actually render to ${e} texture`),!1;if(e===n.FLOAT){n.bindFramebuffer(n.FRAMEBUFFER,d);const e=new Float32Array(4);n.readPixels(0,0,1,1,n.RGBA,n.FLOAT,e);const t=n.getError();if(t)return console.log(`error reading pixels as float: '${function(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}(n,t)}'`),!1}return!0}const pu=new Float32Array(100),fu=new Uint8Array(100),mu=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],gu=new zt;function _u(e,t,n,i,r){const s=r.uniforms,o=[];if(s&&(s.objectId&&(s.objectId.value=jl?this.id:this.id/255,o.push("objectId")),(s.modelViewMatrixInverse||s.modelViewMatrixInverseTranspose||s.modelViewProjectionMatrix||s.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld),s.modelViewMatrixInverse&&(s.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),o.push("modelViewMatrixInverse")),s.modelViewMatrixInverseTranspose&&(s.modelViewMatrixInverse?s.modelViewMatrixInverseTranspose.value.copy(s.modelViewMatrixInverse.value).transpose():s.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),o.push("modelViewMatrixInverseTranspose")),s.modelViewProjectionMatrix&&(s.modelViewProjectionMatrix.value.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),s.modelViewProjectionMatrixInverse&&(s.modelViewProjectionMatrix?(gu.copy(s.modelViewProjectionMatrix.value),s.modelViewProjectionMatrixInverse.value.copy(gu.invert())):(gu.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),s.modelViewProjectionMatrixInverse.value.copy(gu.invert())),o.push("modelViewProjectionMatrixInverse")),o.length)){const t=e.properties.get(r);if(t.program){const n=e.getContext(),i=t.program;n.useProgram(i.program);const r=i.getUniforms();o.forEach((function(e){r.setValue(n,e,s[e].value)}))}}}class vu{constructor(e){if(this.boundingBox=new pt,this.boundingBoxSize=new ut,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new ut,this.signals={ticked:new va.Signal,rendered:new va.Signal},"string"==typeof e){const t=document.getElementById(e);this.container=null===t?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const e=this.container.getBoundingClientRect();this.width=e.width||1,this.height=e.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),!1!==this._initRenderer()?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):Yl.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new Pn(0),fogNear:50,fogFar:100,backgroundColor:new Pn(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Pn(14540253),lightIntensity:1.2,ambientColor:new Pn(14540253),ambientIntensity:.3,sampleLevel:0,outputColorSpace:"srgb-linear"}}_initCamera(){const e=new ut(0,0,0),{width:t,height:n}=this;this.perspectiveCamera=new bi(this.parameters.cameraFov,t/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new ji(t/-2,t/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new la,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const i=this.parameters.cameraType;if("orthographic"===i)this.camera=this.orthographicCamera;else{if("perspective"!==i&&"stereo"!==i)throw new Error(`Unknown cameraType '${i}'`);this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new Dc}_initScene(){this.scene||(this.scene=new fo,this.scene.name="scene"),this.rotationGroup=new ro,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new ro,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new ro,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new ro,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new ro,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new ro,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new po(this.parameters.fogColor.getHex()),this.directionalLight=new ia(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.directionalLight),this.ambientLight=new ra(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const e=window.devicePixelRatio,{width:t,height:n}=this;try{this.renderer=new ho({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch(e){return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(e),this.renderer.setSize(t,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputColorSpace=this.parameters.outputColorSpace,this.renderer.useLegacyLights=!0;const i=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(Xl(!0),Wl(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(Xl(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),Wl(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&du(i.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&du(36193)),this.wrapper.appendChild(this.renderer.domElement);const r=t*e,s=n*e;Ql&&console.log(JSON.stringify({Browser:Hl,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":du(i.FLOAT),"testTextureSupport HalfFloat":du(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:jl},null,2)),this.pickingTarget=new ot(r,s,{minFilter:k,magFilter:k,stencilBuffer:!1,format:$,type:jl?z:F}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.colorSpace=this.parameters.outputColorSpace,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new ot(r,s,{minFilter:L,magFilter:L,format:$,type:this.supportsHalfFloat?V:jl?z:F}),this.sampleTarget.texture.colorSpace=this.parameters.outputColorSpace,this.holdTarget=new ot(r,s,{minFilter:k,magFilter:k,format:$,type:this.supportsHalfFloat?V:jl?z:F}),this.holdTarget.texture.colorSpace=this.parameters.outputColorSpace,this.compositeUniforms={tForeground:new ga(this.sampleTarget.texture),scale:new ga(1)},this.compositeMaterial=new vi({uniforms:this.compositeUniforms,vertexShader:Nc("Quad.vert"),fragmentShader:Nc("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.compositeCamera=new ji(-1,1,1,-1,0,1),this.compositeScene=new fo,this.compositeScene.name="compositeScene",this.compositeScene.add(new hi(new Li(2,2),this.compositeMaterial))}_initHelper(){const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),n=new qn;n.setIndex(new Nn(e,1)),n.setAttribute("position",new Nn(t,3));const i=new vi({uniforms:{uColor:{value:new Pn("skyblue")}},vertexShader:Nc("BasicLine.vert"),fragmentShader:Nc("BasicLine.frag")});this.boundingBoxMesh=new Mo(n,i),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,{min:n,max:i}=this.boundingBox;t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=n.x,t[4]=i.y,t[5]=i.z,t[6]=n.x,t[7]=n.y,t[8]=i.z,t[9]=i.x,t[10]=n.y,t[11]=i.z,t[12]=i.x,t[13]=i.y,t[14]=n.z,t[15]=n.x,t[16]=i.y,t[17]=n.z,t[18]=n.x,t[19]=n.y,t[20]=n.z,t[21]=i.x,t[22]=n.y,t[23]=n.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(e){this.camera.position.z=-e}add(e,t){t?t.forEach((t=>this.addBuffer(e,t))):this.addBuffer(e),e.group.name="meshGroup",e.wireframeGroup.name="wireframeGroup",e.parameters.background?(this.backgroundGroup.add(e.group),this.backgroundGroup.add(e.wireframeGroup)):(this.modelGroup.add(e.group),this.modelGroup.add(e.wireframeGroup)),e.pickable&&this.pickingGroup.add(e.pickingGroup),Ql&&this.updateHelper()}addBuffer(e,t){function n(i){i instanceof ro?i.children.forEach(n):(i.userData.buffer=e,i.userData.instance=t,i.onBeforeRender=_u)}const i=e.getMesh();t&&i.applyMatrix4(t.matrix),n(i),e.group.add(i);const r=e.getWireframeMesh();if(t&&(r.matrix.copy(i.matrix),r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale)),n(r),e.wireframeGroup.add(r),e.pickable){const r=e.getPickingMesh();t&&(r.matrix.copy(i.matrix),r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale)),n(r),e.pickingGroup.add(r)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)}remove(e){this.translationGroup.children.forEach((function(t){t.remove(e.group),t.remove(e.wireframeGroup)})),e.pickable&&this.pickingGroup.remove(e.pickingGroup),this.updateBoundingBox(),Ql&&this.updateHelper()}_updateBoundingBox(e,t,n){const i=this.boundingBox;function r(e,t,n){null==e.boundingBox&&e.computeBoundingBox();const r=e.boundingBox.clone();t&&r.applyMatrix4(t),n&&r.applyMatrix4(n),r.min.equals(r.max)&&r.expandByScalar(5),i.union(r)}function s(e){if(void 0!==e.geometry){let t,n;e.userData.buffer&&(t=e.userData.buffer.matrix),e.userData.instance&&(n=e.userData.instance.matrix),r(e.geometry,t,n)}}e?r(e,t,n):(i.makeEmpty(),this.modelGroup.traverse(s),this.backgroundGroup.traverse(s)),i.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),Ql&&this.updateHelper()}getPickingPixels(){const{width:e,height:t}=this,n=e*t*4,i=jl?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,i),i}getImage(e){return new Promise((t=>{if(e){const{width:e,height:n}=this,i=e*n*4;let r=this.getPickingPixels();if(jl){const e=new Uint8Array(i);for(let t=0;t<i;++t)e[t]=Math.round(255*r[t]);r=e}const s=document.createElement("canvas");s.width=e,s.height=n;const o=s.getContext("2d"),a=o.getImageData(0,0,e,n);a.data.set(r),o.putImageData(a,0,0),s.toBlob(t,"image/png")}else this.renderer.domElement.toBlob(t,"image/png")}))}makeImage(e={}){return function(e,t={}){const{trim:n,factor:i,antialias:r,transparent:s}=Ma(t,tu),o=e.renderer,a=e.camera,l=o.getClearAlpha(),c=o.getClearColor(new Pn);function u(t=!1){let n=i;r&&(n*=2),t&&(n=1/n),e.scene.traverse((function(e){const t=e.material;t&&t.linewidth&&(t.linewidth*=n),t&&t.uniforms&&t.uniforms.size&&void 0===t.uniforms.size.__seen&&(t.uniforms.size.value*=n,t.uniforms.size.__seen=!0),t&&t.uniforms&&t.uniforms.linewidth&&void 0===t.uniforms.linewidth.__seen&&(t.uniforms.linewidth.value*=n,t.uniforms.linewidth.__seen=!0)})),e.scene.traverse((function(e){const t=e.material;t&&t.uniforms&&t.uniforms.size&&delete t.uniforms.size.__seen,t&&t.uniforms&&t.uniforms.linewidth&&delete t.uniforms.linewidth.__seen}))}function h(e){if(n){const t=c;return function(e,t,n,i,r){const s=e.height,o=e.width,a=e.getContext("2d").getImageData(0,0,o,s).data;let l,c,u,h;for(u=!1,c=0;c<s;c++){for(l=0;l<o;l++)if(h=4*(c*o+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const d=c;for(u=!1,l=0;l<o;l++){for(c=0;c<s;c++)if(h=4*(c*o+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const p=l;for(u=!1,c=s-1;c>=0;c--){for(l=o-1;l>=0;l--)if(h=4*(c*o+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const f=c;for(u=!1,l=o-1;l>=0;l--){for(c=s-1;c>=0;c--)if(h=4*(c*o+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const m=l,g=document.createElement("canvas");return g.width=m-p,g.height=f-d,g.getContext("2d").drawImage(e,p,d,g.width,g.height,0,0,g.width,g.height),g}(e,s?0:255*t.r,s?0:255*t.g,s?0:255*t.b,s?0:255)}return e}function d(e,n,i){"function"==typeof t.onProgress&&t.onProgress(e,n,i)}return new Promise((function(t,n){const c=new Bc(o,a,e,{factor:i,antialias:r,onProgress:d,onFinish:function(i,r){h(c.canvas).toBlob((function(i){o.setClearAlpha(l),u(!0),e.requestRender(),d(r,r,!0),i?t(i):n("error creating image")}),"image/png")}});o.setClearAlpha(s?0:1),u(),c.renderAsync()}))}(this,e)}setLight(e,t,n,i){const r=this.parameters;void 0!==e&&r.lightColor.set(e),void 0!==t&&(r.lightIntensity=t),void 0!==n&&r.ambientColor.set(n),void 0!==i&&(r.ambientIntensity=i),this.requestRender()}setFog(e,t,n){const i=this.parameters;void 0!==e&&i.fogColor.set(e),void 0!==t&&(i.fogNear=t),void 0!==n&&(i.fogFar=n),this.requestRender()}setBackground(e){const t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()}setSampling(e){void 0!==e&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()}setOutputEncoding(e){this.parameters.outputColorSpace=e,this.renderer.outputColorSpace=e,this.pickingTarget.texture.colorSpace=e,this.sampleTarget.texture.colorSpace=e,this.holdTarget.texture.colorSpace=e}setColorWorkflow(e){if("srgb-linear"!=e&&"srgb"!=e)throw new Error(`setColorWorkflow: invalid color workflow ${e}`);tl="srgb-linear"==e?"linear":"sRGB",this.setOutputEncoding("srgb-linear"==e?"srgb":"srgb-linear"),this.requestRender()}setCamera(e,t,n){const i=this.parameters;if(e&&(i.cameraType=e),t&&(i.cameraFov=t),n&&(i.cameraEyeSep=n),"orthographic"===i.cameraType)this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if("perspective"!==i.cameraType&&"stereo"!==i.cameraType)throw new Error(`Unknown cameraType '${i.cameraType}'`);this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=i.cameraFov,this.stereoCamera.eyeSep=i.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(e,t,n,i,r){const s=this.parameters;void 0!==e&&(s.clipNear=e),void 0!==t&&(s.clipFar=t),void 0!==n&&(s.clipDist=n),void 0!==i&&(s.clipMode=i),void 0!==r&&(s.clipScale=r),this.requestRender()}setSize(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(e,t);const i=this.width*n,r=this.height*n;this.pickingTarget.setSize(i,r),this.sampleTarget.setSize(i,r),this.holdTarget.setSize(i,r),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}}updateInfo(e){const{memory:t,render:n}=this.info;if(e)t.programs=0,t.geometries=0,t.textures=0,n.calls=0,n.vertices=0,n.points=0;else{const e=this.renderer.info,i=e.memory,r=e.render;t.geometries=i.geometries,t.textures=i.textures,n.calls+=r.calls,n.faces+=r.triangles,n.points+=r.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&-1!==this.sampleLevel){const e=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=e,Ql&&Yl.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(e,t){if("stereo"===this.parameters.cameraType)return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);let n,i,r=0;const s=jl?pu:fu;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,s);for(let e=0;e<mu.length;e++){const t=4*mu[e],o=Math.round(s[t+3]),a=this.pickingGroup.getObjectById(o);a&&(n=a.userData.instance,i=a.userData.buffer.picking,r=jl?Math.round(255*s[t])<<16&16711680|Math.round(255*s[t+1])<<8&65280|255&Math.round(255*s[t+2]):s[t]<<16|s[t+1]<<8|s[t+2])}return{pid:r,instance:n,picker:i}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame((()=>{this.render(),this.stats.update()})))}updateZoom(){const e=qa(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t}absoluteToRelative(e){return 50*(1-e/this.bRadius)}relativeToAbsolute(e){return this.bRadius*(1-e/50)}__updateClipping(){const e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));const t=this.scene.fog;if(t.color.set(e.fogColor),"camera"===e.clipMode)this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if("absolute"===e.clipScale)this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{const n=(50-e.clipNear)/50,i=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*i;const r=(50-e.fogNear)/50,s=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*r,t.far=this.cDist+this.bRadius*s}"camera"!==e.clipMode&&("PerspectiveCamera"===this.camera.type?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):"OrthographicCamera"===this.camera.type&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))}__updateCamera(){const e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),function(e,t,n,i,r){let s=new Ne;n.getSize(s);const o=s.height,a=n.getPixelRatio(),l="OrthographicCamera"===t.type;su.set(s.width,s.height),ou.copy(t.projectionMatrix).invert(),au.copy(t.projectionMatrix).transpose(),e.traverse((function(e){const t=e.material;if(!t)return;const n=t.uniforms;if(n){if(t.clipNear){const e=(50-t.clipNear)/50,s=i-r*e;n.clipNear.value=s}n.canvasHeight&&(n.canvasHeight.value=o),n.resolution&&n.resolution.value.copy(su),n.pixelRatio&&(n.pixelRatio.value=a),n.projectionMatrixInverse&&n.projectionMatrixInverse.value.copy(ou),n.projectionMatrixTranspose&&n.projectionMatrixTranspose.value.copy(au),n.ortho&&(n.ortho.value=l)}}))}(this.scene,e,this.renderer,this.cDist,this.bRadius),function(e,t){e.traverseVisible((function(e){if(!(e instanceof ko&&e.userData.buffer.parameters.sortParticles))return;const n=e.geometry.attributes,i=n.position.count;if(0===i)return;let r,s,o,a,l,c,u,h;iu.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),ru.multiplyMatrices(t.projectionMatrix,iu),e.userData.sortData?(r=e.userData.sortData,o=r.__zArray,s=r.__sortArray,a=r.__cmpFn):(o=new Float32Array(i),s=new Uint32Array(i),a=function(e,t){const n=o[e],i=o[t];return n>i?1:n<i?-1:0},r={__zArray:o,__sortArray:s,__cmpFn:a},e.userData.sortData=r);for(let e=0;e<i;++e)nu.fromArray(n.position.array,3*e),nu.applyMatrix4(ru),o[e]=-nu.z,s[e]=e;!function(e,t,n=0,i){t=t||function(e,t){return e>t?1:e<t?-1:0};const r=[];let s,o,a,l=-1,c=n,u=i=(i||e.length)-1;function h(t,n){const i=e[t];e[t]=e[n],e[n]=i}for(;;)if(u-c<=25){for(let n=c+1;n<=u;++n){for(s=e[n],o=n-1;o>=c&&t(e[o],s)>0;)e[o+1]=e[o],--o;e[o+1]=s}if(-1===l)break;u=r[l--],c=r[l--]}else{for(o=c+1,a=u,h(c+u>>1,o),t(e[c],e[u])>0&&h(c,u),t(e[o],e[u])>0&&h(o,u),t(e[c],e[o])>0&&h(c,o),s=e[o];;){do{o++}while(t(e[o],s)<0);do{a--}while(t(e[a],s)>0);if(a<o)break;h(o,a)}e[c+1]=e[a],e[a]=s,u-o+1>=a-c?(r[++l]=o,r[++l]=u,u=a-1):(r[++l]=c,r[++l]=a-1,c=o)}}(s,a);for(let e in n){const t=n[e],o=t.array,a=t.itemSize;r[e]||(r[e]=new Float32Array(a*i)),h=r[e],r[e]=o;for(let e=0;e<i;++e){l=s[e];for(let t=0;t<a;++t)c=l*a+t,u=e*a+t,h[u]=o[c]}n[e].array=h,n[e].needsUpdate=!0}}))}(this.scene,e)}__setVisibility(e,t,n,i){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=n,this.helperGroup.visible=i}__updateLights(){this.directionalLight.color.set(this.parameters.lightColor),this.directionalLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.directionalLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(e,t){this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,e),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,Ql),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(e,t){const n=Fc[Math.max(0,Math.min(this.sampleLevel,5))],i=1/n.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let r=this.sampleTarget.width;const s=this.sampleTarget.height;"stereo"===this.parameters.cameraType&&(r/=2);for(let t=0;t<n.length;++t){const o=n[t];e.setViewOffset(r,s,o[0],o[1],r,s),e.updateProjectionMatrix(),lu(this.scene,e);let a=i;a+=.03125*((t+.5)/n.length-.5),this.compositeUniforms.scale.value=a,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),0===t&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(e=!1,t){const n=this.stereoCamera;n.update(this.perspectiveCamera);const i=this.renderer;let r=new Ne;i.getSize(r),i.setScissorTest(!0),i.setScissor(0,0,r.width/2,r.height),i.setViewport(0,0,r.width/2,r.height),lu(this.scene,n.cameraL),this.__render(e,n.cameraL),i.setScissor(r.width/2,0,r.width/2,r.height),i.setViewport(r.width/2,0,r.width/2,r.height),lu(this.scene,n.cameraR),this.__render(e,n.cameraR),i.setScissorTest(!1),i.setViewport(0,0,r.width,r.height)}__render(e=!1,t,n){e?this.lastRenderedPicking||this.__renderPickingGroup(t):this.sampleLevel>0&&"stereo"!==this.parameters.cameraType?this.__renderSuperSample(t,n):this.__renderModelGroup(t,n)}render(e=!1,t){if(this.rendering)Yl.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),"stereo"===this.parameters.cameraType?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){Yl.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}const yu=1,bu=2,xu=3;function wu(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;return Math.sqrt(t*t+n*n)}class Su{constructor(e,t={}){this.domElement=e,this.signals={moved:new va.Signal,scrolled:new va.Signal,dragged:new va.Signal,dropped:new va.Signal,clicked:new va.Signal,hovered:new va.Signal,doubleClicked:new va.Signal},this.position=new Ne,this.prevPosition=new Ne,this.down=new Ne,this.canvasPosition=new Ne,this.prevClickCP=new Ne,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=Aa(t.hoverTimeout,50),this.handleScroll=Aa(t.handleScroll,!0),this.doubleClickSpeed=Aa(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)}get key(){let e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e}setParameters(e={}){this.hoverTimeout=Aa(e.hoverTimeout,this.hoverTimeout)}_listen(){const e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,-1!==this.hoverTimeout&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(e){if(e.target!==this.domElement||!this.handleScroll)return;e.preventDefault(),this._setKeys(e);let t=0;"deltaY"in e&&"deltaMode"in e&&void 0!==e.deltaY&&void 0!==e.deltaMode?t=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?t=.025*-e.deltaY:void 0!==e.wheelDelta?t=.025*-e.wheelDelta:void 0!==e.wheelDeltaY?t=.025*-e.wheelDeltaY:void 0!==e.detail&&(t=-e.detail/3),this.signals.scrolled.dispatch(t),setTimeout((()=>{this.scrolled=!0}),this.hoverTimeout)}_onMousemove(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n)}_onMousedown(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=function(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){const t=e.which;if(2===t)return 4;if(3===t)return 2;if(t>0)return 1<<t-1}else if("button"in e){const t=e.button;if(1===t)return 4;if(2===t)return 2;if(t>=0)return 1<<t}}return 0}(e),this.pressed=!0,this._setCanvasPosition(e))}_onMouseup(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);const t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(e){e.target===this.domElement&&e.preventDefault()}_onTouchstart(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=wu(e)}}_onTouchend(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:{this._setKeys(e),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n);break}case 2:{const t=wu(e),n=t-this.lastTouchDistance;if(this.lastTouchDistance=t,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(n)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(n/2);else{this.which=3,this.buttons=2;const e=this.prevPosition.x-this.position.x,t=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(e,t),this.pressed&&this.signals.dragged.dispatch(e,t)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(e){const t=this.domElement.getBoundingClientRect();let n,i;"clientX"in e&&"clientY"in e?(n=e.clientX-t.left,i=e.clientY-t.top):(n=e.offsetX,i=e.offsetY),this.canvasPosition.set(n,t.height-i)}_setKeys(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const Au=new zt,Mu=new zt,Cu=new zt,Tu=new zt,Eu=new zt,Pu=new ut,Iu=new ct,ku=new ct,Ru=new zt,Du=new ut,Lu=new ut;class Ou{constructor(e,t={}){this.stage=e,this.rotateSpeed=Aa(t.rotateSpeed,2),this.zoomSpeed=Aa(t.zoomSpeed,1.2),this.panSpeed=Aa(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(e,t,n=0){const i=this.controls.getCanvasScaleFactor(n);Du.set(e,t,0),Du.multiplyScalar(this.panSpeed*i)}_getRotateXY(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]}_getCameraRotation(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(Mu.makeRotationY(Math.PI)),e}_transformPanVector(){this.component&&(Ru.extractRotation(this.component.transform),Ru.premultiply(this.viewer.rotationGroup.matrix),Ru.invert(),Ru.multiply(this._getCameraRotation(Tu)),Du.applyMatrix4(Ru))}zoom(e){this.controls.zoom(this.zoomSpeed*e*.02)}pan(e,t){this._setPanVector(e,t),Ru.copy(this.viewer.rotationGroup.matrix).invert(),Ru.multiply(this._getCameraRotation(Tu)),Du.applyMatrix4(Ru),this.controls.translate(Du)}panComponent(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(Du),this.component.updateMatrix())}panAtom(e,t){this.atom&&this.component&&(this.atom.positionToVector3(Lu),Lu.add(this.viewer.translationGroup.position),Lu.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,Lu.z),this._transformPanVector(),this.atom.positionAdd(Du),this.component.updateRepresentations({position:!0}))}rotate(e,t){const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(Tu),Pu.set(1,0,0),Pu.applyMatrix4(Tu),Iu.setFromAxisAngle(Pu,i),Pu.set(0,1,0),Pu.applyMatrix4(Tu),ku.setFromAxisAngle(Pu,n),Iu.multiply(ku),Tu.makeRotationFromQuaternion(Iu),this.controls.applyMatrix(Tu)}zRotate(e,t){const n=this.rotateSpeed*((-e+t)/-2)*.01;Cu.makeRotationZ(n),this.controls.applyMatrix(Cu)}rotateComponent(e,t){if(!this.component)return;const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(Eu),Tu.extractRotation(this.component.transform),Tu.premultiply(this.viewer.rotationGroup.matrix),Tu.invert(),Tu.premultiply(Eu),Pu.set(1,0,0),Pu.applyMatrix4(Tu),Au.makeRotationAxis(Pu,i),Pu.set(0,1,0),Pu.applyMatrix4(Tu),Mu.makeRotationAxis(Pu,n),Au.multiply(Mu),Iu.setFromRotationMatrix(Au),this.component.quaternion.premultiply(Iu),this.component.quaternion.normalize(),this.component.updateMatrix()}}const Nu=new ut;class Fu{constructor(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if("bond"!==this.type||!this.bond)return;const e=this.bond,t=this.controls,n=this.canvasPosition,i=e.atom1.positionToVector3(),r=e.atom2.positionToVector3();return i.applyMatrix4(this.component.matrix),r.applyMatrix4(this.component.matrix),o=t.getPositionOnCanvas(i),a=t.getPositionOnCanvas(r),(s=n).distanceTo(o)<s.distanceTo(a)?e.atom1:e.atom2;var s,o,a}get closeAtom(){const e=this.canvasPosition,t=this.closestBondAtom;if(!t)return;const n=t.positionToVector3().applyMatrix4(this.component.matrix),i=this.controls.getPositionOnCanvas(n);t.positionToVector3(Nu),this.instance&&Nu.applyMatrix4(this.instance.matrix),Nu.applyMatrix4(this.component.matrix);const r=this.controls.viewer;Nu.add(r.translationGroup.position),Nu.applyMatrix4(r.rotationGroup.matrix);const s=this.controls.getCanvasScaleFactor(Nu.z),o=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(i)<=o/s?t:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(e){return this.type===e?this.object:void 0}getLabel(){const e=this.atom||this.closeAtom;let t="nothing";return this.arrow?t=this.arrow.name:e?t=`atom: ${e.qualifiedName()} (${e.structure.name})`:this.axes?t="axes":this.bond?t=`bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`:this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t=`clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`:this.contact?t=`${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`:this.cylinder?t=this.cylinder.name:this.distance?t=`distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`:this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t=`mesh: ${this.mesh.name||this.mesh.serial} (${this.mesh.shape.name})`:this.slice?t=`slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`:this.sphere?t=this.sphere.name:this.surface?t=`surface: ${this.surface.surface.name}`:this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t=`unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`:this.unknown?t="unknown":this.volume?t=`volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`:this.wideline&&(t=this.wideline.name),t}}class Bu{constructor(e){this.stage=e,this.viewer=e.viewer}pick(e,t){const n=this.viewer.pick(e,t);if(n.picker&&"ignore"!==n.picker.type&&void 0!==n.pid){const e=n.picker.array;if(!(e&&n.pid>=e.length))return new Fu(n,this.stage);console.error("pid >= picker.array.length")}}}const Uu=new ct,zu=new ut,Vu=new ut,Hu=new ut,$u=new ut,Gu=new zt,ju=new ut,Wu=new zt;class qu{constructor(e){this.stage=e,this.signals={changed:new va.Signal},this.viewer=e.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(e,t){const n=za(t,Ne),i=this.viewer;return Hu.copy(e).add(i.translationGroup.position).applyMatrix4(i.rotationGroup.matrix).project(i.camera),n.set((Hu.x+1)*i.width/2,(Hu.y+1)*i.height/2)}getCanvasScaleFactor(e=0){const t=this.viewer.camera;if(t instanceof ji)return 1/t.zoom;{e=Math.abs(e),e+=this.getCameraDistance();const n=qa(t.fov);return 2*e*Math.tan(n/2)/this.viewer.height}}getOrientation(e){const t=Ha(e);t.copy(this.viewer.rotationGroup.matrix);const n=this.getCameraDistance();return t.scale($u.set(n,n,n)),t.setPosition(this.viewer.translationGroup.position),t}orient(e){Ha(e).decompose(zu,Uu,Vu);const t=this.viewer;t.rotationGroup.setRotationFromQuaternion(Uu),t.translationGroup.position.copy(zu),t.cameraDistance=Vu.z,t.updateZoom(),this.changed()}translate(e){this.viewer.translationGroup.position.add(Va(e)),this.changed()}center(e){this.viewer.translationGroup.position.copy(Va(e)).negate(),this.changed()}zoom(e){this.distance(this.getCameraDistance()*(1-e))}getCameraDistance(){return this.viewer.cameraDistance}distance(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()}spin(e,t){Gu.copy(this.viewer.rotationGroup.matrix).invert(),ju.copy(Va(e)).applyMatrix4(Gu),this.viewer.rotationGroup.rotateOnAxis(ju,t),this.changed()}rotate(e){this.viewer.rotationGroup.setRotationFromQuaternion($a(e)),this.changed()}align(e){Wu.copy(Ha(e)).invert(),this.viewer.rotationGroup.setRotationFromMatrix(Wu),this.changed()}applyMatrix(e){this.viewer.rotationGroup.applyMatrix4(Ha(e)),this.changed()}}class Xu{constructor(e,t,...n){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=Aa(e,1e3),this.controls=t,this.startTime=window.performance.now(),this._init(...n)}get done(){return 1===this.alpha}get paused(){return this._paused}tick(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,0===this.duration?this.alpha=1:this.alpha=el(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach((e=>e())),this.done}pause(e){e&&(this._hold=!0),-1===this.pausedTime&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(e){let t;return t=this.done?Promise.resolve():new Promise((e=>this._resolveList.push(e))),t.then(e)}}class Yu extends Xu{constructor(e,t,...n){super(Aa(e,1/0),t,...n)}_init(e,t){Array.isArray(e)?this.axis=(new ut).fromArray(e):this.axis=Aa(e,new ut(0,1,0)),this.angle=Aa(t,.01)}_tick(e){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*e.lastDuration/16)}}class Ku extends Xu{constructor(e,t,...n){super(Aa(e,1/0),t,...n),this.angleSum=0,this.direction=1}_init(e,t,n){Array.isArray(e)?this.axis=(new ut).fromArray(e):this.axis=Aa(e,new ut(0,1,0)),this.angleStep=Aa(t,.01),this.angleEnd=Aa(n,.2)}_tick(e){if(!this.axis||!this.angleStep||!this.angleEnd)return;const t=el(0,1,Math.abs(this.angleSum)/this.angleEnd),n=this.angleStep*this.direction*(1.1-t);this.controls.spin(this.axis,n*e.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class Zu extends Xu{_init(e,t){this.moveFrom=Va(Aa(e,new ut)),this.moveTo=Va(Aa(t,new ut))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class Qu extends Xu{_init(e,t){this.zoomFrom=e,this.zoomTo=t}_tick(){this.controls.distance(Qa(this.zoomFrom,this.zoomTo,this.alpha))}}class Ju extends Xu{constructor(){super(...arguments),this._currentRotation=new ct}_init(e,t){this.rotateFrom=$a(e),this.rotateTo=$a(t),this._currentRotation=new ct}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class eh extends Xu{_init(e,t,n){this.valueFrom=e,this.valueTo=t,this.callback=n}_tick(){this.callback(Qa(this.valueFrom,this.valueTo,this.alpha))}}class th extends Xu{_init(e){this.callback=e}_tick(){1===this.alpha&&this.callback()}}class nh{constructor(e=[]){this._resolveList=[],this._list=e}get done(){return this._list.every((e=>e.done))}then(e){let t;return t=this.done?Promise.resolve():new Promise((e=>{this._resolveList.push(e),this._list.forEach((e=>{e.then((()=>{this._resolveList.forEach((e=>{e()})),this._resolveList.length=0}))}))})),t.then(e)}}class ih{constructor(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls}get paused(){return this.animationList.every((e=>e.paused))}add(e){return 0===e.duration?e.tick(this.viewer.stats):this.animationList.push(e),e}remove(e){const t=this.animationList,n=t.indexOf(e);n>-1&&t.splice(n,1)}run(e){const t=this.finishedList,n=this.animationList,i=n.length;for(let r=0;r<i;++r){const i=n[r];i.tick(e)&&t.push(i)}const r=t.length;if(r){for(let e=0;e<r;++e)this.remove(t[e]);t.length=0}}spin(e,t,n){return this.add(new Yu(n,this.controls,e,t))}rock(e,t,n,i){return this.add(new Ku(i,this.controls,e,t,n))}rotate(e,t){const n=this.viewer.rotationGroup.quaternion.clone();return this.add(new Ju(t,this.controls,n,e))}move(e,t){const n=this.controls.position.clone().negate();return this.add(new Zu(t,this.controls,n,e))}zoom(e,t){const n=this.viewer.camera.position.z;return this.add(new Qu(t,this.controls,n,e))}zoomMove(e,t,n){return new nh([this.move(e,n),this.zoom(t,n)])}orient(e,t){const n=new ut,i=new ct,r=new ut;return Ha(e).decompose(n,i,r),new nh([this.move(n.negate(),t),this.rotate(i,t),this.zoom(-r.x,t)])}value(e,t,n,i){return this.add(new eh(i,this.controls,e,t,n))}timeout(e,t){return this.add(new th(t,this.controls,e))}spinComponent(e,t,n,i){return this.add(new Yu(i,e.controls,t,n))}rockComponent(e,t,n,i,r){return this.add(new Ku(r,e.controls,t,n,i))}moveComponent(e,t,n){const i=e.controls.position.clone().negate();return this.add(new Zu(n,e.controls,i,t))}pause(){this.animationList.forEach((e=>e.pause()))}resume(){this.animationList.forEach((e=>e.resume()))}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class rh{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let e=0,n=t.length;e<n;++e)this.queue.push(t[e]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();void 0!==e?(this.pending=!0,setTimeout((()=>this.run(e)))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class sh{constructor(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:ic.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:ic.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new Rc,this.queue=new rh(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=ic.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=Aa(t.clipNear,0),this.clipRadius=Aa(t.clipRadius,0),this.clipCenter=Aa(t.clipCenter,new ut),this.flatShaded=Aa(t.flatShaded,!1),this.side=Aa(t.side,"double"),this.opacity=Aa(t.opacity,1),this.depthWrite=Aa(t.depthWrite,!0),this.wireframe=Aa(t.wireframe,!1),this.setColor(t.color,t),this.colorData=Aa(t.colorData,void 0),this.colorScheme=Aa(t.colorScheme,"uniform"),this.colorScale=Aa(t.colorScale,""),this.colorReverse=Aa(t.colorReverse,!1),this.colorValue=Aa(t.colorValue,9474192),this.colorDomain=Aa(t.colorDomain,void 0),this.colorMode=Aa(t.colorMode,"hcl"),this.visible=Aa(t.visible,!0),this.quality=Aa(t.quality,void 0),this.roughness=Aa(t.roughness,.4),this.metalness=Aa(t.metalness,0),this.diffuse=Aa(t.diffuse,16777215),this.diffuseInterior=Aa(t.diffuseInterior,!1),this.useInteriorColor=Aa(t.useInteriorColor,!1),this.interiorColor=Aa(t.interiorColor,2236962),this.interiorDarkening=Aa(t.interiorDarkening,0),this.lazy=Aa(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=Aa(t.matrix,new zt),this.disablePicking=Aa(t.disablePicking,!1);const n=this.parameters;!0===n.sphereDetail&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),!0===n.radialSegments&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),!0===n.openEnded&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),!0===n.disableImpostor&&(n.disableImpostor={type:"boolean",rebuild:!0}),"low"===t.quality?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):"medium"===t.quality?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):"high"===t.quality?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=Aa(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=Aa(t.radialSegments,10))),n.openEnded&&(this.openEnded=Aa(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=Aa(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(e={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const n=Object.keys(ic.getSchemes());if("string"==typeof e&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(void 0!==e){let n=new Pn(e).getHex();t?(t.colorScheme="uniform",t.colorValue=n):this.setParameters({colorScheme:"uniform",colorValue:n})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(e,t){Ql&&Yl.time("Representation.make "+this.type);const n=()=>{e?(this.update(e),this.viewer.requestRender(),this.tasks.decrement(),t&&t()):(this.clear(),this.create(),this.manualAttach||this.disposed||(Ql&&Yl.time("Representation.attach "+this.type),this.attach((()=>{Ql&&Yl.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),t&&t()})))),Ql&&Yl.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(n):n()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const e=this.lazyProps,t=e.bufferParams,n=e.what;if(e.build)return e.build=!1,this.build(),this;(Object.keys(t).length||Object.keys(n).length)&&(e.bufferParams={},e.what={},this.updateParameters(t,n))}return this.bufferList.forEach((function(t){t.setVisibility(e)})),t||this.viewer.requestRender(),this}setParameters(e,t={},n=!1){const i=e||{},r=this.parameters,s={};this.opacity||void 0===i.opacity||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(s,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(i.color,i);for(let e in i)void 0!==i[e]&&null!=r[e]&&(r[e].int&&(i[e]=parseInt(i[e])),r[e].float&&(i[e]=parseFloat(i[e])),i[e]!==this[e]||i[e].equals&&!i[e].equals(this[e]))&&(this[e]&&this[e].copy&&i[e].copy?this[e].copy(i[e]):this[e]&&this[e].set?this[e].set(i[e]):this[e]=i[e],r[e].buffer&&(!0===r[e].buffer?s[e]=i[e]:s[r[e].buffer]=i[e]),r[e].update&&(t[r[e].update]=!0),!r[e].rebuild||"impostor"===r[e].rebuild&&ql&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(s,t),this}updateParameters(e={},t){if(this.lazy&&(!this.visible||!this.opacity)&&!1===e.hasOwnProperty("opacity"))return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach((function(t){t.setParameters(e)})),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach((t=>{null!==this.parameters[t]&&(e[t]=this[t])})),e}clear(){this.bufferList.forEach((e=>{this.viewer.remove(e),e.dispose()})),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class oh{constructor(e){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL(nc.get(e)),this.worker=new Worker(this.blobUrl),nc.activeWorkerCount+=1,this.worker.onmessage=t=>{this.pending-=1;const n=t.data.__postId;Ql&&Yl.timeEnd("Worker.postMessage "+e+" #"+n);const i=this.onmessageDict[n];i&&i.call(this.worker,t),delete this.onmessageDict[n],delete this.onerrorDict[n]},this.worker.onerror=t=>{if(this.pending-=1,t.data){const n=t.data.__postId,i=this.onerrorDict[n];i?i.call(this.worker,t):Yl.error("Worker.onerror",n,e,t),delete this.onmessageDict[n],delete this.onerrorDict[n]}else Yl.error("Worker.onerror",e,t)}}post(e={},t,n,i){this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=i,e.__name=this.name,e.__postId=this.postCount,e.__debug=Ql,Ql&&Yl.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(e,t)}catch(t){Yl.error("worker.post:",t),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),nc.activeWorkerCount-=1):Yl.log("no worker to terminate")}}class ah{constructor(e,t=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(e={},t,n,i){const r=this.getNextWorker();return r?r.post(e,t,n,i):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach((function(e){e.terminate()}))}getNextWorker(){let e,t=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){e=new oh(this.name),this.pool.push(e),this.count+=1;break}const i=this.pool[n];if(0===i.pending){e=i;break}i.pending<t&&(t=i.pending,e=i)}return e}}function lh(e){const t=e.length,n=t/3;let i=0,r=0,s=0;for(let n=0;n<t;n+=3)i+=e[n+0],r+=e[n+1],s+=e[n+2];return new ut(i/n,r/n,s/n)}function ch(e,t,n){return n?e.sub(n).projectOnVector(t).add(n):e.projectOnVector(t),e}function uh(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>s&&(s=c),u>o&&(o=u)}return[fh([t,n,i]),fh([r,s,o])]}function hh(e,t){for(let n=0,i=t.length;n<i;n+=3){const i=t[n],r=t[n+1],s=t[n+2];t[n]=e[0]*i+e[4]*r+e[8]*s+e[12],t[n+1]=e[1]*i+e[5]*r+e[9]*s+e[13],t[n+2]=e[2]*i+e[6]*r+e[10]*s+e[14]}}function dh(e,t){for(let n=0,i=t.length;n<i;n+=3){const i=t[n],r=t[n+1],s=t[n+2];t[n]=e[0]*i+e[3]*r+e[6]*s,t[n+1]=e[1]*i+e[4]*r+e[7]*s,t[n+2]=e[2]*i+e[5]*r+e[8]*s}}function ph(e){for(let t=0,n=e.length;t<n;t+=3){const n=e[t],i=e[t+1],r=e[t+2],s=n*n+i*i+r*r;if(s>0){const o=1/Math.sqrt(s);e[t]=n*o,e[t+1]=i*o,e[t+2]=r*o}}}function fh(e){return new Float32Array(e||3)}function mh(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2];e[0]=r*l-s*a,e[1]=s*o-i*l,e[2]=i*a-r*o}function gh(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _h(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function vh(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function yh(e,t,n=0){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}function bh(e,t,n=0){t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2]}function xh(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function wh(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function Sh(e,t,n){Ah(e,t,1/n)}function Ah(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function Mh(e,t){const n=xh(t);0==n?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):Ah(e,t,1/Math.sqrt(n))}function Ch(e,t,n){e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n}function Th(e,t,n){e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n}function Eh(e,t){e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2])}function Ph(e,t){e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2])}function Ih(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]}function kh(e,t){const n=e[0],i=e[1],r=e[2],s=t[0],o=t[1],a=t[2],l=i*a-r*o,c=r*s-n*a,u=n*o-i*s,h=Math.sqrt(l*l+c*c+u*u),d=n*s+i*o+r*a;return Math.atan2(h,d)}function Rh(e,t=9){const n=Math.floor(t/2),i=e.position1.length/3,r=n*i*3,s=1/t,o=$c(e.position1,e.position2),a=new Float32Array(r),l=new Float32Array(r),c=new ut;for(let t=0;t<i;++t){const i=3*t;c.set(o[i],o[i+1],o[i+2]);const r=e.position1[i],u=e.position1[i+1],h=e.position1[i+2];for(let e=0;e<n;++e){const t=n*i+3*e,o=s*(2*e+1),d=s*(2*e+2);a[t]=r+c.x*o,a[t+1]=u+c.y*o,a[t+2]=h+c.z*o,l[t]=r+c.x*d,l[t+1]=u+c.y*d,l[t+2]=h+c.z*d}}const u=Hc(a,l),h=function(e,t){const n=e.length/3,i=new Float32Array(n*t*3);for(let r=0;r<n;++r){const n=3*r,s=r*t*3,o=e[n+0],a=e[n+1],l=e[n+2];for(let e=0;e<t;++e){const t=s+3*e;i[t+0]=o,i[t+1]=a,i[t+2]=l}}return i}(e.color,n),d={position:u,position1:a,position2:l,color:h,color2:h};return e.radius&&(d.radius=Xc(e.radius,n)),e.picking&&e.picking.array&&(e.picking.array=Xc(e.picking.array,n),d.picking=e.picking),e.primitiveId&&(d.primitiveId=Xc(e.primitiveId,n)),d}function Dh(e,t=.1){const n=$c(e.position1,e.position2),i=[],r=[],s=[],o=e.radius?[]:void 0,a=e.picking?[]:void 0,l=e.primitiveId?[]:void 0,c=new ut,u=e.position1.length/3;let h=0;for(let d=0;d<u;++d){const u=3*d;c.set(n[u],n[u+1],n[u+2]);const p=c.length()/t,f=Math.floor(p/2),m=1/p,g=e.position1[u],_=e.position1[u+1],v=e.position1[u+2];for(let t=0;t<f;++t){const n=3*h+3*t,p=m*(2*t+1),f=m*(2*t+2);i[n]=g+c.x*p,i[n+1]=_+c.y*p,i[n+2]=v+c.z*p,r[n]=g+c.x*f,r[n+1]=_+c.y*f,r[n+2]=v+c.z*f,e.color&&(s[n]=e.color[u],s[n+1]=e.color[u+1],s[n+2]=e.color[u+2]),o&&(o[h+t]=e.radius[d]),a&&(e.picking.array?a[h+t]=e.picking.array[d]:a[h+t]=d),l&&(l[h+t]=e.primitiveId[d])}h+=f}const d=new Float32Array(i),p=new Float32Array(r),f=Hc(d,p),m=new Float32Array(s),g={position:f,position1:d,position2:p,color:m,color2:m};return o&&(g.radius=new Float32Array(o)),a&&e.picking&&(e.picking.array=new Float32Array(a),g.picking=e.picking),l&&(g.primitiveId=new Float32Array(l)),g}function Lh(e,t=.1){const n=$c(e.position1,e.position2),i=[],r=[],s=[],o=e.radius?[]:void 0,a=e.picking?[]:void 0,l=e.primitiveId?[]:void 0,c=new ut,u=e.position1.length/3;let h=t,d=!0,p=0,f=0,m=0;for(let g=0;g<u;++g){const u=3*g,_=e.position1[u],v=e.position1[u+1],y=e.position1[u+2];c.set(n[u],n[u+1],n[u+2]);const b=c.length();d&&(i[f]=_,i[f+1]=v,i[f+2]=y);let x=h;const w=1/b;for(;x<b;){const e=d?r:i;e[f]=_+c.x*x*w,e[f+1]=v+c.y*x*w,e[f+2]=y+c.z*x*w,d&&(p++,f=3*p),d=!d,h=t,x+=t}d&&(r[f]=e.position2[u],r[f+1]=e.position2[u+1],r[f+2]=e.position2[u+2],p++,f=3*p),h=x-b;for(let t=m;t<p;t++){if(e.color){const n=3*t;s[n]=e.color[u],s[n+1]=e.color[u+1],s[n+2]=e.color[u+2]}o&&(o[t]=e.radius[g]),a&&(e.picking.array?a[t]=e.picking.array[g]:a[t]=g),l&&(l[t]=e.primitiveId[g])}m=p}if(!d&&u>0){const t=3*p;r[t]=e.position2[3*u-3],r[t+1]=e.position2[3*u-2],r[t+1]=e.position2[3*u-1]}const g=new Float32Array(i),_=new Float32Array(r),v=Hc(g,_),y=new Float32Array(s),b={position:v,position1:g,position2:_,color:y,color2:y};return o&&(b.radius=new Float32Array(o)),a&&e.picking&&(e.picking.array=new Float32Array(a),b.picking=e.picking),l&&(b.primitiveId=new Float32Array(l)),b}ah.prototype.constructor=ah,uh.__deps=[fh],Sh.__deps=[Ah],Mh.__deps=[Ah,xh];const Oh=new ut;class Nh{static get Picker(){return hc.get(this.type)}static get Buffer(){return uc.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,n){const i=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":!function(e,t){void 0!==e.toArray?e=e.toArray():void 0!==e.x?e=[e.x,e.y,e.z]:void 0!==e.r&&(e=[e.r,e.g,e.b]),t.push.apply(t,e)}(n,i);break;default:i.push(n)}}static objectToShape(e,t){Object.keys(this.fields).forEach((n=>{this.valueToShape(e,n,t[n])})),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,n){const i=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return(new ut).fromArray(i,3*t);case"c":return(new Pn).fromArray(i,3*t);default:return i[t]}}static objectFromShape(e,t){let n=this.valueFromShape(e,t,"name");void 0===n&&(n=`${this.type}: ${t} (${e.name})`);const i={shape:e,name:n};return Object.keys(this.fields).forEach((n=>{i[n]=this.valueFromShape(e,t,n)})),i}static arrayFromShape(e,t){const n=e._primitiveData[this.getShapeKey(t)];return"s"===this.fields[t]?n:new Float32Array(n)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach((n=>{t[n]=this.arrayFromShape(e,n)})),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}Nh.type="",Nh.fields={};class Fh extends Nh{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Oh.fromArray(t.position))}}Fh.type="sphere",Fh.fields={position:"v3",color:"c",radius:"f"};class Bh extends Nh{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Oh.fromArray(t.position))}}Bh.type="box",Bh.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class Uh extends Bh{}Uh.type="octahedron";class zh extends Bh{}zh.type="tetrahedron";class Vh extends Nh{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Oh.fromArray(t.position1)),e.expandByPoint(Oh.fromArray(t.position2))}static bufferFromShape(e,t={}){let n=this.dataFromShape(e);return"cylinder"===this.type&&t.dashedCylinder&&(n=Dh(n)),new this.Buffer(n,t)}}Vh.type="cylinder",Vh.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class Hh extends Vh{}Hh.type="arrow";class $h extends Vh{}$h.type="cone";class Gh extends Fh{}Gh.type="ellipsoid",Gh.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class jh extends Gh{}jh.type="torus";class Wh extends Nh{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Oh.fromArray(t.position))}}Wh.type="text",Wh.fields={position:"v3",color:"c",size:"f",text:"s"};class qh extends Nh{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Oh.fromArray(t.position))}}qh.type="point",qh.fields={position:"v3",color:"c"};class Xh extends Nh{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Oh.fromArray(t.position1)),e.expandByPoint(Oh.fromArray(t.position2))}}Xh.type="wideline",Xh.fields={position1:"v3",position2:"v3",color:"c"};class Yh{constructor(e,t){this.exp=3;const n=t||function(e){const{x:t,y:n,z:i}=e,r=new pt,s=t.length,{min:o,max:a}=r;for(let e=0;e<s;e++)o.x=Math.min(t[e],o.x),o.y=Math.min(n[e],o.y),o.z=Math.min(i[e],o.z),a.x=Math.max(t[e],a.x),a.y=Math.max(n[e],a.y),a.z=Math.max(i[e],a.z);return r}(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const i=this.boundX*this.boundY*this.boundZ,r=void 0!==e.count?e.count:e.x.length,s=e.x,o=e.y,a=e.z;let l=0;const c=new Uint32Array(i),u=new Int32Array(r);for(let e=0;e<r;++e){const t=s[e]-this.minX>>this.exp,n=o[e]-this.minY>>this.exp,i=a[e]-this.minZ>>this.exp,r=(t*this.boundY+n)*this.boundZ+i;1===(c[r]+=1)&&(l+=1),u[e]=r}const h=new Uint16Array(l);for(let e=0,t=0;e<i;++e){const n=c[e];n>0&&(c[e]=t+1,h[t]=n,t+=1)}const d=new Uint32Array(l);for(let e=1;e<l;++e)d[e]+=d[e-1]+h[e-1];const p=new Uint16Array(l),f=new Int32Array(r);for(let e=0;e<r;++e){const t=c[u[e]];if(t>0){const n=t-1;f[d[n]+p[n]]=e,p[n]+=1}}this.grid=c,this.bucketCount=h,this.bucketOffset=d,this.bucketArray=f,this.xArray=s,this.yArray=o,this.zArray=a}within(e,t,n,i){const r=[];return this.eachWithin(e,t,n,i,(e=>r.push(e))),r}eachWithin(e,t,n,i,r){const s=i*i,o=Math.max(0,e-i-this.minX>>this.exp),a=Math.max(0,t-i-this.minY>>this.exp),l=Math.max(0,n-i-this.minZ>>this.exp),c=Math.min(this.boundX,1+(e+i-this.minX>>this.exp)),u=Math.min(this.boundY,1+(t+i-this.minY>>this.exp)),h=Math.min(this.boundZ,1+(n+i-this.minZ>>this.exp));for(let i=o;i<c;++i)for(let o=a;o<u;++o)for(let a=l;a<h;++a){const l=(i*this.boundY+o)*this.boundZ+a,c=this.grid[l];if(c>0){const i=c-1,o=this.bucketOffset[i],a=o+this.bucketCount[i];for(let i=o;i<a;++i){const o=this.bucketArray[i],a=this.xArray[o]-e,l=this.yArray[o]-t,c=this.zArray[o]-n,u=a*a+l*l+c*c;u<=s&&r(o,u)}}}}}class Kh{constructor(e=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let e=0,t=this._fields.length;e<t;++e){const[t,n,i]=this._fields[e];this._initField(t,n,i)}}_initField(e,t,n){this[e]=Fa(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let e=0,t=this._fields.length;e<t;++e){const t=this._fields[e][0],n=this._fields[e][1],i=this.length*n,r=new this[t].constructor(i);this[t].length>i?r.set(this[t].subarray(0,i)):r.set(this[t]),this[t]=r}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,n,i){for(let r=0,s=this._fields.length;r<s;++r){const s=this._fields[r][0],o=this._fields[r][1],a=this[s],l=e[s];for(let e=0;e<i;++e){const i=o*(t+e),r=o*(n+e);for(let e=0;e<o;++e)a[i+e]=l[r+e]}}}copyWithin(e,t,n){for(let i=0,r=this._fields.length;i<r;++i){const r=this._fields[i][0],s=this._fields[i][1],o=this[r];for(let i=0;i<n;++i){const n=s*(e+i),r=s*(t+i);for(let e=0;e<s;++e)o[n+e]=o[r+e]}}}sort(e){Yl.time("Store.sort");const t=this,n=new this.constructor(1);!function i(r,s){if(r<s){let l=Math.floor((r+s)/2),c=r,u=s;do{for(;e(c,l)<0;)c+=1;for(;e(u,l)>0;)u-=1;c<=u&&(c===l?l=u:u===l&&(l=c),(o=c)!==(a=u)&&(n.copyFrom(t,0,o,1),t.copyWithin(o,a,1),t.copyFrom(n,a,0,1)),c+=1,u-=1)}while(c<=u);i(r,u),i(c,s)}var o,a}(0,this.count-1),Yl.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class Zh extends Kh{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,n){this.growIfFull();const i=this.count;e<t?(this.index1[i]=e,this.index2[i]=t):(this.index2[i]=e,this.index1[i]=t),n&&(this.type[i]=n),this.count+=1}}function Qh(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24}class Jh{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),!0===t&&this.setAll()}get(e){return!!(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,n){if(t<e)return;const i=this._words,r=!0===n?4294967295:0,s=e>>>5,o=t>>>5;for(let e=s+1;e<o;++e)i[e]=r;const a=s<<5,l=o<<5;if(!0===n)if(t-e<32)for(let n=e,r=t+1;n<r;++n)i[n>>>5]|=1<<n;else{for(let t=e,n=a+32;t<n;++t)i[t>>>5]|=1<<t;for(let e=l,n=t+1;e<n;++e)i[e>>>5]|=1<<e}else if(t-e<32)for(let n=e,r=t+1;n<r;++n)i[n>>>5]&=~(1<<n);else{for(let t=e,n=a+32;t<n;++t)i[t>>>5]&=~(1<<t);for(let e=l,n=t+1;e<n;++e)i[e>>>5]&=~(1<<e)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const n=e[i];t[n>>>5]|=1<<n}return this}clearBits(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const n=e[i];t[n>>>5]&=~(1<<n)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,n=32-this.length%32;for(let n=0;n<e-1;++n)t[n]=~t[n];return t[e-1]=~(t[e-1]<<n)>>>n,this}_isRangeValue(e,t,n){if(t<e)return;const i=this._words,r=!0===n?4294967295:0,s=e>>>5,o=t>>>5;for(let e=s+1;e<o;++e)if(i[e]!==r)return!1;if(t-e<32){for(let r=e,s=t+1;r<s;++r)if(!!(i[r>>>5]&1<<r)!==n)return!1}else{const r=o<<5;for(let t=e,r=32+(s<<5);t<r;++t)if(!!(i[t>>>5]&1<<t)!==n)return!1;for(let e=r,s=t+1;e<s;++e)if(!!(i[e>>>5]&1<<e)!==n)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const n=e[i];if(!(t[n>>>5]&1<<n))return!1}return!0}isClear(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const n=e[i];if(t[n>>>5]&1<<n)return!1}return!0}isEqualTo(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let e=0;e<i;++e)if(t[e]!==n[e])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let n=0;for(let i=0;i<e;++i)n+=Qh(t[i]);return n}difference(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let e=0;e<i;++e)t[e]=t[e]&~n[e];for(let e=t.length;e<i;++e)t[e]=0;return this}union(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let e=0;e<i;++e)t[e]|=n[e];for(let e=t.length;e<i;++e)t[e]=0;return this}intersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let e=0;e<i;++e)t[e]&=n[e];for(let e=t.length;e<i;++e)t[e]=0;return this}intersects(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let e=0;e<i;++e)if(t[e]&n[e])return!0;return!1}getIntersectionSize(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);let r=0;for(let e=0;e<i;++e)r+=Qh(t[e]&n[e]);return r}makeIntersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length),r=new Uint32Array(i),s=Object.create(Jh.prototype);s._words=r,s.length=Math.min(this.length,e.length);for(let e=0;e<i;++e)r[e]=t[e]&n[e];return s}forEach(e){const t=this._words.length,n=this._words;let i=0;for(let r=0;r<t;++r){let t=n[r];for(;0!==t;){const n=t&-t;e((r<<5)+Qh(n-1),i),t^=n,++i}}}toArray(){const e=this._words,t=new Array(this.getSize()),n=this._words.length;let i=0;for(let r=0;r<n;++r){let n=e[r];for(;0!==n;){const e=n&-n;t[i++]=(r<<5)+Qh(e-1),n^=e}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(Jh.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function ed(e){const{edgeCount:t,nodeCount:n,nodeArray1:i,nodeArray2:r}=e,s=new Uint8Array(n),o=new Int32Array(n);for(let e=0;e<t;++e)s[i[e]]+=1,s[r[e]]+=1;for(let e=1;e<n;++e)o[e]+=o[e-1]+s[e-1];const a=2*t,l=new Int32Array(a);for(let e=0;e<a;++e)l[e]=-1;for(let e=0;e<t;++e){const t=i[e],n=r[e];let s=o[t];for(;-1!==l[s]&&s<a;)s+=1;l[s]=e;let c=o[n];for(;-1!==l[c]&&c<a;)c+=1;l[c]=e}return{countArray:s,offsetArray:o,indexArray:l}}function td(e=0,t=0){return{type:e,group:t,x:0,y:0,z:0,atomSet:[]}}function nd(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z,e.atomSet.push(t.index)}function id(e,t){const n=t.atomSet.length;if(n>0){const{types:i,groups:r,centers:s,atomSets:o}=e;i.push(t.type),r.push(t.group),s.x.push(t.x/n),s.y.push(t.y/n),s.z.push(t.z/n),o.push(t.atomSet)}}const rd=0,sd=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],od=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],ad=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],ld=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],cd=["NON-POLYMER"].concat(["OTHER"],ld),ud=["h","g","i"],hd=["e","b"],dd=["s","t","l",""],pd={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},fd={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},md={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},gd={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},_d={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},vd={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},yd=[0,0,0],bd={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},xd=Object.keys(bd),wd=["A","C","T","G","U","I"],Sd=["DA","DC","DT","DG","DU","DI"],Ad=["A","G","I","DA","DG","DI"],Md=wd.concat(Sd),Cd=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],Td=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],Ed=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],Pd=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],Id=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],kd={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};kd[rd]={};const Rd={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function Dd(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const Ld=new Map([[2,qa(180)],[3,qa(120)],[4,qa(109.4721)],[6,qa(90)]]);function Od(e,t){let n=[];const i=new ut,r=new ut;return i.subVectors(t,e),e.eachBondedAtom((t=>{1!==t.number&&(r.subVectors(t,e),n.push(i.angleTo(r)))})),n}function Nd(e,t){const n=e.clone(),i=new ut;i.subVectors(t,e);const r=[new ut,new ut];let s=0;if(e.eachBondedAtom((t=>{s>1||1!==t.number&&(n.index=t.index,r[s++].subVectors(t,e))})),1===s&&n.eachBondedAtom((t=>{s>1||1!==t.number&&t.index!==e.index&&r[s++].subVectors(t,e)})),2!==s)return;const o=r[0].cross(r[1]);return Math.abs(Math.PI/2-o.angleTo(i))}function Fd(e){if(e["@valenceModel"])return e["@valenceModel"];const t=function(e,t){const n=e.structure,i=n.atomCount,r=new Int8Array(i),s=new Int8Array(i),o=new Int8Array(i),a=new Int8Array(i);return n.eachAtom((e=>{const n=e.index,[i,l,c,u]=function(e,t){const n=e.bondToElementCount(1);let i=e.formalCharge||0;const r="always"===t.assignCharge||"auto"===t.assignCharge&&0===i,s="always"===t.assignH||"auto"===t.assignH&&0===n,o=e.bondCount,a=function(e){let t=0;return e.eachBond((e=>t+=e.bondOrder)),t}(e),l=function(e){const t=e.structure.getBondProxy(),n=e.number,i=8===n||7===n;if(i&&4===e.bondCount)return!1;let r=!1;return e.eachBond((n=>{if(n.bondOrder>1)r=!0;else if(i){const i=n.getOtherAtom(e);i.eachBond((e=>{if(e.bondOrder>1){const t=i.number;if((15===t||16===t)&&8===e.getOtherAtom(i).number)return;r=!0}}),t)}})),r}(e),c=a-o>0;let u=0,h=8;switch(e.number){case 1:r&&(0===o?(i=1,h=0):1===o&&(i=0,h=1));break;case 6:r&&(i=0),s&&(u=Math.max(0,4-a-Math.abs(i))),h=Dd(o+u+Math.max(0,-i));break;case 7:if(r)if(s)if(l&&a<4)i=o-n==1&&a-n==2?1:0;else{let t=!1;e.eachBondedAtom((e=>{(16===e.number||e.isMetal())&&(t=!0)})),i=t?0:1}else i=a-3;s&&(u=Math.max(0,3-a+i)),h=Dd(l&&!c?o+u-i:o+u+1-i);break;case 8:r&&(s||(i=a-2),1===a&&e.eachBondedAtom((t=>{t.eachBond((n=>{const r=n.getOtherAtom(t);r.index!==e.index&&8===r.number&&2===n.bondOrder&&(i=-1)}))}))),s&&(u=Math.max(0,2-a+i)),h=Dd(l&&!c?o+u-i+1:o+u-i+2);break;case 16:r&&(s||(i=a<=3&&!e.bondToElementCount(8)?a-2:0)),s&&a<2&&(u=Math.max(0,2-a+i)),a<=3&&(h=Dd(o+u-i+2));break;case 9:case 17:case 35:case 53:case 85:r&&(i=a-1);break;case 3:case 11:case 19:case 37:case 55:case 87:r&&(i=1-a);break;case 4:case 12:case 20:case 38:case 56:case 88:r&&(i=2-a);break;default:console.warn("Requested charge, protonation for an unhandled element",e.element)}return[i,u,u+n,h]}(e,t);r[n]=i,s[n]=l,o[n]=c,a[n]=u})),{charge:r,implicitH:s,totalH:o,idealGeometry:a}}(e,{assignCharge:"auto",assignH:"auto"});return e["@valenceModel"]=t,t}function Bd(e){return 15===e.number&&e.bondToElementCount(8)===e.bondCount}const Ud=["ARG","HIS","LYS"],zd=["GLU","ASP"];function Vd(e,t){return 2===e&&1===t||1===e&&2===t}function Hd(e,t){return 3===e&&3===t}function $d(e,t){return 3===e&&1===t||1===e&&3===t}function Gd(e){return"HIS"===e.resname&&7==e.number&&e.isRing()}function jd(e,t){return 5===e&&4===t||4===e&&5===t}function Wd(e,t){return 9===e&&5===t||5===e&&9===t}const qd=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function Xd(e,t){return 12===e?11===t||12===t:13===e?10===t:void 0}const Yd=[17,35,53,85],Kd=[7,8,16],Zd=[6,7,15,16],Qd=qa(180),Jd=qa(120);function ep(e,t,n){return!np(e,t,n)&&(e.modelIndex!==t.modelIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}const tp={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function np(e,t,n){return e.modelIndex===n&&t.modelIndex!==n||t.modelIndex===n&&e.modelIndex!==n}function ip(e,t,n){return!np(e,t,n)&&(e.modelIndex!==t.modelIndex||e.residueIndex===t.residueIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}function rp(e){switch(e){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const sp={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},op=new Pn;class ap{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e}_getPosition(e){return new ut}getPosition(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)}}class lp extends ap{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class cp extends ap{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return(new ut).copy(this.getObject(e))}}class up extends ap{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class hp extends ap{constructor(e,t,n){super(e),this.structure=t,this.bondStore=n||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return(new ut).copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class dp extends ap{constructor(e,t,n){super(e),this.contacts=t,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:n,contactStore:i}=this.contacts,{centers:r,atomSets:s}=n,{x:o,y:a,z:l}=r,{index1:c,index2:u,type:h}=i,d=c[t],p=u[t];return{center1:new ut(o[d],a[d],l[d]),center2:new ut(o[p],a[p],l[p]),atom1:this.structure.getAtomProxy(s[d][0]),atom2:this.structure.getAtomProxy(s[p][0]),type:rp(h[t])}}_getPosition(e){const{center1:t,center2:n}=this.getObject(e);return(new ut).addVectors(t,n).multiplyScalar(.5)}}class pp extends ap{constructor(e,t,n){super(e),this.validation=t,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,n=this.getIndex(e);return{validation:t,index:n,clash:t.clashArray[n]}}_getAtomProxyFromSele(e){const t=new Ll(e),n=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(n)}_getPosition(e){const t=this.getObject(e).clash,n=this._getAtomProxyFromSele(t.sele1),i=this._getAtomProxyFromSele(t.sele2);return(new ut).copy(n).add(i).multiplyScalar(.5)}}class fp extends hp{get type(){return"distance"}}class mp extends ap{get type(){return"ignore"}}class gp extends lp{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=lh(this.mesh.position)),this.__position}}class _p extends ap{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class vp extends ap{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class yp extends ap{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,n=this.getIndex(e);return{volume:t,index:n,value:t.data[n]}}_getPosition(e){const t=this.volume.position,n=this.getIndex(e);return new ut(t[3*n],t[3*n+1],t[3*n+2])}}class bp extends yp{get type(){return"slice"}}function xp(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function wp(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function Sp(e,t,n,i,r){var s,o,a,l,c,u,h,d=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],p=0,f=!1,m=!1,g=!1,_=!1,v=-1,y=t*n*i,b=t,x=t*n,w=new Int32Array(12),S=[],A=[],M=[],C=[],T=xp(),E=wp();function P(e,t,n){return e+(t-e)*n}function I(e,r,s){return x*(s=(s+h)%i)+b*(r=(r+u)%n)+(e+c)%t}function k(e,t,n,i,l,c,u){var h=3*e;if(o[h]<0){var d=(p-c)/(u-c),m=s,g=3*a;if(S[g]=n+d,S[g+1]=i,S[g+2]=l,!f){var _=3*e;A[g]=v*P(m[_],m[_+3],d),A[g+1]=v*P(m[_+1],m[_+4],d),A[g+2]=v*P(m[_+2],m[_+5],d)}r&&(C[a]=r[e+Math.round(d)]),o[h]=a,w[t]=a,a+=1}else w[t]=o[h]}function R(e,t,n,i,l,c,u){var h=3*e+1;if(o[h]<0){var d=(p-c)/(u-c),m=s,g=3*a;if(S[g]=n,S[g+1]=i+d,S[g+2]=l,!f){var _=3*e,y=_+3*b;A[g]=v*P(m[_],m[y],d),A[g+1]=v*P(m[_+1],m[y+1],d),A[g+2]=v*P(m[_+2],m[y+2],d)}r&&(C[a]=r[e+Math.round(d)*b]),o[h]=a,w[t]=a,a+=1}else w[t]=o[h]}function D(e,t,n,i,l,c,u){var h=3*e+2;if(o[h]<0){var d=(p-c)/(u-c),m=s,g=3*a;if(S[g]=n,S[g+1]=i,S[g+2]=l+d,!f){var _=3*e,y=_+3*x;A[g]=v*P(m[_],m[y],d),A[g+1]=v*P(m[_+1],m[y+1],d),A[g+2]=v*P(m[_+2],m[y+2],d)}r&&(C[a]=r[e+Math.round(d)*x]),o[h]=a,w[t]=a,a+=1}else w[t]=o[h]}function L(t){var n=3*t;0===s[n]&&(s[n]=e[(t-1+y)%y]-e[(t+1)%y],s[n+1]=e[(t-b+y)%y]-e[(t+b)%y],s[n+2]=e[(t-x+y)%y]-e[(t+x)%y])}function O(t,n,i,r,s){var o,a,c,u,h,v,y;g?(r=I(t,n,i),o=I(t+1,n,i),a=I(t,n+1,i),c=I(t,n,i+1),u=I(t+1,n+1,i),h=I(t+1,n,i+1),v=I(t,n+1,i+1),y=I(t+1,n+1,i+1)):(o=r+1,u=(a=r+b)+1,h=(c=r+x)+1,y=(v=a+x)+1);var S=0,A=e[r],C=e[o],P=e[a],O=e[u],N=e[c],F=e[h],B=e[v],U=e[y];A<p&&(S|=1),C<p&&(S|=2),P<p&&(S|=8),O<p&&(S|=4),N<p&&(S|=16),F<p&&(S|=32),B<p&&(S|=128),U<p&&(S|=64);var z=T[S];if(0===z)return 0;var V=t+1,H=n+1,$=i+1;1&z&&(f||(L(r),L(o)),k(r,0,t,n,i,A,C)),2&z&&(f||(L(o),L(u)),R(o,1,V,n,i,C,O)),4&z&&(f||(L(a),L(u)),k(a,2,t,H,i,P,O)),8&z&&(f||(L(r),L(a)),R(r,3,t,n,i,A,P)),16&z&&(f||(L(c),L(h)),k(c,4,t,n,$,N,F)),32&z&&(f||(L(h),L(y)),R(h,5,V,n,$,F,U)),64&z&&(f||(L(v),L(y)),k(v,6,t,H,$,B,U)),128&z&&(f||(L(c),L(v)),R(c,7,t,n,$,N,B)),256&z&&(f||(L(r),L(c)),D(r,8,t,n,i,A,N)),512&z&&(f||(L(o),L(h)),D(o,9,V,n,i,C,F)),1024&z&&(f||(L(u),L(y)),D(u,10,V,H,i,O,U)),2048&z&&(f||(L(a),L(v)),D(a,11,t,H,i,P,B));for(var G,j,W,q=S<<4,X=0;-1!==E[q+X];)G=E[q+X],j=E[q+X+1],W=E[q+X+2],m?(d[G][j]&s&&(M[l++]=w[G],M[l++]=w[j]),d[j][W]&s&&(M[l++]=w[j],M[l++]=w[W]),d[G][W]&s&&(M[l++]=w[G],M[l++]=w[W])):(M[l++]=w[_?G:j],M[l++]=w[_?j:G],M[l++]=w[W]),X+=3}function N(r,s,a,l,c,u){let h,d,m,_,v,y,w,S,A,M,C,T,E;if(r=void 0!==r?r:0,s=void 0!==s?s:0,a=void 0!==a?a:0,l=void 0!==l?l:t-1,c=void 0!==c?c:n-1,u=void 0!==u?u:i-1,g||(f?(r=Math.max(0,r),s=Math.max(0,s),a=Math.max(0,a),l=Math.min(t-1,l),c=Math.min(n-1,c),u=Math.min(i-1,u)):(r=Math.max(1,r),s=Math.max(1,s),a=Math.max(1,a),l=Math.min(t-2,l),c=Math.min(n-2,c),u=Math.min(i-2,u))),g)for(S=r-2,A=s-2,M=a-2,C=l+2,T=c+2,E=u+2,v=M;v<E;++v)for(_=A;_<T;++_)for(m=S;m<C;++m)d=3*I(m,_,v),o[d]=-1,o[d+1]=-1,o[d+2]=-1;else for(S=Math.max(0,r-2),A=Math.max(0,s-2),M=Math.max(0,a-2),C=Math.min(t,l+2),T=Math.min(n,c+2),E=Math.min(i,u+2),v=M;v<E;++v)for(w=x*v,_=A;_<T;++_)for(y=w+b*_,m=S;m<C;++m)h=3*(y+m),o[h]=-1,o[h+1]=-1,o[h+2]=-1;if(!g){var P,k=r,R=s,D=a,L=l,N=c,F=u;for(P=!1,v=a;v<u;++v){for(_=s;_<c;++_){for(m=r;m<l;++m)if(h=t*n*v+t*_+m,e[h]>=p){D=v,P=!0;break}if(P)break}if(P)break}for(P=!1,_=s;_<c;++_){for(v=D;v<u;++v){for(m=r;m<l;++m)if(h=t*n*v+t*_+m,e[h]>=p){R=_,P=!0;break}if(P)break}if(P)break}for(P=!1,m=r;m<l;++m){for(_=R;_<c;++_){for(v=D;v<u;++v)if(h=t*n*v+t*_+m,e[h]>=p){k=m,P=!0;break}if(P)break}if(P)break}for(P=!1,v=u;v>=a;--v){for(_=c;_>=s;--_){for(m=l;m>=r;--m)if(h=t*n*v+t*_+m,e[h]>=p){F=v,P=!0;break}if(P)break}if(P)break}for(P=!1,_=c;_>=s;--_){for(v=F;v>=a;--v){for(m=l;m>=r;--m)if(h=t*n*v+t*_+m,e[h]>=p){N=_,P=!0;break}if(P)break}if(P)break}for(P=!1,m=l;m>=r;--m){for(_=N;_>=s;--_){for(v=F;v>=a;--v)if(h=t*n*v+t*_+m,e[h]>=p){L=m,P=!0;break}if(P)break}if(P)break}f?(r=Math.max(0,k-1),s=Math.max(0,R-1),a=Math.max(0,D-1),l=Math.min(t-1,L+1),c=Math.min(n-1,N+1),u=Math.min(i-1,F+1)):(r=Math.max(1,k-1),s=Math.max(1,R-1),a=Math.max(1,D-1),l=Math.min(t-2,L+1),c=Math.min(n-2,N+1),u=Math.min(i-2,F+1))}var B=15;for(v=a;v<u;++v,B&=-5)for(w=x*v,B|=2,_=s;_<c;++_,B&=-3)for(y=w+b*_,B|=1,m=r;m<l;++m,B&=-2)h=y+m,O(m,_,v,h,B)}this.triangulate=function(e,d,b,x,w){_=(p=e)<0,m=x,g=w,(f=d||m)||(v=p>0?-1:1,s||(s=new Float32Array(3*y)));var T=3*y;if(o&&o.length===T||(o=new Int32Array(T)),a=0,l=0,void 0!==b){var E=b[0].map(Math.round),P=b[1].map(Math.round);c=t*Math.ceil(Math.abs(E[0])/t),u=n*Math.ceil(Math.abs(E[1])/n),h=i*Math.ceil(Math.abs(E[2])/i),N(E[0],E[1],E[2],P[0],P[1],P[2])}else c=u=h=0,N();return S.length=3*a,f||(A.length=3*a),M.length=l,r&&(C.length=a),{position:new Float32Array(S),normal:f?void 0:new Float32Array(A),index:Ba(M,S.length/3),atomindex:r?new Int32Array(C):void 0,contour:m}}}hc.add("arrow",class extends lp{get primitive(){return Hh}}),hc.add("box",class extends lp{get primitive(){return Bh}}),hc.add("cone",class extends lp{get primitive(){return $h}}),hc.add("cylinder",class extends lp{get primitive(){return Vh}}),hc.add("ellipsoid",class extends lp{get primitive(){return Gh}}),hc.add("octahedron",class extends lp{get primitive(){return Uh}}),hc.add("sphere",class extends lp{get primitive(){return Fh}}),hc.add("tetrahedron",class extends lp{get primitive(){return zh}}),hc.add("torus",class extends lp{get primitive(){return jh}}),hc.add("point",class extends lp{get primitive(){return qh}}),hc.add("wideline",class extends lp{get primitive(){return Xh}}),Object.assign(Sp,{__deps:[xp,wp,Ba]});class Ap{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function Mp(e,t){let n=0,i=0;const r=t.rows,s=t.cols;let o=0,a=0,l=0;const c=t.data,u=e.data;for(;n<r;a+=1,o+=s,n++)for(l=a,i=0;i<s;l+=r,i++)u[l]=c[o+i]}function Cp(e,t,n){let i=0,r=0,s=0,o=0,a=0,l=0,c=0;const u=t.cols,h=t.rows,d=n.rows,p=t.data,f=n.data,m=e.data;let g=0;for(;i<h;o+=u,i++)for(l=0,r=0;r<d;c++,r++){for(a=o,g=0,s=0;s<u;a++,l++,s++)g+=p[a]*f[l];m[c]=g}}function Tp(e,t,n){const i=e.data,r=t.data,s=n.data,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],p=r[7],f=r[8],m=s[0],g=s[1],_=s[2],v=s[3],y=s[4],b=s[5],x=s[6],w=s[7],S=s[8];i[0]=o*m+a*v+l*x,i[1]=o*g+a*y+l*w,i[2]=o*_+a*b+l*S,i[3]=c*m+u*v+h*x,i[4]=c*g+u*y+h*w,i[5]=c*_+u*b+h*S,i[6]=d*m+p*v+f*x,i[7]=d*g+p*y+f*w,i[8]=d*_+p*b+f*S}function Ep(e){const t=e.rows,n=e.cols,i=e.data,r=new Array(n);for(let e=0;e<n;++e)r[e]=0;for(let e=0,s=0;e<t;++e)for(let e=0;e<n;++e,++s)r[e]+=i[s];for(let e=0;e<n;++e)r[e]/=t;return r}function Pp(e,t){const n=e.rows,i=e.cols,r=e.data;for(let e=0,s=0;e<n;++e)for(let e=0;e<i;++e,++s)r[s]-=t[e]}function Ip(e,t,n,i){i=e[t],e[t]=e[n],e[n]=i}function kp(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}function Rp(e,t,n,i){let r=0,s=0;const o=e.rows,a=e.cols;let l=o,c=a;l<c&&(r=1,s=l,l=c,c=s);const u=new Ap(l,l),h=new Ap(1,c),d=new Ap(c,c);if(0===r)Mp(u,e);else{for(s=0;s<a*o;s++)u.data[s]=e.data[s];for(;s<c*l;s++)u.data[s]=0}if(function(e,t,n,i,r,s,o,a){let l=0,c=0,u=0,h=0;const d=Math.max(s,30);let p=0,f=0,m=0,g=0,_=0,v=0,y=0,b=0,x=0,w=0,S=0,A=0,M=0,C=0,T=0,E=0,P=0,I=4660,k=0,R=0,D=0;const L=new Float64Array(o<<3);for(;l<o;l++){for(u=0,S=0;u<s;u++)b=e[l*t+u],S+=b*b;if(L[l]=S,i){for(u=0;u<o;u++)i[l*r+u]=0;i[l*r+l]=1}}for(;h<d;h++){for(_=0,l=0;l<o-1;l++)for(c=l+1;c<o;c++){for(p=l*t|0,f=c*t|0,T=L[l],E=0,P=L[c],u=2,E+=e[p]*e[f],E+=e[p+1]*e[f+1];u<s;u++)E+=e[p+u]*e[f+u];if(!(Math.abs(E)<=2.384185792e-7*Math.sqrt(T*P))){for(E*=2,A=T-P,M=kp(E,A),A<0?(C=.5*(M-A),y=Math.sqrt(C/M),v=E/(M*y*2)):(v=Math.sqrt((M+A)/(2*M)),y=E/(M*v*2)),T=0,P=0,u=2,x=v*e[p]+y*e[f],w=-y*e[p]+v*e[f],e[p]=x,e[f]=w,T+=x*x,P+=w*w,x=v*e[p+1]+y*e[f+1],w=-y*e[p+1]+v*e[f+1],e[p+1]=x,e[f+1]=w,T+=x*x,P+=w*w;u<s;u++)x=v*e[p+u]+y*e[f+u],w=-y*e[p+u]+v*e[f+u],e[p+u]=x,e[f+u]=w,T+=x*x,P+=w*w;if(L[l]=T,L[c]=P,_=1,i)for(m=l*r|0,g=c*r|0,u=2,x=v*i[m]+y*i[g],w=-y*i[m]+v*i[g],i[m]=x,i[g]=w,x=v*i[m+1]+y*i[g+1],w=-y*i[m+1]+v*i[g+1],i[m+1]=x,i[g+1]=w;u<o;u++)x=v*i[m+u]+y*i[g+u],w=-y*i[m+u]+v*i[g+u],i[m+u]=x,i[g+u]=w}}if(0===_)break}for(l=0;l<o;l++){for(u=0,S=0;u<s;u++)b=e[l*t+u],S+=b*b;L[l]=Math.sqrt(S)}for(l=0;l<o-1;l++){for(c=l,u=l+1;u<o;u++)L[c]<L[u]&&(c=u);if(l!==c&&(Ip(L,l,c,S),i)){for(u=0;u<s;u++)Ip(e,l*t+u,c*t+u,b);for(u=0;u<o;u++)Ip(i,l*r+u,c*r+u,b)}}for(l=0;l<o;l++)n[l]=L[l];if(i)for(l=0;l<a;l++){for(S=l<o?L[l]:0;S<=1e-37;){for(R=1/s,u=0;u<s;u++)I=214013*I+2531011,k=256&I>>16?R:-R,e[l*t+u]=k;for(h=0;h<2;h++)for(c=0;c<l;c++){for(S=0,u=0;u<s;u++)S+=e[l*t+u]*e[c*t+u];for(D=0,u=0;u<s;u++)b=e[l*t+u]-S*e[c*t+u],e[l*t+u]=b,D+=Math.abs(b);for(D=D?1/D:0,u=0;u<s;u++)e[l*t+u]*=D}for(S=0,u=0;u<s;u++)b=e[l*t+u],S+=b*b;S=Math.sqrt(S)}for(y=1/S,u=0;u<s;u++)e[l*t+u]*=y}}(u.data,l,h.data,d.data,c,l,c,l),t){for(s=0;s<c;s++)t.data[s]=h.data[s];for(;s<a;s++)t.data[s]=0}0===r?(n&&Mp(n,u),i&&Mp(i,d)):(n&&Mp(n,d),i&&Mp(i,u))}function Dp(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Lp(e,t,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g){e[0]=t,e[4]=n,e[8]=i,e[12]=r,e[1]=s,e[5]=o,e[9]=a,e[13]=l,e[2]=c,e[6]=u,e[10]=h,e[14]=d,e[3]=p,e[7]=f,e[11]=m,e[15]=g}function Op(e,t,n){const i=t[0],r=t[4],s=t[8],o=t[12],a=t[1],l=t[5],c=t[9],u=t[13],h=t[2],d=t[6],p=t[10],f=t[14],m=t[3],g=t[7],_=t[11],v=t[15],y=n[0],b=n[4],x=n[8],w=n[12],S=n[1],A=n[5],M=n[9],C=n[13],T=n[2],E=n[6],P=n[10],I=n[14],k=n[3],R=n[7],D=n[11],L=n[15];e[0]=i*y+r*S+s*T+o*k,e[4]=i*b+r*A+s*E+o*R,e[8]=i*x+r*M+s*P+o*D,e[12]=i*w+r*C+s*I+o*L,e[1]=a*y+l*S+c*T+u*k,e[5]=a*b+l*A+c*E+u*R,e[9]=a*x+l*M+c*P+u*D,e[13]=a*w+l*C+c*I+u*L,e[2]=h*y+d*S+p*T+f*k,e[6]=h*b+d*A+p*E+f*R,e[10]=h*x+d*M+p*P+f*D,e[14]=h*w+d*C+p*I+f*L,e[3]=m*y+g*S+_*T+v*k,e[7]=m*b+g*A+_*E+v*R,e[11]=m*x+g*M+_*P+v*D,e[15]=m*w+g*C+_*I+v*L}function Np(e,t,n,i){Lp(e,t,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1)}function Fp(e,t,n,i){Lp(e,1,0,0,t,0,1,0,n,0,0,1,i,0,0,0,1)}function Bp(e,t){const n=Math.cos(t),i=Math.sin(t);Lp(e,n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1)}function Up(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function zp(e,t){const n=fh([t[0],t[1],t[2]]),i=fh([t[4],t[5],t[6]]),r=fh([t[8],t[9],t[10]]),s=fh();mh(s,i,r),e[0]=s[0],e[1]=s[1],e[2]=s[2],mh(s,r,n),e[3]=s[0],e[4]=s[1],e[5]=s[2],mh(s,n,i),e[6]=s[0],e[7]=s[1],e[8]=s[2]}function Vp(e,t,n,i){n=n||1,i=i||!0;const r=e.length/3,s=t.length/3;let o;i&&(o=new Float32Array(3*r));const a=new Float32Array(3*r);let l;const c=new Array(20);for(l=0;l<20;++l)c[l]=new Uint32Array(r);for(l=0;l<r;++l)c[0][l]=0;let u,h,d;for(l=0;l<s;++l){var p=3*l,f=3*l+1,m=3*l+2;for(d=!0,u=0,h=c[0][t[p]];u<h;++u)if(t[f]===c[u+1][t[p]]){d=!1;break}for(d&&(c[0][t[p]]++,c[c[0][t[p]]][t[p]]=t[f]),d=!0,u=0,h=c[0][t[p]];u<h;++u)if(t[m]===c[u+1][t[p]]){d=!1;break}for(d&&(c[0][t[p]]++,c[c[0][t[p]]][t[p]]=t[m]),d=!0,u=0,h=c[0][t[f]];u<h;++u)if(t[p]===c[u+1][t[f]]){d=!1;break}for(d&&(c[0][t[f]]++,c[c[0][t[f]]][t[f]]=t[p]),d=!0,u=0,h=c[0][t[f]];u<h;++u)if(t[m]===c[u+1][t[f]]){d=!1;break}for(d&&(c[0][t[f]]++,c[c[0][t[f]]][t[f]]=t[m]),d=!0,u=0;u<c[0][t[m]];++u)if(t[p]===c[u+1][t[m]]){d=!1;break}for(d&&(c[0][t[m]]++,c[c[0][t[m]]][t[m]]=t[p]),d=!0,u=0,h=c[0][t[m]];u<h;++u)if(t[f]===c[u+1][t[m]]){d=!1;break}d&&(c[0][t[m]]++,c[c[0][t[m]]][t[m]]=t[f])}for(var g,_,v,y,b,x=.5,w=.75/4.5,S=0;S<n;++S){for(l=0;l<r;++l)if(g=3*l,(v=c[0][l])<3)a[g]=e[g],a[g+1]=e[g+1],a[g+2]=e[g+2];else if(3===v||4===v){for(a[g]=0,a[g+1]=0,a[g+2]=0,u=0;u<v;++u)_=3*c[u+1][l],a[g]+=e[_],a[g+1]+=e[_+1],a[g+2]+=e[_+2];a[g]+=x*e[g],a[g+1]+=x*e[g+1],a[g+2]+=x*e[g+2],b=x+v,a[g]/=b,a[g+1]/=b,a[g+2]/=b}else{for(a[g]=0,a[g+1]=0,a[g+2]=0,u=0;u<v;++u)_=3*c[u+1][l],a[g]+=e[_],a[g+1]+=e[_+1],a[g+2]+=e[_+2];a[g]+=1*e[g],a[g+1]+=1*e[g+1],a[g+2]+=1*e[g+2],y=1+v,a[g]/=y,a[g+1]/=y,a[g+2]/=y}if(e.set(a),i){Hp(e,t,o);var A=3*r;for(g=0;g<A;g+=3)e[g]+=-1*w*o[g],e[g+1]+=-1*w*o[g+1],e[g+2]+=-1*w*o[g+2]}}}function Hp(e,t,n){var i,r;if(void 0===n)n=new Float32Array(e.length);else for(i=0,r=n.length;i<r;i++)n[i]=0;var s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);if(t)for(i=0,r=t.length;i<r;i+=3){var u=3*t[i],h=3*t[i+1],d=3*t[i+2];yh(s,e,u),yh(o,e,h),yh(a,e,d),_h(l,a,o),_h(c,s,o),mh(l,l,c),n[u]+=l[0],n[u+1]+=l[1],n[u+2]+=l[2],n[h]+=l[0],n[h+1]+=l[1],n[h+2]+=l[2],n[d]+=l[0],n[d+1]+=l[1],n[d+2]+=l[2]}else for(i=0,r=e.length;i<r;i+=9)yh(s,e,i),yh(o,e,i+3),yh(a,e,i+6),_h(l,a,o),_h(c,s,o),mh(l,l,c),n[i]=l[0],n[i+1]=l[1],n[i+2]=l[2],n[i+3]=l[0],n[i+4]=l[1],n[i+5]=l[2],n[i+6]=l[0],n[i+7]=l[1],n[i+8]=l[2];return ph(n),n}function $p(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function Gp(e,t,n,i,r){var s=1/i*3;Ch(e,e,r+(s+=n)),Th(t,t,r+s),Ah(e,e,i),Eh(e,e),Sh(e,e,i),Ah(t,t,i),Ph(t,t),Sh(t,t,i);var o=new Float32Array(3);_h(o,t,e),Ah(o,o,i),Ph(o,o),Th(o,o,1);var a=256*Math.pow(10,6),l=o[0]*o[1]*o[2]*3;a<=l&&(Ah(e,e,i*=Math.pow(a/l,1/3)),Eh(e,e),Sh(e,e,i),Ah(t,t,i),Ph(t,t),Sh(t,t,i),_h(o,t,e),Ah(o,o,i),Ph(o,o),Th(o,o,1));var c=new Float32Array(e);Ih(c,c);var u=Dp(),h=Dp();Bp(h,qa(90)),Op(u,u,h);var d=Dp();Np(d,-1/i,1/i,1/i),Op(u,u,d);var p=Dp();return Fp(p,-i*c[2],-i*c[1],-i*c[0]),Op(u,u,p),{dim:o,tran:c,matrix:u,scaleFactor:i}}Np.__deps=[Lp],Fp.__deps=[Lp],Bp.__deps=[Lp],zp.__deps=[fh,mh],Object.assign(Vp,{__deps:[Hp]}),Object.assign(Hp,{__deps:[_h,mh,yh,ph]}),Object.assign(Gp,{__deps:[qa,Ch,Th,Sh,Ah,Eh,Ph,_h,Ih,Dp,Op,Fp,Np,Bp]});class jp{constructor(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new ut,this.boundingBox=new pt,n instanceof qn||n instanceof ro?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,n,i,r,s=!1){this.position=e,this.index=t,this.normal=n,this.color=i,this.atomindex=r,this.size=e.length/3,this.contour=s}fromGeometry(e){let t,n,i,r;if(Ql&&Yl.time("GeometrySurface.fromGeometry"),t=e instanceof qn?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof qn){const e=t.attributes,s=!!e.normal&&e.normal.array;(!s||0===s[0]&&0===s[1]&&0===s[2])&&t.computeVertexNormals(),n=e.position.array,i=e.index?e.index.array:null,r=e.normal.array}this.set(n,i,r,void 0,void 0),Ql&&Yl.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const n=this.size,i=new Float32Array(3*n),r=ic.getScheme(t);if(r.volumeColor||"random"===t.scheme)for(let e=0;e<n;++e)r.volumeColorToArray(e,i,3*e);else if(r.positionColor){const e=new ut,t=this.position;for(let o=0;o<n;++o){var s=3*o;e.set(t[s],t[s+1],t[s+2]),r.positionColorToArray(e,i,s)}}else if(r.atomColor&&this.atomindex){const e=t.structure.getAtomProxy(),s=this.atomindex;for(let t=0;t<n;++t)e.index=s[t],r.atomColorToArray(e,i,3*t)}else{const e=new Pn(t.value);jc(n,e.r,e.g,e.b,i)}return i}getPicking(e){return this.atomindex&&e?new cp(this.atomindex,e):new _p(Wc(this.size),this)}getNormal(){return this.normal}getSize(e,t){return Gc(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const n=new Ll(e),i=t.getAtomSet(n),r=[],s=this.atomindex,o=this.index,a=o.length,l=this.contour?2:3;let c=0;for(let e=0;e<a;e+=l){let t=!0;for(let n=0;n<l;n++){const r=s[o[e+n]];if(!i.get(r)){t=!1;break}}if(t)for(let t=0;t<l;t++,c++)r[c]=o[e+t]}return Ba(r,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function Wp(e,t,n,i,r){var s=new Sp(e,t,n,i,r);this.getSurface=function(e,t,n,i,r,o=!1){const a=s.triangulate(e,t,n,r,o);if(t&&!r&&(Vp(a.position,a.index,t,!0),a.normal=Hp(a.position,a.index)),i&&(hh(i,a.position),a.normal)){const e=Up();zp(e,i),dh(e,a.normal)}return a}}Object.assign(Wp,{__deps:[Vp,Hp,Sp,hh,dh,Up,zp]}),nc.add("surf",(function(e,t){const n=e.data.args,i=e.data.params;if(n&&(self.volsurf=new Wp(n[0],n[1],n[2],n[3],n[4])),i){const e=self.volsurf.getSurface(i.isolevel,i.smooth,i.box,i.matrix,i.contour,i.wrap),n=[e.position.buffer,e.index.buffer];e.normal&&n.push(e.normal.buffer),e.atomindex&&n.push(e.atomindex.buffer),t({sd:e,p:i},n)}}),[Wp]);class qp{constructor(e,t,n,i,r,s,o){this.name=e,this.path=t,this.matrix=new zt,this.normalMatrix=new Fe,this.inverseMatrix=new zt,this.center=new ut,this.boundingBox=new pt,this.setData(n,i,r,s,o)}get type(){return"Volume"}setData(e,t,n,i,r){this.nx=t||1,this.ny=n||1,this.nz=i||1,this.data=e||new Float32Array(1),this.setAtomindex(r),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,n,i){this._min=e,this._max=t,this._mean=n,this._rms=i}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,n=this.center,i=this.nx-1,r=this.ny-1,s=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(i,r,s)),t.expandByPoint(n.set(i,r,0)),t.expandByPoint(n.set(i,0,s)),t.expandByPoint(n.set(i,0,0)),t.expandByPoint(n.set(0,r,s)),t.expandByPoint(n.set(0,0,s)),t.expandByPoint(n.set(0,r,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const o=this.matrix.elements,a=new ut(o[0],o[1],o[2]),l=new ut(o[4],o[5],o[6]),c=new ut(o[8],o[9],o[10]),u=new ut,h=this.normalMatrix.elements;u.crossVectors(l,c),h[0]=u.x,h[1]=u.y,h[2]=u.z,u.crossVectors(c,a),h[3]=u.x,h[4]=u.y,h[5]=u.z,u.crossVectors(a,l),h[6]=u.x,h[7]=u.y,h[8]=u.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(e){this.atomindex=e}getBox(e,t,n){return n||(n=new pt),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new pt);const n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(e,t,n){const i=this.name+"@"+t.toPrecision(2),r=new jp(i,"",e);return r.info.isolevel=t,r.info.smooth=n,r.info.volume=this,r}getSurface(e,t,n,i,r,s=!1){e=isNaN(e)?this.getValueForSigma(2):e,t=Aa(t,0),void 0===this.volsurf&&(this.volsurf=new Wp(this.data,this.nx,this.ny,this.nz,this.atomindex));const o=this._getBox(n,i),a=this.volsurf.getSurface(e,t,o,this.matrix.elements,r,s);return this._makeSurface(a,e,t)}getSurfaceWorker(e,t,n,i,r,s,o){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){void 0===this.workerPool&&(this.workerPool=new ah("surf",2));const a={},l=this.workerPool.getNextWorker();0===l.postCount&&Object.assign(a,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(a,{params:{isolevel:e,smooth:t,box:this._getBox(n,i),matrix:this.matrix.elements,contour:r,wrap:s}}),l.post(a,void 0,(e=>{const t=e.data.sd,n=e.data.p;o(this._makeSurface(t,n.isolevel,n.smooth))}),(a=>{console.warn("Volume.getSurfaceWorker error - trying without worker",a);const l=this.getSurface(e,t,n,i,r,s);o(l)}))}else{const a=this.getSurface(e,t,n,i,r,s);o(a)}}getValueForSigma(e){return this.mean+Aa(e,2)*this.rms}getSigmaForValue(e){return(Aa(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,n=this.nx,i=new Float32Array(n*t*e*3);let r=0;for(let s=0;s<e;++s)for(let e=0;e<t;++e)for(let t=0;t<n;++t)i[r+0]=t,i[r+1]=e,i[r+2]=s,r+=3;hh(this.matrix.elements,i),this._position=i}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const n=ic.getScheme(t),i=this.position.length/3,r=new Float32Array(3*i);for(let e=0;e<i;++e)n.volumeColorToArray(e,r,3*e);return r}getDataPicking(){const e=Wc(this.position.length/3);return new yp(e,this)}getDataSize(e,t){const n=this.data,i=this.position.length/3;let r;switch(e){case"value":case"deviation":r=new Float32Array(n);break;case"abs-value":r=new Float32Array(n);for(let e=0;e<i;++e)r[e]=Math.abs(r[e]);break;case"value-min":{r=new Float32Array(n);const e=this.min;for(let t=0;t<i;++t)r[t]-=e;break}default:r=Gc(i,e)}if(1!==t)for(let e=0;e<i;++e)r[e]*=t;return r}get min(){return void 0===this._min&&(this._min=Qc(this.data)),this._min}get max(){return void 0===this._max&&(this._max=Zc(this.data)),this._max}get sum(){return void 0===this._sum&&(this._sum=Jc(this.data)),this._sum}get mean(){return void 0===this._mean&&(this._mean=eu(this.data)),this._mean}get rms(){return void 0===this._rms&&(this._rms=function(e){const t=e.length;let n=0;for(let i=0;i<t;++i){const t=e[i];n+=t*t}return Math.sqrt(n/t)}(this.data)),this._rms}clone(){const e=new qp(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function Xp(e){return"front"===e?0:"back"===e?1:2}ac.add("shader/Mesh.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#elif defined( NOLIGHT )\nvColor = color;\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),ac.add("shader/Mesh.frag","#define STANDARD\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#elif defined( NOLIGHT )\ngl_FragColor = vec4( vColor, opacity );\n#else\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n#include interior_fragment\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#include opaque_back_fragment\n#endif\n}");const Yp={f:1,v2:2,v3:3,c:3};function Kp(e,t){e.matrix.copy(t),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0}const Zp={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new ut,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new zt,disablePicking:!1,sortParticles:!1,background:!1},Qp={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class Jp{constructor(e,t={}){this.parameterTypes=Qp,this.geometry=new qn,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=Ma(t,this.defaultParameters),this.uniforms=_i.merge([Ni.common,{fogColor:{value:new Pn(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Pn(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Pn(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},Ni.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=Wc(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return Zp}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){Kp(this.group,e),Kp(this.wireframeGroup,e),Kp(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new Nn(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?be:ye):Yl.error("Index is null")}makeMaterial(){const e=Xp(this.parameters.side),t=new vi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const n=new vi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;const i=new vi({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:0});i.vertexColors=!0,i.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=i,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,n=new qn;n.attributes=e.attributes,t&&(n.setIndex(new Nn(t,1).setUsage(this.dynamic?be:ye)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const e=[];function t(t,n){if(t>n){const e=t;t=n,n=e}const i=e[t];return void 0===i?(e[t]=[n],!0):!i.includes(n)&&(i.push(n),!0)}const n=this.geometry,i=n.index;if(this.parameters.wireframe)if(i){const r=i.array;let s,o=r.length;n.drawRange.count!==1/0&&(o=n.drawRange.count),s=this.wireframeIndex&&this.wireframeIndex.length>2*o?this.wireframeIndex:Ba(2*o,n.attributes.position.count);let a=0;e.length=0;for(let e=0;e<o;e+=3){const n=r[e+0],i=r[e+1],o=r[e+2];t(n,i)&&(s[a+0]=n,s[a+1]=i,a+=2),t(i,o)&&(s[a+0]=i,s[a+1]=o,a+=2),t(o,n)&&(s[a+0]=o,s[a+1]=n,a+=2)}this.wireframeIndex=s,this.wireframeIndexCount=a,this.wireframeIndexVersion=this.indexVersion}else{const e=n.attributes.position.count;let t;t=this.wireframeIndex&&this.wireframeIndex.length>2*e?this.wireframeIndex:Ba(2*e,e);for(let n=0,i=0;n<e;n+=3)t[i+0]=n,t[i+1]=n+1,t[i+2]=n+1,t[i+3]=n+2,t[i+4]=n+2,t[i+5]=n,i+=6;this.wireframeIndex=t,this.wireframeIndexCount=2*e,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new Nn(this.wireframeIndex,1).setUsage(this.dynamic?be:ye));else{const e=this.wireframeGeometry.getIndex();if(!e)return void Yl.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,n=this[e];let i;return i=this.isLine?new Mo(t,n):this.isPoint?new ko(t,n):new hi(t,n),i.frustumCulled=!1,i.renderOrder=this.getRenderOrder(),i}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new Mo(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return Nc(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),"picking"===e?t.PICKING=1:(("background"===e||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=_i.merge([this.uniforms,e]),this.pickingUniforms=_i.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let n;const i=e[t],r=this.attributeSize*Yp[i.type];i.value?(r!==i.value.length&&Yl.error("attribute value has wrong length",t),n=i.value):n=Fa("float32",r),this.geometry.setAttribute(t,new Nn(n,Yp[i.type]).setUsage(this.dynamic?be:ye))}}updateRenderOrder(){const e=this.getRenderOrder();function t(t){t.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(e){const t=e,n=this.parameterTypes,i=this.parameters,r={},s={};let o=!1,a=!1;for(const e in t){const l=t[e];void 0!==l&&(i[e]=l,void 0!==n[e]&&(n[e].property&&(!0!==n[e].property?r[n[e].property]=l:r[e]=l),n[e].uniform&&(!0!==n[e].uniform?s[n[e].uniform]=l:s[e]=l),n[e].updateShader&&(o=!0),n[e].updateVisibility&&(a=!0),this.dynamic&&"wireframe"===e&&!0===l&&this.updateWireframeIndex(),"forceTransparent"===e&&(r.transparent=this.transparent),"matrix"===e&&(this.matrix=l)))}this.setProperties(r),this.setUniforms(s),o&&this.updateShader(),a&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,n=t.attributes;for(const i in e){if("picking"===i)continue;const r=e[i],s=r.length;if("index"===i){const e=t.getIndex();if(!e){Yl.error("Index is null");continue}t.setDrawRange(0,1/0),s>e.array.length?t.setIndex(new Nn(r,1).setUsage(this.dynamic?be:ye)):(e.set(r),e.needsUpdate=s>0,e.updateRange.count=s,t.setDrawRange(0,s)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const e=n[i];s>e.array.length?t.setAttribute(i,new Nn(r,e.itemSize).setUsage(this.dynamic?be:ye)):(n[i].set(r),n[i].needsUpdate=s>0,n[i].updateRange.count=s)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,n=this.wireframeMaterial.uniforms,i=this.pickingMaterial.uniforms;for(let r in e)"opacity"===r&&this.setProperties({transparent:this.transparent}),void 0!==t[r]&&(t[r].value.isVector3?t[r].value.copy(e[r]):t[r].value.set?t[r].value.set(e[r]):t[r].value=e[r]),void 0!==n[r]&&(n[r].value.isVector3?n[r].value.copy(e[r]):n[r].value.set?n[r].value.set(e[r]):n[r].value=e[r]),void 0!==i[r]&&(i[r].value.isVector3?i[r].value.copy(e[r]):i[r].value.set?i[r].value.set(e[r]):i[r].value=e[r])}setProperties(e){if(!e)return;const t=this.material,n=this.wireframeMaterial,i=this.pickingMaterial;for(const r in e){const s=r;let o=e[s];"transparent"===s?this.updateRenderOrder():"side"===s&&(o=Xp(o)),t[s]=o,n[s]=o,i[s]=o}t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)"group"!==t&&"wireframeGroup"!==t&&"pickingGroup"!=t&&"picking"!==t&&(e[t]=this[t]);return e}}class ef extends Jp{constructor(e,t={}){super(e,t),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),void 0===e.normal&&this.geometry.computeVertexNormals()}}class tf extends ef{constructor(){super(...arguments),this.isSurface=!0}}function nf(e){e.visible=!0}function rf(e){e.visible=!1}class sf{constructor(e){this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.matrix=e.matrix;const t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n}set matrix(e){Jp.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),(new ro).add(n,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){"front"===(e=Object.assign({},e)).side?(this.frontMeshes.forEach(nf),this.backMeshes.forEach(rf)):"back"===e.side?(this.frontMeshes.forEach(rf),this.backMeshes.forEach(nf)):"double"===e.side&&(this.frontMeshes.forEach(nf),this.backMeshes.forEach(nf)),void 0!==e.side&&(this.side=e.side),delete e.side,void 0!==e.matrix&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),void 0!==e.wireframe&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}ac.add("shader/Line.vert","uniform float clipNear;\nuniform vec3 clipCenter;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include color_pars_vertex\nvoid main(){\n#include color_vertex\n#include begin_vertex\n#include project_vertex\nvViewPosition = -mvPosition.xyz;\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),ac.add("shader/Line.frag","uniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\ngl_FragColor = vec4( vColor, opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n}");class of extends Jp{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class af extends sh{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof qp?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new ut,this.__boxCenter=new ut,this.box=new pt,this.__box=new pt,this._position=new ut,this.inverseMatrix=new zt,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(e){const t=e||{};t.colorScheme=Aa(t.colorScheme,"uniform"),t.colorValue=Aa(t.colorValue,14540253),this.isolevelType=Aa(t.isolevelType,"sigma"),this.isolevel=Aa(t.isolevel,2),this.negateIsolevel=Aa(t.negateIsolevel,!1),this.isolevelScroll=Aa(t.isolevelScroll,!1),this.smooth=Aa(t.smooth,0),this.background=Aa(t.background,!1),this.opaqueBack=Aa(t.opaqueBack,!0),this.boxSize=Aa(t.boxSize,0),this.colorVolume=Aa(t.colorVolume,void 0),this.contour=Aa(t.contour,!1),this.useWorker=Aa(t.useWorker,!0),this.wrap=Aa(t.wrap,!1),super.init(t),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t="sigma"===this.isolevelType?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=t=>{this.surface=t,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new of(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new tf(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new sf(n)}this.bufferList.push(t)}update(e){if(0===this.bufferList.length)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach((function(e){e.setAttributes(t)}))}setParameters(e,t,n){return e&&void 0!==e.isolevelType&&this.volume&&("value"===this.isolevelType&&"sigma"===e.isolevelType?this.isolevel=this.volume.getSigmaForValue(this.isolevel):"sigma"===this.isolevelType&&"value"===e.isolevelType&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||void 0===e.contour&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),e.matrix&&this.inverseMatrix.copy(e.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&void 0!==e.colorVolume&&t&&(t.color=!0),this.surface&&(void 0!==e.isolevel||void 0!==e.negateIsolevel||void 0!==e.smooth||void 0!==e.wrap||void 0!==e.boxSize||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class lf{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})}static focusScroll(e,t){const n=e.getFocus(),i=Math.sign(t)*function(e){if(e>5)return e;const t=e/5;return(-4.6*t+9.4)*t*t+.2}((100-n)/10);e.setFocus(n+i)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))}static isolevelScroll(e,t){const n=Math.sign(t)/10;e.eachRepresentation(((e,t)=>{if(e.repr instanceof af){const t=e.getParameters();t.isolevelScroll&&e.setParameters({isolevel:t.isolevel+n})}}))}static panDrag(e,t,n){e.trackballControls.pan(t,n)}static rotateDrag(e,t,n){e.trackballControls.rotate(t,n)}static zRotateDrag(e,t,n){e.trackballControls.zRotate(t,n)}static zoomDrag(e,t,n){e.trackballControls.zoom((t+n)/-2)}static zoomFocusDrag(e,t,n){e.trackballControls.zoom((t+n)/-2);const i=e.viewer.camera.position.z;e.setFocus(100-Math.abs(i/8))}static panComponentDrag(e,t,n){e.trackballControls.panComponent(t,n)}static panAtomDrag(e,t,n){e.trackballControls.panAtom(t,n)}static rotateComponentDrag(e,t,n){e.trackballControls.rotateComponent(t,n)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const n=e.tooltip;if(e.getParameters().tooltip&&t){const e=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-e.y+3+"px",n.style.left=e.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const e=t.atom||t.closestBondAtom;t.component.measurePick(e)}else e.measureClear()}}const cf={default:[["scroll",lf.zoomScroll],["scroll-shift",lf.focusScroll],["scroll-ctrl",lf.isolevelScroll],["scroll-shift-ctrl",lf.zoomFocusScroll],["drag-left",lf.rotateDrag],["drag-right",lf.panDrag],["drag-ctrl-left",lf.panDrag],["drag-ctrl-right",lf.zRotateDrag],["drag-shift-left",lf.zoomDrag],["drag-middle",lf.zoomFocusDrag],["drag-ctrl-shift-right",lf.panComponentDrag],["drag-ctrl-shift-left",lf.rotateComponentDrag],["clickPick-right",lf.measurePick],["clickPick-ctrl-left",lf.measurePick],["clickPick-middle",lf.movePick],["clickPick-left",lf.movePick],["hoverPick",lf.tooltipPick]],pymol:[["drag-left",lf.rotateDrag],["drag-middle",lf.panDrag],["drag-right",lf.zoomDrag],["scroll",lf.focusScroll],["drag-shift-right",lf.focusScroll],["clickPick-ctrl+shift-middle",lf.movePick],["hoverPick",lf.tooltipPick]],coot:[["scroll",lf.isolevelScroll],["drag-left",lf.rotateDrag],["drag-middle",lf.panDrag],["drag-ctrl-left",lf.panDrag],["drag-right",lf.zoomFocusDrag],["drag-ctrl-right",lf.focusScroll],["clickPick-middle",lf.movePick],["hoverPick",lf.tooltipPick]],astexviewer:[["drag-left",lf.rotateDrag],["drag-ctrl-left",lf.panDrag],["drag-shift-left",lf.zoomDrag],["scroll",lf.focusScroll],["clickPick-middle",lf.movePick],["hoverPick",lf.tooltipPick]]};function uf(e){const t=e.split(/[-+]/);let n="";t.includes("scroll")&&(n="scroll"),t.includes("drag")&&(n="drag"),t.includes("click")&&(n="click"),t.includes("doubleClick")&&(n="doubleClick"),t.includes("hover")&&(n="hover"),t.includes("clickPick")&&(n="clickPick"),t.includes("hoverPick")&&(n="hoverPick");let i=0;t.includes("alt")&&(i+=1),t.includes("ctrl")&&(i+=2),t.includes("meta")&&(i+=4),t.includes("shift")&&(i+=8);let r=0;return t.includes("left")&&(r+=1),t.includes("right")&&(r+=2),t.includes("middle")&&(r+=4),[n,i,r]}class hf{constructor(e,t={}){this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e,...t){if(this.disabled)return;const n=this.mouse.key||0,i=this.mouse.buttons||0;this.actionList.forEach((r=>{r.type===e&&r.key===n&&r.button===i&&r.callback(this.stage,...t)}))}add(e,t){const[n,i,r]=uf(e);this.actionList.push({type:n,key:i,button:r,callback:t})}remove(e,t){const n=e.includes("*"),[i,r,s]=uf(e),o=this.actionList.filter((function(e){return!((e.type===i||n&&""===i)&&(e.key===r||n&&0===r)&&(e.button===s||n&&0===s)&&(e.callback===t||void 0===t))}));this.actionList=o}preset(e){this.clear(),(cf[e]||[]).forEach((e=>this.add(e[0],e[1])))}clear(){this.actionList.length=0}}class df{static autoView(e){e.autoView(1e3)}static toggleAnimations(e){e.animationControls.toggle()}static toggleRock(e){e.toggleRock()}static toggleSpin(e){e.toggleSpin()}static toggleAntialiasing(e){const t=e.getParameters();e.setParameters({sampleLevel:-1===t.sampleLevel?0:-1})}}const pf={default:[["i",df.toggleSpin],["k",df.toggleRock],["p",df.toggleAnimations],["a",df.toggleAntialiasing],["r",df.autoView]]};class ff{constructor(e,t={}){this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){this.disabled||this.actionList.forEach((t=>{t.key===e&&t.callback(this.stage)}))}add(e,t){this.actionList.push({key:e,callback:t})}remove(e,t){const n=this.actionList.filter((function(n){return!(n.key===e&&(n.callback===t||void 0===t))}));this.actionList=n}preset(e){this.clear(),(pf[e]||[]).forEach((e=>this.add(e[0],e[1])))}clear(){this.actionList.length=0}}class mf{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(e,t){const n=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)}_onHover(e,t){const n=this.stage.pickingControls.pick(e,t);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class gf{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(e){this.controls.run("scroll",e)}_onDrag(e,t){this.controls.run("drag",e,t)}_onClick(e,t){this.controls.run("click",e,t)}_onDblclick(e,t){this.controls.run("doubleClick",e,t)}_onHover(e,t){this.controls.run("hover",e,t)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class _f{constructor(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(e){this.animationControls.run(e)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const vf=!!$l&&{passive:!0};class yf{constructor(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,vf),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(e){let t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,vf),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class bf{constructor(e,t,n,i={}){this.component=e,this.position=t,this.offsetX=Aa(i.offsetX,0),this.offsetY=Aa(i.offsetY,0),this.visible=Aa(i.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new ut,this._updateViewerPosition(),this._canvasPosition=new Ne,this._cameraPosition=new ut,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if("none"===t&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const t=document.createElement("div");t.innerText=e,Object.assign(t.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(t)}this._clientRect=this.element.getBoundingClientRect(),"none"===t&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,i=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const r=this._cameraPosition.length(),s=this.viewer.scene.fog;e.opacity=(1-el(s.near,s.far,r)).toString(),e.zIndex=Math.round(100*(s.far-r)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+i.height/2+"px",e.left=this.offsetY+t.x-i.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const xf=new zt,wf=new ut,Sf=new ct;class Af{constructor(e){this.component=e,this.signals={changed:new va.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){xf.copy(this.viewer.rotationGroup.matrix).invert(),wf.copy(Va(e)).applyMatrix4(xf),xf.extractRotation(this.component.transform),xf.premultiply(this.viewer.rotationGroup.matrix),xf.invert(),wf.copy(Va(e)),wf.applyMatrix4(xf),xf.makeRotationAxis(wf,t),Sf.setFromRotationMatrix(xf),this.component.quaternion.premultiply(Sf),this.changed()}}const Mf={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class Cf{constructor(e={}){this.max=10,this.type=Aa(e.type,"size"),this.scale=Aa(e.scale,1),this.size=Aa(e.size,1),this.data=Aa(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const n=e.sstruc;t="h"===n||"g"===n||"i"===n||"e"===n||"b"===n?.25:Id.includes(e.atomname)?.4:.1;break;case"data":t=Aa(this.data[e.index],1);break;case"explicit":t=e.radius,null===t&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}Cf.types=Mf;const Tf=new ut(-1,-1,-1),Ef=new zt;class Pf{constructor(e){const t=e.rows,n=t/3,i=new Ap(t,3),r=new Ap(3,3),s=new Ap(1,3),o=new Ap(3,3),a=new Ap(3,3),l=Ep(e);Pp(e,l),Mp(i,e),Cp(r,i,i),Rp(r,s,o,a);const c=new ut(l[0],l[1],l[2]),u=new ut(o.data[0],o.data[3],o.data[6]),h=new ut(o.data[1],o.data[4],o.data[7]),d=new ut(o.data[2],o.data[5],o.data[8]),p=u.clone().multiplyScalar(Math.sqrt(s.data[0]/n)),f=h.clone().multiplyScalar(Math.sqrt(s.data[1]/n)),m=d.clone().multiplyScalar(Math.sqrt(s.data[2]/n));this.begA=c.clone().sub(p),this.endA=c.clone().add(p),this.begB=c.clone().sub(f),this.endB=c.clone().add(f),this.begC=c.clone().sub(m),this.endC=c.clone().add(m),this.center=c,this.vecA=p,this.vecB=f,this.vecC=m,this.normVecA=u,this.normVecB=h,this.normVecC=d}getBasisMatrix(e=new zt){const t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(Tf),t}getRotationQuaternion(e=new ct){const t=e;return t.setFromRotationMatrix(this.getBasisMatrix(Ef)),t.invert()}getProjectedScaleForAtoms(e){let t=-1/0,n=-1/0,i=-1/0,r=-1/0,s=-1/0,o=-1/0;const a=new ut,l=new ut,c=this.center,u=this.normVecA,h=this.normVecB,d=this.normVecC;return e.eachAtom((function(e){ch(a.copy(e),u,c);const p=l.subVectors(a,c).normalize().dot(u),f=a.distanceTo(c);p>0?f>t&&(t=f):f>n&&(n=f),ch(a.copy(e),h,c);const m=l.subVectors(a,c).normalize().dot(h),g=a.distanceTo(c);m>0?g>i&&(i=g):g>r&&(r=g),ch(a.copy(e),d,c);const _=l.subVectors(a,c).normalize().dot(d),v=a.distanceTo(c);_>0?v>s&&(s=v):v>o&&(o=v)})),{d1a:t,d2a:i,d3a:s,d1b:-n,d2b:-r,d3b:-o}}}class If{constructor(e,t,n,i){this.volume=e,this.setFilter(t,n,i)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,n){return JSON.stringify([e,t,n])}setFilter(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=void 0===e||isNaN(e)?-1/0:e,t=Aa(t,1/0),n=Aa(n,!1);const i=this.volume.data,r=this.volume.position,s=this.volume.atomindex,o=this._getFilterHash(e,t,n);if(o!==this._filterHash){if(e===-1/0&&t===1/0)this.data=i,this.position=r,this.atomindex=s;else{const o=i.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*o),this._positionBuffer=new ArrayBuffer(3*o*4),s&&(this._atomindexBuffer=new ArrayBuffer(4*o)));const a=new Float32Array(this._dataBuffer),l=new Float32Array(this._positionBuffer);let c;s&&(c=new Uint32Array(this._atomindexBuffer));let u=0;for(let h=0;h<o;++h){const o=3*h,d=i[h];if(!n&&d>=e&&d<=t||n&&(d<e||d>t)){const e=3*u;a[u]=d,l[e+0]=r[o+0],l[e+1]=r[o+1],l[e+2]=r[o+2],s&&c&&(c[u]=s[h]),u+=1}}this.data=new Float32Array(this._dataBuffer,0,u),this.position=new Float32Array(this._positionBuffer,0,3*u),s&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,u))}this._filterHash=o}}}If.prototype.getValueForSigma=qp.prototype.getValueForSigma,If.prototype.getSigmaForValue=qp.prototype.getSigmaForValue,If.prototype.getDataAtomindex=qp.prototype.getDataAtomindex,If.prototype.getDataPosition=qp.prototype.getDataPosition,If.prototype.getDataColor=qp.prototype.getDataColor,If.prototype.getDataPicking=qp.prototype.getDataPicking,If.prototype.getDataSize=qp.prototype.getDataSize;class kf{constructor(e,t){const n=ed({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class Rf extends Kh{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,n){this.growIfFull();const i=this.count,r=e.index,s=t.index;r<s?(this.atomIndex1[i]=r,this.atomIndex2[i]=s):(this.atomIndex2[i]=r,this.atomIndex1[i]=s),n&&(this.bondOrder[i]=n),this.count+=1}addBondIfConnected(e,t,n){return!!e.connectedTo(t)&&(this.addBond(e,t,n),!0)}}class Df extends Kh{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class Lf extends Kh{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class Of extends Kh{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const n=4*e;this.chainname[n]=t.charCodeAt(0),this.chainname[n+1]=t.charCodeAt(1),this.chainname[n+2]=t.charCodeAt(2),this.chainname[n+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let n=0;n<4;++n){const i=this.chainname[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}setChainid(e,t){const n=4*e;this.chainid[n]=t.charCodeAt(0),this.chainid[n+1]=t.charCodeAt(1),this.chainid[n+2]=t.charCodeAt(2),this.chainid[n+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let n=0;n<4;++n){const i=this.chainid[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}}class Nf extends Kh{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class Ff{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(e=0){const t=this.getPosition().center,n=t.length/3;let i=0,r=-1;const s=[new ut,new ut,new ut,new ut];return{size:n,next:function(){const e=this.get(r);return r+=1,e},get:function(r){r=Math.min(n-1,Math.max(0,r));const o=s[i%4],a=3*r;if(o.fromArray(t,a),e){const i=Math.min(e,r,n-r-1);for(let e=1;e<=i;++e){const n=3*e,r=(i+1-e)/(i+1);o.x+=r*t[a-n+0]+r*t[a+n+0],o.y+=r*t[a-n+1]+r*t[a+n+1],o.z+=r*t[a-n+2]+r*t[a+n+2]}o.x/=i+1,o.y/=i+1,o.z/=i+1}return i+=1,o},reset:function(){i=0,r=-1}}}getColor(e){const t=this.polymer,n=t.structure,i=t.residueCount,r=t.residueIndexStart,s=new Float32Array(3*i),o=e||{};o.structure=n;const a=ic.getScheme(o),l=n.getResidueProxy(),c=n.getAtomProxy();for(let e=0;e<i;++e)l.index=r+e,c.index=l.traceAtomIndex,a.atomColorToArray(c,s,3*e);return{color:s}}getPicking(){const e=this.polymer,t=e.structure,n=e.residueCount,i=e.residueIndexStart,r=new Float32Array(n),s=t.getResidueProxy();for(let e=0;e<n;++e)s.index=i+e,r[e]=s.traceAtomIndex;return{picking:new cp(r,t)}}getSize(e){const t=this.polymer,n=t.structure,i=t.residueCount,r=t.residueIndexStart,s=new Float32Array(i),o=new Cf(e),a=n.getResidueProxy(),l=n.getAtomProxy();for(let e=0;e<i;++e)a.index=r+e,l.index=a.traceAtomIndex,s[e]=o.atomRadius(l);return{size:s}}getPosition(){const e=this.polymer,t=e.structure,n=e.residueCount,i=n-3,r=new Float32Array(3*n),s=new Float32Array(3*n),o=new Float32Array(n),a=new Float32Array(n),l=new Float32Array(n),c=new Float32Array(n),u=new Float32Array(3*n),h=new ut,d=new ut,p=new ut,f=new ut,m=new ut,g=new ut,_=new ut,v=new ut,y=new ut,b=new ut,x=new ut,w=new ut(0,0,0),S="trace",A=t.getAtomProxy(),M=t.getAtomProxy(e.getAtomIndexByType(0,S)),C=t.getAtomProxy(e.getAtomIndexByType(1,S)),T=t.getAtomProxy(e.getAtomIndexByType(2,S));for(let t=0;t<i;++t){A.index=M.index,M.index=C.index,C.index=T.index,T.index=e.getAtomIndexByType(t+3,S);const n=3*t;h.subVectors(M,A),d.subVectors(C,M),p.subVectors(T,C),f.subVectors(h,d),m.subVectors(d,p),y.crossVectors(f,m).normalize(),y.toArray(s,n),t>0&&(o[t]=y.angleTo(b));const i=Math.cos(f.angleTo(m));c[t]=180/Math.PI*Math.acos(i);const v=f.length(),E=m.length();a[t]=Math.sqrt(E*v)/Math.max(2,2*(1-i)),l[t]=Math.abs(d.dot(y)),g.copy(f).multiplyScalar(a[t]/v),_.copy(m).multiplyScalar(a[t]/E),g.subVectors(M,g),_.subVectors(C,_),g.toArray(r,n+3),_.toArray(r,n+6),x.subVectors(A,w),x.toArray(u,n),b.copy(y),w.copy(g)}g.fromArray(r,3),_.fromArray(r,6),y.subVectors(g,_).normalize(),A.index=e.getAtomIndexByType(0,S),w.copy(A),v.copy(A),ch(v,y,g),v.toArray(r,0),x.subVectors(w,g),x.toArray(u,0),g.fromArray(r,3*n-6),_.fromArray(r,3*n-9),y.subVectors(g,_).normalize(),A.index=e.getAtomIndexByType(n-1,S),w.copy(A),v.copy(A),ch(v,y,g),v.toArray(r,3*n-3);for(let t=n-3;t<n;++t)g.fromArray(r,3*t),A.index=e.getAtomIndexByType(t,S),w.copy(A),x.subVectors(w,g),x.toArray(u,3*t);const E=new Float32Array(n),P=new Float32Array(n),I=new Float32Array(n),k=new Float32Array(n);E[1]=a[0],P[1]=c[0],I[1]=a[0];for(let e=2;e<n-2;++e)E[e]=.5*(a[e-2]+a[e-1]),P[e]=.5*(c[e-2]+c[e-1]),I[e]=.5*(l[e-2]+l[e-1]),g.fromArray(s,3*(e-2)),_.fromArray(s,3*(e-1)),k[e]=180/Math.PI*Math.acos(Math.cos(g.angleTo(_)));E[n-2]=a[n-4],P[n-2]=c[n-4],I[n-2]=l[n-4];const R=new Float32Array(3*n);Yc(s,R,0,0,3),Yc(s,R,0,3,3);for(let e=2;e<n-2;++e)g.fromArray(s,3*(e-2)),_.fromArray(s,3*(e-1)),y.addVectors(_,g).multiplyScalar(.5).normalize(),y.toArray(R,3*e);return Yc(s,R,3*n-12,3*n-6,3),Yc(s,R,3*n-12,3*n-3,3),{center:r,axis:R,bending:k,radius:E,rise:I,twist:P,resdir:u}}}class Bf{constructor(e){this.polymer=e,this.helixorient=new Ff(e),this.position=this.helixorient.getPosition()}getAxis(e,t,n,i,r){e=e||30,t=t||2.5,n=void 0!==n&&n;const s=this.polymer,o=s.structure,a=s.residueCount,l=s.residueIndexStart,c=this.position,u=i||{};u.structure=o;const h=ic.getScheme(u),d=new Cf(r);let p=0,f=0;const m=[],g=[],_=[],v=[],y=[],b=[],x=[],w=[],S=[];let A,M,C=new Float32Array(3*a),T=new Float32Array(3*a);const E=new ut,P=new ut,I=o.getResidueProxy(),k=o.getResidueProxy(),R=o.getAtomProxy(),D=new ut,L=new ut;let O=!1;for(let i=0;i<a;++i)if(I.index=l+i,D.fromArray(c.center,3*i),i===a-1?O=!0:(k.index=l+i+1,L.fromArray(c.center,3*i+3),(n&&I.sstruc!==k.sstruc||D.distanceTo(L)>t||c.bending[i]>e)&&(O=!0)),O){if(i-p<4){p=i,O=!1;continue}R.index=I.traceAtomIndex,C=c.axis.subarray(3*p+3,3*i),T=c.center.subarray(3*p,3*i+3),A=lh(C).normalize(),M=lh(T),E.fromArray(T),ch(E,A,M),P.fromArray(T,T.length-3),ch(P,A,M),A.subVectors(P,E),A.toArray(m,f),M.toArray(g,f),E.toArray(_,f),P.toArray(v,f),h.atomColorToArray(R,y,f),b.push(R.index),x.push(d.atomRadius(R)),w.push(l+p),S.push(l+i+1-p),f+=3,p=i,O=!1}const N=new Float32Array(b);return{axis:new Float32Array(m),center:new Float32Array(g),begin:new Float32Array(_),end:new Float32Array(v),color:new Float32Array(y),picking:new cp(N,o),size:new Float32Array(x),residueOffset:w,residueCount:S}}}class Uf{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let n=0;n<t;n++)if(this.content[n]===e){const i=this.content.pop();return void(i&&n!==t-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const n=Math.floor((e+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[n]=t,this.content[e]=i,e=n}}sinkDown(e){const t=this.content.length,n=this.content[e],i=this.scoreFunction(n);let r=0,s=0;for(;;){const o=2*(e+1),a=o-1;let l=null;if(a<t){const e=this.content[a];r=this.scoreFunction(e),r<i&&(l=a)}if(o<t){const e=this.content[o];s=this.scoreFunction(e),s<(null===l?i:r)&&(l=o)}if(null===l)break;this.content[e]=this.content[l],this.content[l]=n,e=l}}}class zf{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const n=e.length/3,i=new Uint32Array(n);for(let e=0;e<n;++e)i[e]=e;this.indices=i,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(e,t,n,i){e>this.maxDepth&&(this.maxDepth=e);const r=i-n;if(0===r)return-1;const s=4*this.currentNode,o=this.nodes;if(this.currentNode+=1,1===r)return o[s]=n,o[s+1]=-1,o[s+2]=-1,o[s+3]=t,s;const a=this.indices,l=this.points,c=n+Math.floor(r/2),u=e%3;let h,d,p,f,m,g=n,_=i-1;for(;_>g;){for(p=g+_>>1,f=l[3*a[p]+u],d=a[p],a[p]=a[_],a[_]=d,m=g,h=g;h<_;++h)l[3*a[h]+u]<f&&(d=a[m],a[m]=a[h],a[h]=d,++m);if(d=a[_],a[_]=a[m],a[m]=d,p=m,c===p)break;c<p?_=p-1:g=p+1}return o[s]=c,o[s+1]=this.buildTree(e+1,s,n,c),o[s+2]=this.buildTree(e+1,s,c+1,i),o[s+3]=t,s}getNodeDepth(e){const t=this.nodes[e+3];return-1===t?0:this.getNodeDepth(t)+1}nearest(e,t,n){const i=new Uf((e=>-e[1])),r=this.nodes,s=this.points,o=this.indices,a=l=>{let c,u;const h=this.getNodeDepth(l)%3,d=3*o[r[l]],p=[s[d+0],s[d+1],s[d+2]],f=this.metric(e,p);function m(e,n){i.push([e,n]),i.size()>t&&i.pop()}const g=r[l+1],_=r[l+2];if(-1===_&&-1===g)return void((i.size()<t||f<i.peek()[1])&&f<=n&&m(l,f));c=-1===_?g:-1===g?_:e[h]<=s[d+h]?g:_,a(c),(i.size()<t||f<i.peek()[1])&&f<=n&&m(l,f);const v=[];for(let t=0;t<3;t+=1)v[t]=t===h?e[t]:s[d+t];const y=this.metric(v,p);(i.size()<t||Math.abs(y)<i.peek()[1])&&Math.abs(y)<=n&&(u=c===g?_:g,-1!==u&&a(u))};a(this.rootIndex);const l=[];for(let e=0,n=Math.min(i.size(),t);e<n;e+=1)l.push(i.content[e]);return l}verify(e,t=0){let n=1;if(void 0===e&&(e=this.rootIndex),-1===e)throw new Error("node is null");const i=t%3,r=this.nodes,s=this.points,o=this.indices,a=r[e+1],l=r[e+2];if(-1!==a){if(s[3*o[r[a]]+i]>s[3*o[r[e]]+i])throw new Error("left child is > parent!");n+=this.verify(a,t+1)}if(-1!==l){if(s[3*o[r[l]]+i]<s[3*o[r[e]]+i])throw new Error("right child is < parent!");n+=this.verify(l,t+1)}return n}}class Vf{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const n=this.index,i=this.bondHash,r=i.indexArray,s=i.countArray[n],o=i.offsetArray[n];for(let n=0;n<s;++n)t.index=r[o+n],e(t)}eachBondedAtom(e,t){const n=t||this.structure._ap,i=this.index;this.eachBond((function(t){n.index=i!==t.atomIndex1?t.atomIndex1:t.atomIndex2,e(n)})),this.index=i}hasBondTo(e){let t=!1;return this.eachBondedAtom((function(n){e.index===n.index&&(t=!0)})),t}bondToElementCount(e){let t=0;const n=this.index;return this.eachBondedAtom((function(n){n.number===e&&(t+=1)})),this.index=n,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return 3===e||4===e||5===e}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return 4===e||5===e||6===e}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return 1===this.residueType.hetero}isProtein(){return 3===this.residueType.moleculeType}isNucleic(){const e=this.residueType.moleculeType;return 4===e||5===e}isRna(){return 4===this.residueType.moleculeType}isDna(){return 5===this.residueType.moleculeType}isWater(){return 1===this.residueType.moleculeType}isIon(){return 2===this.residueType.moleculeType}isSaccharide(){return 6===this.residueType.moleculeType}isHelix(){return ud.includes(this.sstruc)}isSheet(){return hd.includes(this.sstruc)}isTurn(){return dd.includes(this.sstruc)&&this.isProtein()}isBonded(){return 0!==this.bondHash.countArray[this.index]}isRing(){return void 0!==this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]}isAromatic(){return 1===this.aromatic}isPolarHydrogen(){let e=!1;return 1!==this.number||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,r=e.index,s=t.x[i]-n.x[r],o=t.y[i]-n.y[r],a=t.z[i]-n.z[r],l=s*s+o*o+a*a;return Math.sqrt(l)}connectedTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,r=e.index;if(t.altloc&&n.altloc){const e=t.altloc[i],s=n.altloc[r];if(0!==e&&0!==s&&32!==e&&32!==s&&e!==s)return!1}const s=t.x[i]-n.x[r],o=t.y[i]-n.y[r],a=t.z[i]-n.z[r],l=s*s+o*o+a*a;if(l<48&&this.isCg())return!0;if(isNaN(l))return!1;const c=this.covalent+e.covalent,u=c+.3,h=c-.5;return l<u*u&&l>h*h}positionFromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(e=[],t=0){const n=this.index,i=this.atomStore;return e[t+0]=i.x[n],e[t+1]=i.y[n],e[t+2]=i.z[n],e}positionToVector3(e){return void 0===e&&(e=new ut),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(e=!1){const t=this.residueAtomOffset,n=this.index-this.residueAtomOffset,i=this.residueType.getBonds(),r=i.atomIndices1,s=i.atomIndices2;let o,a,l,c;for(e||(c=[]),o=r.indexOf(n);-1!==o;){if(l=s[o]+t,!c)return l;c.push(l),o=r.indexOf(n,o+1)}for(a=s.indexOf(n);-1!==a;){if(l=r[a]+t,!c)return l;c.push(l),a=s.indexOf(n,a+1)}return c}qualifiedName(e=!1){var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),void 0!==this.resno&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new Vf(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function Hf(e,t){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function $f(e,t){return Math.sqrt(Hf(e,t))}const Gf=new Float32Array(3);class jf{constructor(e,t=!1){Ql&&Yl.time("Kdtree build");const n=t?Hf:$f,i=new Float32Array(3*e.atomCount),r=new Uint32Array(e.atomCount);let s=0;e.eachAtom((function(e){i[s+0]=e.x,i[s+1]=e.y,i[s+2]=e.z,r[s/3]=e.index,s+=3})),this.atomIndices=r,this.points=i,this.kdtree=new zf(i,n),Ql&&Yl.timeEnd("Kdtree build")}nearest(e,t,n){e instanceof ut?e.toArray(Gf):e instanceof Vf&&e.positionToArray(Gf);const i=this.kdtree.nearest(Gf,t,n),r=this.kdtree.indices,s=this.kdtree.nodes,o=this.atomIndices,a=[];for(let e=0,t=i.length;e<t;++e){const t=i[e],n=t[0],l=t[1];a.push({index:o[r[s[n]]],distance:l})}return a}}const Wf={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},qf={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},Xf=/^[1-9]$/;function Yf(e){let t="";return e.length>0&&(t=":"+Oa(e).join(" OR :")),new Ll(t)}class Kf{constructor(e=""){this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const n=new Zf(e,t);return this.partList.push(n),n}getAtomCount(e){return this.partList.reduce(((t,n)=>t+n.getAtomCount(e)),0)}getResidueCount(e){return this.partList.reduce(((t,n)=>t+n.getResidueCount(e)),0)}getInstanceCount(){let e=0;return this.partList.forEach((function(t){e+=t.matrixList.length})),e}isIdentity(e){if(1!==this.partList.length)return!1;const t=this.partList[0];if(1!==t.matrixList.length)return!1;if(!(new zt).equals(t.matrixList[0]))return!1;let n=[];return e.eachChain((function(e){n.push(e.chainname)})),n=Oa(n),t.chainList.length===n.length}getBoundingBox(e){const t=new pt;return this.partList.forEach((function(n){const i=n.getBoundingBox(e);t.expandByPoint(i.min),t.expandByPoint(i.max)})),t}getCenter(e){return this.getBoundingBox(e).getCenter(new ut)}getSelection(){let e=[];return this.partList.forEach((function(t){e=e.concat(t.chainList)})),Yf(e)}}class Zf{constructor(e=[],t=[]){this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let n=0;return e.eachChain((e=>{(0===this.chainList.length||this.chainList.includes(e.chainname))&&(n+=e[t])})),this.matrixList.length*n}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new pt,n=new pt,i=this.getSelection(),r=e.getBoundingBox(i);return this.matrixList.forEach((function(e){n.copy(r).applyMatrix4(e),t.expandByPoint(n.min),t.expandByPoint(n.max)})),t}getSelection(){return Yf(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class Qf{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){var t,n;const i=this.structure.atomStore,r=this.structure.residueStore,s=this.structure.residueMap,o=null===(t=this.structure.chemCompMap)||void 0===t?void 0:t.dict[this.previousResname],a=r.atomCount[e],l=r.atomOffset[e],c=new Array(a);for(let e=0;e<a;++e)c[e]=i.atomTypeId[l+e];const u=null==o?void 0:o.chemCompType,h=o?null===(n=this.structure.chemCompMap)||void 0===n?void 0:n.getBonds(this.previousResname,c):void 0;r.residueTypeId[e]=s.add(this.previousResname,c,this.previousHetero,u,h)}addAtom(e,t,n,i,r,s,o,a){const l=this.structure.atomStore,c=this.structure.residueStore,u=this.structure.chainStore,h=this.structure.modelStore;let d=!1,p=!1,f=!1;this.currentModelindex!==e?(d=!0,p=!0,f=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(p=!0,f=!0,this.ci+=1,this.ri+=1):this.currentResno===r&&this.currentResname===i&&this.currentInscode===a||(f=!0,this.ri+=1),this.ai+=1,d&&(h.growIfFull(),h.chainOffset[this.mi]=this.ci,h.chainCount[this.mi]=0,h.count+=1,u.modelIndex[this.ci]=this.mi),p&&(u.growIfFull(),u.setChainname(this.ci,t),u.setChainid(this.ci,n),u.residueOffset[this.ci]=this.ri,u.residueCount[this.ci]=0,u.count+=1,u.modelIndex[this.ci]=this.mi,h.chainCount[this.mi]+=1,c.chainIndex[this.ri]=this.ci),f&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),c.growIfFull(),c.resno[this.ri]=r,void 0!==o&&(c.sstruc[this.ri]=o.charCodeAt(0)),void 0!==a&&(c.inscode[this.ri]=a.charCodeAt(0)),c.atomOffset[this.ri]=this.ai,c.atomCount[this.ri]=0,c.count+=1,c.chainIndex[this.ri]=this.ci,u.residueCount[this.ci]+=1),l.count+=1,l.residueIndex[this.ai]=this.ri,c.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=i,this.currentResno=r,this.currentInscode=a,this.currentHetero=s}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function Jf(e,t){if(!t)return;Ql&&Yl.time("assignSecondaryStructure");const n=[];e.eachModel((function(e){e.eachChain((function(e){n.push(e.chainname)}))}));const i=n.slice().sort(),r=[];i.forEach((function(e){r.push(n.indexOf(e))}));const s=t.helices.filter((function(e){return Da(i,e[0])>=0}));s.sort((function(e,t){const n=e[0],s=t[0],o=e[1],a=t[1];if(n===s)return o===a?0:o<a?-1:1;{const e=Da(i,n),t=Da(i,s);return r[e]<r[t]?-1:1}}));const o=e.residueStore;e.eachModel((function(e){let t=0;const n=s.length;if(0===n)return;let i=s[t],r=!1,a=!1;e.eachChain((function(e){let l=!1;if(e.chainname===i[0]){const c=e.residueCount,u=e.residueOffset,h=u+c;for(let c=u;c<h;++c)if(o.resno[c]===i[1]&&o.getInscode(c)===i[2]&&(r=!0),r&&(o.sstruc[c]=i[6],o.resno[c]===i[4]&&o.getInscode(c)===i[5]&&(r=!1,t+=1,t<n?(c=u-1,i=s[t],l=e.chainname!==i[0]):a=!0)),l||a)return}}))}));const a=t.sheets.filter((function(e){return Da(i,e[0])>=0}));a.sort((function(e,t){const n=e[0],s=t[0];if(n===s)return 0;const o=Da(i,n),a=Da(i,s);return r[o]<r[a]?-1:1}));const l="e".charCodeAt(0);e.eachModel((function(e){let t=0;const n=a.length;if(0===n)return;let i=a[t],r=!1,s=!1;e.eachChain((function(e){let c=!1;if(e.chainname===i[0]){const u=e.residueCount,h=e.residueOffset,d=h+u;for(let u=h;u<d;++u)if(o.resno[u]===i[1]&&o.getInscode(u)===i[2]&&(r=!0),r&&(o.sstruc[u]=l,o.resno[u]===i[4]&&o.getInscode(u)===i[5]&&(r=!1,t+=1,t<n?(u=h-1,i=a[t],c=e.chainname!==i[0]):s=!0)),c||s)return}}))})),Ql&&Yl.timeEnd("assignSecondaryStructure")}const em=function(){const e=function(e,t,n,i){const r=e.structure,s=e.residueIndexStart,o=r.getResidueProxy(),a=r.getResidueProxy(),l=r.getAtomProxy(),c=r.getAtomProxy();for(let r=Math.max(0,t-2);r<=t;++r)for(let t=2;t<5;++t){if(r+t>=e.residueCount)continue;o.index=s+r,a.index=s+r+t,l.index=o.traceAtomIndex,c.index=a.traceAtomIndex;const u=l.distanceTo(c);if(Math.abs(u-n[t-2])>i)return!1}return!0},t=function(t,n){return e(t,n,[5.45,5.18,6.37],2.1)},n=function(t,n){return e(t,n,[6.1,10.4,13],1.42)};return function(e){Ql&&Yl.time("calculateSecondaryStructure"),e.eachPolymer((function(e){if(e.residueCount<4)return;if(e.isCg())!function(e){const t=e.residueStore,n=e.residueIndexStart,i=new Bf(e).position,r=new ut,s=new ut;for(let o=0,a=e.residueCount;o<a;++o){r.fromArray(i.center,3*o),s.fromArray(i.center,3*o+3);const e=r.distanceTo(s);e<2&&e>1&&i.bending[o]<20&&(t.sstruc[n+o]="h".charCodeAt(0),t.sstruc[n+o+1]="h".charCodeAt(0))}}(e);else{if(!e.isProtein())return;!function(e){const i=e.residueStore,r=e.residueIndexStart;for(let s=0,o=e.residueCount;s<o;++s){let o="c";t(e,s)?o="h":n(e,s)&&(o="e"),i.sstruc[r+s]=o.charCodeAt(0)}}(e)}let i,r=0;e.eachResidue((function(e){e.sstruc===i?r+=1:(1===r&&(e.index-=1,e.sstruc="c"),r=1,i=e.sstruc)}))})),Ql&&Yl.timeEnd("calculateSecondaryStructure")}}(),tm="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function nm(e){let t=e,n=0,i=tm[t%26];for(;t>=26;)t=Math.floor(t/26),i+=tm[t%26],n+=1;return n>=5&&Yl.warn("chainname overflow"),i}function im(e,t=!1){Ql&&Yl.time("calculateChainnames");let n=!0;if(e.eachChain((function(e){e.chainname&&(n=!1)})),n){const n=e.modelStore,i=e.chainStore,r=e.residueStore,s=function(e,t,s,o){const a=i.count;for(let e=0;e<o;++e)r.chainIndex[s+e]=a;i.growIfFull(),i.modelIndex[a]=e,i.setChainname(a,t),i.setChainid(a,t),i.residueOffset[a]=s,i.residueCount[a]=o,i.count+=1,n.chainCount[e]+=1},o=e.getAtomProxy(),a=e.getAtomProxy();let l=0,c=0,u=0,h=0;const d=[];1===r.count?d.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):e.eachResidueN(2,(function(e,n){let i=!1;const s=e.backboneType,p=n.backboneType,f=rd;h=e.index,e.modelIndex!==n.modelIndex||e.moleculeType!==n.moleculeType?i=!0:s!==f&&s===p&&(o.index=e.backboneEndAtomIndex,a.index=n.backboneStartAtomIndex,i=t?!o.hasBondTo(a):!o.connectedTo(a)),i||n.index!==r.count-1||(i=!0,h=n.index),i&&(d.push({mIndex:c,chainname:nm(l),rStart:u,rCount:h-u+1}),l+=1,e.modelIndex!==n.modelIndex&&(l=0,c+=1),n.index===r.count-1&&h!==n.index&&d.push({mIndex:c,chainname:nm(l),rStart:r.count-1,rCount:1}),u=n.index,h=n.index)})),i.count=0,n.chainCount.fill(0,0,n.count),n.chainOffset.fill(0,0,n.count),d.forEach((function(e){s(e.mIndex,e.chainname,e.rStart,e.rCount)}));let p=0;e.eachModel((function(e){n.chainOffset[e.index]=p,p+=n.chainCount[e.index]}))}Ql&&Yl.timeEnd("calculateChainnames")}function rm(e,t="all"){"none"!==t&&(Ql&&Yl.time("calculateBonds"),am(e,!1,t),lm(e),Ql&&Yl.timeEnd("calculateBonds"))}const sm={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function om(e,t,n){return[t,n]=t<n?[t,n]:[n,t],xd.includes(e)&&"C"===t&&"O"===n||Md.includes(e)&&"OP1"===t&&"P"===n?2:sm[`${e}|${t}|${n}`]||1}function am(e,t=!1,n="all"){Ql&&Yl.time("calculateBondsWithin");const i=e.bondStore,r=e.rungBondStore,s=e.getAtomSet(!1),o=e.getAtomProxy(),a=e.getAtomProxy(),l=e.getBondProxy(),c=t?null:function(e){Ql&&Yl.time("calculateAtomBondMap");var t=[];return e.eachBond((function(e){var n=e.atomIndex1,i=e.atomIndex2;void 0===t[n]&&(t[n]=[]),t[n][i]=e.index})),Ql&&Yl.timeEnd("calculateAtomBondMap"),t}(e);let u;t||"auto"!==n||(u=new Set,c.forEach(((e,t)=>{u.add(t),e.forEach((e=>{u.add(e)}))}))),e.eachResidue((function(e){if(!t&&c){const t=e.atomCount,r=e.atomOffset;if(t>500)return void Yl.warn("more than 500 atoms, skip residue for auto-bonding",e.qualifiedName());if("auto"===n&&e.hetero)for(let t=e.atomOffset;t<e.atomEnd;t++)if(u.has(t))return;const s=e.getBonds(),h=s.atomIndices1,d=s.atomIndices2,p=s.bondOrders,f=h.length;for(let t=0;t<f;++t){const n=h[t],s=d[t],u=n+r,f=s+r,m=c[u];void 0!==m&&void 0!==m[f]?(l.index=m[f],p[e.residueType.getBondIndex(n,s)]=l.bondOrder):(o.index=u,a.index=f,i.addBond(o,a,p[t]))}}const h=e.residueType.traceAtomIndex,d=e.residueType.rungEndAtomIndex;-1!==h&&-1!==d&&(o.index=e.traceAtomIndex,a.index=e.rungEndAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))})),e.atomSetDict.rung=s,Ql&&Yl.timeEnd("calculateBondsWithin")}function lm(e,t=!1,n=!1){Ql&&Yl.time("calculateBondsBetween");const i=e.bondStore,r=e.backboneBondStore,s=e.getAtomSet(!1),o=e.getAtomProxy(),a=e.getAtomProxy();function l(e,l){const c=e.backboneType,u=l.backboneType;if(c!==rd&&c===u){o.index=e.backboneEndAtomIndex,a.index=l.backboneStartAtomIndex;let c=!1,u=!1;n&&o.hasBondTo(a)?(c=!1,u=!0):o.connectedTo(a)&&(c=!t,u=!0),c&&i.addBond(o,a,1),u&&(o.index=e.traceAtomIndex,a.index=l.traceAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))}}0===r.count&&r.resize(e.residueStore.count),e.eachResidueN(2,l);const c=e.getResidueProxy(),u=e.getResidueProxy();if(e.eachChain((function(e){0!==e.residueCount&&(c.index=e.residueOffset,u.index=e.residueOffset+e.residueCount-1,l(u,c))})),e.atomSetDict.backbone=s,!t){Ql&&Yl.time("calculateBondsBetween inter");const t=e.spatialHash;e.eachResidue((function(e){e.backboneType!==rd||e.isWater()||e.eachAtom((function(e){e.isMetal()||t.eachWithin(e.x,e.y,e.z,4,(function(t){a.index=t,e.modelIndex!==a.modelIndex||e.residueIndex===a.residueIndex||a.isMetal()||i.addBondIfConnected(e,a,1)}))}))})),Ql&&Yl.timeEnd("calculateBondsBetween inter")}Ql&&Yl.timeEnd("calculateBondsBetween")}function cm(e){if(!e.unitcell)return;Ql&&Yl.time("buildUnitcellAssembly");const t=e.unitcell,n=e.center.clone().applyMatrix4(t.cartToFrac),i=n.clone().floor(),r=function(e){const t=qf[e],n={};if(void 0===t)return console.warn(`spacegroup '${e}' not found in symop library`),n;const i=[];for(let e=0,n=t.length;e<n;e+=3){const n=[];for(let i=0;i<3;++i)n.push(Wf[t[e+i]]);i.push(n)}return i.forEach((function(e){let t=0;const i=(new zt).set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),r=i.elements;n[e.toString()]=i,e.forEach((function(e){let n=!1,i=!1;for(let s=0,o=e.length;s<o;++s){const o=e[s];if("-"===o)n=!0;else if("+"===o)n=!1;else if("/"===o)i=!0;else if("X"===o)r[0+t]=n?-1:1;else if("Y"===o)r[4+t]=n?-1:1;else if("Z"===o)r[8+t]=n?-1:1;else if(Xf.test(o)){const e=parseInt(o);i?r[12+t]/=e:r[12+t]=e}else Yl.warn(`getSymmetryOperations: unknown token '${o}'`)}t+=1}))})),n}(t.spacegroup),s=new ut,o=new ut;function a(e){const a=[];return Object.keys(r).forEach((function(l){const c=r[l].clone();s.copy(n).applyMatrix4(c).floor(),o.setFromMatrixPosition(c),o.sub(s),o.add(i),e&&o.add(e),c.setPosition(o),c.multiplyMatrices(t.fracToCart,c),c.multiply(t.cartToFrac),a.push(c)})),a}const l=new Kf("UNITCELL"),c=a(),u=[];if(e.biomolDict.NCS){u.push(new zt,...e.biomolDict.NCS.partList[0].matrixList);const t=[];c.forEach((e=>{u.forEach((n=>{t.push(e.clone().multiply(n))}))})),l.addPart(t)}else l.addPart(c);const h=new ut,d=new Kf("SUPERCELL"),p=Array.prototype.concat.call(a(h.set(1,0,0)),a(h.set(0,1,0)),a(h.set(0,0,1)),a(h.set(-1,0,0)),a(h.set(0,-1,0)),a(h.set(0,0,-1)),a(h.set(1,1,0)),a(h.set(1,0,1)),a(h.set(0,1,1)),a(h.set(-1,-1,0)),a(h.set(-1,0,-1)),a(h.set(0,-1,-1)),a(h.set(1,-1,-1)),a(h.set(1,1,-1)),a(h.set(1,-1,1)),a(h.set(-1,1,1)),a(h.set(-1,-1,1)),a(h.set(-1,1,-1)),a(h.set(0,1,-1)),a(h.set(0,-1,1)),a(h.set(1,0,-1)),a(h.set(-1,0,1)),a(h.set(1,-1,0)),a(h.set(-1,1,0)),a(),a(h.set(1,1,1)),a(h.set(-1,-1,-1)));if(e.biomolDict.NCS){const e=[];p.forEach((function(t){u.forEach((function(n){e.push(t.clone().multiply(n))}))})),d.addPart(e)}else d.addPart(p);e.biomolDict.UNITCELL=l,e.biomolDict.SUPERCELL=d,Ql&&Yl.timeEnd("buildUnitcellAssembly")}const um=["H","C","O","N","S","P"],hm=["NA","CL","FE"];function dm(e){let t=e.toUpperCase(),n=0,i=0;for(let e=0;e<t.length;e++)if(t.charCodeAt(e)<65){if(i>0)break;++n}else i=e+1;(n>0||i<t.length)&&(t=t.substring(n,i));const r=t.length;if(0===r)return"";if(1===r)return t;if(2===r){if(-1!==hm.indexOf(t))return t;if(-1!==um.indexOf(t[0]))return t[0];if(t in pd)return t}return r>=3&&-1!==um.indexOf(t[0])?t[0]:""}function pm(e){const t=e.bondHash,n=t.countArray,i=t.offsetArray,r=t.indexArray,s=e.getBondProxy();e.eachResidue((function(e){const t=e.residueType;if(void 0!==t.bonds)return;var o=e.atomOffset,a=[],l=[],c=[],u={};const h=o+e.atomCount;e.eachAtom((function(e){const t=e.index,d=i[t];for(let e=0,i=n[t];e<i;++e){s.index=r[d+e];let t=s.atomIndex1;if(t<o||t>=h)continue;let n=s.atomIndex2;if(n<o||n>=h)continue;if(t>n){const e=n;n=t,t=e}const i=t+"|"+n;void 0===u[i]&&(u[i]=!0,a.push(t-o),l.push(n-o),c.push(s.bondOrder))}})),t.bonds={atomIndices1:a,atomIndices2:l,bondOrders:c}}))}function fm(e,...t){Ql&&Yl.time("concatStructures");const n=new Fm(e,""),i=new Qf(n),r=n.atomStore,s=n.atomMap;r.addField("formalCharge",1,"int8"),r.addField("partialCharge",1,"float32");const o={};let a=0,l=0,c=0;t.forEach((e=>{e.eachAtom((e=>{r.growIfFull(),r.atomTypeId[a]=s.add(e.atomname,e.element),r.x[a]=e.x,r.y[a]=e.y,r.z[a]=e.z,r.serial[a]=e.serial,r.formalCharge[a]=e.formalCharge,r.partialCharge[a]=e.partialCharge,r.altloc[a]=e.altloc,r.occupancy[a]=e.occupancy,r.bfactor[a]=e.bfactor,i.addAtom(e.modelIndex+c,e.chainname,e.chainid,e.resname,e.resno,1===e.hetero,e.sstruc,e.inscode),o[e.index+l]=a,a+=1})),l+=e.atomStore.count,c+=e.modelStore.count}));const u=n.bondStore,h=n.getAtomProxy(),d=n.getAtomProxy();return l=0,t.forEach((e=>{e.eachBond((e=>{h.index=o[e.atomIndex1+l],d.index=o[e.atomIndex2+l],u.addBond(h,d,e.bondOrder)})),l+=e.atomStore.count})),i.finalize(),lm(n,!0),am(n,!0),n.finalizeAtoms(),n.finalizeBonds(),pm(n),Ql&&Yl.timeEnd("concatStructures"),n}const mm=[3,11,19,37,55,87],gm=[4,12,20,38,56,88],_m=[6,15,16,34],vm=[1,7,8,9,17,35,53],ym=[2,10,18,36,54,86],bm=[13,30,31,48,49,50,80,81,82,83,84,85,112],xm=[5,14,32,33,51,52,85],wm=[9,17,35,53,85];class Sm{constructor(e,t,n){this.structure=e,this.atomname=t,n=n||dm(t),this.element=n,this.number=pd[n]||0,this.vdw=fd[this.number]||2,this.covalent=md[this.number]||1.6}getDefaultValence(){const e=gd[this.number];return e?e[0]:-1}getValenceList(){return gd[this.number]||[]}getOuterShellElectronCount(){return _d[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return xm.includes(this.number)}isHalogen(){return wm.includes(this.number)}isDiatomicNonmetal(){return vm.includes(this.number)}isPolyatomicNonmetal(){return _m.includes(this.number)}isAlkaliMetal(){return mm.includes(this.number)}isAlkalineEarthMetal(){return gm.includes(this.number)}isNobleGas(){return ym.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return bm.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class Am{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const n=function(e,t){return e+"|"+t}(e=e.toUpperCase(),t=t?t.toUpperCase():dm(e));let i=this.dict[n];if(void 0===i){const r=new Sm(this.structure,e,t);i=this.list.length,this.dict[n]=i,this.list.push(r)}return i}get(e){return this.list[e]}}class Mm{constructor(e,t,n,i,r,s){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=i?1:0,this.chemCompType=r,this.bonds=s,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const o=kd[this.backboneType],a=kd[this.backboneStartType],l=kd[this.backboneEndType],c=this.getAtomIndexByName(o.trace);this.traceAtomIndex=Aa(c,-1);const u=this.getAtomIndexByName(o.direction1);this.direction1AtomIndex=Aa(u,-1);const h=this.getAtomIndexByName(o.direction2);this.direction2AtomIndex=Aa(h,-1);const d=this.getAtomIndexByName(a.backboneStart);this.backboneStartAtomIndex=Aa(d,-1);const p=this.getAtomIndexByName(l.backboneEnd);let f;this.backboneEndAtomIndex=Aa(p,-1),f=Ad.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=Aa(f,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case 3:t=Pd;break;case 4:case 5:t=Id;break;default:return e}const n=this.structure.atomMap,i=this.atomTypeIdList;for(let r=0,s=this.atomCount;r<s;++r){const s=n.get(i[r]);t.includes(s.atomname)&&e.push(r)}return e}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:rd}isProtein(){return this.chemCompType?sd.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||xd.includes(this.resname)}isCg(){const e=this.backboneType;return 4===e||5===e||6===e}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?od.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||wd.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?ad.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||Sd.includes(this.resname))}isHetero(){return 1===this.hetero}isIon(){return Td.includes(this.resname)}isWater(){return Cd.includes(this.resname)}isSaccharide(){return this.chemCompType?ld.includes(this.chemCompType):Ed.includes(this.resname)}isStandardAminoacid(){return xd.includes(this.resname)}isStandardBase(){return Md.includes(this.resname)}hasBackboneAtoms(e,t){const n=kd[t];return-1===e?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):0===e?this.hasAtomWithName(n.trace,n.direction1,n.direction2):1===e?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,2)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,3)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,n=this.structure.atomMap,i=this.atomTypeIdList;if(Array.isArray(e))for(let r=0;r<t;++r){const t=i[r];if(e.includes(n.get(t).atomname))return r}else for(let r=0;r<t;++r){const t=i[r];if(e===n.get(t).atomname)return r}}hasAtomWithName(...e){const t=e.length;for(let n=0;n<t;++n)if(void 0!==e[n]&&void 0===this.getAtomIndexByName(e[n]))return!1;return!0}getBonds(e){return void 0===this.bonds&&(this.bonds=function(e){const t=e.structure,n=t.getAtomProxy(),i=t.getAtomProxy(),r=e.atomCount,s=e.atomOffset,o=s+r-1,a=[],l=[],c=[];if(r>500)Ql&&Yl.warn("more than 500 atoms, skip residue for auto-bonding",e.qualifiedName());else if(r>50){const t=new jf(e,!0),r=e.isCg()?1.2:2.3;for(let e=s;e<o;++e){n.index=e;const o=n.covalent+r+.3,u=t.nearest(n,1/0,o*o),h=u.length;for(let e=0;e<h;++e)i.index=u[e].index,n.index<i.index&&n.connectedTo(i)&&(a.push(n.index-s),l.push(i.index-s),c.push(om(n.resname,n.atomname,i.atomname)))}}else for(let e=s;e<o;++e){n.index=e;for(let t=e+1;t<=o;++t)i.index=t,n.connectedTo(i)&&(a.push(e-s),l.push(t-s),c.push(om(n.resname,n.atomname,i.atomname)))}return{atomIndices1:a,atomIndices2:l,bondOrders:c}}(e)),this.bonds}getRings(){return void 0===this.rings&&this.calculateRings(),this.rings}getBondGraph(){return void 0===this.bondGraph&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return void 0===this.aromaticAtoms&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return void 0===this.aromaticRings&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,i=t.atomIndices1,r=t.atomIndices2;for(let t=0;t<n;++t){const n=i[t],s=r[t];(e[n]=e[n]||[]).push(s),(e[s]=e[s]||[]).push(n)}}calculateRings(){const e=function(e,t){const n={count:t,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(Im),right:new Int32Array(Im),color:new Int32Array(t),currentColor:0,rings:[],atomRings:[],bonds:e};for(let e=0;e<t;e++)n.visited[e]=-1,n.pred[e]=-1;return n}(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||Pm(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),1===this.aromaticAtoms[e.index-e.residueAtomOffset]}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,i=n.map((t=>function(e){if(e.some((e=>!Cm.includes(e.number))))return!1;let t=0;const n=new Ap(3,e.length),i=n.data;return e.forEach((e=>{i[t+0]=e.x,i[t+1]=e.y,i[t+2]=e.z,t+=3})),new Pf(n).vecC.length()<Tm}(t.map((t=>this.structure.getAtomProxy(t+e.atomOffset)))))),r=this.aromaticRings=[];n.forEach(((e,n)=>{i[n]&&(r.push(e),e.forEach((e=>t[e]=1)))}))}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,i=t.rings,r=this.bonds,s=r.atomIndices1,o=r.atomIndices2,a=r.bondOrders,l=this.bondReferenceAtomIndices,c=r.atomIndices1.length;l.length=0;for(let t=0;t<c;++t){if(a[t]<=1)continue;let r;const c=s[t],u=o[t],h=n[c],d=n[u];if(h&&d)for(let e=0;e<h.length;e++)if(-1!==d.indexOf(h[e])){r=i[h[e]];break}if(e[c].length>1)for(let n=0;n<e[c].length;++n){const i=e[c][n];if(i!==u&&(void 0===r||-1!==r.indexOf(i))){l[t]=i;break}}else if(e[u].length>1)for(let n=0;n<e[u].length;++n){const i=e[u][n];if(i!==c&&(void 0===r||-1!==r.indexOf(i))){l[t]=i;break}}}}getBondIndex(e,t){const n=this.bonds,i=n.atomIndices1,r=n.atomIndices2;let s=i.indexOf(e),o=r.indexOf(t);const a=o;for(;-1!==s;){for(;-1!==o;){if(s===o)return s;o=r.indexOf(t,o+1)}s=i.indexOf(e,s+1),o=a}}getBondReferenceAtomIndex(e,t){const n=this.getBondIndex(e,t);if(void 0!==n)return 0===this.bondReferenceAtomIndices.length&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const Cm=[5,6,7,8,14,15,16,32,33,50,51,83],Tm=.05;function Em(e,t,n){if(n<t)return;const{pred:i,color:r,left:s,right:o}=e,a=++e.currentColor;let l=t;for(let e=0;e<Im&&(r[l]=a,l=i[l],!(l<0));e++);let c=0,u=0,h=!1,d=0;l=n;for(let e=0;e<Im;e++){if(r[l]===a){d=l,h=!0;break}if(o[u++]=l,l=i[l],l<0)break}if(!h)return;l=t;for(let e=0;e<Im&&(s[c++]=l,d!==l)&&(l=i[l],!(l<0));e++);const p=c+u,f=new Array(p);let m=0;for(let e=0;e<c;e++)f[m++]=s[e];for(let e=u-1;e>=0;e--)f[m++]=o[e];const g=e.rings.length;for(let t=0;t<p;++t){const n=f[t];e.atomRings[n]?e.atomRings[n].push(g):e.atomRings[n]=[g]}e.rings.push(f)}function Pm(e,t){const{bonds:n,visited:i,queue:r,pred:s}=e;i[t]=1,r[0]=t;let o=0,a=1;for(;o<a;){const t=r[o++],l=0;if(void 0===n[t])continue;const c=n[t].length;for(let o=l;o<c;o++){const l=n[t][o];i[l]>0?s[l]!==t&&s[t]!==l&&Em(e,t,l):(i[l]=1,r[a++]=l,s[l]=t)}}}const Im=4;class km{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,n,i="",r){const s=function(e,t,n,i=""){return e+"|"+t.join(",")+"|"+(n?1:0)+"|"+i}(e=e.toUpperCase(),t,n,i);let o=this.dict[s];if(void 0===o){const a=new Mm(this.structure,e,t,n,i,r);o=this.list.length,this.dict[s]=o,this.list.push(a)}return o}get(e){return this.list[e]}}class Rm{constructor(e,t=0){this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new ut,this._v13=new ut,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const n=e.index-e.residueAtomOffset,i=t.index-t.residueAtomOffset,r=e.residueType.getBondReferenceAtomIndex(n,i);if(void 0!==r)return r+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(e=new ut){const t=this._ap1,n=this._ap2,i=this._ap3,r=this._v12,s=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;const o=this.getReferenceAtomIndex();r.subVectors(t,n).normalize(),void 0!==o?(i.index=o,s.subVectors(t,i)):s.copy(t),s.normalize();let a=r.dot(s);return 1-Math.abs(a)<1e-5&&(s.set(1,0,0),a=r.dot(s),1-Math.abs(a)<1e-5&&(s.set(0,1,0),a=r.dot(s))),e.copy(s.sub(r.multiplyScalar(a))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new Rm(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class Dm{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const n=this.atomCount,i=this.atomOffset,r=this.structure._ap,s=i+n;if(t&&t.atomOnlyTest){const n=t.atomOnlyTest;for(let t=i;t<s;++t)r.index=t,n(r)&&e(r)}else for(let t=i;t<s;++t)r.index=t,e(r)}positionToArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return 3===this.residueType.moleculeType}isNucleic(){const e=this.residueType.moleculeType;return 4===e||5===e}isRna(){return 4===this.residueType.moleculeType}isDna(){return 5===this.residueType.moleculeType}isCg(){const e=this.residueType.backboneType;return 4===e||5===e||6===e}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return 3===e||4===e||5===e}}isHetero(){return 1===this.residueType.hetero}isWater(){return 1===this.residueType.moleculeType}isIon(){return 2===this.residueType.moleculeType}isSaccharide(){return 6===this.residueType.moleculeType}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return ud.includes(this.sstruc)}isSheet(){return hd.includes(this.sstruc)}isTurn(){return dd.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return bd[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return void 0!==t&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,n=new Array(e);for(let i=0;i<e;++i)n[i]=this.getAtomType(t+i).atomname;return n}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){const e=this.structure.getResidueProxy(n);if(this.connectedTo(e))return e}else if(n===e+t){const t=this.structure.getResidueProxy(e);if(this.connectedTo(t))return t}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){const t=Aa(e,this.structure.getResidueProxy());if(t.index=n,t.connectedTo(this))return t}else if(n===t-1){const n=this.chainStore.residueCount[this.chainIndex],i=Aa(e,this.structure.getResidueProxy());if(i.index=t+n-1,i.connectedTo(this))return i}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(e=!1){let t="";return this.resname&&!e&&(t+="["+this.resname+"]"),void 0!==this.resno&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new Dm(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class Lm{constructor(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;const i=this.structure.getResidueProxy(this.residueIndexStart),r=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=void 0!==i.getPreviousConnectedResidue();const s=r.getNextConnectedResidue();this.isNextConnected=void 0!==s,this.isNextNextConnected=void 0!==s&&void 0!==s.getNextConnectedResidue(),this.isCyclic=r.connectedTo(i),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?-1===e?e=this.residueCount-1:e===this.residueCount&&(e=0):(-1!==e||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const n=this.__residueProxy;let i;switch(n.index=this.residueIndexStart+e,t){case"trace":i=n.traceAtomIndex;break;case"direction1":i=n.direction1AtomIndex;break;case"direction2":i=n.direction2AtomIndex;break;default:i=n.getAtomIndexByName(t)}return i}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}))}eachAtomN(e,t,n){const i=this.residueCount,r=new Array(e);for(let t=0;t<e;++t)r[t]=this.structure.getAtomProxy(this.getAtomIndexByType(t,n));t.apply(this,r);for(var s=e;s<i;++s){for(let t=1;t<e;++t)r[t-1].index=r[t].index;r[e-1].index=this.getAtomIndexByType(s,n),t.apply(this,r)}}eachResidue(e){const t=this.structure.getResidueProxy(),n=this.residueCount,i=this.residueIndexStart;for(let r=0;r<n;++r)t.index=i+r,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class Om{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){const n=this.residueCount,i=this.residueOffset,r=this.structure._rp,s=i+n;if(t&&t.test){const n=t.residueOnlyTest;if(n)for(let t=i;t<s;++t)r.index=t,n(r)&&e(r);else for(let t=i;t<s;++t)r.index=t,e(r)}else for(let t=i;t<s;++t)r.index=t,e(r)}eachResidueN(e,t){const n=this.residueCount,i=this.residueOffset,r=i+n;if(n<e)return;const s=new Array(e);for(let t=0;t<e;++t)s[t]=this.structure.getResidueProxy(i+t);t.apply(this,s);for(let n=i+e;n<r;++n){for(let t=0;t<e;++t)s[t].index+=1;t.apply(this,s)}}eachPolymer(e,t){let n=0,i=0;const r=t?t.residueOnlyTest:void 0,s=this.model.structure,o=this.residueCount,a=this.residueOffset,l=a+o,c=this.structure.getResidueProxy(),u=this.structure.getResidueProxy(a),h=this.structure.getAtomProxy(),d=this.structure.getAtomProxy();let p=!0;for(let t=a+1;t<l;++t){c.index=u.index,u.index=t;const o=p?c.backboneEndType:c.backboneType,a=u.backboneType;p&&(n=c.index,p=!1),i=u.index,o!==rd&&o===a?(h.index=c.backboneEndAtomIndex,d.index=u.backboneStartAtomIndex,h&&d&&h.connectedTo(d)&&(!r||r(c)&&r(u))||(c.index-n>1&&e(new Lm(s,n,c.index)),n=i)):(o!==rd&&c.index-n>1&&e(new Lm(s,n,c.index)),n=i)}i-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new Lm(s,n,i))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new Om(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class Nm{constructor(e,t=0){this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return 0===this.chainCount?0:this.residueEnd-this.residueOffset+1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){this.eachChain((function(n){n.eachResidue(e,t)}),t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const n=t.chainOnlyTest;this.eachChain((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachChain((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){const n=this.chainCount,i=this.chainOffset,r=this.structure._cp,s=i+n;if(t&&t.test){const n=t.chainOnlyTest;if(n)for(let t=i;t<s;++t)r.index=t,n(r)&&e(r);else for(let t=i;t<s;++t)r.index=t,e(r)}else for(let t=i;t<s;++t)r.index=t,e(r)}qualifiedName(){return"/"+this.index}clone(){return new Nm(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class Fm{constructor(e="",t=""){this.signals={refreshed:new va.Signal},this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new Rf(0),this.backboneBondStore=new Rf(0),this.rungBondStore=new Rf(0),this.atomStore=new Df(0),this.residueStore=new Lf(0),this.chainStore=new Of(0),this.modelStore=new Nf(0),this.atomMap=new Am(this),this.residueMap=new km(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new ut,this.boundingBox=new pt,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new ut),this.spatialHash=new Yh(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new kf(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new Rm(this,e)}getAtomProxy(e){return new Vf(this,e)}getResidueProxy(e){return new Dm(this,e)}getChainProxy(e){return new Om(this,e)}getModelProxy(e){return new Nm(this,e)}getBondSet(){const e=this.bondStore.count,t=new Jh(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else{const i=this.getBondProxy();for(let r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new Jh(e),n=this.atomSetCache.__backbone;if(n){const i=this.getBondProxy();i.bondStore=this.backboneBondStore;for(let r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new Jh(e),n=this.atomSetCache.__rung;if(n){const i=this.getBondProxy();i.bondStore=this.rungBondStore;for(let r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(void 0===e)return new Jh(t,!0);if(e instanceof Jh)return e;if(!0===e)return new Jh(t,!0);if(e&&e.test){const n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(""===n)return new Jh(t,!0);{const i=new Jh(t);return this.eachAtom((function(e){i.set(e.index)}),e),this.atomSetCache[n]=i,i}}return!1===e?new Jh(t):new Jh(t,!0)}getAtomSetWithinSelection(e,t){const n=this.spatialHash,i=this.getAtomSet(!1),r=this.getAtomProxy();return n?(this.getAtomSet(e).forEach((function(e){r.index=e,n.within(r.x,r.y,r.z,t).forEach((function(e){i.set(e)}))})),i):i}getAtomSetWithinPoint(e,t){const n=e,i=this.getAtomSet(!1);return this.spatialHash?(this.spatialHash.within(n.x,n.y,n.z,t).forEach((function(e){i.set(e)})),i):i}getAtomSetWithinVolume(e,t,n,i,r){const s=new If(e,n,i,r),o=s.getDataPosition(),a=o.length,l=s.matrix.getMaxScaleOnAxis(),c=this.getAtomSet(!1);if(!this.spatialHash)return c;for(let e=0;e<a;e+=3)this.spatialHash.within(o[e],o[e+1],o[e+2],l).forEach((function(e){c.set(e)}));return c}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,n=this.getAtomSet(!1),i=this.getResidueProxy();return this.getAtomSet(e).forEach((function(e){i.index=t[e];for(let e=i.atomOffset;e<=i.atomEnd;++e)n.set(e)})),n}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach((function(n){void 0!==t&&n.getEntityType()!==t||e(n)}))}eachBond(e,t){const n=this.getBondProxy();let i;if(t&&t.test&&(i=this.getBondSet(),this.bondSet&&i.intersection(this.bondSet)),i)i.forEach((function(t){n.index=t,e(n)}));else{const t=this.bondStore.count;for(let i=0;i<t;++i)n.index=i,e(n)}}eachAtom(e,t){if(t&&t.test)this.eachModel((function(n){n.eachAtom(e,t)}),t);else{const t=this.atomStore.count,n=this.getAtomProxy();for(let i=0;i<t;++i)n.index=i,e(n)}}eachResidue(e,t){if(t&&t.test){const n=this.modelStore.count,i=this.getModelProxy(),r=t.modelOnlyTest;if(r)for(let s=0;s<n;++s)i.index=s,r(i)&&i.eachResidue(e,t);else for(let r=0;r<n;++r)i.index=r,i.eachResidue(e,t)}else{const t=this.residueStore.count,n=this.getResidueProxy();for(let i=0;i<t;++i)n.index=i,e(n)}}eachResidueN(e,t){const n=this.residueStore.count;if(n<e)return;const i=new Array(e);for(let t=0;t<e;++t)i[t]=this.getResidueProxy(t);t.apply(this,i);for(let r=e;r<n;++r){for(let t=0;t<e;++t)i[t].index+=1;t.apply(this,i)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const n=t.modelOnlyTest;this.eachModel((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachModel((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){if(t&&t.test)this.eachModel((function(n){n.eachChain(e,t)}));else{const t=this.chainStore.count,n=this.getChainProxy();for(let i=0;i<t;++i)n.index=i,e(n)}}eachModel(e,t){const n=this.modelStore.count,i=this.getModelProxy();if(t&&t.test){const r=t.modelOnlyTest;if(r)for(let t=0;t<n;++t)i.index=t,r(i)&&e(i);else for(let t=0;t<n;++t)i.index=t,e(i)}else for(let t=0;t<n;++t)i.index=t,e(i)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,i=Aa(t.atomSet,this.atomSet);let r,s;const o={},a=this.getAtomProxy(),l=i.getSize();n&&!n.position||(o.position=new Float32Array(3*l)),n&&!n.color||!t.colorParams||(o.color=new Float32Array(3*l),s=ic.getScheme(t.colorParams)),n&&!n.picking||(o.picking=new cp(new Float32Array(l),this.getStructure())),n&&!n.radius||(o.radius=new Float32Array(l),r=new Cf(t.radiusParams)),n&&!n.index||(o.index=new Uint32Array(l));const{position:c,color:u,picking:h,radius:d,index:p}=o;return i.forEach(((e,t)=>{const n=3*t;a.index=e,c&&a.positionToArray(c,n),u&&s.atomColorToArray(a,u,n),h&&(h.array[t]=e),d&&(d[t]=r.atomRadius(a)),p&&(p[t]=e)})),o}getBondData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,i=Aa(t.bondSet,this.bondSet),r=Aa(t.multipleBond,"off"),s="off"!==r,o="offset"===r,a=Aa(t.bondScale,.4),l=Aa(t.bondSpacing,1);let c,u;const h={},d=this.getBondProxy();t.bondStore&&(d.bondStore=t.bondStore);const p=this.getAtomProxy(),f=this.getAtomProxy();let m;if(s){const e=d.bondStore.bondOrder;m=0,i.forEach((function(t){m+=e[t]}))}else m=i.getSize();n&&!n.position||(h.position1=new Float32Array(3*m),h.position2=new Float32Array(3*m)),n&&!n.color||!t.colorParams||(h.color=new Float32Array(3*m),h.color2=new Float32Array(3*m),u=ic.getScheme(t.colorParams)),n&&!n.picking||(h.picking=new hp(new Float32Array(m),this.getStructure(),t.bondStore)),(!n||n.radius||s&&n.position)&&(c=new Cf(t.radiusParams)),n&&!n.radius||(h.radius=new Float32Array(m),t.radius2&&(h.radius2=new Float32Array(m)));const{position1:g,position2:_,color:v,color2:y,picking:b,radius:x,radius2:w}=h;let S,A,M,C,T,E,P=0;const I=new ut,k=new ut,R=new ut;return i.forEach((e=>{if(A=3*P,d.index=e,p.index=d.atomIndex1,f.index=d.atomIndex2,C=d.bondOrder,g)if(s&&C>1){const e=c.atomRadius(p);E=e*a/(.5*C),d.calculateShiftDir(R),o?(T=2*l*e,R.multiplyScalar(T),R.negate(),k.subVectors(f,p).multiplyScalar(Math.max(.1,T/1.88)),p.positionToArray(g,A),f.positionToArray(_,A),C>=2&&(I.addVectors(p,R).add(k).toArray(g,A+3),I.addVectors(f,R).sub(k).toArray(_,A+3),C>=3&&(I.subVectors(p,R).add(k).toArray(g,A+6),I.subVectors(f,R).sub(k).toArray(_,A+6)))):(T=(l-a)*e,R.multiplyScalar(T),2===C?(I.addVectors(p,R).toArray(g,A),I.subVectors(p,R).toArray(g,A+3),I.addVectors(f,R).toArray(_,A),I.subVectors(f,R).toArray(_,A+3)):3===C?(p.positionToArray(g,A),I.addVectors(p,R).toArray(g,A+3),I.subVectors(p,R).toArray(g,A+6),f.positionToArray(_,A),I.addVectors(f,R).toArray(_,A+3),I.subVectors(f,R).toArray(_,A+6)):(p.positionToArray(g,A),f.positionToArray(_,A)))}else p.positionToArray(g,A),f.positionToArray(_,A);if(v&&y&&(u.bondColorToArray(d,1,v,A),u.bondColorToArray(d,0,y,A),s&&C>1))for(S=1;S<C;++S)M=3*S+A,Kc(v,A,M,3),Kc(y,A,M,3);if(b&&b.array&&(b.array[P]=e,s&&C>1))for(S=1;S<C;++S)b.array[P+S]=e;if(x&&(x[P]=c.atomRadius(p),s&&C>1))for(E=x[P]*a/(o?1:.5*C),S=o?1:0;S<C;++S)x[P+S]=E;if(w&&(w[P]=c.atomRadius(f),s&&C>1))for(E=w[P]*a/(o?1:.5*C),S=o?1:0;S<C;++S)w[P+S]=E;P+=s?C:1})),h}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(e,t){Ql&&Yl.time("getBoundingBox"),t=t||new pt;let n=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;return this.eachAtom((e=>{const t=e.x,l=e.y,c=e.z;t<n&&(n=t),l<i&&(i=l),c<r&&(r=c),t>s&&(s=t),l>o&&(o=l),c>a&&(a=c)}),e),t.min.set(n,i,r),t.max.set(s,o,a),Ql&&Yl.timeEnd("getBoundingBox"),t}getPrincipalAxes(e){Ql&&Yl.time("getPrincipalAxes");let t=0;const n=new Ap(3,this.atomCount),i=n.data;return this.eachAtom((e=>{i[t+0]=e.x,i[t+1]=e.y,i[t+2]=e.z,t+=3}),e),Ql&&Yl.timeEnd("getPrincipalAxes"),new Pf(n)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new ut):this.center.clone()}hasCoords(){if(void 0===this._hasCoords){const e=this.atomStore;this._hasCoords=0!==Qc(e.x)||0!==Zc(e.x)||0!==Qc(e.y)||0!==Zc(e.y)||0!==Qc(e.z)||0!==Zc(e.z)||e.count/this.modelStore.count==1}return this._hasCoords}getSequence(e){const t=[],n=this.getResidueProxy();return this.eachAtom((function(e){n.index=e.residueIndex,e.index===n.traceAtomIndex&&t.push(n.getResname1())}),e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom((function(e){t.push(e.index)}),e),new Uint32Array(t)}{const e={what:{index:!0}};return this.getAtomData(e).index}}getChainnameCount(e){const t=new Set;return this.eachChain((function(e){e.residueCount&&t.add(e.chainname)}),e),t.size}updatePosition(e,t=!0){let n=0;this.eachAtom((function(t){t.positionFromArray(e,n),n+=3}),void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new Yh(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const Bm=new pt,Um=[Hh,Bh,$h,Vh,Gh,Uh,Fh,zh,Wh,jh,qh,Xh],zm={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class Vm{constructor(e="shape",t={}){this.boundingBox=new pt,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=Ma(t,zm),Um.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)]=[]})),this._primitiveData[e.getShapeKey("name")]=[]}))}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,n,i,r){let s;e=Ga(e),t=Ga(t),Array.isArray(n)&&(n=Ba(n,e.length)),i&&(i=Ga(i)),s=void 0===i||0==i.length?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:i};const o=new gp(this,Object.assign({serial:this.meshCount,name:r},s)),a=new ef(Object.assign({picking:o},s));return this.bufferList.push(a),Bm.setFromArray(e),this.boundingBox.union(Bm),this.meshCount+=1,this}addSphere(e,t,n,i){return Fh.objectToShape(this,{position:e,color:t,radius:n,name:i}),this}addEllipsoid(e,t,n,i,r,s){return Gh.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:r,name:s}),this}addTorus(e,t,n,i,r,s){return jh.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:r,name:s}),this}addCylinder(e,t,n,i,r){return Vh.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this}addCone(e,t,n,i,r){return $h.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this}addArrow(e,t,n,i,r){return Hh.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this}addBox(e,t,n,i,r,s){return Bh.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:s}),this}addOctahedron(e,t,n,i,r,s){return Uh.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:s}),this}addTetrahedron(e,t,n,i,r,s){return zh.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:s}),this}addText(e,t,n,i){return Wh.objectToShape(this,{position:e,color:t,size:n,text:i}),this}addPoint(e,t,n){return qh.objectToShape(this,{position:e,color:t,name:n}),this}addWideline(e,t,n,i,r){return this.parameters.linewidth=i,Xh.objectToShape(this,{position1:e,position2:t,color:n,name:r}),this}addLabel(e,t,n,i){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,i)}getBufferList(){const e=[];return Um.forEach((t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))})),this.bufferList.concat(e)}dispose(){this.bufferList.forEach((function(e){e.dispose()})),this.bufferList.length=0,Um.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)].length=0})),this._primitiveData[e.getShapeKey("name")].length=0}))}get center(){return this._center||(this._center=this.boundingBox.getCenter(new ut)),this._center}get type(){return"Shape"}}class Hm extends sh{constructor(e,t,n){Array.isArray(e)||(e=[e]),super(e,t,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(n)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e),e.setParameters(this.getBufferParams())})),this.setVisibility(this.visible),e()}}const $m=new zt,Gm=new Fe;class jm extends ef{constructor(e,t={},n){super(function(e,t){const n=t.attributes.position.array,i=t.index?t.index.array:void 0,r=e.position.length/3,s=n.length/3,o=r*s,a=new Float32Array(3*o),l=new Float32Array(3*o),c=new Float32Array(3*o);let u;return i&&(u=Ba(r*i.length,o)),{position:a,color:c,index:u,normal:l,primitiveId:e.primitiveId||qc(r,s),picking:e.picking}}(e,n),t),this.updateNormals=!1;const i=n.attributes.position.array,r=n.attributes.normal.array,s=n.index?n.index.array:void 0;this.geoPosition=i,this.geoNormal=r,this.geoIndex=s,this.positionCount=e.position.length/3,this.geoPositionCount=i.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const o=this.geometry.attributes;if(this.meshPosition=o.position.array,this.meshColor=o.color.array,this.meshNormal=o.normal.array,this.setAttributes(e),s){const e=this.geometry.getIndex();if(!e)return void Yl.error("Index is null");this.meshIndex=e.array,this.makeIndex()}}setAttributes(e={},t=!1){const n=this.geometry.attributes;let i,r,s,o,a,l,c,u,h;const d=this.updateNormals;e.position&&(i=e.position,s=this.geoPosition,c=this.meshPosition,a=this.transformedGeoPosition,n.position.needsUpdate=!0,(d||t)&&(o=this.geoNormal,h=this.meshNormal,l=this.transformedGeoNormal,n.normal.needsUpdate=!0)),e.color&&(r=e.color,u=this.meshColor,n.color.needsUpdate=!0);const p=this.positionCount,f=this.geoPositionCount;for(let e=0;e<p;++e){let n,p;const m=e*f*3,g=3*e;if(i&&a&&c&&h&&s&&o&&(a.set(s),$m.makeTranslation(i[g],i[g+1],i[g+2]),this.applyPositionTransform($m,e,g),hh($m.elements,a),c.set(a,m),d&&l?(l.set(o),Gm.getNormalMatrix($m),dh(Gm.elements,l),h.set(l,m)):t&&h.set(o,m)),r&&u)for(n=0;n<f;++n)p=m+3*n,u[p]=r[g],u[p+1]=r[g+1],u[p+2]=r[g+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const n=this.positionCount,i=this.geoPositionCount,r=e.length/3*3;for(let s=0;s<n;++s){const n=s*r,o=n+r;t.set(e,n);for(let e=n;e<o;++e)t[e]+=s*i}}}const Wm=new ut,qm=Object.assign({sphereDetail:1},Zp);class Xm extends jm{constructor(e,t={}){super(e,t,new Fo(1,Aa(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return qm}applyPositionTransform(e,t){const n=this._radius[t];Wm.set(n,n,n),e.scale(Wm)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}ac.add("shader/SphereImpostor.vert","uniform mat4 projectionMatrixInverse;\nuniform float clipNear;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\nattribute vec2 mapping;\nattribute float radius;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\n#include matrix_scale\nconst mat4 D = mat4(\n1.0, 0.0, 0.0, 0.0,\n0.0, 1.0, 0.0, 0.0,\n0.0, 0.0, 1.0, 0.0,\n0.0, 0.0, 0.0, -1.0\n);\nmat4 transposeM( in mat4 inMatrix ) {\nvec4 i0 = inMatrix[0];\nvec4 i1 = inMatrix[1];\nvec4 i2 = inMatrix[2];\nvec4 i3 = inMatrix[3];\nmat4 outMatrix = mat4(\nvec4(i0.x, i1.x, i2.x, i3.x),\nvec4(i0.y, i1.y, i2.y, i3.y),\nvec4(i0.z, i1.z, i2.z, i3.z),\nvec4(i0.w, i1.w, i2.w, i3.w)\n);\nreturn outMatrix;\n}\nvoid ComputePointSizeAndPositionInClipCoordSphere(){\nvec2 xbc;\nvec2 ybc;\nmat4 T = mat4(\nradius, 0.0, 0.0, 0.0,\n0.0, radius, 0.0, 0.0,\n0.0, 0.0, radius, 0.0,\nposition.x, position.y, position.z, 1.0\n);\nmat4 R = transposeM( projectionMatrix * modelViewMatrix * T );\nfloat A = dot( R[ 3 ], D * R[ 3 ] );\nfloat B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );\nfloat C = dot( R[ 0 ], D * R[ 0 ] );\nxbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nxbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;\nA = dot( R[ 3 ], D * R[ 3 ] );\nB = -2.0 * dot( R[ 1 ], D * R[ 3 ] );\nC = dot( R[ 1 ], D * R[ 1 ] );\nybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;\ngl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );\ngl_Position.xy -= mapping * vec2( sx, sy );\ngl_Position.xy *= gl_Position.w;\n}\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\nvRadius = radius * matrixScale( modelViewMatrix );\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nmvPosition.z -= vRadius;\ngl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );\nComputePointSizeAndPositionInClipCoordSphere();\nvRadiusSq = vRadius * vRadius;\nvec4 vPoint4 = projectionMatrixInverse * gl_Position;\nvPoint = vPoint4.xyz / vPoint4.w;\nvPointViewPosition = -mvPosition.xyz / mvPosition.w;\n}"),ac.add("shader/SphereImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool flag2 = false;\nbool interior = false;\nvec3 cameraPos;\nvec3 cameraNormal;\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nbool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){\nvec3 cameraSpherePos = -vPointViewPosition;\ncameraSpherePos.z += vRadius;\nvec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );\nvec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );\nvec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );\nfloat B = dot( rayDirection, cameraSphereDir );\nfloat det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );\nif( det < 0.0 ){\ndiscard;\nreturn false;\n}\nfloat sqrtDet = sqrt( det );\nfloat posT = mix( B + sqrtDet, B + sqrtDet, ortho );\nfloat negT = mix( B - sqrtDet, sqrtDet - B, ortho );\ncameraPos = rayDirection * negT + rayOrigin;\n#ifdef NEAR_CLIP\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}else if( calcClip( cameraPos ) > 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\nflag2 = true;\n}\n#else\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}\n#endif\ncameraNormal = normalize( cameraPos - cameraSpherePos );\ncameraNormal *= float(!interior) * 2.0 - 1.0;\nreturn !interior;\n}\nvoid main(void){\nbool flag = Impostor( cameraPos, cameraNormal );\n#ifdef NEAR_CLIP\nif( calcClip( cameraPos ) > 0.0 )\ndiscard;\n#endif\ngl_FragDepthEXT = calcDepth( cameraPos );\nif( !flag ){\n#ifdef NEAR_CLIP\nif( flag2 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}else if( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#else\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#endif\n}\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vNormal = cameraNormal;\nvec3 vViewPosition = -cameraPos;\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");class Ym extends Jp{constructor(e,t,n={}){super(t,n),this.index=Ba(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:Wc(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const n in e){const i=e[n];t[n]={type:i.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=Hc(e.position1,e.position2));const t=this.size,n=this.mappingSize,i=this.geometry.attributes;let r,s,o,a,l,c,u;for(const h in e)if("index"!==h&&"picking"!==h){s=e[h],r=i[h],o=r.itemSize,a=r.array;for(let e=0;e<t;++e){l=e*o,c=l*n;for(let e=0;e<n;++e){u=c+o*e;for(let e=0;e<o;++e)a[u+e]=s[l+e]}}r.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,n=this.mappingSize,i=this.mappingItemSize,r=this.geometry.attributes.mapping.array;for(let s=0;s<e;s++)r.set(t,s*i*n)}makeIndex(){const e=this.size,t=this.mappingSize,n=this.mappingIndices,i=this.mappingIndicesSize,r=this.index;for(let s=0;s<e;s++){const e=s*i,o=s*t;r.set(n,e);for(let t=0;t<i;++t)r[e+t]+=o}}}const Km=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Zm=new Uint16Array([0,1,2,1,3,2]);class Qm extends Ym{constructor(e,t={}){super("v2",e,t)}get mapping(){return Km}get mappingIndices(){return Zm}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class Jm extends Qm{constructor(e,t={}){super(e,t),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new zt},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}}Object.assign({disableImpostor:!1},qm);const eg=class{constructor(e,t){return!ql||t&&t.disableImpostor?new Xm(e,t):new Jm(e,t)}};function tg(e,t,n,i){const r=n-e,s=i-t;return Math.sqrt(r*r+s*s)}uc.add("sphere",eg),ac.add("shader/Point.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float size;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\nvarying vec3 vViewPosition;\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\n#include begin_vertex\n#include project_vertex\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );\n#else\ngl_PointSize = size * pixelRatio;\n#endif\n#ifndef PICKING\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),ac.add("shader/Point.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include alphatest_pars_fragment\nvarying vec3 vViewPosition;\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\n#ifdef USE_MAP\nif( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )\ndiscard;\n#endif\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\n#ifdef USE_MAP\ndiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif\n#include color_fragment\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const ng=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},Zp),ig=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},Qp);class rg extends Jp{constructor(e,t={}){super(e,t),this.parameterTypes=ig,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return ng}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=function(e){const t=e||{},n=Aa(t.width,256),i=Aa(t.height,256),r=[n/2,i/2],s=Math.min(n/2,i/2),o=Aa(t.delta,1/(s+1))*s;let a=0,l=0;const c=new Uint8Array(n*i*4);for(let e=0,t=c.length;e<t;e+=4){const t=1-el(s-o,s,tg(a,l,r[0],r[1]));c[e]=255*t,c[e+1]=255*t,c[e+2]=255*t,c[e+3]=255*t,++a===n&&(a=0,l++)}const u=new mo(c,n,i);return u.needsUpdate=!0,u}({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.USE_ALPHATEST=1),t}setUniforms(e){e&&void 0!==e.edgeBleach&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}uc.add("point",rg);class sg extends sh{constructor(e,t,n){super(e,t,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof qp?(this.surface=void 0,this.volume=new If(e)):(this.surface=e,this.volume=void 0),this.init(n)}init(e){var t=e||{};t.colorScheme=Aa(t.colorScheme,"uniform"),t.colorValue=Aa(t.colorValue,14540253),this.thresholdType=Aa(t.thresholdType,"sigma"),this.thresholdMin=Aa(t.thresholdMin,2),this.thresholdMax=Aa(t.thresholdMax,1/0),this.thresholdOut=Aa(t.thresholdOut,!1),this.dotType=Aa(t.dotType,"point"),this.radius=Aa(t.radius,.1),this.scale=Aa(t.scale,1),this.pointSize=Aa(t.pointSize,1),this.sizeAttenuation=Aa(t.sizeAttenuation,!0),this.sortParticles=Aa(t.sortParticles,!1),this.useTexture=Aa(t.useTexture,!1),this.alphaTest=Aa(t.alphaTest,.5),this.forceTransparent=Aa(t.forceTransparent,!1),this.edgeBleach=Aa(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,n,i=this.volume;"sigma"===this.thresholdType?(t=i.getValueForSigma(this.thresholdMin),n=i.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,n=this.thresholdMax),i.setFilter(t,n,this.thresholdOut),Object.assign(e,{position:i.getDataPosition(),color:i.getDataColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(e,{radius:i.getDataSize(this.radius,this.scale),picking:i.getDataPicking()})}else{var r=this.surface;Object.assign(e,{position:r.getPosition(),color:r.getColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(e,{radius:r.getSize(this.radius,this.scale),picking:r.getPicking()})}"sphere"===this.dotType?this.dotBuffer=new eg(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new rg(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(e={}){if(0===this.bufferList.length)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),"sphere"===this.dotType&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e,t={},n){return e&&void 0!==e.thresholdType&&this.volume instanceof qp&&("value"===this.thresholdType&&"sigma"===e.thresholdType?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):"sigma"===this.thresholdType&&"value"===e.thresholdType&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&void 0!==e.radiusType&&("radius"===e.radiusType?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,"sphere"!==this.dotType||ql&&!this.disableImpostor||(n=!0)),e&&void 0!==e.radius&&(t.radius=!0,"sphere"!==this.dotType||ql&&!this.disableImpostor||(n=!0)),e&&void 0!==e.scale&&(t.scale=!0,"sphere"!==this.dotType||ql&&!this.disableImpostor||(n=!0)),super.setParameters(e,t,n),this}}ac.add("shader/Image.vert","uniform float clipRadius;\nuniform vec3 clipCenter;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid main() {\n#include begin_vertex\n#include project_vertex\nvUv = uv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n}"),ac.add("shader/Image.frag","uniform sampler2D map;\nuniform float opacity;\nuniform vec2 mapSize;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform sampler2D pickingMap;\nuniform float objectId;\n#else\n#include fog_pars_fragment\n#endif\n#if defined( CUBIC_INTERPOLATION )\n#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )\n#if defined( CATMULROM_FILTER )\nconst float B = 0.0;\nconst float C = 0.5;\n#elif defined( MITCHELL_FILTER )\nconst float B = 0.333;\nconst float C = 0.333;\n#endif\nfloat applyFilter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f < 1.0 ){\nreturn ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +\n( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +\n( 6.0 - 2.0 * B ) ) / 6.0;\n}else if( f >= 1.0 && f < 2.0 ){\nreturn ( ( -B - 6.0 * C ) * ( f * f * f )\n+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +\n( - ( 12.0 * B ) - 48.0 * C ) * f +\n8.0 * B + 24.0 * C ) / 6.0;\n}else{\nreturn 0.0;\n}\n}\n#elif defined( BSPLINE_FILTER )\nfloat applyFilter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f >= 0.0 && f <= 1.0 ){\nreturn ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );\n}else if( f > 1.0 && f <= 2.0 ){\nreturn 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );\n}\nreturn 1.0;\n}\n#else\nfloat applyFilter( float x ){\nreturn 1.0;\n}\n#endif\nvec4 biCubic( sampler2D tex, vec2 texCoord ){\nvec2 texelSize = 1.0 / mapSize;\ntexCoord -= texelSize / 2.0;\nvec4 nSum = vec4( 0.0 );\nfloat nDenom = 0.0;\nvec2 cell = fract( texCoord * mapSize );\nfor( float m = -1.0; m <= 2.0; ++m ){\nfor( float n = -1.0; n <= 2.0; ++n ){\nvec4 vecData = texture2D(\ntex, texCoord + texelSize * vec2( m, n )\n);\nfloat c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );\nnSum += vecData * c;\nnDenom += c;\n}\n}\nreturn nSum / nDenom;\n}\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( CUBIC_INTERPOLATION )\ngl_FragColor = biCubic( map, vUv );\n#else\ngl_FragColor = texture2D( map, vUv );\n#endif\n#if defined( PICKING )\nif( gl_FragColor.a < 0.3 )\ndiscard;\ngl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );\n#else\nif( gl_FragColor.a < 0.01 )\ndiscard;\ngl_FragColor.a *= opacity;\n#include fog_fragment\n#endif\n}");const og=new Uint16Array([0,1,2,1,3,2]),ag=new Float32Array([0,1,0,0,1,1,1,0]),lg=Object.assign({filter:"nearest",forceTransparent:!0},Zp),cg=Object.assign({filter:{updateShader:!0,uniform:!0}},Qp);class ug extends Jp{constructor(e,t){super({position:e.position,index:og,picking:e.picking},t),this.parameterTypes=cg,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:i,height:r}=e,s=new mo(n,i,r);s.flipY=!0,this.tex=s;const o=n.length,a=new Uint8Array(o);for(let e=0;e<o;e+=4){const t=e/4;a[e]=t>>16&255,a[e+1]=t>>8&255,a[e+2]=255&t}const l=new mo(a,i,r);l.flipY=!0,l.minFilter=k,l.magFilter=k,this.pickingTex=l,this.addUniforms({map:{value:s},pickingMap:{value:l},mapSize:{value:new Ne(i,r)}}),this.geometry.setAttribute("uv",new Nn(ag,2))}get defaultParameters(){return lg}getDefines(e){const t=super.getDefines(e),n=this.parameters.filter;return n.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?t.BSPLINE_FILTER=1:n.endsWith("catmulrom")?t.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=k,e.magFilter=k):"linear"===t?(e.minFilter=L,e.magFilter=L):(e.minFilter=k,e.magFilter=k),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=1,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=1,t.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=1,n.needsUpdate=!0}setUniforms(e){e&&void 0!==e.filter&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class hg{constructor(e,t){const n=t||{};this.dimension=Aa(n.dimension,"x"),this.positionType=Aa(n.positionType,"percent"),this.position=Aa(n.position,30),this.thresholdType=Aa(n.thresholdType,"sigma"),this.thresholdMin=Aa(n.thresholdMin,-1/0),this.thresholdMax=Aa(n.thresholdMax,1/0),this.normalize=Aa(n.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,n=this.volume,i=n.matrix,r=(new ut).setFromMatrixPosition(i)[t],s=(new ut).setFromMatrixScale(i)[t];let o;return o="x"===t?n.nx:"y"===t?n.ny:n.nz,Math.round(((e-r)/(o/100)+1)/s)}getData(e){e=e||{};const t=this.volume,n=t.data,i=t.matrix;let r;function s(e){return Math.round(e/100*(r-1))}function o(e,n,i,r){return 3*(i*t.ny*t.nx+n*t.nx+e)+r}r="coordinate"===this.positionType?this.getPositionFromCoordinate(this.position):this.position;const a=new Float32Array(12),l=new ut;let c,u,h,d,p,f=0,m=0,g=0,_=t.nx,v=t.ny,y=t.nz;function b(e,t,n,r){l.set(e,t,n).applyMatrix4(i).toArray(a,r)}"x"===this.dimension?(h=s(t.nx),d=t.ny-1,p=t.nz-1,c=t.nz,u=t.ny,f=h,_=f+1,b(h,0,0,0),b(h,d,0,3),b(h,0,p,6),b(h,d,p,9)):"y"===this.dimension?(h=t.nx-1,d=s(t.ny),p=t.nz-1,c=t.nz,u=t.nx,m=d,v=m+1,b(0,d,0,0),b(h,d,0,3),b(0,d,p,6),b(h,d,p,9)):"z"===this.dimension&&(h=t.nx-1,d=t.ny-1,p=s(t.nz),c=t.nx,u=t.ny,g=p,y=g+1,b(0,0,p,0),b(0,d,p,3),b(h,0,p,6),b(h,d,p,9));let x=0,w=0;const S=new Uint8Array(c*u*4),A=new Float32Array(c*u);let M,C;"sigma"===this.thresholdType?(M=t.getValueForSigma(this.thresholdMin),C=t.getValueForSigma(this.thresholdMax)):(M=this.thresholdMin,C=this.thresholdMax);const T=Object.assign({},e.colorParams,{volume:t});this.normalize&&(T.domain=[0,1]);const E=ic.getScheme(T),P=new Float32Array(3),I=E.getScale();let k,R=0,D=0;if(this.normalize){R=1/0,k=-1/0;for(let e=m;e<v;++e)for(let t=f;t<_;++t)for(let i=g;i<y;++i){const r=n[o(t,e,i,0)/3];r<R&&(R=r),r>k&&(k=r)}D=k-R}for(let e=m;e<v;++e)for(let t=f;t<_;++t)for(let i=g;i<y;++i){const r=o(t,e,i,0)/3;let s=n[r];this.normalize&&(s=(s-R)/D),E.colorToArray(I(s),P),S[x]=Math.round(255*P[0]),S[x+1]=Math.round(255*P[1]),S[x+2]=Math.round(255*P[2]),S[x+3]=s>M&&s<C?255:0,A[w]=r,++w,x+=4}const L=new bp(A,t);return{position:a,imageData:S,width:c,height:u,picking:L}}}class dg extends sh{constructor(e,t,n){super(e,t,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(n)}init(e){const t=this.volume,n=e||{};n.colorDomain=Aa(n.colorDomain,[t.min,t.max]),n.colorScheme=Aa(n.colorScheme,"value"),n.colorScale=Aa(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=Aa(n.dimension,"x"),this.filter=Aa(n.filter,"cubic-bspline"),this.positionType=Aa(n.positionType,"percent"),this.position=Aa(n.position,30),this.thresholdType=Aa(n.thresholdType,"sigma"),this.thresholdMin=Aa(n.thresholdMin,-1/0),this.thresholdMax=Aa(n.thresholdMax,1/0),this.normalize=Aa(n.normalize,!1),super.init(n),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}create(){const e=new hg(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new ug(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function pg(e){Yl.error(`makeRepresentation: representation type ${e} unknown`)}const fg={name:"some element",status:""};class mg{constructor(e,t={}){this.stage=e,this.signals={statusChanged:new va.Signal,nameChanged:new va.Signal,disposed:new va.Signal},this.parameters=Ma(t,this.defaultParameters),this.uuid=Ka()}get defaultParameters(){return fg}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const gg=Object.assign({visible:!0},fg);class _g extends mg{constructor(e,t,n={},i){super(e,Object.assign({name:t.type},n)),this.parent=i,this.signals=Object.assign({visibilityChanged:new va.Signal,parametersChanged:new va.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return gg}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const vg=new zt,yg=new ut,bg={name:"",status:"",visible:!0};class xg{constructor(e,t,n={}){this.stage=e,this.object=t,this.signals={representationAdded:new va.Signal,representationRemoved:new va.Signal,visibilityChanged:new va.Signal,matrixChanged:new va.Signal,statusChanged:new va.Signal,nameChanged:new va.Signal,disposed:new va.Signal},this.reprList=[],this.annotationList=[],this.matrix=new zt,this.position=new ut,this.quaternion=new ct,this.scale=new ut(1,1,1),this.transform=new zt,this.parameters=Ma(n,this.defaultParameters),this.uuid=Ka(),this.viewer=e.viewer,this.controls=new Af(this)}get defaultParameters(){return bg}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(3===e.length){const t=(new Kt).fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Kt?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(yg);this.matrix.makeTranslation(-e.x,-e.y,-e.z),vg.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(vg),vg.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(vg);const t=this.position;vg.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(vg),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach((e=>{e.setParameters({matrix:this.matrix})}))}addAnnotation(e,t,n){const i=new bf(this,e,t,n);return this.annotationList.push(i),i}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);-1!==t&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation((e=>e.dispose())),this.annotationList.length=0}_addRepresentation(e,t,n,i=!1){const r=n||{},s=this.stage.getParameters();r.matrix=this.matrix.clone(),r.quality=r.quality||s.quality,r.disableImpostor=Aa(r.disableImpostor,!s.impostor),r.useWorker=Aa(r.useWorker,s.workerDefault),r.visible=Aa(r.visible,!0);const o=Object.assign({},r,{visible:this.parameters.visible&&r.visible}),a=function(e,t,n,i){var r;if(Ql&&Yl.time("makeRepresentation "+e),t instanceof Fm){if(!(r=sc.get(e)))return void pg(e)}else if(t instanceof jp)if("surface"===e)r=af;else{if("dot"!==e)return void pg(e);r=sg}else if(t instanceof qp)if("surface"===e)r=af;else if("dot"===e)r=sg;else{if("slice"!==e)return void pg(e);r=dg}else if(t instanceof Vm)r=Hm,t=t.getBufferList();else{if("buffer"!==e)return void Yl.error("makeRepresentation: object "+t+" unknown");r=Hm}const s=new r(t,n,i);return Ql&&Yl.timeEnd("makeRepresentation "+e),s}(e,t,this.viewer,o),l=new _g(this.stage,a,r,this);return i||(this.reprList.push(l),this.signals.representationAdded.dispatch(l)),l}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return-1!==this.reprList.indexOf(e)}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);-1!==t&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach((t=>t.update(e))),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation((e=>e.dispose()))}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation((e=>e.updateVisibility())),this.eachAnnotation((e=>e.updateVisibility())),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(...e){return this.getBoxUntransformed(...e).clone().applyMatrix4(this.matrix)}getCenter(...e){return this.getCenterUntransformed(...e).clone().applyMatrix4(this.matrix)}getZoom(...e){return this.stage.getZoomForBox(this.getBox(...e))}getBoxUntransformed(...e){return new pt}getCenterUntransformed(...e){return this.getBoxUntransformed().getCenter(new ut)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),Aa(e,0))}}class wg{constructor(e=[]){this.list=e;const t=e.length;for(let n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);-1!==t&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach((e=>e.dispose()))}}class Sg extends wg{setParameters(e){return this.forEach((t=>t.setParameters(e)))}setVisibility(e){return this.forEach((t=>t.setVisibility(e)))}setSelection(e){return this.forEach((t=>t.setSelection(e)))}setColor(e){return this.forEach((t=>t.setColor(e)))}update(e){return this.forEach((t=>t.update(e)))}build(e){return this.forEach((t=>t.build(e)))}dispose(e){return this.forEach((e=>e.dispose()))}}const Ag=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},fg);class Mg extends mg{constructor(e,t,n={}){super(e,Object.assign({name:t.name},n)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new va.Signal,playerChanged:new va.Signal,countChanged:new va.Signal,parametersChanged:new va.Signal}),t.signals.frameChanged.add((e=>{this.signals.frameChanged.dispatch(e)})),t.signals.playerChanged.add((e=>{this.signals.playerChanged.dispatch(e)})),t.signals.countChanged.add((e=>{this.signals.countChanged.dispatch(e)})),void 0!==n.initialFrame&&this.setFrame(n.initialFrame)}get defaultParameters(){return Ag}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(e={}){this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class Cg{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class Tg{constructor(e,t){let n,i;if(this.A=new Ap(3,3),this.W=new Ap(1,3),this.U=new Ap(3,3),this.V=new Ap(3,3),this.VH=new Ap(3,3),this.R=new Ap(3,3),this.tmp=new Ap(3,3),this.c=new Ap(3,3),e instanceof Fm)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof Fm)i=t.atomCount;else{if(!(t instanceof Float32Array))return;i=t.length/3}const r=Math.min(n,i),s=new Ap(3,r),o=new Ap(3,r);this.coords1t=new Ap(r,3),this.coords2t=new Ap(r,3),this.transformationMatrix=new zt,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,s,r,!1),this.prepCoords(t,o,r,!1),this._superpose(s,o)}_superpose(e,t){this.mean1=Ep(e),this.mean2=Ep(t),Pp(e,this.mean1),Pp(t,this.mean2),Mp(this.coords1t,e),Mp(this.coords2t,t),Cp(this.A,this.coords2t,this.coords1t),Rp(this.A,this.W,this.U,this.V),function(e,t){const n=e.data,i=t.data,r=n[4],s=n[8],o=n[5],a=n[7],l=n[0],c=l*r,u=l*o,h=n[3],d=n[1],p=h*d,f=n[2],m=h*f,g=n[6],_=g*d,v=g*f,y=1/(c*s-u*a-p*s+m*a+_*o-v*r);i[0]=(r*s-o*a)*y,i[1]=-(d*s-f*a)*y,i[2]=-(-d*o+f*r)*y,i[3]=-(h*s-o*g)*y,i[4]=(l*s-v)*y,i[5]=-(u-m)*y,i[6]=-(-h*a+r*g)*y,i[7]=-(l*a-_)*y,i[8]=(c-p)*y}(this.V,this.VH),Tp(this.R,this.U,this.VH),function(e){const t=e.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]}(this.R)<0&&(Ql&&Yl.log("R not a right handed system"),Tp(this.tmp,this.c,this.VH),Tp(this.R,this.U,this.tmp));const n=new Ap(4,4),i=new Ap(4,4),r=new Ap(4,4),s=new Ap(4,4),o=new Ap(4,4),a=new Ap(4,4),l=this.R.data,c=this.mean1,u=this.mean2;s.data.set([1,0,0,-c[0],0,1,0,-c[1],0,0,1,-c[2],0,0,0,1]),o.data.set([l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1]),a.data.set([1,0,0,u[0],0,1,0,u[1],0,0,1,u[2],0,0,0,1]),Mp(i,s),Cp(n,o,i),Mp(r,n),Cp(i,a,r),Mp(n,i),this.transformationMatrix.elements=n.data}prepCoords(e,t,n,i){let r=0;const s=t.data;let o=3,a=3*n;if(i&&(a=4*n,o=4),e instanceof Fm)e.eachAtom((function(e){r<a&&(s[r+0]=e.x,s[r+1]=e.y,s[r+2]=e.z,i&&(s[r+3]=1),r+=o)}));else if(e instanceof Float32Array)for(;r<a;r+=o)r<a&&(s[r]=e[r],s[r+1]=e[r+1],s[r+2]=e[r+2],i&&(s[r+3]=1));else Yl.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof Fm)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const n=new Ap(4,t),i=new Ap(t,4);this.prepCoords(e,n,t,!0);const r=this.transformationMatrix,s=r.determinant();if(!s)return s;const o=new Ap(4,4);o.data=r.elements,function(e,t,n){let i=0,r=0,s=0,o=0,a=0,l=0,c=0,u=0;const h=t.cols,d=t.rows,p=n.cols,f=t.data,m=n.data,g=e.data;let _=0;for(;i<d;o+=h,i++)for(c=0,r=0;r<p;u++,c++,r++){for(l=c,a=o,_=0,s=0;s<h;a++,l+=p,s++)_+=f[a]*m[l];g[u]=_}}(i,n,o);let a=0;const l=i.data;if(e instanceof Fm){e.eachAtom((function(e){e.x=l[a],e.y=l[a+1],e.z=l[a+2],a+=4}));const t=new zt;t.copy(r).invert();const n=e.biomolDict;for(let e in n)n.hasOwnProperty(e)&&n[e].partList.forEach((function(e){e.matrixList.forEach((function(e){e.premultiply(r),e.multiply(t)}))}))}else if(e instanceof Float32Array){const n=4*t;for(;a<n;a+=4)e[a]=l[a],e[a+1]=l[a+1],e[a+2]=l[a+2]}else Yl.warn("transform: input type unknown");return this.transformationMatrix}}const Eg={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class Pg{constructor(e,t={}){this.signals={startedRunning:new va.Signal,haltedRunning:new va.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add((e=>{e!==this&&this.pause()}),this);const n=Aa(e.frameCount,1);this.traj=e,this.parameters=Ma(t,Eg),this.parameters.end=Math.min(Aa(t.end,n-1),n-1),this.parameters.step=Aa(t.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction="bounce"===this.parameters.direction?"forward":this.parameters.direction,e.signals.countChanged.add((e=>{this.parameters.end=Math.min(Aa(this.parameters.end,e-1),e-1)}),this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(e={}){Ca(this.parameters,e),void 0!==e.direction&&"bounce"!==this.parameters.direction&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,i=this.traj;if(i&&i.frameCount&&!i.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),1===this._currentStep&&(this._currentFrame=this._nextInterpolated()),i.hasFrame(this._currentFrame)){this._currentStep+=1;const e=this._currentStep/(this.parameters.interpolateStep+1),[t,n,r,s]=this._currentFrame;i.setFrameInterpolated(t,n,r,s,e,this.parameters.interpolateType),this._previousTime=this._currentTime}else i.loadFrame(this._currentFrame);else{const e=this._next();i.hasFrame(e)?(i.setFrame(e),this._previousTime=this._currentTime):i.loadFrame(e)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t="forward"===this._direction?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&("bounce"===e.direction&&("forward"===this._direction?this._direction="backward":this._direction="forward"),"once"===e.mode?(this.pause(),t="forward"===e.direction?e.end:"backward"===e.direction||"forward"===this._direction?e.start:e.end):"forward"===this._direction?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let n,i,r;return"forward"===this._direction?(n=Math.max(e.start,t-e.step),i=Math.max(e.start,t-2*e.step),r=Math.max(e.start,t-3*e.step)):(n=Math.min(e.end,t+e.step),i=Math.min(e.end,t+2*e.step),r=Math.min(e.end,t+3*e.step)),[t,n,i,r]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let n=Math.ceil(t/e.step)*e.step;"forward"===e.direction&&t>=e.end?n=e.start:"backward"===e.direction&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class Ig{constructor(e,t,n={}){this.signals={countChanged:new va.Signal,frameChanged:new va.Signal,playerChanged:new va.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=Aa(n.deltaTime,0),this.timeOffset=Aa(n.timeOffset,0),this.centerPbc=Aa(n.centerPbc,!1),this.removePbc=Aa(n.removePbc,!1),this.removePeriodicity=Aa(n.removePeriodicity,!1),this.superpose=Aa(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new Ll(Aa(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add((()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}))}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new Pg(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new Ll("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,(()=>this._saveInitialCoords()))}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const n=e.test,i=[];return n&&this.structure.eachAtom((e=>{n(e)&&i.push(t),t+=1})),i}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,n=this.coords2;for(let i=0;i<e;i+=3){const e=3*this.selectionIndices[i/3];n[i+0]=t[e+0],n[i+1]=t[e+1],n[i+2]=t[e+2]}}_makeAtomIndices(){Yl.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(e={}){let t=!1;void 0!==e.centerPbc&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),void 0!==e.removePeriodicity&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),void 0!==e.removePbc&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),void 0!==e.superpose&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=Aa(e.deltaTime,this.deltaTime),this.timeOffset=Aa(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every((e=>!!this.frameCache[e])):!!this.frameCache[e]}setFrame(e,t){return void 0===e||(this.inProgress=!0,-1===e||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,(()=>{this._updateStructure(e),t&&t()}))),this}_interpolate(e,t,n,i,r,s){const o=this.frameCache;let a;a="spline"===s?function(e,t,n,i,r){const s=e.length,o=new Float32Array(s);for(let a=0;a<s;a+=3){const s=a+1,l=a+2;o[a]=Ja(i[a],n[a],t[a],e[a],r,1),o[s]=Ja(i[s],n[s],t[s],e[s],r,1),o[l]=Ja(i[l],n[l],t[l],e[l],r,1)}return o}(o[e],o[t],o[n],o[i],r):function(e,t,n){const i=e.length,r=new Float32Array(i);for(let s=0;s<i;s+=3){const i=s+1,o=s+2;r[s]=Qa(t[s],e[s],n),r[i]=Qa(t[i],e[i],n),r[o]=Qa(t[o],e[o],n)}return r}(o[e],o[t],r),this.structure.updatePosition(a),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,n,i,r,s,o){if(void 0===e)return this;const a=this.frameCache,l=[];return a[i]||l.push(i),a[n]||l.push(n),a[t]||l.push(t),a[e]||l.push(e),l.length?this.loadFrame(l,(()=>{this._interpolate(e,t,n,i,r,s),o&&o()})):(this._interpolate(e,t,n,i,r,s),o&&o()),this}loadFrame(e,t){Array.isArray(e)?e.forEach((e=>{this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e]})))})):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e],t&&t()})))}_loadFrame(e,t){Yl.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(-1===e?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,n=this.coords1,i=this.coords2;for(let i=0;i<t;i+=3){const t=3*this.selectionIndices[i/3];n[i+0]=e[t+0],n[i+1]=e[t+1],n[i+2]=e[t+2]}new Tg(n,i).transform(e)}_process(e,t,n,i){if(this._setFrameCount(i),t){if(this.backboneIndices.length>0&&this.centerPbc){const e=[t[0],t[4],t[8]],i=function(e,t,n){return[Vc(t,n[0],3,0,e),Vc(t,n[1],3,1,e),Vc(t,n[2],3,2,e)]}(this.backboneIndices,n,e);!function(e,t,n){if(0===n[0]||0===n[8]||0===n[4])return;const i=e.length,r=n[0],s=n[1],o=n[2],a=-t[0]+r+r/2,l=-t[1]+s+s/2,c=-t[2]+o+o/2;for(let t=0;t<i;t+=3)e[t+0]=(e[t+0]+a)%r,e[t+1]=(e[t+1]+l)%s,e[t+2]=(e[t+2]+c)%o}(n,i,e)}this.removePeriodicity&&function(e,t,n){if(0===t[0]||0===t[8]||0===t[4])return;const i=e.length;for(let r=3;r<i;r+=3)for(let i=0;i<3;++i){const s=(e[r+i]-n[i])/t[3*i+i];Math.abs(s)>.5&&(e[r+i]-=t[3*i+i]*Math.round(s))}}(n,t,function(e){return[eu(e,3,0),eu(e,3,1),eu(e,3,2)]}(n)),this.removePbc&&function(e,t){if(0===t[0]||0===t[8]||0===t[4])return;const n=e.length;for(let i=3;i<n;i+=3)for(let n=0;n<3;++n){const r=e[i+n]-e[i-3+n];if(Math.abs(r)>.9*t[3*n+n])if(r>0)for(let r=0;r<3;++r)e[i+r]-=t[3*n+r];else for(let r=0;r<3;++r)e[i+r]+=t[3*n+r]}}(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class kg extends Ig{constructor(e,t,n){const i=n||{};i.timeOffset=Aa(i.timeOffset,e.timeOffset),i.deltaTime=Aa(i.deltaTime,e.deltaTime),super("",t,i),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){"StructureView"===this.structure.type?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.frames[e];if(this.atomIndices){const e=this.atomIndices,t=e.length;n=new Float32Array(3*t);for(let r=0;r<t;++r){const t=3*r,s=3*e[r];n[t+0]=i[s+0],n[t+1]=i[s+1],n[t+2]=i[s+2]}}else n=new Float32Array(i);const r=this.boxes[e],s=this.frames.length;this._process(e,r,n,s),"function"==typeof t&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class Rg extends Ig{constructor(e,t,n){super("",t,n),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.structure,r=i.frames[e];if(this.atomIndices){const e=this.atomIndices,t=e.length;n=new Float32Array(3*t);for(let i=0;i<t;++i){const t=3*i,s=3*e[i];n[t+0]=r[s+0],n[t+1]=r[s+1],n[t+2]=r[s+2]}}else n=new Float32Array(r);const s=i.boxes[e],o=i.frames.length;this._process(e,s,n,o),"function"==typeof t&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class Dg extends Ig{constructor(e,t,n){super(e,t,n),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if("StructureView"===this.structure.type){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],r=t[0];for(let s=1;s<n;++s){const n=t[s];r+1<n&&(e.push([i,r+1]),i=n),r=n}e.push([i,r+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){const n=new XMLHttpRequest,i=pc.getFrameUrl(this.trajPath,e),r=pc.getFrameParams(this.trajPath,this.atomIndices);n.open("POST",i,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("load",(()=>{const r=n.response;if(!r)return void Yl.error(`empty arrayBuffer for '${i}'`);const s=new Int32Array(r,0,1)[0],o=new Float32Array(r,8,9),a=new Float32Array(r,44);this._process(e,o,a,s),"function"==typeof t&&t()}),!1),n.send(r)}_loadFrameCount(){const e=new XMLHttpRequest,t=pc.getCountUrl(this.trajPath);e.open("GET",t,!0),e.addEventListener("load",(()=>{this._setFrameCount(parseInt(e.response))}),!1),e.send()}}class Lg extends Ig{constructor(e,t,n){super("",t,n),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if("StructureView"===this.structure.type){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],r=t[0];for(let s=1;s<n;++s){const n=t[s];r+1<n&&(e.push([i,r+1]),i=n),r=n}e.push([i,r+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback(((e,n,i,r)=>{this._process(e,n,i,r),"function"==typeof t&&t()}),e,this.atomIndices)}_loadFrameCount(){this.requestCallback((e=>this._setFrameCount(e)))}}Fm.prototype.getView=function(e){return new Og(this,e)};class Og extends Fm{constructor(e,t){super(),this.structure=e,this.selection=t,this.center=new ut,this.boundingBox=new pt,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){Ql&&Yl.time("StructureView.refresh"),this.atomSetCache={};const e=this.structure;if(this.selection.isAllSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=e.atomSet.clone(),this.bondSet=e.bondSet.clone();for(let e in this.atomSetDict){const t=this.atomSetDict[e];this.atomSetCache["__"+e]=t.clone()}this.atomCount=e.atomCount,this.bondCount=e.bondCount,this.boundingBox.copy(e.boundingBox),this.center.copy(e.center)}else if(this.selection.isNoneSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=new Jh(e.atomCount),this.bondSet=new Jh(e.bondCount);for(let t in this.atomSetDict)this.atomSetCache["__"+t]=new Jh(e.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),e.atomSet&&(this.atomSet=this.atomSet.intersection(e.atomSet)),this.bondSet=this.getBondSet();for(let e in this.atomSetDict){const t=this.atomSetDict[e];this.atomSetCache["__"+e]=t.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new ut)}Ql&&Yl.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const n=this.structure.getSelection();n&&n.string&&t.push(n.string),this.selection&&this.selection.string&&t.push(this.selection.string);let i="";return t.length>0&&(i=`( ${t.join(" ) AND ( ")} )`),new Ll(i)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const n=this.getAtomProxy(),i=this.getAtomSet(t),r=this.atomStore.count;if(i.getSize()<r)i.forEach((function(t){n.index=t,e(n)}));else for(let t=0;t<r;++t)n.index=t,e(n)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e,t=!1){let n=this.structure.getAtomSet(e);return!t&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(e){return this.structure.getAtomIndices(this.getSelection(e))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new Fm,delete this.atomSet,delete this.bondSet}}function Ng(e,t){let n,i=0;const r={};return t.forEach((function(t){n=0;const s={};t.forEach((function(t){s[e[n++]]=t})),r[e[i++]]=s})),r}const Fg={blosum62:Ng("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:Ng("ACDEFGHIKLMNPQRSTVWY",[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]])};class Bg{constructor(e,t,n=-10,i=-1,r="blosum62"){this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=i,r&&(this.substMatrix=Fg[r])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(i,r){const s=e[i],o=t[r];try{return n[s][o]}catch(e){return-4}}:(Yl.warn("Alignment: no subst matrix"),function(n,i){return e[n]===t[i]?5:-3})}calc(){Ql&&Yl.time("Alignment.calc"),this.initMatrices();const e=this.gap(0),t=this.makeScoreFn(),n=this.gapExtensionPenalty,i=this.V,r=this.H,s=this.S,o=this.n,a=this.m;let l,c,u,h,d;for(let p=1;p<=o;++p){c=s[p-1],l=i[p-1],u=i[p],h=r[p],d=s[p];for(let i=1;i<=a;++i)u[i]=Math.max(c[i]+e,l[i]+n),h[i]=Math.max(d[i-1]+e,h[i-1]+n),d[i]=Math.max(c[i-1]+t(p-1,i-1),u[i],h[i])}Ql&&Yl.timeEnd("Alignment.calc"),Ql&&Yl.log(this.S,this.V,this.H)}trace(){Ql&&Yl.time("Alignment.trace"),this.ali1="",this.ali2="";const e=this.makeScoreFn();let t,n=this.n,i=this.m;for(this.S[n][i]>=this.V[n][i]?(t="S",this.score=this.S[n][i]):this.V[n][i]>=this.H[n][i]?(t="V",this.score=this.V[n][i]):(t="H",this.score=this.H[n][i]),Ql&&Yl.log("Alignment: SCORE",this.score),Ql&&Yl.log("Alignment: S, V, H",this.S[n][i],this.V[n][i],this.H[n][i]);n>0&&i>0;)"S"===t?this.S[n][i]===this.S[n-1][i-1]+e(n-1,i-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--n,--i,t="S"):this.S[n][i]===this.V[n][i]?t="V":this.S[n][i]===this.H[n][i]?t="H":(--n,--i):"V"===t?this.V[n][i]===this.V[n-1][i]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="V"):this.V[n][i]===this.S[n-1][i]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="S"):--n:"H"===t?this.H[n][i]===this.H[n][i-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="H"):this.H[n][i]===this.S[n][i-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="S"):--i:Yl.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;i>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i;Ql&&Yl.timeEnd("Alignment.trace"),Ql&&Yl.log([this.ali1,this.ali2])}}function Ug(e,t,n=!1,i="",r=""){let s,o,a,l,c;if(n){let n=e,u=t;i&&r&&(n=e.getView(new Ll(i)),u=t.getView(new Ll(r)));const h=n.getSequence(),d=u.getSequence(),p=new Bg(h.join(""),d.join(""));let f,m;p.calc(),p.trace(),s=0,o=0,a=p.ali1.length;const g=[],_=[];for(let e=0;e<a;++e){const t=p.ali1[e],n=p.ali2[e];f=0,m=0,"-"===t?_[o]=!1:(_[o]=!0,f=1),"-"===n?g[s]=!1:(g[s]=!0,m=1),s+=f,o+=m}const v=[],y=[],b=n.getAtomProxy(),x=u.getAtomProxy();s=0,n.eachResidue((function(e){void 0!==e.traceAtomIndex&&e.traceAtomIndex===e.getAtomIndexByName("CA")&&(g[s]&&(b.index=e.getAtomIndexByName("CA"),v.push(b.x,b.y,b.z)),s+=1)})),s=0,u.eachResidue((function(e){void 0!==e.traceAtomIndex&&e.traceAtomIndex===e.getAtomIndexByName("CA")&&(_[s]&&(x.index=e.getAtomIndexByName("CA"),y.push(x.x,x.y,x.z)),s+=1)})),l=new Float32Array(v),c=new Float32Array(y)}else l=e.getView(new Ll(`${i} and .CA`)),c=t.getView(new Ll(`${r} and .CA`));const u=new Tg(l,c).transform(e);return e.refreshPosition(),u}const zg=Object.assign({sele:"",defaultAssembly:""},bg);class Vg extends xg{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new va.Signal,trajectoryRemoved:new va.Signal,defaultAssemblyChanged:new va.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=function(){let e=0,t=0;const n=[];return{has:function(e){return-1!==n.indexOf(e)},get:function(e){return n[e]},push:function(i){n[e]=i,e=(4+e+1)%4,++t},get count(){return t},get data(){return n.slice(0,Math.min(t,4))},clear:function(){t=0,e=0,n.length=0}}}(),this.pickDict=function(){const e={};return{has:function(t){return void 0!==e[JSON.stringify(t)]},add:function(t,n){e[JSON.stringify(t)]=n},del:function(t){delete e[JSON.stringify(t)]},get values(){return Object.keys(e).map((t=>e[t]))}}}(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:Kl.opacity,color:Kl.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",Kl,!0),this.angleRepresentation=this.addRepresentation("angle",Kl,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",Kl,!0),this.measureRepresentations=new Sg([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add((()=>{this.updateRepresentations({position:!0})}))}get defaultParameters(){return zg}get type(){return"structure"}initSelection(e){this.selection=new Ll(e),this.structureView=new Og(this.structure,this.selection),this.selection.signals.stringChanged.add((()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()}))}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(void 0===this.structure.biomolDict[e]&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach((e=>e.setParameters(t))),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach((e=>{e.build()})),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach((e=>{e.trajectory.setStructure(this.structureView)}))}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e,t={},n=!1){t.defaultAssembly=this.parameters.defaultAssembly;const i=this._addRepresentation(e,this.structureView,t,n);return n||i.signals.parametersChanged.add((()=>this.measureUpdate())),i}addTrajectory(e="",t={}){const n=function(e,t,n){let i;return i=e&&e instanceof Cg?new kg(e,t,n):!e&&t.frames?new Rg(e,t,n):e&&"function"==typeof e?new Lg(e,t,n):new Dg(e,t,n),i}(e,this.structureView,t),i=new Mg(this.stage,n,t);return this.trajList.push(i),this.signals.trajectoryAdded.dispatch(i),i}removeTrajectory(e){const t=this.trajList.indexOf(e);-1!==t&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach((e=>e.dispose())),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){"number"==typeof e&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),Aa(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new Ll(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&"string"==typeof e?this.structure.atomCenter(new Ll(e)):this.structure.center}superpose(e,t,n,i){return Ug(this.structureView,e.structureView,t,n,i),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const n=this.structure.getAtomProxy(e);return this.eachRepresentation((e=>{if(e.getVisibility()){const i=e.repr;t=Math.max(i.getAtomRadius(n),t)}})),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const e=this.pickBuffer.data,n=this.pickBuffer.data.sort();this.pickDict.has(n)?this.pickDict.del(n):this.pickDict.add(n,e),2===t?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter((e=>2===e.length))}):3===t?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter((e=>3===e.length))}):4===t&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter((e=>4===e.length))})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach((e=>{const n=Math.max(.1,this.getMaxRepresentationRadius(e));t[e]=n*(2.3-el(.1,2,n))})),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter((e=>2===e.length)),angle:e.filter((e=>3===e.length)),dihedral:e.filter((e=>4===e.length))}}removeAllMeasurements(e){const t=this.pickDict,n=t.values,i=function(e){n.filter((t=>t.length===e)).forEach((e=>t.del(e.slice().sort())))};(!e||1&e)&&i(2),(!e||2&e)&&i(3),(!e||4&e)&&i(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}cc.add("structure",Vg),cc.add("structureview",Vg);class Hg extends xg{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.surface=t}get type(){return"surface"}addRepresentation(e,t={}){return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}cc.add("surface",Hg);class $g extends xg{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.volume=t}get type(){return"volume"}addRepresentation(e,t={}){return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}cc.add("volume",$g);class Gg extends wg{addRepresentation(e,t){return this.forEach((n=>n.addRepresentation(e,t)))}autoView(e){return this.forEach((t=>t.autoView(e)))}}function jg(e,t){return e instanceof RegExp?null!==t.name.match(e):t.name===e}const Wg=new ut,qg={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1.2,ambientColor:14540253,ambientIntensity:.3,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class Xg{constructor(e,t={}){this.signals={parametersChanged:new va.Signal,fullscreenChanged:new va.Signal,componentAdded:new va.Signal,componentRemoved:new va.Signal,clicked:new va.Signal,hovered:new va.Signal},this.tasks=new Rc,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new vu(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new Su(this.viewer.renderer.domElement),this.viewerControls=new qu(this),this.trackballControls=new Ou(this),this.pickingControls=new Bu(this),this.animationControls=new ih(this),this.mouseControls=new hf(this),this.keyControls=new ff(this),this.pickingBehavior=new mf(this),this.mouseBehavior=new gf(this),this.animationBehavior=new _f(this),this.keyBehavior=new yf(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=Ma(t,qg),this.setParameters(this.parameters),this.viewer.animate())}setParameters(e={}){Ca(this.parameters,e);const t=e,n=this.parameters,i=this.viewer,r=this.trackballControls;return void 0!==t.quality&&this.setQuality(n.quality),void 0!==t.impostor&&this.setImpostor(n.impostor),void 0!==t.rotateSpeed&&(r.rotateSpeed=n.rotateSpeed),void 0!==t.zoomSpeed&&(r.zoomSpeed=n.zoomSpeed),void 0!==t.panSpeed&&(r.panSpeed=n.panSpeed),void 0!==t.mousePreset&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),i.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),i.setFog(void 0,n.fogNear,n.fogFar),i.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),i.setSampling(n.sampleLevel),i.setBackground(n.backgroundColor),i.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(e){console.log("STAGE LOG",e),this.logList.push(e)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(e){if(e instanceof Vg){let t,n,i;e.setSelection("/0");const r=e.structure;if(r.biomolDict.BU1){const s=r.biomolDict.BU1;t=s.getAtomCount(r),n=s.getResidueCount(r),i=s.getInstanceCount(),e.setDefaultAssembly("BU1")}else t=r.getModelProxy(0).atomCount,n=r.getModelProxy(0).residueCount,i=1;let s=t;Gl&&(s*=4);const o=r.atomStore.count/r.residueStore.count<2;o&&(s*=10);let a="chainname",l="RdYlBu",c=!1;if(1===r.getChainnameCount(new Ll("polymer and /0"))&&(a="residueindex",l="Spectral",c=!0),Ql&&console.log(s,t,i,o),n/i<4)e.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(i>5&&s>15e3||s>7e5){let t=Math.min(2,Math.max(.1,6e3/(s/i)));o&&(t=Math.min(t,.5)),e.addRepresentation("surface",{colorScheme:a,colorScale:l,colorReverse:c,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:t,useWorker:!1})}else s>25e4?e.addRepresentation("backbone",{colorScheme:a,colorScale:l,colorReverse:c,lineOnly:!0}):s>1e5?e.addRepresentation("backbone",{colorScheme:a,colorScale:l,colorReverse:c,quality:"low",disableImpostor:!0,radiusScale:2}):s>8e4?e.addRepresentation("backbone",{colorScheme:a,colorScale:l,colorReverse:c,radiusScale:2}):(e.addRepresentation("cartoon",{colorScheme:a,colorScale:l,colorReverse:c,radiusScale:.7,aspectRatio:5,quality:"auto"}),s<5e4&&e.addRepresentation("base",{colorScheme:a,colorScale:l,colorReverse:c,quality:"auto"}),e.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));e.structure.frames.length&&e.addTrajectory()}else(e instanceof Hg||e instanceof $g)&&e.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(e,t={}){const n=Object.assign({},this.defaultFileParams,t),i=Sc(e).name;this.tasks.increment(),this.log(`loading file '${i}'`);const r=Aa(n.ext,Sc(e).ext);let s;return s=oc.isTrajectory(r)?Promise.reject(new Error(`loadFile: ext '${r}' is a trajectory and must be loaded into a structure component`)):Mc(e,n),s.then((e=>{this.log(`loaded '${i}'`);const t=this.addComponentFromObject(e,n);return n.defaultRepresentation&&this.defaultFileRepresentation(t),this.tasks.decrement(),t}),(e=>{this.tasks.decrement();const t=`error loading file: '${e}'`;throw this.log(t),t}))}loadScript(e){const t=Sc(e).name;return this.log(`loading script '${t}'`),Mc(e).then((e=>{this.tasks.increment(),this.log(`running script '${t}'`),e.run(this).then((()=>{this.tasks.decrement(),this.log(`finished script '${t}'`)})),this.log(`called script '${t}'`)}),(e=>{this.tasks.decrement();const n=`errored script '${t}' "${e}"`;throw this.log(n),n}))}addComponent(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):Yl.warn("Stage.addComponent: no component given")}addComponentFromObject(e,t={}){const n=cc.get(e.type);if(n){const i=new n(this,e,t);return this.addComponent(i),i}Yl.warn("no component for object type",e.type)}removeComponent(e){const t=this.compList.indexOf(e);-1!==t&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))}removeAllComponents(){this.compList.slice().forEach((e=>this.removeComponent(e)))}handleResize(){this.viewer.handleResize()}setSize(e,t){const n=this.viewer.container;n!==document.body&&(void 0!==e&&(n.style.width=e),void 0!==t&&(n.style.height=t),this.handleResize())}toggleFullscreen(e){if(!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))return void Yl.log("fullscreen mode (currently) not possible");const t=this;function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function i(){if(!n()&&t.lastFullscreenElement){const e=t.lastFullscreenElement;e.style.width=e.dataset.normalWidth||"",e.style.height=e.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}e=e||this.viewer.container,this.lastFullscreenElement=e,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout((function(){t.handleResize()}),100))}setSpin(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const e=this.parameters;if("scene"!==e.clipMode)return 0;let t=e.clipNear;return"absolute"===e.clipScale&&(t=this.viewer.absoluteToRelative(t)),2*t}setFocus(e){if("scene"!==this.parameters.clipMode)return;let t,n,i,r;"relative"===this.parameters.clipScale?(t=Za(e/2,0,49.9),n=100-t,i=50,r=function(e){return Za(e,0,100)}(2*n-50)):(t=this.viewer.relativeToAbsolute(e/2),n=t,i=0,r=2*n),this.setParameters({clipNear:t,clipFar:n,fogNear:i,fogFar:r})}getZoomForBox(e){const t=e.getSize(Wg),n=Math.max(t.x,t.y,t.z),i=Math.min(t.x,t.y,t.z);let r=n+Math.sqrt(i);const s=qa(this.viewer.perspectiveCamera.fov),o=this.viewer.width,a=this.viewer.height,l=a<o?1:o/a;return r=Math.abs(.5*r/l/Math.sin(s/2)),r+=this.parameters.clipDist,-r}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(e){return this.getBox().getCenter(e||new ut)}autoView(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),Aa(e,0))}makeImage(e={}){return new Promise(((t,n)=>{this.tasks.onZeroOnce((()=>{this.tasks.increment(),this.viewer.makeImage(e).then((e=>{this.tasks.decrement(),t(e)})).catch((e=>{this.tasks.decrement(),n(e)}))}))}))}setImpostor(e){this.parameters.impostor=e;const t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(n){if(!t.includes(n.getType()))return;const i=n.getParameters();i.disableImpostor=!e,n.build(i)}))}setQuality(e){this.parameters.quality=e;const t=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(i){const r=i.getParameters();if(!t.includes(i.getType())){if(!n.includes(i.getType()))return;if(!r.disableImpostor)return void(i.repr.quality=e)}r.quality=e,i.build(r)}))}eachComponent(e,t){this.compList.slice().forEach((n=>{void 0!==t&&t!==n.type||e(n)}))}eachRepresentation(e,t){this.eachComponent((n=>{n.reprList.slice().forEach((i=>{void 0!==t&&t!==i.getType()||e(i,n)}))}))}getComponentsByName(e){const t=[];return this.eachComponent((n=>{(void 0===e||jg(e,n))&&t.push(n)})),new Gg(t)}getComponentsByObject(e){const t=[];return this.eachComponent((n=>{n.object===e&&t.push(n)})),new Gg(t)}getRepresentationsByName(e){const t=[];return this.eachRepresentation(((n,i)=>{(void 0===e||jg(e,n))&&t.push(n)})),new Sg(t)}measureClear(){this.eachComponent((e=>e.measureClear()),"structure")}measureUpdate(){this.eachComponent((e=>e.measureUpdate()),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class Yg extends xg{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.shape=t}get type(){return"shape"}addRepresentation(e,t={}){return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function Kg(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}function Zg(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}l((i=i.apply(e,t||[])).next())}))}cc.add("shape",Yg),"function"==typeof SuppressedError&&SuppressedError;class Qg extends sl{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=Aa(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel((e=>{this.parameters.domain=[e.atomOffset,e.atomEnd],this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}Kg([rl],Qg.prototype,"atomColor",null),ic.add("atomindex",Qg);class Jg extends sl{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,n=1/0,i=-1/0;e.sele&&(t=new Ll(e.sele)),e.structure.eachAtom((function(e){const t=e.bfactor;n=Math.min(n,t),i=Math.max(i,t)}),t),this.parameters.domain=[n,i]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}Kg([rl],Jg.prototype,"atomColor",null),ic.add("bfactor",Jg);class e_ extends sl{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{let t=0;const n={};e.eachChain((function(e){void 0===n[e.chainid]&&(n[e.chainid]=t,t+=1)})),this.parameters.domain=[0,t-1],this.chainidDictPerModel[e.index]=n,this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}Kg([rl],e_.prototype,"atomColor",null),ic.add("chainid",e_);class t_ extends sl{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{this.parameters.domain=[e.chainOffset,e.chainEnd],this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}Kg([rl],t_.prototype,"atomColor",null),ic.add("chainindex",t_);class n_ extends sl{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{let t=0;const n={};e.eachChain((function(e){void 0===n[e.chainname]&&(n[e.chainname]=t,t+=1)})),this.parameters.domain=[0,t-1],this.chainnameDictPerModel[e.index]=n,this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}Kg([rl],n_.prototype,"atomColor",null),ic.add("chainname",n_);class i_ extends sl{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const n=this.rsrzDict[t];if(void 0!==n)return this.rsrzScale(n);const i=this.rsccDict[t];return void 0!==i?this.rsccScale(i):9474192}}Kg([rl],i_.prototype,"atomColor",null),ic.add("densityfit",i_);const r_={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class s_ extends sl{constructor(e){super(e),this.delta=new ut,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom((e=>{var n;if(this.charges[e.index]=(null!==(n=e).partialCharge?n.partialCharge:n.isProtein()&&(r_[n.resname]&&r_[n.resname][n.atomname]||r_.backbone[n.atomname])||0)*e.occupancy,"N"===e.atomname){if(e.bondCount>=3)return;if(e.bondToElementCount(1))return;const n=function(e,t=new ut){let n=!1,i=!1,r=!1;return t.set(2*e.x,2*e.y,2*e.z),e.eachBondedAtom((function(e){if(!n)return"H"===e.atomname?(t.set(e.x,e.y,e.z),void(n=!0)):void(i||"CA"!==e.atomname?r||"C"!==e.atomname||(r=!0,t.sub(e)):(t.sub(e),i=!0))})),n?t:i&&r?(t.normalize(),t.multiplyScalar(1.04),t.add(e),t):void 0}(e);void 0!==n&&(t.push(n),this.hCharges.push(.25*e.occupancy))}}));const n=e.structure.getBoundingBox();n.expandByScalar(1.04),this.hStore=function(e){const t=e.length,n=new Float32Array(t),i=new Float32Array(t),r=new Float32Array(t);for(let t=0;t<e.length;t++){const s=e[t];n[t]=s.x,i[t]=s.y,r[t]=s.z}return{x:n,y:i,z:r,count:t}}(t),this.hHash=new Yh(this.hStore,n),this.hash=new Yh(e.structure.atomStore,n)}positionColor(e){const t=this.charges,n=this.hCharges;let i=0;return this.hash.eachWithin(e.x,e.y,e.z,12,((e,n)=>{const r=t[e];0!==r&&(i+=r/n)})),this.hHash.eachWithin(e.x,e.y,e.z,12,((e,t)=>{const r=n[e];0!==r&&(i+=r/t)})),this.scale(332*i)}}Kg([rl],s_.prototype,"positionColor",null),ic.add("electrostatic",s_);const o_={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class a_ extends sl{constructor(e){e.value=Aa(e.value,o_.C),super(e)}atomColor(e){const t=e.element;return"C"===t?this.parameters.value:o_[t]||16777215}}Kg([rl],a_.prototype,"atomColor",null),ic.add("element",a_);class l_ extends sl{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}Kg([rl],l_.prototype,"atomColor",null),ic.add("entityindex",l_);class c_ extends sl{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}Kg([rl],c_.prototype,"atomColor",null),ic.add("entitytype",c_);class u_ extends sl{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,n=e.resno+"";e.inscode&&(n+="^"+e.inscode),e.chainname&&(n+=":"+e.chainname),n+="/"+e.modelIndex;const i=this.geoAtomDict[n];var r;return void 0!==i?(r=i[e.atomname]||0,t=16843009*((r=(858993459&(r-=r>>1&1431655765))+(r>>2&858993459))+(r>>4)&252645135)>>24):t=this.geoDict[n]||0,0===t?2188972:1===t?16703627:2===t?16018755:t>=3?10813478:9474192}}Kg([rl],u_.prototype,"atomColor",null),ic.add("geoquality",u_);class h_ extends sl{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");for(const e in vd)this.resHF[e]=vd[e][0];if(this.defaultResidueHydrophobicity=yd[0],!e.domain){let e=1/0,t=-1/0;for(const n in this.resHF){const i=this.resHF[n];e=Math.min(e,i),t=Math.max(t,i)}this.parameters.domain=[e,0,t]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}Kg([rl],h_.prototype,"atomColor",null),ic.add("hydrophobicity",h_);class d_ extends sl{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}Kg([rl],d_.prototype,"atomColor",null),ic.add("modelindex",d_);class p_ extends sl{atomColor(e){switch(e.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}Kg([rl],p_.prototype,"atomColor",null),ic.add("moleculetype",p_);class f_ extends sl{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}Kg([rl],f_.prototype,"atomColor",null),ic.add("occupancy",f_);class m_ extends sl{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function g_(){return 16777215*Math.random()}Kg([rl],m_.prototype,"atomColor",null),ic.add("partialcharge",m_);class __ extends sl{atomColor(){return g_()}volumeColor(){return g_()}positionColor(){return g_()}}Kg([rl],__.prototype,"atomColor",null),Kg([rl],__.prototype,"volumeColor",null),Kg([rl],__.prototype,"positionColor",null),ic.add("random",__);class v_ extends sl{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t=`[${e.resname}]${e.resno}`;e.chainname&&(t+=":"+e.chainname);const n=this.rciDict[t];return void 0!==n?this.rciScale(n):9474192}}Kg([rl],v_.prototype,"atomColor",null),ic.add("randomcoilindex",v_);class y_ extends sl{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=Aa(e.reverse,!0)),e.structure.eachChain((e=>{this.parameters.domain=[e.residueOffset,e.residueEnd],this.scalePerChain[e.index]=this.getScale()}))}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}Kg([rl],y_.prototype,"atomColor",null),ic.add("residueindex",y_);const b_={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class x_ extends sl{atomColor(e){return b_[e.resname]||16711935}}Kg([rl],x_.prototype,"atomColor",null),ic.add("resname",x_);class w_ extends sl{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,n=this.residueProxy;return"h"===t?16711808:"g"===t?10485888:"i"===t?6291584:"e"===t||"b"===t?16762880:"t"===t?6324479:(n.index=e.residueIndex,n.isDna()?11403518:n.isRna()?16580962:n.isSaccharide()?10921722:n.isProtein()||"s"===t||"l"===t?16777215:8421504)}}Kg([rl],w_.prototype,"atomColor",null),ic.add("sstruc",w_);class S_ extends sl{constructor(e){var t,n;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=null===(t=this.parameters.data)||void 0===t?void 0:t.atomData,this.bondData=null===(n=this.parameters.data)||void 0===n?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const n=null===(t=this.atomData)||void 0===t?void 0:t[e.index];return void 0!==n?this.scale(n):this.parameters.value}bondColor(e,t){var n;const i=null===(n=this.bondData)||void 0===n?void 0:n[e.index];return void 0!==i?this.scale(i):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}Kg([rl],S_.prototype,"atomColor",null),Kg([rl],S_.prototype,"bondColor",null),ic.add("structuredata",S_);class A_ extends sl{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}Kg([rl],A_.prototype,"atomColor",null),Kg([rl],A_.prototype,"bondColor",null),Kg([rl],A_.prototype,"valueColor",null),Kg([rl],A_.prototype,"volumeColor",null),ic.add("uniform",A_);class M_ extends sl{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}Kg([rl],M_.prototype,"volumeColor",null),ic.add("value",M_);class C_ extends sl{constructor(e){super(e),this.vec=new ut,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const n=this.vec,i=t.data,r=t.nx,s=t.ny,o=r*s;n.copy(e),n.applyMatrix4(t.inverseMatrix);const a=Math.floor(n.x),l=Math.floor(n.y),c=Math.floor(n.z),u=(c*s+l)*r+a,h=u+1,d=u+r,p=u+o,f=d+1,m=p+1,g=d+o,_=g+1,v=i[u],y=i[h],b=i[d],x=i[p],w=i[f],S=i[m],A=i[g],M=i[_],C=n.x-a,T=n.y-l,E=n.z-c,P=Qa(v,y,C),I=Qa(x,S,C),k=Qa(b,w,C),R=Qa(A,M,C),D=Qa(P,k,T),L=Qa(I,R,T),O=Qa(D,L,E);return this.valueScale(O)}}Kg([rl],C_.prototype,"positionColor",null),ic.add("volume",C_);class T_ extends sh{constructor(e,t,n){const i=n||{};if(super(e,t,i),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:Cf.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new Ll(i.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const t={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach((function(e){t[e]=e})),this.parameters.assembly={type:"select",options:t,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=Aa(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=Aa(t.radiusType,"vdw"),this.radiusData=Aa(t.radiusData,{}),this.radiusSize=Aa(t.radiusSize,1),this.radiusScale=Aa(t.radiusScale,1),this.assembly=Aa(t.assembly,"default"),this.defaultAssembly=Aa(t.defaultAssembly,""),"auto"===t.quality&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add((()=>{this.build()})),this.build()}setRadius(e,t){const n=Object.keys(Mf);return"string"==typeof e&&n.includes(e.toLowerCase())?t.radiusType=e:void 0!==e&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e="default"===this.assembly?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,n=this.getAssembly();return e=n?n.getAtomCount(t):t.atomCount,Gl&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(0===this.structureView.atomCount)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach(((e,t)=>{const n=e.getView(this.structureView);if(0===n.atomCount)return;const i=this.createData(n,t);i&&(i.sview=n,i.instanceList=e.getInstanceList(),this.dataList.push(i))}));else{const e=this.createData(this.structureView,0);e&&(e.sview=this.structureView,this.dataList.push(e))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach((t=>{t.bufferList.length>0&&this.updateData(e,t)}),this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new Cf(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e,t={},n=!1){const i=e||{};return this.setRadius(i.radius,i),void 0===i.radiusType&&void 0===i.radiusData&&void 0===i.radiusSize&&void 0===i.radiusScale||(t.radius=!0,ql&&!this.disableImpostor||(n=!0)),void 0!==i.defaultAssembly&&i.defaultAssembly!==this.defaultAssembly&&("default"===this.assembly&&void 0===i.assembly||"default"===i.assembly)&&(n=!0),super.setParameters(i,t,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,n=this.bufferList;this.dataList.forEach((function(e){e.bufferList.forEach((function(i){n.push(i),t.add(i,e.instanceList)}))})),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class E_ extends T_{constructor(e,t,n){super(e,t,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=Aa(t.labelVisible,!0),this.labelSize=Aa(t.labelSize,2),this.labelColor=Aa(t.labelColor,16777215),this.labelFontFamily=Aa(t.labelFontFamily,"sans-serif"),this.labelFontStyle=Aa(t.labelFontstyle,"normal"),this.labelFontWeight=Aa(t.labelFontWeight,"bold"),this.labelsdf=Aa(t.labelsdf,"Chrome"===Hl),this.labelXOffset=Aa(t.labelXOffset,0),this.labelYOffset=Aa(t.labelYOffset,0),this.labelZOffset=Aa(t.labelZOffset,.5),this.labelAttachment=Aa(t.labelAttachment,"bottom-left"),this.labelBorder=Aa(t.labelBorder,!1),this.labelBorderColor=Aa(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=Aa(t.labelBorderWidth,.15),this.labelBackground=Aa(t.labelBackground,!1),this.labelBackgroundColor=Aa(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=Aa(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=Aa(t.labelBackgroundOpacity,1),this.labelFixedSize=Aa(t.labelFixedSize,!1),this.lineOpacity=Aa(t.lineOpacity,1),this.linewidth=Aa(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const n={};if(e&&!e.labelSize||Object.assign(n,{size:Gc(this.n,this.labelSize)}),!e||e.labelColor){const e=new Pn(this.labelColor);Object.assign(n,{color:jc(this.n,e.r,e.g,e.b)})}this.textBuffer.setAttributes(n)}setParameters(e,t={},n=!1){return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||0===e.labelColor)&&(t.labelColor=!0,n=!0),super.setParameters(e,t,n),e&&void 0!==e.opacity&&this.textBuffer.setParameters({opacity:1}),e&&void 0!==e.labelVisible&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(e={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function P_(e,t){const n=e.getAtomProxy(),i=new Ll,r=t.length;if(0===r)return new Float32Array(0);const s=t[0].length,o=e.getAtomSet(),a=new Float32Array(r*s*3);let l=0;return t.forEach((function(t){let r=!1;for(let c=0;c<s;c++){const s=t[c];if("number"==typeof s&&Number.isInteger(s)){if(!o.get(s)){r=!0;break}n.index=s}else{i.setString(s);const t=e.getAtomIndices(i);if(!t.length){r=!0;break}n.index=t[0]}let u=l+3*c;a[u++]=n.x,a[u++]=n.y,a[u++]=n.z}r||(l+=3*s)})),a.subarray(0,l)}function I_(e,t,n,i,r){const s=Math.cos(r),o=Math.sin(r);e[0]=t[0]+n[0]*s+i[0]*o,e[1]=t[1]+n[1]*s+i[1]*o,e[2]=t[2]+n[2]*s+i[2]*o}function k_(e,t,n,i,r,s,o){for(let a=0;a<t;a++){for(let r=0;r<n;r++)i[r]=e[r*t+a];R_(i,r,s,o,n);for(let i=0;i<n;i++)e[i*t+a]=r[i]}for(let a=0;a<n;a++){for(let n=0;n<t;n++)i[n]=e[a*t+n];R_(i,r,s,o,t);for(let n=0;n<t;n++)e[a*t+n]=Math.sqrt(r[n])}}function R_(e,t,n,i,r){n[0]=0,i[0]=Number.MIN_SAFE_INTEGER,i[1]=Number.MAX_SAFE_INTEGER;for(let t=1,s=0;t<r;t++){let r=(e[t]+t*t-(e[n[s]]+n[s]*n[s]))/(2*t-2*n[s]);for(;r<=i[s];)s--,r=(e[t]+t*t-(e[n[s]]+n[s]*n[s]))/(2*t-2*n[s]);s++,n[s]=t,i[s]=r,i[s+1]=Number.MAX_SAFE_INTEGER}for(let s=0,o=0;s<r;s++){for(;i[o+1]<s;)o++;t[s]=(s-n[o])*(s-n[o])+e[n[o]]}}ac.add("shader/SDFFont.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float xOffset;\nuniform float yOffset;\nuniform float zOffset;\nuniform bool ortho;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\nattribute vec2 mapping;\nattribute vec2 inputTexCoord;\nattribute float inputSize;\n#include matrix_scale\n#include common\nvoid main(void){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\ntexCoord = inputTexCoord;\nfloat scale = matrixScale( modelViewMatrix );\nfloat _xOffset = xOffset * scale;\nfloat _yOffset = yOffset * scale;\nfloat _zOffset = zOffset * scale;\nif( texCoord.x == 10.0 ){\n_zOffset -= 0.001;\n}\nvec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );\n#ifdef FIXED_SIZE\nif ( ortho ) {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;\n} else {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;\n}\n#endif\nvec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );\ncameraCornerPos.xy += mapping * inputSize * 0.01 * scale;\ncameraCornerPos.x += _xOffset;\ncameraCornerPos.y += _yOffset;\nif( ortho ){\ncameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;\n} else {\ncameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;\n}\ngl_Position = projectionMatrix * cameraCornerPos;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -cameraCornerPos.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),ac.add("shader/SDFFont.frag","uniform sampler2D fontTexture;\nuniform float opacity;\nuniform bool showBorder;\nuniform vec3 borderColor;\nuniform float borderWidth;\nuniform vec3 backgroundColor;\nuniform float backgroundOpacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\nconst vec3 vColor = vec3( 0.0 );\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#endif\nconst float gamma = 2.2 * 1.4142 / 128.0;\nconst float padding = 0.75;\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\nif( texCoord.x > 1.0 ){\ngl_FragColor = vec4( backgroundColor, backgroundOpacity );\n}else{\nfloat sdf = texture2D( fontTexture, texCoord ).a;\nif( showBorder ) sdf += borderWidth;\nfloat a = smoothstep(padding - gamma, padding + gamma, sdf);\nif( a < 0.2 ) discard;\na *= opacity;\nvec3 outgoingLight = vColor;\nif( showBorder && sdf < ( padding + borderWidth ) ){\noutgoingLight = borderColor;\n}\ngl_FragColor = vec4( outgoingLight, a );\n}\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const D_={},L_={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class O_{constructor(e={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=Ma(e,L_);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),i=this.maxWidth=t.width/4,r=this.canvas=document.createElement("canvas");r.width=i,r.height=n;const s=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});s.font=`${t.style} ${t.variant} ${t.weight} ${t.size}px ${t.font}`,s.fillStyle="black",s.textAlign="left",s.textBaseline="bottom",s.lineJoin="round",this.gridOuter=new Float64Array(n*i),this.gridInner=new Float64Array(n*i),this.f=new Float64Array(Math.max(n,i)),this.d=new Float64Array(Math.max(n,i)),this.z=new Float64Array(Math.max(n,i)+1),this.v=new Int16Array(Math.max(n,i)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map(String.fromCharCode(65533));for(let e=32;e<=126;++e)this.map(String.fromCharCode(e));this.map(String.fromCharCode(176)),this.map(String.fromCharCode(8491)),this.texture=new Do(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return void 0===this.mapped[e]&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,n=this.lineHeight,i=t.outline,r=this.context,s=this.maxWidth,o=i,a=n-t.outline,l=r.measureText(e),c=Math.min(s,Math.ceil(l.width+2*o+1)),u=c*n;r.clearRect(0,0,c,n),r.fillText(e,o,a);const h=r.getImageData(0,0,c,n),d=h.data;for(let e=0;e<u;e++){const t=h.data[4*e+3]/255;this.gridOuter[e]=1===t?0:0===t?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-t),2),this.gridInner[e]=1===t?Number.MAX_SAFE_INTEGER:0===t?0:Math.pow(Math.max(0,t-.5),2)}k_(this.gridOuter,c,n,this.f,this.d,this.v,this.z),k_(this.gridInner,c,n,this.f,this.d,this.v,this.z);for(let e=0;e<u;e++){const t=this.gridOuter[e]-this.gridInner[e];d[4*e+3]=Math.max(0,Math.min(255,Math.round(255-255*(t/this.radius+this.cutoff))))}r.putImageData(h,0,0),this.scratchW=c,this.scratchH=n}}const N_=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},Zp),F_=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},Qp);function B_(e,t){const n=e.position.length/3;let i=0;for(let t=0;t<n;++t)i+=e.text[t].length;return t.showBackground&&(i+=n),i}class U_ extends Qm{constructor(e,t={}){super({position:new Float32Array(3*B_(e,t)),color:new Float32Array(3*B_(e,t)),picking:new mp},t),this.parameterTypes=F_,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Pn(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Pn(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return N_}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=e,n.needsUpdate=!0;const i=this.pickingMaterial;i.extensions.derivatives=!0,i.lights=!1,i.uniforms.fontTexture.value=e,i.needsUpdate=!0}setAttributes(e={}){let t,n,i,r,s,o;const a=this.text,l=this.geometry.attributes;e.position&&(t=e.position,r=l.position.array,l.position.needsUpdate=!0),e.size&&(n=e.size,s=l.inputSize.array,l.inputSize.needsUpdate=!0),e.color&&(i=e.color,o=l.color.array,l.color.needsUpdate=!0);const c=this.positionCount;let u,h,d,p,f,m=0;for(let e=0;e<c;++e)for(h=3*e,d=a[e],f=d.length,this.parameters.showBackground&&(f+=1),p=0;p<f;++p,++m)for(let a=0;a<4;a++)u=4*m*3+3*a,t&&(r[u]=t[h],r[u+1]=t[h+1],r[u+2]=t[h+2]),n&&(s[4*m+a]=n[e]),i&&(o[u]=i[h],o[u+1]=i[h+1],o[u+2]=i[h+2])}makeTexture(){this.textAtlas=function(e){const t=JSON.stringify(e);return void 0===D_[t]&&(D_[t]=new O_(e)),D_[t]}({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,n=this.parameters.attachment,i=e.lineHeight*this.parameters.backgroundMargin*.1-10,r=this.geometry.attributes,s=r.inputTexCoord.array,o=r.mapping.array,a=this.positionCount;let l,c,u,h,d,p,f,m,g=0;for(let r=0;r<a;++r){for(u=t[r],h=0,p=u.length,d=0;d<p;++d)l=e.get(u[d]),h+=l.w-2*e.parameters.outline;for(m=n.startsWith("top")?e.lineHeight/1.25:n.startsWith("middle")?e.lineHeight/2.5:0,f=n.endsWith("right")?h:n.endsWith("center")?h/2:0,f+=e.parameters.outline,m+=e.parameters.outline,this.parameters.showBackground&&(c=2*g*4,o[c+0]=-e.lineHeight/6-f-i,o[c+1]=e.lineHeight-m+i,o[c+2]=-e.lineHeight/6-f-i,o[c+3]=0-m-i,o[c+4]=h+e.lineHeight/6-f+2*e.parameters.outline+i,o[c+5]=e.lineHeight-m+i,o[c+6]=h+e.lineHeight/6-f+2*e.parameters.outline+i,o[c+7]=0-m-i,s[c+0]=10,s[c+2]=10,s[c+4]=10,s[c+6]=10,g+=1),h=0,d=0;d<p;++d,++g){l=e.get(u[d]),c=2*g*4,o[c+0]=h-f,o[c+1]=l.h-m,o[c+2]=h-f,o[c+3]=0-m,o[c+4]=h+l.w-f,o[c+5]=l.h-m,o[c+6]=h+l.w-f,o[c+7]=0-m;const t=e.parameters.width,n=e.parameters.height,i=[l.x/t,l.y/n,l.x/t,(l.y+l.h)/n,(l.x+l.w)/t,l.y/n,(l.x+l.w)/t,(l.y+l.h)/n];s.set(i,c),h+=l.w-2*e.parameters.outline}}r.inputTexCoord.needsUpdate=!0,r.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||void 0===e.fontFamily&&void 0===e.fontStyle&&void 0===e.fontWeight&&void 0===e.fontSize||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}uc.add("text",U_),ac.add("shader/WideLine.vert","\nuniform float clipNear;\nuniform vec3 clipCenter;\nuniform float linewidth;\nuniform vec2 resolution;\nuniform mat4 projectionMatrixInverse;\nattribute vec2 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid trimSegment( const in vec4 start, inout vec4 end ) {\nfloat a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;\nfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\nend.xyz = mix( start.xyz, end.xyz, alpha );\n}\nvoid main() {\nfloat aspect = resolution.x / resolution.y;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nflag = mapping.y;\nvColor = color;\nvColor2 = color2;\n#endif\nvec4 start = modelViewMatrix * vec4( position1, 1.0 );\nvec4 end = modelViewMatrix * vec4( position2, 1.0 );\nbool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {\nif ( start.z < 0.0 && end.z >= 0.0 ) {\ntrimSegment( start, end );\n} else if ( end.z < 0.0 && start.z >= 0.0 ) {\ntrimSegment( end, start );\n}\n}\nvec4 clipStart = projectionMatrix * start;\nvec4 clipEnd = projectionMatrix * end;\nvec2 ndcStart = clipStart.xy / clipStart.w;\nvec2 ndcEnd = clipEnd.xy / clipEnd.w;\nvec2 dir = ndcEnd - ndcStart;\ndir.x *= aspect;\ndir = normalize( dir );\nvec2 offset = vec2( dir.y, - dir.x );\ndir.x /= aspect;\noffset.x /= aspect;\nif ( mapping.x < 0.0 ) offset *= - 1.0;\noffset *= linewidth;\noffset /= resolution.y;\nvec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;\noffset *= clip.w;\nclip.xy += offset;\ngl_Position = clip;\n#ifndef PICKING\nvViewPosition = ( projectionMatrixInverse * clip ).xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),ac.add("shader/WideLine.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include fog_pars_fragment\nvarying vec3 vViewPosition;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\n#endif\nvoid main() {\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\nif ( flag < 0.0 ) {\ndiffuseColor.rgb *= vColor;\n} else {\ndiffuseColor.rgb *= vColor2;\n}\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const z_=Object.assign({linewidth:2},Zp),V_=Object.assign({linewidth:{uniform:!0}},Qp);class H_ extends Qm{constructor(e,t={}){super(e,t),this.parameterTypes=V_,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new Ne},projectionMatrixInverse:{value:new zt}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return z_}setParameters(e){super.setParameters(e)}}uc.add("wideline",H_);class $_ extends E_{constructor(e,t,n){super(e,t,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=Aa(t.side,"double"),t.opacity=Aa(t.opacity,.5),this.atomTriple=Aa(t.atomTriple,[]),this.arcVisible=Aa(t.arcVisible,!0),this.sectorVisible=Aa(t.sectorVisible,!0),this.vectorVisible=Aa(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=function(e,t){return function(e){const t=[],n=e.length/9;for(let i=0;i<n;i++){let n=!0;for(let t=i;t<i+3;t+=3)e[t]===e[t+3]&&e[t+1]===e[t+4]&&e[t+2]===e[t+5]&&(n=!1);n&&t.push(i)}const i=new Float32Array(9*t.length);let r=0;return t.forEach((function(t){Yc(e,i,9*t,9*r,9),r++})),i}(P_(e,t))}(e,this.atomTriple),n=function(e,t={}){const n=Aa(t.angleStep,Math.PI/90),i=e.length/9,r=new Float32Array(i),s=new Float32Array(3*i),o=new Array(i),a=new Float32Array(6*i),l=new Float32Array(6*i),c=new Array(i),u=new Array(i),h=new Array(i);let d=0;const p=fh(),f=fh(),m=fh(),g=fh(),_=fh(),v=fh(),y=fh(),b=fh(),x=fh();for(var w=0;w<i;w++){let t=9*w;yh(p,e,t),yh(f,e,t+3),yh(m,e,t+6);let i=6*w;bh(p,a,i),bh(f,l,i),bh(f,a,i+3),bh(m,l,i+3),_h(g,p,f),_h(_,m,f),Mh(g,g),Mh(_,_),mh(v,g,_);const S=wh(v),A=gh(g,_),M=r[w]=Math.atan2(S,A);o[w]=(zc*M).toFixed(1)+String.fromCharCode(176),0===wh(v)&&(v[0]=1,v[1]=0,v[2]=0),mh(y,v,g),Mh(y,y),I_(b,f,g,y,M/2),bh(b,s,3*w);const C=Math.ceil(M/n),T=new Float32Array(9*C);h[w]=T;const E=new Float32Array(3*C),P=new Float32Array(3*C);c[w]=E,u[w]=P,vh(x,f,g);const I=function(e,t){const n=9*t,i=3*t;bh(f,T,n),bh(x,T,n+3),bh(x,E,i),I_(x,f,g,y,e),bh(x,T,n+6),bh(x,P,i)};let k=0;for(let e=n;e<M;e+=n)I(e,k),k++;I(M,k),d+=C}const S=3*d,A=9*d,M=new Float32Array(S),C=new Float32Array(S),T=new Float32Array(A);let E=0,P=0;for(let e=0;e<i;e++){const t=c[e],n=u[e];Yc(t,M,0,P,t.length),Yc(n,C,0,P,n.length),P+=t.length;const i=h[e];Yc(i,T,0,E,i.length),E+=i.length}return{labelPosition:s,labelText:o,vectorPosition1:a,vectorPosition2:l,arcPosition1:M,arcPosition2:C,sectorPosition:T}}(t),i=this.n=n.labelPosition.length/3,r=new Pn(this.labelColor);this.textBuffer=new U_({position:n.labelPosition,size:Gc(i,this.labelSize),color:jc(i,r.r,r.g,r.b),text:n.labelText},this.getLabelBufferParams());const s=new Pn(this.colorValue);return this.vectorBuffer=new H_(Lh({position1:n.vectorPosition1,position2:n.vectorPosition2,color:jc(2*i,s.r,s.g,s.b),color2:jc(2*i,s.r,s.g,s.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=n.arcPosition1.length/3,this.arcBuffer=new H_(Lh({position1:n.arcPosition1,position2:n.arcPosition2,color:jc(this.arcLength,s.r,s.g,s.b),color2:jc(this.arcLength,s.r,s.g,s.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=n.sectorPosition.length/3,this.sectorBuffer=new ef({position:n.sectorPosition,color:jc(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},r={};if(e.color){const e=new Pn(this.colorValue);Object.assign(n,{color:jc(2*this.n,e.r,e.g,e.b),color2:jc(2*this.n,e.r,e.g,e.b)}),Object.assign(i,{color:jc(this.arcLength,e.r,e.g,e.b),color2:jc(this.arcLength,e.r,e.g,e.b)}),Object.assign(r,{color:jc(this.sectorLength,e.r,e.g,e.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(i),this.sectorBuffer.setAttributes(r)}setParameters(e){return super.setParameters(e,{},!1),!e||void 0===e.vectorVisible&&void 0===e.arcVisible&&void 0===e.sectorVisible||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&void 0!==e.opacity&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}sc.add("angle",$_);const G_=new ut,j_=new ut,W_=new ut,q_=new ut(0,1,0),X_=Object.assign({radialSegments:1,openEnded:!0},Zp);function Y_(e={}){const t=Aa(e.radialSegments,10),n=Aa(e.openEnded,!0),i=(new zt).makeRotationX(Math.PI/2),r=new Lo(1,1,1,t,1,n);return r.applyMatrix4(i),r}class K_ extends jm{constructor(e,t={}){super(function(e,t={}){const n=Y_(t),i=e.position1.length,r=n.attributes.position.array.length/3,s=i/3,o=new Float32Array(2*s*r);return qc(s,r,0,o),qc(s,r,s*r,o),{position:new Float32Array(2*i),color:new Float32Array(2*i),primitiveId:o,picking:e.picking}}(e,t),t,Y_(t)),this.updateNormals=!0;const n=e.position1.length,i=e.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*i),this.setAttributes(e,!0)}get defaultParameters(){return X_}applyPositionTransform(e,t,n){j_.fromArray(this._from,n),W_.fromArray(this._to,n),e.lookAt(j_,W_,q_);const i=this._radius[t];G_.set(i,i,j_.distanceTo(W_)),e.scale(G_)}setAttributes(e={},t){const n={};e.position1&&e.position2&&(Hc(e.position1,e.position2,this.__center),Hc(e.position1,this.__center,this._position),Hc(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),n.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),n.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),n.radius=this._radius),super.setAttributes(n,t)}}ac.add("shader/CylinderImpostor.vert","\nattribute vec3 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\nattribute float radius;\nvarying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform mat4 modelViewMatrixInverse;\nuniform float ortho;\n#include matrix_scale\nvoid main(){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nbase_radius.w = radius * matrixScale( modelViewMatrix );\nvec3 center = position;\nvec3 dir = normalize( position2 - position1 );\nfloat ext = length( position2 - position1 ) / 2.0;\nvec3 cam_dir;\nif( ortho == 0.0 ){\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;\n}else{\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;\n}\ncam_dir = normalize( cam_dir );\nvec3 ldir;\nfloat b = dot( cam_dir, dir );\nend_b.w = b;\nif( b < 0.0 )\nldir = -ext * dir;\nelse\nldir = ext * dir;\nvec3 left = radius * normalize( cross( cam_dir, ldir ) );\nvec3 up = radius * normalize( cross( left, ldir ) );\naxis = normalize( normalMatrix * ldir );\nU = normalize( normalMatrix * up );\nV = normalize( normalMatrix * left );\nvec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );\nbase_radius.xyz = base4.xyz / base4.w;\nvec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );\nend_b.xyz = end4.xyz / end4.w;\nw = modelViewMatrix * vec4(\ncenter + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0\n);\ngl_Position = projectionMatrix * w;\ngl_Position.z = 0.99;\n}"),ac.add("shader/CylinderImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying vec3 axis;\nvarying vec4 base_radius;\nvarying vec4 end_b;\nvarying vec3 U;\nvarying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat distSq3( vec3 v3a, vec3 v3b ){\nreturn (\n( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +\n( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +\n( v3a.z - v3b.z ) * ( v3a.z - v3b.z )\n);\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nvoid main(){\nvec3 ray_target = w.xyz / w.w;\nvec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;\nvec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);\nvec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);\nmat3 basis = mat3( U, V, axis );\nvec3 diff = ray_target - 0.5 * (base + end);\nvec3 P = diff * basis;\nfloat dz = dot( axis, ray_direction );\nfloat radius2 = vRadius*vRadius;\nvec3 D = vec3(dot(U, ray_direction),\ndot(V, ray_direction),\ndz);\nfloat a0 = P.x*P.x + P.y*P.y - radius2;\nfloat a1 = P.x*D.x + P.y*D.y;\nfloat a2 = D.x*D.x + D.y*D.y;\nfloat d = a1*a1 - a0*a2;\nif (d < 0.0) {\ndiscard;\n}\nfloat dist = (-a1 + sqrt(d)) / a2;\nvec3 surface_point = ray_target + dist * ray_direction;\nvec3 base_to_surface = surface_point - base;\nvec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );\nfloat base_cap_test = dot( base_to_surface, axis );\nfloat end_cap_test = dot((surface_point - end), axis);\n#ifndef CAP\nvec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\nvec3 tmp_point2 = new_point2 - base;\n#endif\nif (base_cap_test < 0.0) {\nfloat dNV;\nfloat near;\nvec3 front_point;\nif ( ortho == 1.0 ) {\nfront_point = ray_target;\n} else {\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nfront_point = ray_direction * near + ray_origin;\n}\nif (dot(front_point - base, front_point-base) > radius2) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = front_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(axis, end) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - end, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\nif( end_cap_test > 0.0 )\n{\nfloat dNV;\nfloat near;\nvec3 end_point;\nif ( ortho == 1.0 ) {\nend_point = ray_target;\n} else {\ndNV = dot(axis, ray_direction);\nif (dNV < 0.0) {\ndiscard;\n}\nnear = dot(axis, end) / dNV;\nend_point = ray_direction * near + ray_origin;\n}\nif( dot(end_point - end, end_point-base) > radius2 ) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = end_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - base, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\ngl_FragDepthEXT = calcDepth( surface_point );\n#ifdef NEAR_CLIP\nif( calcClip( surface_point ) > 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\nif( calcClip( surface_point ) > 0.0 ) {\ndiscard;\n}\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#endif\nif (gl_FragDepthEXT < 0.0) {\ndiscard;\n}\nif (gl_FragDepthEXT > 1.0) {\ndiscard;\n}\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -surface_point;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){\nif( b < 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}else{\nif( b > 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 nonPerturbedNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const Z_=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),Q_=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class J_ extends Ym{constructor(e,t={}){super("v3",e,t)}get mapping(){return Z_}get mappingIndices(){return Q_}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const ev=Object.assign({openEnded:!1},Zp),tv=Object.assign({openEnded:{updateShader:!0}},Qp);class nv extends J_{constructor(e,t={}){super(e,t),this.parameterTypes=tv,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new zt},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return ev}getDefines(e){const t=J_.prototype.getDefines.call(this,e);return this.parameters.openEnded||(t.CAP=1),t}}Object.assign({disableImpostor:!1},X_,ev);const iv=class{constructor(e,t={}){return!e.color2&&e.color&&(e.color2=e.color),!ql||t&&t.disableImpostor?new K_(e,t):new nv(e,t)}};uc.add("cylinder",iv);class rv extends T_{constructor(e,t,n){super(e,t,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};t.radiusSize=Aa(t.radiusSize,.5),t.colorValue=Aa(t.colorValue,"lightgreen"),t.useInteriorColor=Aa(t.useInteriorColor,!0),this.showAxes=Aa(t.showAxes,!0),this.showBox=Aa(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),n=new Pn(this.colorValue);let i=0,r=0;this.showAxes&&(i+=6,r+=3),this.showBox&&(i+=8,r+=12);const s=new Float32Array(3*i),o=jc(i,n.r,n.g,n.b),a=Gc(i,this.radiusSize),l=new Float32Array(3*r),c=new Float32Array(3*r),u=jc(r,n.r,n.g,n.b),h=Gc(r,this.radiusSize);let d=0;if(this.showAxes){const e=function(e,t){e.toArray(s,2*d),t.toArray(s,2*d+3),e.toArray(l,d),t.toArray(c,d),d+=3};e(t.begA,t.endA),e(t.begB,t.endB),e(t.begC,t.endC)}if(this.showBox){const n=new ut,{d1a:i,d2a:r,d3a:o,d1b:a,d2b:u,d3b:h}=t.getProjectedScaleForAtoms(e);let p=2*d;const f=function(e,i,r){n.copy(t.center).addScaledVector(t.normVecA,e).addScaledVector(t.normVecB,i).addScaledVector(t.normVecC,r),n.toArray(s,p),p+=3};f(i,r,o),f(i,r,h),f(i,u,h),f(i,u,o),f(a,u,h),f(a,u,o),f(a,r,o),f(a,r,h);let m=d;const g=function(e,t){n.fromArray(s,2*d+3*e).toArray(l,m),n.fromArray(s,2*d+3*t).toArray(c,m),m+=3};g(0,1),g(0,3),g(0,6),g(1,2),g(1,7),g(2,3),g(2,4),g(3,5),g(4,5),g(4,7),g(5,6),g(6,7)}const p=new up(t);return{vertex:{position:s,color:o,radius:a,picking:p},edge:{position1:l,position2:c,color:u,color2:u,radius:h,picking:p}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new eg(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new iv(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=this.getAxesData(t.sview),i={},r={};e&&!e.position||(Object.assign(i,{position:n.vertex.position}),Object.assign(r,{position1:n.edge.position1,position2:n.edge.position2})),e&&!e.color||(Object.assign(i,{color:n.vertex.color}),Object.assign(r,{color:n.edge.color,color2:n.edge.color})),e&&!e.radius||(Object.assign(i,{radius:n.vertex.radius}),Object.assign(r,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(i),this.cylinderBuffer.setAttributes(r)}}sc.add("axes",rv);class sv extends T_{constructor(e,t,n){super(e,t,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusType=Aa(t.radiusType,"size"),t.radiusSize=Aa(t.radiusSize,.15),t.useInteriorColor=Aa(t.useInteriorColor,!0),this.aspectRatio=Aa(t.aspectRatio,2),this.lineOnly=Aa(t.lineOnly,!1),this.cylinderOnly=Aa(t.cylinderOnly,!1),this.multipleBond=Aa(t.multipleBond,"off"),this.bondSpacing=Aa(t.bondSpacing,1),this.bondScale=Aa(t.bondScale,.4),this.linewidth=Aa(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var n=super.getAtomParams(e,t);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(e,t,n){return e.getAtomData(this.getAtomParams(t,n))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,n){return e.getBondData(this.getBondParams(t,n))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new H_(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const n=new iv(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(n),!this.cylinderOnly){const n=new eg(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(n)}}return{bufferList:t}}updateData(e,t){"off"!==this.multipleBond&&e&&e.radius&&(e.position=!0);const n=this.getBondData(t.sview,e);if(this.lineOnly){const i={};e&&!e.position||Object.assign(i,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(i,{color:n.color,color2:n.color2}),t.bufferList[0].setAttributes(i)}else{var i={};if(e&&!e.position||Object.assign(i,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(i,{color:n.color,color2:n.color2}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i),!this.cylinderOnly){var r=this.getAtomData(t.sview,e),s={};e&&!e.position||Object.assign(s,{position:r.position}),e&&!e.color||Object.assign(s,{color:r.color}),e&&!e.radius||Object.assign(s,{radius:r.radius}),t.bufferList[1].setAttributes(s)}}}setParameters(e={}){let t=!1;const n={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(n,{radius:!0}),ql&&!this.disableImpostor||(t=!0)),super.setParameters(e,n,t),this}}sc.add("ball+stick",sv);class ov extends sv{constructor(e,t,n){super(e,t,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(e){var t=e||{};t.aspectRatio=Aa(t.aspectRatio,1),t.radiusSize=Aa(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,n){return e.getBackboneAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){return e.getBackboneBondData(this.getBondParams(t,n))}}sc.add("backbone",ov);class av extends sv{constructor(e,t,n){super(e,t,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=Aa(t.aspectRatio,1),t.radiusSize=Aa(t.radiusSize,.3),super.init(t)}getAtomData(e,t,n){return e.getRungAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){let i=this.getBondParams(t,n);return Object.assign(i.colorParams,{rung:!0}),e.getRungBondData(i)}}sc.add("base",av);class lv{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new ut,this.vec2=new ut,this.vDir=new ut,this.vTan=new ut,this.vNorm=new ut,this.vBin=new ut,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,n,i,r,s,o){s[o+0]=Ja(e.x,t.x,n.x,i.x,r,this.tension),s[o+1]=Ja(e.y,t.y,n.y,i.y,r,this.tension),s[o+2]=Ja(e.z,t.z,n.z,i.z,r,this.tension)}interpolateToVec(e,t,n,i,r,s){s.x=Ja(e.x,t.x,n.x,i.x,r,this.tension),s.y=Ja(e.y,t.y,n.y,i.y,r,this.tension),s.z=Ja(e.z,t.z,n.z,i.z,r,this.tension)}interpolatePosition(e,t,n,i,r,s){for(var o=0;o<this.m;++o){var a=s+3*o,l=this.dt*o;this.interpolateToArr(e,t,n,i,l,r,a)}}interpolateTangent(e,t,n,i,r,s){for(var o=0;o<this.m;++o){var a=this.dt*o,l=a-this.delta,c=a+this.delta,u=s+3*o;l<0&&(l=0),c>1&&(c=1),this.interpolateToVec(e,t,n,i,l,this.vec1),this.interpolateToVec(e,t,n,i,c,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(r,u)}}vectorSubdivide(e,t,n,i,r){let s,o=t.next(),a=t.next(),l=t.next();const c=t.size,u=c-1;let h=i||0;for(let i=0;i<u;++i)s=o,o=a,a=l,l=t.next(),e.apply(this,[s,o,a,l,n,h]),h+=3*this.m;r&&(s=t.get(c-2),o=t.get(c-1),a=t.get(0),l=t.get(1),e.apply(this,[s,o,a,l,n,h]),h+=3*this.m)}getPosition(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,i);var r=e.size-1,s=r*this.m*3;i&&(s+=3*this.m);var o=e.get(i?0:r);t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z}getTangent(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,i);let r=(e.size-1)*this.m*3;i&&(r+=3*this.m),Yc(t,t,r-3,r,3)}interpolateNormalDir(e,t,n,i,r,s,o,a,l,c,u,h,d){for(let p=0;p<this.m;++p){let f=h+3*p;d&&(f+=3*this.m2);const m=this.dt*p;this.interpolateToVec(e,t,n,i,m,this.vec1),this.interpolateToVec(r,s,o,a,m,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(l,f),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(u,f),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(c,f)}}interpolateNormal(e,t,n,i,r){for(var s=0;s<this.m;++s){var o=r+3*s;e.copy(this.vNorm),this.vTan.fromArray(t,o),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(i,o),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,o)}}getNormal(e,t,n,i,r,s){this.vNorm.set(0,0,1);const o=e-1;let a=r||0;for(var l=0;l<o;++l)this.interpolateNormal(this.vDir,t,n,i,a),a+=3*this.m;s&&(this.interpolateNormal(this.vDir,t,n,i,a),a+=3*this.m),this.vBin.toArray(i,a),this.vNorm.toArray(n,a)}getNormalDir(e,t,n,i,r,s,o,a){e.reset(),t.reset();const l=new ut,c=new ut,u=new ut,h=new ut,d=new ut,p=(new ut).copy(e.next()),f=(new ut).copy(e.next()),m=(new ut).copy(e.next()),g=new ut,_=(new ut).copy(t.next()),v=(new ut).copy(t.next()),y=(new ut).copy(t.next());this.vNorm.set(0,0,1);let b=e.size,x=b-1,w=s||0;for(var S=0;S<x;++S)d.copy(p),p.copy(f),f.copy(m),m.copy(e.next()),g.copy(_),_.copy(v),v.copy(y),y.copy(t.next()),0===S?(l.subVectors(g,d),c.subVectors(_,p),l.dot(c)<0&&(c.multiplyScalar(-1),_.addVectors(p,c)),u.subVectors(v,f),c.dot(u)<0&&(u.multiplyScalar(-1),v.addVectors(f,u))):u.copy(h),h.subVectors(y,m),u.dot(h)<0&&(h.multiplyScalar(-1),y.addVectors(m,h)),this.interpolateNormalDir(d,p,f,m,g,_,v,y,n,i,r,w,a),w+=3*this.m;if(o&&(d.copy(e.get(b-2)),p.copy(e.get(b-1)),f.copy(e.get(0)),m.copy(e.get(1)),g.copy(t.get(b-2)),_.copy(t.get(b-1)),v.copy(t.get(0)),y.copy(t.get(1)),u.copy(h),h.subVectors(y,m),u.dot(h)<0&&(h.multiplyScalar(-1),y.addVectors(m,h)),this.interpolateNormalDir(d,p,f,m,g,_,v,y,n,i,r,w,a),w+=3*this.m),a){this.vBin.fromArray(r,3*this.m2),this.vNorm.fromArray(i,3*this.m2);for(var A=0;A<this.m2;++A)this.vBin.toArray(r,3*A),this.vNorm.toArray(i,3*A)}else this.vBin.toArray(r,w),this.vNorm.toArray(i,w)}interpolateColor(e,t,n,i,r){var s,o;for(s=0;s<this.m2;++s)o=r+3*s,n.apply(this,[e,i,o]);for(s=this.m2;s<this.m;++s)o=r+3*s,n.apply(this,[t,i,o])}getColor(e,t,n,i,r){let s;e.reset(),e.next();let o=e.next();for(var a=e.size,l=a-1,c=i||0,u=0;u<l;++u)s=o,o=e.next(),this.interpolateColor(s,o,t,n,c),c+=3*this.m;r&&(s=e.get(a-1),o=e.get(0),this.interpolateColor(s,o,t,n,c),c+=3*this.m),n[c]=n[c-3],n[c+1]=n[c-2],n[c+2]=n[c-1]}interpolatePicking(e,t,n,i,r){var s;for(s=0;s<this.m2;++s)i[r+s]=n.apply(this,[e]);for(s=this.m2;s<this.m;++s)i[r+s]=n.apply(this,[t])}getPicking(e,t,n,i,r){let s;e.reset(),e.next();let o=e.next();const a=e.size,l=a-1;let c=i||0;for(var u=0;u<l;++u)s=o,o=e.next(),this.interpolatePicking(s,o,t,n,c),c+=this.m;r&&(s=e.get(a-1),o=e.get(0),this.interpolatePicking(s,o,t,n,c),c+=this.m),n[c]=n[c-1]}interpolateSize(e,t,n,i,r){const s=n.apply(this,[e]),o=n.apply(this,[t]);for(let e=0;e<this.m;++e){let t=e/this.m;i[r+e]=(1-t)*s+t*o}}getSize(e,t,n,i,r){let s;e.reset(),e.next();let o=e.next();const a=e.size,l=a-1;let c=i||0;for(var u=0;u<l;++u)s=o,o=e.next(),this.interpolateSize(s,o,t,n,c),c+=this.m;r&&(s=e.get(a-1),o=e.get(0),this.interpolateSize(s,o,t,n,c),c+=this.m),n[c]=n[c-1]}}class cv{constructor(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new lv(this.subdiv,this.tension)}getAtomIterator(e,t){const n=this.polymer,i=n.structure,r=n.residueCount;let s=0,o=-1;const a=[i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy()],l=[new ut,new ut,new ut,new ut];var c=i.getAtomProxy(),u=i.getAtomProxy();function h(i){var o=a[s%4];if(o.index=n.getAtomIndexByType(i,e),t&&i>0&&i<r&&"e"===o.sstruc){var h=l[s%4];return c.index=n.getAtomIndexByType(i+1,e),u.index=n.getAtomIndexByType(i-1,e),h.addVectors(c,u).add(o).add(o).multiplyScalar(.25),s+=1,h}return s+=1,o}return{size:r,next:function(){var e=h(o);return o+=1,e},get:h,reset:function(){s=0,o=-1}}}getSubdividedColor(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t*3+3;n.isCyclic&&(i+=3*t);var r=new Float32Array(i),s=this.getAtomIterator("trace"),o=e||{};o.structure=n.structure;var a=ic.getScheme(o);return this.interpolator.getColor(s,(function(e,t,n){a.atomColorToArray(e,t,n)}),r,0,n.isCyclic),{color:r}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var i=t.structure,r=this.getAtomIterator("trace"),s=new Float32Array(n);return this.interpolator.getPicking(r,(function(e){return e.index}),s,0,t.isCyclic),{picking:new cp(s,i)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t+1;n.isCyclic&&(i+=t);var r=new Float32Array(i),s=this.getAtomIterator("trace"),o=new Cf(e);return this.interpolator.getSize(s,(function(e){return o.atomRadius(e)}),r,0,n.isCyclic),{size:r}}getPosition(){const e=this.subdiv,t=this.polymer;let n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(r,i,0,t.isCyclic),i}getTangent(){const e=this.subdiv,t=this.polymer;let n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(r,i,0,t.isCyclic),i}getNormals(e){const t=this.subdiv,n=this.polymer,i=n.isProtein(),r=this.size;let s=(r-1)*t*3+3;n.isCyclic&&(s+=3*t);const o=new Float32Array(s),a=new Float32Array(s);if(this.directional&&!this.polymer.isCg()){const t=this.getAtomIterator("direction1"),r=this.getAtomIterator("direction2");this.interpolator.getNormalDir(t,r,e,o,a,0,n.isCyclic,i)}else this.interpolator.getNormal(r,e,o,a,0,n.isCyclic);return{normal:o,binormal:a}}}const uv=new ut,hv=new ut,dv=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},Zp);class pv extends ef{constructor(e,t={}){super(function(e,t={}){const n=Aa(t.radialSegments,4),i=Aa(t.capped,!1),r=i?n:0,s=i?n-2:0,o=e.position.length/3,a=o*n*3+2*r*3,l=2*(o-1)*n*3+2*s*3;return{position:new Float32Array(a),color:new Float32Array(a),index:Ba(l,a/3),normal:new Float32Array(a),picking:e.picking}}(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=Wc(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return dv}setAttributes(e={}){const t=this.parameters.aspectRatio,n=this.size2,i=n-1,r=this.parameters.radialSegments,s=this.geometry.attributes;let o,a,l,c,u,h,d,p,f,m,g,_,v;e.position&&(o=e.position,a=e.normal,l=e.binormal,c=e.tangent,h=e.size,p=s.position.array,m=s.normal.array,s.position.needsUpdate=!0,s.normal.needsUpdate=!0),e.color&&(u=e.color,f=s.color.array,s.color.needsUpdate=!0),e.primitiveId&&(d=e.primitiveId,g=s.primitiveId.array,s.primitiveId.needsUpdate=!0);let y=0,b=0,x=0,w=0,S=0,A=0,M=0,C=0,T=0,E=0;const P=[],I=[],k=[],R=[],D=[],L=[];if(o)for(let e=0;e<r;++e){const n=e/r*2*Math.PI;P[e]=t*Math.cos(n),I[e]=Math.sin(n),k[e]=t*Math.cos(n-.01),R[e]=Math.sin(n-.01),D[e]=t*Math.cos(n+.01),L[e]=Math.sin(n+.01)}for(let e=0;e<n;++e){_=3*e,v=_*r,o&&c&&a&&l&&h&&(uv.set(c[_],c[_+1],c[_+2]),b=a[_],x=a[_+1],w=a[_+2],S=l[_],A=l[_+1],M=l[_+2],C=o[_],T=o[_+1],E=o[_+2],y=h[e]);for(let t=0;t<r;++t){const n=v+3*t;if(o){const e=-y*P[t],i=y*I[t],r=-y*k[t],s=y*R[t],o=-y*D[t],a=y*L[t];p[n]=C+e*b+i*S,p[n+1]=T+e*x+i*A,p[n+2]=E+e*w+i*M,hv.set(o*b+a*S-(r*b+s*S),o*x+a*A-(r*x+s*A),o*w+a*M-(r*w+s*M)).cross(uv),m[n]=hv.x,m[n+1]=hv.y,m[n+2]=hv.z}u&&(f[n]=u[_],f[n+1]=u[_+1],f[n+2]=u[_+2]),d&&(g[e*r+t]=d[e])}}_=0,v=3*n*r;for(let e=0;e<r;++e){const t=_+3*e,i=v+3*e;o&&c&&(p[i]=p[t],p[i+1]=p[t+1],p[i+2]=p[t+2],m[i]=c[_],m[i+1]=c[_+1],m[i+2]=c[_+2]),u&&(f[i]=f[t],f[i+1]=f[t+1],f[i+2]=f[t+2]),d&&(g[n*r+e]=g[0+e])}_=3*(n-1)*r,v=3*(n+1)*r;for(let e=0;e<r;++e){const t=_+3*e,s=v+3*e;o&&c&&(p[s]=p[t],p[s+1]=p[t+1],p[s+2]=p[t+2],m[s]=c[3*i],m[s+1]=c[3*i+1],m[s+2]=c[3*i+2]),u&&(f[s]=f[t],f[s+1]=f[t+1],f[s+2]=f[t+2]),d&&(g[(n+1)*r+e]=g[(n-1)*r+e])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void Yl.error("Index is null");const t=e.array,n=this.size2,i=n-1,r=this.capTriangles,s=this.parameters.radialSegments,o=this.parameters.radialSegments+1;let a,l;for(let e=0;e<i;++e){const n=e*s*3*2,i=e*s,r=(e+1)*s;for(let e=0;e<s;++e)l=n+3*e*2,t[l]=i+e,t[l+1]=i+(e+1)%s,t[l+2]=r+e,t[l+3]=r+e,t[l+4]=i+(e+1)%s,t[l+5]=r+(e+1)%s}const c=[0];for(let e=1;e<o/2;++e)c.push(e),s-e!==e&&c.push(s-e);l=i*s*3*2,a=n*s;for(let e=0;e<c.length-2;++e)e%2==0?(t[l+3*e+0]=a+c[e+0],t[l+3*e+1]=a+c[e+1],t[l+3*e+2]=a+c[e+2]):(t[l+3*e+0]=a+c[e+2],t[l+3*e+1]=a+c[e+1],t[l+3*e+2]=a+c[e+0]);l=i*s*3*2+3*r,a=n*s+s;for(let e=0;e<c.length-2;++e)e%2==0?(t[l+3*e+0]=a+c[e+0],t[l+3*e+1]=a+c[e+1],t[l+3*e+2]=a+c[e+2]):(t[l+3*e+0]=a+c[e+2],t[l+3*e+1]=a+c[e+1],t[l+3*e+2]=a+c[e+0])}}class fv extends T_{constructor(e,t,n){super(e,t,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.colorScheme=Aa(t.colorScheme,"chainname"),t.colorScale=Aa(t.colorScale,"RdYlBu"),t.radiusType=Aa(t.radiusType,"sstruc"),t.radiusScale=Aa(t.radiusScale,.7),t.useInteriorColor=Aa(t.useInteriorColor,!0),this.aspectRatio=Aa(t.aspectRatio,5),this.tension=Aa(t.tension,NaN),this.capped=Aa(t.capped,!0),this.smoothSheet=Aa(t.smoothSheet,!1),"low"===t.quality?(this.subdiv=3,this.radialSegments=6):"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=Aa(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:1!==this.aspectRatio,smoothSheet:this.smoothSheet},e)}getSpline(e){return new cv(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],n=[];return this.structure.eachPolymer((e=>{if(e.residueCount<4)return;n.push(e);const i=this.getSpline(e),r=this.getAspectRatio(e),s=i.getSubdividedPosition(),o=i.getSubdividedOrientation(),a=i.getSubdividedColor(this.getColorParams()),l=i.getSubdividedPicking(),c=i.getSubdividedSize(this.getRadiusParams());t.push(new pv(Object.assign({},s,o,a,l,c),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:r,capped:this.capped})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){Ql&&Yl.time(this.type+" repr update"),e=e||{};for(var n=0,i=t.polymerList.length;n<i;++n){var r={},s=t.polymerList[n],o=this.getSpline(s),a=this.getAspectRatio(s);if(Object.assign(t.bufferList[n],{aspectRatio:a}),e.position||e.radius){var l=o.getSubdividedPosition(),c=o.getSubdividedOrientation(),u=o.getSubdividedSize(this.getRadiusParams(a));r.position=l.position,r.normal=c.normal,r.binormal=c.binormal,r.tangent=c.tangent,r.size=u.size}if(e.color){var h=o.getSubdividedColor(this.getColorParams());r.color=h.color}if(e.picking){var d=o.getSubdividedPicking();r.picking=d.picking}t.bufferList[n].setAttributes(r)}Ql&&Yl.timeEnd(this.type+" repr update")}setParameters(e){var t={};return e&&e.aspectRatio&&(t.radius=!0),e&&e.tension&&(t.position=!0),super.setParameters(e,t,!1),this}}sc.add("cartoon",fv);class mv extends T_{constructor(e,t,n){super(e,t,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusSize=Aa(t.radiusSize,.05),t.useInteriorColor=Aa(t.useInteriorColor,!0),this.hydrogenBond=Aa(t.hydrogenBond,!0),this.weakHydrogenBond=Aa(t.weakHydrogenBond,!1),this.waterHydrogenBond=Aa(t.waterHydrogenBond,!1),this.backboneHydrogenBond=Aa(t.backboneHydrogenBond,!1),this.hydrophobic=Aa(t.hydrophobic,!1),this.halogenBond=Aa(t.halogenBond,!0),this.ionicInteraction=Aa(t.ionicInteraction,!0),this.metalCoordination=Aa(t.metalCoordination,!0),this.cationPi=Aa(t.cationPi,!0),this.piStacking=Aa(t.piStacking,!0),this.filterSele=Aa(t.filterSele,""),this.labelVisible=Aa(t.labelVisible,!1),this.labelFixedSize=Aa(t.labelFixedSize,!1),this.labelSize=Aa(t.labelSize,2),this.labelUnit=Aa(t.labelUnit,""),this.maxHydrophobicDist=Aa(t.maxHydrophobicDist,4),this.maxHbondDist=Aa(t.maxHbondDist,3.5),this.maxHbondSulfurDist=Aa(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=Aa(t.maxHbondAccAngle,45),this.maxHbondDonAngle=Aa(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=Aa(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=Aa(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=Aa(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=Aa(t.maxPiStackingOffset,2),this.maxPiStackingAngle=Aa(t.maxPiStackingAngle,30),this.maxCationPiDist=Aa(t.maxCationPiDist,6),this.maxCationPiOffset=Aa(t.maxCationPiOffset,2),this.maxIonicDist=Aa(t.maxIonicDist,5),this.maxHalogenBondDist=Aa(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=Aa(t.maxHalogenBondAngle,30),this.maxMetalDist=Aa(t.maxMetalDist,3),this.refineSaltBridges=Aa(t.refineSaltBridges,!0),this.masterModelIndex=Aa(t.masterModelIndex,-1),this.lineOfSightDistFactor=Aa(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return function(e,t,n){const i=Ma(n,sp),r=[];i.hydrogenBond&&r.push(4),i.hydrophobic&&r.push(6),i.halogenBond&&r.push(5),i.ionicInteraction&&r.push(1),i.metalCoordination&&r.push(7),i.cationPi&&r.push(2),i.piStacking&&r.push(3),i.weakHydrogenBond&&r.push(8),i.waterHydrogenBond&&r.push(9),i.backboneHydrogenBond&&r.push(10);const{features:s,contactSet:o,contactStore:a}=e,{centers:l,atomSets:c}=s,{x:u,y:h,z:d}=l,{index1:p,index2:f,type:m}=a,g=[],_=[],v=[],y=[],b=[];let x;return i.filterSele&&(x=Array.isArray(i.filterSele)?i.filterSele.map((e=>t.getAtomSet(new Ll(e)))):t.getAtomSet(new Ll(i.filterSele))),o.forEach((e=>{const t=m[e];if(!r.includes(t))return;if(x){const t=c[p[e]][0],n=c[f[e]][0];if(Array.isArray(x)){if(!(x[0].isSet(t)&&x[1].isSet(n)||x[1].isSet(t)&&x[0].isSet(n)))return}else if(!x.isSet(t)&&!x.isSet(n))return}const n=p[e],s=f[e];g.push(u[n],h[n],d[n]),_.push(u[s],h[s],d[s]),v.push(...function(e){switch(e){case 4:case 9:case 10:return op.setHex(2851770).toArray();case 6:return op.setHex(8421504).toArray();case 5:return op.setHex(4259775).toArray();case 1:return op.setHex(15779860).toArray();case 7:return op.setHex(9191577).toArray();case 2:return op.setHex(16744448).toArray();case 3:return op.setHex(9220966).toArray();case 8:return op.setHex(12967404).toArray();default:return op.setHex(13421772).toArray()}}(t)),y.push(i.radius),b.push(e)})),{position1:new Float32Array(g),position2:new Float32Array(_),color:new Float32Array(v),color2:new Float32Array(v),radius:new Float32Array(y),picking:new dp(b,e,t)}}(function(e,t=tp){const n=function(e){const{types:t,centers:n}=e;return{features:e,spatialHash:new Yh(n),contactStore:new Zh,featureSet:new Jh(t.length,!1)}}(function(e){const t={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return Ql&&Yl.time("calculateFeatures"),function(e,t){const{charge:n}=Fd(e.data),i={};e.eachResidue((e=>{if(Ud.includes(e.resname)){const n=td(1);e.eachAtom((e=>{7===e.number&&e.isSidechain()&&nd(n,e)})),id(t,n)}else xd.includes(e.resname)||e.isNucleic()||(e.eachAtom((e=>{let n=!1;const r=td(1);!function(e){let t=0;return 6===e.number&&3===e.bondCount&&3===e.bondToElementCount(7)&&e.eachBondedAtom((e=>{e.bondCount-e.bondToElementCount(1)==1&&++t})),2===t}(e)?function(e){let t=0;return 6===e.number&&3===e.bondCount&&2===e.bondToElementCount(7)&&1===e.bondToElementCount(6)&&e.eachBondedAtom((e=>{e.bondCount-e.bondToElementCount(1)==1&&++t})),2===t}(e)&&(r.group=9,n=!0):(r.group=8,n=!0),n&&(e.eachBondedAtom((e=>{7===e.number&&(i[e.index]=!0,nd(r,e))})),id(t,r))})),e.eachAtom((e=>{const r=td(1);n[e.index]>0&&(i[e.index]||(nd(r,e),id(t,r)))})))}))}(e,t),function(e,t){const{charge:n}=Fd(e.data),i={};e.eachResidue((e=>{if(zd.includes(e.resname)){const n=td(2);e.eachAtom((e=>{8===e.number&&e.isSidechain()&&nd(n,e)})),id(t,n)}else if(Md.includes(e.resname)){const n=td(2);e.eachAtom((e=>{Bd(e)&&(n.group=6,e.eachBondedAtom((e=>{8===e.number&&nd(n,e)})),id(t,n))}))}else xd.includes(e.resname)||Md.includes(e.resname)||(e.eachAtom((e=>{let n=!1;const r=td(2);!function(e){return 16===e.number&&3===e.bondToElementCount(8)}(e)?Bd(e)?(r.group=6,n=!0):function(e){return 16===e.number&&4===e.bondToElementCount(8)}(e)?(r.group=5,n=!0):function(e){let t=0;return 6===e.number&&2===e.bondToElementCount(8)&&1===e.bondToElementCount(6)&&e.eachBondedAtom((e=>{8===e.number&&e.bondCount-e.bondToElementCount(1)==1&&++t})),2===t}(e)&&(r.group=10,n=!0):(r.group=4,n=!0),n&&(e.eachBondedAtom((e=>{8===e.number&&(i[e.index]=!0,nd(r,e))})),id(t,r))})),e.eachAtom((e=>{const r=td(2);n[e.index]<0&&(i[e.index]||(nd(r,e),id(t,r)))})))}))}(e,t),function(e,t){const n=e.getAtomProxy();e.eachResidue((e=>{const i=e.getAromaticRings();if(i){const r=e.atomOffset;i.forEach((e=>{const i=td(3);e.forEach((e=>{n.index=e+r,nd(i,n)})),id(t,i)}))}}))}(e,t),function(e,t){const{charge:n,implicitH:i,idealGeometry:r}=Fd(e.data);e.eachAtom((e=>{const s=td(5),o=e.number;if(8===o)nd(s,e),id(t,s);else if(7===o){if(Gd(e))nd(s,e),id(t,s);else if(n[e.index]<1){const n=e.bondCount+i[e.index],o=r[e.index];(4===o&&n<4||3===o&&n<3||2===o&&n<2)&&(nd(s,e),id(t,s))}}else 16===o&&("CYS"!==e.resname&&"MET"!==e.resname&&-1!==e.formalCharge||(nd(s,e),id(t,s)))}))}(e,t),function(e,t){const{totalH:n}=Fd(e.data);e.eachAtom((e=>{const i=td(4),r=e.number;(Gd(e)||n[e.index]>0&&(7===r||8===r||16===r))&&(nd(i,e),id(t,i))}))}(e,t),function(e,t){const{totalH:n}=Fd(e.data);e.eachAtom((e=>{if(6===e.number&&n[e.index]>0&&(e.bondToElementCount(7)>0||e.bondToElementCount(8)>0||function(e){if(!e.isAromatic())return!1;const t=e.residueType.getRings();if(!t)return!1;let n=!1;return t.rings.forEach((t=>{n||t.some((t=>e.index-e.residueAtomOffset===t))&&(n=t.some((t=>{const n=e.residueType.atomTypeIdList[t],i=e.atomMap.get(n).number;return 7===i||8===i})))})),n}(e))){const n=td(9);nd(n,e),id(t,n)}}))}(e,t),function(e,t){e.eachAtom((e=>{let n=!1,i=!1;const r=xd.includes(e.resname),s=Md.includes(e.resname);if(r||s?r?8===e.number?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(e.resname)&&e.isSidechain()||e.isBackbone())&&(n=!0,i=!0):16===e.number&&"CYS"===e.resname?(n=!0,i=!0):7===e.number&&"HIS"===e.resname&&e.isSidechain()&&(n=!0):s&&(8===e.number&&e.isBackbone()?(n=!0,i=!0):["N3","N4","N7"].includes(e.atomname)?n=!0:["O2","O4","O6"].includes(e.atomname)&&(n=!0,i=!0)):e.isHalogen()||8===e.number||16===e.number?(n=!0,i=!0):7===e.number&&(n=!0),n){const n=td(11);nd(n,e),id(t,n)}if(i){const n=td(10);nd(n,e),id(t,n)}}))}(e,t),function(e,t){e.eachAtom((e=>{if(e.isTransitionMetal()||30===e.number||48===e.number){const n=td(12);nd(n,e),id(t,n)}else if(qd.includes(e.number)){const n=td(13);nd(n,e),id(t,n)}}))}(e,t),function(e,t){e.eachAtom((e=>{const n=td(8);let i=!1;6===e.number?(i=!0,e.eachBondedAtom((e=>{const t=e.number;6!==t&&1!==t&&(i=!1)}))):9===e.number&&(i=!0),i&&(nd(n,e),id(t,n))}))}(e,t),function(e,t){e.eachAtom((e=>{if(Kd.includes(e.number)){let n=!1;if(e.eachBondedAtom((e=>{Zd.includes(e.number)&&(n=!0)})),n){const n=td(7);nd(n,e),id(t,n)}}}))}(e,t),function(e,t){e.eachAtom((e=>{if(Yd.includes(e.number)&&1===e.bondToElementCount(6)){const n=td(6);nd(n,e),id(t,n)}}))}(e,t),Ql&&Yl.timeEnd("calculateFeatures"),t}(e));Ql&&Yl.time("calculateContacts"),function(e,t,n={}){const i=Aa(n.maxIonicDist,tp.maxIonicDist),r=Aa(n.maxPiStackingDist,tp.maxPiStackingDist),s=Aa(n.maxPiStackingOffset,tp.maxPiStackingOffset),o=Aa(n.maxPiStackingAngle,tp.maxPiStackingAngle),a=Aa(n.maxCationPiDist,tp.maxCationPiDist),l=Aa(n.maxCationPiOffset,tp.maxCationPiOffset),c=Aa(n.masterModelIndex,tp.masterModelIndex),u=Math.max(i+2,r,a),h=r*r,d=a*a,{features:p,spatialHash:f,contactStore:m,featureSet:g}=t,{types:_,centers:v,atomSets:y}=p,{x:b,y:x,z:w}=v,S=_.length,A=e.atomStore.x,M=e.atomStore.y,C=e.atomStore.z,T=e.getAtomProxy(),E=e.getAtomProxy(),P=function(e,t,n){const i=e.length,r=t.length;for(let s=0;s<i;++s){T.index=e[s];for(let e=0;e<r;++e)if(E.index=t[e],T.distanceTo(E)<=n)return!0}return!1},I=new ut,k=new ut,R=new ut,D=new ut,L=new ut,O=new ut,N=new ut,F=function(e,t){I.set(A[e[0]],M[e[0]],C[e[0]]),k.set(A[e[1]],M[e[1]],C[e[1]]),R.set(A[e[2]],M[e[2]],C[e[2]]),D.subVectors(I,k),L.subVectors(I,R),t.crossVectors(D,L)},B=function(e,t,n){return I.set(b[e],x[e],w[e]),k.set(b[t],x[t],w[t]),I.sub(k).projectOnPlane(n).add(k).distanceTo(k)},U=function(e,t,n){g.setBits(e,t),m.addContact(e,t,n)};for(let e=0;e<S;++e)f.eachWithin(b[e],x[e],w[e],u,((t,n)=>{if(t<=e)return;if(T.index=y[e][0],E.index=y[t][0],ip(T,E,c))return;const r=_[e],a=_[t];if(Vd(r,a))P(y[e],y[t],i)&&U(e,t,1);else if(Hd(r,a)){if(n<=h){F(y[e],O),F(y[t],N);const n=57.29578*O.angleTo(N);Math.min(B(e,t,N),B(t,e,O))<=s&&(n<=o||n>=180-o||n<=o+90&&n>=90-o)&&U(e,t,3)}}else if($d(r,a)&&n<=d){const[n,i]=3===r?[e,t]:[t,e];F(y[n],O),B(i,n,O)<=l&&U(n,i,2)}}))}(e,n,t),function(e,t,n={}){const i=Aa(n.maxHbondDist,tp.maxHbondDist),r=Aa(n.maxHbondSulfurDist,tp.maxHbondSulfurDist),s=qa(Aa(n.maxHbondAccAngle,tp.maxHbondAccAngle)),o=qa(Aa(n.maxHbondDonAngle,tp.maxHbondDonAngle)),a=qa(Aa(n.maxHbondAccPlaneAngle,tp.maxHbondAccPlaneAngle)),l=qa(Aa(n.maxHbondDonPlaneAngle,tp.maxHbondDonPlaneAngle)),c=Aa(n.masterModelIndex,tp.masterModelIndex),u=Math.max(i,r),h=i*i,{features:d,spatialHash:p,contactStore:f,featureSet:m}=t,{types:g,centers:_,atomSets:v}=d,{x:y,y:b,z:x}=_,w=g.length,{idealGeometry:S}=Fd(e.data),A=e.getAtomProxy(),M=e.getAtomProxy();for(let e=0;e<w;++e)p.eachWithin(y[e],b[e],x[e],u,((t,n)=>{if(t<=e)return;const i=g[e],r=g[t],u=Wd(i,r);if(!u&&!jd(i,r))return;const[d,p]=5===r?[e,t]:[t,e];if(A.index=v[d][0],M.index=v[p][0],M.index===A.index)return;if(ip(A,M,c))return;if(16!==A.number&&16!==M.number&&n>h)return;if(A.connectedTo(M))return;const _=Od(A,M),y=Ld.get(S[A.index])||qa(120);if(_.some((e=>Math.abs(y-e)>o)))return;if(3===S[A.index]){const e=Nd(A,M);if(void 0!==e&&e>l)return}const b=Od(M,A),x=Ld.get(S[M.index])||qa(120);if(b.some((e=>x-e>s)))return;if(3===S[M.index]){const e=Nd(M,A);if(void 0!==e&&e>a)return}m.setBits(d,p);const w=u?8:function(e,t){return e.isWater()&&t.isWater()}(C=A,T=M)?9:function(e,t){return e.isBackbone()&&t.isBackbone()}(C,T)?10:4;var C,T;f.addContact(d,p,w)}))}(e,n,t),function(e,t,n={}){const i=Aa(n.maxMetalDist,tp.maxMetalDist),r=Aa(n.masterModelIndex,tp.masterModelIndex),{features:s,spatialHash:o,contactStore:a,featureSet:l}=t,{types:c,centers:u,atomSets:h}=s,{x:d,y:p,z:f}=u,m=c.length,g=e.getAtomProxy(),_=e.getAtomProxy();for(let e=0;e<m;++e)o.eachWithin(d[e],p[e],f[e],i,((t,n)=>{if(t<=e)return;if(g.index=h[e][0],_.index=h[t][0],ip(g,_,r))return;const i=g.isMetal(),s=_.isMetal();if(!i&&!s)return;const[o,u]=i?[c[e],c[t]]:[c[t],c[e]];Xd(o,u)&&(l.setBits(e,t),a.addContact(e,t,7))}))}(e,n,t),function(e,t,n={}){const i=Aa(n.maxHydrophobicDist,tp.maxHydrophobicDist),r=Aa(n.masterModelIndex,tp.masterModelIndex),{features:s,spatialHash:o,contactStore:a,featureSet:l}=t,{types:c,centers:u,atomSets:h}=s,{x:d,y:p,z:f}=u,m=c.length,g=e.getAtomProxy(),_=e.getAtomProxy();for(let e=0;e<m;++e)o.eachWithin(d[e],p[e],f[e],i,((t,n)=>{var i,s;t<=e||(g.index=h[e][0],_.index=h[t][0],ip(g,_,r)||9===g.number&&9===_.number||g.connectedTo(_)||(i=c[e],s=c[t],8===i&&8===s&&(l.setBits(e,t),a.addContact(e,t,6))))}))}(e,n,t),function(e,t,n={}){const i=Aa(n.maxHalogenBondDist,tp.maxHalogenBondDist),r=qa(Aa(n.maxHalogenBondAngle,tp.maxHalogenBondAngle)),s=Aa(n.masterModelIndex,tp.masterModelIndex),{features:o,spatialHash:a,contactStore:l,featureSet:c}=t,{types:u,centers:h,atomSets:d}=o,{x:p,y:f,z:m}=h,g=u.length,_=e.getAtomProxy(),v=e.getAtomProxy();for(let e=0;e<g;++e)a.eachWithin(p[e],f[e],m[e],i,((t,n)=>{if(t<=e)return;if(_.index=d[e][0],v.index=d[t][0],ip(_,v,s))return;if(i=u[e],o=u[t],!(7===i&&6===o||6===i&&7===o))return;var i,o;const[a,h]=6===u[e]?[_,v]:[v,_],p=Od(a,h);if(1!==p.length)return;if(Qd-p[0]>r)return;const f=Od(h,a);0!==f.length&&(f.some((e=>Jd-e>r))||(c.setBits(e,t),l.addContact(e,t,5)))}))}(e,n,t);const i=function(e){const{index1:t,index2:n,count:i}=e.contactStore,r=ed({nodeArray1:t,nodeArray2:n,edgeCount:i,nodeCount:e.featureSet.length}),s=new Jh(e.contactStore.count,!0);return Object.assign({adjacencyList:r,contactSet:s},e)}(n);return function(e,t,n={}){Ql&&Yl.time("refineLineOfSight");const i=Aa(n.lineOfSightDistFactor,tp.lineOfSightDistFactor),r=Aa(n.masterModelIndex,tp.masterModelIndex),s=e.spatialHash,{contactSet:o,contactStore:a,features:l}=t,{index1:c,index2:u}=a,{centers:h,atomSets:d}=l,{x:p,y:f,z:m}=h,g=e.getAtomProxy(),_=e.getAtomProxy(),v=e.getAtomProxy(),y=new ut,b=new ut,x=3*i,w=i*i;o.forEach((e=>{y.set(p[c[e]],f[c[e]],m[c[e]]),b.set(p[u[e]],f[u[e]],m[u[e]]);const t=(y.x+b.x)/2,n=(y.y+b.y)/2,i=(y.z+b.z)/2,a=d[c[e]],l=d[u[e]];g.index=a[0],_.index=l[0],s.eachWithin(t,n,i,x,((t,n)=>{v.index=t,1!==v.number&&v.vdw*v.vdw*w>n&&!ep(g,v,r)&&!ep(_,v,r)&&!a.includes(t)&&!l.includes(t)&&y.distanceToSquared(v)>1&&b.distanceToSquared(v)>1&&(o.clear(e),Ql&&Yl.log("removing",g.qualifiedName(),_.qualifiedName(),"because",v.qualifiedName()))}))})),Ql&&Yl.timeEnd("refineLineOfSight")}(e,i,t),function(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c=e.getAtomProxy(),u=e.getAtomProxy(),h={},d=function(e,t,i){const[r,s]=h[i]||[1/0,-1];e<r?(-1!==s&&n.clear(s),h[i]=[e,t]):n.clear(t)};n.forEach((e=>{if(6!==s[e])return;c.index=l[o[e]][0],u.index=l[a[e]][0];const t=c.distanceTo(u);d(t,e,`${c.index}|${u.residueIndex}`),d(t,e,`${u.index}|${c.residueIndex}`)}))}(e,i),t.refineSaltBridges&&function(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{1===s[e]&&(l[o[e]].forEach((t=>u(t,e))),l[a[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(!function(e){return 4===e||9===e||10===e}(s[e]))return;const t=c[l[o[e]][0]],i=c[l[a[e]][0]];if(!t||!i)return;const r=t.length;for(let s=0;s<r;++s)if(i.includes(t[s]))return void n.clear(e)}))}(0,i),function(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{3===s[e]&&(l[o[e]].forEach((t=>u(t,e))),l[a[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(6!==s[e]&&2!==s[e])return;const t=c[l[o[e]][0]],i=c[l[a[e]][0]];if(!t||!i)return;const r=t.length;for(let s=0;s<r;++s)if(i.includes(t[s]))return void n.clear(e)}))}(0,i),function(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{1===s[e]&&(l[o[e]].forEach((t=>u(t,e))),l[a[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(7!==s[e])return;const t=c[l[o[e]][0]],i=c[l[a[e]][0]];if(!t||!i)return;const r=t.length;for(let e=0;e<r;++e)if(i.includes(t[e]))return void n.clear(t[e])}))}(0,i),Ql&&Yl.timeEnd("calculateContacts"),i}(e,t),e,n)}createData(e){const t=this.getContactData(e),n=[new iv(Rh(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const e={size:this.labelSize,unit:this.labelUnit};n.push(new U_(function(e,t){const n=Hc(e.position1,e.position2),i=[],r=$c(e.position1,e.position2),s=r.length/3;for(let e=0;e<s;e++){const n=3*e,s=Math.sqrt(Math.pow(r[n],2)+Math.pow(r[n+1],2)+Math.pow(r[n+2],2));switch(t.unit){case"angstrom":i[e]=s.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":i[e]=(s/10).toFixed(2)+" nm";break;default:i[e]=s.toFixed(2)}}return{position:n,size:Gc(n.length/3,t.size),color:e.color,text:i}}(t,e),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}sc.add("contact",mv);class gv extends E_{constructor(e,t,n){super(e,t,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=Aa(t.side,"double"),t.opacity=Aa(t.opacity,.5),this.atomQuad=Aa(t.atomQuad,[]),this.extendLine=Aa(t.extendLine,!0),this.lineVisible=Aa(t.lineVisible,!0),this.planeVisible=Aa(t.planeVisible,!0),this.sectorVisible=Aa(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=function(e,t={}){const n=Aa(t.angleStep,Math.PI/90),i=e.length,r=e.length/12,s=new Float32Array(r),o=new Float32Array(3*r),a=new Array(r),l=new Array(r),c=new Array(r),u=new Array(r),h=new Array(r);let d=0,p=0,f=0;const m=fh(),g=fh(),_=fh(),v=fh(),y=fh(),b=fh(),x=fh(),w=fh(),S=fh(),A=fh(),M=fh(),C=fh(),T=fh(),E=fh(),P=fh();let I=0;for(var k=0;k<i;k+=12){if(yh(m,e,k),yh(g,e,k+3),yh(_,e,k+6),yh(v,e,k+9),_h(y,m,g),_h(b,_,g),0===wh(b))continue;_h(x,v,_),Ah(w,b,.5),vh(S,g,w),Mh(y,y),Mh(b,b),Mh(x,x),_h(w,m,S);const i=gh(w,b)>0;_h(w,v,S);const r=gh(w,b)<0;if(Ah(w,b,gh(b,y)),_h(A,y,w),Ah(w,b,gh(b,x)),_h(M,x,w),0===wh(A)||0===wh(M))continue;Mh(A,A),Mh(M,M);const R=s[I]=kh(A,M);a[I]=(zc*R).toFixed(1)+String.fromCharCode(176),mh(E,A,b),Mh(E,E),gh(E,M)<0&&Ih(E,E),I_(w,S,A,E,R/2),bh(w,o,3*I);const D=Math.ceil(R/n),L=D+(t.extendLine?4:2),O=t.extendLine?36:0,N=new Float32Array(3*L),F=new Float32Array(3*L),B=new Float32Array(9*D),U=new Float32Array(O);l[I]=N,c[I]=F,u[I]=B,h[I]=U,t.extendLine&&(i?(_h(w,m,_),Mh(w,w),Ah(C,w,1/gh(A,w)),vh(C,C,_)):(Ah(C,y,1/gh(A,y)),vh(C,C,g)),r?(_h(w,v,g),Mh(w,w),Ah(T,w,1/gh(M,w)),vh(T,T,g)):(Ah(T,x,1/gh(M,x)),vh(T,T,_))),vh(P,S,A);let z=0;t.extendLine?(bh(m,N,z),bh(C,F,z),z+=3,bh(C,N,z),bh(P,F,z),z+=3,bh(C,U,0),bh(P,U,3),bh(i?_:g,U,6),bh(i?_:g,U,9),bh(P,U,12),bh(S,U,15)):(bh(S,N,z),bh(P,F,z),z+=3);const V=function(e,t){const n=9*t;bh(S,B,n),bh(P,B,n+3),bh(P,N,z),I_(P,S,A,E,e),bh(P,B,n+6),bh(P,F,z),z+=3};let H=0;for(let e=n;e<R;e+=n)V(e,H++);V(R,H++),t.extendLine?(bh(P,N,3*(L-2)),bh(T,F,3*(L-2)),bh(T,N,3*(L-1)),bh(v,F,3*(L-1)),bh(T,U,18),bh(P,U,21),bh(r?g:_,U,24),bh(r?g:_,U,27),bh(P,U,30),bh(S,U,33)):(bh(P,N,z),bh(S,F,z),z+=3),d+=3*L,p+=9*D,f+=O,I+=1}const R=I,D=new Float32Array(d),L=new Float32Array(d),O=new Float32Array(p),N=new Float32Array(f);let F=0,B=0,U=0;for(let e=0;e<R;e++){const t=l[e],n=c[e],i=u[e],r=h[e];Yc(t,D,0,F,t.length),Yc(n,L,0,F,n.length),Yc(i,O,0,B,i.length),Yc(r,N,0,U,r.length),F+=t.length,B+=i.length,U+=r.length}return{labelPosition:o.subarray(0,3*R),labelText:a.slice(0,R),linePosition1:D,linePosition2:L,planePosition:N,sectorPosition:O}}(P_(e,this.atomQuad),{extendLine:this.extendLine}),n=this.n=t.labelText.length,i=new Pn(this.labelColor);this.textBuffer=new U_({position:t.labelPosition,size:Gc(n,this.labelSize),color:jc(n,i.r,i.g,i.b),text:t.labelText},this.getLabelBufferParams());const r=new Pn(this.colorValue);this.lineLength=t.linePosition1.length/3;const s=jc(this.lineLength,r.r,r.g,r.b);return this.lineBuffer=new H_(Lh({position1:t.linePosition1,position2:t.linePosition2,color:s,color2:s}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new ef({position:t.planePosition,color:jc(this.planeLength,r.r,r.g,r.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new ef({position:t.sectorPosition,color:jc(this.sectorLength,r.r,r.g,r.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},r={};if(e.color){const e=new Pn(this.colorValue);Object.assign(n,{color:jc(this.lineLength,e.r,e.g,e.b),color2:jc(this.lineLength,e.r,e.g,e.b)}),Object.assign(i,{color:jc(this.planeLength,e.r,e.g,e.b)}),Object.assign(r,{color:jc(this.sectorLength,e.r,e.g,e.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(i),this.sectorBuffer.setAttributes(r)}setParameters(e){return super.setParameters(e,{},!1),!e||void 0===e.lineVisible&&void 0===e.sectorVisible&&void 0===e.planeVisible||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&void 0!==e.opacity&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}function _v(e,t){function n(e,t){return t in e}const i=Object.assign({},e);for(const e in i)n(i,e)&&n(t,e)&&(i[e]=Aa(t[e],i[e]));return i}function vv(e,t){const n=new Pn(e),i=new Float32Array(3*t);return jc(t,n.r,n.g,n.b,i),i}sc.add("dihedral",gv);class yv extends T_{constructor(e,t,n){super(e,t,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(e){const t=e||{},n=_v({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,n);const i=_v({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,i),this.histogramsData.forEach((e=>{const t=_v(n,e);Object.assign(e,t)})),t.side=Aa(t.side,"double"),t.opacity=Aa(t.opacity,.5),t.radiusType=Aa(t.radiusType,"size"),t.radiusSize=Aa(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach((t=>t.atomPositions=P_(e,[t.atomQuad])));const t=this.scaleBinToSectorArea?function(e){return Math.sqrt(e)}:function(e){return e};function n(e){const t=e.map((e=>e.length)),n=new Float32Array(Jc(t));let i=0;for(let t=0;t<e.length;t++)n.set(e[t],i),i+=e[t].length;return n}function i(e,t){return new H_({position1:n(e.map((e=>e.startPoints))),position2:n(e.map((e=>e.endPoints))),color:n(e.map((e=>e.startColors))),color2:n(e.map((e=>e.endColors)))},t)}function r(e,t){return new ef({position:n(e.map((e=>e.triangles))),color:n(e.map((e=>e.triangleColors)))},t)}this.histogramsData.forEach((e=>e.histogram360Scaled=e.histogram360.map(t)));const s=[];for(let e=0;e<this.histogramsData.length;e++){let t,n=this.histogramsData[e];n.histogram360.length>=3&&(t=bv(n)),void 0!==t&&s.push(t)}return this.frontHistogramBinBordersBuffer=i(s.map((e=>e.frontHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=i(s.map((e=>e.backHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=i(s.map((e=>e.adjacentBondArrows)),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=i(s.map((e=>e.distantBondArrows)),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=r(s.map((e=>e.opaqueMiddleDisc)),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=r(s.map((e=>e.frontHistogram)),this.getHistogramBufferParameters()),this.backHistogramBuffer=r(s.map((e=>e.backHistogram)),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){return super.setParameters(e,{},!1),e&&void 0!==e.histogramBinBorderVisible&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}function bv(e){const t=e.atomPositions,n=e.histogram360Scaled,i=n.length<=180?360:2*n.length,r={triangles:new Float32Array(3*i*3),triangleColors:vv(e.opaqueMiddleDiscColor,3*i)},s={triangles:new Float32Array(3*n.length*3),triangleColors:vv(e.frontHistogramColor,3*n.length)},o={triangles:new Float32Array(3*n.length*3),triangleColors:vv(e.backHistogramColor,3*n.length)},a={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:vv(e.histogramBinBorderColor,n.length),endColors:vv(e.histogramBinBorderColor,n.length)},l={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:vv(e.histogramBinBorderColor,n.length),endColors:vv(e.histogramBinBorderColor,n.length)},c={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:vv(e.adjacentBondArrowColor,n.length),endColors:vv(e.adjacentBondArrowColor,n.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:vv(e.distantBondArrowColor,n.length),endColors:vv(e.distantBondArrowColor,n.length)},h=fh(),d=fh(),p=fh(),f=fh(),m=fh(),g=fh(),_=fh(),v=fh(),y=fh(),b=fh(),x=fh(),w=fh(),S=fh(),A=fh(),M=fh(),C=fh(),T=[h,d,p,f];for(let e=0;e<T.length;e++)yh(T[e],t,3*e);if(_h(m,h,d),_h(g,p,d),_h(v,f,p),0===wh(g))return;if(Ah(M,g,.5),vh(y,d,M),Mh(m,m),Mh(g,g),Mh(v,v),Ih(_,g),Ah(M,_,gh(_,m)),_h(b,m,M),Ah(M,g,gh(g,v)),_h(x,v,M),0===wh(b)||0===wh(x))return;Mh(b,b),Mh(x,x);const E=Math.acos(gh(b,x));mh(w,_,b),mh(S,g,x),Mh(w,w),Mh(S,S);let P=E;gh(w,x)<0&&(P=-E),vh(A,y,b);const I=Math.max.apply(null,n),k=2*Math.PI/n.length;function R(e,t,i,r,s){const o=3*t*3;bh(y,e,o);const a=Number(n[t])/I;Ah(M,i,a),Ah(C,r,a),I_(A,y,M,C,t*s),bh(A,e,o+3),I_(A,y,M,C,(t+1)*s),bh(A,e,o+6)}function D(e,t,i,r,s){Yc(y,c.startPoints,0,3*i,y.length),I_(M,y,r,s,0+0*k),Yc(M,c.endPoints,0,3*i,y.length),Yc(y,u.startPoints,0,3*i,y.length),I_(M,y,r,s,P),Yc(M,u.endPoints,0,3*i,y.length);for(let e=0;e<n.length;e++)Yc(y,t.startPoints,0,3*e,y.length),I_(M,y,r,s,0+k*e),Yc(M,t.endPoints,0,3*e,M.length);for(let t=0;t<n.length;t++)R(e.triangles,t,r,s,k)}const L=2*Math.PI/i;for(let e=0;e<i;e++){const t=3*e*3;bh(y,r.triangles,t),I_(A,y,b,w,e*L),bh(A,r.triangles,t+3),I_(A,y,b,w,(e+1)*L),bh(A,r.triangles,t+6)}return Ah(M,g,-.01),vh(y,y,M),D(s,a,0,b,w),Ah(M,g,.02),vh(y,y,M),D(o,l,1,x,S),{opaqueMiddleDisc:r,frontHistogram:s,backHistogram:o,frontHistogramBinBorders:a,backHistogramBinBorders:l,adjacentBondArrows:c,distantBondArrows:u}}sc.add("dihedral-histogram",yv);class xv extends E_{constructor(e,t,n){super(e,t,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.linewidth=Aa(t.linewidth,5),t.radiusType=Aa(t.radiusType,"size"),t.radiusSize=Aa(t.radiusSize,.2),this.labelUnit=Aa(t.labelUnit,""),this.useCylinder=Aa(t.useCylinder,!1),this.atomPair=Aa(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let n=t.length;const i=new Array(n);let r=new Float32Array(3*n);const s=new Ll,o=new Ll,a=new Rf,l=e.getAtomProxy(),c=e.getAtomProxy();let u=0;const h=e.getAtomSet();t.forEach(((t,n)=>{let d=t[0],p=t[1];if("number"==typeof d&&Number.isInteger(d)&&"number"==typeof p&&Number.isInteger(p)){if(!h.get(d)||!h.get(p))return void(u+=1);l.index=d,c.index=p}else{s.setString(d),o.setString(p);var f=e.getAtomIndices(s),m=e.getAtomIndices(o);if(!f.length||!m.length)return void(u+=1);l.index=f[0],c.index=m[0]}a.addBond(l,c,1),n-=u;var g=l.distanceTo(c);switch(this.labelUnit){case"angstrom":i[n]=g.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":i[n]=(g/10).toFixed(2)+" nm";break;default:i[n]=g.toFixed(2)}var _=3*n;r[_+0]=(l.x+c.x)/2,r[_+1]=(l.y+c.y)/2,r[_+2]=(l.z+c.z)/2})),u>0&&(n-=u,r=r.subarray(0,3*n));var d=new Jh(a.count,!0);return{text:i,position:r,bondSet:d,bondStore:a}}getBondData(e,t,n){const i=e.getBondData(this.getBondParams(t,n));return i.picking&&(i.picking=new fp(i.picking.array,i.picking.structure,n.bondStore)),i}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,n=new Pn(this.labelColor),i=this.getDistanceData(e,this.atomPair);this.textBuffer=new U_({position:i.position,size:Gc(t,this.labelSize),color:jc(t,n.r,n.g,n.b),text:i.text},this.getLabelBufferParams());const r={bondSet:i.bondSet,bondStore:i.bondStore},s=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},r);return this.useCylinder?this.distanceBuffer=new iv(s,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new H_(Dh(s),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:i.bondSet,bondStore:i.bondStore,position:i.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const n={bondSet:t.bondSet,bondStore:t.bondStore},i=this.getBondData(t.sview,e,n),r={};e&&!e.color||Object.assign(r,{color:i.color,color2:i.color2}),e&&!e.radius||Object.assign(r,{radius:i.radius}),this.distanceBuffer.setAttributes(r)}setParameters(e){return super.setParameters(e,{},!1),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&void 0!==e.opacity&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}}function wv(e){return e.position.length/3*2*3}sc.add("distance",xv);const Sv=Object.assign({scale:1,color:"grey"},Zp);class Av extends Jp{constructor(e,t={}){super({position:new Float32Array(wv(e)),color:new Float32Array(wv(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new Pn(this.parameters.color),i=this.geometry.attributes;jc(wv(e)/3,n.r,n.g,n.b,i.color.array),this.setAttributes(e)}get defaultParameters(){return Sv}setAttributes(e={}){const t=this.geometry.attributes;let n,i,r;e.position&&e.vector&&(n=e.position,i=e.vector,r=t.position.array,t.position.needsUpdate=!0);const s=this.size/2,o=this.parameters.scale;if(n&&i)for(let e=0;e<s;e++){const t=2*e*3,s=3*e;r[t+0]=n[s+0],r[t+1]=n[s+1],r[t+2]=n[s+2],r[t+3]=n[s+0]+i[s+0]*o,r[t+4]=n[s+1]+i[s+1]*o,r[t+5]=n[s+2]+i[s+2]*o}}}class Mv extends T_{constructor(e,t,n){super(e,t,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){const t=e||{};t.colorScheme=Aa(t.colorScheme,"sstruc"),t.radiusType=Aa(t.radiusType,"size"),t.radiusSize=Aa(t.radiusSize,.15),t.radiusScale=Aa(t.radiusScale,1),t.useInteriorColor=Aa(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],n=[];return this.structure.eachPolymer((e=>{if(e.residueCount<4)return;n.push(e);const i=new Ff(e),r=i.getPosition(),s=i.getColor(this.getColorParams()),o=i.getSize(this.getRadiusParams()),a=i.getPicking();t.push(new eg({position:r.center,color:s.color,radius:o.size,picking:a.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new Av({position:r.center,vector:r.axis},this.getBufferParams({color:"skyblue",scale:1})),new Av({position:r.center,vector:r.resdir},this.getBufferParams({color:"lightgreen",scale:1})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){Ql&&Yl.time(this.type+" repr update"),e=e||{};for(let n=0,i=t.polymerList.length;n<i;++n){const i=3*n,r={},s=t.polymerList[n],o=new Ff(s);if(e.position){const e=o.getPosition();Object.assign(r,{position:e.center}),t.bufferList[i+1].setAttributes({position:e.center,vector:e.axis}),t.bufferList[i+2].setAttributes({position:e.center,vector:e.resdir})}t.bufferList[i].setAttributes(r)}Ql&&Yl.timeEnd(this.type+" repr update")}}sc.add("helixorient",Mv);class Cv extends sv{constructor(e,t,n){super(e,t,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}sc.add("licorice",Cv),ac.add("shader/HyperballStickImpostor.vert","\nattribute vec3 mapping;\nattribute float radius;\nattribute float radius2;\nattribute vec3 position1;\nattribute vec3 position2;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform float shrink;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewProjectionMatrixInverse;\nvoid main(){\nvRadius = radius;\nvRadius2 = radius2;\nvec4 spaceposition;\nvec3 position_atom1;\nvec3 position_atom2;\nvec4 vertex_position;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nfloat radius1 = radius;\nposition_atom1 = position1;\nposition_atom2 = position2;\nfloat distance = distance( position_atom1, position_atom2 );\nspaceposition.z = mapping.z * distance;\nif (radius1 > radius2) {\nspaceposition.y = mapping.y * 1.5 * radius1;\nspaceposition.x = mapping.x * 1.5 * radius1;\n} else {\nspaceposition.y = mapping.y * 1.5 * radius2;\nspaceposition.x = mapping.x * 1.5 * radius2;\n}\nspaceposition.w = 1.0;\nvec4 e3 = vec4( 1.0 );\nvec3 e1, e1_temp, e2, e2_temp;\ne3.xyz = normalize(position_atom1-position_atom2);\nif (e3.z == 0.0) { e3.z = 0.0000000000001;}\nif ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}\nif ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}\nif ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}\nvec4 focus = vec4( 1.0 );\nfocus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +\n( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));\nfocus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +\n( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));\nfocus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +\n( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;\ne2 = normalize(e2_temp);\nmat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );\nvertex_position.xyz = R * spaceposition.xyz;\nvertex_position.w = 1.0;\nvertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;\nvertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;\nvertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;\ngl_Position = modelViewProjectionMatrix * vertex_position;\nvec4 i_near, i_far;\nvec4 near = gl_Position;\nnear.z = 0.0 ;\nnear = modelViewProjectionMatrixInverse * near;\ni_near = near;\nvec4 far = gl_Position;\nfar.z = far.w ;\ni_far = modelViewProjectionMatrixInverse * far;\nprime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );\nprime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );\nfloat Rsquare = (radius1*radius1/shrink) - (\n(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +\n(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +\n(position_atom1.z - focus.z)*(position_atom1.z - focus.z)\n);\nfocus.w = Rsquare;\nmatrix_near = mat4( i_near, i_far, focus, e3 );\ngl_Position.z = 1.0;\n}"),ac.add("shader/HyperballStickImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float shrink;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrixInverseTranspose;\nuniform mat4 projectionMatrix;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat calcClip( vec4 cameraPos ){\nreturn dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nfloat calcClip( vec3 cameraPos ){\nreturn calcClip( vec4( cameraPos, 1.0 ) );\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nstruct Ray {\nvec3 origin ;\nvec3 direction ;\n};\nbool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){\nfloat a = x3.x;\nfloat b = x3.y;\nfloat c = x3.z;\nfloat d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;\nfloat l = a*M.x+b*M.y+c*M.z+d;\nif (l<0.0) {return true;}\nelse{return false;}\n}\nvec3 isect_surf(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t1 =(-b-sqrt(delta))/a;\nreturn r.origin+t1*r.direction;\n}\nvec3 isect_surf2(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t2 =(-b+sqrt(delta))/a;\nreturn r.origin+t2*r.direction;\n}\nRay primary_ray(vec4 near1, vec4 far1){\nvec3 near=near1.xyz/near1.w;\nvec3 far=far1.xyz/far1.w;\nreturn Ray(near,far-near);\n}\nfloat update_z_buffer(vec3 M, mat4 ModelViewP){\nfloat depth1;\nvec4 Ms=(ModelViewP*vec4(M,1.0));\nreturn depth1=(1.0+Ms.z/Ms.w)/2.0;\n}\nvoid main(){\nfloat radius = max( vRadius, vRadius2 );\nvec4 i_near, i_far, focus;\nvec3 e3, e1, e1_temp, e2;\ni_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);\ni_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);\nfocus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);\ne3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2 = normalize(cross(e1,e3));\nvec4 equation = focus;\nfloat shrinkfactor = shrink;\nfloat t1 = -1.0/(1.0-shrinkfactor);\nfloat t2 = 1.0/(shrinkfactor);\nvec4 colonne1, colonne2, colonne3, colonne4;\nmat4 mat;\nvec3 equation1 = vec3(t2,t2,t1);\nfloat A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;\nfloat A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;\nfloat A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;\nfloat A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;\nfloat A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;\nfloat A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;\nfloat A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;\nfloat A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;\nfloat A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;\nfloat A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;\nfloat A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;\nfloat A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;\nfloat A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;\ncolonne1 = vec4(A11,A21,A31,A41);\ncolonne2 = vec4(A21,A22,A32,A42);\ncolonne3 = vec4(A31,A32,A33,A43);\ncolonne4 = vec4(A41,A42,A43,A44);\nmat = mat4(colonne1,colonne2,colonne3,colonne4);\nRay ray = primary_ray(i_near,i_far) ;\nvec3 M;\nM = isect_surf(ray, mat);\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nvec4 M1 = vec4(M,1.0);\nvec4 M2 = mat*M1;\nvec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\n#ifdef NEAR_CLIP\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){\nM = isect_surf2(ray, mat);\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )\ndiscard;\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#endif\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\nfloat distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /\ndistance(prime2.xyz,prime1.xyz);\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distance_ratio>0.5 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 nonPerturbedNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const Tv=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),Ev=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class Pv extends Ym{constructor(e,t={}){super("v3",e,t)}get mapping(){return Tv}get mappingIndices(){return Ev}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const Iv=Object.assign({shrink:.14},Zp),kv=Object.assign({shrink:{uniform:!0}},Qp);class Rv extends Pv{constructor(e,t={}){super(e,t),this.parameterTypes=kv,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new zt},modelViewProjectionMatrixInverse:{value:new zt},modelViewMatrixInverseTranspose:{value:new zt},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Iv}}Object.assign({disableImpostor:!1},X_,Iv);const Dv=class{constructor(e,t={}){return!ql||t&&t.disableImpostor?(e.radius=function(e,t){const n=e.length,i=new Float32Array(n);for(let r=0;r<n;r++)i[r]=Math.min(e[r],t[r]);return i}(e.radius,e.radius2),new K_(e,t)):new Rv(e,t)}};class Lv extends Cv{constructor(e,t,n){super(e,t,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=Aa(t.radiusScale,.2),t.radiusType=Aa(t.radiusType,"vdw"),t.useInteriorColor=Aa(t.useInteriorColor,!0),this.shrink=Aa(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new eg(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new Dv(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams()),i=t.sview.getBondData(this.getBondParams()),r={},s={};if(!e||e.position){Object.assign(r,{position:n.position});var o=i.position1,a=i.position2;Object.assign(s,{position:Hc(o,a,this.__center),position1:o,position2:a})}e&&!e.color||(Object.assign(r,{color:n.color}),Object.assign(s,{color:i.color,color2:i.color2})),e&&!e.radius||(Object.assign(r,{radius:n.radius}),Object.assign(s,{radius:i.radius,radius2:i.radius2})),t.bufferList[0].setAttributes(r),t.bufferList[1].setAttributes(s)}}sc.add("hyperball",Lv);class Ov{constructor(e,t={},n=""){this.type=e,this.text=t,this.format=n,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=`${e.index}`;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=`${e.serial}`;break;case"element":t=e.element;break;case"atom":t=`${e.atomname}|${e.index}`;break;case"resname":t=e.resname;break;case"resno":t=`${e.resno}`;break;case"res":t=`${bd[e.resname.toUpperCase()]||e.resname}${e.resno}`;break;case"residue":const n=bd[e.resname.toUpperCase()];t=n&&!e.inscode?`${n}${e.resno}`:`[${e.resname}]${e.resno}${e.inscode}`;break;case"text":t=this.text[e.index];break;case"format":try{t=(0,ya.sprintf)(this.format,e)}catch(e){this.errorLogged||(this.errorLogged=!0,console.log(e.message))}break;default:t=e.qualifiedName()}return void 0===t?"":t}}Ov.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class Nv extends T_{constructor(e,t,n){super(e,t,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:Ov.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(e){const t=e||{};this.labelType=Aa(t.labelType,"res"),this.labelText=Aa(t.labelText,{}),this.labelFormat=Aa(t.labelFormat,""),this.labelGrouping=Aa(t.labelGrouping,"atom"),this.fontFamily=Aa(t.fontFamily,"sans-serif"),this.fontStyle=Aa(t.fontStyle,"normal"),this.fontWeight=Aa(t.fontWeight,"bold"),this.xOffset=Aa(t.xOffset,0),this.yOffset=Aa(t.yOffset,0),this.zOffset=Aa(t.zOffset,.5),this.attachment=Aa(t.attachment,"bottom-left"),this.showBorder=Aa(t.showBorder,!1),this.borderColor=Aa(t.borderColor,"lightgrey"),this.borderWidth=Aa(t.borderWidth,.15),this.showBackground=Aa(t.showBackground,!1),this.backgroundColor=Aa(t.backgroundColor,"lightgrey"),this.backgroundMargin=Aa(t.backgroundMargin,.5),this.backgroundOpacity=Aa(t.backgroundOpacity,1),this.fixedSize=Aa(t.fixedSize,!1),super.init(t)}getTextData(e,t){const n=this.getAtomParams(t),i=new Ov(this.labelType,this.labelText,this.labelFormat);let r,s,o,a,l,c,u;if("atom"===this.labelGrouping){const l=e.getAtomData(n);r=l.position,s=l.radius,o=l.color,t&&!t.text||(a=[],e.eachAtom((e=>a.push(i.atomLabel(e)))))}else if("residue"===this.labelGrouping){t&&!t.position||(l=[]),t&&!t.color||(u=[]),t&&!t.radius||(c=[]),t&&!t.text||(a=[]),n.colorParams&&(n.colorParams.structure=e.getStructure());const h=ic.getScheme(n.colorParams),d=new Cf(n.radiusParams),p=e.getAtomProxy();let f=0;e.eachResidue((e=>{const n=3*f;e.isProtein()||e.isNucleic()?(p.index=e.traceAtomIndex,t&&!t.position||p.positionToArray(l,n)):(p.index=e.atomOffset,t&&!t.position||e.positionToArray(l,n)),t&&!t.color||h.atomColorToArray(p,u,n),t&&!t.radius||(c[f]=d.atomRadius(p)),t&&!t.text||a.push(i.atomLabel(p)),++f})),t&&!t.position||(r=new Float32Array(l)),t&&!t.color||(o=new Float32Array(u)),t&&!t.radius||(s=new Float32Array(c))}return{position:r,size:s,color:o,text:a}}createData(e){return{bufferList:[new U_(this.getTextData(e,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}function Fv(e){const t=e.getAtomSet(),n=e.getBondSet(),i=e.getBondProxy();return n.forEach((function(e){i.index=e,t.clear(i.atomIndex1),t.clear(i.atomIndex2)})),t}sc.add("label",Nv);class Bv extends T_{constructor(e,t,n){super(e,t,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.multipleBond=Aa(t.multipleBond,"off"),this.bondSpacing=Aa(t.bondSpacing,1),this.linewidth=Aa(t.linewidth,2),this.lines=Aa(t.lines,!0),this.crosses=Aa(t.crosses,"lone"),this.crossSize=Aa(t.crossSize,.4),super.init(t)}getAtomRadius(e){return.1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const n={};"lone"===this.crosses&&Object.assign(n,{atomSet:Fv(t)});const i=t.getAtomData(this.getAtomParams(e,n)),r={},s=i.position,o=i.color,a=i.picking,l=(s||o).length,c=3*l;let u=new Float32Array(0),h=new Float32Array(0),d=new Float32Array(0),p=new Float32Array(0),f=0,m=new Float32Array(0);e&&!e.position||(u=r.position1=new Float32Array(c),h=r.position2=new Float32Array(c),f=this.crossSize/2),e&&!e.color||(d=r.color=new Float32Array(c),p=r.color2=new Float32Array(c)),e&&!e.picking||(m=new Float32Array(3*i.picking.array.length));for(let t=0;t<l;t++){const n=3*t,i=3*n;if(!e||e.position){const e=s[n],t=s[n+1],r=s[n+2];u[i]=e-f,u[i+1]=t,u[i+2]=r,h[i]=e+f,h[i+1]=t,h[i+2]=r,u[i+3]=e,u[i+4]=t-f,u[i+5]=r,h[i+3]=e,h[i+4]=t+f,h[i+5]=r,u[i+6]=e,u[i+7]=t,u[i+8]=r-f,h[i+6]=e,h[i+7]=t,h[i+8]=r+f}if(!e||e.color){const e=i+9;for(let t=i;t<e;t+=3)d[t]=p[t]=o[n],d[t+1]=p[t+1]=o[n+1],d[t+2]=p[t+2]=o[n+2]}e&&!e.picking||(m[n]=m[n+1]=m[n+2]=a.array[t])}return e&&!e.picking||(r.picking=new cp(m,a.structure)),r}createData(e){const t={position:!0,color:!0,picking:!0},n=[];if(this.lines){const i=e.getBondData(this.getBondParams(t)),r=new H_(i,this.getBufferParams({linewidth:this.linewidth}));n.push(r)}if("off"!==this.crosses){const i=new H_(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));n.push(i)}return{bufferList:n}}updateData(e,t){let n=0;if(this.lines){const i=t.sview.getBondData(this.getBondParams(e)),r={};e&&!e.position||Object.assign(r,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(r,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(r)}if("off"!==this.crosses){const i=this._crossData(e,t.sview),r={};e&&!e.position||Object.assign(r,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(r,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(r)}}setParameters(e){var t={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}function Uv(e,t,n,i,r){const s=new(i=i||Int32Array)(e*t*n*(r=r||1));function o(e,i,s){return((e*t+i)*n+s)*r}return{data:s,index:o,set:function(e,t,n,...i){const a=o(e,t,n);for(let e=0;e<r;++e)s[a+e]=i[e]},toArray:function(e,t,n,i=[],a=0){const l=o(e,t,n);for(let e=0;e<r;++e)i[a+e]=s[l+e]},fromArray:function(e,t,n,i,a=0){const l=o(e,t,n);for(let e=0;e<r;++e)s[l+e]=i[a+e]},copy:function(e){s.set(e.data)}}}function zv(e,t,n){var i=$p(t),r=uh(e);0===e.length&&(r[0].set([0,0,0]),r[1].set([0,0,0]));var s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b=r[0],x=r[1];function w(e,t,n,r,w){s=t||1.4,o=n||2,g=w||!0;var S=0;for(var M in i)S=Math.max(S,M);var C=Gp(b,x,S,o,e?s:0);l=C.dim[0],c=C.dim[1],u=C.dim[2],h=C.matrix,d=C.tran,o=C.scaleFactor,p={},f={},A(e),m=s*o,a=r||s/o,_=new Uint8Array(l*c*u),e&&(v=new Float64Array(l*c*u)),g&&(y=new Int32Array(l*c*u))}var S=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function A(e){var t,n,r,a,l,c,u,h,d,m;for(var g in i)if(t=parseFloat(g),!p[g]){for(c=(u=e?(t+s)*o+.5:t*o+.5)*u,h=Math.floor(u)+1,d=new Int32Array(h*h),m=0,n=0;n<h;++n)for(r=0;r<h;++r)(a=n*n+r*r)>c?d[m]=-1:(l=Math.sqrt(c-a),d[m]=Math.floor(l)),++m;f[g]=h,p[g]=d}}function M(n){var i,r,s,a,h,m,v,b,x,w,S,A,M,C,T,E,P,I,k=3*n,R=n;i=Math.floor(.5+o*(e[k]+d[0])),r=Math.floor(.5+o*(e[k+1]+d[1])),s=Math.floor(.5+o*(e[k+2]+d[2]));var D,L=t[R],O=p[L],N=0,F=c*u,B=f[L];for(w=0;w<B;++w)for(S=0;S<B;++S){if(-1!==(D=O[N]))for(E=-1;E<2;++E)for(P=-1;P<2;++P)for(I=-1;I<2;++I)if(0!==E&&0!==P&&0!==I)for(v=E*w,x=I*S,A=0;A<=D;++A)if(C=r+(b=A*P),T=s+x,!((M=i+v)<0||C<0||T<0||M>=l||C>=c||T>=u)){var U=M*F+C*u+T;if(g)if(1&_[U]){if(1&_[U]){var z=y[U];z!==k&&v*v+b*b+x*x<(a=i+v-Math.floor(.5+o*(e[z]+d[0])))*a+(h=r+b-Math.floor(.5+o*(e[z+1]+d[1])))*h+(m=s+x-Math.floor(.5+o*(e[z+2]+d[2])))*m&&(y[U]=n)}}else _[U]|=1,y[U]=n;else _[U]|=1}N++}}function C(n){var i,r,s,a,h,m,v,b,x,w,S,A,M,C,T,E,P,I,k,R=3*n,D=n,L=0;i=Math.floor(.5+o*(e[R]+d[0])),r=Math.floor(.5+o*(e[R+1]+d[1])),s=Math.floor(.5+o*(e[R+2]+d[2]));var O=t[D],N=c*u;for(M=0,k=f[O];M<k;++M)for(C=0;C<k;++C){if(-1!==p[O][L])for(E=-1;E<2;++E)for(P=-1;P<2;++P)for(I=-1;I<2;++I)if(0!==E&&0!==P&&0!==I)for(v=E*M,x=I*C,T=0;T<=p[O][L];++T)if(S=r+(b=T*P),A=s+x,!((w=i+v)<0||S<0||A<0||w>=l||S>=c||A>=u)){var F=w*N+S*u+A;if(2&_[F]){if(g){var B=y[F];v*v+b*b+x*x<(a=Math.floor(.5+o*(e[B]+d[0])))*a+(h=Math.floor(.5+o*(e[B+1]+d[1])))*h+(m=Math.floor(.5+o*(e[B+2]+d[2])))*m&&(y[F]=n)}}else _[F]|=2,g&&(y[F]=n)}L++}}function T(){var e,t,n,i;console.time("EDTSurface fastdistancemap");var r,s=Uv(l,c,u,Uint16Array,3),o=c*u,h=m*m,d=0;for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)_[r=e*o+t*u+n]&=-3,1&_[r]&&4&_[r]&&(s.set(e,t,n,e,t,n),v[r]=0,_[r]|=2,d+=1);var p=new Int32Array(3*d),f=0,b=new Int32Array(3*d),x=0;for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)4&_[r=e*o+t*u+n]&&(p[f]=e,p[f+1]=t,p[f+2]=n,f+=3,_[r]&=-5);do{for(x=E(p,s,f,b),f=0,e=0,i=x;e<i;e+=3)r=o*b[e]+u*b[e+1]+b[e+2],_[r]&=-5,v[r]<=1.0404*h&&(p[f]=b[e],p[f+1]=b[e+1],p[f+2]=b[e+2],f+=3)}while(f>0);var w,S=a*a,A=new Uint16Array(3);for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)_[r=e*o+t*u+n]&=-5,1&_[r]&&(2&_[r]&&!(2&_[r]&&v[r]>=S)||(_[r]|=4,g&&2&_[r]&&(s.toArray(e,t,n,A),w=A[0]*o+A[1]*u+A[2],y[r]=y[w])));console.timeEnd("EDTSurface fastdistancemap")}function E(e,t,n,i){var r,s,o,a,h,d,p,f,m,g,y,b,x=new Uint16Array(3),w=0;if(0===n)return w;var A=-1,M=-1,C=-1,T=c*u;for(p=0,m=n;p<m;p+=3)for(r=e[p],s=e[p+1],o=e[p+2],t.toArray(r,s,o,x),f=0;f<6;++f)A=r+(b=S[f])[0],M=s+b[1],C=o+b[2],A<l&&A>-1&&M<c&&M>-1&&C<u&&C>-1&&(1&_[y=A*T+u*M+C]&&!(2&_[y])?(t.fromArray(A,M,C,x),g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d,v[y]=g,_[y]|=2,_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3):1&_[y]&&2&_[y]&&(g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d)<v[y]&&(t.fromArray(A,M,C,x),v[y]=g,4&_[y]||(_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3)));for(p=0,m=n;p<m;p+=3)for(r=e[p],s=e[p+1],o=e[p+2],t.toArray(r,s,o,x),f=6;f<18;f++)A=r+(b=S[f])[0],M=s+b[1],C=o+b[2],A<l&&A>-1&&M<c&&M>-1&&C<u&&C>-1&&(1&_[y=A*T+u*M+C]&&!(2&_[y])?(t.fromArray(A,M,C,x),g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d,v[y]=g,_[y]|=2,_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3):1&_[y]&&2&_[y]&&(g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d)<v[y]&&(t.fromArray(A,M,C,x),v[y]=g,4&_[y]||(_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3)));for(p=0,m=n;p<m;p+=3)for(r=e[p],s=e[p+1],o=e[p+2],t.toArray(r,s,o,x),f=18;f<26;f++)A=r+(b=S[f])[0],M=s+b[1],C=o+b[2],A<l&&A>-1&&M<c&&M>-1&&C<u&&C>-1&&(1&_[y=A*T+u*M+C]&&!(2&_[y])?(t.fromArray(A,M,C,x),g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d,v[y]=g,_[y]|=2,_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3):1&_[y]&&2&_[y]&&(g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d)<v[y]&&(t.fromArray(A,M,C,x),v[y]=g,4&_[y]||(_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3)));return w}this.getVolume=function(t,i,r,s,o){console.time("EDTSurface.getVolume");var a="vws"!==t;w(a,i,r,s,o),function(t){var n,i;for(console.time("EDTSurface fillvoxels"),n=0,i=_.length;n<i;++n)_[n]=0,t&&(v[n]=-1),g&&(y[n]=-1);for(n=0,i=e.length/3;n<i;++n)M(n);for(n=0,i=_.length;n<i;++n)1&_[n]&&(_[n]|=2);console.timeEnd("EDTSurface fillvoxels")}(a),function(){var e,t,n,i=c*u;for(e=0;e<l;++e)for(t=0;t<u;++t)for(n=0;n<c;++n){var r=e*i+n*u+t;if(1&_[r])for(var s=0;s<26;){var o=e+S[s][0],a=t+S[s][2],h=n+S[s][1];if(o>-1&&o<l&&h>-1&&h<c&&a>-1&&a<u&&!(1&_[o*i+h*u+a])){_[r]|=4;break}s++}}}(),"ms"!==t&&"ses"!==t||T(),"ses"===t&&(A(!1),function(){var t,n;for(t=0,n=_.length;t<n;++t)_[t]&=-3;for(t=0,n=e.length/3;t<n;++t)C(t)}()),function(e){var t,n=_.length;if("vws"===e)for(t=0;t<n;++t)_[t]&=-5,_[t]=2&_[t]?1:0;else if("ms"===e)for(t=0;t<n;++t)_[t]&=-3,4&_[t]&&(_[t]|=2),_[t]&=-5,_[t]=2&_[t]?1:0;else if("ses"===e)for(t=0;t<n;++t)4&_[t]&&2&_[t]?_[t]&=-5:4&_[t]&&!(2&_[t])&&(_[t]|=2),_[t]=2&_[t]?1:0;else if("sas"===e)for(t=0;t<n;++t)_[t]&=-5,_[t]=2&_[t]?1:0}(t);for(var h=0,d=y.length;h<d;++h)y[h]=n[y[h]];return console.timeEnd("EDTSurface.getVolume"),{data:_,nx:u,ny:c,nz:l,atomindex:y}},this.getSurface=function(e,t,n,i,r,s,o){var a=this.getVolume(e,t,n,i,r);return new Wp(a.data,a.nx,a.ny,a.nz,a.atomindex).getSurface(1,s,void 0,h,o)}}function Vv(e,t,n,i,r,s,o){o=Math.max(.1,o);var a=e.length,l=r[0],c=r[1],u=r[2],h=s[0],d=s[1],p=s[2];function f(e,t){return Math.floor((e-t)/o)}for(var m,g,_,v=f(h,l)+1,y=f(d,c)+1,b=f(p,u)+1,x=v*y*b,w=y*b,S=[],A=0;A<a;A++){var M=(m=e[A],g=t[A],_=n[A],(f(m,l)*y+f(g,c))*b+f(_,u));void 0===S[M]?S[M]=[A]:S[M].push(A)}var C=new Uint32Array(x),T=new Uint16Array(x),E=new Uint32Array(a),P=0,I=0;for(A=0;A<x;A++){var k=C[A]=P,R=S[A];if(void 0!==R)for(var D=0;D<R.length;D++)E[P]=R[D],P++;var L=P-k;T[A]=L,L>I&&(I=L)}return{neighbourListLength:27*I+1,withinRadii:function(r,s,o,a,h){for(var d=0,p=f(r,l),m=f(s,c),g=f(o,u),_=Math.max(0,p-1),x=Math.max(0,m-1),S=Math.max(0,g-1),A=Math.min(v,p+2),M=Math.min(y,m+2),P=Math.min(b,g+2),I=_;I<A;++I)for(var k=I*w,R=x;R<M;++R)for(var D=R*b,L=S;L<P;++L)for(var O=k+D+L,N=C[O],F=N+T[O],B=N;B<F;B++){var U=E[B],z=e[U]-r,V=t[U]-s,H=n[U]-o,$=i[U]+a;z*z+V*V+H*H<=$*$&&(h[d++]=E[B])}h[d]=-1}}}function Hv(e,t,n){const i=t.length,r=new Float32Array(i),s=new Float32Array(i),o=new Float32Array(i);for(let t=0;t<i;t++){const n=3*t;r[t]=e[n],s[t]=e[n+1],o[t]=e[n+2]}let a=uh(e);0===e.length&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],c=a[1];let u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C,T,E=-1;const P=new Float32Array([0,0,0]),I=new Float32Array([0,0,0]),k=new Float32Array([0,0,0]),R=new Float32Array([0,0,0]);let D;function L(e,n,a,P){p=Aa(e,1.4),f=Aa(n,2),m=Aa(a,!0),g=Aa(P,30),u=new Float32Array(i),h=new Float32Array(i);for(let e=0;e<u.length;++e){var I=t[e]+p;u[e]=I,h[e]=I*I}d=0;for(let e=0;e<u.length;++e)u[e]>d&&(d=u[e]);!function(){const e=Gp(l,c,d,f,0);f=e.scaleFactor,_=e.dim,v=e.matrix,D=Math.max(5,2+Math.floor(p*f)),y=Gc(_[0]*_[1]*_[2],-1001),b=new Int32Array(y.length),x=new Float32Array(_[0]),w=new Float32Array(_[1]),S=new Float32Array(_[2]),O(x,l[0],1/f),O(w,l[1],1/f),O(S,l[2],1/f)}(),function(){var e=0,t=2*Math.PI/g;M=new Float32Array(g),A=new Float32Array(g);for(var n=0;n<g;n++)M[n]=Math.cos(e),A[n]=Math.sin(e),e+=t}(),C=Vv(r,s,o,u,l,c,2.01*d),T=new Int32Array(C.neighbourListLength),E=-1}function O(e,t,n){for(let i=0;i<e.length;i++)e[i]=t+n*i}function N(e,t,n,i,r){let s;if(-1!==E){if(s=E,s!==i&&s!==r&&F(s,e,t,n))return s;E=-1}var o=0;for(s=T[o];s>=0;){if(s!==i&&s!==r&&F(s,e,t,n))return E=s,s;s=T[++o]}return E=-1,-1}function F(t,n,i,r){var s=3*t,o=h[t],a=e[s]-n,l=e[s+1]-i,c=e[s+2]-r;return a*a+l*l+c*c<o}function B(e,t){var n=u[e],i=u[t],a=P[0]=r[t]-r[e],c=P[1]=s[t]-s[e],h=P[2]=o[t]-o[e],d=a*a+c*c+h*h,p=Math.sqrt(d),v=n*((n*n+p*p-i*i)/(2*n*p));Mh(P,P),function(e,t){e[0]=e[1]=e[2]=1,0!==t[0]?e[0]=(t[1]+t[2])/-t[0]:0!==t[1]?e[1]=(t[0]+t[2])/-t[1]:0!==t[2]&&(e[2]=(t[0]+t[1])/-t[2])}(k,P),Mh(k,k),mh(R,P,k),Mh(R,R);var C=Math.sqrt(n*n-v*v);Ah(k,k,C),Ah(R,R,C),Ah(P,P,v),I[0]=P[0]+r[e],I[1]=P[1]+s[e],I[2]=P[2]+o[e],E=-1;for(var T=D,L=0;L<g;L++){var O=M[L],F=A[L],B=I[0]+O*k[0]+F*R[0],U=I[1]+O*k[1]+F*R[1],z=I[2]+O*k[2]+F*R[2];if(-1===N(B,U,z,e,t))for(var V=Math.floor(f*(B-l[0])),H=Math.floor(f*(U-l[1])),$=Math.floor(f*(z-l[2])),G=Math.max(0,V-T),j=Math.max(0,H-T),W=Math.max(0,$-T),q=Math.min(_[0],V+T+2),X=Math.min(_[1],H+T+2),Y=Math.min(_[2],$+T+2),K=G;K<q;K++){a=B-x[K];for(var Z=_[1]*_[2]*K,Q=j;Q<X;Q++)for(var J=a*a+(c=U-w[Q])*c,ee=Z+_[2]*Q,te=W;te<Y;te++){d=J+(h=z-S[te])*h;var ne=te+ee,ie=y[ne];if(ie>0&&d<ie*ie&&(y[ne]=Math.sqrt(d),m)){const n=a*P[0]+c*P[1]+h*P[2];b[ne]=n<0?t:e}}}}}function U(e,t,a){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),L(e,t,a),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),function(){for(var e=0;e<i;e++){var t=r[e],n=s[e],a=o[e],c=u[e],d=h[e];C.withinRadii(t,n,a,c,T);for(var p=Math.ceil(c*f),g=Math.floor(f*(t-l[0])),v=Math.floor(f*(n-l[1])),A=Math.floor(f*(a-l[2])),M=Math.max(0,g-p),E=Math.max(0,v-p),P=Math.max(0,A-p),I=Math.min(_[0],g+p+2),k=Math.min(_[1],v+p+2),R=Math.min(_[2],A+p+2),D=M;D<I;D++)for(var L=x[D]-t,O=_[1]*_[2]*D,F=E;F<k;F++)for(var B=w[F]-n,U=L*L+B*B,z=O+_[2]*F,V=P;V<R;V++){var H=S[V]-a,$=U+H*H;if($<d){var G=V+z;y[G]<0&&(y[G]=-y[G]);var j=Math.sqrt($),W=c/j,q=L*W,X=B*W,Y=H*W;if(-1===N(q+=t,X+=n,Y+=a,e,-1)){var K=c-j;K<y[G]&&(y[G]=K,m&&(b[G]=e))}}}}}(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),function(){for(var e=0;e<i;e++){C.withinRadii(r[e],s[e],o[e],u[e],T);for(var t=0,n=T[t];n>=0;)e<n&&B(e,n),n=T[++t]}}(),console.timeEnd("AVSurface.projectTorii"),function(){for(var e=0;e<y.length;e++)y[e]<0&&(y[e]=0)}(),function(){for(var e=0;e<b.length;e++)b[e]=n[b[e]]}(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(e,t,n,i,r,s,o){return U(t,n,r),new Wp(y,_[2],_[1],_[0],b).getSurface(t,!1,void 0,v,o)}}sc.add("line",Bv),Object.assign(zv,{__deps:[Gp,$p,Wp,uh,Uv]}),Object.assign(Hv,{__deps:[Gp,Wp,Gc,uh,Ah,mh,Mh,Vv,Aa]}),nc.add("molsurf",(function(e,t){const n=e.data.args,i=e.data.params;if(n&&i){const e=new("av"===i.type?Hv:zv)(n.coordList,n.radiusList,n.indexList).getSurface(i.type,i.probeRadius,i.scaleFactor,i.cutoff,!0,i.smooth,i.contour),r=[e.position.buffer,e.index.buffer];e.normal&&r.push(e.normal.buffer),e.atomindex&&r.push(e.atomindex.buffer),t({sd:e,p:i},r)}}),[zv,Hv]);class $v{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:Aa(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var n=new jp(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n}getSurface(e){const t=e||{},n=this._getAtomData(e),i=n.position,r=n.radius,s=n.index,o=new("av"===t.type?Hv:zv)(i,r,s).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(o,t)}getSurfaceWorker(e,t){const n=Object.assign({},e);if(window.hasOwnProperty("Worker")){void 0===this.worker&&(this.worker=new oh("molsurf"));const i=this._getAtomData(e),r=i.position,s=i.radius,o=i.index,a={args:{coordList:r,radiusList:s,indexList:o},params:n},l=[r.buffer,s.buffer,o.buffer];this.worker.post(a,l,(e=>{t(this._makeSurface(e.data.sd,n))}),(e=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",e),this.worker.terminate(),this.worker=void 0;const i=this.getSurface(n);t(i)}))}else{const e=this.getSurface(n);t(e)}}dispose(){this.worker&&this.worker.terminate()}}class Gv extends T_{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add((()=>{this.__forceNewMolsurf=!0})),this.toBePrepared=!0,this.init(n)}init(e){const t=e||{};t.colorScheme=Aa(t.colorScheme,"uniform"),t.colorValue=Aa(t.colorValue,14540253),t.disablePicking=Aa(t.disablePicking,!0),this.surfaceType=Aa(t.surfaceType,"ms"),this.probeRadius=Aa(t.probeRadius,1.4),this.smooth=Aa(t.smooth,2),this.scaleFactor=Aa(t.scaleFactor,2),this.cutoff=Aa(t.cutoff,0),this.contour=Aa(t.contour,!1),this.background=Aa(t.background,!1),this.opaqueBack=Aa(t.opaqueBack,!0),this.filterSele=Aa(t.filterSele,""),this.colorVolume=Aa(t.colorVolume,void 0),this.useWorker=Aa(t.useWorker,!0),super.init(e)}prepareData(e,t,n){let i=this.__infoList[t];if(i||(i={},this.__infoList[t]=i),i.molsurf&&i.sele===e.selection.string)n(t);else{if(this.filterSele){const i=e.structure.getView(new Ll(this.filterSele)),r=i.boundingBox.getSize(new ut),s=Math.max(r.x,r.y,r.z),o=e.getAtomSetWithinPoint(i.center,s/2+6);if(0===(e=e.getView(new Ll(e.getAtomSetWithinSelection(o,3).toSeleString()))).atomCount)return void n(t)}i.sele=e.selection.string,i.molsurf=new $v(e);const r=this.getSurfaceParams(),s=e=>{i.surface=e,n(t)};this.useWorker?i.molsurf.getSurfaceWorker(r,s):s(i.molsurf.getSurface(r))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0),0===this.structureView.atomCount)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},n="default"===this.assembly?this.defaultAssembly:this.assembly,i=this.structure.biomolDict[n];i?i.partList.forEach(((e,n)=>{const r=e.getView(this.structureView);this.prepareData(r,n,(e=>{e===i.partList.length-1&&t()}))})):this.prepareData(this.structureView,0,t)}createData(e,t){const n=this.__infoList[t],i=n.surface;if(!i)return;const r={position:i.getPosition(),color:i.getColor(this.getColorParams()),index:i.getFilteredIndex(this.filterSele,e)},s=[];if(i.contour){const e=new of(r,this.getBufferParams({wireframe:!1}));s.push(e)}else{Object.assign(r,{normal:i.getNormal(),picking:i.getPicking(e.getStructure())});const t=new tf(r,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if("double"==this.getBufferParams().side){const e=new sf(t);s.push(e)}else s.push(t)}return{bufferList:s,info:n}}updateData(e,t){const n={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(n.color=t.info.surface.getColor(this.getColorParams())),e.index&&(n.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(n)}setParameters(e,t={},n){return e&&e.filterSele&&(t.index=!0),e&&void 0!==e.colorVolume&&(t.color=!0),e&&e.wireframe&&(e.contour||void 0===e.contour&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),this}getSurfaceParams(e={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0,super.dispose()}}sc.add("surface",Gv);class jv extends T_{constructor(e,t,n){super(e,t,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.pointSize=Aa(t.pointSize,1),this.sizeAttenuation=Aa(t.sizeAttenuation,!0),this.sortParticles=Aa(t.sortParticles,!1),this.useTexture=Aa(t.useTexture,!1),this.alphaTest=Aa(t.alphaTest,.5),this.forceTransparent=Aa(t.forceTransparent,!1),this.edgeBleach=Aa(t.edgeBleach,0),super.init(t)}createData(e){var t=e.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new rg(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),t.bufferList[0].setAttributes(i)}getAtomRadius(){return.1}}sc.add("point",jv),ac.add("shader/Ribbon.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nattribute vec3 dir;\nattribute float size;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\ntransformed += normalize( dir ) * size;\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}");const Wv=new Uint16Array([0,1,2,1,3,2]);function qv(e){return 4*(e.position.length/3-1)*3}class Xv extends ef{constructor(e,t={}){super({position:new Float32Array(qv(e)),color:new Float32Array(qv(e)),index:Ba(qv(e),qv(e)/3),normal:new Float32Array(qv(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const n=e.position.length/3-1,i=4*n,r=3*i;this.addAttributes({dir:{type:"v3",value:new Float32Array(r)}}),this.addAttributes({size:{type:"f",value:new Float32Array(i)}}),e.primitiveId=Wc(n),this.setAttributes(e),this.makeIndex()}setAttributes(e={}){const t=this.size/4,n=this.geometry.attributes;let i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x;e.position&&(i=e.position,c=n.position.array,n.position.needsUpdate=!0),e.normal&&(r=e.normal,u=n.normal.array,n.normal.needsUpdate=!0),e.size&&(s=e.size,h=n.size.array,n.size.needsUpdate=!0),e.dir&&(o=e.dir,d=n.dir.array,n.dir.needsUpdate=!0),e.color&&(a=e.color,p=n.color.array,n.color.needsUpdate=!0),e.primitiveId&&(l=e.primitiveId,f=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let w=s?s[0]:null;for(m=0;m<t;++m){for(b=3*m,_=3*m*4,y=4*m,i&&(c[_]=c[_+3]=i[b],c[_+1]=c[_+4]=i[b+1],c[_+2]=c[_+5]=i[b+2],c[_+6]=c[_+9]=i[b+3],c[_+7]=c[_+10]=i[b+4],c[_+8]=c[_+11]=i[b+5]),r&&(u[_]=u[_+3]=-r[b],u[_+1]=u[_+4]=-r[b+1],u[_+2]=u[_+5]=-r[b+2],u[_+6]=u[_+9]=-r[b+3],u[_+7]=u[_+10]=-r[b+4],u[_+8]=u[_+11]=-r[b+5]),g=0;g<4;++g)v=_+3*g,a&&(p[v]=a[b],p[v+1]=a[b+1],p[v+2]=a[b+2]),l&&(f[y+g]=l[m]);s&&(x=s[m],w!==s[m]?(h[y]=w,h[y+1]=w,h[y+2]=x,h[y+3]=x):(h[y]=x,h[y+1]=x,h[y+2]=x,h[y+3]=x),w=x),o&&(d[_]=o[b],d[_+1]=o[b+1],d[_+2]=o[b+2],d[_+3]=-o[b],d[_+4]=-o[b+1],d[_+5]=-o[b+2],d[_+6]=o[b+3],d[_+7]=o[b+4],d[_+8]=o[b+5],d[_+9]=-o[b+3],d[_+10]=-o[b+4],d[_+11]=-o[b+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void Yl.error("Index is null");const t=e.array,n=t.length/4/3;for(let e=0;e<n;++e){const n=6*e,i=4*e;t.set(Wv,n);for(let e=0;e<6;++e)t[n+e]+=i}}}class Yv extends T_{constructor(e,t,n){super(e,t,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=Aa(t.colorScheme,"chainname"),t.colorScale=Aa(t.colorScale,"RdYlBu"),t.radiusType=Aa(t.radiusType,"sstruc"),t.radiusScale=Aa(t.radiusScale,4),"low"===t.quality?this.subdiv=3:"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=Aa(t.subdiv,6),this.tension=Aa(t.tension,NaN),this.smoothSheet=Aa(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],n=[];return this.structure.eachPolymer((e=>{if(!(e.residueCount<4)){n.push(e);var i=new cv(e,this.getSplineParams()),r=i.getSubdividedPosition(),s=i.getSubdividedOrientation(),o=i.getSubdividedColor(this.getColorParams()),a=i.getSubdividedPicking(),l=i.getSubdividedSize(this.getRadiusParams());t.push(new Xv({position:r.position,normal:s.binormal,dir:s.normal,color:o.color,size:l.size,picking:a.picking},this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var r={},s=new cv(t.polymerList[n],this.getSplineParams());if(e.position){var o=s.getSubdividedPosition(),a=s.getSubdividedOrientation();Object.assign(r,{position:o.position,normal:a.binormal,dir:a.normal})}if(e.radius||e.scale){var l=s.getSubdividedSize(this.getRadiusParams());Object.assign(r,{size:l.size})}if(e.color){var c=s.getSubdividedColor(this.getColorParams());Object.assign(r,{color:c.color})}t.bufferList[n].setAttributes(r)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}sc.add("ribbon",Yv);class Kv extends T_{constructor(e,t,n){super(e,t,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){let t=e||{};t.colorScheme=Aa(t.colorScheme,"sstruc"),t.radiusSize=Aa(t.radiusSize,1.5),t.radiusScale=Aa(t.radiusScale,1),t.openEnded=Aa(t.openEnded,!1),t.useInteriorColor=Aa(t.useInteriorColor,!0),this.localAngle=Aa(t.localAngle,30),this.centerDist=Aa(t.centerDist,2.5),this.ssBorder=Aa(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const n=[],i=[];this.structure.eachPolymer((e=>{if(e.residueCount<4||e.isNucleic())return;const r=new Bf(e),s=r.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=s.size.length,n.push(s),i.push(r)}),e.getSelection());const r={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let s=new Float32Array(t),o=0;return n.forEach((function(e){r.begin.set(e.begin,3*o),r.end.set(e.end,3*o),r.size.set(e.size,o),r.color.set(e.color,3*o),s.set(e.picking.array,o),o+=e.size.length})),t&&(r.picking=new cp(s,e.getStructure())),{bufferList:[new iv({position1:r.begin,position2:r.end,color:r.color,color2:r.color,radius:r.size,picking:r.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:i,axisData:r}}updateData(e,t){if((e=e||{}).position)this.build();else{var n={};if(e.color||e.radius){var i=0;t.helixbundleList.forEach((n=>{var r=n.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(r.color,3*i),(e.radius||e.scale)&&t.axisData.size.set(r.size,i),i+=r.size.length})),e.color&&Object.assign(n,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(n,{radius:t.axisData.size})}t.bufferList[0].setAttributes(n)}}}sc.add("rocket",Kv);class Zv extends fv{constructor(e,t,n){super(e,t,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=Aa(t.tension,.5),t.radiusScale=Aa(t.radiusScale,5),t.smoothSheet=!1,this.smooth=Aa(t.smooth,2),super.init(t)}getSpline(e){var t=new Ff(e);return new cv(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}sc.add("rope",Zv);class Qv extends T_{constructor(e,t,n){super(e,t,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.useInteriorColor=Aa(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new eg(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i)}}function Jv(e){return 3*(e.position.length/3-1)*2}sc.add("spacefill",Qv);class ey extends Jp{constructor(e,t={}){super({position:new Float32Array(Jv(e)),color:new Float32Array(Jv(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,n,i,r;const s=this.geometry.attributes;if(e.position&&(t=e.position,i=s.position.array,s.position.needsUpdate=!0),e.color&&(n=e.color,r=s.color.array,s.color.needsUpdate=!0),!t&&!n)return void Yl.warn("TraceBuffer.prototype.setAttributes no data");let o,a;const l=this.size-1;for(let e=0;e<l;++e)o=3*e,a=3*e*2,t&&(i[a]=t[o],i[a+1]=t[o+1],i[a+2]=t[o+2],i[a+3]=t[o+3],i[a+4]=t[o+4],i[a+5]=t[o+5]),n&&(r[a]=n[o],r[a+1]=n[o+1],r[a+2]=n[o+2],r[a+3]=n[o+3],r[a+4]=n[o+4],r[a+5]=n[o+5])}}class ty extends T_{constructor(e,t,n){super(e,t,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=Aa(t.colorScheme,"chainname"),t.colorScale=Aa(t.colorScale,"RdYlBu"),"low"===t.quality?this.subdiv=3:"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=Aa(t.subdiv,6),this.tension=Aa(t.tension,NaN),this.smoothSheet=Aa(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],n=[];return this.structure.eachPolymer((e=>{if(!(e.residueCount<4)){n.push(e);var i=new cv(e,this.getSplineParams()),r=i.getSubdividedPosition(),s=i.getSubdividedColor(this.getColorParams());t.push(new ey(Object.assign({},r,s),this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var r={},s=new cv(t.polymerList[n],this.getSplineParams());if(e.position){var o=s.getSubdividedPosition();Object.assign(r,{position:o.position})}if(e.color){var a=s.getSubdividedColor(this.getColorParams());Object.assign(r,{color:a.color})}t.bufferList[n].setAttributes(r)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}sc.add("trace",ty);class ny extends fv{constructor(e,t,n){super(e,t,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=Aa(t.radiusScale,2),"low"===t.quality&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}sc.add("tube",ny);class iy extends T_{constructor(e,t,n){super(e,t,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=Aa(t.radiusSize,n),t.colorValue=Aa(t.colorValue,"orange"),t.useInteriorColor=Aa(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new eg(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new iv(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=t.sview.getStructure();if(!n.unitcell)return;const i=this.getUnitcellData(n),r={},s={};e&&!e.position||(Object.assign(r,{position:i.vertex.position}),Object.assign(s,{position1:i.edge.position1,position2:i.edge.position2})),e&&!e.color||(Object.assign(r,{color:i.vertex.color}),Object.assign(s,{color:i.edge.color,color2:i.edge.color2})),e&&!e.radius||(Object.assign(r,{radius:i.vertex.radius}),Object.assign(s,{radius:i.edge.radius})),this.sphereBuffer.setAttributes(r),this.cylinderBuffer.setAttributes(s)}}sc.add("unitcell",iy);class ry extends T_{constructor(e,t,n){super(e,t,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(e){const t=e||{};t.colorValue=Aa(t.colorValue,"#f0027f"),t.useInteriorColor=Aa(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new iv(t,this.getBufferParams({openEnded:!1}))]}}}sc.add("validation",ry);const sy=new ut,oy=new ut,ay=new ut,ly=new ut(0,1,0),cy=Object.assign({radialSegments:60,openEnded:!1},Zp);class uy extends jm{constructor(e,t={}){super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,function(e={}){const t=new Oo(1,1,Aa(e.radialSegments,60),1,Aa(e.openEnded,!1));return t.applyMatrix4((new zt).makeRotationX(-Math.PI/2)),t}(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return cy}applyPositionTransform(e,t,n){oy.fromArray(this._position1,n),ay.fromArray(this._position2,n),e.lookAt(oy,ay,ly);const i=this._radius[t];sy.set(i,i,oy.distanceTo(ay)),e.scale(sy)}setAttributes(e={},t){e.position1&&e.position2&&(Hc(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}uc.add("cone",uy);class hy{constructor(e=[]){this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new pt,this.geometryList.forEach((e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)}))}}const dy=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},Zp);class py{constructor(e,t={}){this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.visible=!0,this.parameters=Ma(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const n=this.makeAttributes(e),i={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new iv(n.cylinder,i),this.coneBuffer=new uy(n.cone,i),this.geometry=new hy([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=Aa(t.matrix,new zt),this.picking=e.picking}get defaultParameters(){return dy}set matrix(e){Jp.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(e={}){const t=this.splitPosition,n=this.cylinderRadius,i=this.parameters.aspectRatio;let r,s;const o={},a={};if(e.radius){for(r=0,s=n.length;r<s;++r)n[r]=e.radius[r]/i;o.radius=n,a.radius=e.radius}if(e.position1&&e.position2){const l=new ut,c=new ut,u=new ut,h=new ut;for(r=0,s=t.length;r<s;r+=3){l.fromArray(e.position1,r),c.fromArray(e.position2,r),u.subVectors(l,c);const s=u.length(),o=n[r/3]*i*2,a=Math.min(s,o);u.setLength(a),h.copy(c).add(u),h.toArray(t,r)}o.position1=e.position1,o.position2=t,a.position1=t,a.position2=e.position2}return e.color&&(o.color=e.color,o.color2=e.color,a.color=e.color),{cylinder:o,cone:a}}getMesh(){return(new ro).add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return(new ro).add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return(new ro).add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(e={}){const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(e={}){(e=Object.assign({},e))&&void 0!==e.matrix&&(this.matrix=e.matrix),delete e.matrix,e&&void 0!==e.wireframe&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){Jp.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}uc.add("arrow",py);const fy=new ut,my=new ut,gy=new ut,_y=new ut(0,0,0);class vy extends jm{constructor(e,t={}){super(e,t,new pi(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){my.fromArray(this._heightAxis,n),gy.fromArray(this._depthAxis,n),e.lookAt(_y,my,gy),fy.set(this._size[t],gy.length(),my.length()),e.scale(fy)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}uc.add("box",vy);const yy=new ut,by=new ut,xy=new ut,wy=new ut(0,0,0),Sy=Object.assign({sphereDetail:2},Zp);class Ay extends jm{constructor(e,t={}){super(e,t,new Fo(1,Aa(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return Sy}applyPositionTransform(e,t,n){by.fromArray(this._majorAxis,n),xy.fromArray(this._minorAxis,n),e.lookAt(wy,by,xy),yy.set(this._radius[t],xy.length(),by.length()),e.scale(yy)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}uc.add("ellipsoid",Ay);const My=new ut,Cy=new ut,Ty=new ut,Ey=new ut(0,0,0);class Py extends jm{constructor(e,t={}){super(e,t,new Bo(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){Cy.fromArray(this._heightAxis,n),Ty.fromArray(this._depthAxis,n),e.lookAt(Ey,Cy,Ty),My.set(this._size[t],Ty.length(),Cy.length()),e.scale(My)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}uc.add("octahedron",Py);const Iy=new ut,ky=new ut,Ry=new ut,Dy=new ut(0,0,0);class Ly extends jm{constructor(e,t={}){super(e,t,new Uo(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){ky.fromArray(this._heightAxis,n),Ry.fromArray(this._depthAxis,n),e.lookAt(Dy,ky,Ry),Iy.set(this._size[t],Ry.length(),ky.length()),e.scale(Iy)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}uc.add("tetrahedron",Ly);const Oy=new ut,Ny=new ut,Fy=new ut,By=new ut(0,0,0),Uy=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},Zp);class zy extends jm{constructor(e,t={}){super(e,t,new zo(1,Aa(t.radiusRatio,.2),Aa(t.radialSegments,16),Aa(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return Uy}applyPositionTransform(e,t,n){Ny.fromArray(this._majorAxis,n),Fy.fromArray(this._minorAxis,n),e.lookAt(By,Ny,Fy);const i=this._radius[t];Oy.set(i,i,i),e.scale(Oy)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}function Vy(e,t){return{start:t&&void 0!==t.start?Math.max(Math.min(t.start,e-1),0):0,end:t&&void 0!==t.end?Math.min(t.end,e):e}}function Hy(e,t){const n=t&&void 0!==t.array?t.array:Array,{start:i,end:r}=Vy(e,t);return{array:new n(r-i),start:i,end:r}}function $y(e,t,n){const{array:i,start:r}=Hy(e,n);return function(e,t,n){for(let i=0,r=t.length;i<r;i++)t[i]=e(n+i);return t}(t,i,r)}function Gy(e){return!!e.buffer&&"number"==typeof e.byteLength&&"number"==typeof e.BYTES_PER_ELEMENT}function jy(e,t){const{constructor:n,buffer:i,length:r,byteOffset:s,BYTES_PER_ELEMENT:o}=e,{start:a,end:l}=Vy(r,t);return 0===a&&l===r?e:new n(i,s+o*a,Math.min(r,l-a))}uc.add("torus",zy);const Wy=1e-6;function qy(e,t,n){return Math.abs(e-t)<=n}function Xy(e,t,n){return Math.max(t,Math.min(n,e))}function Yy(e,t,n,i,r,s){const o=(n-e)*s,a=(i-t)*s,l=r*r;return(2*t-2*n+o+a)*(r*l)+(-3*t+3*n-2*o-a)*l+o*r+t}function Ky(e,t,n,i){const r=1-i;return r*r*e+2*r*i*t+i*i*n}const Zy=isFinite;function Qy(){return Qy.zero()}!function(e){function t(){const e=[.1,0,0];return e[0]=0,e}function n(e,n,i){const r=t();return r[0]=e,r[1]=n,r[2]=i,r}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function r(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function s(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function o(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function a(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function l(e){const t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function c(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function u(e,t){const n=t[0],i=t[1],r=t[2];let s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function d(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2];return e[0]=r*l-s*a,e[1]=s*o-i*l,e[2]=i*a-r*o,e}e.zero=t,e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.isFinite=function(e){return Zy(e[0])&&Zy(e[1])&&Zy(e[2])},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])},e.setNaN=function(e){return e[0]=NaN,e[1]=NaN,e[2]=NaN,e},e.fromObj=function(e){return n(e.x,e.y,e.z)},e.toObj=function(e){return{x:e[0],y:e[1],z:e[2]}},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t},e.create=n,e.ofArray=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},e.copy=i,e.add=r,e.sub=s,e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.scale=o,e.scaleAndAdd=a,e.scaleAndSub=function(e,t,n,i){return e[0]=t[0]-n[0]*i,e[1]=t[1]-n[1]*i,e[2]=t[2]-n[2]*i,e},e.addScalar=function(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e},e.subScalar=function(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},e.trunc=function(e,t){return e[0]=Math.trunc(t[0]),e[1]=Math.trunc(t[1]),e[2]=Math.trunc(t[2]),e},e.abs=function(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e},e.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},e.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},e.clamp=function(e,t,n,i){return e[0]=Math.max(n[0],Math.min(i[0],t[0])),e[1]=Math.max(n[1],Math.min(i[1],t[1])),e[2]=Math.max(n[2],Math.min(i[2],t[2])),e},e.distance=function(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+i*i+r*r)},e.squaredDistance=function(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r},e.magnitude=function(e){const t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)},e.squaredMagnitude=l,e.setMagnitude=function(e,t,n){return o(e,u(e,t),n)},e.negate=c,e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},e.normalize=u,e.dot=h,e.cross=d,e.lerp=function(e,t,n,i){const r=t[0],s=t[1],o=t[2];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=o+i*(n[2]-o),e};const p=t();function f(e,t){const n=Math.sqrt(l(e)*l(t));if(0===n)return Math.PI/2;const i=h(e,t)/n;return Math.acos(Xy(i,-1,1))}e.slerp=function(e,t,n,i){const s=Xy(h(t,n),-1,1),l=Math.acos(s)*i;return a(p,n,t,-s),u(p,p),r(e,o(e,t,Math.cos(l)),o(p,p,Math.sin(l)))},e.hermite=function(e,t,n,i,r,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return e[0]=t[0]*a+n[0]*l+i[0]*c+r[0]*u,e[1]=t[1]*a+n[1]*l+i[1]*c+r[1]*u,e[2]=t[2]*a+n[2]*l+i[2]*c+r[2]*u,e},e.bezier=function(e,t,n,i,r,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,d=l*s;return e[0]=t[0]*c+n[0]*u+i[0]*h+r[0]*d,e[1]=t[1]*c+n[1]*u+i[1]*h+r[1]*d,e[2]=t[2]*c+n[2]*u+i[2]*h+r[2]*d,e},e.quadraticBezier=function(e,t,n,i,r){return e[0]=Ky(t[0],n[0],i[0],r),e[1]=Ky(t[1],n[1],i[1],r),e[2]=Ky(t[2],n[2],i[2],r),e},e.spline=function(e,t,n,i,r,s,o){return e[0]=Yy(t[0],n[0],i[0],r[0],s,o),e[1]=Yy(t[1],n[1],i[1],r[1],s,o),e[2]=Yy(t[2],n[2],i[2],r[2],s,o),e},e.random=function(e,t){const n=2*Math.random()*Math.PI,i=2*Math.random()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e},e.transformMat4=function(e,t,n){const i=t[0],r=t[1],s=t[2],o=1/(n[3]*i+n[7]*r+n[11]*s+n[15]||1);return e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])*o,e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])*o,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])*o,e},e.transformDirection=function(e,t,n){const i=t[0],r=t[1],s=t[2];return e[0]=n[0]*i+n[4]*r+n[8]*s,e[1]=n[1]*i+n[5]*r+n[9]*s,e[2]=n[2]*i+n[6]*r+n[10]*s,u(e,e)},e.transformMat4Offset=function(e,t,n,i,r,s){const o=t[0+r],a=t[1+r],l=t[2+r],c=1/(n[3+s]*o+n[7+s]*a+n[11+s]*l+n[15+s]||1);return e[0+i]=(n[0+s]*o+n[4+s]*a+n[8+s]*l+n[12+s])*c,e[1+i]=(n[1+s]*o+n[5+s]*a+n[9+s]*l+n[13+s])*c,e[2+i]=(n[2+s]*o+n[6+s]*a+n[10+s]*l+n[14+s])*c,e},e.transformDirectionOffset=function(e,t,n,i,r,s){const o=t[0+r],a=t[1+r],l=t[2+r];e[0+i]=n[0+s]*o+n[4+s]*a+n[8+s]*l,e[1+i]=n[1+s]*o+n[5+s]*a+n[9+s]*l,e[2+i]=n[2+s]*o+n[6+s]*a+n[10+s]*l;const c=Math.hypot(e[0+i],e[1+i],e[2+i]);return c>0&&(e[0+i]/=c,e[1+i]/=c,e[2+i]/=c),e},e.transformMat3=function(e,t,n){const i=t[0],r=t[1],s=t[2];return e[0]=i*n[0]+r*n[3]+s*n[6],e[1]=i*n[1]+r*n[4]+s*n[7],e[2]=i*n[2]+r*n[5]+s*n[8],e},e.transformQuat=function(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,h=c*r+l*i-o*s,d=c*s+o*r-a*i,p=-o*i-a*r-l*s;return e[0]=u*c+p*-o+h*-l-d*-a,e[1]=h*c+p*-a+d*-o-u*-l,e[2]=d*c+p*-l+u*-a-h*-o,e},e.angle=f;const m=t(),g=t(),_=t(),v=t(),y=t(),b=t(),x=t();e.dihedralAngle=function(e,t,n,i){s(m,e,t),s(g,n,t),s(_,t,n),s(v,i,n),d(y,m,g),d(b,_,v);const r=f(y,b);return d(x,y,b),h(g,x)>0?r:-r},e.directionFromSpherical=function(t,n,i,r){return e.set(t,r*Math.cos(i)*Math.sin(n),r*Math.sin(i)*Math.sin(n),r*Math.cos(n))},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.equals=function(e,t){const n=e[0],i=e[1],r=e[2],s=t[0],o=t[1],a=t[2];return Math.abs(n-s)<=Wy*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=Wy*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Wy*Math.max(1,Math.abs(r),Math.abs(a))};const w=t();e.makeRotation=function(t,n,i){const r=f(n,i);if(Math.abs(r)<1e-4)return tb.setIdentity(t);if(Math.abs(r-Math.PI)<Wy)return tb.fromScaling(t,e.negUnit);const s=d(w,n,i);return tb.fromRotation(t,r,s)},e.isZero=function(e){return 0===e[0]&&0===e[1]&&0===e[2]},e.projectPointOnVector=function(e,t,n,i){return s(e,t,i),r(e,o(e,n,h(n,e)/l(n)),i)};const S=t();function A(e,t,n){return o(e,n,h(n,t)/l(n))}e.projectPointOnPlane=function(e,t,n,i){return u(S,n),s(e,t,i),s(e,t,o(S,S,h(e,S)))},e.projectOnVector=A;const M=t();e.projectOnPlane=function(e,t,n){return A(M,t,n),s(e,t,M)},e.orthogonalize=function(e,t,n){return u(e,d(e,d(e,t,n),t))},e.matchDirection=function(e,t,n){return h(t,n)>0?i(e,t):c(e,i(e,t)),e};const C=t(),T=t();e.triangleNormal=function(e,t,n,i){return s(C,n,t),s(T,i,t),u(e,d(e,C,T))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}]`},e.origin=n(0,0,0),e.unit=n(1,1,1),e.negUnit=n(-1,-1,-1),e.unitX=n(1,0,0),e.unitY=n(0,1,0),e.unitZ=n(0,0,1),e.negUnitX=n(-1,0,0),e.negUnitY=n(0,-1,0),e.negUnitZ=n(0,0,-1)}(Qy||(Qy={}));const Jy=Math.PI/180;function eb(e){return e*Jy}function tb(){return tb.zero()}function nb(){return nb.zero()}function ib(){return ib.zero()}function rb(){return rb.zero()}function sb(e){throw new Error("unreachable")}function ob(){return ob.zero()}var ab,lb,cb,ub;function hb(e,t,n){let i=t,r=0,s=1;for(45===e.charCodeAt(i)?(s=-1,++i):43===e.charCodeAt(i)&&++i;i<n;i++){const t=e.charCodeAt(i)-48;if(t>9||t<0)return s*r|0;r=10*r+t|0}return s*r}function db(e,t,n,i){return 43===t.charCodeAt(n)&&n++,e*Math.pow(10,hb(t,n,i))}function pb(e,t,n){let i=t,r=1,s=0,o=0,a=1;for(45===e.charCodeAt(i)?(r=-1,++i):43===e.charCodeAt(i)&&++i;i<n;){let t=e.charCodeAt(i)-48;if(!(t>=0&&t<10)){if(-2===t){for(++i;i<n;){if(t=e.charCodeAt(i)-48,!(t>=0&&t<10))return 53===t||21===t?db(r*(s+o/a),e,i+1,n):r*(s+o/a);o=10*o+t,a*=10,++i}return r*(s+o/a)}if(53===t||21===t)return db(r*s,e,i+1,n);break}s=10*s+t,++i}return r*s}function fb(e,t,n,i){return{schema:n,__array:void 0,isDefined:0===i,rowCount:t,value:t=>e,valueKind:e=>i,toArray:n=>{const{array:i}=Hy(t,n);for(let t=0,n=i.length;t<n;t++)i[t]=e;return i},areValuesEqual:(e,t)=>!0}}function mb({value:e,valueKind:t,areValuesEqual:n,rowCount:i,schema:r}){return{schema:r,__array:void 0,isDefined:!0,rowCount:i,value:e,valueKind:t||(e=>0),toArray:t=>{const{array:n,start:r}=Hy(i,t);for(let t=0,i=n.length;t<i;t++)n[t]=e(t+r);return n},areValuesEqual:n||((t,n)=>e(t)===e(n))}}function gb({array:e,schema:t,valueKind:n}){const i=e.length,r=t.T,s="str"===t.valueType?"lowercase"===t.transform?t=>{const n=e[t];return"string"==typeof n?n.toLowerCase():`${null!=n?n:r}`.toLowerCase()}:"uppercase"===t.transform?t=>{const n=e[t];return"string"==typeof n?n.toUpperCase():`${null!=n?n:r}`.toUpperCase()}:t=>{const n=e[t];return"string"==typeof n?n:`${null!=n?n:r}`}:t=>e[t],o=Gy(e);return{schema:t,__array:e,isDefined:!0,rowCount:i,value:s,valueKind:n||(e=>0),toArray:"str"===t.valueType?"lowercase"===t.transform?t=>{const{start:n,end:s}=Vy(i,t),o=new(t&&void 0!==t.array?t.array:e.constructor)(s-n);for(let t=0,i=s-n;t<i;t++){const i=e[n+t];o[t]="string"==typeof i?i.toLowerCase():`${null!=i?i:r}`.toLowerCase()}return o}:"uppercase"===t.transform?t=>{const{start:n,end:s}=Vy(i,t),o=new(t&&void 0!==t.array?t.array:e.constructor)(s-n);for(let t=0,i=s-n;t<i;t++){const i=e[n+t];o[t]="string"==typeof i?i.toUpperCase():`${null!=i?i:r}`.toUpperCase()}return o}:t=>{const{start:n,end:s}=Vy(i,t),o=new(t&&void 0!==t.array?t.array:e.constructor)(s-n);for(let t=0,i=s-n;t<i;t++){const i=e[n+t];o[t]="string"==typeof i?i:`${null!=i?i:r}`}return o}:o?t=>jy(e,t):t=>{const{start:n,end:r}=Vy(i,t);if(0===n&&r===e.length)return e;const s=new(t&&void 0!==t.array?t.array:e.constructor)(r-n);for(let t=0,i=r-n;t<i;t++)s[t]=e[n+t];return s},areValuesEqual:(t,n)=>e[t]===e[n]}}function _b(e,t,n){return e[t]-e[n]}function vb(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function yb(e,t,n,i){const r=n+i>>1;return t(e,n,i)>0?t(e,n,r)>0?t(e,r,i)>0?r:i:n:t(e,i,r)>0?t(e,r,n)>0?r:n:i}function bb(e,t,n){const{cmp:i,swap:r,data:s,parts:o}=e;let a=t+1,l=n;for(r(s,t,yb(s,i,t,n));i(s,l,t)>0;)--l;for(let e=t+1;e<=l;e++){const n=i(s,e,t);if(n>0){for(r(s,e,l),--l;i(s,l,t)>0;)--l;e--}else 0===n&&(r(s,e,a),a++)}for(let e=t;e<a;e++)r(s,e,t+l-e);o[0]=l-a+t+1,o[1]=l}function xb({data:e,cmp:t,swap:n},i,r){for(let s=i+1;s<=r;s++){let r=s-1;for(;r>=i&&t(e,r,r+1)>0;)n(e,r,r+1),r-=1}}function wb(e,t,n){const{parts:i}=e;for(;t<n;){if(n-t<16)return void xb(e,t,n);bb(e,t,n);const r=i[0],s=i[1];r-t<n-s?(wb(e,t,r-1),t=s+1):(wb(e,s+1,n),n=r-1)}}function Sb(e,t,n,i){let r=n+1,s=i;vb(e,n,yb(e,_b,n,i));const o=e[n];for(;e[s]>o;)--s;for(let t=n+1;t<=s;t++){const n=e[t];if(n>o){for(vb(e,t,s),--s;e[s]>o;)--s;t--}else n===o&&(vb(e,t,r),++r)}for(let t=n;t<r;t++)vb(e,t,n+s-t);t[0]=s-r+n+1,t[1]=s}function Ab(e,t,n){for(let i=t+1;i<=n;i++){const n=e[i];let r=i-1;for(;r>=t&&e[r]>n;)e[r+1]=e[r],r-=1;e[r+1]=n}}function Mb(e,t,n,i){for(;n<i;){if(i-n<16)return void Ab(e,n,i);Sb(e,t,n,i);const r=t[0],s=t[1];r-n<i-s?(Mb(e,t,n,r-1),n=s+1):(Mb(e,t,s+1,i),i=r-1)}}function Cb(e,t=_b){return function(e,t,n,i=_b){return i===_b?Mb(e,[0,0],t,n-1):wb({data:e,cmp:i,swap:vb,parts:[0,0]},t,n-1),e}(e,0,e.length,t)}!function(e){function t(){const e=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return e[0]=0,e}function n(){const e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function r(e){for(let t=0;t<16;t++)e[t]=0;return e}e.zero=t,e.identity=n,e.setIdentity=i,e.setZero=r,e.ofRows=function(e){const n=t();for(let t=0;t<4;t++){const i=e[t];for(let e=0;e<4;e++)n[4*e+t]=i[e]}return n};const s=n();function o(e,t,n){for(let i=0;i<16;i++)if(Math.abs(e[i]-t[i])>n)return!1;return!0}function a(e,t,n,i){e[4*n+t]=i}function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function c(e,t){const n=t[0]+t[5]+t[10];let i=0;return n>0?(i=2*Math.sqrt(n+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function u(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=n*a-i*o,y=n*l-r*o,b=n*c-s*o,x=i*l-r*a,w=i*c-s*a,S=r*c-s*l,A=u*m-h*f,M=u*g-d*f,C=u*_-p*f,T=h*g-d*m,E=h*_-p*m,P=d*_-p*g;let I=v*P-y*E+b*T+x*C-w*M+S*A;return!!I&&(I=1/I,e[0]=(a*P-l*E+c*T)*I,e[1]=(r*E-i*P-s*T)*I,e[2]=(m*S-g*w+_*x)*I,e[3]=(d*w-h*S-p*x)*I,e[4]=(l*C-o*P-c*M)*I,e[5]=(n*P-r*C+s*M)*I,e[6]=(g*b-f*S-_*y)*I,e[7]=(u*S-d*b+p*y)*I,e[8]=(o*E-a*C+c*A)*I,e[9]=(i*C-n*E-s*A)*I,e[10]=(f*w-m*b+_*v)*I,e[11]=(h*b-u*w-p*v)*I,e[12]=(a*M-o*T-l*A)*I,e[13]=(n*T-i*M+r*A)*I,e[14]=(m*y-f*x-g*v)*I,e[15]=(u*x-h*y+d*v)*I,!0)}function h(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15];let y=n[0],b=n[1],x=n[2],w=n[3];return e[0]=y*i+b*a+x*h+w*m,e[1]=y*r+b*l+x*d+w*g,e[2]=y*s+b*c+x*p+w*_,e[3]=y*o+b*u+x*f+w*v,y=n[4],b=n[5],x=n[6],w=n[7],e[4]=y*i+b*a+x*h+w*m,e[5]=y*r+b*l+x*d+w*g,e[6]=y*s+b*c+x*p+w*_,e[7]=y*o+b*u+x*f+w*v,y=n[8],b=n[9],x=n[10],w=n[11],e[8]=y*i+b*a+x*h+w*m,e[9]=y*r+b*l+x*d+w*g,e[10]=y*s+b*c+x*p+w*_,e[11]=y*o+b*u+x*f+w*v,y=n[12],b=n[13],x=n[14],w=n[15],e[12]=y*i+b*a+x*h+w*m,e[13]=y*r+b*l+x*d+w*g,e[14]=y*s+b*c+x*p+w*_,e[15]=y*o+b*u+x*f+w*v,e}function d(e,t,n){let r=n[0],s=n[1],o=n[2],a=Math.sqrt(r*r+s*s+o*o);if(Math.abs(a)<Wy)return i(e);a=1/a,r*=a,s*=a,o*=a;const l=Math.sin(t),c=Math.cos(t),u=1-c;return e[0]=r*r*u+c,e[1]=s*r*u+o*l,e[2]=o*r*u-s*l,e[3]=0,e[4]=r*s*u-o*l,e[5]=s*s*u+c,e[6]=o*s*u+r*l,e[7]=0,e[8]=r*o*u+s*l,e[9]=s*o*u-r*l,e[10]=o*o*u+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.isIdentity=function(e,t){return o(e,s,void 0===t?Wy:t)},e.hasNaN=function(e){for(let t=0;t<16;t++)if(isNaN(e[t]))return!0;return!1},e.areEqual=o,e.setValue=a,e.getValue=function(e,t,n){return e[4*n+t]},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t[n+9]=e[9],t[n+10]=e[10],t[n+11]=e[11],t[n+12]=e[12],t[n+13]=e[13],t[n+14]=e[14],t[n+15]=e[15],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e[9]=t[n+9],e[10]=t[n+10],e[11]=t[n+11],e[12]=t[n+12],e[13]=t[n+13],e[14]=t[n+14],e[15]=t[n+15],e},e.fromBasis=function(e,t,n,i){return r(e),a(e,0,0,t[0]),a(e,1,0,t[1]),a(e,2,0,t[2]),a(e,0,1,n[0]),a(e,1,1,n[1]),a(e,2,1,n[2]),a(e,0,2,i[0]),a(e,1,2,i[1]),a(e,2,2,i[2]),a(e,3,3,1),e},e.copy=l,e.clone=function(e){return l(t(),e)},e.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},e.getScaling=function(e,t){const n=t[0],i=t[1],r=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(n*n+i*i+r*r),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e},e.getRotation=c,e.extractRotation=function(e,t){const n=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=1/Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),r=1/Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=0,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=0,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.transpose=function(e,t){if(e===t){const n=t[1],i=t[2],r=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.tryInvert=u,e.invert=function(e,t){return u(e,t)||console.warn("non-invertible matrix.",t),e},e.mul=h,e.mulOffset=function(e,t,n,i,r,s){const o=t[0+r],a=t[1+r],l=t[2+r],c=t[3+r],u=t[4+r],h=t[5+r],d=t[6+r],p=t[7+r],f=t[8+r],m=t[9+r],g=t[10+r],_=t[11+r],v=t[12+r],y=t[13+r],b=t[14+r],x=t[15+r];let w=n[0+s],S=n[1+s],A=n[2+s],M=n[3+s];return e[0+i]=w*o+S*u+A*f+M*v,e[1+i]=w*a+S*h+A*m+M*y,e[2+i]=w*l+S*d+A*g+M*b,e[3+i]=w*c+S*p+A*_+M*x,w=n[4+s],S=n[5+s],A=n[6+s],M=n[7+s],e[4+i]=w*o+S*u+A*f+M*v,e[5+i]=w*a+S*h+A*m+M*y,e[6+i]=w*l+S*d+A*g+M*b,e[7+i]=w*c+S*p+A*_+M*x,w=n[8+s],S=n[9+s],A=n[10+s],M=n[11+s],e[8+i]=w*o+S*u+A*f+M*v,e[9+i]=w*a+S*h+A*m+M*y,e[10+i]=w*l+S*d+A*g+M*b,e[11+i]=w*c+S*p+A*_+M*x,w=n[12+s],S=n[13+s],A=n[14+s],M=n[15+s],e[12+i]=w*o+S*u+A*f+M*v,e[13+i]=w*a+S*h+A*m+M*y,e[14+i]=w*l+S*d+A*g+M*b,e[15+i]=w*c+S*p+A*_+M*x,e},e.mul3=function(e,t,n,i){return h(e,h(e,t,n),i)},e.translate=function(e,t,n){const i=n[0],r=n[1],s=n[2];let o,a,l,c,u,h,d,p,f,m,g,_;return t===e?(e[12]=t[0]*i+t[4]*r+t[8]*s+t[12],e[13]=t[1]*i+t[5]*r+t[9]*s+t[13],e[14]=t[2]*i+t[6]*r+t[10]*s+t[14],e[15]=t[3]*i+t[7]*r+t[11]*s+t[15]):(o=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],p=t[7],f=t[8],m=t[9],g=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=p,e[8]=f,e[9]=m,e[10]=g,e[11]=_,e[12]=o*i+u*r+f*s+t[12],e[13]=a*i+h*r+m*s+t[13],e[14]=l*i+d*r+g*s+t[14],e[15]=c*i+p*r+_*s+t[15]),e},e.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},e.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},e.setAxes=function(e,t,n,i){return e[0]=n[0],e[4]=n[1],e[8]=n[2],e[1]=i[0],e[5]=i[1],e[9]=i[2],e[2]=t[0],e[6]=t[1],e[10]=t[2],e},e.rotate=function(e,t,i,r){let s=r[0],o=r[1],a=r[2],l=Math.sqrt(s*s+o*o+a*a);if(Math.abs(l)<Wy)return n();l=1/l,s*=l,o*=l,a*=l;const c=Math.sin(i),u=Math.cos(i),h=1-u,d=t[0],p=t[1],f=t[2],m=t[3],g=t[4],_=t[5],v=t[6],y=t[7],b=t[8],x=t[9],w=t[10],S=t[11],A=s*s*h+u,M=o*s*h+a*c,C=a*s*h-o*c,T=s*o*h-a*c,E=o*o*h+u,P=a*o*h+s*c,I=s*a*h+o*c,k=o*a*h-s*c,R=a*a*h+u;return e[0]=d*A+g*M+b*C,e[1]=p*A+_*M+x*C,e[2]=f*A+v*M+w*C,e[3]=m*A+y*M+S*C,e[4]=d*T+g*E+b*P,e[5]=p*T+_*E+x*P,e[6]=f*T+v*E+w*P,e[7]=m*T+y*E+S*P,e[8]=d*I+g*k+b*R,e[9]=p*I+_*k+x*R,e[10]=f*I+v*k+w*R,e[11]=m*I+y*k+S*R,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},e.fromRotation=d,e.scale=function(e,t,n){const i=n[0],r=n[1],s=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scaleUniformly=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromUniformScaling=function(e,t){return e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromMat3=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e},e.compose=function(e,t,n,i){const[r,s,o,a]=n,l=r+r,c=s+s,u=o+o,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=o*u,_=a*l,v=a*c,y=a*u,[b,x,w]=i;return e[0]=(1-(f+g))*b,e[1]=(d+y)*b,e[2]=(p-v)*b,e[3]=0,e[4]=(d-y)*x,e[5]=(1-(h+g))*x,e[6]=(m+_)*x,e[7]=0,e[8]=(p+v)*w,e[9]=(m-_)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e};const p=[0,0,0],f=t();function m(e){const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-n*s)*(h*g-d*m)-(t*a-i*s)*(u*g-d*f)+(t*l-r*s)*(u*m-h*f)+(n*a-i*o)*(c*g-d*p)-(n*l-r*o)*(c*m-h*p)+(i*l-r*a)*(c*f-u*p)}e.decompose=function(e,t,n,i){let r=Qy.magnitude(Qy.set(p,e[0],e[1],e[2]));const s=Qy.magnitude(Qy.set(p,e[4],e[5],e[6])),o=Qy.magnitude(Qy.set(p,e[8],e[9],e[10]));m(e)<0&&(r=-r),t[0]=e[12],t[1]=e[13],t[2]=e[14],l(f,e);const a=1/r,u=1/s,h=1/o;return f[0]*=a,f[1]*=a,f[2]*=a,f[4]*=u,f[5]*=u,f[6]*=u,f[8]*=h,f[9]*=h,f[10]*=h,c(n,f),i[0]=r,i[1]=s,i[2]=o,e},e.makeTable=function(e){let t="";for(let n=0;n<4;n++){for(let i=0;i<4;i++)t+=e[4*i+n].toString(),i<3&&(t+=" ");n<3&&(t+="\n")}return t},e.determinant=m,e.isRotationAndTranslation=function(e,t){return function(e,t){const n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11];return!!(qy(e[15],1,t)&&qy(s,0,t)&&qy(c,0,t)&&qy(p,0,t))&&!!qy(Math.abs(n*(a*d-l*h)-i*(o*d-l*u)+r*(o*h-a*u)),1,t)}(e,void 0!==t?t:Wy)},e.isTranslationAndUniformScaling=function(e,t){return function(e,t){const n=e[0];return qy(e[1],0,t)&&qy(e[2],0,t)&&qy(e[3],0,t)&&qy(e[4],0,t)&&qy(e[5],n,t)&&qy(e[6],0,t)&&qy(e[7],0,t)&&qy(e[8],0,t)&&qy(e[9],0,t)&&qy(e[10],n,t)&&qy(e[11],0,t)&&qy(e[15],1,t)}(e,void 0!==t?t:Wy)},e.fromQuat=function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,_=s*l;return e[0]=1-h-f,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromEuler=function(e,t,n){const i=t[0],r=t[1],s=t[2],o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if("XYZ"===n){const t=o*u,n=o*h,i=a*u,r=a*h;e[0]=l*u,e[4]=-l*h,e[8]=c,e[1]=n+i*c,e[5]=t-r*c,e[9]=-a*l,e[2]=r-t*c,e[6]=i+n*c,e[10]=o*l}else if("YXZ"===n){const t=l*u,n=l*h,i=c*u,r=c*h;e[0]=t+r*a,e[4]=i*a-n,e[8]=o*c,e[1]=o*h,e[5]=o*u,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=o*l}else if("ZXY"===n){const t=l*u,n=l*h,i=c*u,r=c*h;e[0]=t-r*a,e[4]=-o*h,e[8]=i+n*a,e[1]=n+i*a,e[5]=o*u,e[9]=r-t*a,e[2]=-o*c,e[6]=a,e[10]=o*l}else if("ZYX"===n){const t=o*u,n=o*h,i=a*u,r=a*h;e[0]=l*u,e[4]=i*c-n,e[8]=t*c+r,e[1]=l*h,e[5]=r*c+t,e[9]=n*c-i,e[2]=-c,e[6]=a*l,e[10]=o*l}else if("YZX"===n){const t=o*l,n=o*c,i=a*l,r=a*c;e[0]=l*u,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=o*u,e[9]=-a*u,e[2]=-c*u,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===n){const t=o*l,n=o*c,i=a*l,r=a*c;e[0]=l*u,e[4]=-h,e[8]=c*u,e[1]=t*h+r,e[5]=o*u,e[9]=n*h-i,e[2]=i*h-n,e[6]=a*u,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.perspective=function(e,t,n,i,r,s,o){const a=2*s/(n-t),l=2*s/(i-r),c=(n+t)/(n-t),u=(i+r)/(i-r),h=-(o+s)/(o-s),d=-2*o*s/(o-s);return e[0]=a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=c,e[9]=u,e[10]=h,e[11]=-1,e[12]=0,e[13]=0,e[14]=d,e[15]=0,e},e.ortho=function(e,t,n,i,r,s,o){const a=1/(n-t),l=1/(i-r),c=1/(o-s),u=(n+t)*a,h=(i+r)*l,d=(o+s)*c;return e[0]=2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=-2*c,e[11]=0,e[12]=-u,e[13]=-h,e[14]=-d,e[15]=1,e},e.lookAt=function(e,t,n,r){let s,o,a,l,c,u,h,d,p,f;const m=t[0],g=t[1],_=t[2],v=r[0],y=r[1],b=r[2],x=n[0],w=n[1],S=n[2];return Math.abs(m-x)<Wy&&Math.abs(g-w)<Wy&&Math.abs(_-S)<Wy?i(e):(h=m-x,d=g-w,p=_-S,f=1/Math.sqrt(h*h+d*d+p*p),h*=f,d*=f,p*=f,s=y*p-b*d,o=b*h-v*p,a=v*d-y*h,f=Math.sqrt(s*s+o*o+a*a),f?(f=1/f,s*=f,o*=f,a*=f):(s=0,o=0,a=0),l=d*a-p*o,c=p*s-h*a,u=h*o-d*s,f=Math.sqrt(l*l+c*c+u*u),f?(f=1/f,l*=f,c*=f,u*=f):(l=0,c=0,u=0),e[0]=s,e[1]=l,e[2]=h,e[3]=0,e[4]=o,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=p,e[11]=0,e[12]=-(s*m+o*g+a*_),e[13]=-(l*m+c*g+u*_),e[14]=-(h*m+d*g+p*_),e[15]=1,e)},e.targetTo=function(e,t,n,i){const r=t[0],s=t[1],o=t[2],a=i[0],l=i[1],c=i[2];let u=r-n[0],h=s-n[1],d=o-n[2],p=u*u+h*h+d*d;p>0&&(p=1/Math.sqrt(p),u*=p,h*=p,d*=p);let f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return p=f*f+m*m+g*g,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=r,e[13]=s,e[14]=o,e[15]=1,e},e.fromPermutation=function(e,t){r(e);for(let n=0;n<4;n++)a(e,n,t[n],1);return e},e.getMaxScaleOnAxis=function(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))};const g=[1,0,0],_=[0,1,0],v=[0,0,1];e.rotX90=d(t(),eb(90),g),e.rotX180=d(t(),eb(180),g),e.rotY90=d(t(),eb(90),_),e.rotY180=d(t(),eb(180),_),e.rotY270=d(t(),eb(270),_),e.rotZ90=d(t(),eb(90),v),e.rotZ180=d(t(),eb(180),v),e.rotXY90=h(t(),e.rotX90,e.rotY90),e.rotZY90=h(t(),e.rotZ90,e.rotY90),e.rotZYZ90=h(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=h(t(),e.rotZ90,e.rotX180),e.rotY90Z180=h(t(),e.rotY90,e.rotZ180),e.id=n()}(tb||(tb={})),function(e){function t(){const e=[.1,0,0,0,0,0,0,0,0];return e[0]=0,e}function n(){const e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}e.zero=t,e.identity=n,e.setIdentity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e},e.fromColumns=function(e,t,n,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=n[0],e[4]=n[1],e[5]=n[2],e[6]=i[0],e[7]=i[1],e[8]=i[2],e},e.fromMat4=i;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];e.fromEuler=function(e,t,n){return tb.fromEuler(r,t,n),i(e,r)},e.create=function(e,n,i,r,s,o,a,l,c){const u=t();return u[0]=e,u[1]=n,u[2]=i,u[3]=r,u[4]=s,u[5]=o,u[6]=a,u[7]=l,u[8]=c,u};const s=n();function o(e,t,n){for(let i=0;i<9;i++)if(Math.abs(e[i]-t[i])>n)return!1;return!0}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function l(e,t){if(e===t){const n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function c(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l;let f=n*h+i*d+r*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*i+r*c)*f,e[2]=(a*i-r*o)*f,e[3]=d*f,e[4]=(u*n-r*l)*f,e[5]=(-a*n+r*s)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(o*n-i*s)*f,e):(console.warn("non-invertible matrix.",t),e)}function u(e){const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}function h(e){return e[0]+e[4]+e[8]}function d(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function p(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}e.isIdentity=function(e,t){return o(e,s,void 0===t?Wy:t)},e.hasNaN=function(e){for(let t=0;t<9;t++)if(isNaN(e[t]))return!0;return!1},e.clone=function(e){return a(t(),e)},e.areEqual=o,e.setValue=function(e,t,n,i){e[3*n+t]=i},e.getValue=function(e,t,n){return e[3*n+t]},e.copy=a,e.transpose=l,e.invert=c,e.symmtricFromUpper=function(e,t){return e===t?(e[3]=t[1],e[6]=t[2],e[7]=t[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[1],e[4]=t[4],e[5]=t[5],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},e.symmtricFromLower=function(e,t){return e===t?(e[1]=t[3],e[2]=t[6],e[5]=t[7]):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[3],e[4]=t[4],e[5]=t[7],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},e.determinant=u,e.trace=h,e.sub=d,e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},e.mul=function(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],_=n[5],v=n[6],y=n[7],b=n[8];return e[0]=d*i+p*o+f*c,e[1]=d*r+p*a+f*u,e[2]=d*s+p*l+f*h,e[3]=m*i+g*o+_*c,e[4]=m*r+g*a+_*u,e[5]=m*s+g*l+_*h,e[6]=v*i+y*o+b*c,e[7]=v*r+y*a+b*u,e[8]=v*s+y*l+b*h,e},e.subScalar=function(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e[3]=t[3]-n,e[4]=t[4]-n,e[5]=t[5]-n,e[6]=t[6]-n,e[7]=t[7]-n,e[8]=t[8]-n,e},e.addScalar=function(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e[3]=t[3]+n,e[4]=t[4]+n,e[5]=t[5]+n,e[6]=t[6]+n,e[7]=t[7]+n,e[8]=t[8]+n,e},e.mulScalar=p;const f=Math.PI/3,m=t();e.symmetricEigenvalues=function(t,n){const i=n[1]*n[1]+n[2]*n[2]+n[5]*n[5];if(0===i)t[0]=n[0],t[1]=n[4],t[2]=n[8];else{const r=h(n)/3,s=n[0]-r,o=n[4]-r,a=n[8]-r,l=s*s+o*o+a*a+2*i,c=Math.sqrt(l/6);p(m,e.Identity,r),d(m,n,m),p(m,m,1/c);const g=u(m)/2,_=g<=-1?f:g>=1?0:Math.acos(g)/3;t[0]=r+2*c*Math.cos(_),t[2]=r+2*c*Math.cos(_+2*f),t[1]=3*r-t[0]-t[2]}return t};const g=[.1,0,0],_=[.1,0,0],v=[.1,0,0],y=[.1,0,0],b=[.1,0,0],x=[.1,0,0];e.eigenvector=function(e,t,n){Qy.set(g,t[0]-n,t[1],t[2]),Qy.set(_,t[1],t[4]-n,t[5]),Qy.set(v,t[2],t[5],t[8]-n),Qy.cross(y,g,_),Qy.cross(b,g,v),Qy.cross(x,_,v);const i=Qy.dot(y,y),r=Qy.dot(b,b),s=Qy.dot(x,x);let o=i,a=0;return r>o&&(o=r,a=1),s>o&&(a=2),0===a?Qy.scale(e,y,1/Math.sqrt(i)):1===a?Qy.scale(e,b,1/Math.sqrt(r)):Qy.scale(e,x,1/Math.sqrt(s)),e},e.directionTransform=function(e,t){return i(e,t),c(e,e),l(e,e),e},e.Identity=n(),e.innerProduct=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[4]*t[4]+e[5]*t[5]+e[6]*t[6]+e[7]*t[7]+e[8]*t[8]}}(nb||(nb={})),function(e){function t(){const e=[.1,0];return e[0]=0,e}e.zero=t,e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n},e.create=function(e,n){const i=t();return i[0]=e,i[1]=n,i},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},e.set=function(e,t,n){return e[0]=t,e[1]=n,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},e.sub=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},e.distance=function(e,t){const n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)},e.squaredDistance=function(e,t){const n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i},e.magnitude=function(e){const t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},e.squaredMagnitude=function(e){const t=e[0],n=e[1];return t*t+n*n},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},e.areEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)}}]`}}(ib||(ib={})),function(e){function t(){const e=[.1,0,0,0];return e[0]=0,e}function n(e,t){return e[0]=t.center[0],e[1]=t.center[1],e[2]=t.center[2],e[3]=t.radius,e}e.zero=t,e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.create=function(e,n,i,r){const s=t();return s[0]=e,s[1]=n,s[2]=i,s[3]=r,s},e.fromSphere=n,e.ofSphere=function(e){return n(t(),e)},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.toVec3Array=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2]},e.fromVec3Array=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=0,e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.distance=function(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+i*i+r*r+s*s)},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[4]=t[4]*n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},e.squaredDistance=function(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return n*n+i*i+r*r+s*s},e.norm=function(e){const t=e[0],n=e[1],i=e[2],r=e[3];return Math.sqrt(t*t+n*n+i*i+r*r)},e.squaredNorm=function(e){const t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r},e.transformMat4=function(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.equals=function(e,t){const n=e[0],i=e[1],r=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-o)<=Wy*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=Wy*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=Wy*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=Wy*Math.max(1,Math.abs(s),Math.abs(c))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`}}(rb||(rb={})),function(e){function t(){const e=[.1,0,0,0];return e[0]=0,e}function n(){const e=t();return e[3]=1,e}function i(e,t,n){n*=.5;const i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function r(e,t,n,i){const r=t[0],s=t[1],o=t[2],a=t[3];let l,c,u,h,d,p=n[0],f=n[1],m=n[2],g=n[3];return c=r*p+s*f+o*m+a*g,c<0&&(c=-c,p=-p,f=-f,m=-m,g=-g),1-c>1e-6?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-i)*l)/u,d=Math.sin(i*l)/u):(h=1-i,d=i),e[0]=h*r+d*p,e[1]=h*s+d*f,e[2]=h*o+d*m,e[3]=h*a+d*g,e}function s(e,t){const n=t[0]+t[4]+t[8];let i;if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const r=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*s+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*r+s]-t[3*s+r])*i,e[r]=(t[3*r+n]+t[3*n+r])*i,e[s]=(t[3*s+n]+t[3*n+s])*i}return e}e.zero=t,e.identity=n,e.setIdentity=function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])},e.create=function(e,t,i,r){const s=n();return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s},e.setAxisAngle=i,e.getAxisAngle=function(e,t){const n=2*Math.acos(t[3]),i=Math.sin(n/2);return 0!==i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},e.multiply=function(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+o*a+r*c-s*l,e[1]=r*u+o*l+s*a-i*c,e[2]=s*u+o*c+i*l-r*a,e[3]=o*u-i*a-r*l-s*c,e},e.rotateX=function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=s*l-r*a,e[3]=o*l-i*a,e},e.rotateY=function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-s*a,e[1]=r*l+o*a,e[2]=s*l+i*a,e[3]=o*l-r*a,e},e.rotateZ=function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e},e.calculateW=function(e,t){const n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e},e.slerp=r,e.invert=function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=s*a,e},e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.fromMat3=s,e.fromEuler=function(e,t,n){const[i,r,s]=t,o=Math.cos(i/2),a=Math.cos(r/2),l=Math.cos(s/2),c=Math.sin(i/2),u=Math.sin(r/2),h=Math.sin(s/2);switch(n){case"XYZ":e[0]=c*a*l+o*u*h,e[1]=o*u*l-c*a*h,e[2]=o*a*h+c*u*l,e[3]=o*a*l-c*u*h;break;case"YXZ":e[0]=c*a*l+o*u*h,e[1]=o*u*l-c*a*h,e[2]=o*a*h-c*u*l,e[3]=o*a*l+c*u*h;break;case"ZXY":e[0]=c*a*l-o*u*h,e[1]=o*u*l+c*a*h,e[2]=o*a*h+c*u*l,e[3]=o*a*l-c*u*h;break;case"ZYX":e[0]=c*a*l-o*u*h,e[1]=o*u*l+c*a*h,e[2]=o*a*h-c*u*l,e[3]=o*a*l+c*u*h;break;case"YZX":e[0]=c*a*l+o*u*h,e[1]=o*u*l+c*a*h,e[2]=o*a*h-c*u*l,e[3]=o*a*l-c*u*h;break;case"XZY":e[0]=c*a*l-o*u*h,e[1]=o*u*l-c*a*h,e[2]=o*a*h+c*u*l,e[3]=o*a*l+c*u*h;break;default:sb()}return e};const o=[0,0,0];function a(e,t){const n=t[0],i=t[1],r=t[2],s=t[3];let o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=s*o),e}e.fromUnitVec3=function(e,t,n){let i=Qy.dot(t,n)+1;return i<Wy?(i=0,Math.abs(t[0])>Math.abs(t[2])?Qy.set(o,-t[1],t[0],0):Qy.set(o,0,-t[2],t[1])):Qy.cross(o,t,n),e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=i,a(e,e),e},e.clone=function(e){const n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.equals=function(e,t){const n=e[0],i=e[1],r=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-o)<=Wy*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=Wy*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=Wy*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=Wy*Math.max(1,Math.abs(s),Math.abs(c))},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.normalize=a;const l=[0,0,0],c=[1,0,0],u=[0,1,0];e.rotationTo=function(e,t,n){const r=Qy.dot(t,n);return r<-.999999?(Qy.cross(l,c,t),Qy.magnitude(l)<1e-6&&Qy.cross(l,u,t),Qy.normalize(l,l),i(e,l,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Qy.cross(l,t,n),e[0]=l[0],e[1]=l[1],e[2]=l[2],e[3]=1+r,a(e,e))};const h=t(),d=t();e.sqlerp=function(e,t,n,i,s,o){return r(h,t,s,o),r(d,n,i,o),r(e,h,d,2*o*(1-o)),e};const p=[0,0,0,0,0,0,0,0,0];e.setAxes=function(e,t,n,i){return p[0]=n[0],p[3]=n[1],p[6]=n[2],p[1]=i[0],p[4]=i[1],p[7]=i[2],p[2]=-t[0],p[5]=-t[1],p[8]=-t[2],a(e,s(e,p))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`},e.Identity=n()}(ob||(ob={})),function(e){function t(e,t,r){const s=function(e,t,n){const i=[];for(let e=0;e<t.length;e++)i[e]=t[t.length-e-1];const r=[1];for(let t=1;t<e.length;t++)r[t]=e[i[t-1]];return{dimensions:e,axisOrderFastToSlow:i,axisOrderSlowToFast:t,accessDimensions:r,defaultCtor:n||Float64Array}}(e,t,r),{get:o,set:a,add:l,dataOffset:c,getCoords:u}=n(s);return{rank:e.length,dimensions:e,axisOrderSlowToFast:t,create:i(s),get:o,set:a,add:l,dataOffset:c,getCoords:u}}function n(e){const{dimensions:t,axisOrderFastToSlow:n}=e;switch(t.length){case 1:return{get:(e,t)=>e[t],set:(e,t,n)=>e[t]=n,add:(e,t,n)=>e[t]+=n,dataOffset:e=>e,getCoords:(e,t)=>(t[0]=e,t)};case 2:if(0===n[0]&&1===n[1]){const e=t[0];return{get:(t,n,i)=>t[i*e+n],set:(t,n,i,r)=>t[i*e+n]=r,add:(t,n,i,r)=>t[i*e+n]+=r,dataOffset:(t,n)=>n*e+t,getCoords:(t,n)=>(n[0]=t%e,n[1]=Math.floor(t/e),n)}}if(1===n[0]&&0===n[1]){const e=t[1];return{get:(t,n,i)=>t[n*e+i],set:(t,n,i,r)=>t[n*e+i]=r,add:(t,n,i,r)=>t[n*e+i]+=r,dataOffset:(t,n)=>t*e+n,getCoords:(t,n)=>(n[0]=Math.floor(t/e),n[1]=t%e,n)}}throw new Error("bad axis order");case 3:if(0===n[0]&&1===n[1]&&2===n[2]){const e=t[0],n=t[1],i=e*n;return{get:(t,n,r,s)=>t[n+r*e+s*i],set:(t,n,r,s,o)=>t[n+r*e+s*i]=o,add:(t,n,r,s,o)=>t[n+r*e+s*i]+=o,dataOffset:(t,n,r)=>t+n*e+r*i,getCoords:(t,i)=>{const r=Math.floor(t/e);return i[0]=t%e,i[1]=r%n,i[2]=Math.floor(r/n),i}}}if(0===n[0]&&2===n[1]&&1===n[2]){const e=t[0],n=t[2],i=e*n;return{get:(t,n,r,s)=>t[n+s*e+r*i],set:(t,n,r,s,o)=>t[n+s*e+r*i]=o,add:(t,n,r,s,o)=>t[n+s*e+r*i]+=o,dataOffset:(t,n,r)=>t+r*e+n*i,getCoords:(t,i)=>{const r=Math.floor(t/e);return i[0]=t%e,i[1]=Math.floor(r/n),i[2]=r%n,i}}}if(1===n[0]&&0===n[1]&&2===n[2]){const e=t[1],n=t[0],i=e*n;return{get:(t,n,r,s)=>t[r+n*e+s*i],set:(t,n,r,s,o)=>t[r+n*e+s*i]=o,add:(t,n,r,s,o)=>t[r+n*e+s*i]+=o,dataOffset:(t,n,r)=>n+t*e+r*i,getCoords:(t,i)=>{const r=Math.floor(t/e);return i[0]=r%n,i[1]=t%e,i[2]=Math.floor(r/n),i}}}if(1===n[0]&&2===n[1]&&0===n[2]){const e=t[1],n=t[2],i=e*n;return{get:(t,n,r,s)=>t[r+s*e+n*i],set:(t,n,r,s,o)=>t[r+s*e+n*i]=o,add:(t,n,r,s,o)=>t[r+s*e+n*i]+=o,dataOffset:(t,n,r)=>n+r*e+t*i,getCoords:(t,i)=>{const r=Math.floor(t/e);return i[0]=Math.floor(r/n),i[1]=t%e,i[2]=r%n,i}}}if(2===n[0]&&0===n[1]&&1===n[2]){const e=t[2],n=t[0],i=e*n;return{get:(t,n,r,s)=>t[s+n*e+r*i],set:(t,n,r,s,o)=>t[s+n*e+r*i]=o,add:(t,n,r,s,o)=>t[s+n*e+r*i]+=o,dataOffset:(t,n,r)=>r+t*e+n*i,getCoords:(t,i)=>{const r=Math.floor(t/e);return i[0]=r%n,i[1]=Math.floor(r/n),i[2]=t%e,i}}}if(2===n[0]&&1===n[1]&&0===n[2]){const e=t[2],n=t[1],i=e*n;return{get:(t,n,r,s)=>t[s+r*e+n*i],set:(t,n,r,s,o)=>t[s+r*e+n*i]=o,add:(t,n,r,s,o)=>t[s+r*e+n*i]+=o,dataOffset:(t,n,r)=>r+n*e+t*i,getCoords:(t,i)=>{const r=Math.floor(t/e);return i[0]=Math.floor(r/n),i[1]=r%n,i[2]=t%e,i}}}throw new Error("bad axis order");default:return{get:(t,...n)=>t[r(e,n)],set:(t,...n)=>t[r(e,n)]=n[n.length-1],add:(t,...n)=>t[r(e,n)]+=n[n.length-1],dataOffset:(...t)=>r(e,t),getCoords:(t,n)=>function(e,t,n){const{dimensions:i,axisOrderFastToSlow:r}=e,s=i.length;let o=t;for(let e=0;e<s;e++){const t=i[r[e]];n[r[e]]=o%t,o=Math.floor(o/t)}return n[r[s+1]]=o,n}(e,t,n)}}}function i(e){const{dimensions:t}=e;let n=1;for(let e=0,i=t.length;e<i;e++)n*=t[e];return t=>new(t||e.defaultCtor)(n)}function r(e,t){const{accessDimensions:n,axisOrderFastToSlow:i}=e,r=n.length-1;let s=n[r]*t[i[r]];for(let e=r-1;e>=0;e--)s=(s+t[i[e]])*n[e];return s}function s(e,t){const n=[];for(let i=0;i<e.length;i++)n[i]=e[t[i]];return n}e.create=function(e,t){return{space:e,data:t}},e.Space=t,e.Data1=function(e){return e},e.Vector=function(e,n){return t([e],[0],n)},e.ColumnMajorMatrix=function(e,n,i){return t([e,n],[1,0],i)},e.RowMajorMatrix=function(e,n,i){return t([e,n],[0,1],i)},e.toMat4=function(e,t,n){if(2!==t.rank)throw new Error("Invalid tensor rank");const i=Math.min(4,t.dimensions[0]),r=Math.min(4,t.dimensions[1]);for(let s=0;s<i;s++)for(let i=0;i<r;i++)tb.setValue(e,s,i,t.get(n,s,i));return e},e.toMat3=function(e,t,n){if(2!==t.rank)throw new Error("Invalid tensor rank");const i=Math.min(3,t.dimensions[0]),r=Math.min(3,t.dimensions[1]);for(let s=0;s<i;s++)for(let i=0;i<r;i++)nb.setValue(e,s,i,t.get(n,s,i));return e},e.toVec3=function(e,t,n){if(1!==t.rank)throw new Error("Invalid tensor rank");const i=Math.min(3,t.dimensions[0]);for(let t=0;t<i;t++)e[t]=n[t];return e},e.toVec4=function(e,t,n){if(1!==t.rank)throw new Error("Invalid tensor rank");const i=Math.min(4,t.dimensions[0]);for(let t=0;t<i;t++)e[t]=n[t];return e},e.areEqualExact=function(e,t){const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0},e.invertAxisOrder=function(e){const t=[];for(let n=0;n<e.length;n++)t[n]=e[e.length-n-1];return t},e.convertToCanonicalAxisIndicesFastToSlow=function(e){const t=new Int32Array(e.length);for(let n=0;n<e.length;n++)t[e[n]]=n;return e=>s(e,t)},e.convertToCanonicalAxisIndicesSlowToFast=function(e){const t=new Int32Array(e.length);for(let n=0;n<e.length;n++)t[e[e.length-n-1]]=n;return e=>s(e,t)}}(ab||(ab={})),function(e){let t;function n(e,t){return fb(t.T,e,t,1)}function i(e){return mb(e)}!function(e){function t(t,n=e.float){return{"@type":"tensor",T:t.create(),space:t,valueType:"tensor",baseType:n}}e.str={"@type":"str",T:"",valueType:"str"},e.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},e.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},e.int={"@type":"int",T:0,valueType:"int"},e.coord={"@type":"coord",T:0,valueType:"float"},e.float={"@type":"float",T:0,valueType:"float"},e.Str=function(e){var t;return{"@type":"str",T:null!==(t=null==e?void 0:e.defaultValue)&&void 0!==t?t:"",transform:null==e?void 0:e.transform,valueType:"str"}},e.Int=function(e=0){return{"@type":"int",T:e,valueType:"int"}},e.Float=function(e=0){return{"@type":"float",T:e,valueType:"float"}},e.Tensor=t,e.Vector=function(n,i=e.float){return t(ab.Vector(n,"int"===i["@type"]?Int32Array:Float64Array),i)},e.Matrix=function(n,i,r=e.float){return t(ab.ColumnMajorMatrix(n,i,"int"===r["@type"]?Int32Array:Float64Array),r)},e.Aliased=function(e){return e},e.List=function(e,t,n=[]){return{"@type":"list",T:n,separator:e,itemParse:t,valueType:"list"}}}(t=e.Schema||(e.Schema={})),e.is=function(e){return!!e&&!!e.schema&&!!e.value},e.ValueKind={Present:0,NotPresent:1,Unknown:2},e.Undefined=n,e.ofConst=function(e,t,n){return fb(e,t,n,0)},e.ofLambda=i,e.range=function(e,n){return i({value:t=>t+e,rowCount:Math.max(n-e+1,0),schema:t.int})},e.ofArray=function(e){return gb(e)},e.ofIntArray=function(e){return gb({array:e,schema:t.int})},e.ofFloatArray=function(e){return gb({array:e,schema:t.float})},e.ofStringArray=function(e){return gb({array:e,schema:t.str})},e.ofStringAliasArray=function(e){return gb({array:e,schema:t.Aliased(t.str)})},e.ofStringListArray=function(e,n=","){return gb({array:e,schema:t.List(n,(e=>e))})},e.ofIntTokens=function(e){const{count:n,data:i,indices:r}=e;return mb({value:e=>hb(i,r[2*e],r[2*e+1])||0,rowCount:n,schema:t.int})},e.ofFloatTokens=function(e){const{count:n,data:i,indices:r}=e;return mb({value:e=>pb(i,r[2*e],r[2*e+1])||0,rowCount:n,schema:t.float})},e.ofStringTokens=function(e){const{count:n,data:i,indices:r}=e;return mb({value:e=>{const t=i.substring(r[2*e],r[2*e+1]);return"."===t||"?"===t?"":t},rowCount:n,schema:t.str})},e.window=function(e,t,n){return function(e,t,n){return e.isDefined?0===t&&n===e.rowCount?e:e.__array&&Gy(e.__array)?function(e,t,n){const i=jy(e.__array,{start:t,end:n}),r=e.valueKind;return gb({array:i,schema:e.schema,valueKind:e=>r(t+e)})}(e,t,n):function(e,t,n){const i=e.value,r=e.valueKind,s=e.areValuesEqual,o=0===t?i:e=>i(e+t),a=n-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:a,value:o,valueKind:0===t?r:e=>r(e+t),toArray:e=>{const{array:n}=Hy(a,e);for(let e=0,r=n.length;e<r;e++)n[e]=i(e+t);return n},areValuesEqual:0===t?s:(e,n)=>s(e+t,n+t)}}(e,t,n):lb.Undefined(n-t,e.schema)}(e,t,n)},e.view=function(e,t,n=!0){return function(e,t,n){return 0===e.rowCount||n&&function(e,t){if(e.length!==t)return!1;for(let t=0,n=e.length;t<n;t++)if(e[t]!==t)return!1;return!0}(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?function(e,t){const n=e.__array,i=new n.constructor(t.length);for(let e=0,r=t.length;e<r;e++)i[e]=n[t[e]];const r=e.valueKind;return gb({array:i,schema:e.schema,valueKind:e=>r(t[e])})}(e,t):function(e,t){const n=e.value,i=e.valueKind,r=e.areValuesEqual,s=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:e=>n(t[e]),valueKind:e=>i(t[e]),toArray:e=>{const{array:i}=Hy(s,e);for(let e=0,r=i.length;e<r;e++)i[e]=n(t[e]);return i},areValuesEqual:(e,n)=>r(t[e],t[n])}}(e,t)}(e,t,n)},e.createFirstIndexMap=function(e){return function(e){const t=new Map;for(let n=0,i=e.rowCount;n<i;n++){const i=e.value(n);t.has(i)||t.set(e.value(n),n)}return t}(e)},e.createIndexer=function(e){return function(e){const t=new Map;for(let n=0,i=e.rowCount;n<i;n++){const i=e.value(n);t.has(i)||t.set(e.value(n),n)}return e=>t.has(e)?t.get(e):-1}(e)},e.mapToArray=function(e,t,n){return function(e,t,n){const i=new n(e.rowCount);for(let n=0,r=e.rowCount;n<r;n++)i[n]=t(e.value(n));return i}(e,t,n||Array)},e.areEqual=function(e,t){return function(e,t){return e===t||e.rowCount===t.rowCount&&e.isDefined===t.isDefined&&e.schema.valueType===t.schema.valueType&&(e.__array&&t.__array?function(e,t){const n=e.__array,i=t.__array;for(let t=0,r=e.rowCount;t<r;t++)if(n[t]!==i[t])return!1;return!0}(e,t):function(e,t){const n=e.value,i=t.value;for(let t=0,r=e.rowCount;t<r;t++)if(n(t)!==i(t))return!1;return!0}(e,t))}(e,t)},e.indicesOf=function(e,t){return function(e,t){const n=[],i=e.value;for(let r=0,s=e.rowCount;r<s;r++)t(i(r))&&(n[n.length]=r);return n}(e,t)},e.asArrayColumn=function(e,t){return e.__array?e:e.isDefined?gb({array:e.toArray({array:t}),schema:e.schema,valueKind:e.valueKind}):n(e.rowCount,e.schema)},e.copyToArray=function(e,t,n=0){if(!e.isDefined)return;const i=e.__array;if(i)for(let e=0,r=i.length;e<r;e++)t[n+e]=i[e];else for(let i=0,r=e.rowCount;i<r;i++)t[n+i]=e.value(i)},e.isIdentity=function(e){for(let t=0,n=e.rowCount;t<n;t++)if(t!==e.value(t))return!1;return!0}}(lb||(lb={})),function(e){e.create=function(e){return e},e.has=function(e,t){return!!(e&t)},e.hasAll=function(e,t){return!!t&&(e&t)===t}}(cb||(cb={})),function(e){e.create=function(e=512){return{current:[],offset:0,capacity:e,chunks:[]}},e.getString=function(e){return e.chunks.length?(e.offset>0&&(e.chunks[e.chunks.length]=e.current.length===e.offset?e.current.join(""):e.current.slice(0,e.offset).join("")),e.chunks.join("")):e.current.length===e.offset?e.current.join(""):e.current.splice(0,e.offset).join("")},e.getSize=function(e){let t=0;for(const n of e.chunks)t+=n.length;for(let n=0;n<e.offset;n++)t+=e.current[n].length;return t},e.getChunks=function(e){return e.offset>0&&(e.current.length===e.offset?e.chunks[e.chunks.length]=e.current.join(""):e.chunks[e.chunks.length]=e.current.slice(0,e.offset).join(""),e.offset=0),e.chunks};const t=[];function n(e,n){n>0&&i(e,t[n])}function i(e,t){e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t}!function(){let e="";for(let n=0;n<512;n++)t[n]=e,e+=" "}(),e.newline=function(e){i(e,"\n")},e.whitespace=n,e.whitespace1=function(e){i(e," ")},e.write=function(e,t){t&&(e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t)},e.writeSafe=i,e.writePadLeft=function(e,t,r){t?(n(e,r-t.length),i(e,t)):n(e,r)},e.writePadRight=function(e,t,r){if(!t)return void n(e,r);const s=r-t.length;i(e,t),n(e,s)},e.writeInteger=function(e,t){i(e,""+t)},e.writeIntegerAndSpace=function(e,t){i(e,t+" ")},e.writeIntegerPadLeft=function(e,t,r){const s=""+t;n(e,r-s.length),i(e,s)},e.writeIntegerPadRight=function(e,t,r){const s=""+t,o=r-s.length;i(e,s),n(e,o)},e.writeFloat=function(e,t,n){i(e,""+Math.round(n*t)/n)},e.writeFloatPadLeft=function(e,t,r,s){const o=""+Math.round(r*t)/r;n(e,s-o.length),i(e,o)},e.writeFloatPadRight=function(e,t,r,s){const o=""+Math.round(r*t)/r,a=s-o.length;i(e,o),n(e,a)}}(ub||(ub={}));const Tb=function(){if("undefined"!=typeof window&&window.performance){const e=window.performance;return()=>e.now()}return"undefined"!=typeof process&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?()=>{const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();var Eb,Pb,Ib;function kb(e,t){return e-t}function Rb(e=0,t=Number.MAX_SAFE_INTEGER){let n=e;return()=>{const e=n;return n=(n+1)%t,e}}!function(e){const t="undefined"!=typeof btoa?btoa:e=>Buffer.from(e).toString("base64"),n=[];e.create22=function(){let e=+new Date+Tb();for(let t=0;t<16;t++)n[t]=String.fromCharCode((e+255*Math.random())%255|0),e=Math.floor(e/255);return t(n.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},e.createv4=function(){let e=+new Date+Tb();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},e.is=function(e){return"string"==typeof e}}(Eb||(Eb={})),function(e){class t{has(e){return!1}forEach(e,t){return t}constructor(){this.size=0}}class n{has(e){return e===this.idx}forEach(e,t){return e(this.idx,t),t}constructor(e){this.idx=e,this.size=1}}class i{has(e){return e<this.length&&!!this.mask[e]}_forEach(e,t){for(let n=0;n<this.length;n++)this.mask[n]&&e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e,t){this.mask=e,this.size=t,this.length=e.length}}class r{has(e){return!0}_forEach(e,t){for(let n=0;n<this.size;n++)e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.size=e}}class s{has(e){return this.set.has(e)}_forEach(e,t){for(const n of this.flatten())e(n,t)}flatten(){if(this._flat)return this._flat;const e=new Int32Array(this.size);let t=0;return this.set.forEach((n=>e[t++]=n)),function(e){Array.prototype.sort.call(e,kb)}(e),this._flat=e,this._flat}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.set=e,this._flat=void 0,this.size=e.size}}function o(e){return new s(e)}function a(e,t){return new i(e,t)}e.always=function(e){return new r(e)},e.never=new t,e.ofSet=o,e.singleton=function(e){return new n(e)},e.ofUniqueIndices=function(e){const o=e.length;if(0===o)return new t;if(1===o)return new n(e[0]);let a=0;for(const t of e)t>a&&(a=t);if(o===a)return new r(o);if(o/a<1/12){const t=new Set;for(const n of e)t.add(n);return new s(t)}const l=new Int8Array(a+1);for(const t of e)l[t]=1;return new i(l,e.length)},e.ofMask=a,e.hasAny=function(e,t){for(const n of t)if(e.has(n))return!0;return!1},e.complement=function(e,t){let n=0,i=0;if(t.forEach((t=>{e.has(t)||(n++,t>i&&(i=t))})),n/i<1/12){const n=new Set;return t.forEach((t=>{e.has(t)||n.add(t)})),o(n)}{const r=new Uint8Array(i+1);return t.forEach((t=>{e.has(t)||(r[t]=1)})),a(r,n)}}}(Pb||(Pb={})),function(e){e.create=function(e){return{ref:e}},e.set=function(e,t){return e.ref=t,e}}(Ib||(Ib={}));const Db=Rb(0,2147483647);var Lb,Ob,Nb,Fb,Bb;function Ub(e){const{data:t,indices:n}=e;return function(e,i){const r=n[2*e],s=n[2*i],o=n[2*e+1]-r;if(o!==n[2*i+1]-s)return!1;for(let e=0;e<o;e++)if(t.charCodeAt(e+r)!==t.charCodeAt(e+s))return!1;return!0}}function zb(e,t){return{name:t,blocks:e}}function Vb(e,t,n,i=[]){return{categoryNames:e,header:n,categories:t,saveFrames:i,getField(e){const[n,i]=e.split(".");return t[n].getField(i||"")}}}function Hb(e,t,n,i){return{rowCount:t,name:e,fieldNames:[...n],getField:e=>i[e]}}!function(e){e.create=function(e,t){return{id:Db(),version:0,value:e,metadata:t}},e.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}}(Lb||(Lb={})),function(e){function t(e,t){return Ib.set(e,Lb.withValue(e.ref,t))}e.create=function(e,t){return Ib.create(Lb.create(e,t))},e.update=t,e.set=function(e,t){return Ib.set(e,t)},e.updateIfChanged=function(e,n){return e.ref.value!==n?t(e,n):e}}(Ob||(Ob={})),function(e){function t(e,t,n){const i=Object.create(null),r=Object.keys(t);i._rowCount=n.length,i._columns=r,i._schema=t;for(const t of r)i[t]=lb.view(e[t],n);return i}function n(e,t){const n=Object.create(null),{_columns:i}=e;for(let r=0;r<i.length;r++){const s=i[r];n[s]=e[s].value(t)}return n}e.is=function(e){return e&&"number"==typeof e._rowCount&&!!e._columns&&!!e._schema},e.pickColumns=function(e,t,n={}){const i=Object.create(null),r=Object.keys(e);i._rowCount=t._rowCount,i._columns=r,i._schema=e;for(const e of r)if(t[e])i[e]=t[e];else{if(!n[e])throw Error(`Cannot find column '${e}'.`);i[e]=n[e]}return i},e.ofColumns=function(e,t){const n=Object.keys(t);return xa({_rowCount:t[n[0]].rowCount,_columns:n,_schema:e},t)},e.ofPartialColumns=function(e,t,n){const i=Object.create(null),r=Object.keys(e);i._rowCount=n,i._columns=r,i._schema=e;for(const s of r)i[s]=s in t?t[s]:lb.Undefined(n,e[s]);return i},e.ofUndefinedColumns=function(e,t){const n=Object.create(null),i=Object.keys(e);n._rowCount=t,n._columns=i,n._schema=e;for(const r of i)n[r]=lb.Undefined(t,e[r]);return n},e.ofRows=function(e,t){const n=Object.create(null),i=t.length,r=Object.keys(e);n._rowCount=i,n._columns=r,n._schema=e;for(const s of r)n[s]=lb.ofLambda({rowCount:i,schema:e[s],value:e=>t[e][s],valueKind:e=>void 0===t[e][s]?1:0});return n},e.ofArrays=function(e,t){var n;const i=Object.create(null),r=Object.keys(e);i._rowCount=0,i._columns=r,i._schema=e;for(const s of r)void 0!==t[s]?(i[s]=lb.ofArray({array:t[s],schema:e[s]}),i._rowCount=null===(n=t[s])||void 0===n?void 0:n.length):i[s]=lb.Undefined(i._rowCount,e[s]);return i},e.view=t,e.pick=function(e,n,i){const r=[];for(let t=0,n=e._rowCount;t<n;++t)i(t)&&r.push(t);return t(e,n,r)},e.window=function(e,t,n,i){if(0===n&&i===e._rowCount)return e;const r=Object.create(null),s=Object.keys(t);r._rowCount=i-n,r._columns=s,r._schema=t;for(const t of s)r[t]=lb.window(e[t],n,i);return r},e.concat=function(e,t){const n=Object.create(null),i=Object.keys(t);n._rowCount=0;for(const t of e)n._rowCount+=t._rowCount;const r={};for(const e of i)r[e]=new Array(n._rowCount);n._columns=i,n._schema=t;let s=0;for(const t of e){for(const e of i)lb.copyToArray(t[e],r[e],s);s+=t._rowCount}for(const e of i)n[e]=lb.ofArray({array:r[e],schema:t[e]});return n},e.columnToArray=function(e,t,n){e[t]=lb.asArrayColumn(e[t],n)},e.sort=function(e,t){const n=new Int32Array(e._rowCount);for(let e=0,t=n.length;e<t;e++)n[e]=e;Cb(n,((e,n,i)=>t(n,i)));let i=!0;for(let e=0,t=n.length;e<t;e++)if(n[e]!==e){i=!1;break}if(i)return e;const r=Object.create(null);r._rowCount=e._rowCount,r._columns=e._columns,r._schema=e._schema;for(const t of e._columns)r[t]=lb.view(e[t],n,!1);return r},e.areEqual=function(e,t){if(e._rowCount!==t._rowCount)return!1;if(e._columns.length!==t._columns.length)return!1;for(const n of e._columns)if(!t[n])return!1;for(const n of e._columns)if(!lb.areEqual(e[n],t[n]))return!1;return!0},e.getRow=n,e.pickRow=function(e,t){for(let i=0,r=e._rowCount;i<r;++i)if(t(i))return n(e,i)},e.getRows=function(e){const t=[],{_rowCount:i}=e;for(let r=0;r<i;r++)t[r]=n(e,r);return t},e.toArrays=function(e){const t={},{_columns:n}=e;for(let i=0;i<n.length;i++){const r=n[i];t[r]=e[r].toArray()}return t},e.formatToString=function(e){const t=ub.create(),{_columns:n,_rowCount:i}=e;let r=1;ub.write(t,"|");for(let e=0;e<n.length;e++)ub.write(t,n[e]),ub.write(t,"|"),r+=n[e].length+1;ub.newline(t),ub.write(t,new Array(r+1).join("-")),ub.newline(t);for(let r=0;r<i;r++){ub.write(t,"|");for(let i=0;i<n.length;i++){const s=e[n[i]];0===s.valueKind(r)?(ub.write(t,s.value(r)),ub.write(t,"|")):ub.write(t,".|")}ub.newline(t)}return ub.getString(t)}}(Nb||(Nb={})),function(e){e.ofTables=function(e,t,n){const i=Object.keys(n),r=Object.create(null),s=[];r._name=e,r._tableNames=s,r._schema=t;for(const e of i)Nb.is(n[e])&&(r[e]=n[e],s[s.length]=e);return r},e.getTablesAsRows=function(e){const t={};for(const n of e._tableNames)t[n]=Nb.getRows(e[n]);return t}}(Fb||(Fb={})),function(e){function t(e,t){const n=Object.keys(t);return{rowCount:n.length>0?t[n[0]].rowCount:0,name:e,fieldNames:n,getField:e=>t[e]}}e.empty=function(e){return{rowCount:0,name:e,fieldNames:[],getField(e){}}},e.ofFields=t,e.ofTable=function(e,n){const i={};for(const e of n._columns)i[e]=Bb.ofColumn(n[e]);return t(e,i)}}(Hb||(Hb={})),function(e){function t(e){const t=e.length,n=t=>{const n=e[t];return n&&"."!==n&&"?"!==n?n:""},i=t=>{const n=e[t];return hb(n,0,n.length)||0},r=t=>{const n=e[t];return pb(n,0,n.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:i,float:r,valueKind:t=>{const n=e[t],i=n.length;if(i>1)return 0;if(0===i)return 1;const r=n.charCodeAt(0);return 46===r?1:63===r?2:0},areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:i=>i?$y(t,n,i):e,toIntArray:e=>$y(t,i,e),toFloatArray:e=>$y(t,r,e)}}function n(e){const{rowCount:t,valueKind:n,areValuesEqual:i,isDefined:r}=e;let s,o,a;switch(e.schema.valueType){case"float":case"int":s=t=>""+e.value(t),o=e.value,a=e.value;break;case"str":s=e.value,o=t=>{const n=e.value(t);return hb(n,0,n.length)||0},a=t=>{const n=e.value(t);return pb(n,0,n.length)||0};break;case"list":const{separator:t}=e.schema;s=n=>e.value(n).join(t),o=e=>NaN,a=e=>NaN;break;default:throw new Error(`unsupported valueType '${e.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:r,rowCount:t,str:s,int:o,float:a,valueKind:n,areValuesEqual:i,toStringArray:e=>$y(t,s,e),toIntArray:e=>$y(t,o,e),toFloatArray:e=>$y(t,a,e)}}e.ofString=function(e){return t([e])},e.ofStrings=t,e.ofNumbers=function(e){const t=e.length,n=t=>""+e[t],i=t=>e[t],r=n=>!n||n.array&&e instanceof n.array?e:$y(t,i,n);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:i,float:i,valueKind:e=>0,areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:e=>$y(t,n,e),toIntArray:r,toFloatArray:r}},e.ofTokens=function(e){const{data:t,indices:n,count:i}=e,r=e=>{const i=t.substring(n[2*e],n[2*e+1]);return"."===i||"?"===i?"":i},s=e=>hb(t,n[2*e],n[2*e+1])||0,o=e=>pb(t,n[2*e],n[2*e+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:r,int:s,float:o,valueKind:e=>{const i=n[2*e],r=n[2*e+1]-i;if(r>1)return 0;if(0===r)return 1;const s=t.charCodeAt(i);return 46===s?1:63===s?2:0},areValuesEqual:Ub(e),toStringArray:e=>$y(i,r,e),toIntArray:e=>$y(i,s,e),toFloatArray:e=>$y(i,o,e)}},e.ofColumn=n,e.ofUndefined=function(e,t){return n(lb.Undefined(e,t))}}(Bb||(Bb={}));const $b="undefined"!=typeof setImmediate?"undefined"!=typeof window?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate,clearImmediate}:function(){const e=function(){const e="undefined"!=typeof window&&window,t="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i=void 0!==n.g&&n.g;return e||i||t}(),t={},i="undefined"!=typeof document?document:void 0;let r,s=1;function o(e){delete t[e]}function a(e){const n=t[e];o(e),function(e){const t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(n)}return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?r=function(e){process.nextTick((function(){a(e)}))}:function(){if(e&&e.postMessage&&!e.importScripts){let t=!0;const n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){const t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n),r=function(e){window.postMessage(t+e,"*")}}():"undefined"!=typeof MessageChannel?function(){const e=new MessageChannel;e.port1.onmessage=function(e){a(e.data)},r=function(t){e.port2.postMessage(t)}}():i&&"onreadystatechange"in i.createElement("script")?function(){const e=i.documentElement;r=function(t){let n=i.createElement("script");n.onreadystatechange=function(){a(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():r=function(e){setTimeout(a,0,e)},{setImmediate:function(e,...n){"function"!=typeof e&&(e=new Function(""+e));const i={callback:e,args:n};return t[s]=i,r(s),s++},clearImmediate:o}}();function Gb(e){$b.setImmediate(e)}$b.setImmediate,$b.clearImmediate;!function(){try{return!0}catch(e){return!1}}(),function(){try{const e=process.env.DEBUG;return"*"===e||"molstar"===e}catch(e){return!1}}();const jb="undefined"!=typeof performance&&!!performance.mark&&performance.measure&&!1;var Wb;function qb(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function Xb(e){return t=>{e.abortRequested=!0,e.reason=t||e.reason}}function Yb(e){return{progress:xa({},e.progress),children:e.children.map(Yb)}}function Kb(e){return e.progress.canAbort&&e.children.every(Kb)}async function Zb(e,t){Wb.markStart(e),t.node.progress.startedTime=Tb();try{const n=await e.f(t);return Wb.markEnd(e),Wb.measure(e),t.info.abortToken.abortRequested&&Qb(t.info),n}catch(n){throw ix.isAbort(n)&&(t.isAborted=!0,t.node.children.length>0&&await new Promise((e=>{t.onChildrenFinished=e})),e.onAbort&&e.onAbort()),n}}function Qb(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,Jb(e.root),ex(e,Tb())),ix.Aborted(e.abortToken.reason)}function Jb(e){const t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(const t of e.children)Jb(t)}function ex(e,t){e.lastNotified=t;const n=function(e){return{root:Yb(e.root),canAbort:Kb(e.root),requestAbort:e.tryAbort}}(e);e.observer(n)}!function(e){function t(e){return`startTask${e.id}`}function n(e){return`endTask${e.id}`}e.markStart=function(e){jb&&performance.mark(t(e))},e.markEnd=function(e){jb&&performance.mark(n(e))},e.measure=function(e){jb&&performance.measure(`✳️ ${e.name}`,t(e),n(e))}}(Wb||(Wb={}));class tx{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,Qb(this.info))}get shouldUpdate(){return this.checkAborted(),Tb()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const t=this.node.progress;"string"==typeof e?(t.message=e,t.isIndeterminate=!0):(void 0!==e.canAbort&&(t.canAbort=e.canAbort),void 0!==e.message&&(t.message=e.message),void 0!==e.current&&(t.current=e.current),void 0!==e.max&&(t.max=e.max),t.isIndeterminate=void 0===t.current||void 0===t.max,void 0!==e.isIndeterminate&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=Tb(),this.updateProgress(e),!t)return ex(this.info,this.lastUpdatedTime),this.checkAborted(),new Promise(Gb)}async runChild(e,t){this.updateProgress(t);const n={progress:qb(e),children:[]},i=this.node.children;i.push(n);const r=new tx(this.info,n);try{return await Zb(e,r)}catch(e){if(ix.isAbort(e)&&this.isAborted)return;throw e}finally{const e=i.indexOf(n);if(e>=0){for(let t=e,n=i.length-1;t<n;t++)i[t]=i[t+1];i.pop()}0===i.length&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}const nx=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(e,t){}};var ix,rx,sx,ox,ax,lx;async function cx(e,t,n,i,r){let s=Math.max(t,0),o=0,a=0;if(e.isSynchronous)return i(Number.MAX_SAFE_INTEGER,n),n;let l=Tb(),c=0,u=0;for(;(c=i(s,n))>0;){o+=c;const t=Tb()-l;u+=t,a+=t,e.shouldUpdate&&(await r(e,n,o),s=Math.round(u*o/a)+1,l=Tb(),u=0)}return e.shouldUpdate&&await r(e,n,o),n}function ux(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function hx(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position}function dx(e){return!(e.length-e.position<2)&&39===e.data.charCodeAt(e.position+1)&&39===e.data.charCodeAt(e.position+2)}function px(e,t,n){let i;const r=n-t,s=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<r)return!1;for(i=t;i<n;++i)if(e.data.charCodeAt(i)!==e.data.charCodeAt(i+s))return!1;return r===o||46===e.data.charCodeAt(i+s)}function fx(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return t;return t}function mx(e,t){return e.data.substring(e.tokenStart,t)}function gx(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function _x(e){const t=function(e){let t=10;for(;e.position<e.length;){const n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:13!==t&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t}(e);if(e.position>=e.length)return void(e.tokenType=6);e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;const n=e.data.charCodeAt(e.position);switch(n){case 35:!function(e){for(;e.position<e.length;){const t=e.data.charCodeAt(e.position);if(10===t||13===t)return;++e.position}}(e),e.tokenType=5;break;case 39:if(dx(e)){!function(e){for(e.position+=3;e.position<e.length;){if(39===e.data.charCodeAt(e.position)&&dx(e))return e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,void(e.position+=3);++e.position}e.tokenEnd=e.position}(e),e.tokenType=3;break}case 34:!function(e,t){let n,i;for(++e.position;e.position<e.length;)if(i=e.data.charCodeAt(e.position),i===t)switch(n=e.data.charCodeAt(e.position+1),n){case 9:case 10:case 13:case 32:return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;default:if(void 0===n)return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;++e.position}else{if(10===i||13===i)return void(e.tokenEnd=e.position);++e.position}e.tokenEnd=e.position}(e,n),e.tokenType=3;break;case 59:10===t||13===t?function(e){let t,n=59,i=e.position+1;for(;i<e.length;){if(t=e.data.charCodeAt(i),59===t&&(10===n||13===n)){for(e.position=i+1,e.tokenStart++,i--,t=e.data.charCodeAt(i);10===t||13===t;)i--,t=e.data.charCodeAt(i);return e.tokenEnd=i+1,void(e.isEscaped=!0)}(13===t||10===t&&13!==n)&&e.lineNumber++,n=t,++i}e.position=i}(e):hx(e),e.tokenType=3;break;default:e.isImportGet?function(e){for(;e.position<e.length;){if(93===e.data.charCodeAt(e.position))return++e.position,e.tokenEnd=e.position,void(e.isImportGet=!1);++e.position}}(e):hx(e),e.isEscaped?e.tokenType=3:95===e.data.charCodeAt(e.tokenStart)?(e.inSaveFrame&&function(e){return e.tokenEnd-e.tokenStart==11&&105===e.data.charCodeAt(e.tokenStart+1)&&109===e.data.charCodeAt(e.tokenStart+2)&&112===e.data.charCodeAt(e.tokenStart+3)&&111===e.data.charCodeAt(e.tokenStart+4)&&114===e.data.charCodeAt(e.tokenStart+5)&&116===e.data.charCodeAt(e.tokenStart+6)&&46===e.data.charCodeAt(e.tokenStart+7)&&103===e.data.charCodeAt(e.tokenStart+8)&&101===e.data.charCodeAt(e.tokenStart+9)&&116===e.data.charCodeAt(e.tokenStart+10)}(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&95===e.data.charCodeAt(e.tokenStart+4)?function(e){let t=e.data.charCodeAt(e.tokenStart);return!(68!==t&&100!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t||(t=e.data.charCodeAt(e.tokenStart+2),84!==t&&116!==t||(t=e.data.charCodeAt(e.tokenStart+3),65!==t&&97!==t))))}(e)?e.tokenType=0:function(e){let t=e.data.charCodeAt(e.tokenStart);return!(83!==t&&115!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t||(t=e.data.charCodeAt(e.tokenStart+2),86!==t&&118!==t||(t=e.data.charCodeAt(e.tokenStart+3),69!==t&&101!==t))))}(e)?e.tokenType=1:function(e){if(e.tokenEnd-e.tokenStart!=5)return!1;let t=e.data.charCodeAt(e.tokenStart);return!(76!==t&&108!==t||(t=e.data.charCodeAt(e.tokenStart+1),79!==t&&111!==t||(t=e.data.charCodeAt(e.tokenStart+2),79!==t&&111!==t||(t=e.data.charCodeAt(e.tokenStart+3),80!==t&&112!==t))))}(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3}}function vx(e){for(_x(e);5===e.tokenType;)_x(e)}function yx(){return{categoryNames:[],categoryData:Object.create(null)}}function bx(e,t){const n=Object.create(null);for(const i of e){const e=t[i];n[i]=Hb(e.name,e.rowCount,e.fieldNames,e.fields)}return n}function xx(e,t,n){return Vb(e.categoryNames,bx(e.categoryNames,e.categoryData),t,n)}function wx(e,t){return Vb(e.categoryNames,bx(e.categoryNames,e.categoryData),t)}function Sx(e,t,n,i,r){if(t in e.categoryData){const n=e.categoryData[t];n.fieldNames.push(...i),Object.assign(n.fields,r)}else e.categoryData[t]={name:t,rowCount:n,fieldNames:i,fields:r},e.categoryNames.push(t)}function Ax(e,t){const n=e.tokenStart,i=fx(e),r=mx(e,i),s=Object.create(null),o=[];let a=!0;for(;a;){if(4!==e.tokenType||!px(e,n,i)){a=!1;break}const t=gx(e).substring(r.length+1);if(vx(e),3!==e.tokenType)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};s[t]=Bb.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=t,vx(e)}return Sx(t,r.substr(1),1,o,s),{hasError:!1,errorLine:0,errorMessage:""}}function Mx(e,t){const{tokenizer:n,tokens:i,fieldCount:r}=t;let s=t.tokenCount,o=0;for(;3===n.tokenType&&o<e;)ox.add(i[s++%r],n.tokenStart,n.tokenEnd),vx(n),o++;return t.tokenCount=s,o}function Cx(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}async function Tx(e,t){const n=e.lineNumber;vx(e);const i=mx(e,fx(e)),r=function(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return!1;return!0}(e),s=[];for(;4===e.tokenType;)s[s.length]=r?gx(e):gx(e).substring(i.length+1),vx(e);const o="_atom_site"===i?e.data.length/100|0:32,a=[],l=s.length;for(let t=0;t<l;t++)a[t]=ox.create(e.data,o);const c={fieldCount:l,tokenCount:0,tokenizer:e,tokens:a};if(await cx(e.runtimeCtx,1e6,c,Mx,Cx),c.tokenCount%l!=0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${n} is not a multiple of the number of columns.`};const u=c.tokenCount/l|0;if(r)for(let e=0;e<l;e++){const n={"":Bb.ofTokens(a[e])};Sx(t,s[e].substr(1),u,[""],n)}else{const e=Object.create(null);for(let t=0;t<l;t++)e[s[t]]=Bb.ofTokens(a[t]);Sx(t,i.substr(1),u,s,e)}return{hasError:!1,errorLine:0,errorMessage:""}}function Ex(e,t){return ax.error(t,e)}function Px(e){return ix.create("Parse CIF",(async t=>await async function(e,t){const n=[],i=function(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}(e,t);let r="",s=yx(),o=[],a=yx();const l=function(e,t){return{categoryNames:e,header:"",categories:t}}(a.categoryNames,bx(a.categoryNames,a.categoryData));let c="";for(t.update({message:"Parsing...",current:0,max:e.length}),vx(i);6!==i.tokenType;){const t=i.tokenType;if(0===t){if(i.inSaveFrame)return Ex(i.lineNumber,"Unexpected data block inside a save frame.");s.categoryNames.length>0&&n.push(xx(s,r,o)),r=e.substring(i.tokenStart+5,i.tokenEnd),s=yx(),o=[],vx(i)}else if(1===t){if(i.tokenEnd-i.tokenStart==5)a.categoryNames.length>0&&(o[o.length]=wx(a,c)),i.inSaveFrame=!1;else{if(i.inSaveFrame)return Ex(i.lineNumber,"Save frames cannot be nested.");i.inSaveFrame=!0,c=e.substring(i.tokenStart+5,i.tokenEnd),a=yx()}vx(i)}else if(2===t){const e=await Tx(i,i.inSaveFrame?a:s);if(e.hasError)return Ex(e.errorLine,e.errorMessage)}else{if(4!==t)return console.log(i.tokenType,ux.getTokenString(i)),Ex(i.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const e=Ax(i,i.inSaveFrame?a:s);if(e.hasError)return Ex(e.errorLine,e.errorMessage)}}}return i.inSaveFrame?Ex(i.lineNumber,`Unfinished save frame (${l.header}).`):((s.categoryNames.length>0||o.length>0)&&n.push(xx(s,r,o)),function(e){return ax.success(e)}(zb(n)))}(e,t)))}!function(e){class t{run(e,t=250){return e?function(e,t,n=250){const i=function(e,t,n){const i={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:n,lastNotified:Tb(),observer:t,abortToken:i,taskId:e.id,root:{progress:qb(e),children:[]},tryAbort:Xb(i)}}(e,t,n);return Zb(e,new tx(i,i.root))}(this,e,t):this.f(nx)}runAsChild(e,t){return e.isSynchronous?this.f(nx):function(e,t,n){return e.runChild(t,n)}(e,this,t)}runInContext(e){return e.isSynchronous?this.f(nx):function(e,t){return Zb(t,e)}(e,this)}constructor(e,t,n){this.name=e,this.f=t,this.onAbort=n,this.id=r()}}function n(e){const t=e;return!!e&&"number"==typeof t.id&&"string"==typeof t.name&&!!t.run}function i(e,n,i){return new t(e,n,i)}e.is=n,e.isAbort=function(e){return!!e&&!!e.isAborted},e.Aborted=function(e){return{isAborted:!0,reason:e,toString:()=>"Aborted"+(e?": "+e:"")}},e.create=i,e.constant=function(e,t){return i(e,(async e=>t))},e.empty=function(){return i("",(async e=>{}))},e.fail=function(e,t){return i(e,(async e=>{throw new Error(t)}))},e.resolveInContext=function(e,t){return n(e)?t?e.runInContext(t):e.run():e};const r=Rb(0,1073741823)}(ix||(ix={})),function(e){e.Synchronous=nx}(rx||(rx={})),function(e){function t(e,n=""){const i=e.progress;if(!e.children.length)return i.isIndeterminate?`${n}${i.taskName}: ${i.message}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;const r=n+"  |_ ",s=e.children.map((e=>t(e,r)));return i.isIndeterminate?`${n}${i.taskName}: ${i.message}\n${s.join("\n")}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}\n${s.join("\n")}`}e.format=function(e){return t(e.root)}}(sx||(sx={})),function(e){function t(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function n(e){const{data:t}=e;for(;e.position<e.length;)switch(t.charCodeAt(e.position)){case 10:return e.tokenEnd=e.position,++e.position,++e.lineNumber,!0;case 13:return e.tokenEnd=e.position,++e.position,++e.lineNumber,10===t.charCodeAt(e.position)&&++e.position,!0;default:++e.position}return e.tokenEnd=e.position,e.tokenStart!==e.tokenEnd}function i(e){return e.tokenStart=e.position,n(e)}function r(e,t,n){let r=0;for(let s=0;s<t;s++){if(!i(e))return r;ox.addUnchecked(n,e.tokenStart,e.tokenEnd),r++}return r}function s(e,t,n){const{data:i}=e;let r=t,s=n-1,o=i.charCodeAt(r);for(;(9===o||32===o)&&r<=s;)o=i.charCodeAt(++r);for(o=i.charCodeAt(s);(9===o||32===o)&&s>=r;)o=i.charCodeAt(--s);return e.tokenStart=r,e.tokenEnd=s+1,e.position=n,e}e.getTokenString=t,e.reset=function(e){e.position=0,e.lineNumber=1,e.tokenStart=0,e.tokenEnd=0},e.eatLine=n,e.markStart=function(e){e.tokenStart=e.position},e.markLine=i,e.readLine=function(e){return i(e),t(e)},e.readLineTrim=function(e){i(e);const n=e.position;return s(e,e.tokenStart,e.tokenEnd),e.position=n,t(e)},e.markLines=function(e,t){const n=ox.create(e.data,2*t);return r(e,t,n),n},e.readLines=function(t,n){const i=[];for(let r=0;r<n;r++)i.push(e.readLine(t));return i},e.readLinesAsync=async function(e,t,n,i=1e5){const s=ox.create(e.data,2*t);let o=0;return await cx(n,i,e,((e,n)=>{const i=Math.min(t-o,e);return r(n,i,s),o+=i,i}),((e,t)=>e.update({message:"Parsing...",current:t.position,max:t.length}))),s},e.readAllLines=function(t){const n=e(t),r=ox.create(n.data,Math.max(t.length/80,2));for(;i(n);)ox.add(r,n.tokenStart,n.tokenEnd);return r},e.readAllLinesAsync=async function(t,n,r=1e5){const s=e(t),o=ox.create(s.data,Math.max(t.length/80,2));return await cx(n,r,s,((e,t)=>(function(e,t,n){let r=0;for(let s=0;s<t;s++){if(!i(e))return r;ox.add(n,e.tokenStart,e.tokenEnd),r++}}(t,e,o),t.position<t.length?e:0)),((e,t)=>e.update({message:"Parsing...",current:t.position,max:t.length}))),o},e.eatValue=function(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position},e.skipWhitespace=function(e){let t=-1;for(;e.position<e.length;){const n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:13!==t&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t},e.trim=s}(ux||(ux={})),function(e){function t(e,t,n){const i=e;i.offset>i.indicesLenMinus2&&function(e){const t=new Uint32Array(1.61*e.indices.length|0);t.set(e.indices),e.indices=t,e.indicesLenMinus2=t.length-2|0}(i),i.indices[i.offset++]=t,i.indices[i.offset++]=n,e.count++}e.add=t,e.addToken=function(e,n){t(e,n.tokenStart,n.tokenEnd)},e.addUnchecked=function(e,t,n){e.indices[e.offset++]=t,e.indices[e.offset++]=n,e.count++},e.create=function(e,t){return{data:e,indicesLenMinus2:(t=Math.max(10,t))-2|0,count:0,offset:0,indices:new Uint32Array(t)}}}(ox||(ox={})),function(e){e.error=function(e,n=-1){return new t(e,n)},e.success=function(e,t=[]){return new n(e,t)};class t{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(e,t){this.message=e,this.line=t,this.isError=!0}}e.Error=t;class n{constructor(e,t){this.result=e,this.warnings=t,this.isError=!1}}e.Success=n}(ax||(ax={})),function(e){var t,n;(t=e.IntDataType||(e.IntDataType={}))[t.Int8=1]="Int8",t[t.Int16=2]="Int16",t[t.Int32=3]="Int32",t[t.Uint8=4]="Uint8",t[t.Uint16=5]="Uint16",t[t.Uint32=6]="Uint32",(n=e.FloatDataType||(e.FloatDataType={}))[n.Float32=32]="Float32",n[n.Float64=33]="Float64",e.getDataType=function(t){let n;return n=t instanceof Int8Array?e.IntDataType.Int8:t instanceof Int16Array?e.IntDataType.Int16:t instanceof Int32Array?e.IntDataType.Int32:t instanceof Uint8Array?e.IntDataType.Uint8:t instanceof Uint16Array?e.IntDataType.Uint16:t instanceof Uint32Array?e.IntDataType.Uint32:t instanceof Float32Array?e.FloatDataType.Float32:t instanceof Float64Array?e.FloatDataType.Float64:e.IntDataType.Int32,n},e.isSignedIntegerDataType=function(e){if(e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array)return!0;for(let t=0,n=e.length;t<n;t++)if(t<0)return!1;return!0}}(lx||(lx={}));const Ix=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0];function kx(e){let t=e.data;for(let n=e.encoding.length-1;n>=0;n--)t=Rx(t,e.encoding[n]);return t}function Rx(e,t){switch(t.kind){case"ByteArray":switch(t.type){case lx.IntDataType.Uint8:return e;case lx.IntDataType.Int8:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case lx.IntDataType.Int16:return function(e){return Ox(e,2,Int16Array)}(e);case lx.IntDataType.Uint16:return function(e){return Ox(e,2,Uint16Array)}(e);case lx.IntDataType.Int32:return function(e){return Ox(e,4,Int32Array)}(e);case lx.IntDataType.Uint32:return function(e){return Ox(e,4,Uint32Array)}(e);case lx.FloatDataType.Float32:return function(e){return Ox(e,4,Float32Array)}(e);case lx.FloatDataType.Float64:return function(e){return Ox(e,8,Float64Array)}(e);default:sb(t.type)}case"FixedPoint":return function(e,t){const n=e.length,i=Lx(t.srcType,n),r=1/t.factor;for(let t=0;t<n;t++)i[t]=r*e[t];return i}(e,t);case"IntervalQuantization":return function(e,t){const n=e.length,i=Lx(t.srcType,n),r=(t.max-t.min)/(t.numSteps-1),s=t.min;for(let t=0;t<n;t++)i[t]=s+r*e[t];return i}(e,t);case"RunLength":return function(e,t){const n=Dx(t.srcType,t.srcSize);let i=0;for(let t=0,r=e.length;t<r;t+=2){const r=e[t],s=e[t+1];for(let e=0;e<s;++e)n[i++]=r}return n}(e,t);case"Delta":return function(e,t){const n=e.length,i=Dx(t.srcType,n);if(!n)return e;i[0]=e[0]+(0|t.origin);for(let t=1;t<n;++t)i[t]=e[t]+i[t-1];return i}(e,t);case"IntegerPacking":return function(e,t){return e.length===t.srcSize?e:t.isUnsigned?function(e,t){const n=1===t.byteCount?255:65535,i=e.length,r=new Int32Array(t.srcSize);let s=0,o=0;for(;s<i;){let t=0,i=e[s];for(;i===n;)t+=i,s++,i=e[s];t+=i,r[o]=t,s++,o++}return r}(e,t):function(e,t){const n=1===t.byteCount?127:32767,i=-n-1,r=e.length,s=new Int32Array(t.srcSize);let o=0,a=0;for(;o<r;){let t=0,r=e[o];for(;r===n||r===i;)t+=r,o++,r=e[o];t+=r,s[a]=t,o++,a++}return s}(e,t)}(e,t);case"StringArray":return function(e,t){const n=kx({encoding:t.offsetEncoding,data:t.offsets}),i=kx({encoding:t.dataEncoding,data:e}),r=t.stringData,s=new Array(n.length);s[0]="";for(let e=1,t=n.length;e<t;e++)s[e]=r.substring(n[e-1],n[e]);let o=0;const a=new Array(i.length);for(let e=0,t=i.length;e<t;e++)a[o++]=s[i[e]+1];return a}(e,t)}}function Dx(e,t){switch(e){case lx.IntDataType.Int8:return new Int8Array(t);case lx.IntDataType.Int16:return new Int16Array(t);case lx.IntDataType.Int32:return new Int32Array(t);case lx.IntDataType.Uint8:return new Uint8Array(t);case lx.IntDataType.Uint16:return new Uint16Array(t);case lx.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function Lx(e,t){switch(e){case lx.FloatDataType.Float32:return new Float32Array(t);case lx.FloatDataType.Float64:default:return new Float64Array(t)}}function Ox(e,t,n){return new n(Ix?e.buffer:function(e,t){const n=new ArrayBuffer(e.length),i=new Uint8Array(n);for(let n=0,r=e.length;n<r;n+=t)for(let r=0;r<t;r++)i[n+t-r-1]=e[n+r];return n}(e,t))}var Nx,Fx,Bx,Ux,zx;function Vx(e,t,n){let i,r=1;for(i=0;i<t;i++){const t=r*e;if(Math.abs(Math.round(t)-t)<=n)return i;r*=10}return-1}function Hx(e){return Fx.classify(e)}!function(e){function t(e){const t=e.growBy*e.elementSize;e.currentSize=t,e.currentIndex=0,e.currentChunk=new e.ctor(t),e.allocatedSize+=t,e.chunks[e.chunks.length]=e.currentChunk}function n(e,t){const{ctor:n,chunks:i,currentIndex:r}=e;if(!i.length)return new n(0);if(1===i.length&&(t||r===e.allocatedSize))return i[0];let s=0;for(let e=0,t=i.length-1;e<t;e++)s+=i[e].length;s+=e.currentIndex;const o=new n(s);let a=0;if(o.buffer)for(let e=0,t=i.length-1;e<t;e++)o.set(i[e],a),a+=i[e].length;else for(let e=0,t=i.length-1;e<t;e++){const t=i[e];for(let e=0,n=t.length;e<n;e++)o[a+e]=t[e];a+=t.length}const l=i[i.length-1];if(o.buffer&&r>=e.currentSize)o.set(l,a);else for(let e=0,t=l.length;e<t;e++)o[a+e]=l[e];return o}e.is=function(e){return e.creator&&e.chunkSize},e.add4=function(e,n,i,r,s){e.currentIndex>=e.currentSize&&t(e);const o=e.currentChunk,a=e.currentIndex;return o[a]=n,o[a+1]=i,o[a+2]=r,o[a+3]=s,e.currentIndex+=4,e.elementCount++},e.add3=function(e,n,i,r){e.currentIndex>=e.currentSize&&t(e);const s=e.currentChunk,o=e.currentIndex;return s[o]=n,s[o+1]=i,s[o+2]=r,e.currentIndex+=3,e.elementCount++},e.add2=function(e,n,i){e.currentIndex>=e.currentSize&&t(e);const r=e.currentChunk,s=e.currentIndex;return r[s]=n,r[s+1]=i,e.currentIndex+=2,e.elementCount++},e.add=function(e,n){return e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex]=n,e.currentIndex+=1,e.elementCount++},e.addRepeat=function(e,n,i){for(let r=0;r<n;r++)e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex++]=i,e.elementCount++;return e.elementCount},e.addMany=function(e,n){const{elementSize:i}=e;for(let r=0,s=n.length;r<s;r+=i){e.currentIndex>=e.currentSize&&t(e);const{currentChunk:s}=e;for(let t=0;t<i;t++)s[e.currentIndex++]=n[r+t];e.elementCount++}return e.elementCount},e.compact=function(e,t=!1){return n(e,t)},e._compact=n,e.create=function(e,t,n,i){const r={ctor:e,elementSize:t,growBy:Math.max(1,Math.ceil(n)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(void 0===i)return r;if("number"==typeof i)return r.currentChunk=new e(i*t),r.allocatedSize=i*t,r.currentSize=r.currentChunk.length,r.chunks[0]=r.currentChunk,r;const s=i;if(s.length%t!=0)throw new Error("initialChunk length must be a multiple of the element size.");return r.currentChunk=s,r.allocatedSize=s.length,r.currentSize=s.length,r.chunks[0]=s,r}}(Nx||(Nx={})),function(e){function t(e,t){return e>=0?Math.ceil((e+1)/t):Math.ceil((e+1)/(-t-1))}function n({limit8:e,limit16:n},i,r){i.pack8+=t(r,e),i.pack16+=t(r,n),i.count+=1}function i(e,n){e.pack8+=t(n,127),e.pack16+=t(n,32767),e.count+=1}function r(e){return 4*e.count<2*e.pack16?{length:4*e.count,elem:4}:2*e.pack16<e.pack8?{length:2*e.pack16,elem:2}:{length:e.pack8,elem:1}}function s(e,t){const i={pack8:0,pack16:0,count:0};for(let r=0,s=e.length;r<s;r++)n(t,i,e[r]);return xa(xa({},r(i)),{},{kind:"pack"})}function o(e,t){const n={pack8:0,pack16:0,count:0};let s=e[0];for(let t=1,r=e.length;t<r;t++)i(n,e[t]-s),s=e[t];return xa(xa({},r(n)),{},{kind:"delta"})}function a(e,t){const i={pack8:0,pack16:0,count:0};let s=1;for(let r=1,o=e.length;r<o;r++)e[r-1]!==e[r]?(n(t,i,e[r-1]),n(t,i,s),s=1):s++;return n(t,i,e[e.length-1]),n(t,i,s),xa(xa({},r(i)),{},{kind:"rle"})}function l(e,t){const n={pack8:0,pack16:0,count:0};let s=1,o=0,a=0;for(let t=1,r=e.length;t<r;t++){const r=e[t]-o;a!==r?(i(n,a),i(n,s),s=1):s++,a=r,o=e[t]}return i(n,a),i(n,s),xa(xa({},r(n)),{},{kind:"delta-rle"})}function c(e){const t=function(e){let t=!1;for(let n=0,i=e.length;n<i;n++)if(e[n]<0){t=!0;break}return t?{signed:t,limit8:127,limit16:32767}:{signed:t,limit8:255,limit16:65535}}(e),n=[s(e,t),a(e,t),o(e),l(e)];return n.sort(((e,t)=>e.length-t.length)),n}e.getSize=c,e.classify=function(e){if(e.length<2)return zx.by(zx.byteArray);switch(c(e)[0].kind){case"pack":return zx.by(zx.integerPacking);case"rle":return zx.by(zx.runLength).and(zx.integerPacking);case"delta":return zx.by(zx.delta).and(zx.integerPacking);case"delta-rle":return zx.by(zx.delta).and(zx.runLength).and(zx.integerPacking);default:sb()}}}(Fx||(Fx={})),function(e){e.classify=function(e){const{mantissaDigits:t,integerDigits:n}=function(e,t,n){let i=1,r=0;for(let t=0,s=e.length;t<s;t++){if(i>=0){const r=Vx(e[t],4,n);r<0?i=-1:r>i&&(i=r)}const s=Math.abs(e[t]);if(s>n){const e=Math.floor(Math.log10(Math.abs(s)))+1;e>r&&(r=e)}}return{mantissaDigits:i,integerDigits:r}}(e,0,1e-6);if(t<0||t+n>10)return zx.by(zx.byteArray);if(0===t)return Fx.classify(e);const i=function(e){let t=1;for(let n=0;n<e;n++)t*=10;return t}(t),r=new Int32Array(e.length);for(let t=0,n=e.length;t<n;t++)r[t]=Math.round(i*e[t]);const s=Fx.getSize(r)[0],o=zx.by(zx.fixedPoint(i));switch(s.kind){case"pack":return o.and(zx.integerPacking);case"rle":return o.and(zx.runLength).and(zx.integerPacking);case"delta":return o.and(zx.delta).and(zx.integerPacking);case"delta-rle":return o.and(zx.delta).and(zx.runLength).and(zx.integerPacking);default:sb()}}}(Bx||(Bx={}));class $x{and(e){return new $x(this.providers.concat([e]))}encode(e){const t=[];for(const n of this.providers){const i=n(e);if(!i.encodings.length)throw new Error("Encodings must be non-empty.");e=i.data;for(const e of i.encodings)t.push(e)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}}constructor(e){this.providers=e}}!function(e){function t(e){return new $x([e])}function n(e){switch(e.kind){case"ByteArray":return zx.byteArray;case"FixedPoint":return zx.fixedPoint(e.factor);case"IntervalQuantization":return zx.intervalQuantizaiton(e.min,e.max,e.numSteps);case"RunLength":return zx.runLength;case"Delta":return zx.delta;case"IntegerPacking":return zx.integerPacking;case"StringArray":return zx.stringArray}}e.by=t,e.fromEncoding=function(e){let i=t(n(e[0]));for(let t=1;t<e.length&&"IntegerPacking"!==e[t-1].kind;t++)i=i.and(n(e[t]));return i}}(Ux||(Ux={})),function(e){e.by=function(e){return new $x([e])};const t={[lx.IntDataType.Int16]:function(e,t,n){e.setInt16(2*t,n,!0)},[lx.IntDataType.Uint16]:function(e,t,n){e.setUint16(2*t,n,!0)},[lx.IntDataType.Int32]:function(e,t,n){e.setInt32(4*t,n,!0)},[lx.IntDataType.Uint32]:function(e,t,n){e.setUint32(4*t,n,!0)},[lx.FloatDataType.Float32]:function(e,t,n){e.setFloat32(4*t,n,!0)},[lx.FloatDataType.Float64]:function(e,t,n){e.setFloat64(8*t,n,!0)}},n={[lx.IntDataType.Int16]:2,[lx.IntDataType.Uint16]:2,[lx.IntDataType.Int32]:4,[lx.IntDataType.Uint32]:4,[lx.FloatDataType.Float32]:4,[lx.FloatDataType.Float64]:8};function i(e){const i=lx.getDataType(e);if(i===lx.IntDataType.Int8)return function(e){return{encodings:[{kind:"ByteArray",type:lx.IntDataType.Int8}],data:new Uint8Array(e.buffer,e.byteOffset)}}(e);if(i===lx.IntDataType.Uint8)return function(e){return{encodings:[{kind:"ByteArray",type:lx.IntDataType.Uint8}],data:e}}(e);const r=new Uint8Array(e.length*n[i]),s=t[i],o=new DataView(r.buffer);for(let t=0,n=e.length;t<n;t++)s(o,t,e[t]);return{encodings:[{kind:"ByteArray",type:i}],data:r}}function r(e,t){let n=0;for(let i=0,r=e.length;i<r;i++)n+=e[i]/t|0;return n+=e.length,n}function s(e,t){const n=-t-1;let i=0;for(let r=0,s=e.length;r<s;r++){const s=e[r];i+=s>=0?s/t|0:s/n|0}return i+=e.length,i}e.byteArray=i,e.fixedPoint=function(e){return t=>function(e,t){const n=lx.getDataType(e),i=new Int32Array(e.length);for(let n=0,r=e.length;n<r;n++)i[n]=Math.round(e[n]*t);return{encodings:[{kind:"FixedPoint",factor:t,srcType:n}],data:i}}(t,e)},e.intervalQuantizaiton=function(e,t,n,i=Int32Array){return r=>function(e,t,n,i,r){const s=lx.getDataType(e);if(!e.length)return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:i,srcType:s}],data:new Int32Array(0)};if(n<t){const e=t;t=n,n=e}const o=(n-t)/(i-1),a=new r(e.length);for(let r=0,s=e.length;r<s;r++){const s=e[r];a[r]=s<=t?0:s>=n?i-1:0|Math.round((s-t)/o)}return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:i,srcType:s}],data:a}}(r,e,t,n,i)},e.runLength=function(e){let t=lx.getDataType(e);if(void 0===t&&(e=new Int32Array(e),t=lx.IntDataType.Int32),!e.length)return{encodings:[{kind:"RunLength",srcType:t,srcSize:0}],data:new Int32Array(0)};let n=2;for(let t=1,i=e.length;t<i;t++)e[t-1]!==e[t]&&(n+=2);const i=new Int32Array(n);let r=0,s=1;for(let t=1,n=e.length;t<n;t++)e[t-1]!==e[t]?(i[r]=e[t-1],i[r+1]=s,s=1,r+=2):++s;return i[r]=e[e.length-1],i[r+1]=s,{encodings:[{kind:"RunLength",srcType:t,srcSize:e.length}],data:i}},e.delta=function(e){if(!lx.isSignedIntegerDataType(e))throw new Error("Only signed integer types can be encoded using delta encoding.");let t=lx.getDataType(e);if(void 0===t&&(e=new Int32Array(e),t=lx.IntDataType.Int32),!e.length)return{encodings:[{kind:"Delta",origin:0,srcType:t}],data:new e.constructor(0)};const n=new e.constructor(e.length),i=e[0];n[0]=e[0];for(let t=1,i=e.length;t<i;t++)n[t]=e[t]-e[t-1];return n[0]=0,{encodings:[{kind:"Delta",origin:i,srcType:t}],data:n}},e.integerPacking=function(e){const t=function(e){const t=function(e){for(let t=0,n=e.length;t<n;t++)if(e[t]<0)return!0;return!1}(e),n=t?s(e,127):r(e,255),i=t?s(e,32767):r(e,65535);return 4*e.length<2*i?{isSigned:t,size:e.length,bytesPerElement:4}:2*i<n?{isSigned:t,size:i,bytesPerElement:2}:{isSigned:t,size:n,bytesPerElement:1}}(e);return 4===t.bytesPerElement?i(e):function(e,t){const n=t.isSigned?1===t.bytesPerElement?127:32767:1===t.bytesPerElement?255:65535,r=-n-1,s=e.length,o=t.isSigned?1===t.bytesPerElement?new Int8Array(t.size):new Int16Array(t.size):1===t.bytesPerElement?new Uint8Array(t.size):new Uint16Array(t.size);let a=0;for(let t=0;t<s;t++){let i=e[t];if(i>=0)for(;i>=n;)o[a]=n,++a,i-=n;else for(;i<=r;)o[a]=r,++a,i-=r;o[a]=i,++a}const l=i(o);return{encodings:[{kind:"IntegerPacking",byteCount:t.bytesPerElement,isUnsigned:!t.isSigned,srcSize:s},l.encodings[0]],data:l.data}}(e,t)},e.stringArray=function(e){const t=Object.create(null),n=[],i=new Int32Array(e.length),r=Nx.create(Int32Array,1,Math.min(1024,e.length<32?e.length+1:Math.round(e.length/8)+1));Nx.add(r,0);let s=0,o=0;for(const a of e){if(null==a){i[o++]=-1;continue}let e=t[a];void 0===e&&(s+=a.length,e=n.length,n[e]=a,t[a]=e,Nx.add(r,s)),i[o++]=e}const a=Nx.compact(r),l=Hx(a).encode(a),c=Hx(i).encode(i);return{encodings:[{kind:"StringArray",dataEncoding:c.encoding,stringData:n.join(""),offsetEncoding:l.encoding,offsets:l.data}],data:c.data}}}(zx||(zx={}));const Gx=function(){const e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function jx(e){throw new Error(e)}const Wx="undefined"!=typeof TextDecoder?new TextDecoder:void 0;function qx(e,t){const n={};for(let i=0;i<t;i++)n[Zx(e)]=Zx(e);return n}function Xx(e,t){const n=new Uint8Array(t),i=e.offset;for(let r=0;r<t;r++)n[r]=e.buffer[r+i];return e.offset+=t,n}function Yx(e,t){const n=function(e,t,n){if(Wx){const i=t||n!==e.length?e.subarray(t,t+n):e;return Wx.decode(i)}return function(e,t,n){const i=Gx;let r,s=0;const o=[];for(let a=t,l=t+n;a<l;a++){const t=e[a];128&t?192==(224&t)?o[s++]=i[(15&t)<<6|63&e[++a]]:224==(240&t)?o[s++]=String.fromCharCode((15&t)<<12|(63&e[++a])<<6|63&e[++a]):240==(248&t)?o[s++]=String.fromCharCode((7&t)<<18|(63&e[++a])<<12|(63&e[++a])<<6|63&e[++a]):jx("Invalid byte "+t.toString(16)):o[s++]=i[t],512===s&&(r=r||[],r[r.length]=o.join(""),s=0)}return r?(s>0&&(r[r.length]=o.slice(0,s).join("")),r.join("")):o.slice(0,s).join("")}(e,t,n)}(e.buffer,e.offset,t);return e.offset+=t,n}function Kx(e,t){const n=new Array(t);for(let i=0;i<t;i++)n[i]=Zx(e);return n}function Zx(e){const t=e.buffer[e.offset];let n,i;if(!(128&t))return e.offset++,t;if(128==(240&t))return i=15&t,e.offset++,qx(e,i);if(144==(240&t))return i=15&t,e.offset++,Kx(e,i);if(160==(224&t))return i=31&t,e.offset++,Yx(e,i);if(!(224&~t))return n=e.dataView.getInt8(e.offset),e.offset++,n;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return i=e.dataView.getUint8(e.offset+1),e.offset+=2,Xx(e,i);case 197:return i=e.dataView.getUint16(e.offset+1),e.offset+=3,Xx(e,i);case 198:return i=e.dataView.getUint32(e.offset+1),e.offset+=5,Xx(e,i);case 202:return n=e.dataView.getFloat32(e.offset+1),e.offset+=5,n;case 203:return n=e.dataView.getFloat64(e.offset+1),e.offset+=9,n;case 204:return n=e.buffer[e.offset+1],e.offset+=2,n;case 205:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,n;case 206:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,n;case 208:return n=e.dataView.getInt8(e.offset+1),e.offset+=2,n;case 209:return n=e.dataView.getInt16(e.offset+1),e.offset+=3,n;case 210:return n=e.dataView.getInt32(e.offset+1),e.offset+=5,n;case 217:return i=e.dataView.getUint8(e.offset+1),e.offset+=2,Yx(e,i);case 218:return i=e.dataView.getUint16(e.offset+1),e.offset+=3,Yx(e,i);case 219:return i=e.dataView.getUint32(e.offset+1),e.offset+=5,Yx(e,i);case 220:return i=e.dataView.getUint16(e.offset+1),e.offset+=3,Kx(e,i);case 221:return i=e.dataView.getUint32(e.offset+1),e.offset+=5,Kx(e,i);case 222:return i=e.dataView.getUint16(e.offset+1),e.offset+=3,qx(e,i);case 223:return i=e.dataView.getUint32(e.offset+1),e.offset+=5,qx(e,i)}throw new Error("Unknown type 0x"+t.toString(16))}function Qx(e){const t=Object.create(null),n=Object.create(null);for(const n of e.columns)t[n.name]=n;return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map((e=>e.name)),getField(e){const i=t[e];if(i)return n[e]||(n[e]=function(e){const t=e.mask?kx(e.mask):void 0,n=kx(e.data),i=Gy(n),r=i?t?e=>0===t[e]?""+n[e]:"":e=>""+n[e]:t?e=>0===t[e]?n[e]:"":e=>n[e],s=i?e=>n[e]:e=>{const t=n[e];return hb(t,0,t.length)},o=i?e=>n[e]:e=>{const t=n[e];return pb(t,0,t.length)},a=t?e=>t[e]:e=>0,l=n.length;return{__array:n,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:l,str:r,int:s,float:o,valueKind:a,areValuesEqual:(e,t)=>n[e]===n[t],toStringArray:e=>$y(l,r,e),toIntArray:i?e=>jy(n,e):e=>$y(l,s,e),toFloatArray:i?e=>jy(n,e):e=>$y(l,o,e)}}(i)),n[e]}}}function Jx(e){return ix.create("Parse BinaryCIF",(async t=>{const n=[0,3];try{const t=Zx({buffer:i=e,offset:0,dataView:new DataView(i.buffer)});if(!function(e,t){for(let n=0;n<2;n++)if(e[n]>t[n])return!1;return!0}(n,t.version.match(/(\d)\.(\d)\.\d/).slice(1).map((e=>+e))))return ax.error(`Unsupported format version. Current ${t.version}, required ${n.join(".")}.`);const r=zb(t.dataBlocks.map((e=>{const t=Object.create(null);for(const n of e.categories)t[n.name.substr(1)]=Qx(n);return Vb(e.categories.map((e=>e.name.substr(1))),t,e.header)})));return ax.success(r)}catch(e){return ax.error(""+e)}var i}))}var ew;function tw(e,t,n){return function(e,t,n){const i=Object.create(null);for(const r of Object.keys(e))i[r]=lw(r,e[r],t,n);return Fb.ofTables(t.header,e,i)}(e,t,n)}function nw(e){switch(e.valueType){case"str":return(t,n,i)=>function(e,t,n,i){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:"lowercase"===e.transform?e=>n(e).toLowerCase():"uppercase"===e.transform?e=>n(e).toUpperCase():n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:"lowercase"===e.transform?e=>Array.from(i(e)).map((e=>e.toLowerCase())):"uppercase"===e.transform?e=>Array.from(i(e)).map((e=>e.toUpperCase())):i}}(e,t,t.str,t.toStringArray);case"int":return(t,n,i)=>iw(e,t,t.int,t.toIntArray);case"float":return(t,n,i)=>iw(e,t,t.float,t.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function iw(e,t,n,i){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:i}}function rw(e,t,n){const i=e.separator,r=e.itemParse,s=t.getField(n),o=s?e=>s.str(e).split(i).map((e=>r(e.trim()))).filter((e=>!!e)):e=>[];return{schema:e,__array:void 0,isDefined:!!s,rowCount:t.rowCount,value:o,valueKind:s?s.valueKind:()=>1,areValuesEqual:(e,t)=>function(e,t){const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}(o(e),o(t)),toArray:e=>$y(t.rowCount,o,e)}}function sw(e,t,n){const i=e.space,r=t.fieldNames.includes(`${n}[0]`)||t.fieldNames.includes(`${n}[0][0]`)||t.fieldNames.includes(`${n}[0][0][0]`),s=r?0:1,o=t.fieldNames.includes(`${n}_1`)||t.fieldNames.includes(`${n}_11`)||t.fieldNames.includes(`${n}_111`)?"underscore":"brackets",a=function(e,t,n,i){const r=n?0:1;switch(t){case 1:return"brackets"===i?t=>`${e}[${t+r}]`:t=>`${e}_${t+r}`;case 2:return"brackets"===i?(t,n)=>`${e}[${t+r}][${n+r}]`:(t,n)=>`${e}_${t+r}${n+r}`;case 3:return"brackets"===i?(t,n,i)=>`${e}[${t+r}][${n+r}][${i+r}]`:(t,n,i)=>`${e}_${t+r}${n+r}${i+r}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(n,i.rank,r,o),l=t.getField(a(s,s,s))||lb.Undefined(t.rowCount,e),c=e=>function(e,t,n,i){const r=t.create();if(1===t.rank){const s=t.dimensions[0];for(let o=0;o<s;o++){const s=e.getField(i(o));t.set(r,o,s?s.float(n):0)}}else if(2===t.rank){const s=t.dimensions[0],o=t.dimensions[1];for(let a=0;a<s;a++)for(let s=0;s<o;s++){const o=e.getField(i(a,s));t.set(r,a,s,o?o.float(n):0)}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const s=t.dimensions[0],o=t.dimensions[1],a=t.dimensions[2];for(let l=0;l<s;l++)for(let s=0;s<o;s++)for(let o=0;o<a;o++){const a=e.getField(i(l,s,o));t.set(r,l,s,o,a?a.float(n):0)}}}return r}(t,i,e,a);return{schema:e,__array:void 0,isDefined:l.isDefined,rowCount:t.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(e,t)=>ab.areEqualExact(c(e),c(t)),toArray:e=>$y(t.rowCount,c,e)}}!function(e){function t(e){return e.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t,e.equal=function(e,n){return t(e)===t(n)},e.create=function(e,n,i=!1){const r=`${e}${n?`.${n}`:""}`;return i?t(r):r}}(ew||(ew={}));class ow{constructor(e,t,n){this._isDefined=n;const i=Object.keys(t);this._rowCount=e.rowCount,this._columns=i,this._schema=t;const r=Object.create(null);for(const n of i)Object.defineProperty(this,n,{get:function(){if(r[n])return r[n];const i=t[n];if("list"===i.valueType)r[n]=rw(i,e,n);else if("tensor"===i.valueType)r[n]=sw(i,e,n);else{const t=nw(i),s=e.getField(n);r[n]=s?t(s,e,n):lb.Undefined(e.rowCount,i)}return r[n]},enumerable:!0,configurable:!1})}}function aw(e,t,n,i){const r=ew.create(t,e),s=ew.canonical(r);if(s in n)return n[s];if(i&&r in i)for(const e of i[r]){const t=ew.canonical(e);if(t in n)return n[t]}}function lw(e,t,n,i){let r=n.categories[e];if(i){const s=function(e){const t=Object.create(null);for(const n of Object.keys(e.categories))for(const i of e.categories[n].fieldNames)t[ew.create(n,i,!0)]=e.categories[n].getField(i);return t}(n),o=Object.create(null),a=[];let l=0;for(const n of Object.keys(t)){const t=aw(n,e,s,i);t&&(o[n]=t,a.push(n),l=t.rowCount)}r={rowCount:l,name:e,fieldNames:[...a],getField:e=>o[e]}}return new ow(r||Hb.empty(e),t,!!r)}var cw=lb.Schema;const uw=cw.str,hw=cw.int,dw=cw.float,pw=cw.coord,fw=cw.Aliased,mw=cw.Matrix,gw=cw.Vector,_w=cw.lstr,vw=cw.List,yw={atom_site:{auth_asym_id:uw,auth_atom_id:uw,auth_comp_id:uw,auth_seq_id:hw,B_iso_or_equiv:dw,Cartn_x:pw,Cartn_y:pw,Cartn_z:pw,group_PDB:fw(uw),id:hw,label_alt_id:uw,label_asym_id:uw,label_atom_id:uw,label_comp_id:uw,label_entity_id:uw,label_seq_id:hw,occupancy:dw,type_symbol:uw,pdbx_PDB_ins_code:uw,pdbx_PDB_model_num:hw,pdbx_formal_charge:hw,pdbx_label_index:hw,pdbx_sifts_xref_db_name:uw,pdbx_sifts_xref_db_acc:uw,pdbx_sifts_xref_db_num:uw,pdbx_sifts_xref_db_res:uw,ihm_model_id:hw},atom_site_anisotrop:{id:hw,type_symbol:uw,U:mw(3,3),U_esd:mw(3,3),pdbx_auth_seq_id:uw,pdbx_auth_asym_id:uw,pdbx_auth_atom_id:uw,pdbx_auth_comp_id:uw,pdbx_label_seq_id:hw,pdbx_label_alt_id:uw,pdbx_label_asym_id:uw,pdbx_label_atom_id:uw,pdbx_label_comp_id:uw,pdbx_PDB_ins_code:uw},atom_sites:{entry_id:uw,fract_transf_matrix:mw(3,3),fract_transf_vector:gw(3)},audit_author:{name:uw,pdbx_ordinal:hw,identifier_ORCID:uw},audit_conform:{dict_location:uw,dict_name:uw,dict_version:uw},cell:{angle_alpha:dw,angle_beta:dw,angle_gamma:dw,entry_id:uw,length_a:dw,length_b:dw,length_c:dw,Z_PDB:hw,pdbx_unique_axis:uw},chem_comp:{formula:uw,formula_weight:dw,id:uw,mon_nstd_flag:fw(_w),name:uw,type:fw(_w),pdbx_synonyms:vw(";",(e=>e))},chem_comp_bond:{atom_id_1:uw,atom_id_2:uw,comp_id:uw,value_order:fw(_w),pdbx_ordinal:hw,pdbx_stereo_config:fw(_w),pdbx_aromatic_flag:fw(_w)},citation:{book_publisher:uw,country:uw,id:uw,journal_abbrev:uw,journal_id_ASTM:uw,journal_id_CSD:uw,journal_id_ISSN:uw,journal_volume:uw,page_first:uw,page_last:uw,title:uw,year:hw,pdbx_database_id_DOI:uw,pdbx_database_id_PubMed:hw},citation_author:{citation_id:uw,name:uw,ordinal:hw},database_2:{database_id:fw(_w),database_code:uw},entity:{details:uw,formula_weight:dw,id:uw,src_method:fw(_w),type:fw(_w),pdbx_description:vw(",",(e=>e)),pdbx_number_of_molecules:hw,pdbx_mutation:uw,pdbx_fragment:uw,pdbx_ec:vw(",",(e=>e))},entity_poly:{entity_id:uw,nstd_linkage:fw(_w),nstd_monomer:fw(_w),type:fw(uw),pdbx_strand_id:vw(",",(e=>e)),pdbx_seq_one_letter_code:uw,pdbx_seq_one_letter_code_can:uw,pdbx_target_identifier:uw},entity_poly_seq:{entity_id:uw,hetero:fw(_w),mon_id:uw,num:hw},entry:{id:uw},exptl:{entry_id:uw,method:fw(uw)},software:{classification:uw,date:uw,description:uw,name:uw,type:fw(_w),version:uw,pdbx_ordinal:hw},struct:{entry_id:uw,title:uw,pdbx_descriptor:uw},struct_asym:{details:uw,entity_id:uw,id:uw,pdbx_modified:uw,pdbx_blank_PDB_chainid_flag:fw(uw)},struct_conf:{beg_label_asym_id:uw,beg_label_comp_id:uw,beg_label_seq_id:hw,beg_auth_asym_id:uw,beg_auth_comp_id:uw,beg_auth_seq_id:hw,conf_type_id:fw(_w),details:uw,end_label_asym_id:uw,end_label_comp_id:uw,end_label_seq_id:hw,end_auth_asym_id:uw,end_auth_comp_id:uw,end_auth_seq_id:hw,id:uw,pdbx_beg_PDB_ins_code:uw,pdbx_end_PDB_ins_code:uw,pdbx_PDB_helix_class:uw,pdbx_PDB_helix_length:hw,pdbx_PDB_helix_id:uw},struct_conn:{conn_type_id:fw(_w),details:uw,id:uw,ptnr1_label_asym_id:uw,ptnr1_label_atom_id:uw,ptnr1_label_comp_id:uw,ptnr1_label_seq_id:hw,ptnr1_auth_asym_id:uw,ptnr1_auth_comp_id:uw,ptnr1_auth_seq_id:hw,ptnr1_symmetry:uw,ptnr2_label_asym_id:uw,ptnr2_label_atom_id:uw,ptnr2_label_comp_id:uw,ptnr2_label_seq_id:hw,ptnr2_auth_asym_id:uw,ptnr2_auth_comp_id:uw,ptnr2_auth_seq_id:hw,ptnr2_symmetry:uw,pdbx_ptnr1_PDB_ins_code:uw,pdbx_ptnr1_label_alt_id:uw,pdbx_ptnr1_standard_comp_id:uw,pdbx_ptnr2_PDB_ins_code:uw,pdbx_ptnr2_label_alt_id:uw,pdbx_ptnr3_PDB_ins_code:uw,pdbx_ptnr3_label_alt_id:uw,pdbx_ptnr3_label_asym_id:uw,pdbx_ptnr3_label_atom_id:uw,pdbx_ptnr3_label_comp_id:uw,pdbx_ptnr3_label_seq_id:hw,pdbx_PDB_id:uw,pdbx_dist_value:dw,pdbx_value_order:fw(_w)},struct_conn_type:{criteria:uw,id:fw(_w),reference:uw},struct_keywords:{entry_id:uw,text:vw(",",(e=>e)),pdbx_keywords:uw},struct_ncs_oper:{code:fw(uw),details:uw,id:hw,matrix:mw(3,3),vector:gw(3)},struct_sheet_range:{beg_label_asym_id:uw,beg_label_comp_id:uw,beg_label_seq_id:hw,end_label_asym_id:uw,end_label_comp_id:uw,end_label_seq_id:hw,beg_auth_asym_id:uw,beg_auth_comp_id:uw,beg_auth_seq_id:hw,end_auth_asym_id:uw,end_auth_comp_id:uw,end_auth_seq_id:hw,id:uw,sheet_id:uw,pdbx_beg_PDB_ins_code:uw,pdbx_end_PDB_ins_code:uw},struct_site:{details:uw,id:uw,pdbx_num_residues:hw,pdbx_evidence_code:uw,pdbx_auth_asym_id:uw,pdbx_auth_comp_id:uw,pdbx_auth_seq_id:uw,pdbx_auth_ins_code:uw},struct_site_gen:{details:uw,id:uw,label_alt_id:uw,label_asym_id:uw,label_atom_id:uw,label_comp_id:uw,label_seq_id:hw,auth_asym_id:uw,auth_comp_id:uw,auth_seq_id:uw,site_id:uw,symmetry:uw,pdbx_auth_ins_code:uw,pdbx_num_res:hw},symmetry:{entry_id:uw,cell_setting:fw(_w),Int_Tables_number:hw,space_group_name_Hall:uw,"space_group_name_H-M":uw},pdbx_database_status:{status_code:fw(uw),status_code_sf:fw(uw),status_code_mr:fw(uw),entry_id:uw,recvd_initial_deposition_date:uw,SG_entry:fw(_w),deposit_site:fw(uw),process_site:fw(uw),status_code_cs:fw(uw),methods_development_category:fw(uw),pdb_format_compatible:fw(_w)},pdbx_nonpoly_scheme:{asym_id:uw,entity_id:uw,mon_id:uw,pdb_strand_id:uw,ndb_seq_num:uw,pdb_seq_num:uw,auth_seq_num:uw,pdb_mon_id:uw,auth_mon_id:uw,pdb_ins_code:uw},pdbx_database_related:{db_name:uw,details:uw,db_id:uw,content_type:fw(uw)},pdbx_entity_nonpoly:{entity_id:uw,comp_id:uw,name:uw},pdbx_chem_comp_synonyms:{name:uw,comp_id:uw,provenance:fw(uw)},pdbx_chem_comp_identifier:{comp_id:uw,identifier:uw,type:fw(uw),program:uw,program_version:uw},pdbx_unobs_or_zero_occ_residues:{id:hw,polymer_flag:fw(_w),occupancy_flag:fw(hw),PDB_model_num:hw,auth_asym_id:uw,auth_comp_id:uw,auth_seq_id:uw,PDB_ins_code:uw,label_asym_id:uw,label_comp_id:uw,label_seq_id:hw},pdbx_struct_mod_residue:{id:hw,auth_asym_id:uw,auth_comp_id:uw,auth_seq_id:hw,PDB_ins_code:uw,label_asym_id:uw,label_comp_id:uw,label_seq_id:hw,parent_comp_id:uw,details:uw},pdbx_struct_oper_list:{id:uw,type:fw(uw),name:uw,symmetry_operation:uw,matrix:mw(3,3),vector:gw(3)},pdbx_struct_assembly:{method_details:uw,oligomeric_details:uw,oligomeric_count:hw,details:uw,id:uw},pdbx_struct_assembly_gen:{asym_id_list:vw(",",(e=>e)),assembly_id:uw,oper_expression:uw},pdbx_reference_entity_list:{prd_id:uw,ref_entity_id:uw,type:fw(_w),details:uw,component_id:hw},pdbx_reference_entity_link:{link_id:hw,prd_id:uw,details:uw,ref_entity_id_1:uw,ref_entity_id_2:uw,entity_seq_num_1:hw,entity_seq_num_2:hw,comp_id_1:uw,comp_id_2:uw,atom_id_1:uw,atom_id_2:uw,value_order:fw(_w),component_1:hw,component_2:hw,link_class:fw(uw)},pdbx_reference_entity_poly_link:{link_id:hw,prd_id:uw,ref_entity_id:uw,component_id:hw,entity_seq_num_1:hw,entity_seq_num_2:hw,comp_id_1:uw,comp_id_2:uw,atom_id_1:uw,atom_id_2:uw,value_order:fw(_w)},pdbx_molecule:{prd_id:uw,instance_id:hw,asym_id:uw},pdbx_molecule_features:{prd_id:uw,class:fw(_w),type:fw(_w),name:uw,details:uw},entity_src_nat:{entity_id:uw,pdbx_organism_scientific:uw,pdbx_plasmid_name:uw,pdbx_src_id:hw,pdbx_beg_seq_num:hw,pdbx_end_seq_num:hw},entity_src_gen:{entity_id:uw,pdbx_gene_src_gene:vw(",",(e=>e)),pdbx_gene_src_scientific_name:uw,plasmid_name:uw,pdbx_src_id:hw,pdbx_beg_seq_num:hw,pdbx_end_seq_num:hw},pdbx_entity_src_syn:{organism_scientific:uw,entity_id:uw,pdbx_src_id:hw,pdbx_beg_seq_num:hw,pdbx_end_seq_num:hw},pdbx_entity_branch_descriptor:{entity_id:uw,descriptor:uw,type:fw(_w),program:uw,program_version:uw,ordinal:hw},pdbx_entity_instance_feature:{details:uw,feature_type:fw(uw),auth_asym_id:uw,asym_id:uw,auth_seq_num:uw,seq_num:hw,comp_id:uw,auth_comp_id:uw,ordinal:hw},pdbx_entity_branch_list:{entity_id:uw,hetero:fw(_w),comp_id:uw,num:hw},pdbx_entity_branch_link:{link_id:hw,details:uw,entity_id:uw,entity_branch_list_num_1:hw,entity_branch_list_num_2:hw,comp_id_1:uw,comp_id_2:uw,atom_id_1:uw,leaving_atom_id_1:uw,atom_stereo_config_1:fw(_w),atom_id_2:uw,leaving_atom_id_2:uw,atom_stereo_config_2:fw(_w),value_order:fw(_w)},pdbx_entity_branch:{entity_id:uw,type:fw(uw)},pdbx_branch_scheme:{entity_id:uw,hetero:fw(_w),asym_id:uw,mon_id:uw,num:hw,pdb_asym_id:uw,pdb_seq_num:uw,pdb_mon_id:uw,auth_asym_id:uw,auth_seq_num:uw,auth_mon_id:uw},pdbx_chem_comp_related:{comp_id:uw,related_comp_id:uw,relationship_type:fw(uw),details:uw},ihm_starting_model_details:{starting_model_id:uw,entity_id:uw,entity_description:uw,asym_id:uw,entity_poly_segment_id:hw,starting_model_source:fw(uw),starting_model_auth_asym_id:uw,starting_model_sequence_offset:hw,dataset_list_id:hw},ihm_starting_comparative_models:{id:hw,starting_model_id:uw,starting_model_auth_asym_id:uw,starting_model_seq_id_begin:hw,starting_model_seq_id_end:hw,template_auth_asym_id:uw,template_seq_id_begin:hw,template_seq_id_end:hw,template_sequence_identity:dw,template_sequence_identity_denominator:fw(hw),template_dataset_list_id:hw,alignment_file_id:hw},ihm_starting_model_seq_dif:{id:hw,entity_id:uw,asym_id:uw,seq_id:hw,comp_id:uw,starting_model_id:uw,db_asym_id:uw,db_seq_id:hw,db_comp_id:uw,details:uw},ihm_model_representation:{id:hw,name:uw,details:uw},ihm_model_representation_details:{id:hw,representation_id:hw,entity_poly_segment_id:hw,entity_id:uw,entity_description:uw,entity_asym_id:uw,model_object_primitive:fw(uw),starting_model_id:uw,model_mode:fw(uw),model_granularity:fw(uw),model_object_count:hw},ihm_struct_assembly_details:{id:hw,assembly_id:hw,parent_assembly_id:hw,entity_description:uw,entity_id:uw,asym_id:uw,entity_poly_segment_id:hw},ihm_struct_assembly:{id:hw,name:uw,description:uw},ihm_modeling_protocol:{id:hw,num_steps:hw,protocol_name:uw},ihm_modeling_protocol_details:{id:hw,protocol_id:hw,step_id:hw,struct_assembly_id:hw,dataset_group_id:hw,struct_assembly_description:uw,step_name:uw,step_method:uw,num_models_begin:hw,num_models_end:hw,multi_scale_flag:fw(_w),multi_state_flag:fw(_w),ordered_flag:fw(_w),script_file_id:hw,software_id:hw},ihm_multi_state_modeling:{state_id:hw,state_group_id:hw,population_fraction:dw,population_fraction_sd:dw,state_type:uw,state_name:uw,experiment_type:fw(uw),details:uw},ihm_modeling_post_process:{id:hw,protocol_id:hw,analysis_id:hw,step_id:hw,type:fw(uw),feature:fw(uw),num_models_begin:hw,num_models_end:hw},ihm_ensemble_info:{ensemble_id:hw,ensemble_name:uw,post_process_id:hw,model_group_id:hw,ensemble_clustering_method:fw(uw),ensemble_clustering_feature:fw(uw),num_ensemble_models:hw,num_ensemble_models_deposited:hw,ensemble_precision_value:dw,ensemble_file_id:hw},ihm_model_list:{model_id:hw,model_name:uw,assembly_id:hw,protocol_id:hw,representation_id:hw},ihm_model_group:{id:hw,name:uw,details:uw},ihm_model_group_link:{model_id:hw,group_id:hw},ihm_model_representative:{id:hw,model_group_id:hw,model_id:hw,selection_criteria:fw(uw)},ihm_dataset_list:{id:hw,data_type:fw(uw),database_hosted:fw(_w)},ihm_dataset_group:{id:hw,name:uw,application:fw(uw),details:uw},ihm_dataset_group_link:{dataset_list_id:hw,group_id:hw},ihm_related_datasets:{dataset_list_id_derived:hw,dataset_list_id_primary:hw},ihm_dataset_related_db_reference:{id:hw,dataset_list_id:hw,db_name:fw(uw),accession_code:uw,version:uw,details:uw},ihm_external_reference_info:{reference_id:hw,reference_provider:uw,reference_type:fw(uw),reference:uw,refers_to:fw(uw),associated_url:uw},ihm_external_files:{id:hw,reference_id:hw,file_path:uw,content_type:fw(uw),file_size_bytes:dw,details:uw},ihm_dataset_external_reference:{id:hw,dataset_list_id:hw,file_id:hw},ihm_localization_density_files:{id:hw,file_id:hw,ensemble_id:hw,entity_id:uw,entity_poly_segment_id:hw,asym_id:uw},ihm_predicted_contact_restraint:{id:hw,group_id:hw,entity_id_1:uw,entity_id_2:uw,asym_id_1:uw,asym_id_2:uw,comp_id_1:uw,comp_id_2:uw,seq_id_1:hw,seq_id_2:hw,rep_atom_1:fw(uw),rep_atom_2:fw(uw),distance_lower_limit:dw,distance_upper_limit:dw,probability:dw,restraint_type:fw(uw),model_granularity:fw(uw),dataset_list_id:hw,software_id:hw},ihm_cross_link_list:{id:hw,group_id:hw,entity_description_1:uw,entity_description_2:uw,entity_id_1:uw,entity_id_2:uw,comp_id_1:uw,comp_id_2:uw,seq_id_1:hw,seq_id_2:hw,linker_type:fw(uw),dataset_list_id:hw},ihm_cross_link_restraint:{id:hw,group_id:hw,entity_id_1:uw,entity_id_2:uw,asym_id_1:uw,asym_id_2:uw,comp_id_1:uw,comp_id_2:uw,seq_id_1:hw,seq_id_2:hw,atom_id_1:uw,atom_id_2:uw,restraint_type:fw(uw),conditional_crosslink_flag:fw(uw),model_granularity:fw(uw),distance_threshold:dw,psi:dw,sigma_1:dw,sigma_2:dw},ihm_cross_link_result_parameters:{id:hw,restraint_id:hw,model_id:hw,psi:dw,sigma_1:dw,sigma_2:dw},ihm_2dem_class_average_restraint:{id:hw,dataset_list_id:hw,number_raw_micrographs:hw,pixel_size_width:dw,pixel_size_height:dw,image_resolution:dw,image_segment_flag:fw(_w),number_of_projections:hw,struct_assembly_id:hw,details:uw},ihm_2dem_class_average_fitting:{id:hw,restraint_id:hw,model_id:hw,cross_correlation_coefficient:dw,rot_matrix:mw(3,3),tr_vector:gw(3)},ihm_3dem_restraint:{id:hw,dataset_list_id:hw,model_id:hw,struct_assembly_id:hw,fitting_method:uw,number_of_gaussians:hw,cross_correlation_coefficient:dw},ihm_sas_restraint:{id:hw,dataset_list_id:hw,model_id:hw,struct_assembly_id:hw,profile_segment_flag:fw(_w),fitting_atom_type:uw,fitting_method:uw,fitting_state:fw(uw),radius_of_gyration:dw,chi_value:dw,details:uw},ihm_starting_model_coord:{ordinal_id:hw,starting_model_id:uw,group_PDB:fw(uw),id:hw,type_symbol:uw,entity_id:uw,atom_id:uw,comp_id:uw,seq_id:hw,asym_id:uw,Cartn_x:dw,Cartn_y:dw,Cartn_z:dw,B_iso_or_equiv:dw},ihm_sphere_obj_site:{id:hw,entity_id:uw,seq_id_begin:hw,seq_id_end:hw,asym_id:uw,Cartn_x:dw,Cartn_y:dw,Cartn_z:dw,object_radius:dw,rmsf:dw,model_id:hw},ihm_gaussian_obj_site:{id:hw,entity_id:uw,seq_id_begin:hw,seq_id_end:hw,asym_id:uw,mean_Cartn_x:dw,mean_Cartn_y:dw,mean_Cartn_z:dw,weight:dw,covariance_matrix:mw(3,3),model_id:hw},ihm_gaussian_obj_ensemble:{id:hw,entity_id:uw,seq_id_begin:hw,seq_id_end:hw,asym_id:uw,mean_Cartn_x:dw,mean_Cartn_y:dw,mean_Cartn_z:dw,weight:dw,covariance_matrix:mw(3,3),ensemble_id:hw},ihm_feature_list:{feature_id:hw,feature_type:fw(uw),entity_type:fw(uw)},ihm_poly_residue_feature:{ordinal_id:hw,feature_id:hw,entity_id:uw,asym_id:uw,comp_id_begin:uw,comp_id_end:uw,seq_id_begin:hw,seq_id_end:hw},ihm_derived_distance_restraint:{id:hw,group_id:hw,feature_id_1:hw,feature_id_2:hw,group_conditionality:fw(uw),random_exclusion_fraction:dw,distance_upper_limit:dw,restraint_type:fw(uw),dataset_list_id:hw},ma_model_list:{ordinal_id:hw,model_id:hw,model_group_id:hw,model_name:uw,model_group_name:uw,model_type:fw(uw),data_id:hw},ma_target_entity:{entity_id:uw,data_id:hw,origin:fw(uw)},ma_target_entity_instance:{asym_id:uw,entity_id:uw,details:uw},ma_target_ref_db_details:{target_entity_id:uw,db_name:fw(uw),db_code:uw,db_accession:uw,seq_db_isoform:uw,seq_db_align_begin:uw,seq_db_align_end:uw,ncbi_taxonomy_id:uw,organism_scientific:uw},ma_data:{id:hw,content_type:fw(uw),content_type_other_details:uw,name:uw},ma_software_group:{ordinal_id:hw,group_id:hw,software_id:hw},ma_qa_metric:{id:hw,name:uw,type:fw(uw),mode:fw(uw),software_group_id:hw},ma_qa_metric_global:{ordinal_id:hw,model_id:hw,metric_id:hw,metric_value:dw},ma_qa_metric_local:{ordinal_id:hw,model_id:hw,label_asym_id:uw,label_seq_id:hw,label_comp_id:uw,metric_id:hw,metric_value:dw}};var bw=lb.Schema;const xw=bw.str,ww=bw.float,Sw=bw.List,Aw=bw.lstr,Mw=bw.Aliased,Cw=bw.int,Tw=bw.coord,Ew={chem_comp:{formula:xw,formula_weight:ww,id:xw,mon_nstd_parent_comp_id:Sw(",",(e=>e)),name:xw,one_letter_code:xw,three_letter_code:xw,type:Mw(Aw),pdbx_synonyms:Sw(";",(e=>e)),pdbx_type:xw,pdbx_ambiguous_flag:xw,pdbx_replaced_by:xw,pdbx_replaces:xw,pdbx_formal_charge:Cw,pdbx_model_coordinates_details:xw,pdbx_model_coordinates_db_code:xw,pdbx_ideal_coordinates_details:xw,pdbx_ideal_coordinates_missing_flag:Mw(Aw),pdbx_model_coordinates_missing_flag:Mw(Aw),pdbx_initial_date:xw,pdbx_modified_date:xw,pdbx_release_status:Mw(xw),pdbx_processing_site:Mw(xw)},chem_comp_atom:{alt_atom_id:xw,atom_id:xw,charge:Cw,model_Cartn_x:Tw,model_Cartn_y:Tw,model_Cartn_z:Tw,comp_id:xw,type_symbol:xw,pdbx_align:Cw,pdbx_ordinal:Cw,pdbx_model_Cartn_x_ideal:Tw,pdbx_model_Cartn_y_ideal:Tw,pdbx_model_Cartn_z_ideal:Tw,pdbx_stereo_config:Mw(Aw),pdbx_aromatic_flag:Mw(Aw),pdbx_leaving_atom_flag:Mw(Aw)},chem_comp_bond:{atom_id_1:xw,atom_id_2:xw,comp_id:xw,value_order:Mw(Aw),pdbx_ordinal:Cw,pdbx_stereo_config:Mw(Aw),pdbx_aromatic_flag:Mw(Aw)},pdbx_chem_comp_descriptor:{comp_id:xw,descriptor:xw,type:Mw(Aw),program:xw,program_version:xw},pdbx_chem_comp_identifier:{comp_id:xw,identifier:xw,type:Mw(xw),program:xw,program_version:xw}};var Pw=lb.Schema;const Iw=Pw.str,kw=Pw.float,Rw=Pw.lstr,Dw=Pw.Aliased,Lw=Pw.int,Ow={pdbx_reference_molecule:{prd_id:Iw,formula_weight:kw,formula:Iw,type:Dw(Rw),type_evidence_code:Iw,class:Dw(Rw),class_evidence_code:Iw,name:Iw,represent_as:Dw(Rw),chem_comp_id:Iw,compound_details:Iw,description:Iw,representative_PDB_id_code:Iw,release_status:Dw(Rw),replaces:Iw,replaced_by:Iw},pdbx_reference_entity_list:{prd_id:Iw,ref_entity_id:Iw,type:Dw(Rw),details:Iw,component_id:Lw},pdbx_reference_entity_nonpoly:{prd_id:Iw,ref_entity_id:Iw,name:Iw,chem_comp_id:Iw},pdbx_reference_entity_link:{link_id:Lw,prd_id:Iw,details:Iw,ref_entity_id_1:Iw,ref_entity_id_2:Iw,entity_seq_num_1:Lw,entity_seq_num_2:Lw,comp_id_1:Iw,comp_id_2:Iw,atom_id_1:Iw,atom_id_2:Iw,value_order:Dw(Rw),component_1:Lw,component_2:Lw,link_class:Dw(Iw)},pdbx_reference_entity_poly_link:{link_id:Lw,prd_id:Iw,ref_entity_id:Iw,component_id:Lw,entity_seq_num_1:Lw,entity_seq_num_2:Lw,comp_id_1:Iw,comp_id_2:Iw,atom_id_1:Iw,atom_id_2:Iw,value_order:Dw(Rw)},pdbx_reference_entity_poly:{prd_id:Iw,ref_entity_id:Iw,type:Dw(Iw),db_code:Iw,db_name:Iw},pdbx_reference_entity_poly_seq:{prd_id:Iw,ref_entity_id:Iw,mon_id:Iw,parent_mon_id:Iw,num:Lw,observed:Dw(Rw),hetero:Dw(Rw)},pdbx_reference_entity_sequence:{prd_id:Iw,ref_entity_id:Iw,type:Dw(Iw),NRP_flag:Dw(Iw),one_letter_codes:Iw},pdbx_reference_entity_src_nat:{prd_id:Iw,ref_entity_id:Iw,ordinal:Lw,organism_scientific:Iw,taxid:Iw,db_code:Iw,db_name:Iw},pdbx_prd_audit:{prd_id:Iw,date:Iw,processing_site:Dw(Iw),action_type:Dw(Iw)}};var Nw=lb.Schema;const Fw=Nw.str,Bw={datablock:{id:Fw,description:Fw},dictionary:{title:Fw,datablock_id:Fw,version:Fw},dictionary_history:{version:Fw,update:Fw,revision:Fw},sub_category:{id:Fw,description:Fw},category_group_list:{id:Fw,parent_id:Fw,description:Fw},item_type_list:{code:Fw,primitive_code:Fw,construct:Fw,detail:Fw},item_units_list:{code:Fw,detail:Fw},item_units_conversion:{from_code:Fw,to_code:Fw,operator:Fw,factor:Nw.float}};var Uw=lb.Schema;const zw=Uw.str,Vw=Uw.int,Hw=Uw.float,$w=Uw.Aliased,Gw=Uw.Vector;$w(zw),$w(zw),$w(zw),$w(zw),Gw(3),Gw(3);const jw={volume_data_3d_info:{name:zw,axis_order:Gw(3,Vw),origin:Gw(3),dimensions:Gw(3),sample_rate:Vw,sample_count:Gw(3,Vw),spacegroup_number:Vw,spacegroup_cell_size:Gw(3),spacegroup_cell_angles:Gw(3),mean_source:Hw,mean_sampled:Hw,sigma_source:Hw,sigma_sampled:Hw,min_source:Hw,min_sampled:Hw,max_source:Hw,max_sampled:Hw},volume_data_3d:{values:Hw}};var Ww=lb.Schema;const qw=Ww.float,Xw=Ww.int,Yw=Ww.str,Kw={cell:{angle_alpha:qw,angle_beta:qw,angle_gamma:qw,formula_units_z:Xw,length_a:qw,length_b:qw,length_c:qw,volume:qw},chemical:{melting_point:qw,name_common:Yw,name_systematic:Yw},chemical_formula:{moiety:Yw,sum:Yw,weight:qw},space_group:{crystal_system:Yw,it_number:Xw,"name_h-m_full":Yw},space_group_symop:{operation_xyz:Yw},geom_bond:{atom_site_label_1:Yw,atom_site_label_2:Yw,distance:qw,publ_flag:Yw,site_symmetry_1:Yw,site_symmetry_2:Yw,valence:qw},audit:{block_doi:Yw},database_code:{cod:Yw,csd:Yw,depnum_ccdc_archive:Yw,depnum_ccdc_fiz:Yw,icsd:Yw,mdf:Yw,nbs:Yw},atom_site:{adp_type:Yw,calc_flag:Yw,disorder_assembly:Yw,disorder_group:Yw,fract_x:qw,fract_y:qw,fract_z:qw,label:Yw,occupancy:qw,refinement_flags:Yw,site_symmetry_multiplicity:Xw,type_symbol:Yw,u_iso_or_equiv:qw},atom_site_aniso:{label:Yw,u_11:qw,u:(0,Ww.Matrix)(3,3),u_12:qw,u_13:qw,u_22:qw,u_23:qw,u_33:qw},atom_type:{description:Yw,symbol:Yw},atom_type_scat:{dispersion_imag:qw,dispersion_real:qw,source:Yw}},Zw={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},Qw=lb.Schema.int,Jw={volume_data_3d_info:jw.volume_data_3d_info,segmentation_data_table:{set_id:Qw,segment_id:Qw},segmentation_data_3d:{values:Qw}},eS={parse:e=>"string"==typeof e?Px(e):Jx(e),parseText:Px,parseBinary:Jx,toDatabaseCollection:function(e,t,n){const i={};for(const r of t.blocks)i[r.header]=tw(e,r,n);return i},toDatabase:tw,schema:{mmCIF:e=>tw(yw,e),CCD:e=>tw(Ew,e),BIRD:e=>tw(Ow,e),dic:e=>tw(Bw,e),cifCore:e=>tw(Kw,e,Zw),densityServer:e=>tw(jw,e),segmentation:e=>tw(Jw,e)}};class tS{constructor(e,t){var n=t||{};this.streamer=e,this.name=Aa(n.name,""),this.path=Aa(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then((()=>Zg(this,void 0,void 0,(function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))))}_parse(){}_beforeParse(){}_afterParse(){Ql&&Yl.log(this[this.__objName])}}class nS extends tS{constructor(e,t){var n=t||{};super(e,n),this.firstModelOnly=Aa(n.firstModelOnly,!1),this.asTrajectory=Aa(n.asTrajectory,!1),this.cAlphaOnly=Aa(n.cAlphaOnly,!1),this.structure=new Fm(this.name,this.path),this.structureBuilder=new Qf(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class iS{constructor(e,t,n="",i,r=[]){this.structure=e,this.index=t,this.description=n,this.entityType=function(e){switch(e=e.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}}(i||""),this.chainIndexList=r,r.forEach((function(n){e.chainStore.entityIndex[n]=t}))}get type(){return function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}}(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return 1===this.entityType}isNonPolymer(){return 2===this.entityType}isMacrolide(){return 3===this.entityType}isWater(){return 4===this.entityType}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach((function(n){t.index=n,e(t)}))}}const rS={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class sS{constructor(e=rS){this.cartToFrac=new zt,this.fracToCart=new zt,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=qa(this.alpha),n=qa(this.beta),i=qa(this.gamma),r=Math.cos(t),s=Math.cos(n),o=Math.cos(i),a=Math.sin(n),l=Math.sin(i);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-r*r-s*s-o*o+2*r*s*o),void 0===e.cartToFrac){const e=this.a*this.b*l/this.volume,t=(s*o-r)/(a*l);this.fracToCart.set(this.a,0,0,0,this.b*o,this.b*l,0,0,this.c*s,-this.c*a*t,1/e,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const n=e.unitcell,i=e.center.clone().applyMatrix4(n.cartToFrac).floor(),r=new ut;let s=0;const o=function(e,o,a){r.set(e,o,a).add(i).applyMatrix4(n.fracToCart).toArray(t,s),s+=3};o(0,0,0),o(1,0,0),o(0,1,0),o(0,0,1),o(1,1,0),o(1,0,1),o(0,1,1),o(1,1,1)}return t}getCenter(e){return function(e,t=new ut){const n=e.length;for(let i=0;i<n;i+=3)t.x+=e[i],t.y+=e[i+1],t.z+=e[i+2];return t.divideScalar(n/3),t}(this.getPosition(e))}getData(e,t={}){const n=Aa(t.colorValue,"orange"),i=Aa(t.radius,Math.cbrt(this.volume)/200),r=new Pn(n),s=new ut,o=this.getPosition(e),a=jc(8,r.r,r.g,r.b),l=Gc(8,i),c=new Float32Array(36),u=new Float32Array(36),h=jc(12,r.r,r.g,r.b),d=Gc(12,i);let p=0;function f(e,t){s.fromArray(o,3*e).toArray(c,p),s.fromArray(o,3*t).toArray(u,p),p+=3}f(0,1),f(0,2),f(0,3),f(1,4),f(1,5),f(2,6),f(3,5),f(4,7),f(5,7),f(2,4),f(7,6),f(3,6);const m=new vp(this,e);return{vertex:{position:o,color:a,radius:l,picking:m},edge:{position1:c,position2:u,color:h,color2:h,radius:d,picking:m}}}}const oS={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},aS=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],lS=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],cS=/\s+/;function uS(e,t,n){let i=`${e}`;return t&&(i+=`:${t}`),n&&(i+=`^${n}`),i}class hS extends nS{constructor(e,t){const n=t||{};super(e,n),this.hex=Aa(n.hex,!1),this.inferBonds=Aa(n.inferBonds,"all")}get type(){return"pdb"}_parse(){Ql&&Yl.time("PdbParser._parse "+this.name);let e=!1;const t=this.streamer.peekLines(1)[0],n=t.substr(62,4),i=t.substr(72,4);n===i&&i.trim()&&(e=!0);const r="pqr"===this.type,s="pdbqt"===this.type,o=this.structure,a=this.structureBuilder,l=this.hex;let c=10,u=10;const h=this.firstModelOnly,d=this.asTrajectory,p=this.cAlphaOnly,f=o.frames,m=o.boxes;let g,_,v=!1;const y=o.biomolDict;let b,x,w,S,A,M,C,T,E,P,I,k,R,D,L,O,N,F,B,U,z,V,H={};const $={},G={},j=[];let W,q;const X={},Y={},K={};let Z,Q,J,ee,te,ne,ie;const re={};let se;const oe={helices:[],sheets:[]},ae=oe.helices,le=oe.sheets,ce=o.atomMap,ue=o.atomStore;ue.resize(Math.round(this.streamer.data.length/80)),(r||s)&&ue.addField("partialCharge",1,"float32"),r&&ue.addField("radius",1,"float32");const he=o.getAtomProxy(),de=o.getAtomProxy();let pe=0,fe=0,me=!0;this.streamer.eachChunkOfLines((function(t){!function(t,n,i){for(let t=0;t<n;++t)if(S=i[t],A=S.substr(0,6),"ATOM  "===A||"HETATM"===A){if(me&&(d?(v?(g=new Float32Array(3*ue.count),f.push(g)):g=[],_=0):h||(H={}),Z=1,Q=Z.toString(),J=!0,me=!1),h&&fe>0)continue;let t,n,i,o,m,y=0;if(r){if(o=S.split(cS),y=10===o.length?1:0,k=o[2],p&&"CA"!==k)continue;t=parseFloat(o[6-y]),n=parseFloat(o[7-y]),i=parseFloat(o[8-y])}else{if(k=S.substr(12,4).trim(),p&&"CA"!==k)continue;t=parseFloat(S.substr(30,8)),n=parseFloat(S.substr(38,8)),i=parseFloat(S.substr(46,8))}if(d){const e=3*_;if(g[e+0]=t,g[e+1]=n,g[e+2]=i,_+=1,v)continue}r?(M=parseInt(o[1]),m="",R="H"===S[0],C=y?"":o[4],T=parseInt(o[5-y]),I="",E=o[3],L="",P=1):(M=parseInt(S.substr(6,5),c),l&&99999===M&&(c=16),R="H"===S[0],C=S[21].trim(),T=parseInt(S.substr(22,4),u),l&&9999===T&&(u=16),I=S[26].trim(),E=S.substr(17,4).trim()||"MOL",D=parseFloat(S.substr(60,6)),L=S[16].trim(),P=parseFloat(S.substr(54,6)),e||(s?(m=S.substr(76,3).trim(),m in Rd&&(m=Rd[m])):(m=S.substr(76,2).trim(),C||(C=S.substr(72,4).trim())),O=parseInt((S.substr(79,1)+S.substr(78,1)).trim()))),ue.growIfFull(),ue.atomTypeId[pe]=ce.add(k,m),ue.x[pe]=t,ue.y[pe]=n,ue.z[pe]=i,ue.serial[pe]=M,ue.altloc[pe]=L.charCodeAt(0),ue.occupancy[pe]=isNaN(P)?0:P,r?(ue.partialCharge[pe]=parseFloat(o[9-y]),ue.radius[pe]=parseFloat(o[10-y])):(ue.bfactor[pe]=isNaN(D)?0:D,s&&(ue.partialCharge[pe]=parseFloat(S.substr(70,6))),isFinite(O)&&(ue.formalCharge||ue.addField("formalCharge",1,"int8"),ue.formalCharge[pe]=O));const b=uS(T,C,I);!R||Y[b]||aS.includes(E)?J||ee===C||(Z+=1,Q=Z.toString()):ee===C&&ne===E&&(Cd.includes(E)||te===T&&ie===I)||(Z+=1,Q=Z.toString(),te=T,ne=E,ie=I),a.addAtom(fe,C,Q,E,T,R,void 0,I),H[M]=pe,pe+=1,J=!1,ee=C}else if("CONECT"===A){const e=H[parseInt(S.substr(6,5))],t=[11,16,21,26],n={};if(void 0===e)continue;for(let i=0;i<4;++i){let r=parseInt(S.substr(t[i],5));if(!Number.isNaN(r)&&(r=H[r],void 0!==r))if(e<r?(he.index=e,de.index=r):(he.index=r,de.index=e),void 0!==n[r])o.bondStore.bondOrder[n[r]]+=1;else{const e=he.index+"|"+de.index;void 0===G[e]&&(G[e]=!0,n[r]=o.bondStore.count,o.bondStore.addBond(he,de,1))}}}else if("HELIX "===A){N=S[19].trim(),F=parseInt(S.substr(21,4)),B=S[25].trim(),U=S[31].trim(),z=parseInt(S.substr(33,4)),V=S[37].trim();let e=parseInt(S.substr(39,1));e=(oS[e]||oS[0]).charCodeAt(0),ae.push([N,F,B,U,z,V,e])}else if("SHEET "===A)N=S[21].trim(),F=parseInt(S.substr(22,4)),B=S[26].trim(),U=S[32].trim(),z=parseInt(S.substr(33,4)),V=S[37].trim(),le.push([N,F,B,U,z,V]);else if("HETNAM"===A)X[S.substr(11,3)]=S.substr(15).trim();else if("SEQRES"===A){const e=S[11].trim();e!==se&&(re[e]=[],se=e),re[e].push(...S.substr(19).trim().split(cS))}else if("MODRES"===A){const e=S.substr(12,3).trim(),t=S[16].trim(),n=S[22].trim(),i=parseInt(S.substr(18,4).trim()),r=uS(i,t,n);Y[r]={resname:e,chainname:t,inscode:n,resno:i}}else if("COMPND"===A){const e=S.substr(10,70).trim(),t=e.indexOf(":"),n=e.substring(0,t);let i;lS.includes(n)?(q=n,i=e.substring(t+2)):i=e,i=i.replace(/;$/,""),"MOL_ID"===q?(W={chainList:[],name:""},j.push(W)):"MOLECULE"===q?(W.name&&(W.name+=" "),W.name+=i):"CHAIN"===q&&Array.prototype.push.apply(W.chainList,i.split(/\s*,\s*/))}else if(S.startsWith("TER")){const e=o.getChainProxy(o.chainStore.count-1);K[e.chainname]=e.index,Z+=1,Q=Z.toString(),J=!0}else if("REMARK"===A&&"350"===S.substr(7,3)){if("BIOMOLECULE:"===S.substr(11,12)){let e=S.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(e)&&(e="BU"+e),b=new Kf(e),y[e]=b}else if("BIOMT"===S.substr(13,5)){const e=S.split(/\s+/),t=parseInt(S[18])-1;0===t&&(w=new zt,x.matrixList.push(w));const n=w.elements;n[0+t]=parseFloat(e[4]),n[4+t]=parseFloat(e[5]),n[8+t]=parseFloat(e[6]),n[12+t]=parseFloat(e[7])}else if("APPLY THE FOLLOWING TO CHAINS:"===S.substr(11,30)||"                   AND CHAINS:"===S.substr(11,30)){"APPLY"===S.substr(11,5)&&(x=b.addPart());const e=S.substr(41,30).split(",");for(let t=0,n=e.length;t<n;++t){const n=e[t].trim();n&&x.chainList.push(n)}}}else if("HEADER"===A)o.id=S.substr(62,4);else if("TITLE "===A)o.title+=(o.title?" ":"")+S.substr(10,70).trim();else if("MODEL "===A)me=!0;else if("ENDMDL"===A||"END"===S.trim()){if(me)continue;d&&!v&&(f.push(new Float32Array(g)),v=!0),fe+=1,me=!0}else if("MTRIX"===S.substr(0,5)){if("1"===S[59])continue;if(!b||"NCS"!==b.name){const e="NCS";b=new Kf(e),y[e]=b,x=b.addPart()}const e=S.split(/\s+/),t=parseInt(S[5])-1;0===t&&(w=new zt,x.matrixList.push(w));const n=w.elements;n[0+t]=parseFloat(e[2]),n[4+t]=parseFloat(e[3]),n[8+t]=parseFloat(e[4]),n[12+t]=parseFloat(e[5])}else if("ORIGX"===S.substr(0,5)){$.origx||($.origx=new zt);const e=S.split(/\s+/),t=parseInt(S[5])-1,n=$.origx.elements;n[0+t]=parseFloat(e[1]),n[4+t]=parseFloat(e[2]),n[8+t]=parseFloat(e[3]),n[12+t]=parseFloat(e[4])}else if("SCALE"===S.substr(0,5)){$.scale||($.scale=new zt);const e=S.split(/\s+/),t=parseInt(S[5])-1,n=$.scale.elements;n[0+t]=parseFloat(e[1]),n[4+t]=parseFloat(e[2]),n[8+t]=parseFloat(e[3]),n[12+t]=parseFloat(e[4])}else if("CRYST1"===A){const e=parseFloat(S.substr(6,9)),t=parseFloat(S.substr(15,9)),n=parseFloat(S.substr(24,9)),i=parseFloat(S.substr(33,7)),r=parseFloat(S.substr(40,7)),s=parseFloat(S.substr(47,7)),o=S.substr(55,11).trim(),a=new Float32Array(9);a[0]=e,a[4]=t,a[8]=n,m.push(a),0===fe&&($.a=e,$.b=t,$.c=n,$.alpha=i,$.beta=r,$.gamma=s,$.spacegroup=o)}}(0,t.length,t)})),a.finalize();const ge=j.length;if(ge){o.eachChain((function(e){e.entityIndex=ge})),j.forEach((function(e,t){const n=e.chainList.map((function(e){return K[e]}));o.entityList.push(new iS(o,t,e.name,"polymer",n))}));let e=j.length;const t=o.getResidueProxy(),n={};o.eachChain((function(e){e.entityIndex===ge&&(t.index=e.residueOffset,n[t.resname]||(n[t.resname]=[]),n[t.resname].push(e.index))})),Object.keys(n).forEach((function(t){const i=n[t];let r="non-polymer",s=X[t]||t;Cd.includes(t)&&(s="water",r="water"),o.entityList.push(new iS(o,e,s,r,i)),e+=1}))}void 0!==$.a?o.unitcell=new sS($):o.unitcell=void 0,(ae.length||le.length)&&Jf(o,oe),o.finalizeAtoms(),e||im(o),rm(o,this.inferBonds),o.finalizeBonds(),ae.length||le.length||em(o),cm(o),Ql&&Yl.timeEnd("PdbParser._parse "+this.name)}}oc.add("pdb",hS),oc.add("pdb1",hS),oc.add("ent",hS);class dS{constructor(e){this.structure=e,this.dict={},this.structure=e}add(e,t,n){this.dict[e]={chemCompType:t},n&&(this.dict[e].bonds=n)}addBond(e,t,n,i){const r=this.dict[e];if(!r)return;r.bonds||(r.bonds={atom1:[],atom2:[],bondOrders:[]});const s=r.bonds;s.atom1.push(t),s.atom2.push(n),s.bondOrders.push(i)}getBonds(e,t){var n;const i=null===(n=this.dict[e])||void 0===n?void 0:n.bonds;if(!i)return;const r=this.structure.atomMap,s=new Map(t.map(((e,t)=>{var n;return[null===(n=r.get(e))||void 0===n?void 0:n.atomname,t]}))),o=[],a=[],l=[];let c,u;for(let e=0;e<i.atom1.length;e++)void 0!==(c=s.get(i.atom1[e]))&&void 0!==(u=s.get(i.atom2[e]))&&(o.push(c),a.push(u),l.push(i.bondOrders[e]));return{atomIndices1:o,atomIndices2:a,bondOrders:l}}}const pS=/^\D{1,2}/,fS={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},mS={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function gS(e){switch(e.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class _S extends nS{get type(){return"cif"}get isBinary(){return!1}_parse(){var e,t,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b;return Zg(this,void 0,void 0,(function*(){Yl.time("CifParser._parse "+this.name);const x=this.structure,w=this.structureBuilder,S=this.firstModelOnly,A=this.asTrajectory,M=x.frames;let C,T;const E=this.isBinary?eS.parseBinary(this.streamer.data):eS.parseText(this.streamer.compressed?Na(this.streamer.data):this.streamer.data),P=yield E.run();if(P.isError)throw P;const I=P.result.blocks[0];if("chem_comp"in I.categories&&"chem_comp_atom"in I.categories&&!("struct"in I.categories))!function(e,t,n){const i=t.atomStore,r=t.atomMap;let s,o;const a=e.chem_comp,l=e.chem_comp_atom,c=e.chem_comp_bond;let u;a&&((u=a.getField("name"))&&(t.title=u.str(0)),(u=a.getField("id"))&&(t.id=u.str(0)));const h={};if(l){let e,t,s,a;o=l.rowCount,i.resize(2*o);const c=l.getField("atom_id"),u=l.getField("type_symbol"),d=l.getField("pdbx_component_comp_id"),p=l.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach((([f,m,g],_)=>{var v;const y=l.getField(f),b=l.getField(m),x=l.getField(g),w=_*o;for(let l=0;l<o;++l){const o=l+w;i.growIfFull(),e=null==c?void 0:c.str(l),t=null==u?void 0:u.str(l),h[e]=l,i.atomTypeId[o]=r.add(e,t),i.x[o]=y.float(l),i.y[o]=b.float(l),i.z[o]=x.float(l),i.serial[o]=l,s=d.str(l),a=null!==(v=null==p?void 0:p.int(l))&&void 0!==v?v:1,n.addAtom(_,"","",s,a,!0)}}))}if(l&&c){let e,n,i;o=c.rowCount;const r=l.rowCount,a=t.getAtomProxy(),u=t.getAtomProxy(),d=c.getField("atom_id_1"),p=c.getField("atom_id_2"),f=c.getField("value_order");for(s=0;s<o;++s)e=d.str(s),n=p.str(s),i=gS(f.str(s)),a.index=h[e],u.index=h[n],t.bondStore.growIfFull(),t.bondStore.addBond(a,u,i),a.index+=r,u.index+=r,t.bondStore.growIfFull(),t.bondStore.addBond(a,u,i)}}(I.categories,x,w),w.finalize(),x.finalizeAtoms(),x.finalizeBonds(),pm(x);else if("atom_site_type_symbol"in I.categories&&"atom_site_label"in I.categories&&"atom_site_fract_x"in I.categories)!function(e,t,n){var i,r,s=t.atomStore,o=t.atomMap;e.header&&(t.id=e.header,t.name=e.header),t.unitcell=new sS({a:e.getField("cell_length_a").float(0),b:e.getField("cell_length_b").float(0),c:e.getField("cell_length_c").float(0),alpha:e.getField("cell_angle_alpha").float(0),beta:e.getField("cell_angle_beta").float(0),gamma:e.getField("cell_angle_gamma").float(0),spacegroup:e.getField("symmetry_space_group_name_H-M").str(0)});const a=new ut,l=new ut,c=e.getField("atom_site_type_symbol");if(!c)return;const u=null!==(i=c.rowCount)&&void 0!==i?i:0,h=e.getField("atom_site_type_symbol"),d=e.getField("atom_site_fract_x"),p=e.getField("atom_site_fract_y"),f=e.getField("atom_site_fract_z"),m=e.getField("atom_site_occupancy"),g={};for(let e=0;e<u;++e){s.growIfFull();const i=h.str(e),u=c.str(e);let _=g[u];if(!_){const e=u.match(pS);g[u]=_=null!==(r=null==e?void 0:e[0])&&void 0!==r?r:u}s.atomTypeId[e]=o.add(i,_),a.set(d.float(e),p.float(e),f.float(e)),a.applyMatrix4(t.unitcell.fracToCart),l.add(a),s.x[e]=a.x,s.y[e]=a.y,s.z[e]=a.z,m&&(s.occupancy[e]=m.float(e)),s.serial[e]=e,n.addAtom(0,"","","HET",1,!0)}l.divideScalar(u),t.center=l,cm(t);const _=new ut,v=new ut,y=t.biomolDict.SUPERCELL.partList[0].matrixList;let b=u;function x(e){return o.get(s.atomTypeId[e]).covalent}const w=new zt;for(let e=0;e<u;++e){const t=x(e);a.set(s.x[e],s.y[e],s.z[e]),y.forEach((function(i){if(!w.equals(i)){_.copy(a),_.applyMatrix4(i);for(let i=0;i<u;++i){v.set(s.x[i],s.y[i],s.z[i]);const r=_.distanceToSquared(v),o=x(i)+t,a=o+.3,l=o-.5;if(r<a*a&&r>l*l)return s.growIfFull(),s.atomTypeId[b]=s.atomTypeId[e],s.x[b]=_.x,s.y[b]=_.y,s.z[b]=_.z,s.occupancy[b]=s.occupancy[e],s.serial[b]=b,s.altloc[b]="A".charCodeAt(0),n.addAtom(0,"","","HET",1,!0),void(b+=1)}}}))}}(I,x,w),w.finalize(),x.finalizeAtoms(),rm(x),x.finalizeBonds();else{const E={},P={},k=x.atomMap,R=x.atomStore,D=I.categories.atom_site;let L=D.rowCount;const O=D.getField("pdbx_PDB_model_num");if(null!==(e=null==O?void 0:O.areValuesEqual(0,L-1))&&void 0!==e&&!e&&(A||S)){const e=O.int(0);for(let t=0;t<L;t++)if(O.int(t)>e){L=t;break}}x.chemCompMap=new dS(x);const N=I.categories.chem_comp;let F=N.getField("id");const B=N.getField("type");for(let e=0;e<N.rowCount;e++)x.chemCompMap.add(F.str(e),B.str(e).toUpperCase());if(I.categoryNames.includes("chem_comp_bond")){const e=I.categories.chem_comp_bond;F=e.getField("comp_id");const t=e.getField("atom_id_1"),n=e.getField("atom_id_2"),i=e.getField("value_order");for(let r=0;r<e.rowCount;r++){const e=mS[i.str(r)];e&&x.chemCompMap.addBond(F.str(r),t.str(r),n.str(r),e)}}const U=(e,t,n)=>{const i=e.getField(t);return i?i.toFloatArray({array:Float32Array,start:0,end:n}):new Float32Array(n)};R.resize(L),R.x=U(D,"Cartn_x",L),R.y=U(D,"Cartn_y",L),R.z=U(D,"Cartn_z",L),R.serial=D.getField("id").toIntArray({start:0,end:L}),R.bfactor=U(D,"B_iso_or_equiv",L),R.occupancy=U(D,"occupancy",L);const z=D.getField("label_alt_id");(null==z?void 0:z.isDefined)&&(R.altloc=Uint8Array.from(z.toStringArray(),(e=>e.charCodeAt(0))));const V=D.getField("label_atom_id"),H=D.getField("type_symbol");F=D.getField("label_comp_id");const $=null!==(t=D.getField("auth_seq_id"))&&void 0!==t?t:D.getField("label_seq_id"),G=D.getField("pdbx_PDB_ins_code"),j=D.getField("auth_asym_id"),W=D.getField("label_asym_id"),q=D.getField("group_PDB"),X=D.getField("label_entity_id");for(let e=0;e<L;e++){const t=null!==(n=null==O?void 0:O.int(e))&&void 0!==n?n:1,c=null!==(i=null==j?void 0:j.str(e))&&void 0!==i?i:"",u=null!==(r=null==W?void 0:W.str(e))&&void 0!==r?r:"",h=null!==(s=null==F?void 0:F.str(e))&&void 0!==s?s:"",d=null!==(o=null==$?void 0:$.int(e))&&void 0!==o?o:0,p="H"===(null==q?void 0:q.str(e)[0]),f=null!==(a=null==G?void 0:G.str(e))&&void 0!==a?a:"",m=null!==(l=null==X?void 0:X.int(e))&&void 0!==l?l:1;R.atomTypeId[e]=k.add((null==V?void 0:V.str(e))||"",null==H?void 0:H.str(e)),w.addAtom(t-1,c,u,h,d,p,void 0,f),E[u]=c,P[m]||(P[m]=new Set),P[m].add(x.chainStore.count-1)}if(A){const e=D.rowCount/L|0,t=D.getField("Cartn_x"),n=D.getField("Cartn_y"),i=D.getField("Cartn_z");for(let r=0;r<e;r++){C=new Float32Array(3*L);const e=r*L,s=e+L;T=0;for(let r=e;r<s;r++)C[T+0]=t.float(r),C[T+1]=n.float(r),C[T+2]=i.float(r),T+=3;M.push(C)}}const Y=function(e,t,n){var i,r,s,o,a,l;const c=[],u=[];let h,d,p,f;const m=e.struct_conf;if(null==m?void 0:m.fieldNames.includes("pdbx_PDB_helix_class")){const e=m.getField("pdbx_beg_PDB_ins_code"),t=m.getField("pdbx_end_PDB_ins_code"),s=m.getField("pdbx_PDB_helix_class"),o=m.getField("beg_label_asym_id"),a=m.getField("end_label_asym_id"),l=m.getField("beg_auth_seq_id"),u=m.getField("end_auth_seq_id");for(h=0,d=m.rowCount;h<d;++h){const d=null==s?void 0:s.int(h);Number.isFinite(d)&&(p=null!==(i=null==e?void 0:e.str(h))&&void 0!==i?i:"",f=null!==(r=null==t?void 0:t.str(h))&&void 0!==r?r:"",c.push([n[o.str(h)],l.int(h),p,n[a.str(h)],u.int(h),f,(oS[d]||oS[0]).charCodeAt(0)]))}}else if(null==m?void 0:m.fieldNames.includes("conf_type_id")){const e=m.getField("conf_type_id"),t=m.getField("pdbx_beg_PDB_ins_code"),i=m.getField("pdbx_end_PDB_ins_code"),r=m.getField("beg_label_asym_id"),a=m.getField("end_label_asym_id"),l=m.getField("beg_auth_seq_id"),g=m.getField("end_auth_seq_id");let _;for(h=0,d=m.rowCount;h<d;++h){const d=e.str(h);(_=fS[d])&&(p=null!==(s=null==t?void 0:t.str(h))&&void 0!==s?s:"",f=null!==(o=null==i?void 0:i.str(h))&&void 0!==o?o:"","h"===_||"g"===_||"i"===_?c.push([n[r.str(h)],l.int(h),p,n[a.str(h)],g.int(h),f,_.charCodeAt(0)]):"e"===_&&u.push([n[r.str(h)],l.int(h),p,n[a.str(h)],g.int(h),f]))}}const g=e.struct_sheet_range;if(g&&0===u.length){const e=g.getField("pdbx_beg_PDB_ins_code"),t=g.getField("pdbx_end_PDB_ins_code"),i=g.getField("beg_label_asym_id"),r=g.getField("end_label_asym_id"),s=g.getField("beg_auth_seq_id"),o=g.getField("end_auth_seq_id");for(h=0,d=g.rowCount;h<d;++h)p=null!==(a=null==e?void 0:e.str(h))&&void 0!==a?a:"",f=null!==(l=null==t?void 0:t.str(h))&&void 0!==l?l:"",u.push([n[i.str(h)],s.int(h),p,n[r.str(h)],o.int(h),f])}return!(!m&&!g)&&{helices:c,sheets:u}}(I.categories,0,E);let K,Z;if(function(e,t,n){const i={},r=t.biomolDict;if(e.pdbx_struct_oper_list){const t=e.pdbx_struct_oper_list,n=t.getField("id"),r=t.getField("matrix[1][1]"),s=t.getField("matrix[1][2]"),o=t.getField("matrix[1][3]"),a=t.getField("matrix[2][1]"),l=t.getField("matrix[2][2]"),c=t.getField("matrix[2][3]"),u=t.getField("matrix[3][1]"),h=t.getField("matrix[3][2]"),d=t.getField("matrix[3][3]"),p=t.getField("vector[1]"),f=t.getField("vector[2]"),m=t.getField("vector[3]");for(let e=0;e<t.rowCount;e++){const t=new zt,g=t.elements;g[0]=r.float(e),g[1]=s.float(e),g[2]=o.float(e),g[4]=a.float(e),g[5]=l.float(e),g[6]=c.float(e),g[8]=u.float(e),g[9]=h.float(e),g[10]=d.float(e),g[3]=p.float(e),g[7]=f.float(e),g[11]=m.float(e),t.transpose(),i[n.str(e)]=t}}if(e.pdbx_struct_assembly_gen){const t=e.pdbx_struct_assembly_gen,s=function(e){const t={};return e.replace(/[()']/g,"").split(",").forEach((function(e){if(e.includes("-"))for(var n=e.split("-"),r=parseInt(n[0]),s=parseInt(n[1]);r<=s;++r)t[r]=i[r];else t[e]=i[e]})),t},o=t.getField("assembly_id"),a=t.getField("oper_expression"),l=t.getField("asym_id_list");for(let e=0;e<t.rowCount;e++){const t=o.int(e);let i={},c=a.str(e).replace(/['"]\(|['"]/g,"");if(c.includes(")(")||c.indexOf("(")>0){const[e,t]=c.split("(").filter((e=>!!e)),n=s(e),r=s(t);Object.keys(n).forEach((function(e){Object.keys(r).forEach((function(t){const s=new zt;s.multiplyMatrices(n[e],r[t]),i[e+"x"+t]=s}))}))}else i=s(c);const u=[];for(let e in i)u.push(i[e]);let h=""+t;/^(0|[1-9][0-9]*)$/.test(h)&&(h="BU"+h);const d=l.str(e).split(",").map((e=>n[e]));void 0===r[h]&&(r[h]=new Kf(h)),r[h].addPart(u,d)}}if(e.struct_ncs_oper){const t=e.struct_ncs_oper,n="NCS";r[n]=new Kf(n);const i=r[n].addPart(),s=t.getField("code"),o=t.getField("matrix[1][1]"),a=t.getField("matrix[1][2]"),l=t.getField("matrix[1][3]"),c=t.getField("matrix[2][1]"),u=t.getField("matrix[2][2]"),h=t.getField("matrix[2][3]"),d=t.getField("matrix[3][1]"),p=t.getField("matrix[3][2]"),f=t.getField("matrix[3][3]"),m=t.getField("vector[1]"),g=t.getField("vector[2]"),_=t.getField("vector[3]");for(let e=0;e<t.rowCount;e++){if("given"===s.str(e))return;const t=new zt,n=t.elements;n[0]=o.float(e),n[1]=a.float(e),n[2]=l.float(e),n[4]=c.float(e),n[5]=u.float(e),n[6]=h.float(e),n[8]=d.float(e),n[9]=p.float(e),n[10]=f.float(e),n[3]=m.float(e),n[7]=g.float(e),n[11]=_.float(e),t.transpose(),i.matrixList.push(t)}0===i.matrixList.length&&delete r[n]}const s={};if(e.cell){const n=e.cell,i=n.getField("length_a").float(0),r=n.getField("length_b").float(0),o=n.getField("length_c").float(0),a=new Float32Array(9);a[0]=i,a[4]=r,a[8]=o,t.boxes.push(a),s.a=i,s.b=r,s.c=o,s.alpha=n.getField("angle_alpha").float(0),s.beta=n.getField("angle_beta").float(0),s.gamma=n.getField("angle_gamma").float(0)}e.symmetry&&(s.spacegroup=e.symmetry.getField("space_group_name_H-M").str(0));const o=new zt;if(e.database_PDB_matrix){const t=e.database_PDB_matrix,n=o.elements,i=t.getField("origx[1][1]"),r=t.getField("origx[1][2]"),a=t.getField("origx[1][3]"),l=t.getField("origx[2][1]"),c=t.getField("origx[2][2]"),u=t.getField("origx[2][3]"),h=t.getField("origx[3][1]"),d=t.getField("origx[3][2]"),p=t.getField("origx[3][3]"),f=t.getField("origx_vector[1]"),m=t.getField("origx_vector[2]"),g=t.getField("origx_vector[3]");n[0]=i.float(0),n[1]=r.float(0),n[2]=a.float(0),n[4]=l.float(0),n[5]=c.float(0),n[6]=u.float(0),n[8]=h.float(0),n[9]=d.float(0),n[10]=p.float(0),n[3]=f.float(0),n[7]=m.float(0),n[11]=g.float(0),o.transpose(),s.origx=o}const a=new zt;if(e.atom_sites){const t=e.atom_sites,n=a.elements,i=t.getField("fract_transf_matrix[1][1]"),r=t.getField("fract_transf_matrix[1][2]"),o=t.getField("fract_transf_matrix[1][3]"),l=t.getField("fract_transf_matrix[2][1]"),c=t.getField("fract_transf_matrix[2][2]"),u=t.getField("fract_transf_matrix[2][3]"),h=t.getField("fract_transf_matrix[3][1]"),d=t.getField("fract_transf_matrix[3][2]"),p=t.getField("fract_transf_matrix[3][3]"),f=t.getField("fract_transf_vector[1]"),m=t.getField("fract_transf_vector[2]"),g=t.getField("fract_transf_vector[3]");n[0]=i.float(0),n[1]=r.float(0),n[2]=o.float(0),n[4]=l.float(0),n[5]=c.float(0),n[6]=u.float(0),n[8]=h.float(0),n[9]=d.float(0),n[10]=p.float(0),n[3]=f.float(0),n[7]=m.float(0),n[11]=g.float(0),a.transpose(),s.scale=a}void 0!==s.a?t.unitcell=new sS(s):t.unitcell=void 0}(I.categories,x,E),function(e,t,n){const i=e.struct_conn;if(i){const e=t.getAtomProxy(),o=t.getAtomProxy(),a={},l=i.getField("conn_type_id"),c=i.getField("ptnr1_symmetry"),u=i.getField("pdbx_ptnr1_PDB_ins_code"),h=i.getField("pdbx_ptnr1_label_alt_id"),d=i.getField("ptnr1_auth_seq_id"),p=i.getField("ptnr1_label_asym_id"),f=i.getField("ptnr1_label_atom_id"),m=i.getField("ptnr2_symmetry"),g=i.getField("pdbx_ptnr2_PDB_ins_code"),_=i.getField("pdbx_ptnr2_label_alt_id"),v=i.getField("ptnr2_auth_seq_id"),y=i.getField("ptnr2_label_asym_id"),b=i.getField("ptnr2_label_atom_id"),x=i.getField("pdbx_value_order");for(let w=0,S=i.rowCount;w<S;++w){const i=l.str(w);if("hydrog"===i||"mismat"===i||"saltbr"===i)continue;if("1_555"!==c.str(w)||"1_555"!==m.str(w))continue;const S=u.str(w),A=h.str(w),M=d.str(w)+(S?"^"+S:"")+":"+n[p.str(w)]+"."+f.str(w)+(A?"%"+A:"");let C=a[M];if(!C){const e=new Ll(M);if(e.selection.error){Ql&&Yl.warn("invalid selection for connection",M);continue}C=t.getAtomIndices(e),a[M]=C}const T=g.str(w),E=_.str(w),P=v.str(w)+(T?"^"+T:"")+":"+n[y.str(w)]+"."+b.str(w)+(E?"%"+E:"");let I=a[P];if(!I){const e=new Ll(P);if(e.selection.error){Ql&&Yl.warn("invalid selection for connection",P);continue}I=t.getAtomIndices(e),a[P]=I}var r=C.length,s=I.length;if(r>s&&([r,s]=[s,r],[C,I]=[I,C]),0!==r&&0!==s)for(let n=0;n<s;++n)e.index=C[n%r],o.index=I[n],e&&o?t.bondStore.addBond(e,o,gS(x.str(w))):Yl.log("atoms for connection not found");else Ql&&Yl.warn("no atoms found for",M,P)}}}(I.categories,x,E),function(e,t,n){var i;if(e.entity){const r=e.entity,s=r.getField("id"),o=r.getField("pdbx_description"),a=r.getField("type"),l=r.rowCount;for(let e=0;e<l;++e){const r=Array.from(null!==(i=n[s.int(e)])&&void 0!==i?i:[]);t.entityList[e]=new iS(t,e,null==o?void 0:o.str(e),a.str(e),r)}}}(I.categories,x,P),(K=null===(c=I.categories.struct)||void 0===c?void 0:c.getField("title"))&&(Z=K.str(0))&&(x.title=Z),(K=null===(u=I.categories.entry)||void 0===u?void 0:u.getField("id"))&&(Z=K.str(0))&&(x.id=Z),I.categories.pdbx_audit_revision_history){if(K=null===(h=I.categories.pdbx_audit_revision_history)||void 0===h?void 0:h.getField("revision_date"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.releaseDate=Z;break}if(K=null===(d=I.categories.pdbx_database_status)||void 0===d?void 0:d.getField("recvd_initial_deposition_date"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.depositionDate=Z;break}}else if(I.categories.database_PDB_rev){if(K=null===(p=I.categories.database_PDB_rev)||void 0===p?void 0:p.getField("date"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.releaseDate=Z;break}if(K=null===(f=I.categories.database_PDB_rev)||void 0===f?void 0:f.getField("date_original"))for(let e=0;e<K.rowCount;e++)if(Z=K.str(e)){x.header.depositionDate=Z;break}}(K=null!==(g=null===(m=I.categories.reflns)||void 0===m?void 0:m.getField("d_resolution_high"))&&void 0!==g?g:null===(_=I.categories.refine)||void 0===_?void 0:_.getField("ls_d_res_high"))&&0===K.valueKind(0)&&(x.header.resolution=K.float(0)),(K=null===(v=I.categories.refine)||void 0===v?void 0:v.getField("ls_R_factor_R_free"))&&0===K.valueKind(0)&&(x.header.rFree=K.float(0)),(K=null===(y=I.categories.refine)||void 0===y?void 0:y.getField("ls_R_factor_R_work"))&&0===K.valueKind(0)&&(x.header.rFree=K.float(0)),(K=null===(b=I.categories.exptl)||void 0===b?void 0:b.getField("method"))&&(x.header.experimentalMethods=K.toStringArray().slice()),w.finalize(),x.finalizeAtoms(),rm(x),x.finalizeBonds(),Y?Jf(x,Y):em(x),cm(x),x.extraData.cif=I}Ql&&Yl.timeEnd("CifParser._parse "+this.name)}))}}oc.add("bcif",class extends _S{get type(){return"bcif"}get isBinary(){return!0}}),oc.add("cif",_S),oc.add("mcif",_S),oc.add("mmcif",_S),oc.add("gro",class extends nS{get type(){return"gro"}_parse(){Ql&&Yl.time("GroParser._parse "+this.name);var e,t,n=this.structure,i=this.structureBuilder,r=this.firstModelOnly,s=this.asTrajectory,o=this.cAlphaOnly,a=n.frames,l=n.boxes,c=this.streamer.peekLines(3);n.title=c[0].trim();var u,h,d,p,f=c[2].length-c[2].lastIndexOf(".")-1+5,m=20+f,g=20+2*f,_=parseInt(c[1]),v=_+3,y=n.atomMap,b=n.atomStore;b.resize(_);var x=0,w=0,S=0;this.streamer.eachChunkOfLines((function(n){!function(n,c,A){for(var M=0;M<c;++M){var C=++S-1,T=A[M];if(T)if(C%v==0)s&&(e=new Float32Array(3*_),a.push(e),t=0);else if(C%v==1);else if(C%v==v-1){var E=T.trim().split(/\s+/),P=new Float32Array(9);if(P[0]=10*parseFloat(E[0]),P[4]=10*parseFloat(E[1]),P[8]=10*parseFloat(E[2]),l.push(P),r)return!0;w+=1}else{if(u=T.substr(10,5).trim(),o&&"CA"!==u)continue;var I=10*parseFloat(T.substr(20,f)),k=10*parseFloat(T.substr(m,f)),R=10*parseFloat(T.substr(g,f));if(s){var D=3*t;if(e[D+0]=I,e[D+1]=k,e[D+2]=R,t+=1,C>v)continue}h=T.substr(5,5).trim(),d=parseInt(T.substr(0,5)),p=parseInt(T.substr(15,5)),b.growIfFull(),b.atomTypeId[x]=y.add(u),b.x[x]=I,b.y[x]=k,b.z[x]=R,b.serial[x]=p,i.addAtom(w,"","",h,d,!1,"l"),x+=1}}}(0,n.length,n)})),i.finalize(),n.finalizeAtoms(),im(n),rm(n),n.finalizeBonds(),em(n),Ql&&Yl.timeEnd("GroParser._parse "+this.name)}});var vS=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function yS(e,t,n){return t?new e(t.buffer,t.byteOffset,t.byteLength/(n||1)):void 0}function bS(e){return yS(DataView,e)}function xS(e){return yS(Int8Array,e)}function wS(e){return yS(Int32Array,e,4)}function SS(e,t){var n=e.length/2;t||(t=new Int16Array(n));for(var i=0,r=0;i<n;++i,r+=2)t[i]=e[r]<<8^e[r+1];return t}function AS(e,t){var n=e.length/4;t||(t=new Int32Array(n));for(var i=0,r=0;i<n;++i,r+=4)t[i]=e[r]<<24^e[r+1]<<16^e[r+2]<<8^e[r+3];return t}function MS(e,t,n){var i=e.length,r=1/t;n||(n=new Float32Array(i));for(var s=0;s<i;++s)n[s]=e[s]*r;return n}function CS(e,t){var n,i;if(!t){var r=0;for(n=0,i=e.length;n<i;n+=2)r+=e[n+1];t=new e.constructor(r)}var s=0;for(n=0,i=e.length;n<i;n+=2)for(var o=e[n],a=e[n+1],l=0;l<a;++l)t[s]=o,++s;return t}function TS(e,t){var n=e.length;t||(t=new e.constructor(n)),n&&(t[0]=e[0]);for(var i=1;i<n;++i)t[i]=e[i]+t[i-1];return t}function ES(e,t){var n,i,r=e instanceof Int8Array?127:32767,s=-r-1,o=e.length;if(!t){var a=0;for(n=0;n<o;++n)e[n]<r&&e[n]>s&&++a;t=new Int32Array(a)}for(n=0,i=0;n<o;){for(var l=0;e[n]===r||e[n]===s;)l+=e[n],++n;l+=e[n],++n,t[i]=l,++i}return t}function PS(e,t,n){return MS(ES(e,wS(n)),t,n)}function IS(e){var t=0,n=new DataView(e.buffer);function i(e){for(var t={},n=0;n<e;n++)t[a()]=a();return t}function r(n){var i=e.subarray(t,t+n);return t+=n,i}function s(n){var i=e.subarray(t,t+n);t+=n;var r=65535;if(n>r){for(var s=[],o=0;o<i.length;o+=r)s.push(String.fromCharCode.apply(null,i.subarray(o,o+r)));return s.join("")}return String.fromCharCode.apply(null,i)}function o(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=a();return t}function a(){var a,l,c=e[t];if(!(128&c))return t++,c;if(128==(240&c))return t++,i(l=15&c);if(144==(240&c))return t++,o(l=15&c);if(160==(224&c))return t++,s(l=31&c);if(!(224&~c))return a=n.getInt8(t),t++,a;switch(c){case 192:return t++,null;case 194:return t++,!1;case 195:return t++,!0;case 196:return l=n.getUint8(t+1),t+=2,r(l);case 197:return l=n.getUint16(t+1),t+=3,r(l);case 198:return l=n.getUint32(t+1),t+=5,r(l);case 202:return a=n.getFloat32(t+1),t+=5,a;case 203:return a=n.getFloat64(t+1),t+=9,a;case 204:return a=e[t+1],t+=2,a;case 205:return a=n.getUint16(t+1),t+=3,a;case 206:return a=n.getUint32(t+1),t+=5,a;case 208:return a=n.getInt8(t+1),t+=2,a;case 209:return a=n.getInt16(t+1),t+=3,a;case 210:return a=n.getInt32(t+1),t+=5,a;case 217:return l=n.getUint8(t+1),t+=2,s(l);case 218:return l=n.getUint16(t+1),t+=3,s(l);case 219:return l=n.getUint32(t+1),t+=5,s(l);case 220:return l=n.getUint16(t+1),t+=3,o(l);case 221:return l=n.getUint32(t+1),t+=5,o(l);case 222:return l=n.getUint16(t+1),t+=3,i(l);case 223:return l=n.getUint32(t+1),t+=5,i(l)}throw new Error("Unknown type 0x"+c.toString(16))}return a()}function kS(e,t,n,i){switch(e){case 1:return function(e,t){var n=e.length;t||(t=new Float32Array(n/4));for(var i=bS(t),r=bS(e),s=0,o=0,a=n/4;s<a;++s,o+=4)i.setFloat32(o,r.getFloat32(o),!0);return t}(t);case 2:return xS(t);case 3:return SS(t);case 4:return AS(t);case 5:return yS(Uint8Array,t);case 6:return CS(AS(t),new Uint8Array(n));case 7:return CS(AS(t));case 8:return function(e){return TS(CS(e),void 0)}(AS(t));case 9:return r=AS(t),s=AS(i)[0],MS(CS(r,wS(o)),s,o);case 10:return function(e,t){var n=ES(e,wS(void 0));return function(e,t,n){return MS(TS(e,wS(n)),t,n)}(n,t,yS(Float32Array,n,4))}(SS(t),AS(i)[0]);case 11:return MS(SS(t),AS(i)[0]);case 12:return PS(SS(t),AS(i)[0]);case 13:return PS(xS(t),AS(i)[0]);case 14:return ES(SS(t));case 15:return ES(xS(t))}var r,s,o}const RS={0:"i".charCodeAt(0),1:"s".charCodeAt(0),2:"h".charCodeAt(0),3:"e".charCodeAt(0),4:"g".charCodeAt(0),5:"b".charCodeAt(0),6:"t".charCodeAt(0),7:"l".charCodeAt(0),"-1":"".charCodeAt(0)};oc.add("mmtf",class extends nS{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let e,t,n,i,r;Ql&&Yl.time("MmtfParser._parse "+this.name);const s=this.structure,o=function(e,t){var n=(t=t||{}).ignoreFields,i={};return vS.forEach((function(t){var r,s,o,a,l,c=!!n&&-1!==n.indexOf(t),u=e[t];c||void 0===u||(u instanceof Uint8Array?i[t]=kS.apply(null,(o=(s=bS(r=u)).getInt32(0),a=s.getInt32(4),l=r.subarray(8,12),[o,r=r.subarray(12),a,l])):i[t]=u)})),i}(IS(this.streamer.data));let a,l,c,u,h,d;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach((function(e){void 0!==o[e]&&(s.header[e]=o[e])})),s.id=o.structureId,s.title=o.title,s.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(h=1,u=o.chainsPerModel[0],c=0,e=0,t=u;e<t;++e)c+=o.groupsPerChain[e];for(l=0,e=0,t=c;e<t;++e)r=o.groupList[o.groupTypeList[e]],l+=r.atomNameList.length;a=o.numBonds,d=[u]}else a=o.numBonds,l=o.numAtoms,c=o.numGroups,u=o.numChains,h=o.numModels,d=o.chainsPerModel;if(a+=c,this.asTrajectory)for(e=0,t=o.numModels;e<t;++e){const t=new Float32Array(3*l),i=l*e;for(n=0;n<l;++n){const e=3*n,r=n+i;t[e]=o.xCoordList[r],t[e+1]=o.yCoordList[r],t[e+2]=o.zCoordList[r]}s.frames.push(t)}const p=new Uint32Array(a),f=new Uint32Array(a),m=new Uint8Array(a),g=new Uint32Array(l),_=new Int8Array(l),v=new Uint32Array(c),y=new Uint32Array(c),b=new Uint32Array(c),x=new Uint16Array(u),w=new Uint32Array(u),S=new Uint32Array(u),A=new Uint32Array(h),M=new Uint32Array(h);let C=0;for(e=0,t=h;e<t;++e){const t=d[e];for(A[e]=C,M[e]=t,n=0;n<t;++n)x[n+C]=e;C+=t}const T=o.groupsPerChain;let E=0;for(e=0,t=u;e<t;++e){const t=T[e];for(w[e]=E,S[e]=t,n=0;n<t;++n)v[n+E]=e;E+=t}let P=0,I=0;for(e=0,t=c;e<t;++e){r=o.groupList[o.groupTypeList[e]];const t=r.atomNameList.length,s=r.formalChargeList,a=r.bondAtomList,l=r.bondOrderList;for(n=0,i=l.length;n<i;++n)p[I]=P+a[2*n],f[I]=P+a[2*n+1],m[I]=l[n],I+=1;for(y[e]=P,b[e]=t,n=0;n<t;++n)g[P]=e,_[P]=s[n],P+=1}const k=o.bondAtomList;if(k)for(o.bondOrderList&&m.set(o.bondOrderList,I),e=0,t=k.length;e<t;e+=2){const t=k[e],n=k[e+1];t<l&&n<l&&(p[I]=t,f[I]=n,I+=1)}s.bondStore.length=m.length,s.bondStore.count=I,s.bondStore.atomIndex1=p,s.bondStore.atomIndex2=f,s.bondStore.bondOrder=m,s.atomStore.length=l,s.atomStore.count=l,s.atomStore.residueIndex=g,s.atomStore.atomTypeId=new Uint16Array(l),s.atomStore.x=o.xCoordList.subarray(0,l),s.atomStore.y=o.yCoordList.subarray(0,l),s.atomStore.z=o.zCoordList.subarray(0,l),s.atomStore.serial=o.atomIdList.subarray(0,l),s.atomStore.bfactor=o.bFactorList.subarray(0,l),s.atomStore.altloc=o.altLocList.subarray(0,l),s.atomStore.occupancy=o.occupancyList.subarray(0,l),s.atomStore.formalCharge=_,s.residueStore.length=c,s.residueStore.count=c,s.residueStore.chainIndex=v,s.residueStore.residueTypeId=o.groupTypeList,s.residueStore.atomOffset=y,s.residueStore.atomCount=b,s.residueStore.resno=o.groupIdList.subarray(0,c),s.residueStore.sstruc=o.secStructList.subarray(0,c),s.residueStore.inscode=o.insCodeList.subarray(0,c),s.chainStore.length=u,s.chainStore.count=u,s.chainStore.entityIndex=new Uint16Array(u),s.chainStore.modelIndex=x,s.chainStore.residueOffset=w,s.chainStore.residueCount=S,s.chainStore.chainname=o.chainNameList.subarray(0,4*u),s.chainStore.chainid=o.chainIdList.subarray(0,4*u),s.modelStore.length=h,s.modelStore.count=h,s.modelStore.chainOffset=A,s.modelStore.chainCount=M;let R={};for(e=0,t=o.groupList.length;e<t;++e){const t=o.groupList[e],r=[];for(n=0,i=t.atomNameList.length;n<i;++n){const e=t.elementList[n].toUpperCase(),i=t.atomNameList[n];r.push(s.atomMap.add(i,e))}const a=t.chemCompType.toUpperCase(),l=cd.includes(a),c=t.bondOrderList.length,u=new Array(c),h=new Array(c);for(n=0;n<c;++n)u[n]=t.bondAtomList[2*n],h[n]=t.bondAtomList[2*n+1];const d={atomIndices1:u,atomIndices2:h,bondOrders:t.bondOrderList};R[e]=s.residueMap.add(t.groupName,r,l,a,d)}for(e=0,t=c;e<t;++e)s.residueStore.residueTypeId[e]=R[s.residueStore.residueTypeId[e]];for(e=0,t=s.atomStore.count;e<t;++e){const t=s.atomStore.residueIndex[e],n=s.residueMap.list[s.residueStore.residueTypeId[t]],i=s.residueStore.atomOffset[t];s.atomStore.atomTypeId[e]=n.atomTypeIdList[e-i]}if(o.secStructList){const n=o.secStructList.length;for(e=0,t=s.residueStore.count;e<t;++e){const t=RS[s.residueStore.sstruc[e%n]];void 0!==t&&(s.residueStore.sstruc[e]=t)}}if(o.entityList&&o.entityList.forEach((function(e,t){s.entityList[t]=new iS(s,t,e.description,e.type,e.chainIndexList)})),o.bioAssemblyList&&o.bioAssemblyList.forEach((function(e,t){const n=t+1,i=new Kf(""+n);s.biomolDict["BU"+n]=i;let r={};e.transformList.forEach((function(e){const t=(new zt).fromArray(e.matrix).transpose(),n=e.chainIndexList.map((function(e){let t="";for(let n=0;n<4;++n){const i=o.chainNameList[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t})),s=r[n.toString()];s?s.matrixList.push(t):r[n.toString()]=i.addPart([t],n)}))})),o.ncsOperatorList){const e="NCS",t=new Kf(e),n=t.addPart();o.ncsOperatorList.forEach((function(e){const t=(new zt).fromArray(e).transpose();n.matrixList.push(t)})),n.matrixList.length>0&&(s.biomolDict[e]=t)}const D=o.unitCell;D&&Array.isArray(D)&&D[0]?s.unitcell=new sS({a:D[0],b:D[1],c:D[2],alpha:D[3],beta:D[4],gamma:D[5],spacegroup:o.spaceGroup}):s.unitcell=void 0,lm(s,!0),am(s,!0),s.finalizeAtoms(),s.finalizeBonds(),cm(s),Ql&&Yl.timeEnd("MmtfParser._parse "+this.name)}});const DS=/\s+/,LS={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};oc.add("mol2",class extends nS{get type(){return"mol2"}_parse(){Ql&&Yl.time("Mol2Parser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,i=this.asTrajectory,r=e.frames;let s,o,a=!1;const l=e.atomMap,c=e.atomStore;c.resize(Math.round(this.streamer.data.length/60)),c.addField("partialCharge",1,"float32");let u=0,h=0,d=0,p=-1,f=0,m=0;const g=e.getAtomProxy(),_=e.getAtomProxy();this.streamer.eachChunkOfLines((function(v){!function(v,y,b){for(let v=0;v<y;++v){const y=b[v].trim();if(""!==y&&"#"!==y[0])if("@"===y[0])"@<TRIPOS>MOLECULE"===y?(m=1,h=0,++p):"@<TRIPOS>ATOM"===y?(m=2,d=c.count,i&&(o=0,s=new Float32Array(3*f),r.push(s),p>0&&(a=!0))):m="@<TRIPOS>BOND"===y?3:0;else if(1===m){if(0===h)e.title=y,e.id=y;else if(1===h){const e=y.split(DS);f=parseInt(e[0])}++h}else if(2===m){const e=y.split(DS);if(n&&p>0)continue;const r=parseFloat(e[2]),h=parseFloat(e[3]),d=parseFloat(e[4]);if(i){const e=3*o;if(s[e+0]=r,s[e+1]=h,s[e+2]=d,o+=1,a)continue}const f=e[0],m=e[1],g=e[5].split(".")[0],_=e[6]?parseInt(e[6]):1,v=e[7]?e[7]:"",b=e[8]?parseFloat(e[8]):0;c.growIfFull(),c.atomTypeId[u]=l.add(m,g),c.x[u]=r,c.y[u]=h,c.z[u]=d,c.serial[u]=+f,c.partialCharge[u]=b,t.addAtom(p,"","",v,_,!0),u+=1}else if(3===m){if(n&&p>0)continue;if(i&&p>0)continue;const t=y.split(DS);g.index=parseInt(t[1])-1+d,_.index=parseInt(t[2])-1+d;const r=LS[t[3]];e.bondStore.addBond(g,_,r)}}}(0,v.length,v)})),t.finalize(),e.finalizeAtoms(),im(e),am(e,!0),lm(e,!0),e.finalizeBonds(),pm(e),em(e),Ql&&Yl.timeEnd("Mol2Parser._parse "+this.name)}}),oc.add("pdbqt",class extends hS{get type(){return"pdbqt"}}),oc.add("pqr",class extends hS{get type(){return"pqr"}});const OS=/> +<(.+)>/;class NS extends nS{get type(){return"sdf"}_parse(){Ql&&Yl.time("SdfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,i=this.asTrajectory,r=this.streamer.peekLines(2);e.id=r[0].trim(),e.title=r[1].trim();const s=e.frames;let o,a,l=!1;const c=e.atomMap,u=e.atomStore;u.resize(Math.round(this.streamer.data.length/50)),u.addField("formalCharge",1,"int8");const h=e.getAtomProxy(),d=e.getAtomProxy();let p=0,f=0,m=0,g=0;const _=[];let v,y,b,x,w,S,A,M,C,T,E,P,I,k,R=!1,D={};e.extraData.sdf=_;let L=!1,O=!1,N=!1,F=[],B=[];const U=new Map;this.streamer.eachChunkOfLines((function(r){!function(r,z,V){for(let r=0;r<z;++r){const z=V[r];if(L&&z&&(F=z.substring(7).split(" "),B.length&&(F=[...B,...F],B=[]),"-"===F[F.length-1]))F.pop(),B=F;else{if("$$$$"===z.substr(0,4))f=-1,++m,g=u.count,_.push(D),D={},R=!1,L=!1;else if(3===f)L=z.indexOf(" V3000")>-1,L?U.clear():(y=parseInt(z.substr(0,3)),b=parseInt(z.substr(3,3)),x=4,w=x+y,S=w,A=S+b,i&&(a=0,o=new Float32Array(3*y),s.push(o),m>0&&(l=!0)));else if(L&&"COUNTS"===F[0])y=parseInt(F[1]),i&&(a=0,o=new Float32Array(3*y),s.push(o),m>0&&(l=!0));else if(L&&2==F.length)"ATOM"===F[1]?"BEGIN"===F[0]?O=!0:"END"===F[0]&&(O=!1):"BOND"===F[1]&&("BEGIN"===F[0]?N=!0:"END"===F[0]&&(N=!1));else if(O||!L&&f>=x&&f<w){if(n&&m>0)continue;let e=0;if(L){if(M=parseFloat(F[2]),C=parseFloat(F[3]),T=parseFloat(F[4]),P=F[1],I=parseInt(F[0]),U.set(I,p),E=P+I,F.length>6){let t=F.slice(6).find((e=>0===e.indexOf("CHG=")));t&&(e=parseInt(t.substring(4)))}}else M=parseFloat(z.substr(0,10)),C=parseFloat(z.substr(10,10)),T=parseFloat(z.substr(20,10)),P=z.substr(31,3).trim(),E=P+(p-g+1);if(i){const e=3*a;if(o[e+0]=M,o[e+1]=C,o[e+2]=T,a+=1,l)continue}u.growIfFull(),u.atomTypeId[p]=c.add(E,P),u.x[p]=M,u.y[p]=C,u.z[p]=T,u.serial[p]=L?I:p,u.formalCharge[p]=e,t.addAtom(m,"","","HET",1,!0),p+=1}else if(N||!L&&f>=S&&f<A){if(n&&m>0)continue;if(i&&m>0)continue;L?(h.index=U.get(parseInt(F[2])),d.index=U.get(parseInt(F[3])),k=parseInt(F[1])):(h.index=parseInt(z.substr(0,3))-1+g,d.index=parseInt(z.substr(3,3))-1+g,k=parseInt(z.substr(6,3))),e.bondStore.addBond(h,d,k)}else if("M  CHG"===z.substr(0,6)){const e=parseInt(z.substr(6,3));for(let t=0,n=10;t<e;++t,n+=8){const e=parseInt(z.substr(n,3))-1+g,t=parseInt(z.substr(n+4,3));u.formalCharge[e]=t}}else">"===z.charAt(0)&&(v=z.match(OS))?(R=v[1],D[R]=[]):!1!==R&&z&&D[R].push(z);++f}}}(0,r.length,r)})),t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),pm(e),Ql&&Yl.timeEnd("SdfParser._parse "+this.name)}_postProcess(){pm(this.structure)}}function FS(e,t,n){return parseInt(e.substr(t,n).trim())}oc.add("sdf",NS),oc.add("sd",NS),oc.add("mol",NS);class BS extends nS{get type(){return"prmtop"}_parse(){Ql&&Yl.time("PrmtopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,i=e.atomStore;i.addField("partialCharge",1,"float32"),i.addField("radius",1,"float32");const r=[],s={},o=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let a,l,c,u,h;o.forEach((e=>{s[e]=0}));let d,p,f,m,g,_=new Uint8Array(0);this.streamer.eachChunkOfLines((function(e){!function(e,t,n){for(let e=0;e<t;++e){const t=n[e],v=t.trim();if(v)if(t.startsWith("%FORMAT"));else if(t.startsWith("%FLAG")){const e=t.substr(5).trim();m=0,"TITLE"===e?f=0:"POINTERS"===e?f=1:"ATOM_NAME"===e?f=2:"CHARGE"===e?f=3:"MASS"===e?f=4:"RESIDUE_LABEL"===e?f=5:"RESIDUE_POINTER"===e?f=6:"BONDS_INC_HYDROGEN"===e?(g=0,f=7):"BONDS_WITHOUT_HYDROGEN"===e?(g=s.NBONH,f=8):f="RADII"===e?9:void 0}else if(0===f)r.push(v);else if(1===f){const e=Math.min(m+10,32);for(let n=0;m<e;++n,++m)s[o[m]]=parseInt(t.substr(8*n,8).trim());a=new Array(s.NATOM),l=new Float32Array(s.NATOM),c=new Float32Array(s.NATOM),i.resize(s.NATOM);const n=s.NBONH+s.MBONA;u=new Uint32Array(n),h=new Uint32Array(n),_=new Uint8Array(n),d=new Array(s.NRES),p=new Uint32Array(s.NRES)}else if(2===f){const e=Math.min(m+20,s.NATOM);for(let n=0;m<e;++n,++m)a[m]=t.substr(4*n,4).trim()}else if(3===f){const e=Math.min(m+5,s.NATOM);for(let n=0;m<e;++n,++m)l[m]=parseFloat(t.substr(16*n,16))/18.2223}else if(4===f);else if(5===f){const e=Math.min(m+20,s.NRES);for(let n=0;m<e;++n,++m)d[m]=t.substr(4*n,4).trim()}else if(6===f){const e=Math.min(m+10,s.NRES);for(let n=0;m<e;++n,++m)p[m]=FS(t,8*n,8)}else if(7===f){const e=Math.min(m+10,3*s.NBONH);for(let n=0;m<e;++n,++m){const e=m%3;0===e&&(u[g]=FS(t,8*n,8)/3),1===e&&(h[g]=FS(t,8*n,8)/3,_[g]=1,++g)}}else if(8===f){const e=Math.min(m+10,3*s.MBONA);for(let n=0;m<e;++n,++m){const e=m%3;0===e&&(u[g]=FS(t,8*n,8)/3),1===e&&(h[g]=FS(t,8*n,8)/3,_[g]=1,++g)}}else if(9===f){const e=Math.min(m+5,s.NATOM);for(let n=0;m<e;++n,++m)c[m]=parseFloat(t.substr(16*n,16))}}}(0,e.length,e)})),e.title=r.join(" ");const v=s.NATOM;let y=0,b=d[0],x=1;for(let e=0;e<v;++e)e+1===p[y+1]&&(++y,b=d[y],x=y+1),i.atomTypeId[e]=n.add(a[e]),i.serial[e]=e+1,t.addAtom(0,"","",b,x,!1);i.partialCharge.set(l),i.radius.set(c),e.bondStore.length=_.length,e.bondStore.count=_.length,e.bondStore.atomIndex1=u,e.bondStore.atomIndex2=h,e.bondStore.bondOrder=_,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),am(e,!0),lm(e,!0,!0),im(e,!0),pm(e),Ql&&Yl.timeEnd("PrmtopParser._parse "+this.name)}}oc.add("prmtop",BS),oc.add("parm7",BS);const US=/\s+/,zS=/(^\*|REMARK)*/;oc.add("psf",class extends nS{get type(){return"psf"}_parse(){Ql&&Yl.time("PsfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,i=e.atomStore;i.addField("partialCharge",1,"float32");const r=[];let s,o,a,l,c,u,h=0,d=0,p=0;this.streamer.eachChunkOfLines((function(e){!function(e,f,m){for(let e=0;e<f;++e){const f=m[e].trim();if(f)if(2===s){const e=f.split(US),r=parseInt(e[0]),s=e[1],l=parseInt(e[2]),c=e[3],u=e[4],p=parseFloat(e[6]);s!==a&&(o=nm(d),++d),i.growIfFull(),i.atomTypeId[h]=n.add(u),i.serial[h]=r,i.partialCharge[h]=p,t.addAtom(0,o,o,c,l,!1),h+=1,a=s}else if(3===s){const e=f.split(US);for(let t=0,n=e.length;t<n;t+=2)l[p]=parseInt(e[t])-1,c[p]=parseInt(e[t+1])-1,u[p]=1,p+=1}else if(1===s)r.push(f.replace(zS,"").trim());else if(4===s);else if(5===s);else if(6===s);else if(f.includes("!NATOM")){s=2;const e=parseInt(f.split(US)[0]);i.resize(e)}else if(f.includes("!NBOND")){s=3;const e=parseInt(f.split(US)[0]);l=new Uint32Array(e),c=new Uint32Array(e),u=new Uint8Array(e)}else f.includes("!NTITLE")?s=1:f.includes("!NTHETA")?s=4:f.includes("!NPHI")?s=5:f.includes("!NIMPHI")&&(s=6);else s=void 0}}(0,e.length,e)})),e.title=r.join(" "),e.bondStore.length=u.length,e.bondStore.count=p,e.bondStore.atomIndex1=l,e.bondStore.atomIndex2=c,e.bondStore.bondOrder=u,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),am(e,!0),lm(e,!0,!0),pm(e),Ql&&Yl.timeEnd("PsfParser._parse "+this.name)}});const VS=/\[ (.+) \]/,HS=/\s+/;oc.add("top",class extends nS{get type(){return"top"}_parse(){Ql&&Yl.time("TopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,i=e.bondStore,r=e.atomStore;r.addField("partialCharge",1,"float32");const s=[],o={};let a,l;this.streamer.eachChunkOfLines((function(t){!function(t,n,i){for(let t=0;t<n;++t){const n=i[t];let r=n.trim();if(!r||"*"===r[0]||";"===r[0])continue;if(r.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const c=n.match(VS);if(null!==c){const e=c[1];"moleculetype"===e?(l=2,a={atoms:[],bonds:[]}):l="atoms"===e?3:"bonds"===e?4:"system"===e?0:"molecules"===e?1:void 0;continue}const u=r.indexOf(";");if(-1!==u&&(r=r.substring(0,u).trim()),2===l){const e=r.split(HS)[0];o[e]=a}else if(3===l){const e=r.split(HS);a.atoms.push([parseInt(e[2]),e[3],e[4],parseFloat(e[6])])}else if(4===l){const e=r.split(HS);a.bonds.push([parseInt(e[0]),parseInt(e[1])])}else if(0===l)e.title=r;else if(1===l){const e=r.split(HS);s.push([e[0],parseInt(e[1])])}}}(0,t.length,t)}));let c=0,u=0;s.forEach((function(e){const[t,n]=e,i=o[t];c+=n*i.atoms.length,u+=n*i.bonds.length})),r.resize(c),i.resize(u);let h,d=0,p=0,f=0,m=0,g=0,_=0;s.forEach((function(e){const[s,a]=e,l=o[s],c=nm(m);for(let e=0;e<a;++e){h=-1;const e=Cd.includes(s)?c:nm(f);l.atoms.forEach((function(i){const[s,o,a,l]=i;s!==h&&++p,r.atomTypeId[d]=n.add(a),r.serial[d]=d+1,r.partialCharge[d]=l,t.addAtom(0,c,e,o,p+1,!1),++d,h=s})),l.bonds.forEach((function(e){i.atomIndex1[g]=_+e[0]-1,i.atomIndex2[g]=_+e[1]-1,++g})),++f,_+=l.atoms.length}++m})),i.count=u,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),am(e,!0),lm(e,!0,!0),pm(e),Ql&&Yl.timeEnd("TopParser._parse "+this.name)}});class $S extends tS{constructor(e,t){super(e,t),this.frames=new Cg(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function GS(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function jS(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function WS(e){const t=e.readUint32(),n=e.readChars(t);return jS(e),n}oc.add("dcd",class extends $S{get type(){return"dcd"}get isBinary(){return!0}_parse(){Ql&&Yl.time("DcdParser._parse "+this.name);const e=Ua(this.streamer.data),t=new DataView(e),n=this.frames,i=n.coordinates,r=n.boxes,s={};let o=0;const a=new Int32Array(e,0,23),l=a[0]!==t.getInt32(0);if(84!==a[0]){const n=e.byteLength;for(let e=0;e<n;e+=4)t.setFloat32(e,t.getFloat32(e),!0)}84!==a[0]&&Yl.error("dcd bad format, header block start"),"CORD"!==String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7))&&Yl.error("dcd bad format, format string");let c=!1,u=!1,h=!1;0!==a[22]&&(c=!0,0!==a[12]&&(u=!0),1===a[13]&&(h=!0)),s.NSET=a[2],s.ISTART=a[3],s.NSAVC=a[4],s.NAMNF=a[10],s.DELTA=c?t.getFloat32(44,l):t.getFloat64(44,l),84!==a[22]&&Yl.error("dcd bad format, header block end"),o=o+84+8;const d=t.getInt32(o,l),p=o+1;if((d-4)%80!=0&&Yl.error("dcd bad format, title block start"),s.TITLE=Na(new Uint8Array(e,p,d)),t.getInt32(p+d+4-1,l)!==d&&Yl.error("dcd bad format, title block end"),o=o+d+8,4!==t.getInt32(o,l)&&Yl.error("dcd bad format, natom block start"),s.NATOM=t.getInt32(o+4,l),4!==t.getInt32(o+8,l)&&Yl.error("dcd bad format, natom block end"),o=o+4+8,s.NAMNF>0)return void Yl.error("dcd format with fixed atoms unsupported, aborting");const f=s.NATOM,m=4*f;for(let n=0,a=s.NSET;n<a;++n){if(u){o+=4;const e=new Float32Array(9);e[0]=t.getFloat64(o,l),e[4]=t.getFloat64(o+16,l),e[8]=t.getFloat64(o+40,l),r.push(e),o+=48,o+=4}const s=new Float32Array(3*f);for(let i=0;i<3;++i){t.getInt32(o,l)!==m&&Yl.error("dcd bad format, coord block start",n,i),o+=4;const r=new Float32Array(e,o,f);for(let e=0;e<f;++e)s[3*e+i]=r[e];o+=m,t.getInt32(o,l)!==m&&Yl.error("dcd bad format, coord block end",n,i),o+=4}i.push(s),h&&(o+=4+t.getInt32(o,l)+4)}s.DELTA&&(n.deltaTime=20.45482949774598*s.DELTA),s.ISTART>=1&&(n.timeOffset=(s.ISTART-1)*n.deltaTime),Ql&&Yl.timeEnd("DcdParser._parse "+this.name)}});function qS(e){switch(Number(e)){case 1:return"byte";case 2:return"char";case 3:return"short";case 4:return"int";case 5:return"float";case 6:return"double";default:return"undefined"}}function XS(e){switch(Number(e)){case 1:case 2:return 1;case 3:return 2;case 4:case 5:return 4;case 6:return 8;default:return-1}}function YS(e){switch(String(e)){case"byte":return 1;case"char":return 2;case"short":return 3;case"int":return 4;case"float":return 5;case"double":return 6;default:return-1}}function KS(e,t){if(1!==e){const n=new Array(e);for(let i=0;i<e;i++)n[i]=t();return n}return t()}function ZS(e,t,n){switch(t){case 1:return e.readBytes(n);case 2:return function(e){return 0===e.charCodeAt(e.length-1)?e.substring(0,e.length-1):e}(e.readChars(n));case 3:return KS(n,e.readInt16.bind(e));case 4:return KS(n,e.readInt32.bind(e));case 5:return KS(n,e.readFloat32.bind(e));case 6:return KS(n,e.readFloat64.bind(e));default:return void GS(!0,"non valid type "+t)}}function QS(e){let t;const n=e.readUint32();if(0===n)return GS(0!==e.readUint32(),"wrong empty tag for list of attributes"),[];{GS(12!==n,"wrong tag for list of attributes");const i=e.readUint32();t=new Array(i);for(let n=0;n<i;n++){const i=WS(e),r=e.readUint32();GS(r<1||r>6,"non valid type "+r);const s=e.readUint32(),o=ZS(e,r,s);jS(e),t[n]={name:i,type:qS(r),value:o}}}return t}class JS{constructor(e){const t=new Ic(e);t.setBigEndian(),GS("CDF"!==t.readChars(3),"should start with CDF");const n=t.readByte();GS(n>2,"unknown version"),this.header=function(e,t){const n={recordDimension:{length:e.readUint32()}};n.version=t;const i=function(e){let t,n,i;const r=e.readUint32();if(0===r)return GS(0!==e.readUint32(),"wrong empty tag for list of dimensions"),[];{GS(10!==r,"wrong tag for list of dimensions");const s=e.readUint32();t=new Array(s);for(let r=0;r<s;r++){const s=WS(e),o=e.readUint32();0===o&&(n=r,i=s),t[r]={name:s,size:o}}return{dimensions:t,recordId:n,recordName:i}}}(e);n.recordDimension.id=i.recordId,n.recordDimension.name=i.recordName,n.dimensions=i.dimensions,n.globalAttributes=QS(e);const r=function(e,t,n){const i=e.readUint32();let r,s=0;if(0===i)return GS(0!==e.readUint32(),"wrong empty tag for list of variables"),[];{GS(11!==i,"wrong tag for list of variables");const o=e.readUint32();r=new Array(o);for(let i=0;i<o;i++){const o=WS(e),a=e.readUint32(),l=new Array(a);for(let t=0;t<a;t++)l[t]=e.readUint32();const c=QS(e),u=e.readUint32();GS(u<1&&u>6,"non valid type "+u);const h=e.readUint32();let d=e.readUint32();2===n&&(GS(d>0,"offsets larger than 4GB not supported"),d=e.readUint32()),l[0]===t&&(s+=h),r[i]={name:o,dimensions:l,attributes:c,type:qS(u),size:h,offset:d,record:l[0]===t}}}return{variables:r,recordStep:s}}(e,i.recordId,t);return n.variables=r.variables,n.recordDimension.recordStep=r.recordStep,n}(t,n),this.buffer=t}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return-1!==this.header.variables.findIndex((function(t){return t.name===e}))}getDataVariable(e){let t;return t="string"==typeof e?this.header.variables.find((function(t){return t.name===e})):e,GS(void 0===t,"variable not found"),this.buffer.seek(t.offset),t.record?function(e,t,n){const i=YS(t.type),r=t.size?t.size/XS(i):1,s=n.length,o=new Array(s),a=n.recordStep;for(let t=0;t<s;t++){const n=e.offset;o[t]=ZS(e,i,r),e.seek(n+a)}return o}(this.buffer,t,this.header.recordDimension):function(e,t){const n=YS(t.type),i=t.size/XS(n),r=new Array(i);for(let t=0;t<i;t++)r[t]=ZS(e,n,1);return r}(this.buffer,t)}}class eA extends $S{get type(){return"nctraj"}get isBinary(){return!0}_parse(){Ql&&Yl.time("NctrajParser._parse "+this.name);const e=new JS(this.streamer.data),t=this.frames,n=t.coordinates,i=t.boxes,r=t.times;e.getDataVariable("coordinates").forEach((function(e){n.push(new Float32Array(e))})),e.hasDataVariable("cell_lengths")&&e.getDataVariable("cell_lengths").forEach((function(e){i.push(new Float32Array(e))})),e.hasDataVariable("time")&&e.getDataVariable("time").forEach((function(e){r.push(e)})),r.length>=1&&(t.timeOffset=r[0]),r.length>=2&&(t.deltaTime=r[1]-r[0]),Ql&&Yl.timeEnd("NctrajParser._parse "+this.name)}}oc.add("nctraj",eA),oc.add("ncdf",eA),oc.add("nc",eA),oc.add("trr",class extends $S{get type(){return"trr"}get isBinary(){return!0}_parse(){Ql&&Yl.time("TrrParser._parse "+this.name);const e=Ua(this.streamer.data),t=new DataView(e),n=this.frames,i=n.coordinates,r=n.boxes,s=n.times;let o=0;for(;;){o+=8;const n=t.getInt32(o);o+=4,o+=n;const a=t.getInt32(o+8),l=t.getInt32(o+12),c=t.getInt32(o+16),u=t.getInt32(o+28),h=t.getInt32(o+32),d=t.getInt32(o+36),p=t.getInt32(o+40);o+=52;const f=a/9,m=3*p;if(8===f?s.push(t.getFloat64(o)):s.push(t.getFloat32(o)),o+=2*f,a){const e=new Float32Array(9);if(8===f)for(let n=0;n<9;++n)e[n]=10*t.getFloat64(o),o+=8;else for(let n=0;n<9;++n)e[n]=10*t.getFloat32(o),o+=4;r.push(e)}if(o+=l,o+=c,u){let n;if(8===f){n=new Float32Array(m);for(let e=0;e<m;++e)n[e]=10*t.getFloat64(o),o+=8}else{const t=new Uint32Array(e,o,m);for(let e=0;e<m;++e){const n=t[e];t[e]=(255&n)<<24|(65280&n)<<8|n>>8&65280|n>>24&255}n=new Float32Array(e,o,m);for(let e=0;e<m;++e)n[e]*=10,o+=4}i.push(n)}if(o+=h,o+=d,o>=e.byteLength)break}s.length>=1&&(n.timeOffset=s[0]),s.length>=2&&(n.deltaTime=s[1]-s[0]),Ql&&Yl.timeEnd("TrrParser._parse "+this.name)}});const tA=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function nA(e){let t=1,n=0;for(;e>=t&&n<32;)n++,t<<=1;return n}const iA=new Uint8Array(32);function rA(e,t){let n=1,i=0;iA[0]=1;for(let i=0;i<e;i++){let e,r=0;for(e=0;e<n;e++)r+=iA[e]*t[i],iA[e]=255&r,r>>=8;for(;0!==r;)iA[e++]=255&r,r>>=8;n=e}let r=1;for(n--;iA[n]>=r;)i++,r*=2;return i+8*n}function sA(e,t,n,i){const r=(1<<n)-1;let s=i[1],o=i[2],a=e[0],l=0;for(;n>=8;)o=o<<8|t[a++],l|=o>>s<<n-8,n-=8;return n>0&&(s<n&&(s+=8,o=o<<8|t[a++]),s-=n,l|=o>>s&(1<<n)-1),l&=r,e[0]=a,e[1]=s,e[2]=o,l}const oA=new Int32Array(32);function aA(e,t,n,i,r,s,o){let a=0;for(oA[1]=0,oA[2]=0,oA[3]=0;i>8;)oA[a++]=sA(e,t,8,o),i-=8;i>0&&(oA[a++]=sA(e,t,i,o));for(let e=n-1;e>0;e--){let t=0;for(let n=a-1;n>=0;n--){t=t<<8|oA[n];const i=t/r[e]|0;oA[n]=i,t-=i*r[e]}s[e]=t}s[0]=oA[0]|oA[1]<<8|oA[2]<<16|oA[3]<<24}oc.add("xtc",class extends $S{get type(){return"xtc"}get isBinary(){return!0}_parse(){Ql&&Yl.time("XtcParser._parse "+this.name);const e=Ua(this.streamer.data),t=new DataView(e),n=this.frames,i=n.coordinates,r=n.boxes,s=n.times,o=new Int32Array(6),a=new Int32Array(3),l=new Int32Array(3),c=new Uint32Array(3),u=new Float32Array(3),h=new Float32Array(3);let d=0;const p=new Int32Array(3),f=new Uint32Array(p.buffer);for(;;){let n;const m=t.getInt32(d+4);d+=12;const g=3*m;s.push(t.getFloat32(d)),d+=4;const _=new Float32Array(9);for(let e=0;e<9;++e)_[e]=10*t.getFloat32(d),d+=4;if(r.push(_),m<=9){n=new Float32Array(m);for(let e=0;e<m;++e)n[e]=t.getFloat32(d),d+=4}else{p[0]=p[1]=p[2]=0,a[0]=a[1]=a[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,h[0]=h[1]=h[2]=0,n=new Float32Array(g);let i=0;const r=t.getInt32(d);d+=4;const s=t.getFloat32(d);let m;d+=4,o[0]=t.getInt32(d),o[1]=t.getInt32(d+4),o[2]=t.getInt32(d+8),o[3]=t.getInt32(d+12),o[4]=t.getInt32(d+16),o[5]=t.getInt32(d+20),a[0]=o[3]-o[0]+1,a[1]=o[4]-o[1]+1,a[2]=o[5]-o[2]+1,d+=24,(a[0]|a[1]|a[2])>16777215?(l[0]=nA(a[0]),l[1]=nA(a[1]),l[2]=nA(a[2]),m=0):m=rA(3,a);let _=t.getInt32(d);d+=4;let v=_-1;v=9>v?9:v;let y=tA[v]/2|0,b=tA[_]/2|0;c[0]=c[1]=c[2]=tA[_];let x=4*Math.ceil(t.getInt32(d)/4);d+=4;const w=1/s;let S=0,A=0;const M=new Uint8Array(e,d);for(u[0]=u[1]=u[2]=0;A<r;){0===m?(u[0]=sA(p,M,l[0],f),u[1]=sA(p,M,l[1],f),u[2]=sA(p,M,l[2],f)):aA(p,M,3,m,a,u,f),A++,u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],h[0]=u[0],h[1]=u[1],h[2]=u[2];let e=0;if(1===sA(p,M,1,f)&&(S=sA(p,M,5,f),e=S%3,S-=e,e--),S>0){u[0]=u[1]=u[2]=0;for(let e=0;e<S;e+=3){if(aA(p,M,3,_,c,u,f),A++,u[0]+=h[0]-b,u[1]+=h[1]-b,u[2]+=h[2]-b,0===e){let e=u[0];u[0]=h[0],h[0]=e,e=u[1],u[1]=h[1],h[1]=e,e=u[2],u[2]=h[2],h[2]=e,n[i++]=h[0]*w,n[i++]=h[1]*w,n[i++]=h[2]*w}else h[0]=u[0],h[1]=u[1],h[2]=u[2];n[i++]=u[0]*w,n[i++]=u[1]*w,n[i++]=u[2]*w}}else n[i++]=u[0]*w,n[i++]=u[1]*w,n[i++]=u[2]*w;if(_+=e,e<0?(b=y,y=_>9?tA[_-1]/2|0:0):e>0&&(y=b,b=tA[_]/2|0),c[0]=c[1]=c[2]=tA[_],0===c[0]||0===c[1]||0===c[2])return void console.error("(xdrfile error) Undefined error.")}d+=x}for(let e=0;e<g;e++)n[e]*=10;if(i.push(n),d>=e.byteLength)break}s.length>=1&&(n.timeOffset=s[0]),s.length>=2&&(n.deltaTime=s[1]-s[0]),Ql&&Yl.timeEnd("XtcParser._parse "+this.name)}});class lA extends tS{constructor(e,t){const n=t||{};super(e,n),this.volume=new qp(this.name,this.path),this.voxelSize=Aa(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new zt}}const cA=/\s+/,uA=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,hA=.529177210859;class dA extends lA{get type(){return"cube"}_parse(){Ql&&Yl.time("CubeParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(6),n={},i=hA*this.voxelSize;function r(e,n){var i=t[e].trim().split(cA)[n];return parseFloat(i)}n.atomCount=Math.abs(r(2,0)),n.originX=r(2,1)*hA,n.originY=r(2,2)*hA,n.originZ=r(2,3)*hA,n.NVX=r(3,0),n.NVY=r(4,0),n.NVZ=r(5,0),n.basisX=new ut(r(3,1),r(3,2),r(3,3)).multiplyScalar(i),n.basisY=new ut(r(4,1),r(4,2),r(4,3)).multiplyScalar(i),n.basisZ=new ut(r(5,1),r(5,2),r(5,3)).multiplyScalar(i);const s=new Float32Array(n.NVX*n.NVY*n.NVZ);let o=0,a=0;const l=r(2,0)>0?0:1;this.streamer.eachChunkOfLines((function(e){!function(e,t,i){for(let e=0;e<t;++e){const t=i[e].trim();if(""!==t&&a>=n.atomCount+6+l){const e=t.match(uA);for(let t=0,n=e.length;t<n;++t)s[o]=parseFloat(e[t]),++o}++a}}(0,e.length,e)})),e.header=n,e.setData(s,n.NVZ,n.NVY,n.NVX),Ql&&Yl.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new zt;return t.multiply((new zt).makeTranslation(e.originX,e.originY,e.originZ)),t.multiply((new zt).makeBasis(e.basisZ,e.basisY,e.basisX)),t}}oc.add("cub",dA),oc.add("cube",dA);class pA extends lA{get type(){return"dsn6"}get isBinary(){return!0}_parse(){Ql&&Yl.time("Dsn6Parser._parse "+this.name);const e=this.volume,t={};let n,i;const r=Ua(this.streamer.data),s=new Int16Array(r),o=new Uint8Array(r),a=String.fromCharCode.apply(null,o.subarray(0,512));if(a.startsWith(":-)"))t.xStart=parseInt(a.substr(10,5)),t.yStart=parseInt(a.substr(15,5)),t.zStart=parseInt(a.substr(20,5)),t.xExtent=parseInt(a.substr(32,5)),t.yExtent=parseInt(a.substr(38,5)),t.zExtent=parseInt(a.substr(42,5)),t.xRate=parseInt(a.substr(52,5)),t.yRate=parseInt(a.substr(58,5)),t.zRate=parseInt(a.substr(62,5)),t.xlen=parseFloat(a.substr(73,10))*this.voxelSize,t.ylen=parseFloat(a.substr(83,10))*this.voxelSize,t.zlen=parseFloat(a.substr(93,10))*this.voxelSize,t.alpha=parseFloat(a.substr(103,10)),t.beta=parseFloat(a.substr(113,10)),t.gamma=parseFloat(a.substr(123,10)),n=parseFloat(a.substr(138,12))/100,i=parseInt(a.substr(155,8)),t.sigma=100*parseFloat(a.substr(170,12));else{if(100!==s[18])for(let e=0,t=s.length;e<t;++e){const t=s[e];s[e]=(255&t)<<8|t>>8&255}t.xStart=s[0],t.yStart=s[1],t.zStart=s[2],t.xExtent=s[3],t.yExtent=s[4],t.zExtent=s[5],t.xRate=s[6],t.yRate=s[7],t.zRate=s[8];const e=1/s[17],r=e*this.voxelSize;t.xlen=s[9]*r,t.ylen=s[10]*r,t.zlen=s[11]*r,t.alpha=s[12]*e,t.beta=s[13]*e,t.gamma=s[14]*e,n=s[15]/100,i=s[16],t.gamma=s[14]*e}e.header=t,Ql&&Yl.log(t,n,i);const l=new Float32Array(t.xExtent*t.yExtent*t.zExtent);let c=512;const u=Math.ceil(t.xExtent/8),h=Math.ceil(t.yExtent/8),d=Math.ceil(t.zExtent/8);for(var p=0;p<d;++p)for(var f=0;f<h;++f)for(var m=0;m<u;++m)for(var g=0;g<8;++g)for(var _=8*p+g,v=0;v<8;++v)for(var y=8*f+v,b=0;b<8;++b){var x=8*m+b;if(!(x<t.xExtent&&y<t.yExtent&&_<t.zExtent)){c+=8-b;break}l[(x*t.yExtent+y)*t.zExtent+_]=(o[c]-i)/n,++c}e.setData(l,t.zExtent,t.yExtent,t.xExtent),t.sigma&&e.setStats(void 0,void 0,void 0,t.sigma),Ql&&Yl.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const r=[[],t,n,i],s=[0,e.xRate,e.yRate,e.zRate],o=[0,1,2,3],a=new zt;return a.set(r[o[1]][0]/s[o[1]],r[o[2]][0]/s[o[2]],r[o[3]][0]/s[o[3]],0,r[o[1]][1]/s[o[1]],r[o[2]][1]/s[o[2]],r[o[3]][1]/s[o[3]],0,r[o[1]][2]/s[o[1]],r[o[2]][2]/s[o[2]],r[o[3]][2]/s[o[3]],0,0,0,0,1),a.multiply((new zt).makeRotationY(qa(90))),a.multiply((new zt).makeTranslation(-e.zStart,e.yStart,e.xStart)),a.multiply((new zt).makeScale(-1,1,1)),a}}oc.add("dsn6",pA),oc.add("brix",pA);const fA=/\s+/;class mA extends lA{get type(){return"dx"}_parse(){Ql&&Yl.time("DxParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(30),n=this.parseHeaderLines(t),i=this.volume.header,r=n.dataLineStart,s=i.nx*i.ny*i.nz,o=new Float32Array(s);let a=0,l=0;this.streamer.eachChunkOfLines((function(e){!function(e,t,n){for(let e=0;e<t;++e){if(a<s&&l>r){const t=n[e].trim();if(""!==t){const e=t.split(fA);for(let t=0,n=e.length;t<n;++t)o[a]=parseFloat(e[t]),++a}}++l}}(0,e.length,e)})),e.setData(o,i.nz,i.ny,i.nx),Ql&&Yl.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},n=e.length;let i=0,r=0,s=0;for(let o=0;o<n;++o){let n;const a=e[o];if(a.startsWith("object 1"))n=a.split(fA),t.nx=parseInt(n[5]),t.ny=parseInt(n[6]),t.nz=parseInt(n[7]);else if(a.startsWith("origin"))n=a.split(fA),t.xmin=parseFloat(n[1]),t.ymin=parseFloat(n[2]),t.zmin=parseFloat(n[3]);else if(a.startsWith("delta"))n=a.split(fA),0===s?t.hx=parseFloat(n[1])*this.voxelSize:1===s?t.hy=parseFloat(n[2])*this.voxelSize:2===s&&(t.hz=parseFloat(n[3])*this.voxelSize),s+=1;else if(a.startsWith("object 3")){i=o,r+=a.length+1;break}r+=a.length+1}return this.volume.header=t,{dataLineStart:i,headerByteCount:r}}getMatrix(){const e=this.volume.header,t=new zt;return t.multiply((new zt).makeRotationY(qa(90))),t.multiply((new zt).makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply((new zt).makeScale(-e.hz,e.hy,e.hx)),t}}oc.add("dx",mA),oc.add("dxbin",class extends mA{get type(){return"dxbin"}get isBinary(){return!0}_parse(){Ql&&Yl.time("DxbinParser._parse "+this.name);const e=Ua(this.streamer.data),t=function(e,t=10485760,n="\n"){let i="",r=[];for(let s=0;s<e.length;s+=t){const o=Na(e.subarray(s,s+t)),a=o.lastIndexOf(n);if(-1===a)i+=o;else{const e=i+o.substr(0,a);r=r.concat(e.split(n)),i=a===o.length-n.length?"":o.substr(a+n.length)}}return""!==i&&r.push(i),r}(new Uint8Array(e,0,1e3)),n=this.parseHeaderLines(t),i=this.volume.header,r=n.headerByteCount,s=i.nx*i.ny*i.nz,o=new DataView(e),a=new Float32Array(s);for(let e=0;e<s;++e)a[e]=o.getFloat64(8*e+r,!0);this.volume.setData(a,i.nz,i.ny,i.nx),Ql&&Yl.timeEnd("DxbinParser._parse "+this.name)}});class gA extends lA{get type(){return"mrc"}get isBinary(){return!0}_parse(){Ql&&Yl.time("MrcParser._parse "+this.name);const e=this.volume,t={},n=Ua(this.streamer.data),i=new Int32Array(n,0,56),r=new Float32Array(n,0,56),s=new DataView(n);if(t.MAP=String.fromCharCode(s.getUint8(208),s.getUint8(209),s.getUint8(210),s.getUint8(211)),t.MACHST=[s.getUint8(212),s.getUint8(213)],17===t.MACHST[0]&&17===t.MACHST[1]){const e=n.byteLength;for(let t=0;t<e;t+=4)s.setFloat32(t,s.getFloat32(t),!0)}let o;if(t.NX=i[0],t.NY=i[1],t.NZ=i[2],t.MODE=i[3],t.NXSTART=i[4],t.NYSTART=i[5],t.NZSTART=i[6],t.MX=i[7],t.MY=i[8],t.MZ=i[9],t.xlen=r[10]*this.voxelSize,t.ylen=r[11]*this.voxelSize,t.zlen=r[12]*this.voxelSize,t.alpha=r[13],t.beta=r[14],t.gamma=r[15],t.MAPC=i[16],t.MAPR=i[17],t.MAPS=i[18],t.DMIN=r[19],t.DMAX=r[20],t.DMEAN=r[21],t.ISPG=i[22],t.NSYMBT=i[23],t.LSKFLG=i[24],t.originX=r[49],t.originY=r[50],t.originZ=r[51],t.ARMS=r[54],e.header=t,2===t.MODE)o=new Float32Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ);else if(0===t.MODE){if(o=new Float32Array(new Int8Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ)),-128===i[39]&&127===i[40]){const e=(t.DMAX-t.DMIN)/255,n=.5*(t.DMIN+t.DMAX+e);for(let t=0,i=o.length;t<i;++t)o[t]=e*o[t]+n}}else Yl.error("MrcParser unknown mode",t.MODE);e.setData(o,t.NX,t.NY,t.NZ),0!==t.ARMS&&e.setStats(t.DMIN,t.DMAX,t.DMEAN,t.ARMS),Ql&&Yl.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const r=[[],t,n,i],s=[0,e.MX,e.MY,e.MZ],o=[0,e.MAPC,e.MAPR,e.MAPS],a=new zt;return a.set(r[o[1]][0]/s[o[1]],r[o[2]][0]/s[o[2]],r[o[3]][0]/s[o[3]],0,r[o[1]][1]/s[o[1]],r[o[2]][1]/s[o[2]],r[o[3]][1]/s[o[3]],0,r[o[1]][2]/s[o[1]],r[o[2]][2]/s[o[2]],r[o[3]][2]/s[o[3]],0,0,0,0,1),a.setPosition(new ut(e.originX,e.originY,e.originZ)),a.multiply((new zt).makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),a}}oc.add("mrc",gA),oc.add("ccp4",gA),oc.add("map",gA);const _A=/\s+/;function vA(e){return e.trim().split(_A).map(parseFloat)}class yA extends lA{get type(){return"xplor"}_parse(){Ql&&Yl.time("XplorParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(8),n={};let i;i=t[2].startsWith("REMARKS")?parseInt(t[1].substring(0,8))+2:5;const r=i+3,s=vA(t[i]);n.NA=s[0],n.AMIN=s[1],n.AMAX=s[2],n.NB=s[3],n.BMIN=s[4],n.BMAX=s[5],n.NC=s[6],n.CMIN=s[7],n.CMAX=s[8];const o=vA(t[i+1]);n.a=o[0]*this.voxelSize,n.b=o[1]*this.voxelSize,n.c=o[2]*this.voxelSize,n.alpha=o[3],n.beta=o[4],n.gamma=o[5];const a=n.AMAX-n.AMIN+1,l=n.BMAX-n.BMIN+1,c=n.CMAX-n.CMIN+1,u=a*l*c,h=new Float32Array(u),d=Math.ceil(1+a*l/6);let p=0,f=0;this.streamer.eachChunkOfLines((function(e){!function(e,t,i){for(let e=0;e<t;++e){const t=i[e];if(f>=r&&(f-r)%d!=0&&p<u)for(let e=0,n=6;e<n;++e){const n=parseFloat(t.substr(12*e,12));if(isNaN(n))break;h[p++]=n}else if(p===u){const e=t.trim();if(e&&"-9999"!==e){const e=vA(t);n.RAVE=e[0],n.RSIGMA=e[1]}}++f}}(0,e.length,e)})),e.header=n,e.setData(h,a,l,c),0!==n.RAVE&&1!==n.RSIGMA&&e.setStats(void 0,void 0,n.RAVE,n.RSIGMA),Ql&&Yl.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],n=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],i=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const r=[[],t,n,i],s=[0,e.NA,e.NB,e.NC],o=[0,1,2,3],a=new zt;return a.set(r[o[1]][0]/s[o[1]],r[o[2]][0]/s[o[2]],r[o[3]][0]/s[o[3]],0,r[o[1]][1]/s[o[1]],r[o[2]][1]/s[o[2]],r[o[3]][1]/s[o[3]],0,r[o[1]][2]/s[o[1]],r[o[2]][2]/s[o[2]],r[o[3]][2]/s[o[3]],0,0,0,0,1),a.multiply((new zt).makeTranslation(e.AMIN,e.BMIN,e.CMIN)),a}}function bA(e,t,n){let i,r,s;e/=360,t/=100,n/=100;const o=Math.floor(6*e),a=6*e-o,l=n*(1-t),c=n*(1-a*t),u=n*(1-(1-a)*t);switch(o%6){case 0:i=n,r=u,s=l;break;case 1:i=c,r=n,s=l;break;case 2:i=l,r=n,s=u;break;case 3:i=l,r=c,s=n;break;case 4:i=u,r=l,s=n;break;case 5:i=n,r=l,s=c}return[i,r,s]}oc.add("xplor",yA),oc.add("cns",yA);const xA={red:bA(0,100,100),orange:bA(20,100,100),gold:bA(40,100,100),yellow:bA(60,100,100),lime:bA(80,100,100),green:bA(120,80,100),sea:bA(150,100,100),cyan:bA(180,100,85),sky:bA(210,75,95),blue:bA(240,70,100),purple:bA(275,75,100),magenta:bA(300,95,100),hotpink:bA(335,100,100),pink:bA(350,55,100),peach:bA(25,75,100),lilac:bA(275,55,100),pinktint:bA(340,30,100),peachtint:bA(25,50,100),yellowtint:bA(60,50,100),greentint:bA(135,40,100),bluetint:bA(220,40,100),lilactint:bA(275,35,100),white:bA(0,0,100),gray:bA(0,0,50),brown:bA(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},wA=/[\s,]+/,SA=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,AA=/^{+|}+$/g,MA=/^['"]+|['"]+$/g,CA=/\s*=\s*/g;function TA(e){let t,n,i,r=[];const s=(e=e.replace(CA,"=")).match(SA);for(let e=1;e<s.length;++e){const o=s[e];if("{"===o[0])t=o.substring(1,o.length-1);else{const e=o.split("=");2===e.length&&("color"===e[0]?n=xA[e[1]]:"width"===e[0]?i=parseInt(e[1]):"master"===e[0]&&r.push(e[1].replace(AA,"")))}}return{listName:t,listColor:n,listMasters:r,listWidth:i}}function EA(e){const t=(e=e.trim()).indexOf("{"),n=e.indexOf("}"),i=e.substr(n+1).split(wA),r=e.substr(t+1,n-1),s=[parseFloat(i[i.length-3]),parseFloat(i[i.length-2]),parseFloat(i[i.length-1])];let o,a,l,c=!1,u=!1;for(let e=4;e<=i.length;e++){const t=i[i.length-e];t in xA&&(o=xA[i[i.length-e]]),t.startsWith("width")&&(a=parseInt(t.substring(5))),t.startsWith("r=")&&(l=parseFloat(t.split("=")[1])),t.startsWith("P")&&(c=!0),t.startsWith("X")&&(u=!0)}return{label:r,position:s,color:o,radius:l,width:a,isLineBreak:c,isTriangleBreak:u}}function PA(e){const t=e.indexOf("{"),n=e.indexOf("}");return e.substring(-1!==t?t+1:0,-1!==n?n:void 0).trim()}function IA(e){const t=e.indexOf("}");return-1===t?void 0:e.substr(t+1).trim()}function kA(e){let t="",n=[],i={};const r=(e=e.replace(CA,"=")).match(SA);for(let e=1;e<r.length;++e){const s=r[e];if("{"===s[0])t=s.substring(1,s.length-1);else{const e=s.split("=");2===e.length?"master"===e[0]?n.push(e[1].replace(AA,"")):i[e[0]]=e[1].replace(AA,""):i[e[0]]=!0}}return{groupName:t,groupFlags:i,groupMasters:n}}oc.add("kin",class extends tS{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){Ql&&Yl.time(`KinParser._parse ${this.name}`);const e={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let t,n;this.kinemage=e;let i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M=!1,C="",T=!1,E="",P=null,I=null,k=!1,R="",D=!1,L="",O=!1,N=!1;if(this.streamer.eachChunkOfLines((function(F){!function(F,B,U){for(let F=0;F<B;++F){const B=U[F];if("@"===B[0]&&(M=!1,T=!1,k=!1,D=!1,O=!1,N=!1),B)if(B.startsWith("@dotlist")){let{listColor:a,listName:l,listMasters:c}=TA(B);M=!0,C="",r=[],s=[],o=[],i=a,t&&(c=c.concat(t)),n&&(c=c.concat(n)),e.dotLists.push({name:l,masterArray:c,labelArray:r,positionArray:s,colorArray:o})}else if(B.startsWith("@vectorlist")){let{listMasters:i,listName:r,listWidth:s,listColor:o}=TA(B);i&&i.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})})),T=!0,E="",P=null,I=null,c=[],u=[],h=[],d=[],p=[],f=[],a=o,l=[],s&&l.push(s),t&&(i=i.concat(t)),n&&(i=i.concat(n)),e.vectorLists.push({name:r,masterArray:i,label1Array:c,label2Array:u,position1Array:h,position2Array:d,color1Array:p,color2Array:f,width:l})}else if(B.startsWith("@balllist")){let{listName:i,listColor:r,listMasters:s}=TA(B);s&&s.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})})),k=!0,R="",_=[],m=[],v=[],y=[],g=r,t&&(s=s.concat(t)),n&&(s=s.concat(n)),e.ballLists.push({name:i,masterArray:s,labelArray:_,radiusArray:m,positionArray:v,colorArray:y})}else if(B.startsWith("@ribbonlist")||B.startsWith("@trianglelist")){let{listMasters:i,listName:r,listColor:s}=TA(B);i&&i.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})})),D=!0,L="",x=[],w=[],S=[],A=[],b=s,t&&(i=i.concat(t)),n&&(i=i.concat(n)),e.ribbonLists.push({name:r,masterArray:i,labelArray:x,positionArray:w,breakArray:S,colorArray:A})}else if(B.startsWith("@text"))O=!0,e.texts.push(B.substr(5));else if(B.startsWith("@caption"))N=!0,e.captions.push(B.substr(8));else if(M){let{label:e,color:t,position:n}=EA(B);'"'===e?e=C:C=e,void 0===t&&(t=i),r.push(e),s.push(...n),o.push(...t)}else if(T){let e=B.replace(/(?!^){/g,"\n{").split(/\n/);for(var z=0;z<e.length;z++){let t=e[z],{label:n,color:i,width:r,position:s,isLineBreak:o}=EA(t);'"'===n?n=E:E=n,void 0===i&&(i=a),o||null!==P&&(r&&l.push(r),c.push(E),h.push(...P),p.push(...I),u.push(n),d.push(...s),f.push(...i)),E=n,P=s,I=i}}else if(k){let{label:e,radius:t,color:n,position:i}=EA(B);'"'===e?e=R:R=e,void 0===t&&(t=1),void 0===n&&(n=g),_.push(e),m.push(t),v.push(...i),y.push(...n)}else if(D){let{label:e,color:t,position:n,isTriangleBreak:i}=EA(B);'"'===e?e=L:L=e,void 0===t&&(t=b),x.push(e),w.push(...n),S.push(i),A.push(...t)}else if(O)e.texts.push(B);else if(N)e.captions.push(B);else if(B.startsWith("@kinemage"))e.kinemage=parseInt(B.substr(9).trim());else if(B.startsWith("@onewidth"))e.onewidth=!0;else if(B.startsWith("@1viewid"))e["1viewid"]=PA(B);else if(B.startsWith("@pdbfile"))e.pdbfile=PA(B);else if(B.startsWith("@group")){let{groupName:n,groupFlags:i,groupMasters:r}=kA(B);e.groupDict[n]||(e.groupDict[n]={dominant:!1,animate:!1},t=r),t&&t.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})}));for(let t in i)e.groupDict[n][t]=i[t]}else if(B.startsWith("@subgroup")){const{groupName:t,groupFlags:i,groupMasters:r}=kA(B);e.subgroupDict[t]||(e.subgroupDict[t]={dominant:!1,animate:!1},n=r),n&&n.forEach((function(t){e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1})}));for(let n in i)e.subgroupDict[t][n]=i[n]}else if(B.startsWith("@master")){const t=PA(B),n=IA(B);e.masterDict[t]||(e.masterDict[t]={indent:!1,visible:!1}),"on"===n?e.masterDict[t].visible=!0:"off"===n?e.masterDict[t].visible=!1:"indent"===n&&(e.masterDict[t].indent=!0)}else if(B.startsWith("@pointmaster")){const{groupName:t,groupFlags:n}=kA(B);e.pointmasterDict[t]={id:Object.keys(n)[0].replace(MA,"")}}else console.log(B);else M=!1,T=!1,k=!1,D=!1}}(0,F.length,F)})),e.text=e.texts.join("\n").trim(),e.caption=e.captions.join("\n").trim(),e.ribbonLists){let t=[];e.ribbonLists.forEach((function(e){t.push(function(e){let{labelArray:t,positionArray:n,colorArray:i,breakArray:r}=e,s=[],o=[],a=[],l=[];for(let e=0;e<r.length/3;e++){let c=3*e,u=9*e;r[c+1]||r[c+2]||(s.push(t[c]),s.push(t[c+1]),s.push(t[c+2]),l.push(r[c]),l.push(r[c+1]),l.push(r[c+2]),o.push(n[u]),o.push(n[u+1]),o.push(n[u+2]),o.push(n[u+3]),o.push(n[u+4]),o.push(n[u+5]),o.push(n[u+6]),o.push(n[u+7]),o.push(n[u+8]),a.push(i[u]),a.push(i[u+1]),a.push(i[u+2]),a.push(i[u+3]),a.push(i[u+4]),a.push(i[u+5]),a.push(i[u+6]),a.push(i[u+7]),a.push(i[u+8]))}return{name:e.name,masterArray:e.masterArray,labelArray:s,positionArray:o,breakArray:l,colorArray:a}}(function(e){let{labelArray:t,positionArray:n,colorArray:i,breakArray:r}=e,s=[];for(let e=0;e<3*(t.length-2);++e)s[e]=t[e-2*Math.floor(e/3)];let o=[];for(let e=0;e<3*(r.length-2);++e)o[e]=r[e-2*Math.floor(e/3)];let a=[];for(let e=0;e<9*(n.length/3-2);++e)a[e]=n[e-6*Math.floor(e/9)];let l=[];for(let e=0;e<9*(i.length/3-2);++e)l[e]=i[e-6*Math.floor(e/9)];let c=[];for(let e=0;e<a.length/3;++e)c.push(new ut(a[3*e],a[3*e]+1,a[3*e]+2));return{name:e.name,masterArray:e.masterArray,labelArray:s,positionArray:a,breakArray:o,colorArray:l}}(e)))})),e.ribbonLists=t}Ql&&Yl.timeEnd(`KinParser._parse ${this.name}`)}});class RA extends tS{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new jp(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const DA=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};DA.prototype={constructor:DA,setPath:function(e){this.path=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:!1!==t},this.objects.push(this.object)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},addVertex:function(e,t,n){var i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var i=this.normals,r=this.object.geometry.normals;r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addFace:function(e,t,n,i,r,s,o,a){var l,c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(void 0===i?this.addVertex(u,h,d):(l=this.parseVertexIndex(i,c),this.addVertex(u,h,l),this.addVertex(h,d,l)),void 0!==r){var p=this.normals.length;u=this.parseNormalIndex(r,p),h=r===s?u:this.parseNormalIndex(s,p),d=r===o?u:this.parseNormalIndex(o,p),void 0===i?this.addNormal(u,h,d):(l=this.parseNormalIndex(a,p),this.addNormal(u,h,l),this.addNormal(h,d,l))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,n=0,i=e.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(e[n],t))}};return e.startObject("",!1),e},parse:function(e){var t,n,i=this._createParserState();-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));var r=e.split("\n"),s="",o="",a="",l=[],c="function"==typeof"".trimLeft;for(t=0,n=r.length;t<n;t++)if(s=r[t],0!==(s=c?s.trimLeft():s.trim()).length&&"#"!==(o=s.charAt(0)))if("v"===o){if(" "===(a=s.charAt(1))&&null!==(l=this.regexp.vertex_pattern.exec(s)))i.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("n"===a&&null!==(l=this.regexp.normal_pattern.exec(s)))i.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("t"!==a||null===this.regexp.uv_pattern.exec(s))throw new Error("Unexpected vertex/normal/uv line: '"+s+"'")}else if("f"===o)if(null!==(l=this.regexp.face_vertex_uv_normal.exec(s)))i.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(null!==this.regexp.face_vertex_uv.exec(s));else if(null!==(l=this.regexp.face_vertex_normal.exec(s)))i.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if(null===(l=this.regexp.face_vertex.exec(s)))throw new Error("Unexpected face line: '"+s+"'");i.addFace(l[1],l[2],l[3],l[4])}else if("l"===o){var u=s.substring(1).trim().split(" "),h=[],d=[];if(-1===s.indexOf("/"))h=u;else for(var p=0,f=u.length;p<f;p++){var m=u[p].split("/");""!==m[0]&&h.push(m[0]),""!==m[1]&&d.push(m[1])}i.addLineGeometry(h,d)}else if(null!==(l=this.regexp.object_pattern.exec(s))){var g=l[0].substr(1).trim();i.startObject(g)}else if(this.regexp.material_use_pattern.test(s));else if(this.regexp.material_library_pattern.test(s));else if(null===this.regexp.smoothing_pattern.exec(s)){if("\0"===s)continue;throw new Error("Unexpected line: '"+s+"'")}var _=[];for(t=0,n=i.objects.length;t<n;t++){var v=i.objects[t].geometry;if(0!==v.vertices.length){var y=new qn;y.setAttribute("position",new Nn(new Float32Array(v.vertices),3)),v.normals.length>0?y.setAttribute("normal",new Nn(new Float32Array(v.normals),3)):y.computeVertexNormals(),_.push(y)}}return _}},oc.add("obj",class extends RA{get type(){return"obj"}getLoader(){return new DA}});const LA=["int8","char","uint8","uchar","int16","short","uint16","ushort","int32","int","uint32","uint","float32","float","float64","double"];function OA(e){if(function(e){return LA.includes(e)}(e))return e;throw new Error(`Unsupported data type: ${e}`)}function NA(e){if("object"!=typeof e||null===e)throw new Error("Expected element to be an object");if("string"!=typeof e.name)throw new Error("Expected element.name to be a string");if("number"!=typeof e.count)throw new Error("Expected element.count to be a number");if(!Array.isArray(e.properties))throw new Error("Expected element.properties to be an array")}function FA(e,t,n){switch(t){case"int8":case"char":return{read:t=>e.getInt8(t),size:1};case"uint8":case"uchar":return{read:t=>e.getUint8(t),size:1};case"int16":case"short":return{read:t=>e.getInt16(t,n),size:2};case"uint16":case"ushort":return{read:t=>e.getUint16(t,n),size:2};case"int32":case"int":return{read:t=>e.getInt32(t,n),size:4};case"uint32":case"uint":return{read:t=>e.getUint32(t,n),size:4};case"float32":case"float":return{read:t=>e.getFloat32(t,n),size:4};case"float64":case"double":return{read:t=>e.getFloat64(t,n),size:8};default:throw new Error(`Unsupported data type: ${t}`)}}function BA(e,t){const n={};let i=0;for(let r=0;r<t.length;r++){const s=t[r],o=s.valueReader;if(s.isList){const t=[],r=s.countReader.read(e+i);i+=s.countReader.size;for(let n=0;n<r;n++)t.push(o.read(e+i)),i+=o.size;n[s.name]=t}else n[s.name]=o.read(e+i),i+=o.size}return[n,i]}class UA{constructor(){this._color=new Pn,this.propertyNameMapping={},this.customPropertyMapping={}}setPropertyNameMapping(e){this.propertyNameMapping=e}createBuffer(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const t of Object.keys(this.customPropertyMapping))e[t]=[];return e}extractHeaderText(e){let t=0,n=!0,i="";const r=[],s=(new TextDecoder).decode(e.subarray(0,5)),o=/^ply\r\n/.test(s);do{const s=String.fromCharCode(e[t++]);"\n"!==s&&"\r"!==s?i+=s:("end_header"===i&&(n=!1),""!==i&&(r.push(i),i=""))}while(n&&t<e.length);return!0===o&&t++,{headerText:r.join("\r")+"\r",headerLength:t}}handleElement(e,t,n,i){if("vertex"===t){e.vertices.push(n[i.attrX],n[i.attrY],n[i.attrZ]),null!==i.attrNX&&null!==i.attrNY&&null!==i.attrNZ&&e.normals.push(n[i.attrNX],n[i.attrNY],n[i.attrNZ]),null!==i.attrS&&null!==i.attrT&&e.uvs.push(n[i.attrS],n[i.attrT]),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),e.colors.push(this._color.r,this._color.g,this._color.b));for(const t of Object.keys(this.customPropertyMapping))for(const i of this.customPropertyMapping[t])e[t].push(n[i])}else if("face"===t){const t=n.vertex_indices||n.vertex_index,r=n.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),r&&6===r.length&&(e.faceVertexUvs.push(r[0],r[1]),e.faceVertexUvs.push(r[2],r[3]),e.faceVertexUvs.push(r[4],r[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3])),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b))}}parse(e){let t;if(e instanceof ArrayBuffer){const n=new Uint8Array(e),{headerText:i,headerLength:r}=this.extractHeaderText(n),s=this.parseHeader(i,r);if("ascii"===s.format){const e=(new TextDecoder).decode(n);t=this.parseASCII(e,s)}else t=this.parseBinary(n,s)}else t=this.parseASCII(e,this.parseHeader(e));return t}parseHeader(e,t=0){let n="";const i=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);null!==i&&(n=i[1]);const r={comments:[],elements:[],headerLength:t,objInfo:"",format:"",version:""},s=n.split(/\r\n|\r|\n/);let o;for(let e=0;e<s.length;e++){let t=s[e];if(t=t.trim(),""===t)continue;const n=t.split(/\s+/),i=n.shift();switch(t=n.join(" "),i){case"format":r.format=n[0],r.version=n[1];break;case"comment":r.comments.push(t);break;case"element":void 0!==o&&(NA(o),r.elements.push(o)),o={name:n[0],count:parseInt(n[1]),properties:[]};break;case"property":if(void 0===o){console.warn("property without element");continue}o.properties.push(zA(n,this.propertyNameMapping));break;case"obj_info":r.objInfo=t;break;default:console.log("unhandled",i,n)}}return void 0!==o&&r.elements.push(o),r}parseASCII(e,t){const n=this.createBuffer();let i,r;i=null!==(r=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))?r[1].split(/\s+/):[];const s=new GA(i);e:for(let e=0;e<t.elements.length;e++){const i=t.elements[e],r=$A(i.properties);for(let e=0;e<i.count;e++){const e=HA(i.properties,s);if(!e)break e;this.handleElement(n,i.name,e,r)}}return this.postProcess(n)}parseBinary(e,t){const n=this.createBuffer(),i="binary_little_endian"===t.format,r=new DataView(e,t.headerLength);let s,o=0;for(let e=0;e<t.elements.length;e++){const a=t.elements[e],l=a.properties,c=$A(l),u=this.makeBinaryProperties(l,r,i);for(let e=0;e<a.count;e++){s=BA(o,u),o+=s[1];const e=s[0];this.handleElement(n,a.name,e,c)}}return this.postProcess(n)}postProcess(e){let t=new qn;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new Un(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new Un(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new Un(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new Un(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new Un(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new Un(e.faceVertexColors,3)));for(const n of Object.keys(this.customPropertyMapping))e[n].length>0&&t.setAttribute(n,new Un(e[n],this.customPropertyMapping[n].length));return t.computeBoundingSphere(),t}makeBinaryProperties(e,t,n){const i=[];for(let r=0,s=e.length;r<s;r++){const s=e[r];s.isList?i.push(Object.assign(Object.assign({},s),{countReader:FA(t,s.countType,n),valueReader:FA(t,s.type,n)})):i.push(Object.assign(Object.assign({},s),{valueReader:FA(t,s.type,n)}))}return i}}function zA(e,t){const n=e[0];let i;return i="list"===n?{isList:!0,name:e[3],type:OA(e[2]),countType:OA(e[1])}:{isList:!1,name:e[1],type:OA(n)},i.name in t&&(i.name=t[i.name]),i}function VA(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}return 0}function HA(e,t){const n={name:"",type:""};for(let i=0;i<e.length;i++){if(t.empty())return null;const r=e[i];if(r.isList){const e=[],i=VA(t.next(),r.countType);for(let n=0;n<i;n++){if(t.empty())return null;e.push(VA(t.next(),r.type))}n[r.name]=e}else n[e[i].name]=VA(t.next(),e[i].type)}return n}function $A(e){const t=e.map((e=>e.name));function n(e){for(let n=0,i=e.length;n<i;n++){const i=e[n];if(t.includes(i))return i}return null}return{attrX:n(["x","px","posx"])||"x",attrY:n(["y","py","posy"])||"y",attrZ:n(["z","pz","posz"])||"z",attrNX:n(["nx","normalx"]),attrNY:n(["ny","normaly"]),attrNZ:n(["nz","normalz"]),attrS:n(["s","u","texture_u","tx"]),attrT:n(["t","v","texture_v","ty"]),attrR:n(["red","diffuse_red","r","diffuse_r"]),attrG:n(["green","diffuse_green","g","diffuse_g"]),attrB:n(["blue","diffuse_blue","b","diffuse_b"])}}class GA{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}oc.add("ply",class extends RA{get type(){return"ply"}getLoader(){return new UA}}),oc.add("csv",class extends tS{constructor(e,t){const n=t||{};super(e,n),this.delimiter=Aa(n.delimiter,","),this.comment=Aa(n.comment,"#"),this.columnNames=Aa(n.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const e=this.table.data,t=new RegExp("\\s*"+this.delimiter+"\\s*");let n=0;this.streamer.eachChunkOfLines((i=>{const r=i.length;for(let s=0;s<r;++s){const r=i[s].trim();if(r.startsWith(this.comment))continue;const o=r.split(t);0===n?this.table.columnNames=o:r&&e.push(o),++n}}))}}),oc.add("json",class extends tS{constructor(e,t){const n=t||{};super(e,n),this.string=Aa(n.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}}),oc.add("msgpack",class extends tS{constructor(e,t){super(e,t||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){Ql&&Yl.time("MsgpackParser._parse "+this.name),this.msgpack.data=IS(this.streamer.data),Ql&&Yl.timeEnd("MsgpackParser._parse "+this.name)}}),oc.add("netcdf",class extends tS{constructor(e,t){super(e,t||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){Ql&&Yl.time("NetcdfParser._parse "+this.name),this.netcdf.data=new JS(this.streamer.data),Ql&&Yl.timeEnd("NetcdfParser._parse "+this.name)}});class jA extends tS{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}oc.add("txt",jA),oc.add("text",jA);const WA=/^['"]|['"]$/g,qA=/^<([\w-:.]+)\s*/,XA=/^([^<]*)/,YA=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;class KA extends tS{constructor(e,t){const n=t||{};super(e,n),this.useDomParser=Aa(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return function(e){return e=e.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:function(){if(!n(/^<\?xml\s*/))return;const e={attributes:{}};for(;!i()&&!r("?>");){const n=t();if(!n)return e;e.attributes[n.name]=n.value}return n(/\?>\s*/),e}(),root:function e(){const s=n(qA);if(!s)return;const o={name:s[1],attributes:{},children:[]};for(;!(i()||r(">")||r("?>")||r("/>"));){const e=t();if(!e)return o;o.attributes[e.name]=e.value}if(n(/^\s*\/>\s*/))return o;let a;for(n(/\??>\s*/),o.content=function(){const e=n(XA);return e?e[1]:""}();a=e();)o.children.push(a);return n(/^<\/[\w-:.]+>\s*/),o}()};function t(){const e=n(YA);var t;if(e)return{name:e[1],value:(t=e[2],t.replace(WA,""))}}function n(t){const n=e.match(t);if(n)return e=e.slice(n[0].length),n}function i(){return 0===e.length}function r(t){return 0===e.indexOf(t)}}(e)}__domParser(e){return(new window.DOMParser).parseFromString(e,"text/xml")}_parse(){Ql&&Yl.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),Ql&&Yl.timeEnd("XmlParser._parse "+this.name)}}function ZA(e,t){const n=e.getNamedItem(t);return null!==n?n.value:""}function QA(e,t,n=!1){const i=ZA(e,"icode").trim(),r=ZA(e,"chain").trim(),s=ZA(e,"altcode");let o=ZA(e,"resnum");return i&&(o+="^"+i),r&&(o+=":"+r),t&&(o+="."+t),n&&s.trim()&&(o+="%"+s),o+="/"+(parseInt(ZA(e,"model"))-1),o}function JA(e){const t=ZA(e,"chain").trim();let n=`[${ZA(e,"rescode")}]${ZA(e,"resnum")}`;return t&&(n+=`:${t}`),n}function eM(e,t,n){void 0===e[t]?e[t]=n:e[t]|=n}function tM(e,t){return null!==e&&e.value===t}function nM(e,t,n){let i=0;const r=t.getElementsByTagName("clash");for(let t=0,n=r.length;t<n;++t)if(e[ZA(r[t].attributes,"cid")]){i+=1;break}return t.getElementsByTagName("angle-outlier").length>0&&(i+=1),t.getElementsByTagName("bond-outlier").length>0&&(i+=1),t.getElementsByTagName("plane-outlier").length>0&&(i+=1),tM(n.getNamedItem("rota"),"OUTLIER")&&(i+=1),tM(n.getNamedItem("rama"),"OUTLIER")&&(i+=1),tM(n.getNamedItem("RNApucker"),"outlier")&&(i+=1),i}oc.add("xml",KA);class iM{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(e){Ql&&Yl.time("Validation.fromXml");const t=this.rsrzDict,n=this.rsccDict,i=this.rciDict,r=this.clashDict,s=this.clashArray,o=this.geoDict,a=this.geoAtomDict,l=this.atomDict,c=e.getElementsByTagName("Entry");if(1===c.length){const e=c[0].getElementsByTagName("chemical_shift_list");if(1===e.length){const t=e[0].getElementsByTagName("random_coil_index");for(let e=0,n=t.length;e<n;++e){const n=t[e].attributes;i[JA(n)]=parseFloat(ZA(n,"value"))}}}const u=e.getElementsByTagName("ModelledSubgroup"),h={},d=[];Ql&&Yl.time("Validation.fromXml#clashDict");for(let i=0,o=u.length;i<o;++i){const o=u[i],a=o.attributes,c=QA(a);null!==a.getNamedItem("rsrz")&&(t[c]=parseFloat(ZA(a,"rsrz"))),null!==a.getNamedItem("rscc")&&(n[c]=parseFloat(ZA(a,"rscc")));const p=e.createAttribute("sele");p.value=c,a.setNamedItem(p);const f=o.getElementsByTagName("clash");for(let e=0,t=f.length;e<t;++e){const t=f[e].attributes,n=ZA(t,"atom");if("H"!==dm(n)){const e=ZA(t,"cid"),i=QA(a,n,!0);if(l[i]=!0,void 0===h[e])h[e]={sele1:i,res1:c};else{const t=h[e];t.res1!==c&&(t.sele2=i,t.res2=c,d.push(t.res1,c),r[e]=t,s.push(t))}}}}Ql&&Yl.timeEnd("Validation.fromXml#clashDict");for(let e=0,t=u.length;e<t;++e){const t=u[e],n=t.attributes,i=ZA(n,"sele");if("."!==ZA(n,"seq")){const e=nM(r,t,n);e>0&&(o[i]=e)}else{const e=t.getElementsByTagName("clash"),n=t.getElementsByTagName("mog-bond-outlier"),s=t.getElementsByTagName("mog-angle-outlier");if(n.length>0||s.length>0||e.length>0){const t={};a[i]=t;for(let n=0,i=e.length;n<i;++n){const i=e[n].attributes;r[ZA(i,"cid")]&&eM(t,ZA(i,"atom"),1)}for(let e=0,i=n.length;e<i;++e)ZA(n[e].attributes,"atoms").split(",").forEach((function(e){eM(t,e,2)}));for(let e=0,n=s.length;e<n;++e)ZA(s[e].attributes,"atoms").split(",").forEach((function(e){eM(t,e,4)}))}}}this.clashSele=d.length?d.join(" OR "):"NONE",Ql&&Yl.timeEnd("Validation.fromXml")}getClashData(e){Ql&&Yl.time("Validation.getClashData");const t=e||{},n=t.structure,i=n.atomSet,r=new Pn(Aa(t.color,"#f0027f")),s=n.getAtomProxy(),o=n.getAtomProxy(),a=new ut,l=new ut,c=new ut,u=this.clashArray,h=u.length,d=new Float32Array(3*h),p=new Float32Array(3*h),f=jc(h,r.r,r.g,r.b),m=new Float32Array(h),g=new Float32Array(h);Ql&&Yl.time("Validation.getClashData#atomDict");const _=this.atomDict;n.eachAtom((function(e){const t=function(e){const t=e.inscode,n=e.chainname,i=e.atomname,r=e.altloc;let s=e.resno+"";return t&&(s+="^"+t),n&&(s+=":"+n),i&&(s+="."+i),r&&(s+="%"+r),s+="/"+e.modelIndex,s}(e);!0===_[t]&&(_[t]=e.index)})),Ql&&Yl.timeEnd("Validation.getClashData#atomDict");let v=0;return u.forEach((function(e,t){if(s.index=_[e.sele1],o.index=_[e.sele2],void 0===s.index||void 0===o.index||!i.isSet(s.index,o.index))return;a.subVectors(o,s).setLength(s.vdw),l.copy(s).add(a),a.subVectors(s,o).setLength(o.vdw),c.copy(o).add(a);const n=s.distanceTo(o)/2,r=Math.sqrt(s.vdw*s.vdw-n*n),u=Math.sqrt(o.vdw*o.vdw-n*n);l.toArray(d,3*v),c.toArray(p,3*v),m[v]=(r+u)/2,g[v]=t,++v})),Ql&&Yl.timeEnd("Validation.getClashData"),{position1:d.subarray(0,3*v),position2:p.subarray(0,3*v),color:f.subarray(0,3*v),color2:f.subarray(0,3*v),radius:m.subarray(0,v),picking:new pp(g.subarray(0,v),this,n)}}}function rM(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}function sM(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var s=0;s<i;s++)e[r+s]=t[n+s]}function oM(e,t,n,i){for(var r=65535&e,s=e>>>16&65535,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{s=s+(r=r+t[i++]|0)|0}while(--o);r%=65521,s%=65521}return r|s<<16}oc.add("validation",class extends KA{constructor(e,t){super(e,t||{}),this.useDomParser=!0,this.validation=new iM(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),Ql&&Yl.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),Ql&&Yl.timeEnd("ValidationParser._parse "+this.name)}});var aM=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function lM(e,t,n,i){var r=aM,s=i+n;e^=-1;for(var o=i;o<s;o++)e=e>>>8^r[255&(e^t[o])];return~e}function cM(e,t){var n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C;n=e.state,i=e.next_in,M=e.input,r=i+(e.avail_in-5),s=e.next_out,C=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,p=n.hold,f=n.bits,m=n.lencode,g=n.distcode,_=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{f<15&&(p+=M[i++]<<f,f+=8,p+=M[i++]<<f,f+=8),y=m[p&_];t:for(;;){if(p>>>=b=y>>>24,f-=b,0==(b=y>>>16&255))C[s++]=65535&y;else{if(!(16&b)){if(64&b){if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}y=m[(65535&y)+(p&(1<<b)-1)];continue t}for(x=65535&y,(b&=15)&&(f<b&&(p+=M[i++]<<f,f+=8),x+=p&(1<<b)-1,p>>>=b,f-=b),f<15&&(p+=M[i++]<<f,f+=8,p+=M[i++]<<f,f+=8),y=g[p&v];;){if(p>>>=b=y>>>24,f-=b,16&(b=y>>>16&255)){if(w=65535&y,f<(b&=15)&&(p+=M[i++]<<f,(f+=8)<b&&(p+=M[i++]<<f,f+=8)),(w+=p&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=b,f-=b,w>(b=s-o)){if((b=w-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,A=d,0===h){if(S+=c-b,b<x){x-=b;do{C[s++]=d[S++]}while(--b);S=s-w,A=C}}else if(h<b){if(S+=c+h-b,(b-=h)<x){x-=b;do{C[s++]=d[S++]}while(--b);if(S=0,h<x){x-=b=h;do{C[s++]=d[S++]}while(--b);S=s-w,A=C}}}else if(S+=h-b,b<x){x-=b;do{C[s++]=d[S++]}while(--b);S=s-w,A=C}for(;x>2;)C[s++]=A[S++],C[s++]=A[S++],C[s++]=A[S++],x-=3;x&&(C[s++]=A[S++],x>1&&(C[s++]=A[S++]))}else{S=s-w;do{C[s++]=C[S++],C[s++]=C[S++],C[s++]=C[S++],x-=3}while(x>2);x&&(C[s++]=C[S++],x>1&&(C[s++]=C[S++]))}break}if(64&b){e.msg="invalid distance code",n.mode=30;break e}y=g[(65535&y)+(p&(1<<b)-1)]}}break}}while(i<r&&s<a);i-=x=f>>3,p&=(1<<(f-=x<<3))-1,e.next_in=i,e.next_out=s,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=s<a?a-s+257:257-(s-a),n.hold=p,n.bits=f}var uM=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],hM=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dM=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],pM=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function fM(e,t,n,i,r,s,o,a){var l,c,u,h,d,p,f,m,g,_=a.bits,v=0,y=0,b=0,x=0,w=0,S=0,A=0,M=0,C=0,T=0,E=null,P=0,I=new Uint16Array(16),k=new Uint16Array(16),R=null,D=0;for(v=0;v<=15;v++)I[v]=0;for(y=0;y<i;y++)I[t[n+y]]++;for(w=_,x=15;x>=1&&0===I[x];x--);if(w>x&&(w=x),0===x)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(b=1;b<x&&0===I[b];b++);for(w<b&&(w=b),M=1,v=1;v<=15;v++)if(M<<=1,(M-=I[v])<0)return-1;if(M>0&&(0===e||1!==x))return-1;for(k[1]=0,v=1;v<15;v++)k[v+1]=k[v]+I[v];for(y=0;y<i;y++)0!==t[n+y]&&(o[k[t[n+y]]++]=y);if(0===e?(E=R=o,p=19):1===e?(E=uM,P-=257,R=hM,D-=257,p=256):(E=dM,R=pM,p=-1),T=0,y=0,v=b,d=s,S=w,A=0,u=-1,h=(C=1<<w)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){f=v-A,o[y]<p?(m=0,g=o[y]):o[y]>p?(m=R[D+o[y]],g=E[P+o[y]]):(m=96,g=0),l=1<<v-A,b=c=1<<S;do{r[d+(T>>A)+(c-=l)]=f<<24|m<<16|g}while(0!==c);for(l=1<<v-1;T&l;)l>>=1;if(0!==l?(T&=l-1,T+=l):T=0,y++,0==--I[v]){if(v===x)break;v=t[n+o[y]]}if(v>w&&(T&h)!==u){for(0===A&&(A=w),d+=b,M=1<<(S=v-A);S+A<x&&!((M-=I[S+A])<=0);)S++,M<<=1;if(C+=1<<S,1===e&&C>852||2===e&&C>592)return 1;r[u=T&h]=w<<24|S<<16|d-s}}return 0!==T&&(r[d+T]=v-A<<24|64<<16),a.bits=w,0}var mM=-2,gM=12,_M=30;function vM(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function yM(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var bM,xM,wM=!0;function SM(e){if(wM){var t;for(bM=new Int32Array(512),xM=new Int32Array(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(fM(1,e.lens,0,288,bM,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;fM(2,e.lens,0,32,xM,0,e.work,{bits:5}),wM=!1}e.lencode=bM,e.lenbits=9,e.distcode=xM,e.distbits=5}function AM(e,t,n,i){var r,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(sM(s.window,t,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((r=s.wsize-s.wnext)>i&&(r=i),sM(s.window,t,n-i,r,s.wnext),(i-=r)?(sM(s.window,t,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0}function MM(e,t){var n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C=0,T=new Uint8Array(4),E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return mM;(n=e.state).mode===gM&&(n.mode=13),o=e.next_out,r=e.output,l=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,c=n.hold,u=n.bits,h=a,d=l,S=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(2&n.wrap&&35615===c){n.check=0,T[0]=255&c,T[1]=c>>>8&255,n.check=lM(n.check,T,2,0),c=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=_M;break}if(8!=(15&c)){e.msg="unknown compression method",n.mode=_M;break}if(u-=4,w=8+(15&(c>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){e.msg="invalid window size",n.mode=_M;break}n.dmax=1<<w,e.adler=n.check=1,n.mode=512&c?10:gM,c=0,u=0;break;case 2:for(;u<16;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(n.flags=c,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=_M;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=_M;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=lM(n.check,T,2,0)),c=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,n.check=lM(n.check,T,4,0)),c=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=lM(n.check,T,2,0)),c=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=lM(n.check,T,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>a&&(p=a),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),sM(n.head.extra,i,s,p,w)),512&n.flags&&(n.check=lM(n.check,i,p,s)),a-=p,s+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break e;p=0;do{w=i[s+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<a);if(512&n.flags&&(n.check=lM(n.check,i,p,s)),a-=p,s+=p,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break e;p=0;do{w=i[s+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<a);if(512&n.flags&&(n.check=lM(n.check,i,p,s)),a-=p,s+=p,w)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=_M;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=gM;break;case 10:for(;u<32;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}e.adler=n.check=vM(c),c=0,u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=a,n.hold=c,n.bits=u,2;e.adler=n.check=1,n.mode=gM;case gM:if(5===t||6===t)break e;case 13:if(n.last){c>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(SM(n),n.mode=20,6===t){c>>>=2,u-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=_M}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=_M;break}if(n.length=65535&c,c=0,u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>a&&(p=a),p>l&&(p=l),0===p)break e;sM(r,i,s,p,o),a-=p,s+=p,l-=p,o+=p,n.length-=p;break}n.mode=gM;break;case 17:for(;u<14;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=_M;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}n.lens[E[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[E[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},S=fM(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,S){e.msg="invalid code lengths set",n.mode=_M;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;_=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(M=g+2;u<M;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=_M;break}w=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(M=g+3;u<M;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}u-=g,w=0,p=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(M=g+7;u<M;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}u-=g,w=0,p=11+(127&(c>>>=g)),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=_M;break}for(;p--;)n.lens[n.have++]=w}}if(n.mode===_M)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=_M;break}if(n.lenbits=9,A={bits:n.lenbits},S=fM(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,S){e.msg="invalid literal/lengths set",n.mode=_M;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},S=fM(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,S){e.msg="invalid distances set",n.mode=_M;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=a,n.hold=c,n.bits=u,cM(e,d),o=e.next_out,r=e.output,l=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,c=n.hold,u=n.bits,n.mode===gM&&(n.back=-1);break}for(n.back=0;_=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(_&&!(240&_)){for(y=g,b=_,x=v;_=(C=n.lencode[x+((c&(1<<y+b)-1)>>y)])>>>16&255,v=65535&C,!(y+(g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===_){n.mode=26;break}if(32&_){n.back=-1,n.mode=gM;break}if(64&_){e.msg="invalid literal/length code",n.mode=_M;break}n.extra=15&_,n.mode=22;case 22:if(n.extra){for(M=n.extra;u<M;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;_=(C=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(!(240&_)){for(y=g,b=_,x=v;_=(C=n.distcode[x+((c&(1<<y+b)-1)>>y)])>>>16&255,v=65535&C,!(y+(g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=g,u-=g,n.back+=g,64&_){e.msg="invalid distance code",n.mode=_M;break}n.offset=v,n.extra=15&_,n.mode=24;case 24:if(n.extra){for(M=n.extra;u<M;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=_M;break}n.mode=25;case 25:if(0===l)break e;if(p=d-l,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=_M;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=r,f=o-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{r[o++]=m[f++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;r[o++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===a)break e;a--,c|=i[s++]<<u,u+=8}if(d-=l,e.total_out+=d,n.total+=d,d&&(e.adler=n.check=n.flags?lM(n.check,r,d,o-d):oM(n.check,r,d,o-d)),d=l,(n.flags?c:vM(c))!==n.check){e.msg="incorrect data check",n.mode=_M;break}c=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===a)break e;a--,c+=i[s++]<<u,u+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=_M;break}c=0,u=0}n.mode=29;case 29:S=1;break e;case _M:S=-3;break e;case 31:return-4;default:return mM}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=a,n.hold=c,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<_M&&(n.mode<27||4!==t))&&AM(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,n.wrap&&d&&(e.adler=n.check=n.flags?lM(n.check,r,d,e.next_out-d):oM(n.check,r,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===gM?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===d||4===t)&&0===S&&(S=-5),S}function CM(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?mM:11===n.mode&&oM(1,t,i,0)!==n.check?-3:AM(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):mM}var TM=!0,EM=!0;try{String.fromCharCode.apply(null,[0])}catch(al){TM=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(al){EM=!1}for(var PM=new Uint8Array(256),IM=0;IM<256;IM++)PM[IM]=IM>=252?6:IM>=248?5:IM>=240?4:IM>=224?3:IM>=192?2:1;function kM(e){var t,n,i,r,s,o=e.length,a=0;for(r=0;r<o;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),s=0,r=0;s<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t}function RM(e,t){var n,i,r,s,o=t||e.length,a=new Array(2*o);for(i=0,n=0;n<o;)if((r=e[n++])<128)a[i++]=r;else if((s=PM[r])>4)a[i++]=65533,n+=s-1;else{for(r&=2===s?31:3===s?15:7;s>1&&n<o;)r=r<<6|63&e[n++],s--;s>1?a[i++]=65533:r<65536?a[i++]=r:(r-=65536,a[i++]=55296|r>>10&1023,a[i++]=56320|1023&r)}return function(e,t){if(t<65537&&(e.subarray&&EM||!e.subarray&&TM))return String.fromCharCode.apply(null,rM(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}(a,i)}function DM(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+PM[e[n]]>t?n:t}PM[254]=PM[254]=1;var LM={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function OM(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function NM(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var FM=Object.prototype.toString;function BM(e){if(!(this instanceof BM))return new BM(e);this.options=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e}({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new OM,this.strm.avail_out=0;var n,i,r,s=function(e,t){var n,i;return e?(i=new yM,e.state=i,i.window=null,n=function(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?mM:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,function(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,function(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,0):mM}(e)):mM}(e))):mM}(e,t),0!==n&&(e.state=null),n):mM}(this.strm,t.windowBits);if(0!==s)throw new Error(LM[s]);this.header=new NM,n=this.strm,i=this.header,n&&n.state&&2&(r=n.state).wrap&&(r.head=i,i.done=!1)}BM.prototype.push=function(e,t){var n,i,r,s,o,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?l.input=function(e){for(var t=new Uint8Array(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t}(e):"[object ArrayBuffer]"===FM.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Uint8Array(c),l.next_out=0,l.avail_out=c),2===(n=MM(l,0))&&u&&(a="string"==typeof u?kM(u):"[object ArrayBuffer]"===FM.call(u)?new Uint8Array(u):u,n=CM(this.strm,a)),-5===n&&!0===h&&(n=0,h=!1),1!==n&&0!==n)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&1!==n&&(0!==l.avail_in||4!==i&&2!==i)||("string"===this.options.to?(r=DM(l.output,l.next_out),s=l.next_out-r,o=RM(l.output,r),l.next_out=s,l.avail_out=c-s,s&&sM(l.output,l.output,r,s,0),this.onData(o)):this.onData(rM(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&1!==n);return 1===n&&(i=4),4===i?(n=function(e){if(!e||!e.state)return mM;var t=e.state;return t.window&&(t.window=null),e.state=null,0}(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==i||(this.onEnd(0),l.avail_out=0,!0)},BM.prototype.onData=function(e){this.chunks.push(e)},BM.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=function(e){var t,n,i,r,s,o;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(o=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)s=e[t],o.set(s,r),r+=s.length;return o}(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},lc.add("gz",(function(e){let t;e instanceof ArrayBuffer&&(e=new Uint8Array(e));try{t=function(e){var t=new BM(void 0);if(t.push(e,!0),t.err)throw t.msg;return t.result}(e)}catch(n){t=e}return t}));class UM{}const zM="https:";rc.add("rcsb",new class extends UM{getUrl(e){const t=Sc(e),n=t.name.indexOf("_")>-1?t.name:t.name.substring(0,4);return!["pdb","cif"].includes(t.ext)||!1!==t.compressed&&"gz"!==t.compressed?("mmtf"===t.ext&&(Yl.warn("MMTF files distribution has been discontinued by RCSB PDB as of July 2024.\n Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice"),t.base.endsWith(".bb")&&Yl.warn("Backbone only files are not available from RCSB PDB anymore."),t.ext=""),t.ext?Yl.warn("unsupported ext",t.ext):Yl.warn('mmCif files available from RCSB PDB lack connectivity information.\n Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.'),zM+"//models.rcsb.org/"+n+".bcif.gz"):zM+"//files.rcsb.org/download/"+t.path}getExt(e){return Sc(e).ext||"bcif"}});const VM="//www.ebi.ac.uk/pdbe/entry-files/download/";rc.add("pdbe",new class extends UM{getUrl(e){const t=Sc(e);let n,i=t.name.indexOf("_")>-1?t.name:t.name.substring(0,4);switch(t.ext){case"cif":n=VM+i+"_updated.cif";break;case"pdb":case"ent":i.startsWith("pdb")||(i="pdb"+i),n=VM+i+".ent";break;case"bcif":n=VM+t.path;break;case"":n=VM+i+".bcif";break;default:Yl.warn("unsupported ext",t.ext),n=VM+i+".bcif"}return"https://"+n}getExt(e){return Sc(e).ext||"bcif"}});const HM="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",$M="/SDF?record_type=3d";rc.add("pubchem",new class extends UM{getUrl(e){const t=Sc(e),n=t.name;let i;return t.ext&&"sdf"!==t.ext?(Yl.warn("unsupported ext",t.ext),i=HM+n+$M):i=HM+n+$M,function(){const e=window.location.protocol;return null===e.match(/http(s)?:/gi)?"http:":e}()+i}getExt(e){return Sc(e).ext||"sdf"}});class GM extends UM{getUrl(e){return e}getExt(e){return Sc(e).ext}}rc.add("ftp",new GM),rc.add("http",new GM),rc.add("https",new GM);const jM="//alphafold.ebi.ac.uk/files/AF-",WM="-F1-model_v4.pdb";rc.add("alphafold",new class extends UM{getUrl(e){const t=Sc(e),n=t.name;let i;return t.ext&&"pdb"!==t.ext?(Yl.warn("unsupported AF ext",t.ext),i=jM+n+WM):i=jM+n+WM,"https://"+i}getExt(e){return Sc(e).ext||"pdb"}});const qM=/^((http|https|ftp):)*\/\//;class XM extends UM{constructor(e=""){super(),this.baseUrl=e}getUrl(e){const t=Sc(e);let n=this.baseUrl+t.path;return qM.test(this.baseUrl)||(n=function(e){const t=window.location,n=t.pathname,i=n.substring(0,n.lastIndexOf("/")+1);return t.origin+i+e}(n)),n}getExt(e){return Sc(e).ext}}class YM extends UM{constructor(e=""){super(),this.baseUrl=e}getListing(e=""){let t=`${this.baseUrl}dir/${e}`;return"/"!==t[t.length-1]&&(t+="/"),Mc(t,{ext:"json"}).then((t=>({path:e,data:t.data})))}getUrl(e){const t=Sc(e);return`${this.baseUrl}file/${t.path}${t.query}`}getCountUrl(e){const t=Sc(e);return`${this.baseUrl}traj/numframes/${t.path}${t.query}`}getFrameUrl(e,t){const n=Sc(e);return`${this.baseUrl}traj/frame/${t}/${n.path}${n.query}`}getFrameParams(e,t){return`atomIndices=${t.join(";")}`}getPathUrl(e,t){const n=Sc(e);return`${this.baseUrl}traj/path/${t}/${n.path}${n.query}`}getExt(e){return Sc(e).ext}}function KM(e,t){return{type:"integer",max:e,min:t}}function ZM(e,t,n){return{type:"number",precision:e,max:t,min:n}}function QM(e,t,n){return{type:"range",step:e,max:t,min:n}}function JM(...e){return{type:"select",options:e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:t})),{})}}const eC={backgroundColor:{type:"color"},quality:JM("auto","low","medium","high"),sampleLevel:QM(1,5,-1),impostor:{type:"boolean"},workerDefault:{type:"boolean"},rotateSpeed:ZM(1,10,0),zoomSpeed:ZM(1,10,0),panSpeed:ZM(1,10,0),clipNear:QM(1,100,0),clipFar:QM(1,100,0),clipDist:KM(200,0),clipMode:JM("scene","camera"),clipScale:JM("relative","absolute"),fogNear:QM(1,100,0),fogFar:QM(1,100,0),cameraType:JM("perspective","orthographic","stereo"),cameraEyeSep:ZM(3,1,.01),cameraFov:QM(1,120,15),lightColor:{type:"color"},lightIntensity:ZM(2,10,0),ambientColor:{type:"color"},ambientIntensity:ZM(2,10,0),hoverTimeout:KM(1e4,-1),tooltip:{type:"boolean"},mousePreset:JM(...Object.keys(cf))},tC="2.4.0"},211:e=>{"use strict";function t(e){this._maxSize=e,this.clear()}t.prototype.clear=function(){this._size=0,this._values=Object.create(null)},t.prototype.get=function(e){return this._values[e]},t.prototype.set=function(e,t){return this._size>=this._maxSize&&this.clear(),e in this._values||this._size++,this._values[e]=t};var n=/[^.^\]^[]+|(?=\[\]|\.\.)/g,i=/^\d+$/,r=/^\d/,s=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,o=/^\s*(['"]?)(.*?)(\1)\s*$/,a=new t(512),l=new t(512),c=new t(512);function u(e){return a.get(e)||a.set(e,h(e).map((function(e){return e.replace(o,"$2")})))}function h(e){return e.match(n)||[""]}function d(e){return"string"==typeof e&&e&&-1!==["'",'"'].indexOf(e.charAt(0))}function p(e){return!d(e)&&(function(e){return e.match(r)&&!e.match(i)}(e)||function(e){return s.test(e)}(e))}e.exports={Cache:t,split:h,normalizePath:u,setter:function(e){var t=u(e);return l.get(e)||l.set(e,(function(e,n){for(var i=0,r=t.length,s=e;i<r-1;){var o=t[i];if("__proto__"===o||"constructor"===o||"prototype"===o)return e;s=s[t[i++]]}s[t[i]]=n}))},getter:function(e,t){var n=u(e);return c.get(e)||c.set(e,(function(e){for(var i=0,r=n.length;i<r;){if(null==e&&t)return;e=e[n[i++]]}return e}))},join:function(e){return e.reduce((function(e,t){return e+(d(t)||i.test(t)?"["+t+"]":(e?".":"")+t)}),"")},forEach:function(e,t,n){!function(e,t,n){var i,r,s,o,a=e.length;for(r=0;r<a;r++)(i=e[r])&&(p(i)&&(i='"'+i+'"'),s=!(o=d(i))&&/^\d+$/.test(i),t.call(n,i,o,s,r,e))}(Array.isArray(e)?e:h(e),t,n)}}},6407:function(e,t,n){var i;!function(){function r(e,t,n,i,r){this._listener=t,this._isOnce=n,this.context=i,this._signal=e,this._priority=r||0}function s(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function o(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){o.prototype.dispatch.apply(e,arguments)}}r.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},o.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,i){var s,o=this._indexOfListener(e,n);if(-1!==o){if((s=this._bindings[o]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else s=new r(this,e,t,n,i),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===e&&n.context===t)return i;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return s(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return s(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){s(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var a=o;a.Signal=o,void 0===(i=function(){return a}.call(t,n,t,e))||(e.exports=i)}()},2917:(e,t,n)=>{var i;!function(){"use strict";var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function s(e){return function(e,t){var n,i,o,a,l,c,u,h,d,p=1,f=e.length,m="";for(i=0;i<f;i++)if("string"==typeof e[i])m+=e[i];else if("object"==typeof e[i]){if((a=e[i]).keys)for(n=t[p],o=0;o<a.keys.length;o++){if(null==n)throw new Error(s('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?t[a.param_no]:t[p++];if(r.not_type.test(a.type)&&r.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),r.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(s("[sprintf] expecting number but found %T",n));switch(r.number.test(a.type)&&(h=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}r.json.test(a.type)?m+=n:(!r.number.test(a.type)||h&&!a.sign?d="":(d=h?"+":"-",n=n.toString().replace(r.sign,"")),c=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",u=a.width-(d+n).length,l=a.width&&u>0?c.repeat(u):"",m+=a.align?d+n+l:"0"===c?d+l+n:l+d+n)}return m}(function(e){if(a[e])return a[e];for(var t,n=e,i=[],s=0;n;){if(null!==(t=r.text.exec(n)))i.push(t[0]);else if(null!==(t=r.modulo.exec(n)))i.push("%");else{if(null===(t=r.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){s|=1;var o=[],l=t[2],c=[];if(null===(c=r.key.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(c[1]);""!==(l=l.substring(c[0].length));)if(null!==(c=r.key_access.exec(l)))o.push(c[1]);else{if(null===(c=r.index_access.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(c[1])}t[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return a[e]=i}(e),arguments)}function o(e,t){return s.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=s,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=s,window.vsprintf=o,void 0===(i=function(){return{sprintf:s,vsprintf:o}}.call(t,n,t,e))||(e.exports=i))}()},8105:e=>{const t=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['’](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['’](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['’](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,n=e=>e.match(t)||[],i=e=>e[0].toUpperCase()+e.slice(1),r=(e,t)=>n(e).join(t).toLowerCase(),s=e=>n(e).reduce(((e,t)=>`${e}${e?t[0].toUpperCase()+t.slice(1).toLowerCase():t.toLowerCase()}`),"");e.exports={words:n,upperFirst:i,camelCase:s,pascalCase:e=>i(s(e)),snakeCase:e=>r(e,"_"),kebabCase:e=>r(e,"-"),sentenceCase:e=>i(r(e," ")),titleCase:e=>n(e).map(i).join(" ")}},3404:e=>{function t(e,t){var n=e.length,i=new Array(n),r={},s=n,o=function(e){for(var t=new Map,n=0,i=e.length;n<i;n++){var r=e[n];t.has(r[0])||t.set(r[0],new Set),t.has(r[1])||t.set(r[1],new Set),t.get(r[0]).add(r[1])}return t}(t),a=function(e){for(var t=new Map,n=0,i=e.length;n<i;n++)t.set(e[n],n);return t}(e);for(t.forEach((function(e){if(!a.has(e[0])||!a.has(e[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")}));s--;)r[s]||l(e[s],s,new Set);return i;function l(e,t,s){if(s.has(e)){var c;try{c=", node was:"+JSON.stringify(e)}catch(e){c=""}throw new Error("Cyclic dependency"+c)}if(!a.has(e))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(e));if(!r[t]){r[t]=!0;var u=o.get(e)||new Set;if(t=(u=Array.from(u)).length){s.add(e);do{var h=u[--t];l(h,a.get(h),s)}while(t);s.delete(e)}i[--n]=e}}}e.exports=function(e){return t(function(e){for(var t=new Set,n=0,i=e.length;n<i;n++){var r=e[n];t.add(r[0]),t.add(r[1])}return Array.from(t)}(e),e)},e.exports.array=t},6495:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ArraySchema:()=>_e,BooleanSchema:()=>j,DateSchema:()=>ae,MixedSchema:()=>$,NumberSchema:()=>re,ObjectSchema:()=>me,Schema:()=>z,StringSchema:()=>ne,TupleSchema:()=>ye,ValidationError:()=>b,addMethod:()=>Se,array:()=>ge,bool:()=>G,boolean:()=>G,date:()=>oe,defaultLocale:()=>P,getIn:()=>N,isSchema:()=>I,lazy:()=>be,mixed:()=>H,number:()=>ie,object:()=>fe,printValue:()=>p,reach:()=>F,ref:()=>R,setLocale:()=>we,string:()=>te,tuple:()=>ve});var i=n(211),r=n(8105),s=n(3404),o=n.n(s);const a=Object.prototype.toString,l=Error.prototype.toString,c=RegExp.prototype.toString,u="undefined"!=typeof Symbol?Symbol.prototype.toString:()=>"",h=/^Symbol\((.*)\)(.*)$/;function d(e,t=!1){if(null==e||!0===e||!1===e)return""+e;const n=typeof e;if("number"===n)return function(e){return e!=+e?"NaN":0===e&&1/e<0?"-0":""+e}(e);if("string"===n)return t?`"${e}"`:e;if("function"===n)return"[Function "+(e.name||"anonymous")+"]";if("symbol"===n)return u.call(e).replace(h,"Symbol($1)");const i=a.call(e).slice(8,-1);return"Date"===i?isNaN(e.getTime())?""+e:e.toISOString(e):"Error"===i||e instanceof Error?"["+l.call(e)+"]":"RegExp"===i?c.call(e):null}function p(e,t){let n=d(e,t);return null!==n?n:JSON.stringify(e,(function(e,n){let i=d(this[e],t);return null!==i?i:n}),2)}function f(e){return null==e?[]:[].concat(e)}let m,g,_,v=/\$\{\s*(\w+)\s*\}/g;m=Symbol.toStringTag;class y{constructor(e,t,n,i){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[m]="Error",this.name="ValidationError",this.value=t,this.path=n,this.type=i,this.errors=[],this.inner=[],f(e).forEach((e=>{if(b.isError(e)){this.errors.push(...e.errors);const t=e.inner.length?e.inner:[e];this.inner.push(...t)}else this.errors.push(e)})),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}g=Symbol.hasInstance,_=Symbol.toStringTag;class b extends Error{static formatError(e,t){const n=t.label||t.path||"this";return n!==t.path&&(t=Object.assign({},t,{path:n})),"string"==typeof e?e.replace(v,((e,n)=>p(t[n]))):"function"==typeof e?e(t):e}static isError(e){return e&&"ValidationError"===e.name}constructor(e,t,n,i,r){const s=new y(e,t,n,i);if(r)return s;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[_]="Error",this.name=s.name,this.message=s.message,this.type=s.type,this.value=s.value,this.path=s.path,this.errors=s.errors,this.inner=s.inner,Error.captureStackTrace&&Error.captureStackTrace(this,b)}static[g](e){return y[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let x={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:e,type:t,value:n,originalValue:i})=>{const r=null!=i&&i!==n?` (cast from the value \`${p(i,!0)}\`).`:".";return"mixed"!==t?`${e} must be a \`${t}\` type, but the final value was: \`${p(n,!0)}\``+r:`${e} must match the configured type. The validated value was: \`${p(n,!0)}\``+r}},w={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},S={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},A={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},M={isValue:"${path} field must be ${value}"},C={noUnknown:"${path} field has unspecified keys: ${unknown}"},T={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},E={notType:e=>{const{path:t,value:n,spec:i}=e,r=i.types.length;if(Array.isArray(n)){if(n.length<r)return`${t} tuple value has too few items, expected a length of ${r} but got ${n.length} for value: \`${p(n,!0)}\``;if(n.length>r)return`${t} tuple value has too many items, expected a length of ${r} but got ${n.length} for value: \`${p(n,!0)}\``}return b.formatError(x.notType,e)}};var P=Object.assign(Object.create(null),{mixed:x,string:w,number:S,date:A,object:C,array:T,boolean:M,tuple:E});const I=e=>e&&e.__isYupSchema__;class k{static fromOptions(e,t){if(!t.then&&!t.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:n,then:i,otherwise:r}=t,s="function"==typeof n?n:(...e)=>e.every((e=>e===n));return new k(e,((e,t)=>{var n;let o=s(...e)?i:r;return null!=(n=null==o?void 0:o(t))?n:t}))}constructor(e,t){this.fn=void 0,this.refs=e,this.refs=e,this.fn=t}resolve(e,t){let n=this.refs.map((e=>e.getValue(null==t?void 0:t.value,null==t?void 0:t.parent,null==t?void 0:t.context))),i=this.fn(n,e,t);if(void 0===i||i===e)return e;if(!I(i))throw new TypeError("conditions must return a schema object");return i.resolve(t)}}function R(e,t){return new D(e,t)}class D{constructor(e,t={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,"string"!=typeof e)throw new TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),""===e)throw new TypeError("ref must be a non-empty string");this.isContext="$"===this.key[0],this.isValue="."===this.key[0],this.isSibling=!this.isContext&&!this.isValue;let n=this.isContext?"$":this.isValue?".":"";this.path=this.key.slice(n.length),this.getter=this.path&&(0,i.getter)(this.path,!0),this.map=t.map}getValue(e,t,n){let i=this.isContext?n:this.isValue?e:t;return this.getter&&(i=this.getter(i||{})),this.map&&(i=this.map(i)),i}cast(e,t){return this.getValue(e,null==t?void 0:t.parent,null==t?void 0:t.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}}D.prototype.__isYupRef=!0;const L=e=>null==e;function O(e){function t({value:t,path:n="",options:i,originalValue:r,schema:s},o,a){const{name:l,test:c,params:u,message:h,skipAbsent:d}=e;let{parent:p,context:f,abortEarly:m=s.spec.abortEarly,disableStackTrace:g=s.spec.disableStackTrace}=i;function _(e){return D.isRef(e)?e.getValue(t,p,f):e}function v(e={}){const i=Object.assign({value:t,originalValue:r,label:s.spec.label,path:e.path||n,spec:s.spec,disableStackTrace:e.disableStackTrace||g},u,e.params);for(const e of Object.keys(i))i[e]=_(i[e]);const o=new b(b.formatError(e.message||h,i),t,i.path,e.type||l,i.disableStackTrace);return o.params=i,o}const y=m?o:a;let x={path:n,parent:p,type:l,from:i.from,createError:v,resolve:_,options:i,originalValue:r,schema:s};const w=e=>{b.isError(e)?y(e):e?a(null):y(v())},S=e=>{b.isError(e)?y(e):o(e)};if(d&&L(t))return w(!0);let A;try{var M;if(A=c.call(x,t,x),"function"==typeof(null==(M=A)?void 0:M.then)){if(i.sync)throw new Error(`Validation test of type: "${x.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(A).then(w,S)}}catch(e){return void S(e)}w(A)}return t.OPTIONS=e,t}function N(e,t,n,r=n){let s,o,a;return t?((0,i.forEach)(t,((i,l,c)=>{let u=l?i.slice(1,i.length-1):i,h="tuple"===(e=e.resolve({context:r,parent:s,value:n})).type,d=c?parseInt(u,10):0;if(e.innerType||h){if(h&&!c)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${a}" must contain an index to the tuple element, e.g. "${a}[0]"`);if(n&&d>=n.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${i}, in the path: ${t}. because there is no value at that index. `);s=n,n=n&&n[d],e=h?e.spec.types[d]:e.innerType}if(!c){if(!e.fields||!e.fields[u])throw new Error(`The schema does not contain the path: ${t}. (failed at: ${a} which is a type: "${e.type}")`);s=n,n=n&&n[u],e=e.fields[u]}o=u,a=l?"["+i+"]":"."+i})),{schema:e,parent:s,parentPath:o}):{parent:s,parentPath:t,schema:e}}function F(e,t,n,i){return N(e,t,n,i).schema}class B extends Set{describe(){const e=[];for(const t of this.values())e.push(D.isRef(t)?t.describe():t);return e}resolveAll(e){let t=[];for(const n of this.values())t.push(e(n));return t}clone(){return new B(this.values())}merge(e,t){const n=this.clone();return e.forEach((e=>n.add(e))),t.forEach((e=>n.delete(e))),n}}function U(e,t=new Map){if(I(e)||!e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);let n;if(e instanceof Date)n=new Date(e.getTime()),t.set(e,n);else if(e instanceof RegExp)n=new RegExp(e),t.set(e,n);else if(Array.isArray(e)){n=new Array(e.length),t.set(e,n);for(let i=0;i<e.length;i++)n[i]=U(e[i],t)}else if(e instanceof Map){n=new Map,t.set(e,n);for(const[i,r]of e.entries())n.set(i,U(r,t))}else if(e instanceof Set){n=new Set,t.set(e,n);for(const i of e)n.add(U(i,t))}else{if(!(e instanceof Object))throw Error(`Unable to clone ${e}`);n={},t.set(e,n);for(const[i,r]of Object.entries(e))n[i]=U(r,t)}return n}class z{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new B,this._blacklist=new B,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation((()=>{this.typeError(x.notType)})),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},null==e?void 0:e.spec),this.withMutation((e=>{e.nonNullable()}))}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;const t=Object.create(Object.getPrototypeOf(this));return t.type=this.type,t._typeCheck=this._typeCheck,t._whitelist=this._whitelist.clone(),t._blacklist=this._blacklist.clone(),t.internalTests=Object.assign({},this.internalTests),t.exclusiveTests=Object.assign({},this.exclusiveTests),t.deps=[...this.deps],t.conditions=[...this.conditions],t.tests=[...this.tests],t.transforms=[...this.transforms],t.spec=U(Object.assign({},this.spec,e)),t}label(e){let t=this.clone();return t.spec.label=e,t}meta(...e){if(0===e.length)return this.spec.meta;let t=this.clone();return t.spec.meta=Object.assign(t.spec.meta||{},e[0]),t}withMutation(e){let t=this._mutate;this._mutate=!0;let n=e(this);return this._mutate=t,n}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&"mixed"!==this.type)throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let t=this,n=e.clone();const i=Object.assign({},t.spec,n.spec);return n.spec=i,n.internalTests=Object.assign({},t.internalTests,n.internalTests),n._whitelist=t._whitelist.merge(e._whitelist,e._blacklist),n._blacklist=t._blacklist.merge(e._blacklist,e._whitelist),n.tests=t.tests,n.exclusiveTests=t.exclusiveTests,n.withMutation((t=>{e.tests.forEach((e=>{t.test(e.OPTIONS)}))})),n.transforms=[...t.transforms,...n.transforms],n}isType(e){return null==e?!(!this.spec.nullable||null!==e)||!(!this.spec.optional||void 0!==e):this._typeCheck(e)}resolve(e){let t=this;if(t.conditions.length){let n=t.conditions;t=t.clone(),t.conditions=[],t=n.reduce(((t,n)=>n.resolve(t,e)),t),t=t.resolve(e)}return t}resolveOptions(e){var t,n,i,r;return Object.assign({},e,{from:e.from||[],strict:null!=(t=e.strict)?t:this.spec.strict,abortEarly:null!=(n=e.abortEarly)?n:this.spec.abortEarly,recursive:null!=(i=e.recursive)?i:this.spec.recursive,disableStackTrace:null!=(r=e.disableStackTrace)?r:this.spec.disableStackTrace})}cast(e,t={}){let n=this.resolve(Object.assign({value:e},t)),i="ignore-optionality"===t.assert,r=n._cast(e,t);if(!1!==t.assert&&!n.isType(r)){if(i&&L(r))return r;let s=p(e),o=p(r);throw new TypeError(`The value of ${t.path||"field"} could not be cast to a value that satisfies the schema type: "${n.type}". \n\nattempted value: ${s} \n`+(o!==s?`result of cast: ${o}`:""))}return r}_cast(e,t){let n=void 0===e?e:this.transforms.reduce(((t,n)=>n.call(this,t,e,this)),e);return void 0===n&&(n=this.getDefault(t)),n}_validate(e,t={},n,i){let{path:r,originalValue:s=e,strict:o=this.spec.strict}=t,a=e;o||(a=this._cast(a,Object.assign({assert:!1},t)));let l=[];for(let e of Object.values(this.internalTests))e&&l.push(e);this.runTests({path:r,value:a,originalValue:s,options:t,tests:l},n,(e=>{if(e.length)return i(e,a);this.runTests({path:r,value:a,originalValue:s,options:t,tests:this.tests},n,i)}))}runTests(e,t,n){let i=!1,{tests:r,value:s,originalValue:o,path:a,options:l}=e,c=e=>{i||(i=!0,t(e,s))},u=e=>{i||(i=!0,n(e,s))},h=r.length,d=[];if(!h)return u([]);let p={value:s,originalValue:o,path:a,options:l,schema:this};for(let e=0;e<r.length;e++)(0,r[e])(p,c,(function(e){e&&(Array.isArray(e)?d.push(...e):d.push(e)),--h<=0&&u(d)}))}asNestedTest({key:e,index:t,parent:n,parentPath:i,originalParent:r,options:s}){const o=null!=e?e:t;if(null==o)throw TypeError("Must include `key` or `index` for nested validations");const a="number"==typeof o;let l=n[o];const c=Object.assign({},s,{strict:!0,parent:n,value:l,originalValue:r[o],key:void 0,[a?"index":"key"]:o,path:a||o.includes(".")?`${i||""}[${a?o:`"${o}"`}]`:(i?`${i}.`:"")+e});return(e,t,n)=>this.resolve(c)._validate(l,c,t,n)}validate(e,t){var n;let i=this.resolve(Object.assign({},t,{value:e})),r=null!=(n=null==t?void 0:t.disableStackTrace)?n:i.spec.disableStackTrace;return new Promise(((n,s)=>i._validate(e,t,((e,t)=>{b.isError(e)&&(e.value=t),s(e)}),((e,t)=>{e.length?s(new b(e,t,void 0,void 0,r)):n(t)}))))}validateSync(e,t){var n;let i,r=this.resolve(Object.assign({},t,{value:e})),s=null!=(n=null==t?void 0:t.disableStackTrace)?n:r.spec.disableStackTrace;return r._validate(e,Object.assign({},t,{sync:!0}),((e,t)=>{throw b.isError(e)&&(e.value=t),e}),((t,n)=>{if(t.length)throw new b(t,e,void 0,void 0,s);i=n})),i}isValid(e,t){return this.validate(e,t).then((()=>!0),(e=>{if(b.isError(e))return!1;throw e}))}isValidSync(e,t){try{return this.validateSync(e,t),!0}catch(e){if(b.isError(e))return!1;throw e}}_getDefault(e){let t=this.spec.default;return null==t?t:"function"==typeof t?t.call(this,e):U(t)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return 0===arguments.length?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,t){const n=this.clone({nullable:e});return n.internalTests.nullable=O({message:t,name:"nullable",test(e){return null!==e||this.schema.spec.nullable}}),n}optionality(e,t){const n=this.clone({optional:e});return n.internalTests.optionality=O({message:t,name:"optionality",test(e){return void 0!==e||this.schema.spec.optional}}),n}optional(){return this.optionality(!0)}defined(e=x.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=x.notNull){return this.nullability(!1,e)}required(e=x.required){return this.clone().withMutation((t=>t.nonNullable(e).defined(e)))}notRequired(){return this.clone().withMutation((e=>e.nullable().optional()))}transform(e){let t=this.clone();return t.transforms.push(e),t}test(...e){let t;if(t=1===e.length?"function"==typeof e[0]?{test:e[0]}:e[0]:2===e.length?{name:e[0],test:e[1]}:{name:e[0],message:e[1],test:e[2]},void 0===t.message&&(t.message=x.default),"function"!=typeof t.test)throw new TypeError("`test` is a required parameters");let n=this.clone(),i=O(t),r=t.exclusive||t.name&&!0===n.exclusiveTests[t.name];if(t.exclusive&&!t.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return t.name&&(n.exclusiveTests[t.name]=!!t.exclusive),n.tests=n.tests.filter((e=>{if(e.OPTIONS.name===t.name){if(r)return!1;if(e.OPTIONS.test===i.OPTIONS.test)return!1}return!0})),n.tests.push(i),n}when(e,t){Array.isArray(e)||"string"==typeof e||(t=e,e=".");let n=this.clone(),i=f(e).map((e=>new D(e)));return i.forEach((e=>{e.isSibling&&n.deps.push(e.key)})),n.conditions.push("function"==typeof t?new k(i,t):k.fromOptions(i,t)),n}typeError(e){let t=this.clone();return t.internalTests.typeError=O({message:e,name:"typeError",skipAbsent:!0,test(e){return!!this.schema._typeCheck(e)||this.createError({params:{type:this.schema.type}})}}),t}oneOf(e,t=x.oneOf){let n=this.clone();return e.forEach((e=>{n._whitelist.add(e),n._blacklist.delete(e)})),n.internalTests.whiteList=O({message:t,name:"oneOf",skipAbsent:!0,test(e){let t=this.schema._whitelist,n=t.resolveAll(this.resolve);return!!n.includes(e)||this.createError({params:{values:Array.from(t).join(", "),resolved:n}})}}),n}notOneOf(e,t=x.notOneOf){let n=this.clone();return e.forEach((e=>{n._blacklist.add(e),n._whitelist.delete(e)})),n.internalTests.blacklist=O({message:t,name:"notOneOf",test(e){let t=this.schema._blacklist,n=t.resolveAll(this.resolve);return!n.includes(e)||this.createError({params:{values:Array.from(t).join(", "),resolved:n}})}}),n}strip(e=!0){let t=this.clone();return t.spec.strip=e,t}describe(e){const t=(e?this.resolve(e):this).clone(),{label:n,meta:i,optional:r,nullable:s}=t.spec;return{meta:i,label:n,optional:r,nullable:s,default:t.getDefault(e),type:t.type,oneOf:t._whitelist.describe(),notOneOf:t._blacklist.describe(),tests:t.tests.map((e=>({name:e.OPTIONS.name,params:e.OPTIONS.params}))).filter(((e,t,n)=>n.findIndex((t=>t.name===e.name))===t))}}}z.prototype.__isYupSchema__=!0;for(const e of["validate","validateSync"])z.prototype[`${e}At`]=function(t,n,i={}){const{parent:r,parentPath:s,schema:o}=N(this,t,n,i.context);return o[e](r&&r[s],Object.assign({},i,{parent:r,path:t}))};for(const e of["equals","is"])z.prototype[e]=z.prototype.oneOf;for(const e of["not","nope"])z.prototype[e]=z.prototype.notOneOf;const V=()=>!0;function H(e){return new $(e)}class $ extends z{constructor(e){super("function"==typeof e?{type:"mixed",check:e}:Object.assign({type:"mixed",check:V},e))}}function G(){return new j}H.prototype=$.prototype;class j extends z{constructor(){super({type:"boolean",check:e=>(e instanceof Boolean&&(e=e.valueOf()),"boolean"==typeof e)}),this.withMutation((()=>{this.transform(((e,t,n)=>{if(n.spec.coerce&&!n.isType(e)){if(/^(true|1)$/i.test(String(e)))return!0;if(/^(false|0)$/i.test(String(e)))return!1}return e}))}))}isTrue(e=M.isValue){return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"true"},test:e=>L(e)||!0===e})}isFalse(e=M.isValue){return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"false"},test:e=>L(e)||!1===e})}default(e){return super.default(e)}defined(e){return super.defined(e)}optional(){return super.optional()}required(e){return super.required(e)}notRequired(){return super.notRequired()}nullable(){return super.nullable()}nonNullable(e){return super.nonNullable(e)}strip(e){return super.strip(e)}}G.prototype=j.prototype;const W=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function q(e){var t,n;const i=W.exec(e);return i?{year:X(i[1]),month:X(i[2],1)-1,day:X(i[3],1),hour:X(i[4]),minute:X(i[5]),second:X(i[6]),millisecond:i[7]?X(i[7].substring(0,3)):0,precision:null!=(t=null==(n=i[7])?void 0:n.length)?t:void 0,z:i[8]||void 0,plusMinus:i[9]||void 0,hourOffset:X(i[10]),minuteOffset:X(i[11])}:null}function X(e,t=0){return Number(e)||t}let Y=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,K=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,Z=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Q=new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"),J=e=>L(e)||e===e.trim(),ee={}.toString();function te(){return new ne}class ne extends z{constructor(){super({type:"string",check:e=>(e instanceof String&&(e=e.valueOf()),"string"==typeof e)}),this.withMutation((()=>{this.transform(((e,t,n)=>{if(!n.spec.coerce||n.isType(e))return e;if(Array.isArray(e))return e;const i=null!=e&&e.toString?e.toString():e;return i===ee?e:i}))}))}required(e){return super.required(e).withMutation((t=>t.test({message:e||x.required,name:"required",skipAbsent:!0,test:e=>!!e.length})))}notRequired(){return super.notRequired().withMutation((e=>(e.tests=e.tests.filter((e=>"required"!==e.OPTIONS.name)),e)))}length(e,t=w.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(t){return t.length===this.resolve(e)}})}min(e,t=w.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(t){return t.length>=this.resolve(e)}})}max(e,t=w.max){return this.test({name:"max",exclusive:!0,message:t,params:{max:e},skipAbsent:!0,test(t){return t.length<=this.resolve(e)}})}matches(e,t){let n,i,r=!1;return t&&("object"==typeof t?({excludeEmptyString:r=!1,message:n,name:i}=t):n=t),this.test({name:i||"matches",message:n||w.matches,params:{regex:e},skipAbsent:!0,test:t=>""===t&&r||-1!==t.search(e)})}email(e=w.email){return this.matches(Y,{name:"email",message:e,excludeEmptyString:!0})}url(e=w.url){return this.matches(K,{name:"url",message:e,excludeEmptyString:!0})}uuid(e=w.uuid){return this.matches(Z,{name:"uuid",message:e,excludeEmptyString:!1})}datetime(e){let t,n,i="";return e&&("object"==typeof e?({message:i="",allowOffset:t=!1,precision:n}=e):i=e),this.matches(Q,{name:"datetime",message:i||w.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:i||w.datetime_offset,params:{allowOffset:t},skipAbsent:!0,test:e=>{if(!e||t)return!0;const n=q(e);return!!n&&!!n.z}}).test({name:"datetime_precision",message:i||w.datetime_precision,params:{precision:n},skipAbsent:!0,test:e=>{if(!e||null==n)return!0;const t=q(e);return!!t&&t.precision===n}})}ensure(){return this.default("").transform((e=>null===e?"":e))}trim(e=w.trim){return this.transform((e=>null!=e?e.trim():e)).test({message:e,name:"trim",test:J})}lowercase(e=w.lowercase){return this.transform((e=>L(e)?e:e.toLowerCase())).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:e=>L(e)||e===e.toLowerCase()})}uppercase(e=w.uppercase){return this.transform((e=>L(e)?e:e.toUpperCase())).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:e=>L(e)||e===e.toUpperCase()})}}function ie(){return new re}te.prototype=ne.prototype;class re extends z{constructor(){super({type:"number",check:e=>(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&!(e=>e!=+e)(e))}),this.withMutation((()=>{this.transform(((e,t,n)=>{if(!n.spec.coerce)return e;let i=e;if("string"==typeof i){if(i=i.replace(/\s/g,""),""===i)return NaN;i=+i}return n.isType(i)||null===i?i:parseFloat(i)}))}))}min(e,t=S.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(t){return t>=this.resolve(e)}})}max(e,t=S.max){return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(t){return t<=this.resolve(e)}})}lessThan(e,t=S.lessThan){return this.test({message:t,name:"max",exclusive:!0,params:{less:e},skipAbsent:!0,test(t){return t<this.resolve(e)}})}moreThan(e,t=S.moreThan){return this.test({message:t,name:"min",exclusive:!0,params:{more:e},skipAbsent:!0,test(t){return t>this.resolve(e)}})}positive(e=S.positive){return this.moreThan(0,e)}negative(e=S.negative){return this.lessThan(0,e)}integer(e=S.integer){return this.test({name:"integer",message:e,skipAbsent:!0,test:e=>Number.isInteger(e)})}truncate(){return this.transform((e=>L(e)?e:0|e))}round(e){var t;let n=["ceil","floor","round","trunc"];if("trunc"===(e=(null==(t=e)?void 0:t.toLowerCase())||"round"))return this.truncate();if(-1===n.indexOf(e.toLowerCase()))throw new TypeError("Only valid options for round() are: "+n.join(", "));return this.transform((t=>L(t)?t:Math[e](t)))}}ie.prototype=re.prototype;let se=new Date("");function oe(){return new ae}class ae extends z{constructor(){super({type:"date",check(e){return t=e,"[object Date]"===Object.prototype.toString.call(t)&&!isNaN(e.getTime());var t}}),this.withMutation((()=>{this.transform(((e,t,n)=>!n.spec.coerce||n.isType(e)||null===e?e:(e=function(e){const t=q(e);if(!t)return Date.parse?Date.parse(e):Number.NaN;if(void 0===t.z&&void 0===t.plusMinus)return new Date(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond).valueOf();let n=0;return"Z"!==t.z&&void 0!==t.plusMinus&&(n=60*t.hourOffset+t.minuteOffset,"+"===t.plusMinus&&(n=0-n)),Date.UTC(t.year,t.month,t.day,t.hour,t.minute+n,t.second,t.millisecond)}(e),isNaN(e)?ae.INVALID_DATE:new Date(e))))}))}prepareParam(e,t){let n;if(D.isRef(e))n=e;else{let i=this.cast(e);if(!this._typeCheck(i))throw new TypeError(`\`${t}\` must be a Date or a value that can be \`cast()\` to a Date`);n=i}return n}min(e,t=A.min){let n=this.prepareParam(e,"min");return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(e){return e>=this.resolve(n)}})}max(e,t=A.max){let n=this.prepareParam(e,"max");return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(e){return e<=this.resolve(n)}})}}function le(e,t){let n=1/0;return e.some(((e,i)=>{var r;if(null!=(r=t.path)&&r.includes(e))return n=i,!0})),n}function ce(e){return(t,n)=>le(e,t)-le(e,n)}ae.INVALID_DATE=se,oe.prototype=ae.prototype,oe.INVALID_DATE=se;const ue=(e,t,n)=>{if("string"!=typeof e)return e;let i=e;try{i=JSON.parse(e)}catch(e){}return n.isType(i)?i:e};function he(e){if("fields"in e){const t={};for(const[n,i]of Object.entries(e.fields))t[n]=he(i);return e.setFields(t)}if("array"===e.type){const t=e.optional();return t.innerType&&(t.innerType=he(t.innerType)),t}return"tuple"===e.type?e.optional().clone({types:e.spec.types.map(he)}):"optional"in e?e.optional():e}let de=e=>"[object Object]"===Object.prototype.toString.call(e);const pe=ce([]);function fe(e){return new me(e)}class me extends z{constructor(e){super({type:"object",check:e=>de(e)||"function"==typeof e}),this.fields=Object.create(null),this._sortErrors=pe,this._nodes=[],this._excludedEdges=[],this.withMutation((()=>{e&&this.shape(e)}))}_cast(e,t={}){var n;let i=super._cast(e,t);if(void 0===i)return this.getDefault(t);if(!this._typeCheck(i))return i;let r=this.fields,s=null!=(n=t.stripUnknown)?n:this.spec.noUnknown,o=[].concat(this._nodes,Object.keys(i).filter((e=>!this._nodes.includes(e)))),a={},l=Object.assign({},t,{parent:a,__validating:t.__validating||!1}),c=!1;for(const e of o){let n=r[e],o=e in i;if(n){let r,s=i[e];l.path=(t.path?`${t.path}.`:"")+e,n=n.resolve({value:s,context:t.context,parent:a});let o=n instanceof z?n.spec:void 0,u=null==o?void 0:o.strict;if(null!=o&&o.strip){c=c||e in i;continue}r=t.__validating&&u?i[e]:n.cast(i[e],l),void 0!==r&&(a[e]=r)}else o&&!s&&(a[e]=i[e]);o===e in a&&a[e]===i[e]||(c=!0)}return c?a:i}_validate(e,t={},n,i){let{from:r=[],originalValue:s=e,recursive:o=this.spec.recursive}=t;t.from=[{schema:this,value:s},...r],t.__validating=!0,t.originalValue=s,super._validate(e,t,n,((e,r)=>{if(!o||!de(r))return void i(e,r);s=s||r;let a=[];for(let e of this._nodes){let n=this.fields[e];n&&!D.isRef(n)&&a.push(n.asNestedTest({options:t,key:e,parent:r,parentPath:t.path,originalParent:s}))}this.runTests({tests:a,value:r,originalValue:s,options:t},n,(t=>{i(t.sort(this._sortErrors).concat(e),r)}))}))}clone(e){const t=super.clone(e);return t.fields=Object.assign({},this.fields),t._nodes=this._nodes,t._excludedEdges=this._excludedEdges,t._sortErrors=this._sortErrors,t}concat(e){let t=super.concat(e),n=t.fields;for(let[e,t]of Object.entries(this.fields)){const i=n[e];n[e]=void 0===i?t:i}return t.withMutation((t=>t.setFields(n,[...this._excludedEdges,...e._excludedEdges])))}_getDefault(e){if("default"in this.spec)return super._getDefault(e);if(!this._nodes.length)return;let t={};return this._nodes.forEach((n=>{var i;const r=this.fields[n];let s=e;null!=(i=s)&&i.value&&(s=Object.assign({},s,{parent:s.value,value:s.value[n]})),t[n]=r&&"getDefault"in r?r.getDefault(s):void 0})),t}setFields(e,t){let n=this.clone();return n.fields=e,n._nodes=function(e,t=[]){let n=[],r=new Set,s=new Set(t.map((([e,t])=>`${e}-${t}`)));function a(e,t){let o=(0,i.split)(e)[0];r.add(o),s.has(`${t}-${o}`)||n.push([t,o])}for(const t of Object.keys(e)){let n=e[t];r.add(t),D.isRef(n)&&n.isSibling?a(n.path,t):I(n)&&"deps"in n&&n.deps.forEach((e=>a(e,t)))}return o().array(Array.from(r),n).reverse()}(e,t),n._sortErrors=ce(Object.keys(e)),t&&(n._excludedEdges=t),n}shape(e,t=[]){return this.clone().withMutation((n=>{let i=n._excludedEdges;return t.length&&(Array.isArray(t[0])||(t=[t]),i=[...n._excludedEdges,...t]),n.setFields(Object.assign(n.fields,e),i)}))}partial(){const e={};for(const[t,n]of Object.entries(this.fields))e[t]="optional"in n&&n.optional instanceof Function?n.optional():n;return this.setFields(e)}deepPartial(){return he(this)}pick(e){const t={};for(const n of e)this.fields[n]&&(t[n]=this.fields[n]);return this.setFields(t,this._excludedEdges.filter((([t,n])=>e.includes(t)&&e.includes(n))))}omit(e){const t=[];for(const n of Object.keys(this.fields))e.includes(n)||t.push(n);return this.pick(t)}from(e,t,n){let r=(0,i.getter)(e,!0);return this.transform((s=>{if(!s)return s;let o=s;return((e,t)=>{const n=[...(0,i.normalizePath)(t)];if(1===n.length)return n[0]in e;let r=n.pop(),s=(0,i.getter)((0,i.join)(n),!0)(e);return!(!s||!(r in s))})(s,e)&&(o=Object.assign({},s),n||delete o[e],o[t]=r(s)),o}))}json(){return this.transform(ue)}noUnknown(e=!0,t=C.noUnknown){"boolean"!=typeof e&&(t=e,e=!0);let n=this.test({name:"noUnknown",exclusive:!0,message:t,test(t){if(null==t)return!0;const n=function(e,t){let n=Object.keys(e.fields);return Object.keys(t).filter((e=>-1===n.indexOf(e)))}(this.schema,t);return!e||0===n.length||this.createError({params:{unknown:n.join(", ")}})}});return n.spec.noUnknown=e,n}unknown(e=!0,t=C.noUnknown){return this.noUnknown(!e,t)}transformKeys(e){return this.transform((t=>{if(!t)return t;const n={};for(const i of Object.keys(t))n[e(i)]=t[i];return n}))}camelCase(){return this.transformKeys(r.camelCase)}snakeCase(){return this.transformKeys(r.snakeCase)}constantCase(){return this.transformKeys((e=>(0,r.snakeCase)(e).toUpperCase()))}describe(e){const t=(e?this.resolve(e):this).clone(),n=super.describe(e);n.fields={};for(const[r,s]of Object.entries(t.fields)){var i;let t=e;null!=(i=t)&&i.value&&(t=Object.assign({},t,{parent:t.value,value:t.value[r]})),n.fields[r]=s.describe(t)}return n}}function ge(e){return new _e(e)}fe.prototype=me.prototype;class _e extends z{constructor(e){super({type:"array",spec:{types:e},check:e=>Array.isArray(e)}),this.innerType=void 0,this.innerType=e}_cast(e,t){const n=super._cast(e,t);if(!this._typeCheck(n)||!this.innerType)return n;let i=!1;const r=n.map(((e,n)=>{const r=this.innerType.cast(e,Object.assign({},t,{path:`${t.path||""}[${n}]`}));return r!==e&&(i=!0),r}));return i?r:n}_validate(e,t={},n,i){var r;let s=this.innerType,o=null!=(r=t.recursive)?r:this.spec.recursive;null!=t.originalValue&&t.originalValue,super._validate(e,t,n,((r,a)=>{var l;if(!o||!s||!this._typeCheck(a))return void i(r,a);let c=new Array(a.length);for(let n=0;n<a.length;n++){var u;c[n]=s.asNestedTest({options:t,index:n,parent:a,parentPath:t.path,originalParent:null!=(u=t.originalValue)?u:e})}this.runTests({value:a,tests:c,originalValue:null!=(l=t.originalValue)?l:e,options:t},n,(e=>i(e.concat(r),a)))}))}clone(e){const t=super.clone(e);return t.innerType=this.innerType,t}json(){return this.transform(ue)}concat(e){let t=super.concat(e);return t.innerType=this.innerType,e.innerType&&(t.innerType=t.innerType?t.innerType.concat(e.innerType):e.innerType),t}of(e){let t=this.clone();if(!I(e))throw new TypeError("`array.of()` sub-schema must be a valid yup schema not: "+p(e));return t.innerType=e,t.spec=Object.assign({},t.spec,{types:e}),t}length(e,t=T.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(t){return t.length===this.resolve(e)}})}min(e,t){return t=t||T.min,this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(t){return t.length>=this.resolve(e)}})}max(e,t){return t=t||T.max,this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(t){return t.length<=this.resolve(e)}})}ensure(){return this.default((()=>[])).transform(((e,t)=>this._typeCheck(e)?e:null==t?[]:[].concat(t)))}compact(e){let t=e?(t,n,i)=>!e(t,n,i):e=>!!e;return this.transform((e=>null!=e?e.filter(t):e))}describe(e){const t=(e?this.resolve(e):this).clone(),n=super.describe(e);if(t.innerType){var i;let r=e;null!=(i=r)&&i.value&&(r=Object.assign({},r,{parent:r.value,value:r.value[0]})),n.innerType=t.innerType.describe(r)}return n}}function ve(e){return new ye(e)}ge.prototype=_e.prototype;class ye extends z{constructor(e){super({type:"tuple",spec:{types:e},check(e){const t=this.spec.types;return Array.isArray(e)&&e.length===t.length}}),this.withMutation((()=>{this.typeError(E.notType)}))}_cast(e,t){const{types:n}=this.spec,i=super._cast(e,t);if(!this._typeCheck(i))return i;let r=!1;const s=n.map(((e,n)=>{const s=e.cast(i[n],Object.assign({},t,{path:`${t.path||""}[${n}]`}));return s!==i[n]&&(r=!0),s}));return r?s:i}_validate(e,t={},n,i){let r=this.spec.types;super._validate(e,t,n,((s,o)=>{var a;if(!this._typeCheck(o))return void i(s,o);let l=[];for(let[n,i]of r.entries()){var c;l[n]=i.asNestedTest({options:t,index:n,parent:o,parentPath:t.path,originalParent:null!=(c=t.originalValue)?c:e})}this.runTests({value:o,tests:l,originalValue:null!=(a=t.originalValue)?a:e,options:t},n,(e=>i(e.concat(s),o)))}))}describe(e){const t=(e?this.resolve(e):this).clone(),n=super.describe(e);return n.innerType=t.spec.types.map(((t,n)=>{var i;let r=e;return null!=(i=r)&&i.value&&(r=Object.assign({},r,{parent:r.value,value:r.value[n]})),t.describe(r)})),n}}function be(e){return new xe(e)}ve.prototype=ye.prototype;class xe{constructor(e){this.type="lazy",this.__isYupSchema__=!0,this.spec=void 0,this._resolve=(e,t={})=>{let n=this.builder(e,t);if(!I(n))throw new TypeError("lazy() functions must return a valid schema");return this.spec.optional&&(n=n.optional()),n.resolve(t)},this.builder=e,this.spec={meta:void 0,optional:!1}}clone(e){const t=new xe(this.builder);return t.spec=Object.assign({},this.spec,e),t}optionality(e){return this.clone({optional:e})}optional(){return this.optionality(!0)}resolve(e){return this._resolve(e.value,e)}cast(e,t){return this._resolve(e,t).cast(e,t)}asNestedTest(e){let{key:t,index:n,parent:i,options:r}=e,s=i[null!=n?n:t];return this._resolve(s,Object.assign({},r,{value:s,parent:i})).asNestedTest(e)}validate(e,t){return this._resolve(e,t).validate(e,t)}validateSync(e,t){return this._resolve(e,t).validateSync(e,t)}validateAt(e,t,n){return this._resolve(t,n).validateAt(e,t,n)}validateSyncAt(e,t,n){return this._resolve(t,n).validateSyncAt(e,t,n)}isValid(e,t){return this._resolve(e,t).isValid(e,t)}isValidSync(e,t){return this._resolve(e,t).isValidSync(e,t)}describe(e){return e?this.resolve(e).describe(e):{type:"lazy",meta:this.spec.meta,label:void 0}}meta(...e){if(0===e.length)return this.spec.meta;let t=this.clone();return t.spec.meta=Object.assign(t.spec.meta||{},e[0]),t}}function we(e){Object.keys(e).forEach((t=>{Object.keys(e[t]).forEach((n=>{P[t][n]=e[t][n]}))}))}function Se(e,t,n){if(!e||!I(e.prototype))throw new TypeError("You must provide a yup schema constructor function");if("string"!=typeof t)throw new TypeError("A Method name must be provided");if("function"!=typeof n)throw new TypeError("Method function must be provided");e.prototype[t]=n}},3457:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Accordion 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/accordion/#theming\n */\n.ui-accordion .ui-accordion-header {\n\tdisplay: block;\n\tcursor: pointer;\n\tposition: relative;\n\tmargin: 2px 0 0 0;\n\tpadding: .5em .5em .5em .7em;\n\tfont-size: 100%;\n}\n.ui-accordion .ui-accordion-content {\n\tpadding: 1em 2.2em;\n\tborder-top: 0;\n\toverflow: auto;\n}\n",""])},3774:(e,t,n)=>{(t=e.exports=n(742)()).i(n(5164),""),t.i(n(6028),""),t.push([e.id,"/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n */\n",""])},7047:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Autocomplete 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/autocomplete/#theming\n */\n.ui-autocomplete {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tcursor: default;\n}\n",""])},5164:(e,t,n)=>{(t=e.exports=n(742)()).i(n(7610),""),t.i(n(3457),""),t.i(n(7047),""),t.i(n(6519),""),t.i(n(2075),""),t.i(n(9839),""),t.i(n(6885),""),t.i(n(2275),""),t.i(n(6038),""),t.i(n(818),""),t.i(n(9871),""),t.i(n(9844),""),t.i(n(8611),""),t.i(n(7306),""),t.i(n(7783),""),t.i(n(988),""),t.i(n(4028),""),t.i(n(3303),""),t.i(n(1110),""),t.push([e.id,"/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n */\n",""])},6519:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Button 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/button/#theming\n */\n.ui-button {\n\tpadding: .4em 1em;\n\tdisplay: inline-block;\n\tposition: relative;\n\tline-height: normal;\n\tmargin-right: .1em;\n\tcursor: pointer;\n\tvertical-align: middle;\n\ttext-align: center;\n\t-webkit-user-select: none;\n\tuser-select: none;\n}\n\n.ui-button,\n.ui-button:link,\n.ui-button:visited,\n.ui-button:hover,\n.ui-button:active {\n\ttext-decoration: none;\n}\n\n/* to make room for the icon, a width needs to be set here */\n.ui-button-icon-only {\n\twidth: 2em;\n\tbox-sizing: border-box;\n\ttext-indent: -9999px;\n\twhite-space: nowrap;\n}\n\n/* no icon support for input elements */\ninput.ui-button.ui-button-icon-only {\n\ttext-indent: 0;\n}\n\n/* button icon element(s) */\n.ui-button-icon-only .ui-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\tmargin-top: -8px;\n\tmargin-left: -8px;\n}\n\n.ui-button.ui-icon-notext .ui-icon {\n\tpadding: 0;\n\twidth: 2.1em;\n\theight: 2.1em;\n\ttext-indent: -9999px;\n\twhite-space: nowrap;\n\n}\n\ninput.ui-button.ui-icon-notext .ui-icon {\n\twidth: auto;\n\theight: auto;\n\ttext-indent: 0;\n\twhite-space: normal;\n\tpadding: .4em 1em;\n}\n\n/* workarounds */\n/* Support: Firefox 5 - 125+ */\ninput.ui-button::-moz-focus-inner,\nbutton.ui-button::-moz-focus-inner {\n\tborder: 0;\n\tpadding: 0;\n}\n",""])},2075:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Checkboxradio 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/checkboxradio/#theming\n */\n\n.ui-checkboxradio-label .ui-icon-background {\n\tbox-shadow: inset 1px 1px 1px #ccc;\n\tborder-radius: .12em;\n\tborder: none;\n}\n.ui-checkboxradio-radio-label .ui-icon-background {\n\twidth: 16px;\n\theight: 16px;\n\tborder-radius: 1em;\n\toverflow: visible;\n\tborder: none;\n}\n.ui-checkboxradio-radio-label.ui-checkboxradio-checked .ui-icon,\n.ui-checkboxradio-radio-label.ui-checkboxradio-checked:hover .ui-icon {\n\tbackground-image: none;\n\twidth: 8px;\n\theight: 8px;\n\tborder-width: 4px;\n\tborder-style: solid;\n}\n.ui-checkboxradio-disabled {\n\tpointer-events: none;\n}\n",""])},9839:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Controlgroup 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/controlgroup/#theming\n */\n\n.ui-controlgroup {\n\tvertical-align: middle;\n\tdisplay: inline-block;\n}\n.ui-controlgroup > .ui-controlgroup-item {\n\tfloat: left;\n\tmargin-left: 0;\n\tmargin-right: 0;\n}\n.ui-controlgroup > .ui-controlgroup-item:focus,\n.ui-controlgroup > .ui-controlgroup-item.ui-visual-focus {\n\tz-index: 9999;\n}\n.ui-controlgroup-vertical > .ui-controlgroup-item {\n\tdisplay: block;\n\tfloat: none;\n\twidth: 100%;\n\tmargin-top: 0;\n\tmargin-bottom: 0;\n\ttext-align: left;\n}\n.ui-controlgroup-vertical .ui-controlgroup-item {\n\tbox-sizing: border-box;\n}\n.ui-controlgroup .ui-controlgroup-label {\n\tpadding: .4em 1em;\n}\n.ui-controlgroup .ui-controlgroup-label span {\n\tfont-size: 80%;\n}\n.ui-controlgroup-horizontal .ui-controlgroup-label + .ui-controlgroup-item {\n\tborder-left: none;\n}\n.ui-controlgroup-vertical .ui-controlgroup-label + .ui-controlgroup-item {\n\tborder-top: none;\n}\n.ui-controlgroup-horizontal .ui-controlgroup-label.ui-widget-content {\n\tborder-right: none;\n}\n.ui-controlgroup-vertical .ui-controlgroup-label.ui-widget-content {\n\tborder-bottom: none;\n}\n\n/* Spinner specific style fixes */\n.ui-controlgroup-vertical .ui-spinner-input {\n\twidth: calc( 100% - 2.4em );\n}\n.ui-controlgroup-vertical .ui-spinner .ui-spinner-up {\n\tborder-top-style: solid;\n}\n\n",""])},7610:(e,t,n)=>{(e.exports=n(742)()).push([e.id,'/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n */\n\n/* Layout helpers\n----------------------------------*/\n.ui-helper-hidden {\n\tdisplay: none;\n}\n.ui-helper-hidden-accessible {\n\tborder: 0;\n\tclip: rect(0 0 0 0);\n\theight: 1px;\n\tmargin: -1px;\n\toverflow: hidden;\n\tpadding: 0;\n\tposition: absolute;\n\twidth: 1px;\n}\n.ui-helper-reset {\n\tmargin: 0;\n\tpadding: 0;\n\tborder: 0;\n\toutline: 0;\n\tline-height: 1.3;\n\ttext-decoration: none;\n\tfont-size: 100%;\n\tlist-style: none;\n}\n.ui-helper-clearfix:before,\n.ui-helper-clearfix:after {\n\tcontent: "";\n\tdisplay: table;\n\tborder-collapse: collapse;\n}\n.ui-helper-clearfix:after {\n\tclear: both;\n}\n.ui-helper-zfix {\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\tposition: absolute;\n\topacity: 0;\n}\n\n.ui-front {\n\tz-index: 100;\n}\n\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-disabled {\n\tcursor: default !important;\n\tpointer-events: none;\n}\n\n\n/* Icons\n----------------------------------*/\n.ui-icon {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tmargin-top: -.25em;\n\tposition: relative;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n}\n\n.ui-widget-icon-block {\n\tleft: 50%;\n\tmargin-left: -8px;\n\tdisplay: block;\n}\n\n/* Misc visuals\n----------------------------------*/\n\n/* Overlays */\n.ui-widget-overlay {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n',""])},6885:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Datepicker 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/datepicker/#theming\n */\n.ui-datepicker {\n\twidth: 17em;\n\tpadding: .2em .2em 0;\n\tdisplay: none;\n}\n.ui-datepicker .ui-datepicker-header {\n\tposition: relative;\n\tpadding: .2em 0;\n}\n.ui-datepicker .ui-datepicker-prev,\n.ui-datepicker .ui-datepicker-next {\n\tposition: absolute;\n\ttop: 2px;\n\twidth: 1.8em;\n\theight: 1.8em;\n}\n.ui-datepicker .ui-datepicker-prev-hover,\n.ui-datepicker .ui-datepicker-next-hover {\n\ttop: 1px;\n}\n.ui-datepicker .ui-datepicker-prev {\n\tleft: 2px;\n}\n.ui-datepicker .ui-datepicker-next {\n\tright: 2px;\n}\n.ui-datepicker .ui-datepicker-prev-hover {\n\tleft: 1px;\n}\n.ui-datepicker .ui-datepicker-next-hover {\n\tright: 1px;\n}\n.ui-datepicker .ui-datepicker-prev span,\n.ui-datepicker .ui-datepicker-next span {\n\tdisplay: block;\n\tposition: absolute;\n\tleft: 50%;\n\tmargin-left: -8px;\n\ttop: 50%;\n\tmargin-top: -8px;\n}\n.ui-datepicker .ui-datepicker-title {\n\tmargin: 0 2.3em;\n\tline-height: 1.8em;\n\ttext-align: center;\n}\n.ui-datepicker .ui-datepicker-title select {\n\tfont-size: 1em;\n\tmargin: 1px 0;\n}\n.ui-datepicker select.ui-datepicker-month,\n.ui-datepicker select.ui-datepicker-year {\n\twidth: 45%;\n}\n.ui-datepicker table {\n\twidth: 100%;\n\tfont-size: .9em;\n\tborder-collapse: collapse;\n\tmargin: 0 0 .4em;\n}\n.ui-datepicker th {\n\tpadding: .7em .3em;\n\ttext-align: center;\n\tfont-weight: bold;\n\tborder: 0;\n}\n.ui-datepicker td {\n\tborder: 0;\n\tpadding: 1px;\n}\n.ui-datepicker td span,\n.ui-datepicker td a {\n\tdisplay: block;\n\tpadding: .2em;\n\ttext-align: right;\n\ttext-decoration: none;\n}\n.ui-datepicker .ui-datepicker-buttonpane {\n\tbackground-image: none;\n\tmargin: .7em 0 0 0;\n\tpadding: 0 .2em;\n\tborder-left: 0;\n\tborder-right: 0;\n\tborder-bottom: 0;\n}\n.ui-datepicker .ui-datepicker-buttonpane button {\n\tfloat: right;\n\tmargin: .5em .2em .4em;\n\tcursor: pointer;\n\tpadding: .2em .6em .3em .6em;\n\twidth: auto;\n\toverflow: visible;\n}\n.ui-datepicker .ui-datepicker-buttonpane button.ui-datepicker-current {\n\tfloat: left;\n}\n\n/* with multiple calendars */\n.ui-datepicker.ui-datepicker-multi {\n\twidth: auto;\n}\n.ui-datepicker-multi .ui-datepicker-group {\n\tfloat: left;\n}\n.ui-datepicker-multi .ui-datepicker-group table {\n\twidth: 95%;\n\tmargin: 0 auto .4em;\n}\n.ui-datepicker-multi-2 .ui-datepicker-group {\n\twidth: 50%;\n}\n.ui-datepicker-multi-3 .ui-datepicker-group {\n\twidth: 33.3%;\n}\n.ui-datepicker-multi-4 .ui-datepicker-group {\n\twidth: 25%;\n}\n.ui-datepicker-multi .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-multi .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-left-width: 0;\n}\n.ui-datepicker-multi .ui-datepicker-buttonpane {\n\tclear: left;\n}\n.ui-datepicker-row-break {\n\tclear: both;\n\twidth: 100%;\n\tfont-size: 0;\n}\n\n/* RTL support */\n.ui-datepicker-rtl {\n\tdirection: rtl;\n}\n.ui-datepicker-rtl .ui-datepicker-prev {\n\tright: 2px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next {\n\tleft: 2px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-prev:hover {\n\tright: 1px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next:hover {\n\tleft: 1px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane {\n\tclear: right;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button {\n\tfloat: left;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button.ui-datepicker-current,\n.ui-datepicker-rtl .ui-datepicker-group {\n\tfloat: right;\n}\n.ui-datepicker-rtl .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-rtl .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-right-width: 0;\n\tborder-left-width: 1px;\n}\n\n/* Icons */\n.ui-datepicker .ui-icon {\n\tdisplay: block;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n\tleft: .5em;\n\ttop: .3em;\n}\n",""])},2275:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Dialog 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/dialog/#theming\n */\n.ui-dialog {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tpadding: .2em;\n\toutline: 0;\n}\n.ui-dialog .ui-dialog-titlebar {\n\tpadding: .4em 1em;\n\tposition: relative;\n}\n.ui-dialog .ui-dialog-title {\n\tfloat: left;\n\tmargin: .1em 0;\n\twhite-space: nowrap;\n\twidth: 90%;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.ui-dialog .ui-dialog-titlebar-close {\n\tposition: absolute;\n\tright: .3em;\n\ttop: 50%;\n\twidth: 20px;\n\tmargin: -10px 0 0 0;\n\tpadding: 1px;\n\theight: 20px;\n}\n.ui-dialog .ui-dialog-content {\n\tposition: relative;\n\tborder: 0;\n\tpadding: .5em 1em;\n\tbackground: none;\n\toverflow: auto;\n}\n.ui-dialog .ui-dialog-buttonpane {\n\ttext-align: left;\n\tborder-width: 1px 0 0 0;\n\tbackground-image: none;\n\tmargin-top: .5em;\n\tpadding: .3em 1em .5em .4em;\n}\n.ui-dialog .ui-dialog-buttonpane .ui-dialog-buttonset {\n\tfloat: right;\n}\n.ui-dialog .ui-dialog-buttonpane button {\n\tmargin: .5em .4em .5em 0;\n\tcursor: pointer;\n}\n.ui-dialog .ui-resizable-n {\n\theight: 2px;\n\ttop: 0;\n}\n.ui-dialog .ui-resizable-e {\n\twidth: 2px;\n\tright: 0;\n}\n.ui-dialog .ui-resizable-s {\n\theight: 2px;\n\tbottom: 0;\n}\n.ui-dialog .ui-resizable-w {\n\twidth: 2px;\n\tleft: 0;\n}\n.ui-dialog .ui-resizable-se,\n.ui-dialog .ui-resizable-sw,\n.ui-dialog .ui-resizable-ne,\n.ui-dialog .ui-resizable-nw {\n\twidth: 7px;\n\theight: 7px;\n}\n.ui-dialog .ui-resizable-se {\n\tright: 0;\n\tbottom: 0;\n}\n.ui-dialog .ui-resizable-sw {\n\tleft: 0;\n\tbottom: 0;\n}\n.ui-dialog .ui-resizable-ne {\n\tright: 0;\n\ttop: 0;\n}\n.ui-dialog .ui-resizable-nw {\n\tleft: 0;\n\ttop: 0;\n}\n.ui-draggable .ui-dialog-titlebar {\n\tcursor: move;\n}\n",""])},6038:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Draggable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-draggable-handle {\n\ttouch-action: none;\n}\n",""])},818:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Menu 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/menu/#theming\n */\n.ui-menu {\n\tlist-style: none;\n\tpadding: 0;\n\tmargin: 0;\n\tdisplay: block;\n\toutline: 0;\n}\n.ui-menu .ui-menu {\n\tposition: absolute;\n}\n.ui-menu .ui-menu-item {\n\tmargin: 0;\n\tcursor: pointer;\n}\n.ui-menu .ui-menu-item-wrapper {\n\tposition: relative;\n\tpadding: 3px 1em 3px .4em;\n}\n.ui-menu .ui-menu-divider {\n\tmargin: 5px 0;\n\theight: 0;\n\tfont-size: 0;\n\tline-height: 0;\n\tborder-width: 1px 0 0 0;\n}\n.ui-menu .ui-state-focus,\n.ui-menu .ui-state-active {\n\tmargin: -1px;\n}\n\n/* icon support */\n.ui-menu-icons {\n\tposition: relative;\n}\n.ui-menu-icons .ui-menu-item-wrapper {\n\tpadding-left: 2em;\n}\n\n/* left-aligned */\n.ui-menu .ui-icon {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\tleft: .2em;\n\tmargin: auto 0;\n}\n\n/* right-aligned */\n.ui-menu .ui-menu-icon {\n\tleft: auto;\n\tright: 0;\n}\n",""])},9871:(e,t,n)=>{(e.exports=n(742)()).push([e.id,'/*!\n * jQuery UI Progressbar 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/progressbar/#theming\n */\n.ui-progressbar {\n\theight: 2em;\n\ttext-align: left;\n\toverflow: hidden;\n}\n.ui-progressbar .ui-progressbar-value {\n\tmargin: -1px;\n\theight: 100%;\n}\n.ui-progressbar .ui-progressbar-overlay {\n\tbackground: url("data:image/gif;base64,R0lGODlhKAAoAIABAAAAAP///yH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAQABACwAAAAAKAAoAAACkYwNqXrdC52DS06a7MFZI+4FHBCKoDeWKXqymPqGqxvJrXZbMx7Ttc+w9XgU2FB3lOyQRWET2IFGiU9m1frDVpxZZc6bfHwv4c1YXP6k1Vdy292Fb6UkuvFtXpvWSzA+HycXJHUXiGYIiMg2R6W459gnWGfHNdjIqDWVqemH2ekpObkpOlppWUqZiqr6edqqWQAAIfkECQEAAQAsAAAAACgAKAAAApSMgZnGfaqcg1E2uuzDmmHUBR8Qil95hiPKqWn3aqtLsS18y7G1SzNeowWBENtQd+T1JktP05nzPTdJZlR6vUxNWWjV+vUWhWNkWFwxl9VpZRedYcflIOLafaa28XdsH/ynlcc1uPVDZxQIR0K25+cICCmoqCe5mGhZOfeYSUh5yJcJyrkZWWpaR8doJ2o4NYq62lAAACH5BAkBAAEALAAAAAAoACgAAAKVDI4Yy22ZnINRNqosw0Bv7i1gyHUkFj7oSaWlu3ovC8GxNso5fluz3qLVhBVeT/Lz7ZTHyxL5dDalQWPVOsQWtRnuwXaFTj9jVVh8pma9JjZ4zYSj5ZOyma7uuolffh+IR5aW97cHuBUXKGKXlKjn+DiHWMcYJah4N0lYCMlJOXipGRr5qdgoSTrqWSq6WFl2ypoaUAAAIfkECQEAAQAsAAAAACgAKAAAApaEb6HLgd/iO7FNWtcFWe+ufODGjRfoiJ2akShbueb0wtI50zm02pbvwfWEMWBQ1zKGlLIhskiEPm9R6vRXxV4ZzWT2yHOGpWMyorblKlNp8HmHEb/lCXjcW7bmtXP8Xt229OVWR1fod2eWqNfHuMjXCPkIGNileOiImVmCOEmoSfn3yXlJWmoHGhqp6ilYuWYpmTqKUgAAIfkECQEAAQAsAAAAACgAKAAAApiEH6kb58biQ3FNWtMFWW3eNVcojuFGfqnZqSebuS06w5V80/X02pKe8zFwP6EFWOT1lDFk8rGERh1TTNOocQ61Hm4Xm2VexUHpzjymViHrFbiELsefVrn6XKfnt2Q9G/+Xdie499XHd2g4h7ioOGhXGJboGAnXSBnoBwKYyfioubZJ2Hn0RuRZaflZOil56Zp6iioKSXpUAAAh+QQJAQABACwAAAAAKAAoAAACkoQRqRvnxuI7kU1a1UU5bd5tnSeOZXhmn5lWK3qNTWvRdQxP8qvaC+/yaYQzXO7BMvaUEmJRd3TsiMAgswmNYrSgZdYrTX6tSHGZO73ezuAw2uxuQ+BbeZfMxsexY35+/Qe4J1inV0g4x3WHuMhIl2jXOKT2Q+VU5fgoSUI52VfZyfkJGkha6jmY+aaYdirq+lQAACH5BAkBAAEALAAAAAAoACgAAAKWBIKpYe0L3YNKToqswUlvznigd4wiR4KhZrKt9Upqip61i9E3vMvxRdHlbEFiEXfk9YARYxOZZD6VQ2pUunBmtRXo1Lf8hMVVcNl8JafV38aM2/Fu5V16Bn63r6xt97j09+MXSFi4BniGFae3hzbH9+hYBzkpuUh5aZmHuanZOZgIuvbGiNeomCnaxxap2upaCZsq+1kAACH5BAkBAAEALAAAAAAoACgAAAKXjI8By5zf4kOxTVrXNVlv1X0d8IGZGKLnNpYtm8Lr9cqVeuOSvfOW79D9aDHizNhDJidFZhNydEahOaDH6nomtJjp1tutKoNWkvA6JqfRVLHU/QUfau9l2x7G54d1fl995xcIGAdXqMfBNadoYrhH+Mg2KBlpVpbluCiXmMnZ2Sh4GBqJ+ckIOqqJ6LmKSllZmsoq6wpQAAAh+QQJAQABACwAAAAAKAAoAAAClYx/oLvoxuJDkU1a1YUZbJ59nSd2ZXhWqbRa2/gF8Gu2DY3iqs7yrq+xBYEkYvFSM8aSSObE+ZgRl1BHFZNr7pRCavZ5BW2142hY3AN/zWtsmf12p9XxxFl2lpLn1rseztfXZjdIWIf2s5dItwjYKBgo9yg5pHgzJXTEeGlZuenpyPmpGQoKOWkYmSpaSnqKileI2FAAACH5BAkBAAEALAAAAAAoACgAAAKVjB+gu+jG4kORTVrVhRlsnn2dJ3ZleFaptFrb+CXmO9OozeL5VfP99HvAWhpiUdcwkpBH3825AwYdU8xTqlLGhtCosArKMpvfa1mMRae9VvWZfeB2XfPkeLmm18lUcBj+p5dnN8jXZ3YIGEhYuOUn45aoCDkp16hl5IjYJvjWKcnoGQpqyPlpOhr3aElaqrq56Bq7VAAAOw==");\n\theight: 100%;\n\topacity: 0.25;\n}\n.ui-progressbar-indeterminate .ui-progressbar-value {\n\tbackground-image: none;\n}\n',""])},9844:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Resizable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-resizable {\n\tposition: relative;\n}\n.ui-resizable-handle {\n\tposition: absolute;\n\tfont-size: 0.1px;\n\tdisplay: block;\n\ttouch-action: none;\n}\n.ui-resizable-disabled .ui-resizable-handle,\n.ui-resizable-autohide .ui-resizable-handle {\n\tdisplay: none;\n}\n.ui-resizable-n {\n\tcursor: n-resize;\n\theight: 7px;\n\twidth: 100%;\n\ttop: -5px;\n\tleft: 0;\n}\n.ui-resizable-s {\n\tcursor: s-resize;\n\theight: 7px;\n\twidth: 100%;\n\tbottom: -5px;\n\tleft: 0;\n}\n.ui-resizable-e {\n\tcursor: e-resize;\n\twidth: 7px;\n\tright: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-w {\n\tcursor: w-resize;\n\twidth: 7px;\n\tleft: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-se {\n\tcursor: se-resize;\n\twidth: 12px;\n\theight: 12px;\n\tright: 1px;\n\tbottom: 1px;\n}\n.ui-resizable-sw {\n\tcursor: sw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\tbottom: -5px;\n}\n.ui-resizable-nw {\n\tcursor: nw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\ttop: -5px;\n}\n.ui-resizable-ne {\n\tcursor: ne-resize;\n\twidth: 9px;\n\theight: 9px;\n\tright: -5px;\n\ttop: -5px;\n}\n",""])},8611:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Selectable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-selectable {\n\ttouch-action: none;\n}\n.ui-selectable-helper {\n\tposition: absolute;\n\tz-index: 100;\n\tborder: 1px dotted black;\n}\n",""])},7306:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Selectmenu 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/selectmenu/#theming\n */\n.ui-selectmenu-menu {\n\tpadding: 0;\n\tmargin: 0;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tdisplay: none;\n}\n.ui-selectmenu-menu .ui-menu {\n\toverflow: auto;\n\toverflow-x: hidden;\n\tpadding-bottom: 1px;\n}\n.ui-selectmenu-menu .ui-menu .ui-selectmenu-optgroup {\n\tfont-size: 1em;\n\tfont-weight: bold;\n\tline-height: 1.5;\n\tpadding: 2px 0.4em;\n\tmargin: 0.5em 0 0 0;\n\theight: auto;\n\tborder: 0;\n}\n.ui-selectmenu-open {\n\tdisplay: block;\n}\n.ui-selectmenu-text {\n\tdisplay: block;\n\tmargin-right: 20px;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.ui-selectmenu-button.ui-button {\n\ttext-align: left;\n\twhite-space: nowrap;\n\twidth: 14em;\n}\n.ui-selectmenu-icon.ui-icon {\n\tfloat: right;\n\tmargin-top: 0;\n}\n",""])},988:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Slider 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/slider/#theming\n */\n.ui-slider {\n\tposition: relative;\n\ttext-align: left;\n}\n.ui-slider .ui-slider-handle {\n\tposition: absolute;\n\tz-index: 2;\n\twidth: 1.2em;\n\theight: 1.2em;\n\tcursor: pointer;\n\ttouch-action: none;\n}\n.ui-slider .ui-slider-range {\n\tposition: absolute;\n\tz-index: 1;\n\tfont-size: .7em;\n\tdisplay: block;\n\tborder: 0;\n\tbackground-position: 0 0;\n}\n\n.ui-slider-horizontal {\n\theight: .8em;\n}\n.ui-slider-horizontal .ui-slider-handle {\n\ttop: -.3em;\n\tmargin-left: -.6em;\n}\n.ui-slider-horizontal .ui-slider-range {\n\ttop: 0;\n\theight: 100%;\n}\n.ui-slider-horizontal .ui-slider-range-min {\n\tleft: 0;\n}\n.ui-slider-horizontal .ui-slider-range-max {\n\tright: 0;\n}\n\n.ui-slider-vertical {\n\twidth: .8em;\n\theight: 100px;\n}\n.ui-slider-vertical .ui-slider-handle {\n\tleft: -.3em;\n\tmargin-left: 0;\n\tmargin-bottom: -.6em;\n}\n.ui-slider-vertical .ui-slider-range {\n\tleft: 0;\n\twidth: 100%;\n}\n.ui-slider-vertical .ui-slider-range-min {\n\tbottom: 0;\n}\n.ui-slider-vertical .ui-slider-range-max {\n\ttop: 0;\n}\n",""])},7783:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Sortable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-sortable-handle {\n\ttouch-action: none;\n}\n",""])},4028:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Spinner 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/spinner/#theming\n */\n.ui-spinner {\n\tposition: relative;\n\tdisplay: inline-block;\n\toverflow: hidden;\n\tpadding: 0;\n\tvertical-align: middle;\n}\n.ui-spinner-input {\n\tborder: none;\n\tbackground: none;\n\tcolor: inherit;\n\tpadding: .222em 0;\n\tmargin: .2em 0;\n\tvertical-align: middle;\n\tmargin-left: .4em;\n\tmargin-right: 2em;\n}\n.ui-spinner-button {\n\twidth: 1.6em;\n\theight: 50%;\n\tfont-size: .5em;\n\tpadding: 0;\n\tmargin: 0;\n\ttext-align: center;\n\tposition: absolute;\n\tcursor: default;\n\tdisplay: block;\n\toverflow: hidden;\n\tright: 0;\n}\n/* more specificity required here to override default borders */\n.ui-spinner a.ui-spinner-button {\n\tborder-top-style: none;\n\tborder-bottom-style: none;\n\tborder-right-style: none;\n}\n.ui-spinner-up {\n\ttop: 0;\n}\n.ui-spinner-down {\n\tbottom: 0;\n}\n",""])},3303:(e,t,n)=>{(e.exports=n(742)()).push([e.id,'/*!\n * jQuery UI Tabs 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/tabs/#theming\n */\n.ui-tabs {\n\tposition: relative;/* position: relative prevents IE scroll bug (element with position: relative inside container with overflow: auto appear as "fixed") */\n\tpadding: .2em;\n}\n.ui-tabs .ui-tabs-nav {\n\tmargin: 0;\n\tpadding: .2em .2em 0;\n}\n.ui-tabs .ui-tabs-nav li {\n\tlist-style: none;\n\tfloat: left;\n\tposition: relative;\n\ttop: 0;\n\tmargin: 1px .2em 0 0;\n\tborder-bottom-width: 0;\n\tpadding: 0;\n\twhite-space: nowrap;\n}\n.ui-tabs .ui-tabs-nav .ui-tabs-anchor {\n\tfloat: left;\n\tpadding: .5em 1em;\n\ttext-decoration: none;\n}\n.ui-tabs .ui-tabs-nav li.ui-tabs-active {\n\tmargin-bottom: -1px;\n\tpadding-bottom: 1px;\n}\n.ui-tabs .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor,\n.ui-tabs .ui-tabs-nav li.ui-state-disabled .ui-tabs-anchor,\n.ui-tabs .ui-tabs-nav li.ui-tabs-loading .ui-tabs-anchor {\n\tcursor: text;\n}\n.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor {\n\tcursor: pointer;\n}\n.ui-tabs .ui-tabs-panel {\n\tdisplay: block;\n\tborder-width: 0;\n\tpadding: 1em 1.4em;\n\tbackground: none;\n}\n',""])},6028:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n *\n * To view and modify this theme, visit https://jqueryui.com/themeroller/\n */\n\n\n/* Component containers\n----------------------------------*/\n.ui-widget {\n\tfont-family: Arial,Helvetica,sans-serif/*{ffDefault}*/;\n\tfont-size: 1em/*{fsDefault}*/;\n}\n.ui-widget .ui-widget {\n\tfont-size: 1em;\n}\n.ui-widget input,\n.ui-widget select,\n.ui-widget textarea,\n.ui-widget button {\n\tfont-family: Arial,Helvetica,sans-serif/*{ffDefault}*/;\n\tfont-size: 1em;\n}\n.ui-widget.ui-widget-content {\n\tborder: 1px solid #c5c5c5/*{borderColorDefault}*/;\n}\n.ui-widget-content {\n\tborder: 1px solid #dddddd/*{borderColorContent}*/;\n\tbackground: #ffffff/*{bgColorContent}*/ /*{bgImgUrlContent}*/ /*{bgContentXPos}*/ /*{bgContentYPos}*/ /*{bgContentRepeat}*/;\n\tcolor: #333333/*{fcContent}*/;\n}\n.ui-widget-content a {\n\tcolor: #333333/*{fcContent}*/;\n}\n.ui-widget-header {\n\tborder: 1px solid #dddddd/*{borderColorHeader}*/;\n\tbackground: #e9e9e9/*{bgColorHeader}*/ /*{bgImgUrlHeader}*/ /*{bgHeaderXPos}*/ /*{bgHeaderYPos}*/ /*{bgHeaderRepeat}*/;\n\tcolor: #333333/*{fcHeader}*/;\n\tfont-weight: bold;\n}\n.ui-widget-header a {\n\tcolor: #333333/*{fcHeader}*/;\n}\n\n/* Interaction states\n----------------------------------*/\n.ui-state-default,\n.ui-widget-content .ui-state-default,\n.ui-widget-header .ui-state-default,\n.ui-button,\n\n/* We use html here because we need a greater specificity to make sure disabled\nworks properly when clicked or hovered */\nhtml .ui-button.ui-state-disabled:hover,\nhtml .ui-button.ui-state-disabled:active {\n\tborder: 1px solid #c5c5c5/*{borderColorDefault}*/;\n\tbackground: #f6f6f6/*{bgColorDefault}*/ /*{bgImgUrlDefault}*/ /*{bgDefaultXPos}*/ /*{bgDefaultYPos}*/ /*{bgDefaultRepeat}*/;\n\tfont-weight: normal/*{fwDefault}*/;\n\tcolor: #454545/*{fcDefault}*/;\n}\n.ui-state-default a,\n.ui-state-default a:link,\n.ui-state-default a:visited,\na.ui-button,\na:link.ui-button,\na:visited.ui-button,\n.ui-button {\n\tcolor: #454545/*{fcDefault}*/;\n\ttext-decoration: none;\n}\n.ui-state-hover,\n.ui-widget-content .ui-state-hover,\n.ui-widget-header .ui-state-hover,\n.ui-state-focus,\n.ui-widget-content .ui-state-focus,\n.ui-widget-header .ui-state-focus,\n.ui-button:hover,\n.ui-button:focus {\n\tborder: 1px solid #cccccc/*{borderColorHover}*/;\n\tbackground: #ededed/*{bgColorHover}*/ /*{bgImgUrlHover}*/ /*{bgHoverXPos}*/ /*{bgHoverYPos}*/ /*{bgHoverRepeat}*/;\n\tfont-weight: normal/*{fwDefault}*/;\n\tcolor: #2b2b2b/*{fcHover}*/;\n}\n.ui-state-hover a,\n.ui-state-hover a:hover,\n.ui-state-hover a:link,\n.ui-state-hover a:visited,\n.ui-state-focus a,\n.ui-state-focus a:hover,\n.ui-state-focus a:link,\n.ui-state-focus a:visited,\na.ui-button:hover,\na.ui-button:focus {\n\tcolor: #2b2b2b/*{fcHover}*/;\n\ttext-decoration: none;\n}\n\n.ui-visual-focus {\n\tbox-shadow: 0 0 3px 1px rgb(94, 158, 214);\n}\n.ui-state-active,\n.ui-widget-content .ui-state-active,\n.ui-widget-header .ui-state-active,\na.ui-button:active,\n.ui-button:active,\n.ui-button.ui-state-active:hover {\n\tborder: 1px solid #003eff/*{borderColorActive}*/;\n\tbackground: #007fff/*{bgColorActive}*/ /*{bgImgUrlActive}*/ /*{bgActiveXPos}*/ /*{bgActiveYPos}*/ /*{bgActiveRepeat}*/;\n\tfont-weight: normal/*{fwDefault}*/;\n\tcolor: #ffffff/*{fcActive}*/;\n}\n.ui-icon-background,\n.ui-state-active .ui-icon-background {\n\tborder: #003eff/*{borderColorActive}*/;\n\tbackground-color: #ffffff/*{fcActive}*/;\n}\n.ui-state-active a,\n.ui-state-active a:link,\n.ui-state-active a:visited {\n\tcolor: #ffffff/*{fcActive}*/;\n\ttext-decoration: none;\n}\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-highlight,\n.ui-widget-content .ui-state-highlight,\n.ui-widget-header .ui-state-highlight {\n\tborder: 1px solid #dad55e/*{borderColorHighlight}*/;\n\tbackground: #fffa90/*{bgColorHighlight}*/ /*{bgImgUrlHighlight}*/ /*{bgHighlightXPos}*/ /*{bgHighlightYPos}*/ /*{bgHighlightRepeat}*/;\n\tcolor: #777620/*{fcHighlight}*/;\n}\n.ui-state-checked {\n\tborder: 1px solid #dad55e/*{borderColorHighlight}*/;\n\tbackground: #fffa90/*{bgColorHighlight}*/;\n}\n.ui-state-highlight a,\n.ui-widget-content .ui-state-highlight a,\n.ui-widget-header .ui-state-highlight a {\n\tcolor: #777620/*{fcHighlight}*/;\n}\n.ui-state-error,\n.ui-widget-content .ui-state-error,\n.ui-widget-header .ui-state-error {\n\tborder: 1px solid #f1a899/*{borderColorError}*/;\n\tbackground: #fddfdf/*{bgColorError}*/ /*{bgImgUrlError}*/ /*{bgErrorXPos}*/ /*{bgErrorYPos}*/ /*{bgErrorRepeat}*/;\n\tcolor: #5f3f3f/*{fcError}*/;\n}\n.ui-state-error a,\n.ui-widget-content .ui-state-error a,\n.ui-widget-header .ui-state-error a {\n\tcolor: #5f3f3f/*{fcError}*/;\n}\n.ui-state-error-text,\n.ui-widget-content .ui-state-error-text,\n.ui-widget-header .ui-state-error-text {\n\tcolor: #5f3f3f/*{fcError}*/;\n}\n.ui-priority-primary,\n.ui-widget-content .ui-priority-primary,\n.ui-widget-header .ui-priority-primary {\n\tfont-weight: bold;\n}\n.ui-priority-secondary,\n.ui-widget-content .ui-priority-secondary,\n.ui-widget-header .ui-priority-secondary {\n\topacity: .7;\n\tfont-weight: normal;\n}\n.ui-state-disabled,\n.ui-widget-content .ui-state-disabled,\n.ui-widget-header .ui-state-disabled {\n\topacity: .35;\n\tbackground-image: none;\n}\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.ui-icon {\n\twidth: 16px;\n\theight: 16px;\n}\n.ui-icon,\n.ui-widget-content .ui-icon {\n\tbackground-image: url("+n(5310)+");\n}\n.ui-widget-header .ui-icon {\n\tbackground-image: url("+n(5310)+");\n}\n.ui-state-hover .ui-icon,\n.ui-state-focus .ui-icon,\n.ui-button:hover .ui-icon,\n.ui-button:focus .ui-icon {\n\tbackground-image: url("+n(6428)+");\n}\n.ui-state-active .ui-icon,\n.ui-button:active .ui-icon {\n\tbackground-image: url("+n(7513)+");\n}\n.ui-state-highlight .ui-icon,\n.ui-button .ui-state-highlight.ui-icon {\n\tbackground-image: url("+n(7745)+");\n}\n.ui-state-error .ui-icon,\n.ui-state-error-text .ui-icon {\n\tbackground-image: url("+n(4612)+");\n}\n.ui-button .ui-icon {\n\tbackground-image: url("+n(6504)+");\n}\n\n/* positioning */\n/* Three classes needed to override `.ui-button:hover .ui-icon` */\n.ui-icon-blank.ui-icon-blank.ui-icon-blank {\n\tbackground-image: none;\n}\n.ui-icon-caret-1-n { background-position: 0 0; }\n.ui-icon-caret-1-ne { background-position: -16px 0; }\n.ui-icon-caret-1-e { background-position: -32px 0; }\n.ui-icon-caret-1-se { background-position: -48px 0; }\n.ui-icon-caret-1-s { background-position: -65px 0; }\n.ui-icon-caret-1-sw { background-position: -80px 0; }\n.ui-icon-caret-1-w { background-position: -96px 0; }\n.ui-icon-caret-1-nw { background-position: -112px 0; }\n.ui-icon-caret-2-n-s { background-position: -128px 0; }\n.ui-icon-caret-2-e-w { background-position: -144px 0; }\n.ui-icon-triangle-1-n { background-position: 0 -16px; }\n.ui-icon-triangle-1-ne { background-position: -16px -16px; }\n.ui-icon-triangle-1-e { background-position: -32px -16px; }\n.ui-icon-triangle-1-se { background-position: -48px -16px; }\n.ui-icon-triangle-1-s { background-position: -65px -16px; }\n.ui-icon-triangle-1-sw { background-position: -80px -16px; }\n.ui-icon-triangle-1-w { background-position: -96px -16px; }\n.ui-icon-triangle-1-nw { background-position: -112px -16px; }\n.ui-icon-triangle-2-n-s { background-position: -128px -16px; }\n.ui-icon-triangle-2-e-w { background-position: -144px -16px; }\n.ui-icon-arrow-1-n { background-position: 0 -32px; }\n.ui-icon-arrow-1-ne { background-position: -16px -32px; }\n.ui-icon-arrow-1-e { background-position: -32px -32px; }\n.ui-icon-arrow-1-se { background-position: -48px -32px; }\n.ui-icon-arrow-1-s { background-position: -65px -32px; }\n.ui-icon-arrow-1-sw { background-position: -80px -32px; }\n.ui-icon-arrow-1-w { background-position: -96px -32px; }\n.ui-icon-arrow-1-nw { background-position: -112px -32px; }\n.ui-icon-arrow-2-n-s { background-position: -128px -32px; }\n.ui-icon-arrow-2-ne-sw { background-position: -144px -32px; }\n.ui-icon-arrow-2-e-w { background-position: -160px -32px; }\n.ui-icon-arrow-2-se-nw { background-position: -176px -32px; }\n.ui-icon-arrowstop-1-n { background-position: -192px -32px; }\n.ui-icon-arrowstop-1-e { background-position: -208px -32px; }\n.ui-icon-arrowstop-1-s { background-position: -224px -32px; }\n.ui-icon-arrowstop-1-w { background-position: -240px -32px; }\n.ui-icon-arrowthick-1-n { background-position: 1px -48px; }\n.ui-icon-arrowthick-1-ne { background-position: -16px -48px; }\n.ui-icon-arrowthick-1-e { background-position: -32px -48px; }\n.ui-icon-arrowthick-1-se { background-position: -48px -48px; }\n.ui-icon-arrowthick-1-s { background-position: -64px -48px; }\n.ui-icon-arrowthick-1-sw { background-position: -80px -48px; }\n.ui-icon-arrowthick-1-w { background-position: -96px -48px; }\n.ui-icon-arrowthick-1-nw { background-position: -112px -48px; }\n.ui-icon-arrowthick-2-n-s { background-position: -128px -48px; }\n.ui-icon-arrowthick-2-ne-sw { background-position: -144px -48px; }\n.ui-icon-arrowthick-2-e-w { background-position: -160px -48px; }\n.ui-icon-arrowthick-2-se-nw { background-position: -176px -48px; }\n.ui-icon-arrowthickstop-1-n { background-position: -192px -48px; }\n.ui-icon-arrowthickstop-1-e { background-position: -208px -48px; }\n.ui-icon-arrowthickstop-1-s { background-position: -224px -48px; }\n.ui-icon-arrowthickstop-1-w { background-position: -240px -48px; }\n.ui-icon-arrowreturnthick-1-w { background-position: 0 -64px; }\n.ui-icon-arrowreturnthick-1-n { background-position: -16px -64px; }\n.ui-icon-arrowreturnthick-1-e { background-position: -32px -64px; }\n.ui-icon-arrowreturnthick-1-s { background-position: -48px -64px; }\n.ui-icon-arrowreturn-1-w { background-position: -64px -64px; }\n.ui-icon-arrowreturn-1-n { background-position: -80px -64px; }\n.ui-icon-arrowreturn-1-e { background-position: -96px -64px; }\n.ui-icon-arrowreturn-1-s { background-position: -112px -64px; }\n.ui-icon-arrowrefresh-1-w { background-position: -128px -64px; }\n.ui-icon-arrowrefresh-1-n { background-position: -144px -64px; }\n.ui-icon-arrowrefresh-1-e { background-position: -160px -64px; }\n.ui-icon-arrowrefresh-1-s { background-position: -176px -64px; }\n.ui-icon-arrow-4 { background-position: 0 -80px; }\n.ui-icon-arrow-4-diag { background-position: -16px -80px; }\n.ui-icon-extlink { background-position: -32px -80px; }\n.ui-icon-newwin { background-position: -48px -80px; }\n.ui-icon-refresh { background-position: -64px -80px; }\n.ui-icon-shuffle { background-position: -80px -80px; }\n.ui-icon-transfer-e-w { background-position: -96px -80px; }\n.ui-icon-transferthick-e-w { background-position: -112px -80px; }\n.ui-icon-folder-collapsed { background-position: 0 -96px; }\n.ui-icon-folder-open { background-position: -16px -96px; }\n.ui-icon-document { background-position: -32px -96px; }\n.ui-icon-document-b { background-position: -48px -96px; }\n.ui-icon-note { background-position: -64px -96px; }\n.ui-icon-mail-closed { background-position: -80px -96px; }\n.ui-icon-mail-open { background-position: -96px -96px; }\n.ui-icon-suitcase { background-position: -112px -96px; }\n.ui-icon-comment { background-position: -128px -96px; }\n.ui-icon-person { background-position: -144px -96px; }\n.ui-icon-print { background-position: -160px -96px; }\n.ui-icon-trash { background-position: -176px -96px; }\n.ui-icon-locked { background-position: -192px -96px; }\n.ui-icon-unlocked { background-position: -208px -96px; }\n.ui-icon-bookmark { background-position: -224px -96px; }\n.ui-icon-tag { background-position: -240px -96px; }\n.ui-icon-home { background-position: 0 -112px; }\n.ui-icon-flag { background-position: -16px -112px; }\n.ui-icon-calendar { background-position: -32px -112px; }\n.ui-icon-cart { background-position: -48px -112px; }\n.ui-icon-pencil { background-position: -64px -112px; }\n.ui-icon-clock { background-position: -80px -112px; }\n.ui-icon-disk { background-position: -96px -112px; }\n.ui-icon-calculator { background-position: -112px -112px; }\n.ui-icon-zoomin { background-position: -128px -112px; }\n.ui-icon-zoomout { background-position: -144px -112px; }\n.ui-icon-search { background-position: -160px -112px; }\n.ui-icon-wrench { background-position: -176px -112px; }\n.ui-icon-gear { background-position: -192px -112px; }\n.ui-icon-heart { background-position: -208px -112px; }\n.ui-icon-star { background-position: -224px -112px; }\n.ui-icon-link { background-position: -240px -112px; }\n.ui-icon-cancel { background-position: 0 -128px; }\n.ui-icon-plus { background-position: -16px -128px; }\n.ui-icon-plusthick { background-position: -32px -128px; }\n.ui-icon-minus { background-position: -48px -128px; }\n.ui-icon-minusthick { background-position: -64px -128px; }\n.ui-icon-close { background-position: -80px -128px; }\n.ui-icon-closethick { background-position: -96px -128px; }\n.ui-icon-key { background-position: -112px -128px; }\n.ui-icon-lightbulb { background-position: -128px -128px; }\n.ui-icon-scissors { background-position: -144px -128px; }\n.ui-icon-clipboard { background-position: -160px -128px; }\n.ui-icon-copy { background-position: -176px -128px; }\n.ui-icon-contact { background-position: -192px -128px; }\n.ui-icon-image { background-position: -208px -128px; }\n.ui-icon-video { background-position: -224px -128px; }\n.ui-icon-script { background-position: -240px -128px; }\n.ui-icon-alert { background-position: 0 -144px; }\n.ui-icon-info { background-position: -16px -144px; }\n.ui-icon-notice { background-position: -32px -144px; }\n.ui-icon-help { background-position: -48px -144px; }\n.ui-icon-check { background-position: -64px -144px; }\n.ui-icon-bullet { background-position: -80px -144px; }\n.ui-icon-radio-on { background-position: -96px -144px; }\n.ui-icon-radio-off { background-position: -112px -144px; }\n.ui-icon-pin-w { background-position: -128px -144px; }\n.ui-icon-pin-s { background-position: -144px -144px; }\n.ui-icon-play { background-position: 0 -160px; }\n.ui-icon-pause { background-position: -16px -160px; }\n.ui-icon-seek-next { background-position: -32px -160px; }\n.ui-icon-seek-prev { background-position: -48px -160px; }\n.ui-icon-seek-end { background-position: -64px -160px; }\n.ui-icon-seek-start { background-position: -80px -160px; }\n/* ui-icon-seek-first is deprecated, use ui-icon-seek-start instead */\n.ui-icon-seek-first { background-position: -80px -160px; }\n.ui-icon-stop { background-position: -96px -160px; }\n.ui-icon-eject { background-position: -112px -160px; }\n.ui-icon-volume-off { background-position: -128px -160px; }\n.ui-icon-volume-on { background-position: -144px -160px; }\n.ui-icon-power { background-position: 0 -176px; }\n.ui-icon-signal-diag { background-position: -16px -176px; }\n.ui-icon-signal { background-position: -32px -176px; }\n.ui-icon-battery-0 { background-position: -48px -176px; }\n.ui-icon-battery-1 { background-position: -64px -176px; }\n.ui-icon-battery-2 { background-position: -80px -176px; }\n.ui-icon-battery-3 { background-position: -96px -176px; }\n.ui-icon-circle-plus { background-position: 0 -192px; }\n.ui-icon-circle-minus { background-position: -16px -192px; }\n.ui-icon-circle-close { background-position: -32px -192px; }\n.ui-icon-circle-triangle-e { background-position: -48px -192px; }\n.ui-icon-circle-triangle-s { background-position: -64px -192px; }\n.ui-icon-circle-triangle-w { background-position: -80px -192px; }\n.ui-icon-circle-triangle-n { background-position: -96px -192px; }\n.ui-icon-circle-arrow-e { background-position: -112px -192px; }\n.ui-icon-circle-arrow-s { background-position: -128px -192px; }\n.ui-icon-circle-arrow-w { background-position: -144px -192px; }\n.ui-icon-circle-arrow-n { background-position: -160px -192px; }\n.ui-icon-circle-zoomin { background-position: -176px -192px; }\n.ui-icon-circle-zoomout { background-position: -192px -192px; }\n.ui-icon-circle-check { background-position: -208px -192px; }\n.ui-icon-circlesmall-plus { background-position: 0 -208px; }\n.ui-icon-circlesmall-minus { background-position: -16px -208px; }\n.ui-icon-circlesmall-close { background-position: -32px -208px; }\n.ui-icon-squaresmall-plus { background-position: -48px -208px; }\n.ui-icon-squaresmall-minus { background-position: -64px -208px; }\n.ui-icon-squaresmall-close { background-position: -80px -208px; }\n.ui-icon-grip-dotted-vertical { background-position: 0 -224px; }\n.ui-icon-grip-dotted-horizontal { background-position: -16px -224px; }\n.ui-icon-grip-solid-vertical { background-position: -32px -224px; }\n.ui-icon-grip-solid-horizontal { background-position: -48px -224px; }\n.ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }\n.ui-icon-grip-diagonal-se { background-position: -80px -224px; }\n\n\n/* Misc visuals\n----------------------------------*/\n\n/* Corner radius */\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-left,\n.ui-corner-tl {\n\tborder-top-left-radius: 3px/*{cornerRadius}*/;\n}\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-right,\n.ui-corner-tr {\n\tborder-top-right-radius: 3px/*{cornerRadius}*/;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-left,\n.ui-corner-bl {\n\tborder-bottom-left-radius: 3px/*{cornerRadius}*/;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-right,\n.ui-corner-br {\n\tborder-bottom-right-radius: 3px/*{cornerRadius}*/;\n}\n\n/* Overlays */\n.ui-widget-overlay {\n\tbackground: #aaaaaa/*{bgColorOverlay}*/ /*{bgImgUrlOverlay}*/ /*{bgOverlayXPos}*/ /*{bgOverlayYPos}*/ /*{bgOverlayRepeat}*/;\n\topacity: .3/*{opacityOverlay}*/;\n}\n.ui-widget-shadow {\n\tbox-shadow: 0/*{offsetLeftShadow}*/ 0/*{offsetTopShadow}*/ 5px/*{thicknessShadow}*/ #666666/*{bgColorShadow}*/;\n}\n",""])},1110:(e,t,n)=>{(e.exports=n(742)()).push([e.id,"/*!\n * jQuery UI Tooltip 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/tooltip/#theming\n */\n.ui-tooltip {\n\tpadding: 8px;\n\tposition: absolute;\n\tz-index: 9999;\n\tmax-width: 300px;\n}\nbody .ui-tooltip {\n\tborder-width: 2px;\n}\n",""])},5310:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"d1b818587c3bc65058fe43800e4a191c.png"},6428:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"35d57320d9df28ec0d0d8bd1b5c75983.png"},7745:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"f423048bf942a7a33b33b1b982ecdb51.png"},6504:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"f5d5fce2f36b5776eab8b314efc2dfd8.png"},4612:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"5cbbd560bcf30acb95dd3b0b0d61645a.png"},7513:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=n.p+"92bef7e45fed3caba8dc9348edef4df2.png"},1023:e=>{var t={},n=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}},i=n((function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())})),r=n((function(){return document.head||document.getElementsByTagName("head")[0]})),s=null,o=0,a=[];function l(e,n){for(var i=0;i<e.length;i++){var r=e[i],s=t[r.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](r.parts[o]);for(;o<r.parts.length;o++)s.parts.push(p(r.parts[o],n))}else{var a=[];for(o=0;o<r.parts.length;o++)a.push(p(r.parts[o],n));t[r.id]={id:r.id,refs:1,parts:a}}}}function c(e){for(var t=[],n={},i=0;i<e.length;i++){var r=e[i],s=r[0],o={css:r[1],media:r[2],sourceMap:r[3]};n[s]?n[s].parts.push(o):t.push(n[s]={id:s,parts:[o]})}return t}function u(e,t){var n=r(),i=a[a.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),a.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function h(e){e.parentNode.removeChild(e);var t=a.indexOf(e);t>=0&&a.splice(t,1)}function d(e){var t=document.createElement("style");return t.type="text/css",u(e,t),t}function p(e,t){var n,i,r;if(t.singleton){var a=o++;n=s||(s=d(t)),i=g.bind(null,n,a,!1),r=g.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return t.rel="stylesheet",u(e,t),t}(t),i=v.bind(null,n),r=function(){h(n),n.href&&URL.revokeObjectURL(n.href)}):(n=d(t),i=_.bind(null,n),r=function(){h(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,n){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");void 0===(n=n||{}).singleton&&(n.singleton=i()),void 0===n.insertAt&&(n.insertAt="bottom");var r=c(e);return l(r,n),function(e){for(var i=[],s=0;s<r.length;s++){var o=r[s];(a=t[o.id]).refs--,i.push(a)}for(e&&l(c(e),n),s=0;s<i.length;s++){var a;if(0===(a=i[s]).refs){for(var u=0;u<a.parts.length;u++)a.parts[u]();delete t[a.id]}}}};var f,m=(f=[],function(e,t){return f[e]=t,f.filter(Boolean).join("\n")});function g(e,t,n,i){var r=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=m(t,r);else{var s=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function _(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function v(e,t){var n=t.css,i=t.sourceMap;i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var r=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(r),s&&URL.revokeObjectURL(s)}},9446:(e,t,n)=>{var i=n(3774);"string"==typeof i&&(i=[[e.id,i,""]]),n(1023)(i,{}),i.locals&&(e.exports=i.locals)},2055:e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__2055__},431:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VERSION:()=>r,after:()=>Lt,all:()=>en,allKeys:()=>ge,any:()=>tn,assign:()=>Le,before:()=>Ot,bind:()=>wt,bindAll:()=>Mt,chain:()=>vt,chunk:()=>Bn,clone:()=>Be,collect:()=>Xt,compact:()=>Tn,compose:()=>Dt,constant:()=>Q,contains:()=>nn,countBy:()=>_n,create:()=>Fe,debounce:()=>It,default:()=>$n,defaults:()=>Oe,defer:()=>Et,delay:()=>Tt,detect:()=>jt,difference:()=>Pn,drop:()=>Mn,each:()=>qt,escape:()=>ot,every:()=>en,extend:()=>De,extendOwn:()=>Le,filter:()=>Qt,find:()=>jt,findIndex:()=>Ut,findKey:()=>Ft,findLastIndex:()=>zt,findWhere:()=>Wt,first:()=>An,flatten:()=>En,foldl:()=>Kt,foldr:()=>Zt,forEach:()=>qt,functions:()=>ke,get:()=>$e,groupBy:()=>mn,has:()=>Ge,head:()=>An,identity:()=>je,include:()=>nn,includes:()=>nn,indexBy:()=>gn,indexOf:()=>$t,initial:()=>Sn,inject:()=>Kt,intersection:()=>Dn,invert:()=>Ie,invoke:()=>rn,isArguments:()=>Y,isArray:()=>W,isArrayBuffer:()=>F,isBoolean:()=>E,isDataView:()=>j,isDate:()=>D,isElement:()=>P,isEmpty:()=>le,isEqual:()=>me,isError:()=>O,isFinite:()=>K,isFunction:()=>z,isMap:()=>Ae,isMatch:()=>ce,isNaN:()=>Z,isNull:()=>C,isNumber:()=>R,isObject:()=>M,isRegExp:()=>L,isSet:()=>Ce,isString:()=>k,isSymbol:()=>N,isTypedArray:()=>re,isUndefined:()=>T,isWeakMap:()=>Me,isWeakSet:()=>Te,iteratee:()=>Ke,keys:()=>ae,last:()=>Cn,lastIndexOf:()=>Gt,map:()=>Xt,mapObject:()=>Qe,matcher:()=>We,matches:()=>We,max:()=>an,memoize:()=>Ct,methods:()=>ke,min:()=>ln,mixin:()=>zn,negate:()=>Rt,noop:()=>Je,now:()=>it,object:()=>Nn,omit:()=>wn,once:()=>Nt,pairs:()=>Pe,partial:()=>xt,partition:()=>vn,pick:()=>xn,pluck:()=>sn,property:()=>qe,propertyOf:()=>et,random:()=>nt,range:()=>Fn,reduce:()=>Kt,reduceRight:()=>Zt,reject:()=>Jt,rest:()=>Mn,restArguments:()=>A,result:()=>mt,sample:()=>hn,select:()=>Qt,shuffle:()=>dn,size:()=>yn,some:()=>tn,sortBy:()=>pn,sortedIndex:()=>Vt,tail:()=>Mn,take:()=>An,tap:()=>Ue,template:()=>ft,templateSettings:()=>lt,throttle:()=>Pt,times:()=>tt,toArray:()=>un,toPath:()=>ze,transpose:()=>Ln,unescape:()=>at,union:()=>Rn,uniq:()=>kn,unique:()=>kn,uniqueId:()=>_t,unzip:()=>Ln,values:()=>Ee,where:()=>on,without:()=>In,wrap:()=>kt,zip:()=>On});var i={};n.r(i),n.d(i,{VERSION:()=>r,after:()=>Lt,all:()=>en,allKeys:()=>ge,any:()=>tn,assign:()=>Le,before:()=>Ot,bind:()=>wt,bindAll:()=>Mt,chain:()=>vt,chunk:()=>Bn,clone:()=>Be,collect:()=>Xt,compact:()=>Tn,compose:()=>Dt,constant:()=>Q,contains:()=>nn,countBy:()=>_n,create:()=>Fe,debounce:()=>It,default:()=>Vn,defaults:()=>Oe,defer:()=>Et,delay:()=>Tt,detect:()=>jt,difference:()=>Pn,drop:()=>Mn,each:()=>qt,escape:()=>ot,every:()=>en,extend:()=>De,extendOwn:()=>Le,filter:()=>Qt,find:()=>jt,findIndex:()=>Ut,findKey:()=>Ft,findLastIndex:()=>zt,findWhere:()=>Wt,first:()=>An,flatten:()=>En,foldl:()=>Kt,foldr:()=>Zt,forEach:()=>qt,functions:()=>ke,get:()=>$e,groupBy:()=>mn,has:()=>Ge,head:()=>An,identity:()=>je,include:()=>nn,includes:()=>nn,indexBy:()=>gn,indexOf:()=>$t,initial:()=>Sn,inject:()=>Kt,intersection:()=>Dn,invert:()=>Ie,invoke:()=>rn,isArguments:()=>Y,isArray:()=>W,isArrayBuffer:()=>F,isBoolean:()=>E,isDataView:()=>j,isDate:()=>D,isElement:()=>P,isEmpty:()=>le,isEqual:()=>me,isError:()=>O,isFinite:()=>K,isFunction:()=>z,isMap:()=>Ae,isMatch:()=>ce,isNaN:()=>Z,isNull:()=>C,isNumber:()=>R,isObject:()=>M,isRegExp:()=>L,isSet:()=>Ce,isString:()=>k,isSymbol:()=>N,isTypedArray:()=>re,isUndefined:()=>T,isWeakMap:()=>Me,isWeakSet:()=>Te,iteratee:()=>Ke,keys:()=>ae,last:()=>Cn,lastIndexOf:()=>Gt,map:()=>Xt,mapObject:()=>Qe,matcher:()=>We,matches:()=>We,max:()=>an,memoize:()=>Ct,methods:()=>ke,min:()=>ln,mixin:()=>zn,negate:()=>Rt,noop:()=>Je,now:()=>it,object:()=>Nn,omit:()=>wn,once:()=>Nt,pairs:()=>Pe,partial:()=>xt,partition:()=>vn,pick:()=>xn,pluck:()=>sn,property:()=>qe,propertyOf:()=>et,random:()=>nt,range:()=>Fn,reduce:()=>Kt,reduceRight:()=>Zt,reject:()=>Jt,rest:()=>Mn,restArguments:()=>A,result:()=>mt,sample:()=>hn,select:()=>Qt,shuffle:()=>dn,size:()=>yn,some:()=>tn,sortBy:()=>pn,sortedIndex:()=>Vt,tail:()=>Mn,take:()=>An,tap:()=>Ue,template:()=>ft,templateSettings:()=>lt,throttle:()=>Pt,times:()=>tt,toArray:()=>un,toPath:()=>ze,transpose:()=>Ln,unescape:()=>at,union:()=>Rn,uniq:()=>kn,unique:()=>kn,uniqueId:()=>_t,unzip:()=>Ln,values:()=>Ee,where:()=>on,without:()=>In,wrap:()=>kt,zip:()=>On});var r="1.13.7",s="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},o=Array.prototype,a=Object.prototype,l="undefined"!=typeof Symbol?Symbol.prototype:null,c=o.push,u=o.slice,h=a.toString,d=a.hasOwnProperty,p="undefined"!=typeof ArrayBuffer,f="undefined"!=typeof DataView,m=Array.isArray,g=Object.keys,_=Object.create,v=p&&ArrayBuffer.isView,y=isNaN,b=isFinite,x=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],S=Math.pow(2,53)-1;function A(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+t];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,arguments[0],i);case 2:return e.call(this,arguments[0],arguments[1],i)}var s=Array(t+1);for(r=0;r<t;r++)s[r]=arguments[r];return s[t]=i,e.apply(this,s)}}function M(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function C(e){return null===e}function T(e){return void 0===e}function E(e){return!0===e||!1===e||"[object Boolean]"===h.call(e)}function P(e){return!(!e||1!==e.nodeType)}function I(e){var t="[object "+e+"]";return function(e){return h.call(e)===t}}const k=I("String"),R=I("Number"),D=I("Date"),L=I("RegExp"),O=I("Error"),N=I("Symbol"),F=I("ArrayBuffer");var B=I("Function"),U=s.document&&s.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof U&&(B=function(e){return"function"==typeof e||!1});const z=B,V=I("Object");var H=f&&(!/\[native code\]/.test(String(DataView))||V(new DataView(new ArrayBuffer(8)))),$="undefined"!=typeof Map&&V(new Map),G=I("DataView");const j=H?function(e){return null!=e&&z(e.getInt8)&&F(e.buffer)}:G,W=m||I("Array");function q(e,t){return null!=e&&d.call(e,t)}var X=I("Arguments");!function(){X(arguments)||(X=function(e){return q(e,"callee")})}();const Y=X;function K(e){return!N(e)&&b(e)&&!isNaN(parseFloat(e))}function Z(e){return R(e)&&y(e)}function Q(e){return function(){return e}}function J(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=S}}function ee(e){return function(t){return null==t?void 0:t[e]}}const te=ee("byteLength"),ne=J(te);var ie=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;const re=p?function(e){return v?v(e)&&!j(e):ne(e)&&ie.test(h.call(e))}:Q(!1),se=ee("length");function oe(e,t){t=function(e){for(var t={},n=e.length,i=0;i<n;++i)t[e[i]]=!0;return{contains:function(e){return!0===t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=w.length,i=e.constructor,r=z(i)&&i.prototype||a,s="constructor";for(q(e,s)&&!t.contains(s)&&t.push(s);n--;)(s=w[n])in e&&e[s]!==r[s]&&!t.contains(s)&&t.push(s)}function ae(e){if(!M(e))return[];if(g)return g(e);var t=[];for(var n in e)q(e,n)&&t.push(n);return x&&oe(e,t),t}function le(e){if(null==e)return!0;var t=se(e);return"number"==typeof t&&(W(e)||k(e)||Y(e))?0===t:0===se(ae(e))}function ce(e,t){var n=ae(t),i=n.length;if(null==e)return!i;for(var r=Object(e),s=0;s<i;s++){var o=n[s];if(t[o]!==r[o]||!(o in r))return!1}return!0}function ue(e){return e instanceof ue?e:this instanceof ue?void(this._wrapped=e):new ue(e)}function he(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,te(e))}ue.VERSION=r,ue.prototype.value=function(){return this._wrapped},ue.prototype.valueOf=ue.prototype.toJSON=ue.prototype.value,ue.prototype.toString=function(){return String(this._wrapped)};var de="[object DataView]";function pe(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var r=typeof e;return("function"===r||"object"===r||"object"==typeof t)&&fe(e,t,n,i)}function fe(e,t,n,i){e instanceof ue&&(e=e._wrapped),t instanceof ue&&(t=t._wrapped);var r=h.call(e);if(r!==h.call(t))return!1;if(H&&"[object Object]"==r&&j(e)){if(!j(t))return!1;r=de}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return l.valueOf.call(e)===l.valueOf.call(t);case"[object ArrayBuffer]":case de:return fe(he(e),he(t),n,i)}var s="[object Array]"===r;if(!s&&re(e)){if(te(e)!==te(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(z(o)&&o instanceof o&&z(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}i=i||[];for(var c=(n=n||[]).length;c--;)if(n[c]===e)return i[c]===t;if(n.push(e),i.push(t),s){if((c=e.length)!==t.length)return!1;for(;c--;)if(!pe(e[c],t[c],n,i))return!1}else{var u,d=ae(e);if(c=d.length,ae(t).length!==c)return!1;for(;c--;)if(!q(t,u=d[c])||!pe(e[u],t[u],n,i))return!1}return n.pop(),i.pop(),!0}function me(e,t){return pe(e,t)}function ge(e){if(!M(e))return[];var t=[];for(var n in e)t.push(n);return x&&oe(e,t),t}function _e(e){var t=se(e);return function(n){if(null==n)return!1;var i=ge(n);if(se(i))return!1;for(var r=0;r<t;r++)if(!z(n[e[r]]))return!1;return e!==we||!z(n[ve])}}var ve="forEach",ye=["clear","delete"],be=["get","has","set"],xe=ye.concat(ve,be),we=ye.concat(be),Se=["add"].concat(ye,ve,"has");const Ae=$?_e(xe):I("Map"),Me=$?_e(we):I("WeakMap"),Ce=$?_e(Se):I("Set"),Te=I("WeakSet");function Ee(e){for(var t=ae(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=e[t[r]];return i}function Pe(e){for(var t=ae(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=[t[r],e[t[r]]];return i}function Ie(e){for(var t={},n=ae(e),i=0,r=n.length;i<r;i++)t[e[n[i]]]=n[i];return t}function ke(e){var t=[];for(var n in e)z(e[n])&&t.push(n);return t.sort()}function Re(e,t){return function(n){var i=arguments.length;if(t&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var s=arguments[r],o=e(s),a=o.length,l=0;l<a;l++){var c=o[l];t&&void 0!==n[c]||(n[c]=s[c])}return n}}const De=Re(ge),Le=Re(ae),Oe=Re(ge,!0);function Ne(e){if(!M(e))return{};if(_)return _(e);var t=function(){};t.prototype=e;var n=new t;return t.prototype=null,n}function Fe(e,t){var n=Ne(e);return t&&Le(n,t),n}function Be(e){return M(e)?W(e)?e.slice():De({},e):e}function Ue(e,t){return t(e),e}function ze(e){return W(e)?e:[e]}function Ve(e){return ue.toPath(e)}function He(e,t){for(var n=t.length,i=0;i<n;i++){if(null==e)return;e=e[t[i]]}return n?e:void 0}function $e(e,t,n){var i=He(e,Ve(t));return T(i)?n:i}function Ge(e,t){for(var n=(t=Ve(t)).length,i=0;i<n;i++){var r=t[i];if(!q(e,r))return!1;e=e[r]}return!!n}function je(e){return e}function We(e){return e=Le({},e),function(t){return ce(t,e)}}function qe(e){return e=Ve(e),function(t){return He(t,e)}}function Xe(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,s){return e.call(t,n,i,r,s)}}return function(){return e.apply(t,arguments)}}function Ye(e,t,n){return null==e?je:z(e)?Xe(e,t,n):M(e)&&!W(e)?We(e):qe(e)}function Ke(e,t){return Ye(e,t,1/0)}function Ze(e,t,n){return ue.iteratee!==Ke?ue.iteratee(e,t):Ye(e,t,n)}function Qe(e,t,n){t=Ze(t,n);for(var i=ae(e),r=i.length,s={},o=0;o<r;o++){var a=i[o];s[a]=t(e[a],a,e)}return s}function Je(){}function et(e){return null==e?Je:function(t){return $e(e,t)}}function tt(e,t,n){var i=Array(Math.max(0,e));t=Xe(t,n,1);for(var r=0;r<e;r++)i[r]=t(r);return i}function nt(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ue.toPath=ze,ue.iteratee=Ke;const it=Date.now||function(){return(new Date).getTime()};function rt(e){var t=function(t){return e[t]},n="(?:"+ae(e).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(r,t):e}}const st={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ot=rt(st),at=rt(Ie(st)),lt=ue.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var ct=/(.)^/,ut={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},ht=/\\|'|\r|\n|\u2028|\u2029/g;function dt(e){return"\\"+ut[e]}var pt=/^\s*(\w|\$)+\s*$/;function ft(e,t,n){!t&&n&&(t=n),t=Oe({},t,ue.templateSettings);var i=RegExp([(t.escape||ct).source,(t.interpolate||ct).source,(t.evaluate||ct).source].join("|")+"|$","g"),r=0,s="__p+='";e.replace(i,(function(t,n,i,o,a){return s+=e.slice(r,a).replace(ht,dt),r=a+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t})),s+="';\n";var o,a=t.variable;if(a){if(!pt.test(a))throw new Error("variable is not a bare identifier: "+a)}else s="with(obj||{}){\n"+s+"}\n",a="obj";s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{o=new Function(a,"_",s)}catch(e){throw e.source=s,e}var l=function(e){return o.call(this,e,ue)};return l.source="function("+a+"){\n"+s+"}",l}function mt(e,t,n){var i=(t=Ve(t)).length;if(!i)return z(n)?n.call(e):n;for(var r=0;r<i;r++){var s=null==e?void 0:e[t[r]];void 0===s&&(s=n,r=i),e=z(s)?s.call(e):s}return e}var gt=0;function _t(e){var t=++gt+"";return e?e+t:t}function vt(e){var t=ue(e);return t._chain=!0,t}function yt(e,t,n,i,r){if(!(i instanceof t))return e.apply(n,r);var s=Ne(e.prototype),o=e.apply(s,r);return M(o)?o:s}var bt=A((function(e,t){var n=bt.placeholder,i=function(){for(var r=0,s=t.length,o=Array(s),a=0;a<s;a++)o[a]=t[a]===n?arguments[r++]:t[a];for(;r<arguments.length;)o.push(arguments[r++]);return yt(e,i,this,this,o)};return i}));bt.placeholder=ue;const xt=bt,wt=A((function(e,t,n){if(!z(e))throw new TypeError("Bind must be called on a function");var i=A((function(r){return yt(e,i,t,this,n.concat(r))}));return i})),St=J(se);function At(e,t,n,i){if(i=i||[],t||0===t){if(t<=0)return i.concat(e)}else t=1/0;for(var r=i.length,s=0,o=se(e);s<o;s++){var a=e[s];if(St(a)&&(W(a)||Y(a)))if(t>1)At(a,t-1,n,i),r=i.length;else for(var l=0,c=a.length;l<c;)i[r++]=a[l++];else n||(i[r++]=a)}return i}const Mt=A((function(e,t){var n=(t=At(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=t[n];e[i]=wt(e[i],e)}return e}));function Ct(e,t){var n=function(i){var r=n.cache,s=""+(t?t.apply(this,arguments):i);return q(r,s)||(r[s]=e.apply(this,arguments)),r[s]};return n.cache={},n}const Tt=A((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),Et=xt(Tt,ue,1);function Pt(e,t,n){var i,r,s,o,a=0;n||(n={});var l=function(){a=!1===n.leading?0:it(),i=null,o=e.apply(r,s),i||(r=s=null)},c=function(){var c=it();a||!1!==n.leading||(a=c);var u=t-(c-a);return r=this,s=arguments,u<=0||u>t?(i&&(clearTimeout(i),i=null),a=c,o=e.apply(r,s),i||(r=s=null)):i||!1===n.trailing||(i=setTimeout(l,u)),o};return c.cancel=function(){clearTimeout(i),a=0,i=r=s=null},c}function It(e,t,n){var i,r,s,o,a,l=function(){var c=it()-r;t>c?i=setTimeout(l,t-c):(i=null,n||(o=e.apply(a,s)),i||(s=a=null))},c=A((function(c){return a=this,s=c,r=it(),i||(i=setTimeout(l,t),n&&(o=e.apply(a,s))),o}));return c.cancel=function(){clearTimeout(i),i=s=a=null},c}function kt(e,t){return xt(t,e)}function Rt(e){return function(){return!e.apply(this,arguments)}}function Dt(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}}function Lt(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function Ot(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}const Nt=xt(Ot,2);function Ft(e,t,n){t=Ze(t,n);for(var i,r=ae(e),s=0,o=r.length;s<o;s++)if(t(e[i=r[s]],i,e))return i}function Bt(e){return function(t,n,i){n=Ze(n,i);for(var r=se(t),s=e>0?0:r-1;s>=0&&s<r;s+=e)if(n(t[s],s,t))return s;return-1}}const Ut=Bt(1),zt=Bt(-1);function Vt(e,t,n,i){for(var r=(n=Ze(n,i,1))(t),s=0,o=se(e);s<o;){var a=Math.floor((s+o)/2);n(e[a])<r?s=a+1:o=a}return s}function Ht(e,t,n){return function(i,r,s){var o=0,a=se(i);if("number"==typeof s)e>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return i[s=n(i,r)]===r?s:-1;if(r!=r)return(s=t(u.call(i,o,a),Z))>=0?s+o:-1;for(s=e>0?o:a-1;s>=0&&s<a;s+=e)if(i[s]===r)return s;return-1}}const $t=Ht(1,Ut,Vt),Gt=Ht(-1,zt);function jt(e,t,n){var i=(St(e)?Ut:Ft)(e,t,n);if(void 0!==i&&-1!==i)return e[i]}function Wt(e,t){return jt(e,We(t))}function qt(e,t,n){var i,r;if(t=Xe(t,n),St(e))for(i=0,r=e.length;i<r;i++)t(e[i],i,e);else{var s=ae(e);for(i=0,r=s.length;i<r;i++)t(e[s[i]],s[i],e)}return e}function Xt(e,t,n){t=Ze(t,n);for(var i=!St(e)&&ae(e),r=(i||e).length,s=Array(r),o=0;o<r;o++){var a=i?i[o]:o;s[o]=t(e[a],a,e)}return s}function Yt(e){return function(t,n,i,r){var s=arguments.length>=3;return function(t,n,i,r){var s=!St(t)&&ae(t),o=(s||t).length,a=e>0?0:o-1;for(r||(i=t[s?s[a]:a],a+=e);a>=0&&a<o;a+=e){var l=s?s[a]:a;i=n(i,t[l],l,t)}return i}(t,Xe(n,r,4),i,s)}}const Kt=Yt(1),Zt=Yt(-1);function Qt(e,t,n){var i=[];return t=Ze(t,n),qt(e,(function(e,n,r){t(e,n,r)&&i.push(e)})),i}function Jt(e,t,n){return Qt(e,Rt(Ze(t)),n)}function en(e,t,n){t=Ze(t,n);for(var i=!St(e)&&ae(e),r=(i||e).length,s=0;s<r;s++){var o=i?i[s]:s;if(!t(e[o],o,e))return!1}return!0}function tn(e,t,n){t=Ze(t,n);for(var i=!St(e)&&ae(e),r=(i||e).length,s=0;s<r;s++){var o=i?i[s]:s;if(t(e[o],o,e))return!0}return!1}function nn(e,t,n,i){return St(e)||(e=Ee(e)),("number"!=typeof n||i)&&(n=0),$t(e,t,n)>=0}const rn=A((function(e,t,n){var i,r;return z(t)?r=t:(t=Ve(t),i=t.slice(0,-1),t=t[t.length-1]),Xt(e,(function(e){var s=r;if(!s){if(i&&i.length&&(e=He(e,i)),null==e)return;s=e[t]}return null==s?s:s.apply(e,n)}))}));function sn(e,t){return Xt(e,qe(t))}function on(e,t){return Qt(e,We(t))}function an(e,t,n){var i,r,s=-1/0,o=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=St(e)?e:Ee(e)).length;a<l;a++)null!=(i=e[a])&&i>s&&(s=i);else t=Ze(t,n),qt(e,(function(e,n,i){((r=t(e,n,i))>o||r===-1/0&&s===-1/0)&&(s=e,o=r)}));return s}function ln(e,t,n){var i,r,s=1/0,o=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=St(e)?e:Ee(e)).length;a<l;a++)null!=(i=e[a])&&i<s&&(s=i);else t=Ze(t,n),qt(e,(function(e,n,i){((r=t(e,n,i))<o||r===1/0&&s===1/0)&&(s=e,o=r)}));return s}var cn=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function un(e){return e?W(e)?u.call(e):k(e)?e.match(cn):St(e)?Xt(e,je):Ee(e):[]}function hn(e,t,n){if(null==t||n)return St(e)||(e=Ee(e)),e[nt(e.length-1)];var i=un(e),r=se(i);t=Math.max(Math.min(t,r),0);for(var s=r-1,o=0;o<t;o++){var a=nt(o,s),l=i[o];i[o]=i[a],i[a]=l}return i.slice(0,t)}function dn(e){return hn(e,1/0)}function pn(e,t,n){var i=0;return t=Ze(t,n),sn(Xt(e,(function(e,n,r){return{value:e,index:i++,criteria:t(e,n,r)}})).sort((function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index})),"value")}function fn(e,t){return function(n,i,r){var s=t?[[],[]]:{};return i=Ze(i,r),qt(n,(function(t,r){var o=i(t,r,n);e(s,t,o)})),s}}const mn=fn((function(e,t,n){q(e,n)?e[n].push(t):e[n]=[t]})),gn=fn((function(e,t,n){e[n]=t})),_n=fn((function(e,t,n){q(e,n)?e[n]++:e[n]=1})),vn=fn((function(e,t,n){e[n?0:1].push(t)}),!0);function yn(e){return null==e?0:St(e)?e.length:ae(e).length}function bn(e,t,n){return t in n}const xn=A((function(e,t){var n={},i=t[0];if(null==e)return n;z(i)?(t.length>1&&(i=Xe(i,t[1])),t=ge(e)):(i=bn,t=At(t,!1,!1),e=Object(e));for(var r=0,s=t.length;r<s;r++){var o=t[r],a=e[o];i(a,o,e)&&(n[o]=a)}return n})),wn=A((function(e,t){var n,i=t[0];return z(i)?(i=Rt(i),t.length>1&&(n=t[1])):(t=Xt(At(t,!1,!1),String),i=function(e,n){return!nn(t,n)}),xn(e,i,n)}));function Sn(e,t,n){return u.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function An(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:Sn(e,e.length-t)}function Mn(e,t,n){return u.call(e,null==t||n?1:t)}function Cn(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:Mn(e,Math.max(0,e.length-t))}function Tn(e){return Qt(e,Boolean)}function En(e,t){return At(e,t,!1)}const Pn=A((function(e,t){return t=At(t,!0,!0),Qt(e,(function(e){return!nn(t,e)}))})),In=A((function(e,t){return Pn(e,t)}));function kn(e,t,n,i){E(t)||(i=n,n=t,t=!1),null!=n&&(n=Ze(n,i));for(var r=[],s=[],o=0,a=se(e);o<a;o++){var l=e[o],c=n?n(l,o,e):l;t&&!n?(o&&s===c||r.push(l),s=c):n?nn(s,c)||(s.push(c),r.push(l)):nn(r,l)||r.push(l)}return r}const Rn=A((function(e){return kn(At(e,!0,!0))}));function Dn(e){for(var t=[],n=arguments.length,i=0,r=se(e);i<r;i++){var s=e[i];if(!nn(t,s)){var o;for(o=1;o<n&&nn(arguments[o],s);o++);o===n&&t.push(s)}}return t}function Ln(e){for(var t=e&&an(e,se).length||0,n=Array(t),i=0;i<t;i++)n[i]=sn(e,i);return n}const On=A(Ln);function Nn(e,t){for(var n={},i=0,r=se(e);i<r;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n}function Fn(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var i=Math.max(Math.ceil((t-e)/n),0),r=Array(i),s=0;s<i;s++,e+=n)r[s]=e;return r}function Bn(e,t){if(null==t||t<1)return[];for(var n=[],i=0,r=e.length;i<r;)n.push(u.call(e,i,i+=t));return n}function Un(e,t){return e._chain?ue(t).chain():t}function zn(e){return qt(ke(e),(function(t){var n=ue[t]=e[t];ue.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),Un(this,n.apply(ue,e))}})),ue}qt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=o[e];ue.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),Un(this,n)}})),qt(["concat","join","slice"],(function(e){var t=o[e];ue.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Un(this,e)}}));const Vn=ue;var Hn=zn(i);Hn._=Hn;const $n=Hn},8330:e=>{"use strict";e.exports={version:"3.1.5"}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})();var __webpack_exports__=__webpack_require__(9012);return __webpack_exports__})()));
//# sourceMappingURL=index.js.map