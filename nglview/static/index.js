/*! For license information please see index.js.LICENSE.txt */
define(["@jupyter-widgets/base"],(__WEBPACK_EXTERNAL_MODULE__2055__=>(()=>{var __webpack_modules__={2555:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseView=void 0;const widgets=__webpack_require__(2055);var NGL=__webpack_require__(485);class BaseView extends widgets.DOMWidgetView{render(){this.isEmbeded()||(this.handleMessage(),this.displayed.then((()=>{this.model.set("_ready",!0),this.touch()})))}executeCode(code){eval(code)}handleMessage(){this.model.on("msg:custom",function(t){this.on_msg(t)}.bind(this))}on_msg(t){"callMethod"==t.type&&(console.log("from BaseView",t),this[t.methodName].apply(this,t.args,t.kwargs))}isEmbeded(){return null==this.model.comm}}exports.BaseView=BaseView},5211:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ColormakerRegistryView=e.ColormakerRegistryModel=void 0;const i=n(431),r=n(485),s=n(2555),o=n(2055);class a extends o.DOMWidgetModel{defaults(){return i.extend(o.DOMWidgetModel.prototype.defaults(),{_model_name:"ColormakerRegistryModel",_model_module:"nglview-js-widgets",_model_module_version:n(8330).version,_view_name:"ColormakerRegistryView",_view_module:"nglview-js-widgets",_view_module_version:n(8330).version})}}e.ColormakerRegistryModel=a;class l extends s.BaseView{render(){super.render(),this.isEmbeded()&&(console.log("Embed mode for ColormakerRegistryView"),this.handleEmbed())}handleEmbed(){this.model.get("_msg_ar").forEach((t=>{this.on_msg(t)}))}addSelectionScheme(t,e){var n=r.ColormakerRegistry.addSelectionScheme(e,t);this._updateId(n,t)}addSelectionSchemeOriginal(t,e){var n=r.ColormakerRegistry.addSelectionScheme(e,t),i=r.ColormakerRegistry.userSchemes[n];r.ColormakerRegistry.removeScheme(n),r.ColormakerRegistry.add(t,i)}addScheme(t,e){var n=Function("return "+e)(),i=r.ColormakerRegistry.addScheme((function(t){this.atomColor=n}));this._updateId(i,t)}_updateId(t,e){var n=r.ColormakerRegistry.userSchemes[t];r.ColormakerRegistry.add(e,n),r.ColormakerRegistry.removeScheme(t)}}e.ColormakerRegistryView=l},6219:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FullscreenView=exports.ABC=exports.FullscreenModel=void 0;const widgets=__webpack_require__(2055),NGL=__webpack_require__(485),base_1=__webpack_require__(2555);class FullscreenModel extends widgets.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:"FullscreenModel",_model_module:"nglview-js-widgets",_model_module_version:__webpack_require__(8330).version,_view_name:"FullscreenView",_view_module:"nglview-js-widgets",_view_module_version:__webpack_require__(8330).version})}}exports.FullscreenModel=FullscreenModel;class ABC{}exports.ABC=ABC;class FullscreenView extends base_1.BaseView{render(){this.stage=new NGL.Stage(null,null);var t=this;this.model.on("msg:custom",(function(e){t.on_msg(e)})),this.handleSignals()}fullscreen(t){var e=this;this.model.widget_manager.get_model(t).then((t=>{var n=Object.keys(t.views)[0];t.views[n].then((t=>{e.stage.toggleFullscreen(t.el)}))}))}handleSignals(){var t=this;this.stage.signals.fullscreenChanged.add((function(e){t.model.set("_is_fullscreen",e),t.touch()}))}executeCode(code){eval(code)}on_msg(t){"executeCode"in t&&this.executeCode(t.executeCode)}}exports.FullscreenView=FullscreenView},5587:(t,e,n)=>{var i,r=n(485),s=n(4197).UI,o=n(1147);HTMLElement.prototype.getBoundingClientRect=(i=HTMLElement.prototype.getBoundingClientRect,function(){try{return i.apply(this,arguments)}catch(t){return{top:0,left:0,width:this.width,height:this.height}}}),r.Widget=function(){},r.Widget.prototype={constructor:r.Widget},r.createParameterInput=function(t,e){if(t){var n,i=void 0===e?t.value:e;return"number"===t.type?n=new s.Number(0).setRange(t.min,t.max).setPrecision(t.precision).setValue(parseFloat(i)):"integer"===t.type?n=new s.Integer(parseInt(i)).setRange(t.min,t.max):"range"===t.type?n=new s.Range(t.min,t.max,i,t.step).setValue(parseFloat(i)):"boolean"===t.type?n=new s.Checkbox(i):"text"===t.type?n=new s.Input(i):"select"===t.type?n=(new s.Select).setWidth("").setOptions(t.options).setValue(i):"color"===t.type?n=new s.ColorPopupMenu(t.label).setValue(i):"vector3"===t.type?n=new s.Vector3(i).setPrecision(t.precision):"hidden"===t.type||console.warn("NGL.createParameterInput: unknown parameter type '"+t.type+"'"),n}},r.Preferences=function(t,e){this.signals={keyChanged:new o.Signal},this.id=t||"ngl-gui";var n=Object.assign({},e);for(var i in this.storage={impostor:!0,quality:"auto",sampleLevel:0,theme:"dark",backgroundColor:"black",overview:!1,rotateSpeed:2,zoomSpeed:1.2,panSpeed:.8,clipNear:0,clipFar:100,clipDist:10,fogNear:50,fogFar:100,cameraFov:40,cameraType:"perspective",lightColor:14540253,lightIntensity:1,ambientColor:14540253,ambientIntensity:.2,hoverTimeout:0},this.storage)void 0!==n[i]&&(this.storage[i]=n[i])},r.Preferences.prototype={constructor:r.Preferences,getKey:function(t){return this.storage[t]},setKey:function(t,e){this.storage[t]=e,this.signals.keyChanged.dispatch(t,e)}},r.ViewportWidget=function(t){var e=t.viewer,n=(e.renderer,new s.Panel);n.dom=e.container,n.setPosition("absolute");var i=r.flatten([r.ParserRegistry.getStructureExtensions(),r.ParserRegistry.getVolumeExtensions(),r.ParserRegistry.getSurfaceExtensions(),r.DecompressorRegistry.names]);return n.dom.addEventListener("dragover",(function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}),!1),n.dom.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault(),new r.Queue((function(e,n){var s=e.name.split(".").pop().toLowerCase();r.ScriptExtensions.includes(s)?t.loadScript(e).then(n):i.includes(s)?t.loadFile(e,{defaultRepresentation:!0}).then(n):(console.error("unknown filetype: "+s),n())}),e.dataTransfer.files)}),!1),n},r.ToolbarWidget=function(t){var e=new s.Panel,n=new s.Text,i=(new s.Panel).setDisplay("inline").setFloat("left").add(n),o=new s.Text,a=(new s.Panel).setDisplay("inline").setFloat("right").add(o);return t.signals.clicked.add((function(t){n.setValue(t?t.getLabel():"nothing")})),t.viewer.stats.signals.updated.add((function(){r.Debug?o.setValue(t.viewer.stats.lastDuration.toFixed(2)+" ms | "+t.viewer.stats.lastFps+" fps"):o.setValue("")})),e.add(i,a),e},r.MenubarWidget=function(t,e){var n=new s.Panel;return n.add(new r.MenubarFileWidget(t)),n.add(new r.MenubarViewWidget(t,e)),r.examplesListUrl&&r.examplesScriptUrl&&n.add(new r.MenubarExamplesWidget(t)),n.add(new r.MenubarHelpWidget(t,e)),n.add((new s.Panel).setClass("menu").setFloat("right").add(new s.Text("NGL Viewer "+r.Version).setClass("title"))),n},r.MenubarFileWidget=function(t){var e=r.flatten([r.ParserRegistry.getStructureExtensions(),r.ParserRegistry.getVolumeExtensions(),r.ParserRegistry.getSurfaceExtensions(),r.DecompressorRegistry.names,r.ScriptExtensions]),n=document.createElement("input");n.type="file",n.multiple=!0,n.style.display="none",n.accept="."+e.join(",."),n.addEventListener("change",(function(n){new r.Queue((function(n,i){var s=n.name.split(".").pop().toLowerCase();r.ScriptExtensions.includes(s)?t.loadScript(n).then(i):e.includes(s)?t.loadFile(n,{defaultRepresentation:!0}).then(i):(console.error("unknown filetype: "+s),i())}),n.target.files)}),!1);var i=new r.ExportImageWidget(t).setDisplay("none").attach(t.viewer.container.parentElement),o=s.MenubarHelper.createOption,a=s.MenubarHelper.createInput,l=s.MenubarHelper.createCheckbox,c=s.MenubarHelper.createDivider,u=[o("Open...",(function(){n.click()})),a("PDB",(function(e){13===e.keyCode&&(t.loadFile("rcsb://"+e.target.value.trim(),{defaultRepresentation:!0}),e.target.value="")})),l("firstModelOnly",!1,(function(e){t.defaultFileParams.firstModelOnly=e.target.checked})),l("cAlphaOnly",!1,(function(e){t.defaultFileParams.cAlphaOnly=e.target.checked})),c(),o("Screenshot",(function(){t.makeImage({factor:1,antialias:!0,trim:!1,transparent:!1}).then((function(t){r.download(t,"screenshot.png")}))}),"camera"),o("Export image...",(function(){i.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")}))];r.ListingDatasource&&u.splice(1,0,o("Import...",(function(){var n;(n=new r.DirectoryListingWidget(r.ListingDatasource,t,"Import file",e,(function(i){var s=i.path.split(".").pop().toLowerCase();r.ScriptExtensions.includes(s)?(t.loadScript(r.ListingDatasource.getUrl(i.path)),n.dispose()):e.includes(s)?(t.loadFile(r.ListingDatasource.getUrl(i.path),{defaultRepresentation:!0}),n.dispose()):console.error("unknown filetype: "+s)}))).setOpacity("0.9").setLeft("50px").setTop("80px").attach()})));var h=s.MenubarHelper.createOptionsPanel(u);return h.dom.appendChild(n),s.MenubarHelper.createMenuContainer("File",h)},r.MenubarViewWidget=function(t,e){t.signals.fullscreenChanged.add((function(t){var e=r[4].children[0];t?e.switchClass("compress","expand"):e.switchClass("expand","compress")}));var n=s.MenubarHelper.createOption,i=s.MenubarHelper.createDivider,r=[n("Perspective",(function(){t.setParameters({cameraType:"perspective"})})),n("Orthographic",(function(){t.setParameters({cameraType:"orthographic"})})),n("Stereo",(function(){t.setParameters({cameraType:"stereo"})})),i(),n("Full screen",(function(){t.toggleFullscreen(t.viewer.container.parentElement)}),"expand"),n("Center",(function(){t.autoView(1e3)}),"bullseye"),i(),n("Toggle spin",(function(){t.toggleSpin()})),n("Toggle rock",(function(){t.toggleRock()}))],o=s.MenubarHelper.createOptionsPanel(r);return s.MenubarHelper.createMenuContainer("View",o)},r.MenubarExamplesWidget=function(t){var e=s.MenubarHelper.createOption,n=s.MenubarHelper.createOptionsPanel([]);n.setWidth("300px");var i=new XMLHttpRequest;return i.open("GET",r.examplesListUrl),i.responseType="json",i.onload=function(i){var s=this.response;"string"==typeof s&&(s=JSON.parse(s)),s.sort().forEach((function(i){var s=e(i,(function(){t.loadScript(r.examplesScriptUrl+i+".js")}));n.add(s)}))},i.send(),s.MenubarHelper.createMenuContainer("Examples",n)},r.MenubarHelpWidget=function(t,e){function n(){o.setOpacity("0.9").setDisplay("block").setWidgetPosition(50,80)}var i=new r.PreferencesWidget(t,e).setDisplay("none").attach(t.viewer.container.parentElement),o=new r.OverviewWidget(t,e).setDisplay("none").attach(t.viewer.container.parentElement);e.getKey("overview")&&n();var a=s.MenubarHelper.createOption,l=(s.MenubarHelper.createDivider,[a("Overview",n),a("Preferences",(function(){i.setOpacity("0.9").setDisplay("block").setWidgetPosition(50,80)}),"sliders")]),c=s.MenubarHelper.createOptionsPanel(l);return s.MenubarHelper.createMenuContainer("Help",c)},r.OverviewWidget=function(t,e){var n=new s.OverlayPanel,i=0,o=0,a=0,l=0;function c(t){0===a&&(a=t.clientX,l=t.clientY),i-=a-t.clientX,o-=l-t.clientY,a=t.clientX,l=t.clientY,n.dom.style.top=o+"px",n.dom.style.left=i+"px"}n.setWidgetPosition=function(t,e){i=t,o=e,a=0,l=0,n.dom.style.top=o+"px",n.dom.style.left=i+"px"};var u=(new s.Panel).setBorderBottom("1px solid #555").setHeight("25px").setCursor("move").onMouseDown((function(t){1===t.which&&document.addEventListener("mousemove",c),document.addEventListener("mouseup",(function(t){document.removeEventListener("mousemove",c)}))})),h=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setMaxWidth("600px").setOverflow("auto");function d(t,e){var n=new s.Panel,i=new s.Icon(t).setWidth("20px").setFloat("left"),r=new s.Text(e).setDisplay("inline").setMarginLeft("5px");n.setMarginLeft("20px").add(i,r),h.add(n)}u.add(new s.Text("NGL Viewer").setFontStyle("italic"),new s.Html("&nbsp;&mdash;&nbsp;Overview")),u.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){n.setDisplay("none")}))),n.add(u),n.add(h),h.add((new s.Panel).add(new s.Html("To load a new structure use the <i>File</i> menu in the top left via drag'n'drop."))).add(new s.Break),h.add((new s.Panel).add(new s.Text("A number of clickable icons provide common actions. Most icons can be clicked on, just try it or hover the mouse pointer over it to see a tooltip."))).add(new s.Break),d("eye","Controls the visibility of a component."),d("trash-o","Deletes a component. Note that a second click is required to confirm the action."),d("bullseye","Centers a component."),d("bars","Opens a menu with further options."),d("square","Opens a menu with coloring options."),d("filter","Indicates atom-selection input fields."),h.add(new s.Text("Mouse controls")).add(new s.Html("<ul><li>Left button hold and move to rotate camera around center.</li><li>Left button click to pick atom.</li><li>Middle button hold and move to zoom camera in and out.</li><li>Middle button click to center camera on atom.</li><li>Right button hold and move to translate camera in the screen plane.</li></ul>")),h.add((new s.Panel).add(new s.Html("For more information please visit the <a href='"+r.documentationUrl+"' target='_blank'>documentation pages</a>.")));var p=e.getKey("overview"),f=new s.Checkbox(p).onClick((function(){e.setKey("overview",f.getValue())}));return h.add((new s.HorizontalRule).setBorderTop("1px solid #555").setMarginTop("15px")).add((new s.Panel).add(f,new s.Text("Show on startup. Always available from Menu > Help > Overview.").setMarginLeft("5px"))),n},r.PreferencesWidget=function(t,e){var n=new s.OverlayPanel,i=0,o=0,a=0,l=0;function c(t){0===a&&(a=t.clientX,l=t.clientY),i-=a-t.clientX,o-=l-t.clientY,a=t.clientX,l=t.clientY,n.dom.style.top=o+"px",n.dom.style.left=i+"px"}n.setWidgetPosition=function(t,e){i=t,o=e,a=0,l=0,n.dom.style.top=o+"px",n.dom.style.left=i+"px"};var u=(new s.Panel).setBorderBottom("1px solid #555").setHeight("25px").setCursor("move").onMouseDown((function(t){1===t.which&&document.addEventListener("mousemove",c),document.addEventListener("mouseup",(function(t){document.removeEventListener("mousemove",c)}))})),h=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");return u.add(new s.Text("Preferences")),u.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){n.setDisplay("none")}))),n.add(u),n.add(h),Object.keys(r.UIStageParameters).forEach((function(n){var i=r.UIStageParameters[n];void 0===i.label&&(i.label=n);var o=r.createParameterInput(i,t.parameters[n]);if(o){e.signals.keyChanged.add((function(t,e){t===n&&o.setValue(e)}));var a=navigator.userAgent;"range"!==i.type||/Trident/.test(a)||/MSIE/.test(a)?o.onChange(l):o.onInput(l),h.add(new s.Text(n).setWidth("120px")).add(o).add(new s.Break)}function l(){var t={};t[n]=o.getValue(),e.setKey(n,t[n])}})),n},r.ExportImageWidget=function(t){var e=new s.OverlayPanel,n=(new s.Panel).setBorderBottom("1px solid #555").setHeight("25px"),i=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");n.add(new s.Text("Image export")),n.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){e.setDisplay("none")}))),e.add(n),e.add(i);var o=(new s.Select).setOptions({1:"1x",2:"2x",3:"3x",4:"4x",5:"5x",6:"6x",7:"7x",8:"8x",9:"9x",10:"10x"}).setValue("4"),a=(new s.Checkbox).setValue(!0),l=(new s.Checkbox).setValue(!1),c=(new s.Checkbox).setValue(!1),u=(new s.Progress).setDisplay("none"),h=new s.Button("export").onClick((function(){function e(t,e,n){1===t&&u.setMax(e),t>=e?u.setIndeterminate():u.setValue(t),n&&(u.setDisplay("none"),h.setDisplay("inline-block"))}h.setDisplay("none"),u.setDisplay("inline-block"),setTimeout((function(){t.makeImage({factor:parseInt(o.getValue()),antialias:a.getValue(),trim:l.getValue(),transparent:c.getValue(),onProgress:e}).then((function(t){r.download(t,"screenshot.png")}))}),50)}));function d(t,e){i.add(new s.Text(t).setWidth("80px")).add(e||new s.Panel).add(new s.Break)}return d("scale",o),d("antialias",a),d("trim",l),d("transparent",c),i.add(new s.Break,h,u),e},r.SidebarWidget=function(t,e=void 0){var n=t.signals,i=new s.Panel;i.view=e;var o=(new s.Panel).setClass("Content"),a=[],l=[];function c(e){var n;switch(e.type){case"structure":n=new r.StructureComponentWidget(e,t);break;case"surface":n=new r.SurfaceComponentWidget(e,t);break;case"volume":n=new r.VolumeComponentWidget(e,t);break;case"shape":n=new r.ShapeComponentWidget(e,t);break;default:return void console.warn("NGL.SidebarWidget: component type unknown",e)}o.add(n),a.push(e),l.push(n)}t.compList.forEach((function(t){c(t)})),n.componentAdded.add(c),n.componentRemoved.add((function(t){var e=a.indexOf(t);-1!==e&&(l[e].dispose(),a.splice(e,1),l.splice(e,1))}));var u=new s.Icon("plus-square").setTitle("expand all").setCursor("pointer").onClick((function(){l.forEach((function(t){t.expand()}))})),h=new s.Icon("minus-square").setTitle("collapse all").setCursor("pointer").setMarginLeft("10px").onClick((function(){l.forEach((function(t){t.collapse()}))})),d=new s.Icon("bullseye").setTitle("center all").setCursor("pointer").setMarginLeft("10px").onClick((function(){t.autoView(1e3)})),p=(new s.DisposeIcon).setMarginLeft("10px").setDisposeFunction((function(){t.removeAllComponents()})),f=new s.Icon("superpowers").setTitle("sync representation").setCursor("pointer").setMarginLeft("10px").onClick((function(){e&&e.syncReprWithMe()})),m=new s.PopupMenu("cogs","Settings","window").setIconTitle("settings").setMarginLeft("10px");m.entryLabelWidth="120px";var g=(new s.Panel).setDisplay("inline").add(new s.Icon("spinner").addClass("spin").setMarginLeft("45px"));t.tasks.signals.countChanged.add((function(t,e){if(e>0)_.add(g);else try{_.remove(g)}catch(t){}})),["clipNear","clipFar","clipDist","fogNear","fogFar","lightColor","lightIntensity","ambientColor","ambientIntensity"].forEach((function(e){var n=r.UIStageParameters[e];void 0===n.label&&(n.label=e);var i=r.createParameterInput(n,t.parameters[e]);if(i){t.signals.parametersChanged.add((function(t){i.setValue(t[e])}));var s=navigator.userAgent;"range"!==n.type||/Trident/.test(s)||/MSIE/.test(s)?i.onChange(o):i.onInput(o),m.addEntry(e,i)}function o(){var n={};n[e]=i.getValue(),t.setParameters(n)}}));var _=(new s.Panel).setClass("Panel Sticky").add(u,h,d,p,f,m);return i.add(_,o),i},r.StructureComponentWidget=function(t,e){var n=t.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel,a=new s.Panel;function l(n){o.add(new r.RepresentationElementWidget(n,e,t))}t.reprList.forEach((function(t){l(t)})),n.representationAdded.add(l),n.trajectoryAdded.add((function(t){a.add(new r.TrajectoryElementWidget(t,e))})),n.defaultAssemblyChanged.add((function(){f.setValue(t.parameters.defaultAssembly)})),i.add(new s.SelectionPanel(t.selection).setMarginLeft("20px").setInputWidth("214px"));var c,u,h,d=new s.Button("export").onClick((function(){new r.PdbWriter(t.structure).download("structure"),D.setMenuDisplay("none")})),p=(new s.Select).setColor("#444").setOptions((c={"":"[ add ]"},r.RepresentationRegistry.names.forEach((function(t){c[t]=t})),c)).onChange((function(){t.addRepresentation(p.getValue()),p.setValue(""),D.setMenuDisplay("none")})),f=(new s.Select).setColor("#444").setOptions((u=t.structure.biomolDict,h={"":t.structure.unitcell?"AU":"FULL"},Object.keys(u).forEach((function(t){h[t]=t})),h)).setValue(t.parameters.defaultAssembly).onChange((function(){t.setDefaultAssembly(f.getValue()),D.setMenuDisplay("none")})),m=[];r.ParserRegistry.getTrajectoryExtensions().forEach((function(t){m.push("."+t,"."+t+".gz")}));var g=document.createElement("input");g.type="file",g.multiple=!0,g.style.display="none",g.accept=m.join(","),g.addEventListener("change",(function(e){new r.Queue((function(e,n){r.autoLoad(e).then((function(e){t.addTrajectory(e),n()}))}),e.target.files),e.target.value=""}),!1);var _=new s.Button("open").onClick((function(){g.click(),D.setMenuDisplay("none")})),v=new s.Button("import").onClick((function(){D.setMenuDisplay("none");var n,i=["xtc","trr","netcdf","dcd","ncdf","nc","gro","pdb","lammpstrj","xyz","mdcrd","gz","binpos","h5","dtr","arc","tng","trj","trz"];(n=new r.DirectoryListingWidget(r.ListingDatasource,e,"Import trajectory",i,(function(e){var s=e.path.split(".").pop().toLowerCase();-1!==i.indexOf(s)?(t.addTrajectory(e.path+"?struc="+t.structure.path),n.dispose()):r.log("unknown trajectory type: "+s)}))).setOpacity("0.9").setLeft("50px").setTop("80px").attach()}));function y(){var n={"":"[ structure ]"};e.eachComponent((function(e,i){e!==t&&(n[i]=e.name)}),r.StructureComponent),b.setOptions(n)}e.signals.componentAdded.add(y),e.signals.componentRemoved.add(y);var b=(new s.Select).setColor("#444").onChange((function(){t.superpose(e.compList[b.getValue()],!0),t.autoView(1e3),b.setValue(""),D.setMenuDisplay("none")}));y();var x=new s.Button("align").onClick((function(){var n=t.structure.getPrincipalAxes().getRotationQuaternion();n.multiply(t.quaternion.clone().inverse()),e.animationControls.rotate(n),e.animationControls.move(t.getCenter())})),w=new s.Button("remove").onClick((function(){t.removeAllMeasurements()})),S=new s.Button("show").onClick((function(){t.annotationList.forEach((function(t){t.setVisibility(!0)}))})),A=new s.Button("hide").onClick((function(){t.annotationList.forEach((function(t){t.setVisibility(!1)}))})),M=(new s.Panel).setDisplay("inline-block").add(S,A),C=document.createElement("input");C.type="file",C.style.display="none",C.accept=".xml",C.addEventListener("change",(function(e){new r.Queue((function(e,n){r.autoLoad(e,{ext:"validation"}).then((function(e){t.structure.validation=e,n()}))}),e.target.files)}),!1);var E=new s.Button("open").onClick((function(){C.click(),D.setMenuDisplay("none")})),T=(new s.Vector3).onChange((function(){t.setPosition(T.getValue())})),P=new r.Quaternion,I=new r.Euler,R=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){I.setFromVector3(R.getValue()),P.setFromEuler(I),t.setRotation(P)})),k=new s.Number(1).setRange(.01,100).onChange((function(){t.setScale(k.getValue())}));n.matrixChanged.add((function(){T.setValue(t.position),R.setValue(I.setFromQuaternion(t.quaternion)),k.setValue(t.scale.x)}));var D=new s.ComponentPanel(t).setDisplay("inline-block").setMargin("0px").addMenuEntry("PDB file",d).addMenuEntry("Representation",p).addMenuEntry("Assembly",f).addMenuEntry("Superpose",b).addMenuEntry("File",new s.Text(t.structure.path).setMaxWidth("100px").setOverflow("auto")).addMenuEntry("Trajectory",_).addMenuEntry("Principal axes",x).addMenuEntry("Measurements",w).addMenuEntry("Annotations",M).addMenuEntry("Validation",E).addMenuEntry("Position",T).addMenuEntry("Rotation",R).addMenuEntry("Scale",k);return r.ListingDatasource&&r.TrajectoryDatasource&&D.addMenuEntry("Remote trajectory",v),i.addStatic(D).add(a).add(o),i},r.SurfaceComponentWidget=function(t,e){var n=t.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel;n.representationAdded.add((function(t){o.add(new r.RepresentationElementWidget(t,e))}));var a=(new s.Select).setColor("#444").setOptions({"":"[ add ]",surface:"surface",dot:"dot"}).onChange((function(){t.addRepresentation(a.getValue()),a.setValue(""),p.setMenuDisplay("none")})),l=(new s.Vector3).onChange((function(){t.setPosition(l.getValue())})),c=new r.Quaternion,u=new r.Euler,h=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){u.setFromVector3(h.getValue()),c.setFromEuler(u),t.setRotation(c)})),d=new s.Number(1).setRange(.01,100).onChange((function(){t.setScale(d.getValue())}));n.matrixChanged.add((function(){l.setValue(t.position),h.setValue(u.setFromQuaternion(t.quaternion)),d.setValue(t.scale.x)}));var p=new s.ComponentPanel(t).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",a).addMenuEntry("File",new s.Text(t.surface.path).setMaxWidth("100px").setWordWrap("break-word")).addMenuEntry("Position",l).addMenuEntry("Rotation",h).addMenuEntry("Scale",d);return i.addStatic(p).add(o),i},r.VolumeComponentWidget=function(t,e){var n=t.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel;n.representationAdded.add((function(t){o.add(new r.RepresentationElementWidget(t,e))}));var a=(new s.Select).setColor("#444").setOptions({"":"[ add ]",surface:"surface",dot:"dot",slice:"slice"}).onChange((function(){t.addRepresentation(a.getValue()),a.setValue(""),p.setMenuDisplay("none")})),l=(new s.Vector3).onChange((function(){t.setPosition(l.getValue())})),c=new r.Quaternion,u=new r.Euler,h=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){u.setFromVector3(h.getValue()),c.setFromEuler(u),t.setRotation(c)})),d=new s.Number(1).setRange(.01,100).onChange((function(){t.setScale(d.getValue())}));n.matrixChanged.add((function(){l.setValue(t.position),h.setValue(u.setFromQuaternion(t.quaternion)),d.setValue(t.scale.x)}));var p=new s.ComponentPanel(t).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",a).addMenuEntry("File",new s.Text(t.volume.path).setMaxWidth("100px").setWordWrap("break-word")).addMenuEntry("Position",l).addMenuEntry("Rotation",h).addMenuEntry("Scale",d);return i.addStatic(p).add(o),i},r.ShapeComponentWidget=function(t,e){var n=t.signals,i=new s.CollapsibleIconPanel("minus-square","plus-square"),o=new s.Panel;n.representationAdded.add((function(t){o.add(new r.RepresentationElementWidget(t,e))}));var a=(new s.Select).setColor("#444").setOptions({"":"[ add ]",buffer:"buffer"}).onChange((function(){t.addRepresentation(a.getValue()),a.setValue(""),p.setMenuDisplay("none")})),l=(new s.Vector3).onChange((function(){t.setPosition(l.getValue())})),c=new r.Quaternion,u=new r.Euler,h=(new s.Vector3).setRange(-6.28,6.28).onChange((function(){u.setFromVector3(h.getValue()),c.setFromEuler(u),t.setRotation(c)})),d=new s.Number(1).setRange(.01,100).onChange((function(){t.setScale(d.getValue())}));n.matrixChanged.add((function(){l.setValue(t.position),h.setValue(u.setFromQuaternion(t.quaternion)),d.setValue(t.scale.x)}));var p=new s.ComponentPanel(t).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",a).addMenuEntry("File",new s.Text(t.shape.path).setMaxWidth("100px").setWordWrap("break-word")).addMenuEntry("Position",l).addMenuEntry("Rotation",h).addMenuEntry("Scale",d);return i.addStatic(p).add(o),i},r.RepresentationElementWidget=function(t,e,n=void 0){var i=t.signals,o=new s.CollapsibleIconPanel("minus-square","plus-square").setMarginLeft("20px");i.visibilityChanged.add((function(t){l.setValue(t)})),i.nameChanged.add((function(t){a.setValue(t)})),i.disposed.add((function(){h.dispose(),o.dispose()}));var a=new s.EllipsisText(t.name).setWidth("103px"),l=new s.ToggleIcon(t.visible,"eye","eye-slash").setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick((function(){t.setVisibility(!t.visible)})),c=new s.Icon("bullseye").setTitle("center").setCursor("pointer").setMarginLeft("10px").onClick((function(){n.autoView(t.repr.selection.string,1e3)})),u=(new s.DisposeIcon).setMarginLeft("10px").setDisposeFunction((function(){t.dispose()}));n?o.addStatic(a).addStatic(l).addStatic(c).addStatic(u):o.addStatic(a).addStatic(l).addStatic(u),"structure"!==t.parent.type&&"trajectory"!==t.parent.type||!t.repr.selection||"selection"!==t.repr.selection.type||o.add(new s.SelectionPanel(t.repr.selection).setMarginLeft("20px").setInputWidth("194px"));var h=new s.PopupMenu("bars","Representation").setMarginLeft("45px").setEntryLabelWidth("190px");h.addEntry("type",new s.Text(t.repr.type));var d=t.repr,p=d.getParameters();return Object.keys(d.parameters).forEach((function(n){if(d.parameters[n]){var s=Object.assign({},d.parameters[n]);s.value=p[n],void 0===s.label&&(s.label=n);var o=r.createParameterInput(s);if(o){i.parametersChanged.add((function(t){"function"==typeof o.setValue&&o.setValue(t[n])}));var a=navigator.userAgent;"range"!==s.type||/Trident/.test(a)||/MSIE/.test(a)?o.onChange(l):o.onInput(l),h.addEntry(n,o)}}function l(){var i={};i[n]=o.getValue(),t.setParameters(i),e.viewer.requestRender()}})),o.addStatic(h),o},r.TrajectoryElementWidget=function(t,e){var n=t.signals,i=t.trajectory,o=new s.CollapsibleIconPanel("minus-square","plus-square").setMarginLeft("20px");n.disposed.add((function(){R.dispose(),o.dispose()}));var a=(new s.Panel).setDisplay("inline").add(new s.Icon("spinner").addClass("spin").setMarginRight("99px")),l=(new s.Panel).setMarginLeft("5px").setDisplay("inline");function c(t){if(d.setValue(t),i.deltaTime&&t>=0){var e=i.getFrameTime(t)/1e3;p.setValue(e.toFixed(9).replace(/\.?0+$/g,"")+"ns")}else p.setValue("");g.setValue(t),a.clear().add(d.setWidth("40px")),l.clear().add(p.setWidth("90px"))}function u(e){d.setRange(-1,e-1),g.setRange(-1,e-1),c(i.currentFrame),void 0!==t.parameters.defaultStep?f.setValue(t.parameters.defaultStep):f.setValue(Math.ceil((e+1)/100)),w.setParameters({step:f.getValue()}),w.setParameters({end:e-1})}n.countChanged.add(u),n.frameChanged.add(c);var h=new s.EllipsisText(t.parameters.name).setWidth("103px");n.nameChanged.add((function(t){h.setValue(t)})),o.addStatic(h),o.addStatic(l);var d=new s.Integer(-1).setWidth("40px").setTextAlign("right").setMarginLeft("5px").setRange(-1,-1).onChange((function(t){i.setFrame(d.getValue()),R.setMenuDisplay("none")})),p=(new s.Text).setTextAlign("right").setWidth("90px"),f=new s.Integer(1).setWidth("50px").setRange(1,1e4).onChange((function(){w.setParameters({step:f.getValue()})})),m=new s.Panel,g=new s.Range(-1,-1,-1,1).setWidth("147px").setMargin("0px").setPadding("0px").setBorder("0px").onInput((function(t){var e=g.getValue();e!==i.currentFrame&&(i.player&&i.player.isRunning?(i.setPlayer(),i.setFrame(e)):i.inProgress||i.setFrame(e))})),_=(new s.Select).setColor("#444").setOptions({"":"none",linear:"linear",spline:"spline"}).setValue(t.parameters.defaultInterpolateType).onChange((function(){w.setParameters({interpolateType:_.getValue()})})),v=new s.Integer(t.parameters.defaultInterpolateStep).setWidth("30px").setRange(1,50).onChange((function(){w.setParameters({interpolateStep:v.getValue()})})),y=(new s.Select).setColor("#444").setOptions({forward:"forward",backward:"backward",bounce:"bounce"}).setValue(t.parameters.defaultDirection).onChange((function(){w.setParameters({direction:y.getValue()})})),b=(new s.Select).setColor("#444").setOptions({loop:"loop",once:"once"}).setValue(t.parameters.defaultMode).onChange((function(){w.setParameters({mode:b.getValue()})})),x=new s.Integer(t.parameters.defaultTimeout).setWidth("30px").setRange(10,1e3).onChange((function(){w.setParameters({timeout:x.getValue()})})),w=new r.TrajectoryPlayer(i,{step:f.getValue(),timeout:x.getValue(),start:0,end:i.frameCount-1,interpolateType:_.getValue(),interpolateStep:v.getValue(),direction:y.getValue(),mode:b.getValue()});i.setPlayer(w);var S=new s.ToggleIcon(!0,"play","pause").setMarginRight("10px").setMarginLeft("20px").setCursor("pointer").setWidth("12px").setTitle("play").onClick((function(){w.toggle()}));w.signals.startedRunning.add((function(){S.setTitle("pause").setValue(!1)})),w.signals.haltedRunning.add((function(){S.setTitle("play").setValue(!0)})),m.add(S,g,a),o.add(new s.SelectionPanel(i.selection).setMarginLeft("20px").setInputWidth("194px"));var A=new s.Checkbox(i.centerPbc).onChange((function(){t.setParameters({centerPbc:A.getValue()})})),M=new s.Checkbox(i.removePeriodicity).onChange((function(){t.setParameters({removePeriodicity:M.getValue()})})),C=new s.Checkbox(i.removePbc).onChange((function(){t.setParameters({removePbc:C.getValue()})})),E=new s.Checkbox(i.superpose).onChange((function(){t.setParameters({superpose:E.getValue()})})),T=new s.Number(i.deltaTime).setWidth("55px").setRange(0,1e6).onChange((function(){t.setParameters({deltaTime:T.getValue()})})),P=new s.Number(i.timeOffset).setWidth("55px").setRange(0,1e9).onChange((function(){t.setParameters({timeOffset:P.getValue()})}));n.parametersChanged.add((function(t){A.setValue(i.centerPbc),M.setValue(i.removePeriodicity),C.setValue(i.removePbc),E.setValue(i.superpose),T.setValue(i.deltaTime),P.setValue(i.timeOffset),i.setFrame(d.getValue())}));var I=(new s.DisposeIcon).setDisposeFunction((function(){t.parent.removeTrajectory(t)}));i.frameCount&&u(i.frameCount);var R=new s.PopupMenu("bars","Trajectory").setMarginLeft("10px").setEntryLabelWidth("130px").addEntry("Center",A).addEntry("Remove Periodicity",M).addEntry("Remove PBC",C).addEntry("Superpose",E).addEntry("Step size",f).addEntry("Interpolation type",_).addEntry("Interpolation steps",v).addEntry("Play timeout",x).addEntry("Play direction",y).addEntry("Play mode",b).addEntry("Delta time [ps]",T).addEntry("Time offset [ps]",P).addEntry("File",new s.Text(i.trajPath).setMaxWidth("100px").setWordWrap("break-word")).addEntry("Dispose",I);return o.addStatic(R),o.add(m),o},r.DirectoryListingWidget=function(t,e,n,i,o){function a(t){var e={"":""},n=[];return(t=t||"").split("/").forEach((function(t){n.push(t),e[n.join("/")]=t})),e}var l=new s.OverlayPanel,c=(new s.Panel).setBorderBottom("1px solid #555").setHeight("30px"),u=(new s.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setPaddingRight("15px").setOverflow("auto"),h=(new s.Select).setColor("#444").setMarginLeft("20px").setWidth("").setMaxWidth("200px").setOptions(a()).onChange((function(){t.getListing(h.getValue()).then(d)}));function d(e){var n=e.path,l=e.data;r.lastUsedDirectory=n,u.clear(),h.setOptions(a(n)).setValue(n),l.forEach((function(e){var n=e.path.split(".").pop().toLowerCase();if(!i||e.dir||-1!==i.indexOf(n)){var r,a,l,c,h,p;e.dir?(r="folder-o",a=e.name):(r="file-o",a=e.name+String.fromCharCode(160)+"("+(l=e.size,(c=Math,h=c.log,p=h(l)/h(1e3)|0,l/c.pow(1e3,p)).toFixed(2)+String.fromCharCode(160)+(p?"kMGTPEZY"[--p]+"B":"Bytes")+")"));var f=(new s.Panel).setDisplay("block").setWhiteSpace("nowrap").add(new s.Icon(r).setWidth("20px")).add(new s.Text(a)).onClick((function(){e.dir?t.getListing(e.path).then(d):o(e)}));e.restricted&&f.add(new s.Icon("lock").setMarginLeft("5px")),u.add(f)}}))}return n=n||"Directoy listing",c.add(new s.Text(n)),c.add(h),c.add(new s.Icon("times").setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick((function(){l.dispose()}))),l.add(c),l.add(u),t.getListing(r.lastUsedDirectory).then(d),l},t.exports={StageWidget:class{constructor(t){var e,n=t.stage,i=new s.Panel;e=t.options.parent?t.el.parentElement:t.el,i.setPosition("absolute"),i.dom=n.viewer.container,this.el=e,this.widgetList=[];var o=new r.Preferences("ngl-stage-widget",n.getParameters()),a={};for(var l in o.storage)a[l]=o.getKey(l);n.setParameters(a),o.signals.keyChanged.add((function(t,e){var i={};i[t]=e,n.setParameters(i)}),this);var c=document.createElement("link");c.rel="stylesheet",c.id="theme",e.appendChild(c);var u=new r.ToolbarWidget(n).setId("toolbar_ngl");e.appendChild(u.dom);var h=new r.MenubarWidget(n,o).setId("menubar_ngl");e.appendChild(h.dom);var d=new r.SidebarWidget(n).setId("sidebar_ngl");e.appendChild(d.dom),this.widgetList.push(u),this.widgetList.push(h),this.widgetList.push(d),e.style.touchAction="none",n.handleResize(),setTimeout((function(){n.handleResize()}),500);var p=!1,f=!1,m=!1,g=function(t){t>=50&&t<=window.innerWidth-10&&(d.setWidth(window.innerWidth-t+"px"),i.setWidth(t+"px"),u.setWidth(t+"px"),n.handleResize());var e=d.dom.getBoundingClientRect().width;if(void 0===t){var r=window.innerWidth-e;i.setWidth(r+"px"),u.setWidth(r+"px"),n.handleResize()}m=e<=10,_()};g=r.throttle(g,50,{leading:!0,trailing:!0});var _=function(){var t=d.dom.getBoundingClientRect().width,i=e.getBoundingClientRect().width;i==t&&(t=i/4);var r=i-t+"px";n.viewer.container.style.width=r,n.handleResize()},v=(new s.Panel).setClass("ResizeLeft").onMouseDown((function(){p=!0,f=!1})).onClick((function(){m?g(window.innerWidth-300):p||f||g(window.innerWidth-10)}));d.add(v),this.viewport=i,this.toolbar=u,this.menubar=h,this.sidebar=d,_(),n.signals.fullscreenChanged.add((function(e){const i=n.viewer.container.parentElement.getBoundingClientRect();n.setSize(i.width+"px",e?i.height+"px":"300px"),t.handleResize()})),window.addEventListener("mousemove",(function(t){p&&(document.body.style.cursor="col-resize",f=!0,g(t.clientX))}),!1),window.addEventListener("mouseup",(function(t){p=!1,document.body.style.cursor=""}),!1),window.addEventListener("resize",(function(t){g()}),!1),document.addEventListener("dragover",(function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="none"}),!1),document.addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault()}),!1)}dispose(){for(var t in this.widgetList)this.widgetList[t].dispose()}}}},9012:(t,e,n)=>{t.exports={};var i=[n(7412)];for(var r in i)if(i&&Object.prototype.hasOwnProperty.call(i,r)){var s=i[r];for(var o in s)s&&Object.prototype.hasOwnProperty.call(s,o)&&(t.exports[o]=s[o])}t.exports.version=n(8330).version},3199:()=>{"function"!=typeof importScripts&&function(t,e,n){function i(t,e){var n=e.getBoundingClientRect();return{x:Math.max(Math.min(t.clientX-n.left,e.clientWidth),0),y:Math.max(Math.min(t.clientY-n.top,e.clientHeight),0)}}function r(t,n,i){for(var r in t=e.createElementNS("http://www.w3.org/2000/svg",t),n)t.setAttribute(r,n[r]);for(Array.isArray(i)||(i=[i]),n=0,r=i[0]&&i.length||0;n<r;n++)t.appendChild(i[n]);return t}function s(t){var e,n,i,r,s=t.h%360/60;return i=(r=t.v*t.s)*(1-Math.abs(s%2-1)),e=n=t=t.v-r,e+=[r,i,0,0,i,r][s=~~s],n+=[i,r,r,i,0,0][s],t+=[0,0,i,r,r,i][s],{r:i=Math.floor(255*e),g:n=Math.floor(255*n),b:t=Math.floor(255*t),hex:"#"+(16777216|t|n<<8|i<<16).toString(16).slice(1)}}function o(t){var e,n=t.r,i=t.g,r=t.b;return(1<t.r||1<t.g||1<t.b)&&(n/=255,i/=255,r/=255),{h:n=(0==(e=(t=Math.max(n,i,r))-Math.min(n,i,r))?0:t==n?(i-r)/e+(i<r?6:0):t==i?(r-n)/e+2:(n-i)/e+4)%6*60,s:0==e?0:e/t,v:t}}function a(t,e,r){if(!(this instanceof a))return new a(t,e,r);this.h=0,this.v=this.s=1,r?(this.callback=r,this.pickerElement=e,this.slideElement=t):(t.innerHTML='<div class="picker-wrapper"><div class="picker"></div><div class="picker-indicator"></div></div><div class="slide-wrapper"><div class="slide"></div><div class="slide-indicator"></div></div>',this.slideElement=t.getElementsByClassName("slide")[0],this.pickerElement=t.getElementsByClassName("picker")[0],this.slideIndicator=t.getElementsByClassName("slide-indicator")[0],this.pickerIndicator=t.getElementsByClassName("picker-indicator")[0],a.positionIndicators(this.slideIndicator,this.pickerIndicator,{x:0,y:0},{x:0,y:0}),this.callback=function(t,n,i,r,s){a.positionIndicators(this.slideIndicator,this.pickerIndicator,s,r),e(t,n,i)}),this.slide_listener=function(t,e,r){return function(o){o=i(o,e),t.h=o.y/e.offsetHeight*360;var a=s({h:t.h,s:1,v:1}),l=s({h:t.h,s:t.s,v:t.v});r.style.backgroundColor=a.hex,t.callback&&t.callback(l.hex,{h:t.h,s:t.s,v:t.v},{r:l.r,g:l.g,b:l.b},n,o)}}(this,this.slideElement,this.pickerElement),this.picker_listener=function(t,e){return function(n){n=i(n,e);var r=e.offsetHeight;t.s=n.x/e.offsetWidth,t.v=(r-n.y)/r,r=s(t),t.callback&&t.callback(r.hex,{h:t.h,s:t.s,v:t.v},{r:r.r,g:r.g,b:r.b},n)}}(this,this.pickerElement),r||this.fixIndicators(this.slideIndicator,this.pickerIndicator),t=h.cloneNode(!0),r=u.cloneNode(!0);var o=t.getElementsByTagName("defs")[0].firstChild,c=t.getElementsByTagName("rect")[0];o.id="gradient-hsv-"+p,c.setAttribute("fill","url(#"+o.id+")"),o=[(o=r.getElementsByTagName("defs")[0]).firstChild,o.lastChild],c=r.getElementsByTagName("rect"),o[0].id="gradient-black-"+p,o[1].id="gradient-white-"+p,c[0].setAttribute("fill","url(#"+o[1].id+")"),c[1].setAttribute("fill","url(#"+o[0].id+")"),this.slideElement.appendChild(t),this.pickerElement.appendChild(r),p++,l(this.slideElement,this.slide_listener),l(this.pickerElement,this.picker_listener)}function l(t,n){function i(t){s&&n(t)}function r(t){i(t),s=!1,e.removeEventListener("mouseup",r,!1),e.removeEventListener("mousemove",i,!1)}var s=!1;t.addEventListener("mousedown",(function(t){s=!0,t.preventDefault(),e.addEventListener("mouseup",r,!0),e.addEventListener("mousemove",i,!1)}),!1)}function c(t,e,n,i){t.h=e.h%360,t.s=e.s,t.v=e.v,e=s(t);var r={y:t.h*t.slideElement.offsetHeight/360,x:0},o=t.pickerElement.offsetHeight;return o={x:t.s*t.pickerElement.offsetWidth,y:o-t.v*o},t.pickerElement.style.backgroundColor=s({h:t.h,s:1,v:1}).hex,t.callback&&t.callback(i||e.hex,{h:t.h,s:t.s,v:t.v},n||{r:e.r,g:e.g,b:e.b},o,r),t}var u,h,d={xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"};h=r("svg",d,[r("defs",{},r("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[r("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),r("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),r("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),r("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),r("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),r("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),r("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),r("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]),u=r("svg",d,[r("defs",{},[r("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[r("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),r("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[r("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})]);var p=0;a.hsv2rgb=function(t){return delete(t=s(t)).hex,t},a.hsv2hex=function(t){return s(t).hex},a.rgb2hsv=o,a.rgb2hex=function(t){return s(o(t)).hex},a.hex2hsv=function(t){return o(a.hex2rgb(t))},a.hex2rgb=function(t){return{r:parseInt(t.substr(1,2),16),g:parseInt(t.substr(3,2),16),b:parseInt(t.substr(5,2),16)}},a.prototype.setHsv=function(t){return c(this,t)},a.prototype.setRgb=function(t){return c(this,o(t),t)},a.prototype.setHex=function(t){return c(this,a.hex2hsv(t),n,t)},a.positionIndicators=function(t,e,n,i){n&&(t.style.top=n.y-t.offsetHeight/2+"px"),i&&(e.style.top=i.y-e.offsetHeight/2+"px",e.style.left=i.x-e.offsetWidth/2+"px")},a.prototype.fixIndicators=function(t,e){l(t,this.slide_listener),l(e,this.picker_listener)},t.ColorPicker=a}(window,window.document)},1147:function(t,e,n){var i;!function(){function r(t,e,n,i,r){this._listener=e,this._isOnce=n,this.context=i,this._signal=t,this._priority=r||0}function s(t,e){if("function"!=typeof t)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function o(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){o.prototype.dispatch.apply(t,arguments)}}r.prototype={active:!0,params:null,execute:function(t){var e;return this.active&&this._listener&&(t=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,t),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},o.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,n,i){var s=this._indexOfListener(t,n);if(-1!==s){if((t=this._bindings[s]).isOnce()!==e)throw Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else t=new r(this,t,e,n,i),this._addBinding(t);return this.memorize&&this._prevParams&&t.execute(this._prevParams),t},_addBinding:function(t){var e=this._bindings.length;do{--e}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===t&&n.context===e)return i;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,n){return s(t,"add"),this._registerListener(t,!1,e,n)},addOnce:function(t,e,n){return s(t,"addOnce"),this._registerListener(t,!0,e,n)},remove:function(t,e){s(t,"remove");var n=this._indexOfListener(t,e);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(t){if(this.active){var e,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){e=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(e[i]&&this._shouldPropagate&&!1!==e[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var a=o;a.Signal=o,void 0===(i=function(){return a}.call(e,n,e,t))||(t.exports=i)}()},4649:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ThemeManagerView=e.ThemeManagerModel=void 0;const i=n(431),r=n(2555),s=n(2055);class o extends s.DOMWidgetModel{defaults(){return i.extend(s.DOMWidgetModel.prototype.defaults(),{_model_name:"ThemeManagerModel",_model_module:"nglview-js-widgets",_model_module_version:n(8330).version,_view_name:"ThemeManagerView",_view_module:"nglview-js-widgets",_view_module_version:n(8330).version})}}e.ThemeManagerModel=o;class a extends r.BaseView{render(){super.render(),this.displayed.then((()=>this.handleThemeChanged()))}handleThemeChanged(){console.log("ThemeManagerView: handleThemeChanged"),this.setTheme(this.model.get("_theme_css"))}handleEmbed(){this.handleThemeChanged()}setTheme(t){if(null!=t){var e=document.getElementById("nglview_style");e&&document.head.removeChild(e),(e=document.createElement("style")).id="nglview_style",e.appendChild(document.createTextNode(t)),document.head.appendChild(e),this.send({type:"call_method",data:"handle_resize"})}}}e.ThemeManagerView=a},6237:(t,e,n)=>{var i=n(4197).UI;i.Html=function(t){i.Element.call(this);var e=document.createElement("span");return e.className="Html",e.style.cursor="default",e.style.display="inline-block",e.style.verticalAlign="middle",this.dom=e,this.setValue(t),this},i.Html.prototype=Object.create(i.Element.prototype),i.Html.prototype.setValue=function(t){return void 0!==t&&(this.dom.innerHTML=t),this},i.Form=function(){i.Panel.call(this);var t=document.createElement("form");return t.className="Form",t.method="post",t.action="",t.target="_blank",t.enctype="multipart/form-data",this.dom=t,this},i.Form.prototype=Object.create(i.Panel.prototype),i.Form.prototype.setMethod=function(t){return this.dom.method=t,this},i.Form.prototype.setAction=function(t){return this.dom.action=t,this},i.Form.prototype.setTarget=function(t){return this.dom.target=t,this},i.Form.prototype.setEnctype=function(t){return this.dom.enctype=t,this},i.File=function(){return i.Input.call(this),this.dom.className="File",this.dom.type="file",this.dom.multiple=!1,this},i.File.prototype=Object.create(i.Input.prototype),i.File.prototype.setMultiple=function(t){return this.dom.multiple=t,this},i.File.prototype.getFiles=function(t){return this.dom.files},i.Hidden=function(){return i.Input.call(this),this.dom.type="hidden",this},i.Hidden.prototype=Object.create(i.Input.prototype),i.ToggleButton=function(t,e,n,r){i.Button.call(this,e);var s=!0;return this.onClick(function(){s?(s=!1,this.setLabel(t),r()):(s=!0,this.setLabel(e),n())}.bind(this)),this},i.ToggleButton.prototype=Object.create(i.Button.prototype),i.EllipsisText=function(t){return i.Text.call(this,t),this.setWhiteSpace("nowrap"),this.setOverflow("hidden"),this.setTextOverflow("ellipsis"),this},i.EllipsisText.prototype=Object.create(i.Text.prototype),i.EllipsisText.prototype.setValue=function(t){return void 0!==t&&(this.dom.textContent=t,this.setTitle(t)),this},i.EllipsisMultilineText=function(t){i.Element.call(this);var e=document.createElement("span");e.className="EllipsisMultilineText",e.style.cursor="default",e.style.display="inline-block",e.style.verticalAlign="middle";var n=document.createElement("p");return e.appendChild(n),this.dom=e,this.content=n,this.setValue(t),this},i.EllipsisMultilineText.prototype=Object.create(i.Element.prototype),i.EllipsisMultilineText.prototype.setValue=function(t){return void 0!==t&&(this.content.textContent=t,this.setTitle(t)),this},i.OverlayPanel=function(){return i.Panel.call(this),this.dom.className="Panel OverlayPanel",this.dom.tabIndex="-1",this.dom.style.outline="none",this},i.OverlayPanel.prototype=Object.create(i.Panel.prototype),i.OverlayPanel.prototype.attach=function(t){return(t=t||document.body).appendChild(this.dom),this},i.Icon=function(t){i.Panel.call(this);var e=document.createElement("span");return e.className="Icon fa",this.dom=e,t&&this.addClass.apply(this,arguments),this},i.Icon.prototype=Object.create(i.Panel.prototype),i.Icon.prototype.hasClass=function(t){return this.dom.classList.contains("fa-"+t)},i.Icon.prototype.addClass=function(t){for(var e=0;e<arguments.length;e++)this.dom.classList.add("fa-"+arguments[e]);return this},i.Icon.prototype.setClass=function(t){this.dom.className="Icon fa";for(var e=0;e<arguments.length;e++)this.dom.classList.add("fa-"+arguments[e]);return this},i.Icon.prototype.removeClass=function(t){for(var e=0;e<arguments.length;e++)this.dom.classList.remove("fa-"+arguments[e]);return this},i.Icon.prototype.switchClass=function(t,e){return this.removeClass(e,t),this.addClass(t),this},i.ToggleIcon=function(t,e,n){return i.Icon.call(this,t?e:n),this.value=t,this.classTrue=e,this.classFalse=n,this},i.ToggleIcon.prototype=Object.create(i.Icon.prototype),i.ToggleIcon.prototype.setValue=function(t){return this.value=t,t?this.switchClass(this.classTrue,this.classFalse):this.switchClass(this.classFalse,this.classTrue),this},i.ToggleIcon.prototype.getValue=function(){return this.value},i.DisposeIcon=function(){i.Icon.call(this,"trash-o");var t=!1,e=this;return this.setTitle("delete"),this.setCursor("pointer"),this.onClick((function(){!0===t?"function"==typeof e.disposeFunction&&e.disposeFunction():(e.setColor("rgb(178, 34, 34)"),e.dom.classList.add("deleteInfo"),t=!0,setTimeout((function(){e.setColor("#888"),e.dom.classList.remove("deleteInfo"),t=!1}),1500))})),this},i.DisposeIcon.prototype=Object.create(i.Icon.prototype),i.DisposeIcon.prototype.setDisposeFunction=function(t){return this.disposeFunction=t,this},i.Progress=function(t,e){i.Element.call(this);var n=document.createElement("progress");return n.className="Progress",n.max=t||1,void 0!==e&&(n.value=e),this.dom=n,this},i.Progress.prototype=Object.create(i.Element.prototype),i.Progress.prototype.getValue=function(){return this.dom.value},i.Progress.prototype.setValue=function(t){return this.dom.value=t,this},i.Progress.prototype.setMax=function(t){return this.dom.max=t,this},i.Progress.prototype.setIndeterminate=function(){return this.dom.removeAttribute("value"),this},i.Range=function(t,e,n,r){i.Element.call(this);var s=document.createElement("input");return s.className="Range",s.type="range",s.min=t.toPrecision(3),s.max=e.toPrecision(3),s.value=n.toPrecision(3),s.step=r.toPrecision(3),this.dom=s,this},i.Range.prototype=Object.create(i.Element.prototype),i.Range.prototype.getValue=function(){return parseFloat(this.dom.value)},i.Range.prototype.setRange=function(t,e){return this.dom.min=t,this.dom.max=e,this},i.Range.prototype.setValue=function(t){return this.dom.value=t,this},i.Range.prototype.setStep=function(t){return this.dom.step=t,this},i.AdaptiveTextArea=function(){i.Element.call(this);var t=document.createElement("div");t.className="AdaptiveTextAreaContainer";var e=document.createElement("textarea");e.className="AdaptiveTextArea";var n=document.createElement("div");return n.className="AdaptiveTextAreaSize",t.appendChild(e),t.appendChild(n),e.addEventListener("input",(function(t){n.innerHTML=e.value+"\n"}),!1),this.textarea=e,this.size=n,this.dom=t,this},i.AdaptiveTextArea.prototype=Object.create(i.Element.prototype),i.AdaptiveTextArea.prototype.getValue=function(){return this.textarea.value},i.AdaptiveTextArea.prototype.setValue=function(t){return this.textarea.value=t,this.size.innerHTML=t+"\n",this},i.AdaptiveTextArea.prototype.setSpellcheck=function(t){return this.textarea.spellcheck=t,this},i.AdaptiveTextArea.prototype.setBackgroundColor=function(t){return this.textarea.style.backgroundColor=t,this},i.VirtualList=function(t,e,n,r){i.Element.call(this),t=t||[],e=e||20,n=n||300,r=r||function(){};var s=document.createElement("div");s.className="VirtualList",s.style.height=n+"px";var o,a=t.length,l=Math.ceil(n/e),c=3*l,u=l*e,h=0,d=function(){},p=document.createElement("div");p.style.width="100%",p.style.height=n+"px",p.style["overflow-y"]="auto",p.style.position="relative",p.style.padding=0;var f=document.createElement("div");function m(t){var n=r(t);return n.classList.add("VirtualListRow"),n.style.height=e+"px",n.style.top=t*e+"px",n}function g(t){var e=Math.min(a,t+c);d(t,e);for(var n=document.createDocumentFragment(),i=t;i<e;i++)n.appendChild(m(i));for(var r=1,s=p.childNodes.length;r<s;r++)p.childNodes[r].style.display="none",p.childNodes[r].setAttribute("data-rm","1");p.appendChild(n)}f.style.opacity=0,f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.width="1px",f.style.height=e*a+"px";var _=setInterval((function(){for(var t=s;t!==document&&t.parentNode;)t=t.parentNode;if(t!==document&&clearInterval(_),Date.now()-h>100)for(var e=p.querySelectorAll('[data-rm="1"]'),n=0,i=e.length;n<i;n++)p.removeChild(e[n])}),500);return this.setItems=function(n){return a=(t=n).length,f.style.height=e*a+"px",g(0),this},this.setItemHeight=function(t){return e=t,l=Math.ceil(n/e),c=3*l,u=l*e,f.style.height=e*a+"px",g(0),this},this.setHeight=function(t){return i.Element.prototype.setHeight.call(this,t+"px"),n=t,l=Math.ceil(n/e),c=3*l,u=l*e,p.style.height=n+"px",f.style.height=n+"px",g(0),this},this.setGeneratorFn=function(t){return r=t,g(0),this},this.setRenderChunkCallback=function(t){d=t},this.redraw=function(){var t=Math.floor(p.scrollTop/e);return g(Math.max(0,t-l)),o=p.scrollTop,this},p.appendChild(f),s.appendChild(p),p.addEventListener("scroll",(function(t){var n=t.target.scrollTop;if(!o||Math.abs(n-o)>u){var i=Math.floor(n/e);g(Math.max(0,i-l)),o=n}h=Date.now(),t.preventDefault&&t.preventDefault()})),g(0),this.dom=s,this},i.VirtualList.prototype=Object.create(i.Element.prototype),i.VirtualTable=function(t,e,n,r,s){var o=s||{};i.Panel.call(this);var a=void 0!==o.defaultWidth?o.defaultWidth:30,l=void 0!==o.defaultMargin?o.defaultMargin:5,c=void 0!==o.defaultAlign?o.defaultAlign:"left",u=o.onRowSelect,h=(new i.Panel).setWhiteSpace("nowrap").setDisplay("inline-block").setOverflow("").setWidth("100%"),d=0,p=[],f=function(t,e){return t-e},m=function(t,e){return t.localeCompare(e)},g=function(e,n){var i;return i="string"==typeof t[0][e]?m:f,t.sort((function(t,r){return n?i(r[e],t[e]):i(t[e],r[e])})),v.redraw(),this},_=function(e,n){return p.length=0,u&&u(e,n),void 0!==n&&p.push(t[n][0]),v.redraw(),this};r.forEach((function(t){var e=t.width||a,n=t.margin||l,r=(new i.EllipsisText).setValue(t.name).setWidth(e+"px").setTextAlign(t.align||c).setMarginLeft(n+"px").setMarginRight(n+"px").setCursor("pointer").onClick((function(e){var n="ASC"===t.__sortFlag;g(t.index,n),t.__sortFlag=n?"DESC":"ASC"}));h.add(r),d+=e+2*n}));var v=new i.VirtualList(t,e,n,(function(e){var n=new i.Panel;return r.forEach((function(r){var s=t[e][r.index];r.format&&(s=r.format(s));var o,u=r.width||a,h=r.margin||l;(o="object"==typeof s?s:(new i.Text).setValue(s)).setWidth(u+"px").setTextAlign(r.align||c).setMarginLeft(h+"px").setMarginRight(h+"px").onClick((function(t){"function"==typeof r.onClick&&r.onClick(t,e,s)})).onMouseOver((function(t){"function"==typeof r.onMouseOver&&r.onMouseOver(t,e,s)})).onMouseOut((function(t){"function"==typeof r.onMouseOut&&r.onMouseOut(t,e,s)})),n.add(o)})),n.setCursor("pointer").onClick((function(t){_(t,e)})),-1!==p.indexOf(t[e][0])&&n.dom.classList.add("highlight"),n.dom})).setWidth(d+20+"px");return this.add(h,v),this.header=h,this.list=v,this.sortColumn=g,this.selectRow=function(t){_(void 0,t)},this},i.VirtualTable.prototype=Object.create(i.Panel.prototype),i.PopupMenu=function(t,e,n){n=n||"scrollParent",i.Panel.call(this);var r=new i.Icon(t||"bars"),s=(new i.OverlayPanel).setDisplay("none").attach(this.dom),o=0;function a(t){0===o&&(o=t.clientX,t.clientY),t.clientX,t.clientY,o=t.clientX,t.clientY}var l=(new i.Panel).setBorderBottom("1px solid #555").setMarginBottom("10px").setHeight("25px").setCursor("move").onMouseDown((function(t){1===t.which&&document.addEventListener("mousemove",a),document.addEventListener("mouseup",(function(t){document.removeEventListener("mousemove",a)}))}));return l.add(new i.Icon("times").setFloat("right").setCursor("pointer").onClick(function(){this.setMenuDisplay("none")}.bind(this))).add(new i.Text(e)),s.add(l),r.setTitle("menu"),r.setCursor("pointer"),r.onClick(function(t){"block"!==s.getDisplay()?(s.setMaxHeight(window.innerHeight/1.2+"px"),this.setMenuDisplay("block")):this.setMenuDisplay("none")}.bind(this)),this.add(r),this.setClass("").setDisplay("inline"),this.icon=r,this.panel=s,this.entryLabelWidth="100px",this},i.PopupMenu.prototype=Object.create(i.Panel.prototype),i.PopupMenu.prototype.addEntry=function(t,e){return this.panel.add(new i.Text(t).setWidth(this.entryLabelWidth)).add(e||new i.Panel).add(new i.Break),this},i.PopupMenu.prototype.setEntryLabelWidth=function(t){return this.entryLabelWidth=t,this},i.PopupMenu.prototype.setMenuDisplay=function(t){return this.panel.setDisplay(t),"none"!==t&&this.panel.dom.focus(),this},i.PopupMenu.prototype.setIconTitle=function(t){return this.icon.setTitle(t),this},i.PopupMenu.prototype.dispose=function(){this.panel.dispose(),i.Element.prototype.dispose.call(this)},i.CollapsibleIconPanel=function(t,e){i.Panel.call(this),this.dom.className="Panel CollapsiblePanel",void 0===t&&(t=t||"chevron-down",e=e||"chevron-right"),this.button=new i.Icon(t).setTitle("expand/collapse").setCursor("pointer").setWidth("12px").setMarginRight("6px"),this.addStatic(this.button);var n=this;return this.button.dom.addEventListener("click",(function(t){n.toggle()}),!1),this.content=document.createElement("div"),this.content.className="CollapsibleContent",this.dom.appendChild(this.content),this.isCollapsed=!1,this.iconClass1=t,this.iconClass2=e,this},i.CollapsibleIconPanel.prototype=Object.create(i.CollapsiblePanel.prototype),i.CollapsibleIconPanel.prototype.setCollapsed=function(t){t?(this.dom.classList.add("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass2,this.iconClass1):this.button.addClass("rotate-90")):(this.dom.classList.remove("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass1,this.iconClass2):this.button.removeClass("rotate-90")),this.isCollapsed=t},i.ColorPicker=function(){var t=this;i.Panel.call(this),this.slideWrapper=(new i.Panel).setClass("slide-wrapper"),this.sliderIndicator=(new i.Panel).setClass("slide-indicator"),this.slider=(new i.Panel).setClass("slide").setWidth("25px").setHeight("80px"),this.slideWrapper.add(this.slider,this.sliderIndicator),this.pickerWrapper=(new i.Panel).setClass("picker-wrapper"),this.pickerIndicator=(new i.Panel).setClass("picker-indicator"),this.picker=(new i.Panel).setClass("picker").setWidth("130px").setHeight("80px"),this.pickerWrapper.add(this.picker,this.pickerIndicator);var e=document.createEvent("Event");return e.initEvent("change",!0,!0),this.add(this.pickerWrapper,this.slideWrapper),this.colorPicker=ColorPicker(this.slider.dom,this.picker.dom,(function(n,i,r,s,o){if(!s&&o&&i.s<.05)return i.s=.5,i.v=.7,void t.colorPicker.setHsv(i);ColorPicker.positionIndicators(t.sliderIndicator.dom,t.pickerIndicator.dom,o,s),t.hex=n,t.hsv=i,t.rgb=r,t._settingValue||t.dom.dispatchEvent(e)})),this.colorPicker.fixIndicators(this.sliderIndicator.dom,this.pickerIndicator.dom),this},i.ColorPicker.prototype=Object.create(i.Panel.prototype),i.ColorPicker.prototype.setValue=function(t){return t!==this.hex&&(this._settingValue=!0,this.colorPicker.setHex(t),this._settingValue=!1),this},i.ColorPicker.prototype.getValue=function(){return this.hex},t.exports={UI:i}},4197:t=>{var e={Element:function(){}};e.Element.prototype={setId:function(t){return this.dom.id=t,this},setTitle:function(t){return this.dom.title=t,this},setClass:function(t){return this.dom.className=t,this},setStyle:function(t,e){for(var n=0;n<e.length;n++)this.dom.style[t]=e[n]},getStyle:function(t){return this.dom.style[t]},getBox:function(){return this.dom.getBoundingClientRect()},setDisabled:function(t){return this.dom.disabled=t,this},setTextContent:function(t){return this.dom.textContent=t,this},dispose:function(){this.dom.parentNode.removeChild(this.dom)}},["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","overflowX","overflowY","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","backgroundColor","opacity","fontSize","fontWeight","fontStyle","fontFamily","textTransform","cursor","verticalAlign","clear","float","zIndex","minHeight","maxHeight","minWidth","maxWidth","wordBreak","wordWrap","spellcheck","lineHeight","whiteSpace","textOverflow","textAlign","pointerEvents"].forEach((function(t){var n=t.substr(0,1).toUpperCase()+t.substr(1,t.length);e.Element.prototype["set"+n]=function(){return this.setStyle(t,arguments),this},e.Element.prototype["get"+n]=function(){return this.getStyle(t)}})),["KeyUp","KeyDown","KeyPress","MouseOver","MouseOut","MouseDown","MouseUp","MouseMove","Click","Change","Input","Scroll"].forEach((function(t){var n="on"+t;e.Element.prototype[n]=function(e){return this.dom.addEventListener(t.toLowerCase(),e.bind(this),!1),this}})),e.Panel=function(){e.Element.call(this);var t=document.createElement("div");return t.className="Panel",this.dom=t,this.children=[],this},e.Panel.prototype=Object.create(e.Element.prototype),e.Panel.prototype.add=function(){for(var t=0;t<arguments.length;t++)this.dom.appendChild(arguments[t].dom),this.children.push(arguments[t]);return this},e.Panel.prototype.remove=function(){for(var t=0;t<arguments.length;t++){this.dom.removeChild(arguments[t].dom);var e=this.children.indexOf(arguments[t]);-1!==e&&this.children.splice(e,1)}return this},e.Panel.prototype.clear=function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild);return this.children.length=0,this},e.CollapsiblePanel=function(){e.Panel.call(this),this.dom.className="Panel CollapsiblePanel",this.button=document.createElement("div"),this.button.className="CollapsiblePanelButton",this.dom.appendChild(this.button);var t=this;return this.button.addEventListener("click",(function(e){t.toggle()}),!1),this.content=document.createElement("div"),this.content.className="CollapsibleContent",this.dom.appendChild(this.content),this.isCollapsed=!1,this},e.CollapsiblePanel.prototype=Object.create(e.Panel.prototype),e.CollapsiblePanel.prototype.addStatic=function(){for(var t=0;t<arguments.length;t++)this.dom.insertBefore(arguments[t].dom,this.content);return this},e.CollapsiblePanel.prototype.removeStatic=e.Panel.prototype.remove,e.CollapsiblePanel.prototype.clearStatic=function(){this.dom.childNodes.forEach((function(t){t!==this.content&&this.dom.removeChild(t)}))},e.CollapsiblePanel.prototype.add=function(){for(var t=0;t<arguments.length;t++)this.content.appendChild(arguments[t].dom);return this},e.CollapsiblePanel.prototype.remove=function(){for(var t=0;t<arguments.length;t++)this.content.removeChild(arguments[t].dom);return this},e.CollapsiblePanel.prototype.clear=function(){for(;this.content.children.length;)this.content.removeChild(this.content.lastChild)},e.CollapsiblePanel.prototype.toggle=function(){this.setCollapsed(!this.isCollapsed)},e.CollapsiblePanel.prototype.collapse=function(){this.setCollapsed(!0)},e.CollapsiblePanel.prototype.expand=function(){this.setCollapsed(!1)},e.CollapsiblePanel.prototype.setCollapsed=function(t){t?this.dom.classList.add("collapsed"):this.dom.classList.remove("collapsed"),this.isCollapsed=t},e.Text=function(t){e.Element.call(this);var n=document.createElement("span");return n.className="Text",n.style.display="inline-block",n.style.verticalAlign="middle",this.dom=n,this.setValue(t),this},e.Text.prototype=Object.create(e.Element.prototype),e.Text.prototype.setValue=function(t){return void 0!==t&&(this.dom.textContent=t),this},e.Text.prototype.setName=function(t){return this.dom.name=t,this},e.Input=function(t){e.Element.call(this);var n=document.createElement("input");return n.className="Input",n.style.padding="2px",n.style.border="1px solid #ccc",n.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),this.dom=n,this.setValue(t||""),this},e.Input.prototype=Object.create(e.Element.prototype),e.Input.prototype.getValue=function(){return this.dom.value},e.Input.prototype.setValue=function(t){return this.dom.value=t,this},e.Input.prototype.setName=function(t){return this.dom.name=t,this},e.TextArea=function(){e.Element.call(this);var t=document.createElement("textarea");return t.className="TextArea",t.style.padding="2px",t.style.border="1px solid #ccc",t.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),this.dom=t,this},e.TextArea.prototype=Object.create(e.Element.prototype),e.TextArea.prototype.getValue=function(){return this.dom.value},e.TextArea.prototype.setValue=function(t){return this.dom.value=t,this},e.Select=function(){e.Element.call(this);var t=document.createElement("select");return t.className="Select",t.style.width="64px",t.style.height="16px",t.style.border="0px",t.style.padding="0px",this.dom=t,this},e.Select.prototype=Object.create(e.Element.prototype),e.Select.prototype.setMultiple=function(t){return this.dom.multiple=t,this},e.Select.prototype.setOptions=function(t){for(var e=this.dom.value;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var n in t){var i=document.createElement("option");i.value=n,i.innerHTML=t[n],this.dom.appendChild(i)}return this.dom.value=e,this},e.Select.prototype.getValue=function(){return this.dom.value},e.Select.prototype.setValue=function(t){return this.dom.value=t,this},e.Select.prototype.setName=function(t){return this.dom.name=t,this},e.FancySelect=function(){e.Element.call(this);var t=this,n=document.createElement("div");n.className="FancySelect",n.tabIndex=0;var i=document.createEvent("HTMLEvents");return i.initEvent("change",!0,!0),n.addEventListener("keydown",(function(t){switch(t.keyCode){case 38:case 40:t.preventDefault(),t.stopPropagation()}}),!1),n.addEventListener("keyup",(function(e){switch(e.keyCode){case 38:case 40:t.selectedIndex+=38==e.keyCode?-1:1,t.selectedIndex>=0&&t.selectedIndex<t.options.length&&(t.setValue(t.options[t.selectedIndex].value),t.dom.dispatchEvent(i))}}),!1),this.dom=n,this.options=[],this.selectedIndex=-1,this.selectedValue=null,this},e.FancySelect.prototype=Object.create(e.Element.prototype),e.FancySelect.prototype.setOptions=function(t){var e=this,n=document.createEvent("HTMLEvents");for(n.initEvent("change",!0,!0);e.dom.children.length>0;)e.dom.removeChild(e.dom.firstChild);e.options=[];for(var i=0;i<t.length;i++){var r=t[i],s=document.createElement("div");s.className="option",s.innerHTML=r.html,s.value=r.value,e.dom.appendChild(s),e.options.push(s),s.addEventListener("click",(function(t){e.setValue(this.value),e.dom.dispatchEvent(n)}),!1)}return e},e.FancySelect.prototype.getValue=function(){return this.selectedValue},e.FancySelect.prototype.setValue=function(t){for(var e=0;e<this.options.length;e++){var n=this.options[e];if(n.value===t){n.classList.add("active");var i=n.offsetTop-this.dom.offsetTop,r=i+n.offsetHeight-this.dom.offsetHeight;this.dom.scrollTop>i?this.dom.scrollTop=i:this.dom.scrollTop<r&&(this.dom.scrollTop=r),this.selectedIndex=e}else n.classList.remove("active")}return this.selectedValue=t,this},e.Checkbox=function(t){e.Element.call(this);var n=document.createElement("input");return n.className="Checkbox",n.type="checkbox",this.dom=n,this.setValue(t),this},e.Checkbox.prototype=Object.create(e.Element.prototype),e.Checkbox.prototype.getValue=function(){return this.dom.checked},e.Checkbox.prototype.setValue=function(t){return void 0!==t&&(this.dom.checked=t),this},e.Checkbox.prototype.setName=function(t){return this.dom.name=t,this},e.Color=function(){e.Element.call(this);var t=document.createElement("input");t.className="Color",t.style.width="64px",t.style.height="16px",t.style.border="0px",t.style.padding="0px",t.style.backgroundColor="transparent";try{t.type="color",t.value="#ffffff"}catch(t){}return this.dom=t,this},e.Color.prototype=Object.create(e.Element.prototype),e.Color.prototype.getValue=function(){return this.dom.value},e.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},e.Color.prototype.setValue=function(t){return this.dom.value=t,this},e.Color.prototype.setHexValue=function(t){return this.dom.value="#"+("000000"+t.toString(16)).slice(-6),this},e.Number=function(t){e.Element.call(this);var n=this,i=document.createElement("input");i.className="Number",i.value="0.00",i.addEventListener("keydown",(function(t){t.stopPropagation(),13===t.keyCode&&i.blur()}),!1),this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.dom=i,this.setValue(t);var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0);var s=0,o=0,a=[0,0],l=[0,0],c=function(t){var e=i.value;a=[t.clientX,t.clientY],s+=a[0]-l[0]-(a[1]-l[1]);var c=50;t.shiftKey&&(c=5),t.ctrlKey&&(c=500);var u=o+s/c*n.step;i.value=Math.min(n.max,Math.max(n.min,u)).toFixed(n.precision),e!==i.value&&i.dispatchEvent(r),l=[t.clientX,t.clientY]},u=function(t){document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",u,!1),Math.abs(s)<2&&(i.focus(),i.select())};return i.addEventListener("mousedown",(function(t){t.preventDefault(),s=0,o=parseFloat(i.value),l=[t.clientX,t.clientY],document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1)}),!1),i.addEventListener("change",(function(t){var e=parseFloat(i.value);i.value=!1===isNaN(e)?e:0}),!1),i.addEventListener("focus",(function(t){i.style.backgroundColor="",i.style.borderColor="#ccc",i.style.cursor=""}),!1),i.addEventListener("blur",(function(t){i.style.backgroundColor="transparent",i.style.borderColor="transparent",i.style.cursor="col-resize"}),!1),this},e.Number.prototype=Object.create(e.Element.prototype),e.Number.prototype.getValue=function(){return parseFloat(this.dom.value)},e.Number.prototype.setValue=function(t){return isNaN(t)?this.dom.value=NaN:void 0!==t&&(this.dom.value=t.toFixed(this.precision)),this},e.Number.prototype.setRange=function(t,e){return this.min=t,this.max=e,this},e.Number.prototype.setPrecision=function(t){return this.precision=t,this.setValue(parseFloat(this.dom.value)),this},e.Number.prototype.setName=function(t){return this.dom.name=t,this},e.Integer=function(t){e.Element.call(this);var n=this,i=document.createElement("input");i.className="Number",i.value="0.00",i.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),this.min=-1/0,this.max=1/0,this.step=1,this.dom=i,this.setValue(t);var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0);var s=0,o=0,a=[0,0],l=[0,0],c=function(t){var e=i.value;a=[t.clientX,t.clientY],s+=a[0]-l[0]-(a[1]-l[1]);var c=50;t.shiftKey&&(c=5),t.ctrlKey&&(c=500);var u=o+s/c*n.step;i.value=0|Math.min(n.max,Math.max(n.min,u)),e!==i.value&&i.dispatchEvent(r),l=[t.clientX,t.clientY]},u=function(t){document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",u,!1),Math.abs(s)<2&&(i.focus(),i.select())};return i.addEventListener("mousedown",(function(t){t.preventDefault(),s=0,o=parseFloat(i.value),l=[t.clientX,t.clientY],document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1)}),!1),i.addEventListener("change",(function(t){var e=parseInt(i.value);!1===isNaN(e)&&(i.value=e)}),!1),i.addEventListener("focus",(function(t){i.style.backgroundColor="",i.style.borderColor="#ccc",i.style.cursor=""}),!1),i.addEventListener("blur",(function(t){i.style.backgroundColor="transparent",i.style.borderColor="transparent",i.style.cursor="col-resize"}),!1),this},e.Integer.prototype=Object.create(e.Element.prototype),e.Integer.prototype.getValue=function(){return parseInt(this.dom.value)},e.Integer.prototype.setValue=function(t){return void 0!==t&&(this.dom.value=0|t),this},e.Integer.prototype.setRange=function(t,e){return this.min=t,this.max=e,this},e.Integer.prototype.setName=function(t){return this.dom.name=t,this},e.Integer.prototype.setStep=function(t){return this.step=t,this},e.Break=function(){e.Element.call(this);var t=document.createElement("br");return t.className="Break",this.dom=t,this},e.Break.prototype=Object.create(e.Element.prototype),e.HorizontalRule=function(){e.Element.call(this);var t=document.createElement("hr");return t.className="HorizontalRule",this.dom=t,this},e.HorizontalRule.prototype=Object.create(e.Element.prototype),e.Button=function(t){e.Element.call(this);var n=document.createElement("button");return n.className="Button",this.dom=n,this.dom.textContent=t,this},e.Button.prototype=Object.create(e.Element.prototype),e.Button.prototype.setLabel=function(t){return this.dom.textContent=t,this},e.MenubarHelper={createMenuContainer:function(t,n){var i=new e.Panel,r=new e.Panel;return r.setClass("title"),r.setTextContent(t),r.setMargin("0px"),r.setPadding("8px"),i.setClass("menu"),i.add(r),i.add(n),i},createOption:function(t,n,i){var r=new e.Panel;return r.setClass("option"),i?(r.add(new e.Icon(i).setWidth("20px")),r.add(new e.Text(t))):r.setTextContent(t),r.onClick(n),r},createOptionsPanel:function(t){var n=new e.Panel;return n.setClass("options"),t.forEach((function(t){n.add(t)})),n},createInput:function(t,n){var i=(new e.Panel).setClass("option"),r=(new e.Text).setWidth("70px").setValue(t),s=(new e.Input).setWidth("40px").onKeyDown(n);return i.add(r),i.add(s),i},createCheckbox:function(t,n,i){var r=(new e.Panel).setClass("option"),s=(new e.Text).setWidth("70px").setValue(t),o=(new e.Checkbox).setValue(n).onClick(i);return r.add(o),r.add(s),r},createDivider:function(){return new e.HorizontalRule}},t.exports={UI:e}},6870:(t,e,n)=>{var i,r=n(485),s=n(6237).UI;s.ColorPopupMenu=function(){var t=this;s.Panel.call(this),this.iconText=new s.Text("").setCursor("pointer").setClass("fa-stack-1x").setFontFamily("Arial, sans-serif").setColor("#111"),this.iconSquare=new s.Icon("square","stack-1x"),this.menu=new s.PopupMenu("stack","Color"),this.menu.icon.setTitle("color").setWidth("1em").setHeight("1em").setLineHeight("1em").add(this.iconSquare).add(this.iconText);var e=document.createEvent("Event");return e.initEvent("change",!0,!0),this.colorInput=(new s.Input).onChange((function(){t.setColor(t.colorInput.getValue()),t.dom.dispatchEvent(e)})),this.colorPicker=(new s.ColorPicker).setDisplay("inline-block").onChange((function(n){t.setColor(t.colorPicker.getValue()),t.dom.dispatchEvent(e)})),this.menu.addEntry("Input",this.colorInput).addEntry("Picker",this.colorPicker),this.add(this.menu),this.setClass("").setDisplay("inline"),this},s.ColorPopupMenu.prototype=Object.create(s.Panel.prototype),s.ColorPopupMenu.prototype.setColor=(i=new r.Color,function(t){return i.set(t),t="#"+i.getHexString(),this.colorInput.setBackgroundColor(t).setValue(t),this.colorPicker.setValue(t),this.iconSquare.setColor(t),Math.sqrt(255*i.r*i.r*255*.241+255*i.g*i.g*255*.691+255*i.b*i.b*255*.068)>130?(this.iconText.setColor("#000000"),this.colorInput.setColor("#000000")):(this.iconText.setColor("#FFFFFF"),this.colorInput.setColor("#FFFFFF")),this}),s.ColorPopupMenu.prototype.getColor=function(){return this.colorInput.getValue()},s.ColorPopupMenu.prototype.getValue=function(){return this.getColor()},s.ColorPopupMenu.prototype.setValue=function(t){return this.setColor(t),this},s.ColorPopupMenu.prototype.dispose=function(){this.menu.dispose(),s.Panel.prototype.dispose.call(this)},s.Vector3=function(t){s.Panel.call(this).setDisplay("inline-block"),this.xNumber=new s.Number(0).setWidth("40px"),this.yNumber=new s.Number(0).setWidth("40px"),this.zNumber=new s.Number(0).setWidth("40px"),this.add(this.xNumber,this.yNumber,this.zNumber),this.setValue(t);var e=document.createEvent("Event");return e.initEvent("change",!0,!0),this.xNumber.onChange(function(){this.dom.dispatchEvent(e)}.bind(this)),this.yNumber.onChange(function(){this.dom.dispatchEvent(e)}.bind(this)),this.zNumber.onChange(function(){this.dom.dispatchEvent(e)}.bind(this)),this},s.Vector3.prototype=Object.create(s.Panel.prototype),s.Vector3.prototype.getValue=function(){return{x:this.xNumber.getValue(),y:this.yNumber.getValue(),z:this.zNumber.getValue()}},s.Vector3.prototype.setValue=function(t){return t&&(this.xNumber.setValue(t.x),this.yNumber.setValue(t.y),this.zNumber.setValue(t.z)),this},s.Vector3.prototype.setPrecision=function(t){return this.xNumber.setPrecision(t),this.yNumber.setPrecision(t),this.zNumber.setPrecision(t),this},s.Vector3.prototype.setRange=function(t,e){return this.xNumber.setRange(t,e),this.yNumber.setRange(t,e),this.zNumber.setRange(t,e),this},s.SelectionInput=function(t){if(s.AdaptiveTextArea.call(this),this.setSpellcheck(!1),"selection"!==t.type)return r.error("UI.SelectionInput: not a selection",t),this;this.setValue(t.string),this.selection=t;var e=this;return t.signals.stringChanged.add((function(t){e.setValue(t)})),this.onEnter(),this},s.SelectionInput.prototype=Object.create(s.AdaptiveTextArea.prototype),s.SelectionInput.prototype.setValue=function(t){return s.AdaptiveTextArea.prototype.setValue.call(this,t),this},s.SelectionInput.prototype.onEnter=function(t){var e=this,n=function(t){return!new r.Selection(t).selection.error};return this.onKeyPress((function(i){var r=e.getValue(),s=String.fromCharCode(i.which);13===i.keyCode?(i.preventDefault(),n(r)?("function"==typeof t?t(r):e.selection.setString(r),e.setBackgroundColor("white")):e.setBackgroundColor("tomato")):e.selection.string!==r+s?e.setBackgroundColor("skyblue"):e.setBackgroundColor("white")})),this.onKeyUp((function(t){var i=e.getValue();n(i)?e.selection.string===e.getValue()?e.setBackgroundColor("white"):e.setBackgroundColor("skyblue"):e.setBackgroundColor("tomato")})),this},s.SelectionPanel=function(t){return s.Panel.call(this),this.icon=new s.Icon("filter").setTitle("filter selection").addClass("lg").setMarginRight("10px"),this.input=new s.SelectionInput(t),this.add(this.icon,this.input),this},s.SelectionPanel.prototype=Object.create(s.Panel.prototype),s.SelectionPanel.prototype.setInputWidth=function(t){return this.input.setWidth(t),this},s.ComponentPanel=function(t){s.Panel.call(this);var e=t.stage,n=t.signals;n.nameChanged.add((function(t){i.setValue(t)})),n.visibilityChanged.add((function(t){r.setValue(t)})),n.disposed.add((function(){l.dispose()}));var i=new s.EllipsisText(t.name).setWidth("100px"),r=new s.ToggleIcon(t.visible,"eye","eye-slash").setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick((function(){t.setVisibility(!t.visible)})),o=new s.Icon("bullseye").setTitle("center").setCursor("pointer").setMarginLeft("10px").onClick((function(){t.autoView(1e3)})),a=(new s.DisposeIcon).setMarginLeft("10px").setDisposeFunction((function(){e.removeComponent(t)})),l=new s.PopupMenu("bars",t.type).setMarginLeft("46px").setEntryLabelWidth("110px");return this.add(i,r,o,a,l),this.menu=l,this},s.ComponentPanel.prototype=Object.create(s.Panel.prototype),s.ComponentPanel.prototype.addMenuEntry=function(t,e){return this.menu.addEntry(t,e),this},s.ComponentPanel.prototype.setMenuDisplay=function(t){return this.menu.setMenuDisplay(t),this},t.exports={UI:s}},7412:function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))},Jupyter;Object.defineProperty(exports,"__esModule",{value:!0}),exports.NGLView=exports.NGLModel=void 0;var widgets=__webpack_require__(2055),NGL=__webpack_require__(485),BaseView=__webpack_require__(2555).BaseView;const $=__webpack_require__(1929),_=__webpack_require__(431);__webpack_require__(1147),__webpack_require__(3199),__webpack_require__(4197),__webpack_require__(6237),__webpack_require__(6870),__webpack_require__(4374),__webpack_require__(9446);const gui_1=__webpack_require__(5587),fullscreen_1=__webpack_require__(6219),color_1=__webpack_require__(5211),theme_1=__webpack_require__(4649);NGL.nglview_debug=!1;const chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid=new Array(36);function generateUUID(){let t,e=0;for(let n=0;n<36;n++)8===n||13===n||18===n||23===n?uuid[n]="-":14===n?uuid[n]="4":(e<=2&&(e=33554432+16777216*Math.random()|0),t=15&e,e>>=4,uuid[n]=chars[19===n?3&t|8:t]);return uuid.join("")}function createView(t,e){return __awaiter(this,void 0,void 0,(function*(){console.log("Creating view for model "+e);var n=t.model.widget_manager,i=t.model.get(e).replace("IPY_MODEL_","");return yield n.create_view(yield n.get_model(i))}))}class NGLModel extends widgets.DOMWidgetModel{defaults(){return _.extend(widgets.DOMWidgetModel.prototype.defaults(),{_model_name:"NGLModel",_model_module:"nglview-js-widgets",_model_module_version:__webpack_require__(8330).version,_view_name:"NGLView",_view_module:"nglview-js-widgets",_view_module_version:__webpack_require__(8330).version})}}exports.NGLModel=NGLModel;class NGLView extends widgets.DOMWidgetView{render(){this.beforeDisplay(),this.displayed.then(function(){this.createStage(),this.handlePicking(),this.handleSignals(),this.handleMessage(),this.finalizeDisplay()}.bind(this))}beforeDisplay(){this.model.on("change:_parameters",this.parametersChanged,this),this.model.on("change:gui_style",this.GUIStyleChanged,this),this.model.set("_ngl_version",NGL.Version),this._ngl_focused=0,this.uuid=generateUUID(),this.stage_widget=void 0,this.comp_uuids=[],this._synced_model_ids=this.model.get("_synced_model_ids"),this._synced_repr_model_ids=this.model.get("_synced_repr_model_ids"),this.isEmbeded()&&this._handleEmbedBeforeStage()}createStage(){var t=Object.assign({},this.model.get("_ngl_full_stage_parameters"));"backgroundColor"in t||(t.backgroundColor="white"),NGL.useWorker=!1,this.options.parent,this.stage=new NGL.Stage(void 0),this.$container=$(this.stage.viewer.container),this.$el.append(this.$container),this.stage.setParameters(t),this.$container=$(this.stage.viewer.container),this.handleResizable(),this.ngl_view_id=this.uuid,this.touch();var e=this.model.get("_view_width")||this.$el.parent().width()+"px",n=this.model.get("_view_height")||"300px";this.setSize(e,n),this.createFullscreenBtn(),this.createIPlayer(),this.GUIStyleChanged(),this.$container.resizable("option","maxWidth",this.$el.parent().width()),this.isEmbeded()?(console.log("Embed mode for NGLView"),this.handleEmbed()):(this.requestUpdateStageParameters(),1==this.model.views.length?this.serialize_camera_orientation():this.set_camera_orientation(this.model.get("_camera_orientation")))}isEmbeded(){return this.model.get("_ngl_serialize")||null==this.model.comm}handleMessage(){this.model.on("msg:custom",(function(t){this.on_msg(t)}),this),this.model.comm&&this.model.comm.on_msg(function(t){var e=t.buffers,n=t.content.data.content;e.length&&n&&(n.buffers=e),this.model._handle_comm_msg.call(this.model,t)}.bind(this))}finalizeDisplay(){this.send({type:"request_loaded",data:!0});var t=this.stage.getParameters();this.model.set("_ngl_original_stage_parameters",t),this.touch(),!this.isEmbeded()&&this.stage.compList.length<this.model.get("n_components")&&this.handleEmbed();var e=this.model.get("_ngl_view_id");e.push(this.ngl_view_id),this.send({type:"updateIDs",data:e})}handleSignals(){var t=this.stage.viewer.container,e=this;t.addEventListener("mouseover",(function(t){e._ngl_focused=1,e.mouseOverDisplay("block")}),!1),t.addEventListener("mouseout",(function(t){e._ngl_focused=0,e.mouseOverDisplay("none")}),!1),t.addEventListener("contextmenu",(function(t){t.stopPropagation(),t.preventDefault()}),!0),this.stage.signals.componentAdded.add((function(t){this.comp_uuids.push(t.uuid);var n=this.stage.compList.length;this.model.set("n_components",n),this.touch();var i=this.stage.compList[n-1];i.signals.representationRemoved.add((function(){e.request_repr_dict()})),i.signals.representationAdded.add((function(t){e.request_repr_dict(),t.signals.parametersChanged.add((function(){console.log("repr.parametersChanged"),e.request_repr_dict()}))}))}),this),this.stage.signals.componentRemoved.add((function(t){return __awaiter(this,void 0,void 0,(function*(){var e=this.comp_uuids.indexOf(t.uuid);this.comp_uuids.splice(e,1);var n=this.stage.compList.length;this.model.set("n_components",n),this.touch(),console.log("componentRemoved",t,t.uuid);var i=[];for(var r in this.model.views)i.push(this.model.views[r]);var s=yield Promise.all(i);console.log(s);var o=!1;for(var r in s){var a=s[r];a.uuid!=this.uuid&&a.stage.compList.length>n&&(a.stage.removeComponent(a.stage.compList[e]),o=!0)}o&&(console.log("should update backend"),this.send({type:"removeComponent",data:e}))}))}),this),this.stage.signals.parametersChanged.add((function(){this.requestUpdateStageParameters()}),this),this.stage.viewerControls.signals.changed.add(function(){this.serialize_camera_orientation();var t=this.stage.viewerControls.getOrientation();e._synced_model_ids.length>0&&1==e._ngl_focused&&e._synced_model_ids.forEach((function(n){return __awaiter(this,void 0,void 0,(function*(){var i=yield e.model.widget_manager.get_model(n);for(var r in i.views){i.views[r];var s=yield i.views[r];s.uuid!=e.uuid&&s.stage.viewerControls.orient(t)}}))}))}.bind(this))}handlePicking(){this.$pickingInfo=$("<div></div>").css("position","absolute").css("top","5%").css("left","3%").css("background-color","white").css("padding","2px 5px 2px 5px").css("opacity","0.7").appendTo(this.$container),this.stage.signals.clicked.add((function(t){if(t){this.model.set("picked",{}),this.touch();var e={},n="";t.atom?(e.atom1=t.atom.toObject(),e.atom1.name=t.atom.qualifiedName(),n="Atom: "+e.atom1.name):t.bond&&(e.bond=t.bond.toObject(),e.atom1=t.bond.atom1.toObject(),e.atom1.name=t.bond.atom1.qualifiedName(),e.atom2=t.bond.atom2.toObject(),e.atom2.name=t.bond.atom2.qualifiedName(),n="Bond: "+e.atom1.name+" - "+e.atom2.name),t.instance&&(e.instance=t.instance);for(var i=this.stage.compList.length,r=0;r<i;r++)this.stage.compList[r].uuid==t.component.uuid&&(e.component=r);this.model.set("picked",e),this.touch(),this.$pickingInfo.text(n)}}),this)}mouseOverDisplay(t){return __awaiter(this,void 0,void 0,(function*(){var e=this;if(this.btn_pview_fullscreen){var n=yield this.btn_pview_fullscreen;n.el.style.display=t,e.stage_widget&&(n.el.style.display="none")}if(e=this,this.player_pview){var i=yield this.player_pview;i.el.style.display=t,e.model.get("max_frame")&&0!=e.model.get("max_frame")||(i.el.style.display="none")}}))}updateNGLTheme(t){var e=document.getElementById("nglview_style");null!=e&&document.head.removeChild(e);var n=document.createElement("style");n.id="nglview_style",n.type="text/css",n.appendChild(document.createTextNode(t)),document.head.appendChild(n)}serialize_camera_orientation(){var t=this.stage.viewerControls.getOrientation();this.model.set("_camera_orientation",t.elements),this.touch()}set_camera_orientation(t){t.length>0&&(this.stage.viewerControls.orient(t),this.serialize_camera_orientation())}executeCode(code){eval(code)}_handleEmbedBeforeStage(){var t,e=this.model.get("_ngl_color_dict");for(t in e)NGL.ColormakerRegistry.hasScheme(t)||this.addColorScheme(e[t],t)}handleEmbed(){return __awaiter(this,void 0,void 0,(function*(){var t=this,e=t.model.get("_ngl_msg_archive"),n=t.model.get("_ngl_full_stage_parameters");const i=t.model.get("_camera_orientation");if(0!==Object.keys(n).length||0!==i.length){var r=[];if(_.each(e,(function(e){"loadFile"==e.methodName&&(e.kwargs&&e.kwargs.defaultRepresentation&&(e.kwargs.defaultRepresentation=!1),r.push(t._getLoadFilePromise(e)))})),yield Promise.all(r),t.stage.setParameters(n),t.set_camera_orientation(i),t.touch(),void 0===t.model.comm){var s=t.model.get("_ngl_coordinate_resource"),o=s.n_frames||1;t.model.set("max_frame",o-1),t.touch();var a=(yield t.getPlayerModel()).get("children")[0];t.listenTo(a,"change:value",(function(){t.updateCoordinatesFromDict(s,a.get("value"))}))}for(const e of t.model.get("_ngl_msg_archive"))e.fire_embed&&(yield t.on_msg(e));t._set_representation_from_repr_dict(t.model.get("_ngl_repr_dict")),t.handleResize()}else{console.log("No state stored; initializing embedded widget for the first time.");for(const n of e)yield t.on_msg(n)}}))}updateCoordinatesFromDict(t,e){for(var n=Object.keys(t).filter((t=>"n_frames"!==t)),i=0;i<n.length;i++){var r=n[i],s=this.decode_base64(t[r][e]);s&&s.byteLength>0&&this.updateCoordinates(s,r)}}requestFrame(){this.send({type:"request_frame",data:"frame"})}requestUpdateStageParameters(){var t=this.stage.getParameters();this.model.set("_ngl_full_stage_parameters",t),this.touch()}requestReprParameters(t,e){var n=this.stage.compList[t].reprList[e],i=n.repr.getParameters();i&&(i.name=n.name,this.send({type:"repr_parameters",data:i}))}request_repr_dict(){var t=this.getReprDictFrontEnd();this.send({type:"request_repr_dict",data:t});var e=this;e._synced_repr_model_ids.length>0&&e._synced_repr_model_ids.forEach((function(n){return __awaiter(this,void 0,void 0,(function*(){var i=yield e.model.widget_manager.get_model(n);for(var r in i.views){var s=yield i.views[r];s.uuid!=e.uuid&&s._set_representation_from_repr_dict(t)}}))}))}getReprDictFrontEnd(){for(var t={},e=this.stage.compList.length,n=0;n<e;n++){var i=this.stage.compList[n];t[n]={};for(var r=t[n],s=0;s<i.reprList.length;s++){var o=i.reprList[s];r[s]={},r[s].type=o.name,r[s].params=o.repr.getParameters()}}return t}syncReprForAllViews(){var t=this.model.get("_ngl_repr_dict"),e=this.getReprDictFrontEnd();JSON.stringify(e)!==JSON.stringify(t)&&this._set_representation_from_repr_dict(t)}syncReprWithMe(){return __awaiter(this,void 0,void 0,(function*(){var t=this.getReprDictFrontEnd();for(var e in this.model.views){var n=yield this.model.views[e];n.uuid!=this.uuid&&n._set_representation_from_repr_dict(t)}this.request_repr_dict()}))}setSyncRepr(t){this._synced_repr_model_ids=t}setSyncCamera(t){this._synced_model_ids=t}viewXZPlane(){var t=(new NGL.Matrix4).makeRotationX(Math.PI/2),e=(new NGL.Quaternion).setFromRotationMatrix(t);this.stage.viewerControls.rotate(e)}set_representation_from_backend(){var t=this.model.get("_ngl_repr_dict");this._set_representation_from_repr_dict(t)}_set_representation_from_repr_dict(t){var e=this.stage.compList;if(e.length>0)for(var n in t){var i=e[n];i.removeAllRepresentations();var r=t[n];for(var s in r){var o=r[s];o&&i.addRepresentation(o.type,o.params)}}}createView(t){return __awaiter(this,void 0,void 0,(function*(){console.log("Creating view for model "+t);var e=this.model.widget_manager,n=this.model.get(t).replace("IPY_MODEL_","");return yield e.create_view(yield e.get_model(n))}))}getPlayerModel(){var t=this.model.get("_iplayer").replace("IPY_MODEL_","");return this.model.widget_manager.get_model(t)}createIPlayer(){return __awaiter(this,void 0,void 0,(function*(){this.player_pview=this.createView("_iplayer");var t=yield this.player_pview,e=t.el;e.style.position="absolute",e.style.zIndex=100,e.style.bottom="5%",e.style.left="10%",e.style.opacity="0.7",this.stage.viewer.container.append(t.el),e.style.display="none"}))}createImageBtn(){return __awaiter(this,void 0,void 0,(function*(){this.image_btn_pview=this.createView("_ibtn_image");var t=yield this.image_btn_pview,e=t.el;e.style.position="absolute",e.style.zIndex=100,e.style.top="5%",e.style.right="10%",e.style.opacity="0.7",e.style.width="35px",this.stage.viewer.container.append(t.el)}))}createFullscreenBtn(){return __awaiter(this,void 0,void 0,(function*(){this.btn_pview_fullscreen=this.createView("_ibtn_fullscreen");var t=yield this.btn_pview_fullscreen,e=this.stage,n=t.el;n.style.position="absolute",n.style.zIndex=100,n.style.top="5%",n.style.right="5%",n.style.opacity="0.7",n.style.width="35px",n.style.background="white",n.style.opacity="0.3",n.style.display="none",n.onclick=function(){this.stage.toggleFullscreen()}.bind(this),e.viewer.container.append(t.el),e.signals.fullscreenChanged.add((function(e){e?t.model.set("icon","compress"):t.model.set("icon","expand")}))}))}createGUI(){return __awaiter(this,void 0,void 0,(function*(){this.pgui_view=this.createView("_igui");var t=yield this.pgui_view,e=t.el;e.style.position="absolute",e.style.zIndex=100,e.style.top="5%",e.style.right="10%",e.style.width="300px",this.stage.viewer.container.append(t.el)}))}createNglGUI(){this.stage_widget=new gui_1.StageWidget(this)}setVisibilityForRepr(t,e,n){var i=this.stage.compList[t].reprList[e];i&&i.setVisibility(n)}removeRepresentation(t,e){var n=this.stage.compList[t],i=n.reprList[e];i&&n.removeRepresentation(i)}removeRepresentationsByName(t,e){var n=this.stage.compList[e];n&&n.reprList.forEach((function(e){e.name==t&&n.removeRepresentation(e)}))}updateRepresentationForComponent(t,e,n){var i=this.stage.compList[e].reprList[t];i&&i.setParameters(n)}updateRepresentationsByName(t,e,n){var i=this.stage.compList[e],r=this;i&&i.reprList.forEach((function(e){e.name==t&&(e.setParameters(n),r.request_repr_dict())}))}setRepresentation(t,e,n,i){var r=this.stage.compList[n],s=r.reprList[i];if(s){e.useWorker=!1;var o=NGL.makeRepresentation(t,r.structure,this.stage.viewer,e);o&&(s.setRepresentation(o),s.name=t,r.reprList[i]=s,this.request_repr_dict())}}setColorByResidue(t,e,n){var i=this.stage.compList[e].reprList[n],r=NGL.ColormakerRegistry.addScheme((function(e){this.atomColor=function(e){return t[e.residueIndex]}}));i.setColor(r)}addShape(t,e){for(var n=new NGL.Shape(t),i={sphere:n.addSphere,ellipsoid:n.addEllipsoid,cylinder:n.addCylinder,cone:n.addCone,mesh:n.addMesh,arrow:n.addArrow,text:n.addText,label:n.addText,tetrahedron:n.addTetrahedron,octahedron:n.addOctahedron,torus:n.addTorus},r=0;r<e.length;r++){var s=e[r],o=s[0],a=s.slice(1,s.length);i[o].apply(n,a)}this.stage.addComponentFromObject(n).addRepresentation("buffer")}addBuffer(t,e){var n={arrow:NGL.ArrowBuffer,box:NGL.BoXbuffer,cone:NGL.ConeBuffer,cylinder:NGL.CylinderBuffer,ellipsoid:NGL.EllipsoidBuffer,octahedron:NGL.OctahedronBuffer,sphere:NGL.SphereBuffer,text:NGL.TextBuffer,tetrahedron:NGL.TetrahedronBuffer,torus:NGL.TorusBuffer},i={};for(var r in e)i[r]=new Float32Array(e[r]);var s=new NGL.Shape("shape"),o=new(0,n[t])(i);s.addBuffer(o),this.stage.addComponentFromObject(s).addRepresentation("buffer")}replaceStructure(t){return __awaiter(this,void 0,void 0,(function*(){var e=new Blob([t.data],{type:"text/plain"}),n=this.stage,i=t.params||{};i.ext=t.ext,i.defaultRepresentation=!1;var r=this.stage.compList[0],s=r.reprList.slice(),o=this.stage.viewerControls.getOrientation(),a=yield this.stage.loadFile(e,i);n.viewerControls.orient(o),s.forEach((function(t){var e=t.name,n=t.repr.getParameters();a.addRepresentation(e,n)})),n.removeComponent(r),this._handleLoadFileFinished()}))}superpose(t,e,n,i,r){var s=this.stage.compList[t];this.stage.compList[e].superpose(s,n,i,r)}decode_base64(t){var e,n,i,r,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(e=0;e<l;e+=4)n=o.indexOf(t[e]),i=o.indexOf(t[e+1]),r=o.indexOf(t[e+2]),s=o.indexOf(t[e+3]),h[c++]=n<<2|i>>4,h[c++]=(15&i)<<4|r>>2,h[c++]=(3&r)<<6|63&s;return u}updateCoordinates(t,e){var n=this.stage.compList[e];if(t&&n){var i=new Float32Array(t);n.structure.updatePosition(i),n.updateRepresentations({position:!0})}}handleResizable(){this.$container.resizable({resize:function(t,e){this.setSize(e.size.width+"px",e.size.height+"px")}.bind(this)})}handleResize(){var t=this.$el.width(),e=this.$el.height()+"px";this.stage_widget&&(t-=$(this.stage_widget.sidebar.dom).width()),t+="px",this.setSize(t,e)}setSize(t,e){this.stage.viewer.container.style.width=t,this.stage.viewer.container.style.height=e,this.stage.handleResize()}GUIStyleChanged(){if("ngl"===this.model.get("gui_style"))this.createNglGUI();else if(this.stage_widget){this.stage_widget.dispose(),this.stage_widget=void 0,this.$container.resizable("enable");var t=this.$el.parent().width()+"px",e=this.$el.parent().height()+"px";this.setSize(t,e)}}parametersChanged(){var t=this.model.get("_parameters");this.setParameters(t)}setParameters(t){this.stage.setParameters(t);var e=this.stage.getParameters();this.send({type:"stage_parameters",data:e})}_downloadImage(t,e){return __awaiter(this,void 0,void 0,(function*(){if(this.ngl_view_id==this.get_last_child_id()){var n=yield this.stage.makeImage(e);NGL.download(n,t)}}))}_exportImage(t,e){return __awaiter(this,void 0,void 0,(function*(){if(this.ngl_view_id==this.get_last_child_id()){var n,i=yield this.stage.makeImage(e),r=new FileReader;r.onload=function(){n=r.result.replace("data:image/png;base64,",""),this.send({data:n,type:"image_data",ID:t}),this.send({type:"async_message",data:"ok"})}.bind(this),r.readAsDataURL(i)}}))}handleMovieMaking(t){return __awaiter(this,void 0,void 0,(function*(){if(console.log("handleMovieMaking: render_params",t),this.ngl_view_id==this.get_last_child_id()){var e,n=yield this.stage.makeImage(t),i=new FileReader;i.onload=function(){e=i.result.replace("data:image/png;base64,",""),this.send({data:e,type:"movie_image_data"}),this.send({type:"async_message",data:"ok"})}.bind(this),i.readAsDataURL(n)}}))}_handleLoadFileFinished(){return __awaiter(this,void 0,void 0,(function*(){this.send({type:"async_message",data:"ok"})}))}_getLoadFilePromise(t){var e,n=t.args[0];if("blob"==n.type){var i;if(n.binary){var r=this.decode_base64(n.data);i=new Blob([r],{type:"application/octet-binary"})}else i=new Blob([n.data],{type:"text/plain"});return this.stage.loadFile(i,t.kwargs)}return new File([""],n.data),e=n.data,this.stage.loadFile(e,t.kwargs)}get_last_child_id(){var t=this.model.get("_ngl_view_id");return t[t.length-1]}_handleStageLoadFile(t){return __awaiter(this,void 0,void 0,(function*(){this.ngl_view_id!=this.get_last_child_id()&&t.last_child||(yield this._getLoadFilePromise(t),this._handleLoadFileFinished())}))}addColorScheme(t,e){var n=NGL.ColormakerRegistry.addSelectionScheme(t,e),i=NGL.ColormakerRegistry.userSchemes[n];return NGL.ColormakerRegistry.removeScheme(n),NGL.ColormakerRegistry.add(e,i),e}on_msg(t){return __awaiter(this,void 0,void 0,(function*(){"call_method"===t.type?yield this.handleCallMethod(t):"base64_single"===t.type?this.handleBase64Single(t.data):"binary_single"===t.type?this.handleBinarySingle(t):"movie_image_data"===t.type?this.handleMovieMaking(t.render_params):"get"===t.type&&this.handleGetRequest(t.data)}))}handleCallMethod(t){return __awaiter(this,void 0,void 0,(function*(){var e,n,i=t.args.slice();switch(i.push(t.kwargs),"addRepresentation"===t.methodName&&t.reconstruc_color_scheme&&(t.kwargs.color=this.addColorScheme(t.kwargs.color,t.kwargs.color_label)),"colorVolume"in t.kwargs&&(e=t.kwargs.colorVolume,t.kwargs.colorVolume=this.stage.compList[e].volume),t.target){case"Stage":yield this.handleStageMethod(t,i);break;case"Viewer":this.stage.viewer[t.methodName].apply(this.stage.viewer,i);break;case"viewerControls":this.stage.viewerControls[t.methodName].apply(this.stage.viewerControls,i);break;case"compList":(n=this.stage.compList[t.component_index])[t.methodName].apply(n,i);break;case"Widget":this[t.methodName].apply(this,i);break;case"Representation":var r=(n=this.stage.compList[t.component_index]).reprList[t.repr_index];r[t.methodName].apply(r,i);break;default:console.log("Unknown target: "+t.target)}}))}handleStageMethod(t,e){return __awaiter(this,void 0,void 0,(function*(){var n=this.stage[t.methodName];if("screenshot"===t.methodName)NGL.screenshot(this.stage.viewer,t.kwargs);else if("removeComponent"===t.methodName){var i=this.stage.compList[t.args[0]];this.stage.removeComponent(i)}else"loadFile"===t.methodName?(this.model.views.length>1&&t.kwargs&&t.kwargs.defaultRepresentation&&(t.kwargs.defaultRepresentation=!1),yield this._handleStageLoadFile(t)):n.apply(this.stage,e)}))}handleBase64Single(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var i=e[n],r=this.decode_base64(t[i]);r&&r.byteLength>0&&this.updateCoordinates(r,i)}}handleBinarySingle(t){for(var e=t.data,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],s=new Float32Array(t.buffers[i].buffer);s.byteLength>0&&this.updateCoordinates(s,r)}t.movie_making&&this.handleMovieMaking(t.render_params)}handleGetRequest(t){"camera"===t?this.send(JSON.stringify(this.stage.viewer.camera)):"parameters"===t?this.send(JSON.stringify(this.stage.parameters)):(console.log("Number of components",this.stage.compList.length),console.log("ngl_view_id",this.ngl_view_id))}}exports.NGLView=NGLView,module.exports={NGLView,NGLModel,NGL,FullscreenModel:fullscreen_1.FullscreenModel,FullscreenView:fullscreen_1.FullscreenView,ColormakerRegistryModel:color_1.ColormakerRegistryModel,ColormakerRegistryView:color_1.ColormakerRegistryView,ThemeManagerModel:theme_1.ThemeManagerModel,ThemeManagerView:theme_1.ThemeManagerView}},9894:function(t,e,n){var i;t=n.nmd(t),function(){var n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C,E,T,P,I,R,k,D,L,O,N,F,B,U,z,V,H,G,$,j,W,q,X,Y,K,Z,Q,J,tt,et,nt,it,rt,st,ot,at,lt,ct,ut,ht,dt,pt,ft,mt,gt,_t,vt,yt,bt,xt,wt,St,At,Mt,Ct,Et,Tt,Pt=[].slice;At=function(){var t,e,n,i,r;for(t={},i=0,e=(r="Boolean Number String Function Array Date RegExp Undefined Null".split(" ")).length;i<e;i++)n=r[i],t["[object "+n+"]"]=n.toLowerCase();return function(e){var n;return n=Object.prototype.toString.call(e),t[n]||"object"}}(),Y=function(t,e,n){return null==e&&(e=0),null==n&&(n=1),t<e&&(t=e),t>n&&(t=n),t},Mt=function(t){return t.length>=3?Array.prototype.slice.call(t):t[0]},S=function(t){var e,n;for(t._clipped=!1,t._unclipped=t.slice(0),e=n=0;n<3;e=++n)e<3?((t[e]<0||t[e]>255)&&(t._clipped=!0),t[e]<0&&(t[e]=0),t[e]>255&&(t[e]=255)):3===e&&(t[e]<0&&(t[e]=0),t[e]>1&&(t[e]=1));return t._clipped||delete t._unclipped,t},o=Math.PI,yt=Math.round,M=Math.cos,I=Math.floor,it=Math.pow,K=Math.log,xt=Math.sin,wt=Math.sqrt,g=Math.atan2,J=Math.max,m=Math.abs,c=2*o,a=o/3,r=o/180,l=180/o,w=function(){return arguments[0]instanceof n?arguments[0]:function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,arguments,(function(){}))},w.default=w,f=[],null!==t&&null!=t.exports&&(t.exports=w),void 0===(i=function(){return w}.apply(e,[]))||(t.exports=i),w.version="1.4.1",p={},h=[],d=!1,n=function(){function t(){var t,e,n,i,r,s,o,a,l;for(s=this,e=[],a=0,i=arguments.length;a<i;a++)null!=(t=arguments[a])&&e.push(t);if(e.length>1&&(o=e[e.length-1]),null!=p[o])s._rgb=S(p[o](Mt(e.slice(0,-1))));else{for(d||(h=h.sort((function(t,e){return e.p-t.p})),d=!0),l=0,r=h.length;l<r&&!(o=(n=h[l]).test.apply(n,e));l++);o&&(s._rgb=S(p[o].apply(p,e)))}null==s._rgb&&console.warn("unknown format: "+e),null==s._rgb&&(s._rgb=[0,0,0]),3===s._rgb.length&&s._rgb.push(1)}return t.prototype.toString=function(){return this.hex()},t}(),w._input=p,w.brewer=b={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var t,e;for(t in e=[],b)e.push(b[t.toLowerCase()]=b[t])}(),w.colors=Ct={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},$=function(){var t,e,n,i,r,o,a;return i=(e=Mt(arguments))[0],t=e[1],n=e[2],o=(i+16)/116,r=isNaN(t)?o:o+t/500,a=isNaN(n)?o:o-n/200,o=s.Yn*j(o),r=s.Xn*j(r),a=s.Zn*j(a),[Tt(3.2404542*r-1.5371385*o-.4985314*a),Tt(-.969266*r+1.8760108*o+.041556*a),n=Tt(.0556434*r-.2040259*o+1.0572252*a),e.length>3?e[3]:1]},Tt=function(t){return 255*(t<=.00304?12.92*t:1.055*it(t,1/2.4)-.055)},j=function(t){return t>s.t1?t*t*t:s.t2*(t-s.t0)},s={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},ht=function(){var t,e,n,i,r,s,o;return n=(i=Mt(arguments))[0],e=i[1],t=i[2],s=(r=gt(n,e,t))[0],[116*(o=r[1])-16,500*(s-o),200*(o-r[2])]},_t=function(t){return(t/=255)<=.04045?t/12.92:it((t+.055)/1.055,2.4)},Et=function(t){return t>s.t3?it(t,1/3):t/s.t2+s.t0},gt=function(){var t,e,n,i;return n=(i=Mt(arguments))[0],e=i[1],t=i[2],n=_t(n),e=_t(e),t=_t(t),[Et((.4124564*n+.3575761*e+.1804375*t)/s.Xn),Et((.2126729*n+.7151522*e+.072175*t)/s.Yn),Et((.0193339*n+.119192*e+.9503041*t)/s.Zn)]},w.lab=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["lab"]),(function(){}))},p.lab=$,n.prototype.lab=function(){return ht(this._rgb)},_=function(t){var e,n,i,r,s,o,a,l,c,u,h;return 2===(t=function(){var e,n,i;for(i=[],n=0,e=t.length;n<e;n++)r=t[n],i.push(w(r));return i}()).length?(c=function(){var e,n,i;for(i=[],n=0,e=t.length;n<e;n++)r=t[n],i.push(r.lab());return i}(),s=c[0],o=c[1],e=function(t){var e,n;return n=function(){var n,i;for(i=[],e=n=0;n<=2;e=++n)i.push(s[e]+t*(o[e]-s[e]));return i}(),w.lab.apply(w,n)}):3===t.length?(u=function(){var e,n,i;for(i=[],n=0,e=t.length;n<e;n++)r=t[n],i.push(r.lab());return i}(),s=u[0],o=u[1],a=u[2],e=function(t){var e,n;return n=function(){var n,i;for(i=[],e=n=0;n<=2;e=++n)i.push((1-t)*(1-t)*s[e]+2*(1-t)*t*o[e]+t*t*a[e]);return i}(),w.lab.apply(w,n)}):4===t.length?(h=function(){var e,n,i;for(i=[],n=0,e=t.length;n<e;n++)r=t[n],i.push(r.lab());return i}(),s=h[0],o=h[1],a=h[2],l=h[3],e=function(t){var e,n;return n=function(){var n,i;for(i=[],e=n=0;n<=2;e=++n)i.push((1-t)*(1-t)*(1-t)*s[e]+3*(1-t)*(1-t)*t*o[e]+3*(1-t)*t*t*a[e]+t*t*t*l[e]);return i}(),w.lab.apply(w,n)}):5===t.length&&(n=_(t.slice(0,3)),i=_(t.slice(2,5)),e=function(t){return t<.5?n(2*t):i(2*(t-.5))}),e},w.bezier=function(t){var e;return(e=_(t)).scale=function(){return w.scale(e)},e},w.cubehelix=function(t,e,n,i,r){var s,o,a;return null==t&&(t=300),null==e&&(e=-1.5),null==n&&(n=1),null==i&&(i=1),null==r&&(r=[0,1]),s=0,"array"===At(r)?o=r[1]-r[0]:(o=0,r=[r,r]),(a=function(a){var l,u,h,d,p;return l=c*((t+120)/360+e*a),d=it(r[0]+o*a,i),u=(0!==s?n[0]+a*s:n)*d*(1-d)/2,h=M(l),p=xt(l),w(S([255*(d+u*(-.14861*h+1.78277*p)),255*(d+u*(-.29227*h-.90649*p)),255*(d+u*(1.97294*h)),1]))}).start=function(e){return null==e?t:(t=e,a)},a.rotations=function(t){return null==t?e:(e=t,a)},a.gamma=function(t){return null==t?i:(i=t,a)},a.hue=function(t){return null==t?n:("array"===At(n=t)?0==(s=n[1]-n[0])&&(n=n[1]):s=0,a)},a.lightness=function(t){return null==t?r:("array"===At(t)?(r=t,o=t[1]-t[0]):(r=[t,t],o=0),a)},a.scale=function(){return w.scale(a)},a.hue(n),a},w.random=function(){var t,e;for(t="#",e=0;e<6;++e)t+="0123456789abcdef".charAt(I(16*Math.random()));return new n(t)},f=[],F=function(t,e,n,i){var r,s,o,a;for(null==n&&(n=.5),null==i&&(i="rgb"),"object"!==At(t)&&(t=w(t)),"object"!==At(e)&&(e=w(e)),o=0,s=f.length;o<s;o++)if(i===(r=f[o])[0]){a=r[1](t,e,n,i);break}if(null==a)throw"color mode "+i+" is not supported";return a.alpha(t.alpha()+n*(e.alpha()-t.alpha()))},w.interpolate=F,n.prototype.interpolate=function(t,e,n){return F(this,t,e,n)},w.mix=F,n.prototype.mix=n.prototype.interpolate,p.rgb=function(){var t,e,n,i;for(t in n=[],e=Mt(arguments))i=e[t],n.push(i);return n},w.rgb=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["rgb"]),(function(){}))},n.prototype.rgb=function(t){return null==t&&(t=!0),t?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},n.prototype.rgba=function(t){return null==t&&(t=!0),t?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},h.push({p:3,test:function(t){var e;return e=Mt(arguments),"array"===At(e)&&3===e.length||4===e.length&&"number"===At(e[3])&&e[3]>=0&&e[3]<=1?"rgb":void 0}}),p.lrgb=p.rgb,z=function(t,e,i,r){var s,o;return s=t._rgb,o=e._rgb,new n(wt(it(s[0],2)*(1-i)+it(o[0],2)*i),wt(it(s[1],2)*(1-i)+it(o[1],2)*i),wt(it(s[2],2)*(1-i)+it(o[2],2)*i),r)},u=function(t){var e,i,r,s,o;for(e=1/t.length,o=[0,0,0,0],r=0,i=t.length;r<i;r++)s=t[r]._rgb,o[0]+=it(s[0],2)*e,o[1]+=it(s[1],2)*e,o[2]+=it(s[2],2)*e,o[3]+=s[3]*e;return o[0]=wt(o[0]),o[1]=wt(o[1]),o[2]=wt(o[2]),o[3]>1&&(o[3]=1),new n(S(o))},f.push(["lrgb",z]),w.average=function(t,e){var n,i,r,s,a,l,c,h,d,p,f,m,_;if(null==e&&(e="rgb"),d=t.length,t=t.map((function(t){return w(t)})),c=t.splice(0,1)[0],"lrgb"===e)return u(t);for(h in s=[],a=0,l=0,m=c.get(e))m[h]=m[h]||0,s.push(isNaN(m[h])?0:1),"h"!==e.charAt(h)||isNaN(m[h])||(n=m[h]/180*o,a+=M(n),l+=xt(n));for(i=c.alpha(),f=0,p=t.length;f<p;f++)for(h in _=(r=t[f]).get(e),i+=r.alpha(),m)isNaN(_[h])||(s[h]+=1,"h"===e.charAt(h)?(n=_[h]/180*o,a+=M(n),l+=xt(n)):m[h]+=_[h]);for(h in m)if("h"===e.charAt(h)){for(n=g(l/s[h],a/s[h])/o*180;n<0;)n+=360;for(;n>=360;)n-=360;m[h]=n}else m[h]=m[h]/s[h];return w(m,e).alpha(i/d)},k=function(t){var e,n;if(t.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return 4!==t.length&&7!==t.length||(t=t.substr(1)),3===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]),[(n=parseInt(t,16))>>16,n>>8&255,255&n,1];if(t.match(/^#?([A-Fa-f0-9]{8})$/))return 9===t.length&&(t=t.substr(1)),[(n=parseInt(t,16))>>24&255,n>>16&255,n>>8&255,yt((255&n)/255*100)/100];if(null!=p.css&&(e=p.css(t)))return e;throw"unknown color: "+t},at=function(t,e){var n,i,r,s,o,a;return null==e&&(e="auto"),o=t[0],r=t[1],i=t[2],n=t[3],"auto"===e&&(e=n<1?"rgba":"rgb"),o=Math.round(o),r=Math.round(r),i=Math.round(i),a=(a="000000"+(o<<16|r<<8|i).toString(16)).substr(a.length-6),s=(s="0"+yt(255*n).toString(16)).substr(s.length-2),"#"+function(){switch(e.toLowerCase()){case"rgba":return a+s;case"argb":return s+a;default:return a}}()},p.hex=function(t){return k(t)},w.hex=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["hex"]),(function(){}))},n.prototype.hex=function(t){return null==t&&(t="auto"),at(this._rgb,t)},h.push({p:4,test:function(t){if(1===arguments.length&&"string"===At(t))return"hex"}}),O=function(){var t,e,n,i,r,s,o,a,l,c,u,h,d,p;if(r=(t=Mt(arguments))[0],u=t[1],o=t[2],0===u)l=i=e=255*o;else{for(n=[0,0,0],h=2*o-(d=o<.5?o*(1+u):o+u-o*u),(p=[0,0,0])[0]=(r/=360)+1/3,p[1]=r,p[2]=r-1/3,s=a=0;a<=2;s=++a)p[s]<0&&(p[s]+=1),p[s]>1&&(p[s]-=1),6*p[s]<1?n[s]=h+6*(d-h)*p[s]:2*p[s]<1?n[s]=d:3*p[s]<2?n[s]=h+(d-h)*(2/3-p[s])*6:n[s]=h;l=(c=[yt(255*n[0]),yt(255*n[1]),yt(255*n[2])])[0],i=c[1],e=c[2]}return t.length>3?[l,i,e,t[3]]:[l,i,e]},ct=function(t,e,n){var i,r,s,o,a;return void 0!==t&&t.length>=3&&(t=(o=t)[0],e=o[1],n=o[2]),t/=255,e/=255,n/=255,s=Math.min(t,e,n),r=((J=Math.max(t,e,n))+s)/2,J===s?(a=0,i=Number.NaN):a=r<.5?(J-s)/(J+s):(J-s)/(2-J-s),t===J?i=(e-n)/(J-s):e===J?i=2+(n-t)/(J-s):n===J&&(i=4+(t-e)/(J-s)),(i*=60)<0&&(i+=360),[i,a,r]},w.hsl=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["hsl"]),(function(){}))},p.hsl=O,n.prototype.hsl=function(){return ct(this._rgb)},N=function(){var t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_;if(r=(t=Mt(arguments))[0],m=t[1],_=t[2],_*=255,0===m)l=i=e=_;else switch(360===r&&(r=0),r>360&&(r-=360),r<0&&(r+=360),o=_*(1-m),a=_*(1-m*(n=(r/=60)-(s=I(r)))),g=_*(1-m*(1-n)),s){case 0:l=(c=[_,g,o])[0],i=c[1],e=c[2];break;case 1:l=(u=[a,_,o])[0],i=u[1],e=u[2];break;case 2:l=(h=[o,_,g])[0],i=h[1],e=h[2];break;case 3:l=(d=[o,a,_])[0],i=d[1],e=d[2];break;case 4:l=(p=[g,o,_])[0],i=p[1],e=p[2];break;case 5:l=(f=[_,o,a])[0],i=f[1],e=f[2]}return[l,i,e,t.length>3?t[3]:1]},ut=function(){var t,e,n,i,r,s,o,a,l;return s=(o=Mt(arguments))[0],n=o[1],t=o[2],r=Math.min(s,n,t),e=(J=Math.max(s,n,t))-r,l=J/255,0===J?(i=Number.NaN,a=0):(a=e/J,s===J&&(i=(n-t)/e),n===J&&(i=2+(t-s)/e),t===J&&(i=4+(s-n)/e),(i*=60)<0&&(i+=360)),[i,a,l]},w.hsv=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["hsv"]),(function(){}))},p.hsv=N,n.prototype.hsv=function(){return ut(this._rgb)},et=function(t){return"number"===At(t)&&t>=0&&t<=16777215?[t>>16,t>>8&255,255&t,1]:(console.warn("unknown num color: "+t),[0,0,0,1])},ft=function(){var t;return((t=Mt(arguments))[0]<<16)+(t[1]<<8)+t[2]},w.num=function(t){return new n(t,"num")},n.prototype.num=function(t){return null==t&&(t="rgb"),ft(this._rgb,t)},p.num=et,h.push({p:1,test:function(t){if(1===arguments.length&&"number"===At(t)&&t>=0&&t<=16777215)return"num"}}),R=function(){var t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y;if(a=(n=Mt(arguments))[0],r=n[1],e=n[2],o=o/100*255,t=255*(r/=100),0===r)h=o=i=e;else switch(360===a&&(a=0),a>360&&(a-=360),a<0&&(a+=360),u=(c=e*(1-r))+t*(1-(s=(a/=60)-(l=I(a)))),v=c+t*s,y=c+t,l){case 0:h=(d=[y,v,c])[0],o=d[1],i=d[2];break;case 1:h=(p=[u,y,c])[0],o=p[1],i=p[2];break;case 2:h=(f=[c,y,v])[0],o=f[1],i=f[2];break;case 3:h=(m=[c,u,y])[0],o=m[1],i=m[2];break;case 4:h=(g=[v,c,y])[0],o=g[1],i=g[2];break;case 5:h=(_=[y,c,u])[0],o=_[1],i=_[2]}return[h,o,i,n.length>3?n[3]:1]},ot=function(){var t,e,n,i,r,s,o,a,l;return a=(l=Mt(arguments))[0],r=l[1],e=l[2],o=Math.min(a,r,e),n=100*(i=(J=Math.max(a,r,e))-o)/255,t=o/(255-i)*100,0===i?s=Number.NaN:(a===J&&(s=(r-e)/i),r===J&&(s=2+(e-a)/i),e===J&&(s=4+(a-r)/i),(s*=60)<0&&(s+=360)),[s,n,t]},w.hcg=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["hcg"]),(function(){}))},p.hcg=R,n.prototype.hcg=function(){return ot(this._rgb)},C=function(t){var e,n,i,r,s,o,a,l;if(t=t.toLowerCase(),null!=w.colors&&w.colors[t])return k(w.colors[t]);if(s=t.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(a=s.slice(1,4),r=o=0;o<=2;r=++o)a[r]=+a[r];a[3]=1}else if(s=t.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(a=s.slice(1,5),r=l=0;l<=3;r=++l)a[r]=+a[r];else if(s=t.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(a=s.slice(1,4),r=e=0;e<=2;r=++e)a[r]=yt(2.55*a[r]);a[3]=1}else if(s=t.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(a=s.slice(1,5),r=n=0;n<=2;r=++n)a[r]=yt(2.55*a[r]);a[3]=+a[3]}else(s=t.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?((i=s.slice(1,4))[1]*=.01,i[2]*=.01,(a=O(i))[3]=1):(s=t.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&((i=s.slice(1,4))[1]*=.01,i[2]*=.01,(a=O(i))[3]=+s[4]);return a},st=function(t){var e;return"rgb"==(e=t[3]<1?"rgba":"rgb")?e+"("+t.slice(0,3).map(yt).join(",")+")":"rgba"===e?e+"("+t.slice(0,3).map(yt).join(",")+","+t[3]+")":void 0},vt=function(t){return yt(100*t)/100},L=function(t,e){var n;return n=e<1?"hsla":"hsl",t[0]=vt(t[0]||0),t[1]=vt(100*t[1])+"%",t[2]=vt(100*t[2])+"%","hsla"===n&&(t[3]=e),n+"("+t.join(",")+")"},p.css=function(t){return C(t)},w.css=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["css"]),(function(){}))},n.prototype.css=function(t){return null==t&&(t="rgb"),"rgb"===t.slice(0,3)?st(this._rgb):"hsl"===t.slice(0,3)?L(this.hsl(),this.alpha()):void 0},p.named=function(t){return k(Ct[t])},h.push({p:5,test:function(t){if(1===arguments.length&&null!=Ct[t])return"named"}}),n.prototype.name=function(t){var e,n;for(n in arguments.length&&(Ct[t]&&(this._rgb=k(Ct[t])),this._rgb[3]=1),e=this.hex("rgb"),Ct)if(e===Ct[n])return n;return e},W=function(){var t,e,n,i;return n=(i=Mt(arguments))[0],t=i[1],e=i[2],[n,M(e*=r)*t,xt(e)*t]},q=function(){var t,e,n,i,r,s,o,a,l;return o=(n=Mt(arguments))[0],r=n[1],s=n[2],t=(a=W(o,r,s))[0],e=a[1],i=a[2],[(l=$(t,e,i))[0],l[1],i=l[2],n.length>3?n[3]:1]},G=function(){var t,e,n,i,r,s;return r=(s=Mt(arguments))[0],t=s[1],e=s[2],n=wt(t*t+e*e),i=(g(e,t)*l+360)%360,0===yt(1e4*n)&&(i=Number.NaN),[r,n,i]},dt=function(){var t,e,n,i,r,s,o;return r=(s=Mt(arguments))[0],n=s[1],e=s[2],i=(o=ht(r,n,e))[0],t=o[1],e=o[2],G(i,t,e)},w.lch=function(){var t;return t=Mt(arguments),new n(t,"lch")},w.hcl=function(){var t;return t=Mt(arguments),new n(t,"hcl")},p.lch=q,p.hcl=function(){var t,e,n,i;return e=(i=Mt(arguments))[0],t=i[1],n=i[2],q([n,t,e])},n.prototype.lch=function(){return dt(this._rgb)},n.prototype.hcl=function(){return dt(this._rgb).reverse()},rt=function(t){var e,n,i,r,s,o;return null==t&&(t="rgb"),s=(o=Mt(arguments))[0],i=o[1],e=o[2],i/=255,e/=255,[(1-(s/=255)-(r=1-Math.max(s,Math.max(i,e))))*(n=r<1?1/(1-r):0),(1-i-r)*n,(1-e-r)*n,r]},A=function(){var t,e,n,i,r,s;return n=(e=Mt(arguments))[0],r=e[1],s=e[2],i=e[3],t=e.length>4?e[4]:1,1===i?[0,0,0,t]:[n>=1?0:255*(1-n)*(1-i),r>=1?0:255*(1-r)*(1-i),s>=1?0:255*(1-s)*(1-i),t]},p.cmyk=function(){return A(Mt(arguments))},w.cmyk=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["cmyk"]),(function(){}))},n.prototype.cmyk=function(){return rt(this._rgb)},p.gl=function(){var t,e,n,i,r;for(i=function(){var t,n;for(e in n=[],t=Mt(arguments))r=t[e],n.push(r);return n}.apply(this,arguments),t=n=0;n<=2;t=++n)i[t]*=255;return i},w.gl=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["gl"]),(function(){}))},n.prototype.gl=function(){var t;return[(t=this._rgb)[0]/255,t[1]/255,t[2]/255,t[3]]},pt=function(t,e,n){var i;return t=(i=Mt(arguments))[0],e=i[1],n=i[2],.2126*(t=Z(t))+.7152*(e=Z(e))+.0722*Z(n)},Z=function(t){return(t/=255)<=.03928?t/12.92:it((t+.055)/1.055,2.4)},H=function(t,e,i,r){var s,o;return s=t._rgb,o=e._rgb,new n(s[0]+i*(o[0]-s[0]),s[1]+i*(o[1]-s[1]),s[2]+i*(o[2]-s[2]),r)},f.push(["rgb",H]),n.prototype.luminance=function(t,e){var n,i,r,s;return null==e&&(e="rgb"),arguments.length?(r=this._rgb,0===t?r=[0,0,0,this._rgb[3]]:1===t?r=[255,255,255,this[3]]:(n=pt(this._rgb),i=20,s=function(n,r){var o,a;return o=(a=n.interpolate(r,.5,e)).luminance(),Math.abs(t-o)<1e-7||!i--?a:o>t?s(n,a):s(a,r)},r=n>t?s(w("black"),this).rgba():s(this,w("white")).rgba()),w(r).alpha(this.alpha())):pt(this._rgb)},St=function(t){var e,n,i,r;return(r=t/100)<66?(i=255,n=-155.25485562709179-.44596950469579133*(n=r-2)+104.49216199393888*K(n),e=r<20?0:.8274096064007395*(e=r-10)-254.76935184120902+115.67994401066147*K(e)):(i=351.97690566805693+.114206453784165*(i=r-55)-40.25366309332127*K(i),n=325.4494125711974+.07943456536662342*(n=r-50)-28.0852963507957*K(n),e=255),[i,n,e]},mt=function(){var t,e,n,i,r,s,o;for(i=(r=Mt(arguments))[0],r[1],t=r[2],n=1e3,e=4e4;e-n>.4;)(s=St(o=.5*(e+n)))[2]/s[0]>=t/i?e=o:n=o;return yt(o)},w.temperature=w.kelvin=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["temperature"]),(function(){}))},p.temperature=p.kelvin=p.K=St,n.prototype.temperature=function(){return mt(this._rgb)},n.prototype.kelvin=n.prototype.temperature,w.contrast=function(t,e){var i,r,s,o;return"string"!==(s=At(t))&&"number"!==s||(t=new n(t)),"string"!==(o=At(e))&&"number"!==o||(e=new n(e)),(i=t.luminance())>(r=e.luminance())?(i+.05)/(r+.05):(r+.05)/(i+.05)},w.distance=function(t,e,i){var r,s,o,a,l,c,u;for(s in null==i&&(i="lab"),"string"!==(l=At(t))&&"number"!==l||(t=new n(t)),"string"!==(c=At(e))&&"number"!==c||(e=new n(e)),o=t.get(i),a=e.get(i),u=0,o)u+=(r=(o[s]||0)-(a[s]||0))*r;return Math.sqrt(u)},w.deltaE=function(t,e,i,r){var s,a,l,c,u,h,d,p,f,_,v,y,b,x,w,S,A,C,E,T,P,I,R,k;for(null==i&&(i=1),null==r&&(r=1),"string"!==(w=At(t))&&"number"!==w||(t=new n(t)),"string"!==(S=At(e))&&"number"!==S||(e=new n(e)),s=(A=t.lab())[0],l=A[1],u=A[2],a=(C=e.lab())[0],c=C[1],h=C[2],d=wt(l*l+u*u),p=wt(c*c+h*h),T=s<16?.511:.040975*s/(1+.01765*s),E=.0638*d/(1+.0131*d)+.638,x=d<1e-6?0:180*g(u,l)/o;x<0;)x+=360;for(;x>=360;)x-=360;return P=x>=164&&x<=345?.56+m(.2*M(o*(x+168)/180)):.36+m(.4*M(o*(x+35)/180)),b=wt((f=d*d*d*d)/(f+1900)),wt((I=(s-a)/(i*T))*I+(R=(y=d-p)/(r*E))*R+((_=l-c)*_+(v=u-h)*v-y*y)/((k=E*(b*P+1-b))*k))},n.prototype.get=function(t){var e,n,i,r,s;return i=(r=t.split("."))[0],e=r[1],s=this[i](),e?(n=i.indexOf(e))>-1?s[n]:console.warn("unknown channel "+e+" in mode "+i):s},n.prototype.set=function(t,e){var n,i,r,s,o;if(r=(s=t.split("."))[0],n=s[1])if(o=this[r](),(i=r.indexOf(n))>-1)if("string"===At(e))switch(e.charAt(0)){case"+":case"-":o[i]+=+e;break;case"*":o[i]*=+e.substr(1);break;case"/":o[i]/=+e.substr(1);break;default:o[i]=+e}else o[i]=e;else console.warn("unknown channel "+n+" in mode "+r);else o=e;return w(o,r).alpha(this.alpha())},n.prototype.clipped=function(){return this._rgb._clipped||!1},n.prototype.alpha=function(t){return arguments.length?w.rgb([this._rgb[0],this._rgb[1],this._rgb[2],t]):this._rgb[3]},n.prototype.darken=function(t){var e;return null==t&&(t=1),(e=this.lab())[0]-=s.Kn*t,w.lab(e).alpha(this.alpha())},n.prototype.brighten=function(t){return null==t&&(t=1),this.darken(-t)},n.prototype.darker=n.prototype.darken,n.prototype.brighter=n.prototype.brighten,n.prototype.saturate=function(t){var e;return null==t&&(t=1),(e=this.lch())[1]+=t*s.Kn,e[1]<0&&(e[1]=0),w.lch(e).alpha(this.alpha())},n.prototype.desaturate=function(t){return null==t&&(t=1),this.saturate(-t)},n.prototype.premultiply=function(){var t,e;return e=this.rgb(),t=this.alpha(),w(e[0]*t,e[1]*t,e[2]*t,t)},tt=function(t,e){return t*e/255},E=function(t,e){return t>e?e:t},X=function(t,e){return t>e?t:e},bt=function(t,e){return 255*(1-(1-t/255)*(1-e/255))},nt=function(t,e){return e<128?2*t*e/255:255*(1-2*(1-t/255)*(1-e/255))},x=function(t,e){return 255*(1-(1-e/255)/(t/255))},T=function(t,e){return 255===t||(t=e/255*255/(1-t/255))>255?255:t},(v=function(t,e,n){if(!v[n])throw"unknown blend mode "+n;return v[n](t,e)}).normal=(y=function(t){return function(e,n){var i,r;return i=w(n).rgb(),r=w(e).rgb(),w(t(i,r),"rgb")}})((P=function(t){return function(e,n){var i,r,s;for(s=[],i=r=0;r<=3;i=++r)s[i]=t(e[i],n[i]);return s}})((function(t,e){return t}))),v.multiply=y(P(tt)),v.screen=y(P(bt)),v.overlay=y(P(nt)),v.darken=y(P(E)),v.lighten=y(P(X)),v.dodge=y(P(T)),v.burn=y(P(x)),w.blend=v,w.analyze=function(t){var e,n,i,r;for(i={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},n=0,e=t.length;n<e;n++)null==(r=t[n])||isNaN(r)||(i.values.push(r),i.sum+=r,r<i.min&&(i.min=r),r>i.max&&(i.max=r),i.count+=1);return i.domain=[i.min,i.max],i.limits=function(t,e){return w.limits(i,t,e)},i},w.scale=function(t,e){var n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,S;return u="rgb",h=w("#ccc"),m=0,o=[0,1],f=[],p=[0,0],n=!1,r=[],d=!1,c=0,l=1,s=!1,i={},g=!0,a=1,x=function(t){var e,n,i,s,o,a;if(null==t&&(t=["#fff","#000"]),null!=t&&"string"===At(t)&&null!=w.brewer&&(t=w.brewer[t]||w.brewer[t.toLowerCase()]||t),"array"===At(t)){for(1===t.length&&(t=[t[0],t[0]]),e=i=0,s=(t=t.slice(0)).length-1;0<=s?i<=s:i>=s;e=0<=s?++i:--i)n=t[e],"string"===At(n)&&(t[e]=w(n));for(f.length=0,e=a=0,o=t.length-1;0<=o?a<=o:a>=o;e=0<=o?++a:--a)f.push(e/(t.length-1))}return b(),r=t},v=function(t){var e,i;if(null!=n){for(i=n.length-1,e=0;e<i&&t>=n[e];)e++;return e-1}return 0},S=function(t){return t},y=function(t,e){var s,o,d,m,_,y,b;if(null==e&&(e=!1),isNaN(t)||null===t)return h;if(b=e?t:n&&n.length>2?v(t)/(n.length-2):l!==c?(t-c)/(l-c):1,e||(b=S(b)),1!==a&&(b=it(b,a)),b=p[0]+b*(1-p[0]-p[1]),b=Math.min(1,Math.max(0,b)),d=Math.floor(1e4*b),g&&i[d])s=i[d];else{if("array"===At(r))for(o=m=0,y=f.length-1;0<=y?m<=y:m>=y;o=0<=y?++m:--m){if(b<=(_=f[o])){s=r[o];break}if(b>=_&&o===f.length-1){s=r[o];break}if(b>_&&b<f[o+1]){b=(b-_)/(f[o+1]-_),s=w.interpolate(r[o],r[o+1],b,u);break}}else"function"===At(r)&&(s=r(b));g&&(i[d]=s)}return s},b=function(){return i={}},x(t),(_=function(t){var e;return e=w(y(t)),d&&e[d]?e[d]():e}).classes=function(t){var e;return null!=t?("array"===At(t)?(n=t,o=[t[0],t[t.length-1]]):(e=w.analyze(o),n=0===t?[e.min,e.max]:w.limits(e,"e",t)),_):n},_.domain=function(t){var e,n,i,s,a,u,h;if(!arguments.length)return o;if(c=t[0],l=t[t.length-1],f=[],i=r.length,t.length===i&&c!==l)for(a=0,s=t.length;a<s;a++)n=t[a],f.push((n-c)/(l-c));else for(e=h=0,u=i-1;0<=u?h<=u:h>=u;e=0<=u?++h:--h)f.push(e/(i-1));return o=[c,l],_},_.mode=function(t){return arguments.length?(u=t,b(),_):u},_.range=function(t,e){return x(t),_},_.out=function(t){return d=t,_},_.spread=function(t){return arguments.length?(m=t,_):m},_.correctLightness=function(t){return null==t&&(t=!0),s=t,b(),S=s?function(t){var e,n,i,r,s,o,a,l;for(o=(e=y(0,!0).lab()[0])>(n=y(1,!0).lab()[0]),i=y(t,!0).lab()[0]-(r=e+(n-e)*t),a=0,l=1,s=20;Math.abs(i)>.01&&s-- >0;)o&&(i*=-1),i<0?(a=t,t+=.5*(l-t)):(l=t,t+=.5*(a-t)),i=y(t,!0).lab()[0]-r;return t}:function(t){return t},_},_.padding=function(t){return null!=t?("number"===At(t)&&(t=[t,t]),p=t,_):p},_.colors=function(e,i){var s,a,l,c,u,h,d,p;if(arguments.length<2&&(i="hex"),u=[],0===arguments.length)u=r.slice(0);else if(1===e)u=[_(.5)];else if(e>1)a=o[0],s=o[1]-a,u=function(){h=[];for(var t=0;0<=e?t<e:t>e;0<=e?t++:t--)h.push(t);return h}.apply(this).map((function(t){return _(a+t/(e-1)*s)}));else{if(t=[],d=[],n&&n.length>2)for(l=p=1,c=n.length;1<=c?p<c:p>c;l=1<=c?++p:--p)d.push(.5*(n[l-1]+n[l]));else d=o;u=d.map((function(t){return _(t)}))}return w[i]&&(u=u.map((function(t){return t[i]()}))),u},_.cache=function(t){return null!=t?(g=t,_):g},_.gamma=function(t){return null!=t?(a=t,_):a},_.nodata=function(t){return null!=t?(h=w(t),_):h},_},null==w.scales&&(w.scales={}),w.scales.cool=function(){return w.scale([w.hsl(180,1,.9),w.hsl(250,.7,.4)])},w.scales.hot=function(){return w.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},w.analyze=function(t,e,n){var i,r,s,o,a,l;if(a={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==n&&(n=function(){return!0}),i=function(t){null==t||isNaN(t)||(a.values.push(t),a.sum+=t,t<a.min&&(a.min=t),t>a.max&&(a.max=t),a.count+=1)},l=function(t,r){if(n(t,r))return null!=e&&"function"===At(e)?i(e(t)):null!=e&&"string"===At(e)||"number"===At(e)?i(t[e]):i(t)},"array"===At(t))for(o=0,s=t.length;o<s;o++)l(t[o]);else for(r in t)l(t[r],r);return a.domain=[a.min,a.max],a.limits=function(t,e){return w.limits(a,t,e)},a},w.limits=function(t,e,n){var i,r,s,o,a,l,c,u,h,d,p,f,g,_,v,y,b,x,S,A,M,C,E,T,P,R,k,D,L,O,N,F,B,U,z,V,H,G,$,j,W,q,X,Y,Z,Q,tt,et,nt,rt,st,ot,at,lt,ct;if(null==e&&(e="equal"),null==n&&(n=7),"array"===At(t)&&(t=w.analyze(t)),P=t.min,J=t.max,t.sum,lt=t.values.sort((function(t,e){return t-e})),1===n)return[P,J];if(E=[],"c"===e.substr(0,1)&&(E.push(P),E.push(J)),"e"===e.substr(0,1)){for(E.push(P),A=N=1,z=n-1;1<=z?N<=z:N>=z;A=1<=z?++N:--N)E.push(P+A/n*(J-P));E.push(J)}else if("l"===e.substr(0,1)){if(P<=0)throw"Logarithmic scales are only possible for values > 0";for(R=Math.LOG10E*K(P),T=Math.LOG10E*K(J),E.push(P),A=ct=1,V=n-1;1<=V?ct<=V:ct>=V;A=1<=V?++ct:--ct)E.push(it(10,R+A/n*(T-R)));E.push(J)}else if("q"===e.substr(0,1)){for(E.push(P),A=i=1,q=n-1;1<=q?i<=q:i>=q;A=1<=q?++i:--i)F=(lt.length-1)*A/n,(B=I(F))===F?E.push(lt[B]):(U=F-B,E.push(lt[B]*(1-U)+lt[B+1]*U));E.push(J)}else if("k"===e.substr(0,1)){for(D=lt.length,_=new Array(D),x=new Array(n),rt=!0,L=0,y=null,(y=[]).push(P),A=r=1,X=n-1;1<=X?r<=X:r>=X;A=1<=X?++r:--r)y.push(P+A/n*(J-P));for(y.push(J);rt;){for(M=s=0,Y=n-1;0<=Y?s<=Y:s>=Y;M=0<=Y?++s:--s)x[M]=0;for(A=o=0,Z=D-1;0<=Z?o<=Z:o>=Z;A=0<=Z?++o:--o){for(at=lt[A],k=Number.MAX_VALUE,M=a=0,Q=n-1;0<=Q?a<=Q:a>=Q;M=0<=Q?++a:--a)(S=m(y[M]-at))<k&&(k=S,v=M);x[v]++,_[A]=v}for(O=new Array(n),M=l=0,tt=n-1;0<=tt?l<=tt:l>=tt;M=0<=tt?++l:--l)O[M]=null;for(A=c=0,et=D-1;0<=et?c<=et:c>=et;A=0<=et?++c:--c)null===O[b=_[A]]?O[b]=lt[A]:O[b]+=lt[A];for(M=u=0,nt=n-1;0<=nt?u<=nt:u>=nt;M=0<=nt?++u:--u)O[M]*=1/x[M];for(rt=!1,M=h=0,H=n-1;0<=H?h<=H:h>=H;M=0<=H?++h:--h)if(O[M]!==y[A]){rt=!0;break}y=O,++L>200&&(rt=!1)}for(C={},M=d=0,G=n-1;0<=G?d<=G:d>=G;M=0<=G?++d:--d)C[M]=[];for(A=p=0,$=D-1;0<=$?p<=$:p>=$;A=0<=$?++p:--p)C[b=_[A]].push(lt[A]);for(st=[],M=f=0,j=n-1;0<=j?f<=j:f>=j;M=0<=j?++f:--f)st.push(C[M][0]),st.push(C[M][C[M].length-1]);for(st=st.sort((function(t,e){return t-e})),E.push(st[0]),A=g=1,W=st.length-1;g<=W;A=g+=2)ot=st[A],isNaN(ot)||-1!==E.indexOf(ot)||E.push(ot)}return E},D=function(t,e,n){var i,r,s,o;return t=(i=Mt(arguments))[0],e=i[1],n=i[2],isNaN(t)&&(t=0),(t/=360)<1/3?s=1-((r=(1-e)/3)+(o=(1+e*M(c*t)/M(a-c*t))/3)):t<2/3?r=1-((o=(1-e)/3)+(s=(1+e*M(c*(t-=1/3))/M(a-c*t))/3)):o=1-((s=(1-e)/3)+(r=(1+e*M(c*(t-=2/3))/M(a-c*t))/3)),[255*(o=Y(n*o*3)),255*(s=Y(n*s*3)),255*(r=Y(n*r*3)),i.length>3?i[3]:1]},lt=function(){var t,e,n,i,r,s,o;return r=(s=Mt(arguments))[0],e=s[1],t=s[2],c=2*Math.PI,r/=255,e/=255,t/=255,0==(o=1-Math.min(r,e,t)/(i=(r+e+t)/3))?n=0:(n=(r-e+(r-t))/2,n/=Math.sqrt((r-e)*(r-e)+(r-t)*(e-t)),n=Math.acos(n),t>e&&(n=c-n),n/=c),[360*n,o,i]},w.hsi=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,r=t.apply(i,e);return Object(r)===r?r:i}(n,Pt.call(arguments).concat(["hsi"]),(function(){}))},p.hsi=D,n.prototype.hsi=function(){return lt(this._rgb)},B=function(t,e,n,i){var r,s,o,a,l,c,u,h,d,p;return"hsl"===i?(d=t.hsl(),p=e.hsl()):"hsv"===i?(d=t.hsv(),p=e.hsv()):"hcg"===i?(d=t.hcg(),p=e.hcg()):"hsi"===i?(d=t.hsi(),p=e.hsi()):"lch"!==i&&"hcl"!==i||(i="hcl",d=t.hcl(),p=e.hcl()),"h"===i.substr(0,1)&&(s=d[0],u=d[1],a=d[2],o=p[0],h=p[1],l=p[2]),isNaN(s)||isNaN(o)?isNaN(s)?isNaN(o)?r=Number.NaN:(r=o,1!==a&&0!==a||"hsv"===i||(c=h)):(r=s,1!==l&&0!==l||"hsv"===i||(c=u)):r=s+n*(o>s&&o-s>180?o-(s+360):o<s&&s-o>180?o+360-s:o-s),null==c&&(c=u+n*(h-u)),w[i](r,c,a+n*(l-a))},V=function(t,e,n,i){var r,s;return r=t.num(),s=e.num(),w.num(r+(s-r)*n,"num")},(f=f.concat(function(){var t,e,n,i;for(i=[],e=0,t=(n=["hsv","hsl","hsi","hcl","lch","hcg"]).length;e<t;e++)Q=n[e],i.push([Q,B]);return i}())).push(["num",V]),U=function(t,e,i,r){var s,o;return s=t.lab(),o=e.lab(),new n(s[0]+i*(o[0]-s[0]),s[1]+i*(o[1]-s[1]),s[2]+i*(o[2]-s[2]),r)},f.push(["lab",U])}.call(this)},742:t=>{t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},r=0;r<this.length;r++){var s=this[r][0];"number"==typeof s&&(i[s]=!0)}for(r=0;r<e.length;r++){var o=e[r];"number"==typeof o[0]&&i[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},2812:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.extend(t.expr.pseudos,{data:t.expr.createPseudo((function(e){return function(n){return!!t.data(n,e)}}))})})?i.apply(e,r):i)||(t.exports=s)}()},1677:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.fn.extend({disableSelection:(e="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(e+".ui-disableSelection",(function(t){t.preventDefault()}))}),enableSelection:function(){return this.off(".ui-disableSelection")}});var e})?i.apply(e,r):i)||(t.exports=s)}()},2402:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.ui.focusable=function(e,n){var i,r,s,o,a,l=e.nodeName.toLowerCase();return"area"===l?(r=(i=e.parentNode).name,!(!e.href||!r||"map"!==i.nodeName.toLowerCase())&&(s=t("img[usemap='#"+r+"']")).length>0&&s.is(":visible")):(/^(input|select|textarea|button|object)$/.test(l)?(o=!e.disabled)&&(a=t(e).closest("fieldset")[0])&&(o=!a.disabled):o="a"===l&&e.href||n,o&&t(e).is(":visible")&&"visible"===t(e).css("visibility"))},t.extend(t.expr.pseudos,{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable})?i.apply(e,r):i)||(t.exports=s)}()},9996:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout((function(){var n=e.data("ui-form-reset-instances");t.each(n,(function(){this.refresh()}))}))},_bindFormResetHandler:function(){if(this.form=t(this.element.prop("form")),this.form.length){var e=this.form.data("ui-form-reset-instances")||[];e.length||this.form.on("reset.ui-form-reset",this._formResetHandler),e.push(this),this.form.data("ui-form-reset-instances",e)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}}})?i.apply(e,r):i)||(t.exports=s)}()},7584:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}})?i.apply(e,r):i)||(t.exports=s)}()},4915:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.fn.labels=function(){var t,e,n,i,r;return this.length?this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(i=this.eq(0).parents("label"),(n=this.attr("id"))&&(r=(t=this.eq(0).parents().last()).add(t.length?t.siblings():this.siblings()),e="label[for='"+CSS.escape(n)+"']",i=i.add(r.find(e).addBack(e))),this.pushStack(i)):this.pushStack([])}})?i.apply(e,r):i)||(t.exports=s)}()},9587:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],i=function(t){return t.ui.plugin={add:function(e,n,i){var r,s=t.ui[e].prototype;for(r in i)s.plugins[r]=s.plugins[r]||[],s.plugins[r].push([n,i[r]])},call:function(t,e,n,i){var r,s=t.plugins[e];if(s&&(i||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(r=0;r<s.length;r++)t.options[s[r][0]]&&s[r][1].apply(t.element,n)}}},void 0===(s=i.apply(e,r))||(t.exports=s)}()},8075:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],i=function(t){return function(){var e,n=Math.max,i=Math.abs,r=/left|center|right/,s=/top|center|bottom/,o=/[\+\-]\d+(\.[\d]+)?%?/,a=/^\w+/,l=/%$/,c=t.fn.position;function u(t,e,n){return[parseFloat(t[0])*(l.test(t[0])?e/100:1),parseFloat(t[1])*(l.test(t[1])?n/100:1)]}function h(e,n){return parseInt(t.css(e,n),10)||0}function d(t){return null!=t&&t===t.window}t.position={scrollbarWidth:function(){if(void 0!==e)return e;var n,i,r=t("<div style='display:block;position:absolute;width:200px;height:200px;overflow:hidden;'><div style='height:300px;width:auto;'></div></div>"),s=r.children()[0];return t("body").append(r),n=s.offsetWidth,r.css("overflow","scroll"),n===(i=s.offsetWidth)&&(i=r[0].clientWidth),r.remove(),e=n-i},getScrollInfo:function(e){var n=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),i=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),r="scroll"===n||"auto"===n&&e.width<e.element[0].scrollWidth;return{width:"scroll"===i||"auto"===i&&e.height<e.element[0].scrollHeight?t.position.scrollbarWidth():0,height:r?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var n=t(e||window),i=d(n[0]),r=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:r,offset:i||r?{left:0,top:0}:t(e).offset(),scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:n.outerWidth(),height:n.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return c.apply(this,arguments);var l,p,f,m,g,_,v,y,b="string"==typeof(e=t.extend({},e)).of?t(document).find(e.of):t(e.of),x=t.position.getWithinInfo(e.within),w=t.position.getScrollInfo(x),S=(e.collision||"flip").split(" "),A={};return _=9===(y=(v=b)[0]).nodeType?{width:v.width(),height:v.height(),offset:{top:0,left:0}}:d(y)?{width:v.width(),height:v.height(),offset:{top:v.scrollTop(),left:v.scrollLeft()}}:y.preventDefault?{width:0,height:0,offset:{top:y.pageY,left:y.pageX}}:{width:v.outerWidth(),height:v.outerHeight(),offset:v.offset()},b[0].preventDefault&&(e.at="left top"),p=_.width,f=_.height,m=_.offset,g=t.extend({},m),t.each(["my","at"],(function(){var t,n,i=(e[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):s.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=s.test(i[1])?i[1]:"center",t=o.exec(i[0]),n=o.exec(i[1]),A[this]=[t?t[0]:0,n?n[0]:0],e[this]=[a.exec(i[0])[0],a.exec(i[1])[0]]})),1===S.length&&(S[1]=S[0]),"right"===e.at[0]?g.left+=p:"center"===e.at[0]&&(g.left+=p/2),"bottom"===e.at[1]?g.top+=f:"center"===e.at[1]&&(g.top+=f/2),l=u(A.at,p,f),g.left+=l[0],g.top+=l[1],this.each((function(){var r,s,o=t(this),a=o.outerWidth(),c=o.outerHeight(),d=h(this,"marginLeft"),_=h(this,"marginTop"),v=a+d+h(this,"marginRight")+w.width,y=c+_+h(this,"marginBottom")+w.height,M=t.extend({},g),C=u(A.my,o.outerWidth(),o.outerHeight());"right"===e.my[0]?M.left-=a:"center"===e.my[0]&&(M.left-=a/2),"bottom"===e.my[1]?M.top-=c:"center"===e.my[1]&&(M.top-=c/2),M.left+=C[0],M.top+=C[1],r={marginLeft:d,marginTop:_},t.each(["left","top"],(function(n,i){t.ui.position[S[n]]&&t.ui.position[S[n]][i](M,{targetWidth:p,targetHeight:f,elemWidth:a,elemHeight:c,collisionPosition:r,collisionWidth:v,collisionHeight:y,offset:[l[0]+C[0],l[1]+C[1]],my:e.my,at:e.at,within:x,elem:o})})),e.using&&(s=function(t){var r=m.left-M.left,s=r+p-a,l=m.top-M.top,u=l+f-c,h={target:{element:b,left:m.left,top:m.top,width:p,height:f},element:{element:o,left:M.left,top:M.top,width:a,height:c},horizontal:s<0?"left":r>0?"right":"center",vertical:u<0?"top":l>0?"bottom":"middle"};p<a&&i(r+s)<p&&(h.horizontal="center"),f<c&&i(l+u)<f&&(h.vertical="middle"),n(i(r),i(s))>n(i(l),i(u))?h.important="horizontal":h.important="vertical",e.using.call(this,t,h)}),o.offset(t.extend(M,{using:s}))}))},t.ui.position={fit:{left:function(t,e){var i,r=e.within,s=r.isWindow?r.scrollLeft:r.offset.left,o=r.width,a=t.left-e.collisionPosition.marginLeft,l=s-a,c=a+e.collisionWidth-o-s;e.collisionWidth>o?l>0&&c<=0?(i=t.left+l+e.collisionWidth-o-s,t.left+=l-i):t.left=c>0&&l<=0?s:l>c?s+o-e.collisionWidth:s:l>0?t.left+=l:c>0?t.left-=c:t.left=n(t.left-a,t.left)},top:function(t,e){var i,r=e.within,s=r.isWindow?r.scrollTop:r.offset.top,o=e.within.height,a=t.top-e.collisionPosition.marginTop,l=s-a,c=a+e.collisionHeight-o-s;e.collisionHeight>o?l>0&&c<=0?(i=t.top+l+e.collisionHeight-o-s,t.top+=l-i):t.top=c>0&&l<=0?s:l>c?s+o-e.collisionHeight:s:l>0?t.top+=l:c>0?t.top-=c:t.top=n(t.top-a,t.top)}},flip:{left:function(t,e){var n,r,s=e.within,o=s.offset.left+s.scrollLeft,a=s.width,l=s.isWindow?s.scrollLeft:s.offset.left,c=t.left-e.collisionPosition.marginLeft,u=c-l,h=c+e.collisionWidth-a-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];u<0?((n=t.left+d+p+f+e.collisionWidth-a-o)<0||n<i(u))&&(t.left+=d+p+f):h>0&&((r=t.left-e.collisionPosition.marginLeft+d+p+f-l)>0||i(r)<h)&&(t.left+=d+p+f)},top:function(t,e){var n,r,s=e.within,o=s.offset.top+s.scrollTop,a=s.height,l=s.isWindow?s.scrollTop:s.offset.top,c=t.top-e.collisionPosition.marginTop,u=c-l,h=c+e.collisionHeight-a-l,d="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,p="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,f=-2*e.offset[1];u<0?((r=t.top+d+p+f+e.collisionHeight-a-o)<0||r<i(u))&&(t.top+=d+p+f):h>0&&((n=t.top-e.collisionPosition.marginTop+d+p+f-l)>0||i(n)<h)&&(t.top+=d+p+f)}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position},void 0===(s=i.apply(e,r))||(t.exports=s)}()},2362:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.fn.scrollParent=function(e){var n=this.css("position"),i="absolute"===n,r=e?/(auto|scroll|hidden)/:/(auto|scroll)/,s=this.parents().filter((function(){var e=t(this);return(!i||"static"!==e.css("position"))&&r.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))})).eq(0);return"fixed"!==n&&s.length?s:t(this[0].ownerDocument||document)}})?i.apply(e,r):i)||(t.exports=s)}()},7819:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642),n(2402)],void 0===(s="function"==typeof(i=function(t){return t.extend(t.expr.pseudos,{tabbable:function(e){var n=t.attr(e,"tabindex"),i=null!=n;return(!i||n>=0)&&t.ui.focusable(e,i)}})})?i.apply(e,r):i)||(t.exports=s)}()},2121:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],void 0===(s="function"==typeof(i=function(t){return t.fn.extend({uniqueId:(e=0,function(){return this.each((function(){this.id||(this.id="ui-id-"+ ++e)}))}),removeUniqueId:function(){return this.each((function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")}))}});var e})?i.apply(e,r):i)||(t.exports=s)}()},1642:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929)],void 0===(s="function"==typeof(i=function(t){return t.ui=t.ui||{},t.ui.version="1.14.1"})?i.apply(e,r):i)||(t.exports=s)}()},2628:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642)],i=function(t){var e,n=0,i=Array.prototype.hasOwnProperty,r=Array.prototype.slice;return t.cleanData=(e=t.cleanData,function(n){var i,r,s;for(s=0;null!=(r=n[s]);s++)(i=t._data(r,"events"))&&i.remove&&t(r).triggerHandler("remove");e(n)}),t.widget=function(e,n,i){var r,s,o,a={},l=e.split(".")[0];if("__proto__"===(e=e.split(".")[1])||"constructor"===e)return t.error("Invalid widget name: "+e);var c=l+"-"+e;return i||(i=n,n=t.Widget),Array.isArray(i)&&(i=t.extend.apply(null,[{}].concat(i))),t.expr.pseudos[c.toLowerCase()]=function(e){return!!t.data(e,c)},t[l]=t[l]||{},r=t[l][e],s=t[l][e]=function(t,e){if(!this||!this._createWidget)return new s(t,e);arguments.length&&this._createWidget(t,e)},t.extend(s,r,{version:i.version,_proto:t.extend({},i),_childConstructors:[]}),(o=new n).options=t.widget.extend({},o.options),t.each(i,(function(t,e){a[t]="function"==typeof e?function(){function i(){return n.prototype[t].apply(this,arguments)}function r(e){return n.prototype[t].apply(this,e)}return function(){var t,n=this._super,s=this._superApply;return this._super=i,this._superApply=r,t=e.apply(this,arguments),this._super=n,this._superApply=s,t}}():e})),s.prototype=t.widget.extend(o,{widgetEventPrefix:r&&o.widgetEventPrefix||e},a,{constructor:s,namespace:l,widgetName:e,widgetFullName:c}),r?(t.each(r._childConstructors,(function(e,n){var i=n.prototype;t.widget(i.namespace+"."+i.widgetName,s,n._proto)})),delete r._childConstructors):n._childConstructors.push(s),t.widget.bridge(e,s),s},t.widget.extend=function(e){for(var n,s,o=r.call(arguments,1),a=0,l=o.length;a<l;a++)for(n in o[a])s=o[a][n],i.call(o[a],n)&&void 0!==s&&(t.isPlainObject(s)?e[n]=t.isPlainObject(e[n])?t.widget.extend({},e[n],s):t.widget.extend({},s):e[n]=s);return e},t.widget.bridge=function(e,n){var i=n.prototype.widgetFullName||e;t.fn[e]=function(s){var o="string"==typeof s,a=r.call(arguments,1),l=this;return o?this.length||"instance"!==s?this.each((function(){var n,r=t.data(this,i);return"instance"===s?(l=r,!1):r?"function"!=typeof r[s]||"_"===s.charAt(0)?t.error("no such method '"+s+"' for "+e+" widget instance"):(n=r[s].apply(r,a))!==r&&void 0!==n?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0:t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+s+"'")})):l=void 0:(a.length&&(s=t.widget.extend.apply(null,[s].concat(a))),this.each((function(){var e=t.data(this,i);e?(e.option(s||{}),e._init&&e._init()):t.data(this,i,new n(s,this))}))),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,(function(t,n){e._removeClass(n,t)})),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,n){var i,r,s,o=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(o={},i=e.split("."),e=i.shift(),i.length){for(r=o[e]=t.widget.extend({},this.options[e]),s=0;s<i.length-1;s++)r[i[s]]=r[i[s]]||{},r=r[i[s]];if(e=i.pop(),1===arguments.length)return void 0===r[e]?null:r[e];r[e]=n}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];o[e]=n}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var n,i,r;for(n in e)r=this.classesElementLookup[n],e[n]!==this.options.classes[n]&&r&&r.length&&(i=t(r.get()),this._removeClass(r,n),i.addClass(this._classes({element:i,keys:n,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){var n=[],i=this;function r(){var n=[];e.element.each((function(e,r){t.map(i.classesElementLookup,(function(t){return t})).some((function(t){return t.is(r)}))||n.push(r)})),i._on(t(n),{remove:"_untrackClassesElement"})}function s(s,o){var a,l;for(l=0;l<s.length;l++)a=i.classesElementLookup[s[l]]||t(),e.add?(r(),a=t(t.uniqueSort(a.get().concat(e.element.get())))):a=t(a.not(e.element).get()),i.classesElementLookup[s[l]]=a,n.push(s[l]),o&&e.classes[s[l]]&&n.push(e.classes[s[l]])}return(e=t.extend({element:this.element,classes:this.options.classes||{}},e)).keys&&s(e.keys.match(/\S+/g)||[],!0),e.extra&&s(e.extra.match(/\S+/g)||[]),n.join(" ")},_untrackClassesElement:function(e){var n=this;t.each(n.classesElementLookup,(function(i,r){-1!==t.inArray(e.target,r)&&(n.classesElementLookup[i]=t(r.not(e.target).get()))})),this._off(t(e.target))},_removeClass:function(t,e,n){return this._toggleClass(t,e,n,!1)},_addClass:function(t,e,n){return this._toggleClass(t,e,n,!0)},_toggleClass:function(t,e,n,i){i="boolean"==typeof i?i:n;var r="string"==typeof t||null===t,s={extra:r?e:n,keys:r?t:e,element:r?this.element:t,add:i};return s.element.toggleClass(this._classes(s),i),this},_on:function(e,n,i){var r,s=this;"boolean"!=typeof e&&(i=n,n=e,e=!1),i?(n=r=t(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,r=this.widget()),t.each(i,(function(i,o){function a(){if(e||!0!==s.options.disabled&&!t(this).hasClass("ui-state-disabled"))return("string"==typeof o?s[o]:o).apply(s,arguments)}"string"!=typeof o&&(a.guid=o.guid=o.guid||a.guid||t.guid++);var l=i.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+s.eventNamespace,u=l[2];u?r.on(c,u,a):n.on(c,a)}))},_off:function(e,n){n=(n||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(n),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){var n=this;return setTimeout((function(){return("string"==typeof t?n[t]:t).apply(n,arguments)}),e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,n,i){var r,s,o=this.options[e];if(i=i||{},(n=t.Event(n)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(r in s)r in n||(n[r]=s[r]);return this.element.trigger(n,i),!("function"==typeof o&&!1===o.apply(this.element[0],[n].concat(i))||n.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},(function(e,n){t.Widget.prototype["_"+e]=function(i,r,s){var o;"string"==typeof r&&(r={effect:r});var a=r?!0===r||"number"==typeof r?n:r.effect||n:e;"number"==typeof(r=r||{})?r={duration:r}:!0===r&&(r={}),o=!t.isEmptyObject(r),r.complete=s,r.delay&&i.delay(r.delay),o&&t.effects&&t.effects.effect[a]?i[e](r):a!==e&&i[a]?i[a](r.duration,r.easing,s):i.queue((function(n){t(this)[e](),s&&s.call(i[0]),n()}))}})),t.widget},void 0===(s=i.apply(e,r))||(t.exports=s)}()},9998:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(8958),n(3492),n(7584),n(2628)],i=function(t){var e;return t.widget("ui.button",{version:"1.14.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),null!=(t=this.element[0].disabled)&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,n){var i="iconPosition"!==e,r=i?this.options.iconPosition:n,s="top"===r||"bottom"===r;this.icon?i&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),i&&this._addClass(this.icon,null,n),this._attachIcon(r),s?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(r))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,n=void 0===t.icon?this.options.icon:t.icon;e||n||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.trigger("blur"))},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),!0===t.uiBackCompat&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){"text"!==t?("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),this._superApply(arguments)):this._super("showLabel",e)}}),t.fn.button=(e=t.fn.button,function(n){var i="string"==typeof n,r=Array.prototype.slice.call(arguments,1),s=this;return i?this.length||"instance"!==n?this.each((function(){var e,i=t(this).attr("type"),o="checkbox"!==i&&"radio"!==i?"button":"checkboxradio",a=t.data(this,"ui-"+o);return"instance"===n?(s=a,!1):a?"function"!=typeof a[n]||"_"===n.charAt(0)?t.error("no such method '"+n+"' for button widget instance"):(e=a[n].apply(a,r))!==a&&void 0!==e?(s=e&&e.jquery?s.pushStack(e.get()):e,!1):void 0:t.error("cannot call methods on button prior to initialization; attempted to call method '"+n+"'")})):s=void 0:(r.length&&(n=t.widget.extend.apply(null,[n].concat(r))),this.each((function(){var i=t(this).attr("type"),r="checkbox"!==i&&"radio"!==i?"button":"checkboxradio",s=t.data(this,"ui-"+r);if(s)s.option(n||{}),s._init&&s._init();else{if("button"===r)return void e.call(t(this),n);t(this).checkboxradio(t.extend({icon:!1},n))}}))),s}),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button},void 0===(s=i.apply(e,r))||(t.exports=s)}()},3492:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(9996),n(4915),n(2628)],void 0===(s="function"==typeof(i=function(t){return t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.14.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,n,i,r=this._super()||{};return this._readType(),n=this.element.labels(),this.label=t(n[n.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",(i=this.label.contents().not(this.element[0])).length&&(this.originalLabel+=i.clone().wrapAll("<div></div>").parent().html()),this.originalLabel&&(r.label=this.originalLabel),null!=(e=this.element[0].disabled)&&(r.disabled=e),r},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e=this.element[0].name,n="input[name='"+CSS.escape(e)+"']";return e?(this.form.length?t(this.form[0].elements).filter(n):t(n).filter((function(){return 0===t(t(this).prop("form")).length}))).not(this.element):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each((function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")}))},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){if("label"!==t||e){if(this._super(t,e),"disabled"===t)return this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e);this.refresh()}},_updateIcon:function(e){var n="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(n+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):n+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",n),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio})?i.apply(e,r):i)||(t.exports=s)}()},8958:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(2628)],void 0===(s="function"==typeof(i=function(t){var e=/ui-corner-([a-z]){2,6}/g;return t.widget("ui.controlgroup",{version:"1.14.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,n=[];t.each(this.options.items,(function(i,r){var s,o={};if(r)return"controlgroupLabel"===i?((s=e.element.find(r)).each((function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")})),e._addClass(s,null,"ui-widget ui-widget-content ui-state-default"),void(n=n.concat(s.get()))):void(t.fn[i]&&(o=e["_"+i+"Options"]?e["_"+i+"Options"]("middle"):{classes:{}},e.element.find(r).each((function(){var r=t(this),s=r[i]("instance"),a=t.widget.extend({},o);if("button"!==i||!r.parent(".ui-spinner").length){s||(s=r[i]()[i]("instance")),s&&(a.classes=e._resolveClassesValues(a.classes,s)),r[i](a);var l=r[i]("widget");t.data(l[0],"ui-controlgroup-data",s||r[i]("instance")),n.push(l[0])}}))))})),this.childWidgets=t(t.uniqueSort(n)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each((function(){var n=t(this).data("ui-controlgroup-data");n&&n[e]&&n[e]()}))},_updateCornerClass:function(t,e){var n=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(t,null,n)},_buildSimpleOptions:function(t,e){var n="vertical"===this.options.direction,i={classes:{}};return i.classes[e]={middle:"",first:"ui-corner-"+(n?"top":"left"),last:"ui-corner-"+(n?"bottom":"right"),only:"ui-corner-all"}[t],i},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:!!e&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(n,i){var r={};return t.each(n,(function(t){var s=i.options.classes[t]||"";s=String.prototype.trim.call(s.replace(e,"")),r[t]=(s+" "+n[t]).replace(/\s+/g," ")})),r},_setOption:function(t,e){"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"!==t?this.refresh():this._callChildMethod(e?"disable":"enable")},refresh:function(){var e,n=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],(function(t,i){var r=e[i]().data("ui-controlgroup-data");if(r&&n["_"+r.widgetName+"Options"]){var s=n["_"+r.widgetName+"Options"](1===e.length?"only":i);s.classes=n._resolveClassesValues(s.classes,r),r.element[r.widgetName](s)}else n._updateCornerClass(e[i](),i)})),this._callChildMethod("refresh"))}})})?i.apply(e,r):i)||(t.exports=s)}()},4374:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(9998),n(4719),n(191),n(3049),n(2402),n(7584),n(8075),n(7819),n(2121),n(1642),n(2628)],i=function(t){return t.widget("ui.dialog",{version:"1.14.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var n=t(this).css(e).offset().top;n<0&&t(this).css("top",e.top-n)}},resizable:!0,show:null,title:null,uiDialogTitleHeadingLevel:0,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(t=e.parent.children().eq(e.index)).length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var n=this;this._isOpen&&!1!==this._trigger("beforeClose",e)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t(this.document[0].activeElement).trigger("blur"),this._hide(this.uiDialog,this.options.hide,(function(){n._trigger("close",e)})))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,n){var i=!1,r=this.uiDialog.siblings(".ui-front:visible").map((function(){return+t(this).css("z-index")})).get(),s=Math.max.apply(null,r);return s>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",s+1),i=!0),i&&!n&&this._trigger("focus",e),i},open:function(){var e=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,(function(){e._focusTabbable(),e._trigger("focus")})),this._makeFocusTarget(),this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_restoreTabbableFocus:function(){var e=this.document[0].activeElement;this.uiDialog[0]===e||t.contains(this.uiDialog[0],e)||this._focusTabbable()},_keepFocus:function(t){t.preventDefault(),this._restoreTabbableFocus()},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog","aria-modal":this.options.modal?"true":null}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var n=this.uiDialog.find(":tabbable"),i=n.first(),r=n.last();e.target!==r[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==i[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay((function(){r.trigger("focus")})),e.preventDefault()):(this._delay((function(){i.trigger("focus")})),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}});var n=Number.isInteger(this.options.uiDialogTitleHeadingLevel)&&this.options.uiDialogTitleHeadingLevel>0&&this.options.uiDialogTitleHeadingLevel<=6?"h"+this.options.uiDialogTitleHeadingLevel:"span";e=t("<"+n+">").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,n=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(n)||Array.isArray(n)&&!n.length?this._removeClass(this.uiDialog,"ui-dialog-buttons"):(t.each(n,(function(n,i){var r,s;i="function"==typeof i?{click:i,text:n}:i,i=t.extend({type:"button"},i),r=i.click,s={icon:i.icon,iconPosition:i.iconPosition,showLabel:i.showLabel,icons:i.icons,text:i.text},delete i.click,delete i.icon,delete i.iconPosition,delete i.showLabel,delete i.icons,"boolean"==typeof i.text&&delete i.text,t("<button></button>",i).button(s).appendTo(e.uiButtonSet).on("click",(function(){r.apply(e.element[0],arguments)}))})),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var e=this,n=this.options;function i(t){return{position:t.position,offset:t.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){e._addClass(t(this),"ui-dialog-dragging"),e._blockFrames(),e._trigger("dragStart",n,i(r))},drag:function(t,n){e._trigger("drag",t,i(n))},stop:function(r,s){var o=s.offset.left-e.document.scrollLeft(),a=s.offset.top-e.document.scrollTop();n.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" top"+(a>=0?"+":"")+a,of:e.window},e._removeClass(t(this),"ui-dialog-dragging"),e._unblockFrames(),e._trigger("dragStop",r,i(s))}})},_makeResizable:function(){var e=this,n=this.options,i=n.resizable,r=this.uiDialog.css("position"),s="string"==typeof i?i:"n,e,s,w,se,sw,ne,nw";function o(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,i){e._addClass(t(this),"ui-dialog-resizing"),e._blockFrames(),e._trigger("resizeStart",n,o(i))},resize:function(t,n){e._trigger("resize",t,o(n))},stop:function(i,r){var s=e.uiDialog.offset(),a=s.left-e.document.scrollLeft(),l=s.top-e.document.scrollTop();n.height=e.uiDialog.height(),n.width=e.uiDialog.width(),n.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(l>=0?"+":"")+l,of:e.window},e._removeClass(t(this),"ui-dialog-resizing"),e._unblockFrames(),e._trigger("resizeStop",i,o(r))}}).css("position",r)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),n=t.inArray(this,e);-1!==n&&e.splice(n,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var n=this,i=!1,r={};t.each(e,(function(t,e){n._setOption(t,e),t in n.sizeRelatedOptions&&(i=!0),t in n.resizableRelatedOptions&&(r[t]=e)})),i&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",r)},_setOption:function(e,n){var i,r,s=this.uiDialog;"disabled"!==e&&(this._super(e,n),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&((i=s.is(":data(ui-draggable)"))&&!n&&s.draggable("destroy"),!i&&n&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((r=s.is(":data(ui-resizable)"))&&!n&&s.resizable("destroy"),r&&"string"==typeof n&&s.resizable("option","handles",n),r||!1===n||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")),"modal"===e&&s.attr("aria-modal",n?"true":null))},_size:function(){var t,e,n,i=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),i.minWidth>i.width&&(i.width=i.minWidth),t=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),e=Math.max(0,i.minHeight-t),n="number"==typeof i.maxHeight?Math.max(0,i.maxHeight-t):"none","auto"===i.height?this.element.css({minHeight:e,maxHeight:n,height:"auto"}):this.element.height(Math.max(0,i.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map((function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]}))},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay((function(){e=!1})),this.document.data("ui-dialog-overlays")||this.document.on("focusin.ui-dialog",function(t){if(!e){var n=this._trackingInstances()[0];n._allowInteraction(t)||(t.preventDefault(),n._focusTabbable())}}.bind(this)),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this.document.off("focusin.ui-dialog"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!0===t.uiBackCompat&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog},void 0===(s=i.apply(e,r))||(t.exports=s)}()},4719:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(191),n(2812),n(9587),n(2362),n(1642),n(2628)],void 0===(s="function"==typeof(i=function(t){return t.widget("ui.draggable",t.ui.mouse,{version:"1.14.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(e){var n=this.options;return!(this.helper||n.disabled||t(e.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(e),!this.handle||(this._blurActiveElement(e),this._blockFrames(!0===n.iframeFix?"iframe":n.iframeFix),0)))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map((function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]}))},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var n=this.document[0].activeElement;t(e.target).closest(n).length||t(n).trigger("blur")},_mouseStart:function(e){var n=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter((function(){return"fixed"===t(this).css("position")})).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,n){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(!1===this._trigger("drag",e,i))return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=i.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var n=this,i=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(i=t.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||!0===this.options.revert||"function"==typeof this.options.revert&&this.options.revert.call(this.element,i)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),(function(){!1!==n._trigger("stop",e)&&n._clear()})):!1!==this._trigger("stop",e)&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var n=this.options,i="function"==typeof n.helper,r=i?t(n.helper.apply(this.element[0],[e])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i&&r[0]===this.element[0]&&this._setPositionRelative(),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),Array.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),n=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==n&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,n,i,r=this.options,s=this.document[0];this.relativeContainer=null,r.containment?"window"!==r.containment?"document"!==r.containment?r.containment.constructor!==Array?("parent"===r.containment&&(r.containment=this.helper[0].parentNode),(i=(n=t(r.containment))[0])&&(e=/(scroll|auto)/.test(n.css("overflow")),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=n)):this.containment=r.containment:this.containment=[0,0,t(s).width()-this.helperProportions.width-this.margins.left,(t(s).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(t,e){e||(e=this.position);var n="absolute"===t?1:-1,i=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.offset.scroll.top:i?0:this.offset.scroll.top)*n,left:e.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.offset.scroll.left:i?0:this.offset.scroll.left)*n}},_generatePosition:function(t,e){var n,i,r,s,o=this.options,a=this._isRootNode(this.scrollParent[0]),l=t.pageX,c=t.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(i=this.relativeContainer.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(c=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(c=n[3]+this.offset.click.top)),o.grid&&(r=o.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,c=n?r-this.offset.click.top>=n[1]||r-this.offset.click.top>n[3]?r:r-this.offset.click.top>=n[1]?r-o.grid[1]:r+o.grid[1]:r,s=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s),"y"===o.axis&&(l=this.originalPageX),"x"===o.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,n,i){return i=i||this._uiHash(),t.ui.plugin.call(this,e,[n,i,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),i.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,n,i){var r=t.extend({},n,{item:i.element});i.sortables=[],t(i.options.connectToSortable).each((function(){var n=t(this).sortable("instance");n&&!n.options.disabled&&(i.sortables.push(n),n.refreshPositions(),n._trigger("activate",e,r))}))},stop:function(e,n,i){var r=t.extend({},n,{item:i.element});i.cancelHelperRemoval=!1,t.each(i.sortables,(function(){var t=this;t.isOver?(t.isOver=0,i.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,r))}))},drag:function(e,n,i){t.each(i.sortables,(function(){var r=!1,s=this;s.positionAbs=i.positionAbs,s.helperProportions=i.helperProportions,s.offset.click=i.offset.click,s._intersectsWith(s.containerCache)&&(r=!0,t.each(i.sortables,(function(){return this.positionAbs=i.positionAbs,this.helperProportions=i.helperProportions,this.offset.click=i.offset.click,this!==s&&this._intersectsWith(this.containerCache)&&t.contains(s.element[0],this.element[0])&&(r=!1),r}))),r?(s.isOver||(s.isOver=1,i._parent=n.helper.parent(),s.currentItem=n.helper.appendTo(s.element).data("ui-sortable-item",!0),s.options._helper=s.options.helper,s.options.helper=function(){return n.helper[0]},e.target=s.currentItem[0],s._mouseCapture(e,!0),s._mouseStart(e,!0,!0),s.offset.click.top=i.offset.click.top,s.offset.click.left=i.offset.click.left,s.offset.parent.left-=i.offset.parent.left-s.offset.parent.left,s.offset.parent.top-=i.offset.parent.top-s.offset.parent.top,i._trigger("toSortable",e),i.dropped=s.element,t.each(i.sortables,(function(){this.refreshPositions()})),i.currentItem=i.element,s.fromOutside=i),s.currentItem&&(s._mouseDrag(e),n.position=s.position)):s.isOver&&(s.isOver=0,s.cancelHelperRemoval=!0,s.options._revert=s.options.revert,s.options.revert=!1,s._trigger("out",e,s._uiHash(s)),s._mouseStop(e,!0),s.options.revert=s.options._revert,s.options.helper=s.options._helper,s.placeholder&&s.placeholder.remove(),n.helper.appendTo(i._parent),i._refreshOffsets(e),n.position=i._generatePosition(e,!0),i._trigger("fromSortable",e),i.dropped=!1,t.each(i.sortables,(function(){this.refreshPositions()})))}))}}),t.ui.plugin.add("draggable","cursor",{start:function(e,n,i){var r=t("body"),s=i.options;r.css("cursor")&&(s._cursor=r.css("cursor")),r.css("cursor",s.cursor)},stop:function(e,n,i){var r=i.options;r._cursor&&t("body").css("cursor",r._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,n,i){var r=t(n.helper),s=i.options;r.css("opacity")&&(s._opacity=r.css("opacity")),r.css("opacity",s.opacity)},stop:function(e,n,i){var r=i.options;r._opacity&&t(n.helper).css("opacity",r._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,n){n.scrollParentNotHidden||(n.scrollParentNotHidden=n.helper.scrollParent(!1)),n.scrollParentNotHidden[0]!==n.document[0]&&"HTML"!==n.scrollParentNotHidden[0].tagName&&(n.overflowOffset=n.scrollParentNotHidden.offset())},drag:function(e,n,i){var r=i.options,s=!1,o=i.scrollParentNotHidden[0],a=i.document[0];o!==a&&"HTML"!==o.tagName?(r.axis&&"x"===r.axis||(i.overflowOffset.top+o.offsetHeight-e.pageY<r.scrollSensitivity?o.scrollTop=s=o.scrollTop+r.scrollSpeed:e.pageY-i.overflowOffset.top<r.scrollSensitivity&&(o.scrollTop=s=o.scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(i.overflowOffset.left+o.offsetWidth-e.pageX<r.scrollSensitivity?o.scrollLeft=s=o.scrollLeft+r.scrollSpeed:e.pageX-i.overflowOffset.left<r.scrollSensitivity&&(o.scrollLeft=s=o.scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(e.pageY-t(a).scrollTop()<r.scrollSensitivity?s=t(a).scrollTop(t(a).scrollTop()-r.scrollSpeed):t(window).height()-(e.pageY-t(a).scrollTop())<r.scrollSensitivity&&(s=t(a).scrollTop(t(a).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(e.pageX-t(a).scrollLeft()<r.scrollSensitivity?s=t(a).scrollLeft(t(a).scrollLeft()-r.scrollSpeed):t(window).width()-(e.pageX-t(a).scrollLeft())<r.scrollSensitivity&&(s=t(a).scrollLeft(t(a).scrollLeft()+r.scrollSpeed)))),!1!==s&&t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,n,i){var r=i.options;i.snapElements=[],t(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each((function(){var e=t(this),n=e.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:n.top,left:n.left})}))},drag:function(e,n,i){var r,s,o,a,l,c,u,h,d,p,f=i.options,m=f.snapTolerance,g=n.offset.left,_=g+i.helperProportions.width,v=n.offset.top,y=v+i.helperProportions.height;for(d=i.snapElements.length-1;d>=0;d--)c=(l=i.snapElements[d].left-i.margins.left)+i.snapElements[d].width,h=(u=i.snapElements[d].top-i.margins.top)+i.snapElements[d].height,_<l-m||g>c+m||y<u-m||v>h+m||!t.contains(i.snapElements[d].item.ownerDocument,i.snapElements[d].item)?(i.snapElements[d].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[d].item})),i.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(r=Math.abs(u-y)<=m,s=Math.abs(h-v)<=m,o=Math.abs(l-_)<=m,a=Math.abs(c-g)<=m,r&&(n.position.top=i._convertPositionTo("relative",{top:u-i.helperProportions.height,left:0}).top),s&&(n.position.top=i._convertPositionTo("relative",{top:h,left:0}).top),o&&(n.position.left=i._convertPositionTo("relative",{top:0,left:l-i.helperProportions.width}).left),a&&(n.position.left=i._convertPositionTo("relative",{top:0,left:c}).left)),p=r||s||o||a,"outer"!==f.snapMode&&(r=Math.abs(u-v)<=m,s=Math.abs(h-y)<=m,o=Math.abs(l-g)<=m,a=Math.abs(c-_)<=m,r&&(n.position.top=i._convertPositionTo("relative",{top:u,left:0}).top),s&&(n.position.top=i._convertPositionTo("relative",{top:h-i.helperProportions.height,left:0}).top),o&&(n.position.left=i._convertPositionTo("relative",{top:0,left:l}).left),a&&(n.position.left=i._convertPositionTo("relative",{top:0,left:c-i.helperProportions.width}).left)),!i.snapElements[d].snapping&&(r||s||o||a||p)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[d].item})),i.snapElements[d].snapping=r||s||o||a||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,n,i){var r,s=i.options,o=t.makeArray(t(s.stack)).sort((function(e,n){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(n).css("zIndex"),10)||0)}));o.length&&(r=parseInt(t(o[0]).css("zIndex"),10)||0,t(o).each((function(e){t(this).css("zIndex",r+e)})),this.css("zIndex",r+o.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,n,i){var r=t(n.helper),s=i.options;r.css("zIndex")&&(s._zIndex=r.css("zIndex")),r.css("zIndex",s.zIndex)},stop:function(e,n,i){var r=i.options;r._zIndex&&t(n.helper).css("zIndex",r._zIndex)}}),t.ui.draggable})?i.apply(e,r):i)||(t.exports=s)}()},191:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(1642),n(2628)],void 0===(s="function"==typeof(i=function(t){var e=!1;return t(document).on("mouseup",(function(){e=!1})),t.widget("ui.mouse",{version:"1.14.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,(function(t){return e._mouseDown(t)})).on("click."+this.widgetName,(function(n){if(!0===t.data(n.target,e.widgetName+".preventClickEvent"))return t.removeData(n.target,e.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1})),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!e){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,r=1===n.which,s="string"==typeof this.options.cancel&&t(n.target).closest(this.options.cancel).length;return!(r&&!s&&this._mouseCapture(n)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout((function(){i.mouseDelayMet=!0}),this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=!1!==this._mouseStart(n),!this._mouseStarted)?(n.preventDefault(),0):(!0===t.data(n.target,this.widgetName+".preventClickEvent")&&t.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),e=!0,0)))}},_mouseMove:function(t){if(this._mouseMoved&&!t.which)if(t.originalEvent.altKey||t.originalEvent.ctrlKey||t.originalEvent.metaKey||t.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(t);return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(n){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,n.target===this._mouseDownEvent.target&&t.data(n.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(n)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,e=!1,n.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})?i.apply(e,r):i)||(t.exports=s)}()},3049:(t,e,n)=>{var i,r,s;!function(){"use strict";r=[n(1929),n(191),n(1677),n(9587),n(1642),n(2628)],i=function(t){return t.widget("ui.resizable",t.ui.mouse,{version:"1.14.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,n){var i,r=!1,s=t(e).css("overflow");if("hidden"===s)return!1;if("scroll"===s)return!0;if(e[i=n&&"left"===n?"scrollLeft":"scrollTop"]>0)return!0;try{e[i]=1,r=e[i]>0,e[i]=0}catch(t){}return r},_create:function(){var e,n=this.options,i=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper'></div>").css({overflow:"hidden",position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this._proportionallyResize()),this._setupHandles(),n.autoHide&&t(this.element).on("mouseenter",(function(){n.disabled||(i._removeClass("ui-resizable-autohide"),i._handles.show())})).on("mouseleave",(function(){n.disabled||i.resizing||(i._addClass("ui-resizable-autohide"),i._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy(),this._addedHandles.remove();var e,n=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable")};return this.elementIsWrapper&&(n(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;case"aspectRatio":this._aspectRatio=!!e}},_setupHandles:function(){var e,n,i,r,s,o=this.options,a=this;if(this.handles=o.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this._addedHandles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),i=this.handles.split(","),this.handles={},n=0;n<i.length;n++)r="ui-resizable-"+(e=String.prototype.trim.call(i[n])),s=t("<div>"),this._addClass(s,"ui-resizable-handle "+r),s.css({zIndex:o.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.children(this.handles[e]).length||(this.element.append(s),this._addedHandles=this._addedHandles.add(s));this._renderAxis=function(e){var n,i,r,s;for(n in e=e||this.element,this.handles)this.handles[n].constructor===String?this.handles[n]=this.element.children(this.handles[n]).first().show():(this.handles[n].jquery||this.handles[n].nodeType)&&(this.handles[n]=t(this.handles[n]),this._on(this.handles[n],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(i=t(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),r=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),e.css(r,s),this._proportionallyResize()),this._handles=this._handles.add(this.handles[n])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",(function(){a.resizing||(this.className&&(s=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=s&&s[1]?s[1]:"se")})),o.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._addedHandles.remove()},_mouseCapture:function(e){var n,i,r=!1;for(n in this.handles)((i=t(this.handles[n])[0])===e.target||t.contains(i,e.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(e){var n,i,r,s,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),n=this._num(this.helper.css("left")),i=this._num(this.helper.css("top")),o.containment&&(n+=t(o.containment).scrollLeft()||0,i+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:i},this._helper||(s=this._calculateAdjustedElementDimensions(a)),this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width,height:s.height},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:s.width,height:s.height},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:n,top:i},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===r?this.axis+"-resize":r),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var n,i,r=this.originalMousePosition,s=this.axis,o=e.pageX-r.left||0,a=e.pageY-r.top||0,l=this._change[s];return this._updatePrevProperties(),!!l&&(n=l.apply(this,[e,o,a]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(n=this._updateRatio(n,e)),n=this._respectSize(n,e),this._updateCache(n),this._propagate("resize",e),i=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(i)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var n,i,r,s,o,a,l,c=this.options,u=this;return this._helper&&(r=(i=(n=this._proportionallyResizeElements).length&&/textarea/i.test(n[0].nodeName))&&this._hasScroll(n[0],"left")?0:u.sizeDiff.height,s=i?0:u.sizeDiff.width,o={width:u.helper.width()-s,height:u.helper.height()-r},a=parseFloat(u.element.css("left"))+(u.position.left-u.originalPosition.left)||null,l=parseFloat(u.element.css("top"))+(u.position.top-u.originalPosition.top)||null,c.animate||this.element.css(t.extend(o,{top:l,left:a})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!c.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.helper.css(t),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px",this.helper.width(t.width)),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px",this.helper.height(t.height)),t},_updateVirtualBoundaries:function(t){var e,n,i,r,s,o=this.options;s={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||t)&&(e=s.minHeight*this.aspectRatio,i=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,e>s.minWidth&&(s.minWidth=e),i>s.minHeight&&(s.minHeight=i),n<s.maxWidth&&(s.maxWidth=n),r<s.maxHeight&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,n=this.size,i=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===i&&(t.left=e.left+(n.width-t.width),t.top=null),"nw"===i&&(t.top=e.top+(n.height-t.height),t.left=e.left+(n.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,n=this.axis,i=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,r=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,s=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,o=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,a=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,c=/sw|nw|w/.test(n),u=/nw|ne|n/.test(n);return s&&(t.width=e.minWidth),o&&(t.height=e.minHeight),i&&(t.width=e.maxWidth),r&&(t.height=e.maxHeight),s&&c&&(t.left=a-e.minWidth),i&&c&&(t.left=a-e.maxWidth),o&&u&&(t.top=l-e.minHeight),r&&u&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,n=[],i=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],r=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];e<4;e++)n[e]=parseFloat(i[e])||0,n[e]+=parseFloat(r[e])||0;return{height:n[0]+n[2],width:n[1]+n[3]}},_calculateAdjustedElementDimensions:function(t){var e,n,i,r=t.get(0);return"content-box"!==t.css("box-sizing")||!this._hasScroll(r)&&!this._hasScroll(r,"left")?{height:parseFloat(t.css("height")),width:parseFloat(t.css("width"))}:(e=parseFloat(r.style.width),n=parseFloat(r.style.height),i=this._getPaddingPlusBorderDimensions(t),e=isNaN(e)?this._getElementTheoreticalSize(t,i,"width"):e,{height:n=isNaN(n)?this._getElementTheoreticalSize(t,i,"height"):n,width:e})},_getElementTheoreticalSize:function(t,e,n){return Math.max(0,Math.ceil(t.get(0)["offset"+n[0].toUpperCase()+n.slice(1)]-e[n]-.5))||0},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,n=this.helper||this.element;e<this._proportionallyResizeElements.length;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:n.height()-this.outerDimensions.height||0,width:n.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,n=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div></div>").css({overflow:"hidden"}),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var n=this.originalSize;return{left:this.originalPosition.left+e,width:n.width-e}},n:function(t,e,n){var i=this.originalSize;return{top:this.originalPosition.top+n,height:i.height-n}},s:function(t,e,n){return{height:this.originalSize.height+n}},se:function(e,n,i){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,n,i]))},sw:function(e,n,i){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,n,i]))},ne:function(e,n,i){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,n,i]))},nw:function(e,n,i){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,n,i]))}},_propagate:function(e,n){t.ui.plugin.call(this,e,[n,this.ui()]),"resize"!==e&&this._trigger(e,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var n=t(this).resizable("instance"),i=n.options,r=n._proportionallyResizeElements,s=r.length&&/textarea/i.test(r[0].nodeName),o=s&&n._hasScroll(r[0],"left")?0:n.sizeDiff.height,a=s?0:n.sizeDiff.width,l={width:n.size.width-a,height:n.size.height-o},c=parseFloat(n.element.css("left"))+(n.position.left-n.originalPosition.left)||null,u=parseFloat(n.element.css("top"))+(n.position.top-n.originalPosition.top)||null;n.element.animate(t.extend(l,u&&c?{top:u,left:c}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseFloat(n.element.css("width")),height:parseFloat(n.element.css("height")),top:parseFloat(n.element.css("top")),left:parseFloat(n.element.css("left"))};r&&r.length&&t(r[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,n,i,r,s,o,a,l=t(this).resizable("instance"),c=l.options,u=l.element,h=c.containment,d=h instanceof t?h.get(0):/parent/.test(h)?u.parent().get(0):h;d&&(l.containerElement=t(d),/document/.test(h)||h===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),n=[],t(["Top","Right","Left","Bottom"]).each((function(t,i){n[t]=l._num(e.css("padding"+i))})),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-n[3],width:e.innerWidth()-n[1]},i=l.containerOffset,r=l.containerSize.height,s=l.containerSize.width,o=l._hasScroll(d,"left")?d.scrollWidth:s,a=l._hasScroll(d)?d.scrollHeight:r,l.parentData={element:d,left:i.left,top:i.top,width:o,height:a}))},resize:function(e){var n,i,r,s,o=t(this).resizable("instance"),a=o.options,l=o.containerOffset,c=o.position,u=o._aspectRatio||e.shiftKey,h={top:0,left:0},d=o.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(h=l),c.left<(o._helper?l.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-l.left:o.position.left-h.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=a.helper?l.left:0),c.top<(o._helper?l.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-l.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?l.top:0),r=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),r&&s?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),n=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-h.left:o.offset.left-l.left)),i=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-h.top:o.offset.top-l.top)),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),i+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-i,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),n=e.options,i=e.containerOffset,r=e.containerPosition,s=e.containerElement,o=t(e.helper),a=o.offset(),l=o.outerWidth()-e.sizeDiff.width,c=o.outerHeight()-e.sizeDiff.height;e._helper&&!n.animate&&/relative/.test(s.css("position"))&&t(this).css({left:a.left-r.left-i.left,width:l,height:c}),e._helper&&!n.animate&&/static/.test(s.css("position"))&&t(this).css({left:a.left-r.left-i.left,width:l,height:c})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),n=e.options;t(n.alsoResize).each((function(){var n=t(this),i=e._calculateAdjustedElementDimensions(n);n.data("ui-resizable-alsoresize",{width:i.width,height:i.height,left:parseFloat(n.css("left")),top:parseFloat(n.css("top"))})}))},resize:function(e,n){var i=t(this).resizable("instance"),r=i.options,s=i.originalSize,o=i.originalPosition,a={height:i.size.height-s.height||0,width:i.size.width-s.width||0,top:i.position.top-o.top||0,left:i.position.left-o.left||0};t(r.alsoResize).each((function(){var e=t(this),i=t(this).data("ui-resizable-alsoresize"),r={},s=e.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(s,(function(t,e){var n=(i[e]||0)+(a[e]||0);n&&n>=0&&(r[e]=n||null)})),e.css(r)}))},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),n=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),!0===t.uiBackCompat&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,n=t(this).resizable("instance"),i=n.options,r=n.size,s=n.originalSize,o=n.originalPosition,a=n.axis,l="number"==typeof i.grid?[i.grid,i.grid]:i.grid,c=l[0]||1,u=l[1]||1,h=Math.round((r.width-s.width)/c)*c,d=Math.round((r.height-s.height)/u)*u,p=s.width+h,f=s.height+d,m=i.maxWidth&&i.maxWidth<p,g=i.maxHeight&&i.maxHeight<f,_=i.minWidth&&i.minWidth>p,v=i.minHeight&&i.minHeight>f;i.grid=l,_&&(p+=c),v&&(f+=u),m&&(p-=c),g&&(f-=u),/^(se|s|e)$/.test(a)?(n.size.width=p,n.size.height=f):/^(ne)$/.test(a)?(n.size.width=p,n.size.height=f,n.position.top=o.top-d):/^(sw)$/.test(a)?(n.size.width=p,n.size.height=f,n.position.left=o.left-h):((f-u<=0||p-c<=0)&&(e=n._getPaddingPlusBorderDimensions(this)),f-u>0?(n.size.height=f,n.position.top=o.top-d):(f=u-e.height,n.size.height=f,n.position.top=o.top+s.height-f),p-c>0?(n.size.width=p,n.position.left=o.left-h):(p=c-e.width,n.size.width=p,n.position.left=o.left+s.width-p))}}),t.ui.resizable},void 0===(s=i.apply(e,r))||(t.exports=s)}()},1929:function(t,e){var n;!function(e,n){"use strict";"object"==typeof t.exports?t.exports=e.document?n(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return n(t)}:n(e)}("undefined"!=typeof window?window:this,(function(i,r){"use strict";var s=[],o=Object.getPrototypeOf,a=s.slice,l=s.flat?function(t){return s.flat.call(t)}:function(t){return s.concat.apply([],t)},c=s.push,u=s.indexOf,h={},d=h.toString,p=h.hasOwnProperty,f=p.toString,m=f.call(Object),g={},_=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},v=function(t){return null!=t&&t===t.window},y=i.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function x(t,e,n){var i,r,s=(n=n||y).createElement("script");if(s.text=t,e)for(i in b)(r=e[i]||e.getAttribute&&e.getAttribute(i))&&s.setAttribute(i,r);n.head.appendChild(s).parentNode.removeChild(s)}function w(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?h[d.call(t)]||"object":typeof t}var S="3.7.1",A=/HTML$/i,M=function(t,e){return new M.fn.init(t,e)};function C(t){var e=!!t&&"length"in t&&t.length,n=w(t);return!_(t)&&!v(t)&&("array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t)}function E(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}M.fn=M.prototype={jquery:S,constructor:M,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=M.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return M.each(this,t)},map:function(t){return this.pushStack(M.map(this,(function(e,n){return t.call(e,n,e)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(M.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(M.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,n=+t+(t<0?e:0);return this.pushStack(n>=0&&n<e?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:s.sort,splice:s.splice},M.extend=M.fn.extend=function(){var t,e,n,i,r,s,o=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[a]||{},a++),"object"==typeof o||_(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)i=t[e],"__proto__"!==e&&o!==i&&(c&&i&&(M.isPlainObject(i)||(r=Array.isArray(i)))?(n=o[e],s=r&&!Array.isArray(n)?[]:r||M.isPlainObject(n)?n:{},r=!1,o[e]=M.extend(c,s,i)):void 0!==i&&(o[e]=i));return o},M.extend({expando:"jQuery"+(S+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,n;return!(!t||"[object Object]"!==d.call(t)||(e=o(t))&&("function"!=typeof(n=p.call(e,"constructor")&&e.constructor)||f.call(n)!==m))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,n){x(t,{nonce:e&&e.nonce},n)},each:function(t,e){var n,i=0;if(C(t))for(n=t.length;i<n&&!1!==e.call(t[i],i,t[i]);i++);else for(i in t)if(!1===e.call(t[i],i,t[i]))break;return t},text:function(t){var e,n="",i=0,r=t.nodeType;if(!r)for(;e=t[i++];)n+=M.text(e);return 1===r||11===r?t.textContent:9===r?t.documentElement.textContent:3===r||4===r?t.nodeValue:n},makeArray:function(t,e){var n=e||[];return null!=t&&(C(Object(t))?M.merge(n,"string"==typeof t?[t]:t):c.call(n,t)),n},inArray:function(t,e,n){return null==e?-1:u.call(e,t,n)},isXMLDoc:function(t){var e=t&&t.namespaceURI,n=t&&(t.ownerDocument||t).documentElement;return!A.test(e||n&&n.nodeName||"HTML")},merge:function(t,e){for(var n=+e.length,i=0,r=t.length;i<n;i++)t[r++]=e[i];return t.length=r,t},grep:function(t,e,n){for(var i=[],r=0,s=t.length,o=!n;r<s;r++)!e(t[r],r)!==o&&i.push(t[r]);return i},map:function(t,e,n){var i,r,s=0,o=[];if(C(t))for(i=t.length;s<i;s++)null!=(r=e(t[s],s,n))&&o.push(r);else for(s in t)null!=(r=e(t[s],s,n))&&o.push(r);return l(o)},guid:1,support:g}),"function"==typeof Symbol&&(M.fn[Symbol.iterator]=s[Symbol.iterator]),M.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){h["[object "+e+"]"]=e.toLowerCase()}));var T=s.pop,P=s.sort,I=s.splice,R="[\\x20\\t\\r\\n\\f]",k=new RegExp("^"+R+"+|((?:^|[^\\\\])(?:\\\\.)*)"+R+"+$","g");M.contains=function(t,e){var n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(t.contains?t.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))};var D=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function L(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}M.escapeSelector=function(t){return(t+"").replace(D,L)};var O=y,N=c;!function(){var t,e,n,r,o,l,c,h,d,f,m=N,_=M.expando,v=0,y=0,b=tt(),x=tt(),w=tt(),S=tt(),A=function(t,e){return t===e&&(o=!0),0},C="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",D="(?:\\\\[\\da-fA-F]{1,6}"+R+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",L="\\["+R+"*("+D+")(?:"+R+"*([*^$|!~]?=)"+R+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+D+"))|)"+R+"*\\]",F=":("+D+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+L+")*)|.*)\\)|)",B=new RegExp(R+"+","g"),U=new RegExp("^"+R+"*,"+R+"*"),z=new RegExp("^"+R+"*([>+~]|"+R+")"+R+"*"),V=new RegExp(R+"|>"),H=new RegExp(F),G=new RegExp("^"+D+"$"),$={ID:new RegExp("^#("+D+")"),CLASS:new RegExp("^\\.("+D+")"),TAG:new RegExp("^("+D+"|[*])"),ATTR:new RegExp("^"+L),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+R+"*(even|odd|(([+-]|)(\\d*)n|)"+R+"*(?:([+-]|)"+R+"*(\\d+)|))"+R+"*\\)|)","i"),bool:new RegExp("^(?:"+C+")$","i"),needsContext:new RegExp("^"+R+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+R+"*((?:-\\d)?\\d*)"+R+"*\\)|)(?=[^-]|$)","i")},j=/^(?:input|select|textarea|button)$/i,W=/^h\d$/i,q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,Y=new RegExp("\\\\[\\da-fA-F]{1,6}"+R+"?|\\\\([^\\r\\n\\f])","g"),K=function(t,e){var n="0x"+t.slice(1)-65536;return e||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},Z=function(){lt()},Q=dt((function(t){return!0===t.disabled&&E(t,"fieldset")}),{dir:"parentNode",next:"legend"});try{m.apply(s=a.call(O.childNodes),O.childNodes),s[O.childNodes.length].nodeType}catch(t){m={apply:function(t,e){N.apply(t,a.call(e))},call:function(t){N.apply(t,a.call(arguments,1))}}}function J(t,e,n,i){var r,s,o,a,c,u,p,f=e&&e.ownerDocument,v=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==v&&9!==v&&11!==v)return n;if(!i&&(lt(e),e=e||l,h)){if(11!==v&&(c=q.exec(t)))if(r=c[1]){if(9===v){if(!(o=e.getElementById(r)))return n;if(o.id===r)return m.call(n,o),n}else if(f&&(o=f.getElementById(r))&&J.contains(e,o)&&o.id===r)return m.call(n,o),n}else{if(c[2])return m.apply(n,e.getElementsByTagName(t)),n;if((r=c[3])&&e.getElementsByClassName)return m.apply(n,e.getElementsByClassName(r)),n}if(!(S[t+" "]||d&&d.test(t))){if(p=t,f=e,1===v&&(V.test(t)||z.test(t))){for((f=X.test(t)&&at(e.parentNode)||e)==e&&g.scope||((a=e.getAttribute("id"))?a=M.escapeSelector(a):e.setAttribute("id",a=_)),s=(u=ut(t)).length;s--;)u[s]=(a?"#"+a:":scope")+" "+ht(u[s]);p=u.join(",")}try{return m.apply(n,f.querySelectorAll(p)),n}catch(e){S(t,!0)}finally{a===_&&e.removeAttribute("id")}}}return vt(t.replace(k,"$1"),e,n,i)}function tt(){var t=[];return function n(i,r){return t.push(i+" ")>e.cacheLength&&delete n[t.shift()],n[i+" "]=r}}function et(t){return t[_]=!0,t}function nt(t){var e=l.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function it(t){return function(e){return E(e,"input")&&e.type===t}}function rt(t){return function(e){return(E(e,"input")||E(e,"button"))&&e.type===t}}function st(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Q(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ot(t){return et((function(e){return e=+e,et((function(n,i){for(var r,s=t([],n.length,e),o=s.length;o--;)n[r=s[o]]&&(n[r]=!(i[r]=n[r]))}))}))}function at(t){return t&&void 0!==t.getElementsByTagName&&t}function lt(t){var n,i=t?t.ownerDocument||t:O;return i!=l&&9===i.nodeType&&i.documentElement?(c=(l=i).documentElement,h=!M.isXMLDoc(l),f=c.matches||c.webkitMatchesSelector||c.msMatchesSelector,c.msMatchesSelector&&O!=l&&(n=l.defaultView)&&n.top!==n&&n.addEventListener("unload",Z),g.getById=nt((function(t){return c.appendChild(t).id=M.expando,!l.getElementsByName||!l.getElementsByName(M.expando).length})),g.disconnectedMatch=nt((function(t){return f.call(t,"*")})),g.scope=nt((function(){return l.querySelectorAll(":scope")})),g.cssHas=nt((function(){try{return l.querySelector(":has(*,:jqfake)"),!1}catch(t){return!0}})),g.getById?(e.filter.ID=function(t){var e=t.replace(Y,K);return function(t){return t.getAttribute("id")===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&h){var n=e.getElementById(t);return n?[n]:[]}}):(e.filter.ID=function(t){var e=t.replace(Y,K);return function(t){var n=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return n&&n.value===e}},e.find.ID=function(t,e){if(void 0!==e.getElementById&&h){var n,i,r,s=e.getElementById(t);if(s){if((n=s.getAttributeNode("id"))&&n.value===t)return[s];for(r=e.getElementsByName(t),i=0;s=r[i++];)if((n=s.getAttributeNode("id"))&&n.value===t)return[s]}return[]}}),e.find.TAG=function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):e.querySelectorAll(t)},e.find.CLASS=function(t,e){if(void 0!==e.getElementsByClassName&&h)return e.getElementsByClassName(t)},d=[],nt((function(t){var e;c.appendChild(t).innerHTML="<a id='"+_+"' href='' disabled='disabled'></a><select id='"+_+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||d.push("\\["+R+"*(?:value|"+C+")"),t.querySelectorAll("[id~="+_+"-]").length||d.push("~="),t.querySelectorAll("a#"+_+"+*").length||d.push(".#.+[+~]"),t.querySelectorAll(":checked").length||d.push(":checked"),(e=l.createElement("input")).setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),c.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(e=l.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||d.push("\\["+R+"*name"+R+"*="+R+"*(?:''|\"\")")})),g.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),A=function(t,e){if(t===e)return o=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!g.sortDetached&&e.compareDocumentPosition(t)===n?t===l||t.ownerDocument==O&&J.contains(O,t)?-1:e===l||e.ownerDocument==O&&J.contains(O,e)?1:r?u.call(r,t)-u.call(r,e):0:4&n?-1:1)},l):l}for(t in J.matches=function(t,e){return J(t,null,null,e)},J.matchesSelector=function(t,e){if(lt(t),h&&!S[e+" "]&&(!d||!d.test(e)))try{var n=f.call(t,e);if(n||g.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){S(e,!0)}return J(e,l,null,[t]).length>0},J.contains=function(t,e){return(t.ownerDocument||t)!=l&&lt(t),M.contains(t,e)},J.attr=function(t,n){(t.ownerDocument||t)!=l&&lt(t);var i=e.attrHandle[n.toLowerCase()],r=i&&p.call(e.attrHandle,n.toLowerCase())?i(t,n,!h):void 0;return void 0!==r?r:t.getAttribute(n)},J.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},M.uniqueSort=function(t){var e,n=[],i=0,s=0;if(o=!g.sortStable,r=!g.sortStable&&a.call(t,0),P.call(t,A),o){for(;e=t[s++];)e===t[s]&&(i=n.push(s));for(;i--;)I.call(t,n[i],1)}return r=null,t},M.fn.uniqueSort=function(){return this.pushStack(M.uniqueSort(a.apply(this)))},e=M.expr={cacheLength:50,createPseudo:et,match:$,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Y,K),t[3]=(t[3]||t[4]||t[5]||"").replace(Y,K),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||J.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&J.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return $.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&H.test(n)&&(e=ut(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Y,K).toLowerCase();return"*"===t?function(){return!0}:function(t){return E(t,e)}},CLASS:function(t){var e=b[t+" "];return e||(e=new RegExp("(^|"+R+")"+t+"("+R+"|$)"))&&b(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,n){return function(i){var r=J.attr(i,t);return null==r?"!="===e:!e||(r+="","="===e?r===n:"!="===e?r!==n:"^="===e?n&&0===r.indexOf(n):"*="===e?n&&r.indexOf(n)>-1:"$="===e?n&&r.slice(-n.length)===n:"~="===e?(" "+r.replace(B," ")+" ").indexOf(n)>-1:"|="===e&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,n,i,r){var s="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===i&&0===r?function(t){return!!t.parentNode}:function(e,n,l){var c,u,h,d,p,f=s!==o?"nextSibling":"previousSibling",m=e.parentNode,g=a&&e.nodeName.toLowerCase(),y=!l&&!a,b=!1;if(m){if(s){for(;f;){for(h=e;h=h[f];)if(a?E(h,g):1===h.nodeType)return!1;p=f="only"===t&&!p&&"nextSibling"}return!0}if(p=[o?m.firstChild:m.lastChild],o&&y){for(b=(d=(c=(u=m[_]||(m[_]={}))[t]||[])[0]===v&&c[1])&&c[2],h=d&&m.childNodes[d];h=++d&&h&&h[f]||(b=d=0)||p.pop();)if(1===h.nodeType&&++b&&h===e){u[t]=[v,d,b];break}}else if(y&&(b=d=(c=(u=e[_]||(e[_]={}))[t]||[])[0]===v&&c[1]),!1===b)for(;(h=++d&&h&&h[f]||(b=d=0)||p.pop())&&(!(a?E(h,g):1===h.nodeType)||!++b||(y&&((u=h[_]||(h[_]={}))[t]=[v,b]),h!==e)););return(b-=r)===i||b%i==0&&b/i>=0}}},PSEUDO:function(t,n){var i,r=e.pseudos[t]||e.setFilters[t.toLowerCase()]||J.error("unsupported pseudo: "+t);return r[_]?r(n):r.length>1?(i=[t,t,"",n],e.setFilters.hasOwnProperty(t.toLowerCase())?et((function(t,e){for(var i,s=r(t,n),o=s.length;o--;)t[i=u.call(t,s[o])]=!(e[i]=s[o])})):function(t){return r(t,0,i)}):r}},pseudos:{not:et((function(t){var e=[],n=[],i=_t(t.replace(k,"$1"));return i[_]?et((function(t,e,n,r){for(var s,o=i(t,null,r,[]),a=t.length;a--;)(s=o[a])&&(t[a]=!(e[a]=s))})):function(t,r,s){return e[0]=t,i(e,null,s,n),e[0]=null,!n.pop()}})),has:et((function(t){return function(e){return J(t,e).length>0}})),contains:et((function(t){return t=t.replace(Y,K),function(e){return(e.textContent||M.text(e)).indexOf(t)>-1}})),lang:et((function(t){return G.test(t||"")||J.error("unsupported lang: "+t),t=t.replace(Y,K).toLowerCase(),function(e){var n;do{if(n=h?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(n=n.toLowerCase())===t||0===n.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(t){var e=i.location&&i.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===c},focus:function(t){return t===function(){try{return l.activeElement}catch(t){}}()&&l.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:st(!1),disabled:st(!0),checked:function(t){return E(t,"input")&&!!t.checked||E(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!e.pseudos.empty(t)},header:function(t){return W.test(t.nodeName)},input:function(t){return j.test(t.nodeName)},button:function(t){return E(t,"input")&&"button"===t.type||E(t,"button")},text:function(t){var e;return E(t,"input")&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:ot((function(){return[0]})),last:ot((function(t,e){return[e-1]})),eq:ot((function(t,e,n){return[n<0?n+e:n]})),even:ot((function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t})),odd:ot((function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t})),lt:ot((function(t,e,n){var i;for(i=n<0?n+e:n>e?e:n;--i>=0;)t.push(i);return t})),gt:ot((function(t,e,n){for(var i=n<0?n+e:n;++i<e;)t.push(i);return t}))}},e.pseudos.nth=e.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})e.pseudos[t]=it(t);for(t in{submit:!0,reset:!0})e.pseudos[t]=rt(t);function ct(){}function ut(t,n){var i,r,s,o,a,l,c,u=x[t+" "];if(u)return n?0:u.slice(0);for(a=t,l=[],c=e.preFilter;a;){for(o in i&&!(r=U.exec(a))||(r&&(a=a.slice(r[0].length)||a),l.push(s=[])),i=!1,(r=z.exec(a))&&(i=r.shift(),s.push({value:i,type:r[0].replace(k," ")}),a=a.slice(i.length)),e.filter)!(r=$[o].exec(a))||c[o]&&!(r=c[o](r))||(i=r.shift(),s.push({value:i,type:o,matches:r}),a=a.slice(i.length));if(!i)break}return n?a.length:a?J.error(t):x(t,l).slice(0)}function ht(t){for(var e=0,n=t.length,i="";e<n;e++)i+=t[e].value;return i}function dt(t,e,n){var i=e.dir,r=e.next,s=r||i,o=n&&"parentNode"===s,a=y++;return e.first?function(e,n,r){for(;e=e[i];)if(1===e.nodeType||o)return t(e,n,r);return!1}:function(e,n,l){var c,u,h=[v,a];if(l){for(;e=e[i];)if((1===e.nodeType||o)&&t(e,n,l))return!0}else for(;e=e[i];)if(1===e.nodeType||o)if(u=e[_]||(e[_]={}),r&&E(e,r))e=e[i]||e;else{if((c=u[s])&&c[0]===v&&c[1]===a)return h[2]=c[2];if(u[s]=h,h[2]=t(e,n,l))return!0}return!1}}function pt(t){return t.length>1?function(e,n,i){for(var r=t.length;r--;)if(!t[r](e,n,i))return!1;return!0}:t[0]}function ft(t,e,n,i,r){for(var s,o=[],a=0,l=t.length,c=null!=e;a<l;a++)(s=t[a])&&(n&&!n(s,i,r)||(o.push(s),c&&e.push(a)));return o}function mt(t,e,n,i,r,s){return i&&!i[_]&&(i=mt(i)),r&&!r[_]&&(r=mt(r,s)),et((function(s,o,a,l){var c,h,d,p,f=[],g=[],_=o.length,v=s||function(t,e,n){for(var i=0,r=e.length;i<r;i++)J(t,e[i],n);return n}(e||"*",a.nodeType?[a]:a,[]),y=!t||!s&&e?v:ft(v,f,t,a,l);if(n?n(y,p=r||(s?t:_||i)?[]:o,a,l):p=y,i)for(c=ft(p,g),i(c,[],a,l),h=c.length;h--;)(d=c[h])&&(p[g[h]]=!(y[g[h]]=d));if(s){if(r||t){if(r){for(c=[],h=p.length;h--;)(d=p[h])&&c.push(y[h]=d);r(null,p=[],c,l)}for(h=p.length;h--;)(d=p[h])&&(c=r?u.call(s,d):f[h])>-1&&(s[c]=!(o[c]=d))}}else p=ft(p===o?p.splice(_,p.length):p),r?r(null,o,p,l):m.apply(o,p)}))}function gt(t){for(var i,r,s,o=t.length,a=e.relative[t[0].type],l=a||e.relative[" "],c=a?1:0,h=dt((function(t){return t===i}),l,!0),d=dt((function(t){return u.call(i,t)>-1}),l,!0),p=[function(t,e,r){var s=!a&&(r||e!=n)||((i=e).nodeType?h(t,e,r):d(t,e,r));return i=null,s}];c<o;c++)if(r=e.relative[t[c].type])p=[dt(pt(p),r)];else{if((r=e.filter[t[c].type].apply(null,t[c].matches))[_]){for(s=++c;s<o&&!e.relative[t[s].type];s++);return mt(c>1&&pt(p),c>1&&ht(t.slice(0,c-1).concat({value:" "===t[c-2].type?"*":""})).replace(k,"$1"),r,c<s&&gt(t.slice(c,s)),s<o&&gt(t=t.slice(s)),s<o&&ht(t))}p.push(r)}return pt(p)}function _t(t,i){var r,s=[],o=[],a=w[t+" "];if(!a){for(i||(i=ut(t)),r=i.length;r--;)(a=gt(i[r]))[_]?s.push(a):o.push(a);a=w(t,function(t,i){var r=i.length>0,s=t.length>0,o=function(o,a,c,u,d){var p,f,g,_=0,y="0",b=o&&[],x=[],w=n,S=o||s&&e.find.TAG("*",d),A=v+=null==w?1:Math.random()||.1,C=S.length;for(d&&(n=a==l||a||d);y!==C&&null!=(p=S[y]);y++){if(s&&p){for(f=0,a||p.ownerDocument==l||(lt(p),c=!h);g=t[f++];)if(g(p,a||l,c)){m.call(u,p);break}d&&(v=A)}r&&((p=!g&&p)&&_--,o&&b.push(p))}if(_+=y,r&&y!==_){for(f=0;g=i[f++];)g(b,x,a,c);if(o){if(_>0)for(;y--;)b[y]||x[y]||(x[y]=T.call(u));x=ft(x)}m.apply(u,x),d&&!o&&x.length>0&&_+i.length>1&&M.uniqueSort(u)}return d&&(v=A,n=w),b};return r?et(o):o}(o,s)),a.selector=t}return a}function vt(t,n,i,r){var s,o,a,l,c,u="function"==typeof t&&t,d=!r&&ut(t=u.selector||t);if(i=i||[],1===d.length){if((o=d[0]=d[0].slice(0)).length>2&&"ID"===(a=o[0]).type&&9===n.nodeType&&h&&e.relative[o[1].type]){if(!(n=(e.find.ID(a.matches[0].replace(Y,K),n)||[])[0]))return i;u&&(n=n.parentNode),t=t.slice(o.shift().value.length)}for(s=$.needsContext.test(t)?0:o.length;s--&&(a=o[s],!e.relative[l=a.type]);)if((c=e.find[l])&&(r=c(a.matches[0].replace(Y,K),X.test(o[0].type)&&at(n.parentNode)||n))){if(o.splice(s,1),!(t=r.length&&ht(o)))return m.apply(i,r),i;break}}return(u||_t(t,d))(r,n,!h,i,!n||X.test(t)&&at(n.parentNode)||n),i}ct.prototype=e.filters=e.pseudos,e.setFilters=new ct,g.sortStable=_.split("").sort(A).join("")===_,lt(),g.sortDetached=nt((function(t){return 1&t.compareDocumentPosition(l.createElement("fieldset"))})),M.find=J,M.expr[":"]=M.expr.pseudos,M.unique=M.uniqueSort,J.compile=_t,J.select=vt,J.setDocument=lt,J.tokenize=ut,J.escape=M.escapeSelector,J.getText=M.text,J.isXML=M.isXMLDoc,J.selectors=M.expr,J.support=M.support,J.uniqueSort=M.uniqueSort}();var F=function(t,e,n){for(var i=[],r=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&M(t).is(n))break;i.push(t)}return i},B=function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n},U=M.expr.match.needsContext,z=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function V(t,e,n){return _(e)?M.grep(t,(function(t,i){return!!e.call(t,i,t)!==n})):e.nodeType?M.grep(t,(function(t){return t===e!==n})):"string"!=typeof e?M.grep(t,(function(t){return u.call(e,t)>-1!==n})):M.filter(e,t,n)}M.filter=function(t,e,n){var i=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?M.find.matchesSelector(i,t)?[i]:[]:M.find.matches(t,M.grep(e,(function(t){return 1===t.nodeType})))},M.fn.extend({find:function(t){var e,n,i=this.length,r=this;if("string"!=typeof t)return this.pushStack(M(t).filter((function(){for(e=0;e<i;e++)if(M.contains(r[e],this))return!0})));for(n=this.pushStack([]),e=0;e<i;e++)M.find(t,r[e],n);return i>1?M.uniqueSort(n):n},filter:function(t){return this.pushStack(V(this,t||[],!1))},not:function(t){return this.pushStack(V(this,t||[],!0))},is:function(t){return!!V(this,"string"==typeof t&&U.test(t)?M(t):t||[],!1).length}});var H,G=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(M.fn.init=function(t,e,n){var i,r;if(!t)return this;if(n=n||H,"string"==typeof t){if(!(i="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:G.exec(t))||!i[1]&&e)return!e||e.jquery?(e||n).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof M?e[0]:e,M.merge(this,M.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:y,!0)),z.test(i[1])&&M.isPlainObject(e))for(i in e)_(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}return(r=y.getElementById(i[2]))&&(this[0]=r,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):_(t)?void 0!==n.ready?n.ready(t):t(M):M.makeArray(t,this)}).prototype=M.fn,H=M(y);var $=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function W(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}M.fn.extend({has:function(t){var e=M(t,this),n=e.length;return this.filter((function(){for(var t=0;t<n;t++)if(M.contains(this,e[t]))return!0}))},closest:function(t,e){var n,i=0,r=this.length,s=[],o="string"!=typeof t&&M(t);if(!U.test(t))for(;i<r;i++)for(n=this[i];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&M.find.matchesSelector(n,t))){s.push(n);break}return this.pushStack(s.length>1?M.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?u.call(M(t),this[0]):u.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(M.uniqueSort(M.merge(this.get(),M(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),M.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return F(t,"parentNode")},parentsUntil:function(t,e,n){return F(t,"parentNode",n)},next:function(t){return W(t,"nextSibling")},prev:function(t){return W(t,"previousSibling")},nextAll:function(t){return F(t,"nextSibling")},prevAll:function(t){return F(t,"previousSibling")},nextUntil:function(t,e,n){return F(t,"nextSibling",n)},prevUntil:function(t,e,n){return F(t,"previousSibling",n)},siblings:function(t){return B((t.parentNode||{}).firstChild,t)},children:function(t){return B(t.firstChild)},contents:function(t){return null!=t.contentDocument&&o(t.contentDocument)?t.contentDocument:(E(t,"template")&&(t=t.content||t),M.merge([],t.childNodes))}},(function(t,e){M.fn[t]=function(n,i){var r=M.map(this,e,n);return"Until"!==t.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=M.filter(i,r)),this.length>1&&(j[t]||M.uniqueSort(r),$.test(t)&&r.reverse()),this.pushStack(r)}}));var q=/[^\x20\t\r\n\f]+/g;function X(t){return t}function Y(t){throw t}function K(t,e,n,i){var r;try{t&&_(r=t.promise)?r.call(t).done(e).fail(n):t&&_(r=t.then)?r.call(t,e,n):e.apply(void 0,[t].slice(i))}catch(t){n.apply(void 0,[t])}}M.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return M.each(t.match(q)||[],(function(t,n){e[n]=!0})),e}(t):M.extend({},t);var e,n,i,r,s=[],o=[],a=-1,l=function(){for(r=r||t.once,i=e=!0;o.length;a=-1)for(n=o.shift();++a<s.length;)!1===s[a].apply(n[0],n[1])&&t.stopOnFalse&&(a=s.length,n=!1);t.memory||(n=!1),e=!1,r&&(s=n?[]:"")},c={add:function(){return s&&(n&&!e&&(a=s.length-1,o.push(n)),function e(n){M.each(n,(function(n,i){_(i)?t.unique&&c.has(i)||s.push(i):i&&i.length&&"string"!==w(i)&&e(i)}))}(arguments),n&&!e&&l()),this},remove:function(){return M.each(arguments,(function(t,e){for(var n;(n=M.inArray(e,s,n))>-1;)s.splice(n,1),n<=a&&a--})),this},has:function(t){return t?M.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=o=[],s=n="",this},disabled:function(){return!s},lock:function(){return r=o=[],n||e||(s=n=""),this},locked:function(){return!!r},fireWith:function(t,n){return r||(n=[t,(n=n||[]).slice?n.slice():n],o.push(n),e||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},M.extend({Deferred:function(t){var e=[["notify","progress",M.Callbacks("memory"),M.Callbacks("memory"),2],["resolve","done",M.Callbacks("once memory"),M.Callbacks("once memory"),0,"resolved"],["reject","fail",M.Callbacks("once memory"),M.Callbacks("once memory"),1,"rejected"]],n="pending",r={state:function(){return n},always:function(){return s.done(arguments).fail(arguments),this},catch:function(t){return r.then(null,t)},pipe:function(){var t=arguments;return M.Deferred((function(n){M.each(e,(function(e,i){var r=_(t[i[4]])&&t[i[4]];s[i[1]]((function(){var t=r&&r.apply(this,arguments);t&&_(t.promise)?t.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this,r?[t]:arguments)}))})),t=null})).promise()},then:function(t,n,r){var s=0;function o(t,e,n,r){return function(){var a=this,l=arguments,c=function(){var i,c;if(!(t<s)){if((i=n.apply(a,l))===e.promise())throw new TypeError("Thenable self-resolution");c=i&&("object"==typeof i||"function"==typeof i)&&i.then,_(c)?r?c.call(i,o(s,e,X,r),o(s,e,Y,r)):(s++,c.call(i,o(s,e,X,r),o(s,e,Y,r),o(s,e,X,e.notifyWith))):(n!==X&&(a=void 0,l=[i]),(r||e.resolveWith)(a,l))}},u=r?c:function(){try{c()}catch(i){M.Deferred.exceptionHook&&M.Deferred.exceptionHook(i,u.error),t+1>=s&&(n!==Y&&(a=void 0,l=[i]),e.rejectWith(a,l))}};t?u():(M.Deferred.getErrorHook?u.error=M.Deferred.getErrorHook():M.Deferred.getStackHook&&(u.error=M.Deferred.getStackHook()),i.setTimeout(u))}}return M.Deferred((function(i){e[0][3].add(o(0,i,_(r)?r:X,i.notifyWith)),e[1][3].add(o(0,i,_(t)?t:X)),e[2][3].add(o(0,i,_(n)?n:Y))})).promise()},promise:function(t){return null!=t?M.extend(t,r):r}},s={};return M.each(e,(function(t,i){var o=i[2],a=i[5];r[i[1]]=o.add,a&&o.add((function(){n=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),o.add(i[3].fire),s[i[0]]=function(){return s[i[0]+"With"](this===s?void 0:this,arguments),this},s[i[0]+"With"]=o.fireWith})),r.promise(s),t&&t.call(s,s),s},when:function(t){var e=arguments.length,n=e,i=Array(n),r=a.call(arguments),s=M.Deferred(),o=function(t){return function(n){i[t]=this,r[t]=arguments.length>1?a.call(arguments):n,--e||s.resolveWith(i,r)}};if(e<=1&&(K(t,s.done(o(n)).resolve,s.reject,!e),"pending"===s.state()||_(r[n]&&r[n].then)))return s.then();for(;n--;)K(r[n],o(n),s.reject);return s.promise()}});var Z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;M.Deferred.exceptionHook=function(t,e){i.console&&i.console.warn&&t&&Z.test(t.name)&&i.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},M.readyException=function(t){i.setTimeout((function(){throw t}))};var Q=M.Deferred();function J(){y.removeEventListener("DOMContentLoaded",J),i.removeEventListener("load",J),M.ready()}M.fn.ready=function(t){return Q.then(t).catch((function(t){M.readyException(t)})),this},M.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--M.readyWait:M.isReady)||(M.isReady=!0,!0!==t&&--M.readyWait>0||Q.resolveWith(y,[M]))}}),M.ready.then=Q.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?i.setTimeout(M.ready):(y.addEventListener("DOMContentLoaded",J),i.addEventListener("load",J));var tt=function(t,e,n,i,r,s,o){var a=0,l=t.length,c=null==n;if("object"===w(n))for(a in r=!0,n)tt(t,e,a,n[a],!0,s,o);else if(void 0!==i&&(r=!0,_(i)||(o=!0),c&&(o?(e.call(t,i),e=null):(c=e,e=function(t,e,n){return c.call(M(t),n)})),e))for(;a<l;a++)e(t[a],n,o?i:i.call(t[a],a,e(t[a],n)));return r?t:c?e.call(t):l?e(t[0],n):s},et=/^-ms-/,nt=/-([a-z])/g;function it(t,e){return e.toUpperCase()}function rt(t){return t.replace(et,"ms-").replace(nt,it)}var st=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function ot(){this.expando=M.expando+ot.uid++}ot.uid=1,ot.prototype={cache:function(t){var e=t[this.expando];return e||(e={},st(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,n){var i,r=this.cache(t);if("string"==typeof e)r[rt(e)]=n;else for(i in e)r[rt(i)]=e[i];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][rt(e)]},access:function(t,e,n){return void 0===e||e&&"string"==typeof e&&void 0===n?this.get(t,e):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,i=t[this.expando];if(void 0!==i){if(void 0!==e){n=(e=Array.isArray(e)?e.map(rt):(e=rt(e))in i?[e]:e.match(q)||[]).length;for(;n--;)delete i[e[n]]}(void 0===e||M.isEmptyObject(i))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!M.isEmptyObject(e)}};var at=new ot,lt=new ot,ct=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ut=/[A-Z]/g;function ht(t,e,n){var i;if(void 0===n&&1===t.nodeType)if(i="data-"+e.replace(ut,"-$&").toLowerCase(),"string"==typeof(n=t.getAttribute(i))){try{n=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:ct.test(t)?JSON.parse(t):t)}(n)}catch(t){}lt.set(t,e,n)}else n=void 0;return n}M.extend({hasData:function(t){return lt.hasData(t)||at.hasData(t)},data:function(t,e,n){return lt.access(t,e,n)},removeData:function(t,e){lt.remove(t,e)},_data:function(t,e,n){return at.access(t,e,n)},_removeData:function(t,e){at.remove(t,e)}}),M.fn.extend({data:function(t,e){var n,i,r,s=this[0],o=s&&s.attributes;if(void 0===t){if(this.length&&(r=lt.get(s),1===s.nodeType&&!at.get(s,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(i=o[n].name).indexOf("data-")&&(i=rt(i.slice(5)),ht(s,i,r[i]));at.set(s,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each((function(){lt.set(this,t)})):tt(this,(function(e){var n;if(s&&void 0===e)return void 0!==(n=lt.get(s,t))||void 0!==(n=ht(s,t))?n:void 0;this.each((function(){lt.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){lt.remove(this,t)}))}}),M.extend({queue:function(t,e,n){var i;if(t)return e=(e||"fx")+"queue",i=at.get(t,e),n&&(!i||Array.isArray(n)?i=at.access(t,e,M.makeArray(n)):i.push(n)),i||[]},dequeue:function(t,e){e=e||"fx";var n=M.queue(t,e),i=n.length,r=n.shift(),s=M._queueHooks(t,e);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===e&&n.unshift("inprogress"),delete s.stop,r.call(t,(function(){M.dequeue(t,e)}),s)),!i&&s&&s.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return at.get(t,n)||at.access(t,n,{empty:M.Callbacks("once memory").add((function(){at.remove(t,[e+"queue",n])}))})}}),M.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),arguments.length<n?M.queue(this[0],t):void 0===e?this:this.each((function(){var n=M.queue(this,t,e);M._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&M.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){M.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,i=1,r=M.Deferred(),s=this,o=this.length,a=function(){--i||r.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(n=at.get(s[o],t+"queueHooks"))&&n.empty&&(i++,n.empty.add(a));return a(),r.promise(e)}});var dt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pt=new RegExp("^(?:([+-])=|)("+dt+")([a-z%]*)$","i"),ft=["Top","Right","Bottom","Left"],mt=y.documentElement,gt=function(t){return M.contains(t.ownerDocument,t)},_t={composed:!0};mt.getRootNode&&(gt=function(t){return M.contains(t.ownerDocument,t)||t.getRootNode(_t)===t.ownerDocument});var vt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&gt(t)&&"none"===M.css(t,"display")};function yt(t,e,n,i){var r,s,o=20,a=i?function(){return i.cur()}:function(){return M.css(t,e,"")},l=a(),c=n&&n[3]||(M.cssNumber[e]?"":"px"),u=t.nodeType&&(M.cssNumber[e]||"px"!==c&&+l)&&pt.exec(M.css(t,e));if(u&&u[3]!==c){for(l/=2,c=c||u[3],u=+l||1;o--;)M.style(t,e,u+c),(1-s)*(1-(s=a()/l||.5))<=0&&(o=0),u/=s;u*=2,M.style(t,e,u+c),n=n||[]}return n&&(u=+u||+l||0,r=n[1]?u+(n[1]+1)*n[2]:+n[2],i&&(i.unit=c,i.start=u,i.end=r)),r}var bt={};function xt(t){var e,n=t.ownerDocument,i=t.nodeName,r=bt[i];return r||(e=n.body.appendChild(n.createElement(i)),r=M.css(e,"display"),e.parentNode.removeChild(e),"none"===r&&(r="block"),bt[i]=r,r)}function wt(t,e){for(var n,i,r=[],s=0,o=t.length;s<o;s++)(i=t[s]).style&&(n=i.style.display,e?("none"===n&&(r[s]=at.get(i,"display")||null,r[s]||(i.style.display="")),""===i.style.display&&vt(i)&&(r[s]=xt(i))):"none"!==n&&(r[s]="none",at.set(i,"display",n)));for(s=0;s<o;s++)null!=r[s]&&(t[s].style.display=r[s]);return t}M.fn.extend({show:function(){return wt(this,!0)},hide:function(){return wt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){vt(this)?M(this).show():M(this).hide()}))}});var St,At,Mt=/^(?:checkbox|radio)$/i,Ct=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Et=/^$|^module$|\/(?:java|ecma)script/i;St=y.createDocumentFragment().appendChild(y.createElement("div")),(At=y.createElement("input")).setAttribute("type","radio"),At.setAttribute("checked","checked"),At.setAttribute("name","t"),St.appendChild(At),g.checkClone=St.cloneNode(!0).cloneNode(!0).lastChild.checked,St.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!St.cloneNode(!0).lastChild.defaultValue,St.innerHTML="<option></option>",g.option=!!St.lastChild;var Tt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Pt(t,e){var n;return n=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&E(t,e)?M.merge([t],n):n}function It(t,e){for(var n=0,i=t.length;n<i;n++)at.set(t[n],"globalEval",!e||at.get(e[n],"globalEval"))}Tt.tbody=Tt.tfoot=Tt.colgroup=Tt.caption=Tt.thead,Tt.th=Tt.td,g.option||(Tt.optgroup=Tt.option=[1,"<select multiple='multiple'>","</select>"]);var Rt=/<|&#?\w+;/;function kt(t,e,n,i,r){for(var s,o,a,l,c,u,h=e.createDocumentFragment(),d=[],p=0,f=t.length;p<f;p++)if((s=t[p])||0===s)if("object"===w(s))M.merge(d,s.nodeType?[s]:s);else if(Rt.test(s)){for(o=o||h.appendChild(e.createElement("div")),a=(Ct.exec(s)||["",""])[1].toLowerCase(),l=Tt[a]||Tt._default,o.innerHTML=l[1]+M.htmlPrefilter(s)+l[2],u=l[0];u--;)o=o.lastChild;M.merge(d,o.childNodes),(o=h.firstChild).textContent=""}else d.push(e.createTextNode(s));for(h.textContent="",p=0;s=d[p++];)if(i&&M.inArray(s,i)>-1)r&&r.push(s);else if(c=gt(s),o=Pt(h.appendChild(s),"script"),c&&It(o),n)for(u=0;s=o[u++];)Et.test(s.type||"")&&n.push(s);return h}var Dt=/^([^.]*)(?:\.(.+)|)/;function Lt(){return!0}function Ot(){return!1}function Nt(t,e,n,i,r,s){var o,a;if("object"==typeof e){for(a in"string"!=typeof n&&(i=i||n,n=void 0),e)Nt(t,a,n,i,e[a],s);return t}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),!1===r)r=Ot;else if(!r)return t;return 1===s&&(o=r,r=function(t){return M().off(t),o.apply(this,arguments)},r.guid=o.guid||(o.guid=M.guid++)),t.each((function(){M.event.add(this,e,r,i,n)}))}function Ft(t,e,n){n?(at.set(t,e,!1),M.event.add(t,e,{namespace:!1,handler:function(t){var n,i=at.get(this,e);if(1&t.isTrigger&&this[e]){if(i)(M.event.special[e]||{}).delegateType&&t.stopPropagation();else if(i=a.call(arguments),at.set(this,e,i),this[e](),n=at.get(this,e),at.set(this,e,!1),i!==n)return t.stopImmediatePropagation(),t.preventDefault(),n}else i&&(at.set(this,e,M.event.trigger(i[0],i.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=Lt)}})):void 0===at.get(t,e)&&M.event.add(t,e,Lt)}M.event={global:{},add:function(t,e,n,i,r){var s,o,a,l,c,u,h,d,p,f,m,g=at.get(t);if(st(t))for(n.handler&&(n=(s=n).handler,r=s.selector),r&&M.find.matchesSelector(mt,r),n.guid||(n.guid=M.guid++),(l=g.events)||(l=g.events=Object.create(null)),(o=g.handle)||(o=g.handle=function(e){return void 0!==M&&M.event.triggered!==e.type?M.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(q)||[""]).length;c--;)p=m=(a=Dt.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p&&(h=M.event.special[p]||{},p=(r?h.delegateType:h.bindType)||p,h=M.event.special[p]||{},u=M.extend({type:p,origType:m,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&M.expr.match.needsContext.test(r),namespace:f.join(".")},s),(d=l[p])||((d=l[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(t,i,f,o)||t.addEventListener&&t.addEventListener(p,o)),h.add&&(h.add.call(t,u),u.handler.guid||(u.handler.guid=n.guid)),r?d.splice(d.delegateCount++,0,u):d.push(u),M.event.global[p]=!0)},remove:function(t,e,n,i,r){var s,o,a,l,c,u,h,d,p,f,m,g=at.hasData(t)&&at.get(t);if(g&&(l=g.events)){for(c=(e=(e||"").match(q)||[""]).length;c--;)if(p=m=(a=Dt.exec(e[c])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=M.event.special[p]||{},d=l[p=(i?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=d.length;s--;)u=d[s],!r&&m!==u.origType||n&&n.guid!==u.guid||a&&!a.test(u.namespace)||i&&i!==u.selector&&("**"!==i||!u.selector)||(d.splice(s,1),u.selector&&d.delegateCount--,h.remove&&h.remove.call(t,u));o&&!d.length&&(h.teardown&&!1!==h.teardown.call(t,f,g.handle)||M.removeEvent(t,p,g.handle),delete l[p])}else for(p in l)M.event.remove(t,p+e[c],n,i,!0);M.isEmptyObject(l)&&at.remove(t,"handle events")}},dispatch:function(t){var e,n,i,r,s,o,a=new Array(arguments.length),l=M.event.fix(t),c=(at.get(this,"events")||Object.create(null))[l.type]||[],u=M.event.special[l.type]||{};for(a[0]=l,e=1;e<arguments.length;e++)a[e]=arguments[e];if(l.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,l)){for(o=M.event.handlers.call(this,l,c),e=0;(r=o[e++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,n=0;(s=r.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==s.namespace&&!l.rnamespace.test(s.namespace)||(l.handleObj=s,l.data=s.data,void 0!==(i=((M.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,a))&&!1===(l.result=i)&&(l.preventDefault(),l.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,l),l.result}},handlers:function(t,e){var n,i,r,s,o,a=[],l=e.delegateCount,c=t.target;if(l&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(s=[],o={},n=0;n<l;n++)void 0===o[r=(i=e[n]).selector+" "]&&(o[r]=i.needsContext?M(r,this).index(c)>-1:M.find(r,this,null,[c]).length),o[r]&&s.push(i);s.length&&a.push({elem:c,handlers:s})}return c=this,l<e.length&&a.push({elem:c,handlers:e.slice(l)}),a},addProp:function(t,e){Object.defineProperty(M.Event.prototype,t,{enumerable:!0,configurable:!0,get:_(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[M.expando]?t:new M.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return Mt.test(e.type)&&e.click&&E(e,"input")&&Ft(e,"click",!0),!1},trigger:function(t){var e=this||t;return Mt.test(e.type)&&e.click&&E(e,"input")&&Ft(e,"click"),!0},_default:function(t){var e=t.target;return Mt.test(e.type)&&e.click&&E(e,"input")&&at.get(e,"click")||E(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},M.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n)},M.Event=function(t,e){if(!(this instanceof M.Event))return new M.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Lt:Ot,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&M.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[M.expando]=!0},M.Event.prototype={constructor:M.Event,isDefaultPrevented:Ot,isPropagationStopped:Ot,isImmediatePropagationStopped:Ot,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Lt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Lt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Lt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},M.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},M.event.addProp),M.each({focus:"focusin",blur:"focusout"},(function(t,e){function n(t){if(y.documentMode){var n=at.get(this,"handle"),i=M.event.fix(t);i.type="focusin"===t.type?"focus":"blur",i.isSimulated=!0,n(t),i.target===i.currentTarget&&n(i)}else M.event.simulate(e,t.target,M.event.fix(t))}M.event.special[t]={setup:function(){var i;if(Ft(this,t,!0),!y.documentMode)return!1;(i=at.get(this,e))||this.addEventListener(e,n),at.set(this,e,(i||0)+1)},trigger:function(){return Ft(this,t),!0},teardown:function(){var t;if(!y.documentMode)return!1;(t=at.get(this,e)-1)?at.set(this,e,t):(this.removeEventListener(e,n),at.remove(this,e))},_default:function(e){return at.get(e.target,t)},delegateType:e},M.event.special[e]={setup:function(){var i=this.ownerDocument||this.document||this,r=y.documentMode?this:i,s=at.get(r,e);s||(y.documentMode?this.addEventListener(e,n):i.addEventListener(t,n,!0)),at.set(r,e,(s||0)+1)},teardown:function(){var i=this.ownerDocument||this.document||this,r=y.documentMode?this:i,s=at.get(r,e)-1;s?at.set(r,e,s):(y.documentMode?this.removeEventListener(e,n):i.removeEventListener(t,n,!0),at.remove(r,e))}}})),M.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){M.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,i=t.relatedTarget,r=t.handleObj;return i&&(i===this||M.contains(this,i))||(t.type=r.origType,n=r.handler.apply(this,arguments),t.type=e),n}}})),M.fn.extend({on:function(t,e,n,i){return Nt(this,t,e,n,i)},one:function(t,e,n,i){return Nt(this,t,e,n,i,1)},off:function(t,e,n){var i,r;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,M(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(n=e,e=void 0),!1===n&&(n=Ot),this.each((function(){M.event.remove(this,t,n,e)}))}});var Bt=/<script|<style|<link/i,Ut=/checked\s*(?:[^=]|=\s*.checked.)/i,zt=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Vt(t,e){return E(t,"table")&&E(11!==e.nodeType?e:e.firstChild,"tr")&&M(t).children("tbody")[0]||t}function Ht(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Gt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function $t(t,e){var n,i,r,s,o,a;if(1===e.nodeType){if(at.hasData(t)&&(a=at.get(t).events))for(r in at.remove(e,"handle events"),a)for(n=0,i=a[r].length;n<i;n++)M.event.add(e,r,a[r][n]);lt.hasData(t)&&(s=lt.access(t),o=M.extend({},s),lt.set(e,o))}}function jt(t,e){var n=e.nodeName.toLowerCase();"input"===n&&Mt.test(t.type)?e.checked=t.checked:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue)}function Wt(t,e,n,i){e=l(e);var r,s,o,a,c,u,h=0,d=t.length,p=d-1,f=e[0],m=_(f);if(m||d>1&&"string"==typeof f&&!g.checkClone&&Ut.test(f))return t.each((function(r){var s=t.eq(r);m&&(e[0]=f.call(this,r,s.html())),Wt(s,e,n,i)}));if(d&&(s=(r=kt(e,t[0].ownerDocument,!1,t,i)).firstChild,1===r.childNodes.length&&(r=s),s||i)){for(a=(o=M.map(Pt(r,"script"),Ht)).length;h<d;h++)c=r,h!==p&&(c=M.clone(c,!0,!0),a&&M.merge(o,Pt(c,"script"))),n.call(t[h],c,h);if(a)for(u=o[o.length-1].ownerDocument,M.map(o,Gt),h=0;h<a;h++)c=o[h],Et.test(c.type||"")&&!at.access(c,"globalEval")&&M.contains(u,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?M._evalUrl&&!c.noModule&&M._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},u):x(c.textContent.replace(zt,""),c,u))}return t}function qt(t,e,n){for(var i,r=e?M.filter(e,t):t,s=0;null!=(i=r[s]);s++)n||1!==i.nodeType||M.cleanData(Pt(i)),i.parentNode&&(n&&gt(i)&&It(Pt(i,"script")),i.parentNode.removeChild(i));return t}M.extend({htmlPrefilter:function(t){return t},clone:function(t,e,n){var i,r,s,o,a=t.cloneNode(!0),l=gt(t);if(!(g.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||M.isXMLDoc(t)))for(o=Pt(a),i=0,r=(s=Pt(t)).length;i<r;i++)jt(s[i],o[i]);if(e)if(n)for(s=s||Pt(t),o=o||Pt(a),i=0,r=s.length;i<r;i++)$t(s[i],o[i]);else $t(t,a);return(o=Pt(a,"script")).length>0&&It(o,!l&&Pt(t,"script")),a},cleanData:function(t){for(var e,n,i,r=M.event.special,s=0;void 0!==(n=t[s]);s++)if(st(n)){if(e=n[at.expando]){if(e.events)for(i in e.events)r[i]?M.event.remove(n,i):M.removeEvent(n,i,e.handle);n[at.expando]=void 0}n[lt.expando]&&(n[lt.expando]=void 0)}}}),M.fn.extend({detach:function(t){return qt(this,t,!0)},remove:function(t){return qt(this,t)},text:function(t){return tt(this,(function(t){return void 0===t?M.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Wt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Vt(this,t).appendChild(t)}))},prepend:function(){return Wt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Vt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Wt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Wt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(M.cleanData(Pt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return M.clone(this,t,e)}))},html:function(t){return tt(this,(function(t){var e=this[0]||{},n=0,i=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Bt.test(t)&&!Tt[(Ct.exec(t)||["",""])[1].toLowerCase()]){t=M.htmlPrefilter(t);try{for(;n<i;n++)1===(e=this[n]||{}).nodeType&&(M.cleanData(Pt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Wt(this,arguments,(function(e){var n=this.parentNode;M.inArray(this,t)<0&&(M.cleanData(Pt(this)),n&&n.replaceChild(e,this))}),t)}}),M.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){M.fn[t]=function(t){for(var n,i=[],r=M(t),s=r.length-1,o=0;o<=s;o++)n=o===s?this:this.clone(!0),M(r[o])[e](n),c.apply(i,n.get());return this.pushStack(i)}}));var Xt=new RegExp("^("+dt+")(?!px)[a-z%]+$","i"),Yt=/^--/,Kt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=i),e.getComputedStyle(t)},Zt=function(t,e,n){var i,r,s={};for(r in e)s[r]=t.style[r],t.style[r]=e[r];for(r in i=n.call(t),e)t.style[r]=s[r];return i},Qt=new RegExp(ft.join("|"),"i");function Jt(t,e,n){var i,r,s,o,a=Yt.test(e),l=t.style;return(n=n||Kt(t))&&(o=n.getPropertyValue(e)||n[e],a&&o&&(o=o.replace(k,"$1")||void 0),""!==o||gt(t)||(o=M.style(t,e)),!g.pixelBoxStyles()&&Xt.test(o)&&Qt.test(e)&&(i=l.width,r=l.minWidth,s=l.maxWidth,l.minWidth=l.maxWidth=l.width=o,o=n.width,l.width=i,l.minWidth=r,l.maxWidth=s)),void 0!==o?o+"":o}function te(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(u){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",mt.appendChild(c).appendChild(u);var t=i.getComputedStyle(u);n="1%"!==t.top,l=12===e(t.marginLeft),u.style.right="60%",o=36===e(t.right),r=36===e(t.width),u.style.position="absolute",s=12===e(u.offsetWidth/3),mt.removeChild(c),u=null}}function e(t){return Math.round(parseFloat(t))}var n,r,s,o,a,l,c=y.createElement("div"),u=y.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===u.style.backgroundClip,M.extend(g,{boxSizingReliable:function(){return t(),r},pixelBoxStyles:function(){return t(),o},pixelPosition:function(){return t(),n},reliableMarginLeft:function(){return t(),l},scrollboxSize:function(){return t(),s},reliableTrDimensions:function(){var t,e,n,r;return null==a&&(t=y.createElement("table"),e=y.createElement("tr"),n=y.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",e.style.cssText="box-sizing:content-box;border:1px solid",e.style.height="1px",n.style.height="9px",n.style.display="block",mt.appendChild(t).appendChild(e).appendChild(n),r=i.getComputedStyle(e),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===e.offsetHeight,mt.removeChild(t)),a}}))}();var ee=["Webkit","Moz","ms"],ne=y.createElement("div").style,ie={};function re(t){return M.cssProps[t]||ie[t]||(t in ne?t:ie[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),n=ee.length;n--;)if((t=ee[n]+e)in ne)return t}(t)||t)}var se=/^(none|table(?!-c[ea]).+)/,oe={position:"absolute",visibility:"hidden",display:"block"},ae={letterSpacing:"0",fontWeight:"400"};function le(t,e,n){var i=pt.exec(e);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):e}function ce(t,e,n,i,r,s){var o="width"===e?1:0,a=0,l=0,c=0;if(n===(i?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(c+=M.css(t,n+ft[o],!0,r)),i?("content"===n&&(l-=M.css(t,"padding"+ft[o],!0,r)),"margin"!==n&&(l-=M.css(t,"border"+ft[o]+"Width",!0,r))):(l+=M.css(t,"padding"+ft[o],!0,r),"padding"!==n?l+=M.css(t,"border"+ft[o]+"Width",!0,r):a+=M.css(t,"border"+ft[o]+"Width",!0,r));return!i&&s>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-s-l-a-.5))||0),l+c}function ue(t,e,n){var i=Kt(t),r=(!g.boxSizingReliable()||n)&&"border-box"===M.css(t,"boxSizing",!1,i),s=r,o=Jt(t,e,i),a="offset"+e[0].toUpperCase()+e.slice(1);if(Xt.test(o)){if(!n)return o;o="auto"}return(!g.boxSizingReliable()&&r||!g.reliableTrDimensions()&&E(t,"tr")||"auto"===o||!parseFloat(o)&&"inline"===M.css(t,"display",!1,i))&&t.getClientRects().length&&(r="border-box"===M.css(t,"boxSizing",!1,i),(s=a in t)&&(o=t[a])),(o=parseFloat(o)||0)+ce(t,e,n||(r?"border":"content"),s,i,o)+"px"}function he(t,e,n,i,r){return new he.prototype.init(t,e,n,i,r)}M.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=Jt(t,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,s,o,a=rt(e),l=Yt.test(e),c=t.style;if(l||(e=re(a)),o=M.cssHooks[e]||M.cssHooks[a],void 0===n)return o&&"get"in o&&void 0!==(r=o.get(t,!1,i))?r:c[e];"string"==(s=typeof n)&&(r=pt.exec(n))&&r[1]&&(n=yt(t,e,r),s="number"),null!=n&&n==n&&("number"!==s||l||(n+=r&&r[3]||(M.cssNumber[a]?"":"px")),g.clearCloneStyle||""!==n||0!==e.indexOf("background")||(c[e]="inherit"),o&&"set"in o&&void 0===(n=o.set(t,n,i))||(l?c.setProperty(e,n):c[e]=n))}},css:function(t,e,n,i){var r,s,o,a=rt(e);return Yt.test(e)||(e=re(a)),(o=M.cssHooks[e]||M.cssHooks[a])&&"get"in o&&(r=o.get(t,!0,n)),void 0===r&&(r=Jt(t,e,i)),"normal"===r&&e in ae&&(r=ae[e]),""===n||n?(s=parseFloat(r),!0===n||isFinite(s)?s||0:r):r}}),M.each(["height","width"],(function(t,e){M.cssHooks[e]={get:function(t,n,i){if(n)return!se.test(M.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?ue(t,e,i):Zt(t,oe,(function(){return ue(t,e,i)}))},set:function(t,n,i){var r,s=Kt(t),o=!g.scrollboxSize()&&"absolute"===s.position,a=(o||i)&&"border-box"===M.css(t,"boxSizing",!1,s),l=i?ce(t,e,i,a,s):0;return a&&o&&(l-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(s[e])-ce(t,e,"border",!1,s)-.5)),l&&(r=pt.exec(n))&&"px"!==(r[3]||"px")&&(t.style[e]=n,n=M.css(t,e)),le(0,n,l)}}})),M.cssHooks.marginLeft=te(g.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Jt(t,"marginLeft"))||t.getBoundingClientRect().left-Zt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),M.each({margin:"",padding:"",border:"Width"},(function(t,e){M.cssHooks[t+e]={expand:function(n){for(var i=0,r={},s="string"==typeof n?n.split(" "):[n];i<4;i++)r[t+ft[i]+e]=s[i]||s[i-2]||s[0];return r}},"margin"!==t&&(M.cssHooks[t+e].set=le)})),M.fn.extend({css:function(t,e){return tt(this,(function(t,e,n){var i,r,s={},o=0;if(Array.isArray(e)){for(i=Kt(t),r=e.length;o<r;o++)s[e[o]]=M.css(t,e[o],!1,i);return s}return void 0!==n?M.style(t,e,n):M.css(t,e)}),t,e,arguments.length>1)}}),M.Tween=he,he.prototype={constructor:he,init:function(t,e,n,i,r,s){this.elem=t,this.prop=n,this.easing=r||M.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=s||(M.cssNumber[n]?"":"px")},cur:function(){var t=he.propHooks[this.prop];return t&&t.get?t.get(this):he.propHooks._default.get(this)},run:function(t){var e,n=he.propHooks[this.prop];return this.options.duration?this.pos=e=M.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):he.propHooks._default.set(this),this}},he.prototype.init.prototype=he.prototype,he.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=M.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){M.fx.step[t.prop]?M.fx.step[t.prop](t):1!==t.elem.nodeType||!M.cssHooks[t.prop]&&null==t.elem.style[re(t.prop)]?t.elem[t.prop]=t.now:M.style(t.elem,t.prop,t.now+t.unit)}}},he.propHooks.scrollTop=he.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},M.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},M.fx=he.prototype.init,M.fx.step={};var de,pe,fe=/^(?:toggle|show|hide)$/,me=/queueHooks$/;function ge(){pe&&(!1===y.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(ge):i.setTimeout(ge,M.fx.interval),M.fx.tick())}function _e(){return i.setTimeout((function(){de=void 0})),de=Date.now()}function ve(t,e){var n,i=0,r={height:t};for(e=e?1:0;i<4;i+=2-e)r["margin"+(n=ft[i])]=r["padding"+n]=t;return e&&(r.opacity=r.width=t),r}function ye(t,e,n){for(var i,r=(be.tweeners[e]||[]).concat(be.tweeners["*"]),s=0,o=r.length;s<o;s++)if(i=r[s].call(n,e,t))return i}function be(t,e,n){var i,r,s=0,o=be.prefilters.length,a=M.Deferred().always((function(){delete l.elem})),l=function(){if(r)return!1;for(var e=de||_e(),n=Math.max(0,c.startTime+c.duration-e),i=1-(n/c.duration||0),s=0,o=c.tweens.length;s<o;s++)c.tweens[s].run(i);return a.notifyWith(t,[c,i,n]),i<1&&o?n:(o||a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c]),!1)},c=a.promise({elem:t,props:M.extend({},e),opts:M.extend(!0,{specialEasing:{},easing:M.easing._default},n),originalProperties:e,originalOptions:n,startTime:de||_e(),duration:n.duration,tweens:[],createTween:function(e,n){var i=M.Tween(t,c.opts,e,n,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(i),i},stop:function(e){var n=0,i=e?c.tweens.length:0;if(r)return this;for(r=!0;n<i;n++)c.tweens[n].run(1);return e?(a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c,e])):a.rejectWith(t,[c,e]),this}}),u=c.props;for(function(t,e){var n,i,r,s,o;for(n in t)if(r=e[i=rt(n)],s=t[n],Array.isArray(s)&&(r=s[1],s=t[n]=s[0]),n!==i&&(t[i]=s,delete t[n]),(o=M.cssHooks[i])&&"expand"in o)for(n in s=o.expand(s),delete t[i],s)n in t||(t[n]=s[n],e[n]=r);else e[i]=r}(u,c.opts.specialEasing);s<o;s++)if(i=be.prefilters[s].call(c,t,u,c.opts))return _(i.stop)&&(M._queueHooks(c.elem,c.opts.queue).stop=i.stop.bind(i)),i;return M.map(u,ye,c),_(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),M.fx.timer(M.extend(l,{elem:t,anim:c,queue:c.opts.queue})),c}M.Animation=M.extend(be,{tweeners:{"*":[function(t,e){var n=this.createTween(t,e);return yt(n.elem,t,pt.exec(e),n),n}]},tweener:function(t,e){_(t)?(e=t,t=["*"]):t=t.match(q);for(var n,i=0,r=t.length;i<r;i++)n=t[i],be.tweeners[n]=be.tweeners[n]||[],be.tweeners[n].unshift(e)},prefilters:[function(t,e,n){var i,r,s,o,a,l,c,u,h="width"in e||"height"in e,d=this,p={},f=t.style,m=t.nodeType&&vt(t),g=at.get(t,"fxshow");for(i in n.queue||(null==(o=M._queueHooks(t,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,d.always((function(){d.always((function(){o.unqueued--,M.queue(t,"fx").length||o.empty.fire()}))}))),e)if(r=e[i],fe.test(r)){if(delete e[i],s=s||"toggle"===r,r===(m?"hide":"show")){if("show"!==r||!g||void 0===g[i])continue;m=!0}p[i]=g&&g[i]||M.style(t,i)}if((l=!M.isEmptyObject(e))||!M.isEmptyObject(p))for(i in h&&1===t.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=g&&g.display)&&(c=at.get(t,"display")),"none"===(u=M.css(t,"display"))&&(c?u=c:(wt([t],!0),c=t.style.display||c,u=M.css(t,"display"),wt([t]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===M.css(t,"float")&&(l||(d.done((function(){f.display=c})),null==c&&(u=f.display,c="none"===u?"":u)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",d.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),l=!1,p)l||(g?"hidden"in g&&(m=g.hidden):g=at.access(t,"fxshow",{display:c}),s&&(g.hidden=!m),m&&wt([t],!0),d.done((function(){for(i in m||wt([t]),at.remove(t,"fxshow"),p)M.style(t,i,p[i])}))),l=ye(m?g[i]:0,i,d),i in g||(g[i]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?be.prefilters.unshift(t):be.prefilters.push(t)}}),M.speed=function(t,e,n){var i=t&&"object"==typeof t?M.extend({},t):{complete:n||!n&&e||_(t)&&t,duration:t,easing:n&&e||e&&!_(e)&&e};return M.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in M.fx.speeds?i.duration=M.fx.speeds[i.duration]:i.duration=M.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){_(i.old)&&i.old.call(this),i.queue&&M.dequeue(this,i.queue)},i},M.fn.extend({fadeTo:function(t,e,n,i){return this.filter(vt).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(t,e,n,i){var r=M.isEmptyObject(t),s=M.speed(e,n,i),o=function(){var e=be(this,M.extend({},t),s);(r||at.get(this,"finish"))&&e.stop(!0)};return o.finish=o,r||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(t,e,n){var i=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,r=null!=t&&t+"queueHooks",s=M.timers,o=at.get(this);if(r)o[r]&&o[r].stop&&i(o[r]);else for(r in o)o[r]&&o[r].stop&&me.test(r)&&i(o[r]);for(r=s.length;r--;)s[r].elem!==this||null!=t&&s[r].queue!==t||(s[r].anim.stop(n),e=!1,s.splice(r,1));!e&&n||M.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,n=at.get(this),i=n[t+"queue"],r=n[t+"queueHooks"],s=M.timers,o=i?i.length:0;for(n.finish=!0,M.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<o;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete n.finish}))}}),M.each(["toggle","show","hide"],(function(t,e){var n=M.fn[e];M.fn[e]=function(t,i,r){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(ve(e,!0),t,i,r)}})),M.each({slideDown:ve("show"),slideUp:ve("hide"),slideToggle:ve("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){M.fn[t]=function(t,n,i){return this.animate(e,t,n,i)}})),M.timers=[],M.fx.tick=function(){var t,e=0,n=M.timers;for(de=Date.now();e<n.length;e++)(t=n[e])()||n[e]!==t||n.splice(e--,1);n.length||M.fx.stop(),de=void 0},M.fx.timer=function(t){M.timers.push(t),M.fx.start()},M.fx.interval=13,M.fx.start=function(){pe||(pe=!0,ge())},M.fx.stop=function(){pe=null},M.fx.speeds={slow:600,fast:200,_default:400},M.fn.delay=function(t,e){return t=M.fx&&M.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,n){var r=i.setTimeout(e,t);n.stop=function(){i.clearTimeout(r)}}))},function(){var t=y.createElement("input"),e=y.createElement("select").appendChild(y.createElement("option"));t.type="checkbox",g.checkOn=""!==t.value,g.optSelected=e.selected,(t=y.createElement("input")).value="t",t.type="radio",g.radioValue="t"===t.value}();var xe,we=M.expr.attrHandle;M.fn.extend({attr:function(t,e){return tt(this,M.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){M.removeAttr(this,t)}))}}),M.extend({attr:function(t,e,n){var i,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?M.prop(t,e,n):(1===s&&M.isXMLDoc(t)||(r=M.attrHooks[e.toLowerCase()]||(M.expr.match.bool.test(e)?xe:void 0)),void 0!==n?null===n?void M.removeAttr(t,e):r&&"set"in r&&void 0!==(i=r.set(t,n,e))?i:(t.setAttribute(e,n+""),n):r&&"get"in r&&null!==(i=r.get(t,e))?i:null==(i=M.find.attr(t,e))?void 0:i)},attrHooks:{type:{set:function(t,e){if(!g.radioValue&&"radio"===e&&E(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}},removeAttr:function(t,e){var n,i=0,r=e&&e.match(q);if(r&&1===t.nodeType)for(;n=r[i++];)t.removeAttribute(n)}}),xe={set:function(t,e,n){return!1===e?M.removeAttr(t,n):t.setAttribute(n,n),n}},M.each(M.expr.match.bool.source.match(/\w+/g),(function(t,e){var n=we[e]||M.find.attr;we[e]=function(t,e,i){var r,s,o=e.toLowerCase();return i||(s=we[o],we[o]=r,r=null!=n(t,e,i)?o:null,we[o]=s),r}}));var Se=/^(?:input|select|textarea|button)$/i,Ae=/^(?:a|area)$/i;function Me(t){return(t.match(q)||[]).join(" ")}function Ce(t){return t.getAttribute&&t.getAttribute("class")||""}function Ee(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(q)||[]}M.fn.extend({prop:function(t,e){return tt(this,M.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[M.propFix[t]||t]}))}}),M.extend({prop:function(t,e,n){var i,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&M.isXMLDoc(t)||(e=M.propFix[e]||e,r=M.propHooks[e]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(t,n,e))?i:t[e]=n:r&&"get"in r&&null!==(i=r.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=M.find.attr(t,"tabindex");return e?parseInt(e,10):Se.test(t.nodeName)||Ae.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(M.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),M.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){M.propFix[this.toLowerCase()]=this})),M.fn.extend({addClass:function(t){var e,n,i,r,s,o;return _(t)?this.each((function(e){M(this).addClass(t.call(this,e,Ce(this)))})):(e=Ee(t)).length?this.each((function(){if(i=Ce(this),n=1===this.nodeType&&" "+Me(i)+" "){for(s=0;s<e.length;s++)r=e[s],n.indexOf(" "+r+" ")<0&&(n+=r+" ");o=Me(n),i!==o&&this.setAttribute("class",o)}})):this},removeClass:function(t){var e,n,i,r,s,o;return _(t)?this.each((function(e){M(this).removeClass(t.call(this,e,Ce(this)))})):arguments.length?(e=Ee(t)).length?this.each((function(){if(i=Ce(this),n=1===this.nodeType&&" "+Me(i)+" "){for(s=0;s<e.length;s++)for(r=e[s];n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");o=Me(n),i!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(t,e){var n,i,r,s,o=typeof t,a="string"===o||Array.isArray(t);return _(t)?this.each((function(n){M(this).toggleClass(t.call(this,n,Ce(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(n=Ee(t),this.each((function(){if(a)for(s=M(this),r=0;r<n.length;r++)i=n[r],s.hasClass(i)?s.removeClass(i):s.addClass(i);else void 0!==t&&"boolean"!==o||((i=Ce(this))&&at.set(this,"__className__",i),this.setAttribute&&this.setAttribute("class",i||!1===t?"":at.get(this,"__className__")||""))})))},hasClass:function(t){var e,n,i=0;for(e=" "+t+" ";n=this[i++];)if(1===n.nodeType&&(" "+Me(Ce(n))+" ").indexOf(e)>-1)return!0;return!1}});var Te=/\r/g;M.fn.extend({val:function(t){var e,n,i,r=this[0];return arguments.length?(i=_(t),this.each((function(n){var r;1===this.nodeType&&(null==(r=i?t.call(this,n,M(this).val()):t)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=M.map(r,(function(t){return null==t?"":t+""}))),(e=M.valHooks[this.type]||M.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))}))):r?(e=M.valHooks[r.type]||M.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&void 0!==(n=e.get(r,"value"))?n:"string"==typeof(n=r.value)?n.replace(Te,""):null==n?"":n:void 0}}),M.extend({valHooks:{option:{get:function(t){var e=M.find.attr(t,"value");return null!=e?e:Me(M.text(t))}},select:{get:function(t){var e,n,i,r=t.options,s=t.selectedIndex,o="select-one"===t.type,a=o?null:[],l=o?s+1:r.length;for(i=s<0?l:o?s:0;i<l;i++)if(((n=r[i]).selected||i===s)&&!n.disabled&&(!n.parentNode.disabled||!E(n.parentNode,"optgroup"))){if(e=M(n).val(),o)return e;a.push(e)}return a},set:function(t,e){for(var n,i,r=t.options,s=M.makeArray(e),o=r.length;o--;)((i=r[o]).selected=M.inArray(M.valHooks.option.get(i),s)>-1)&&(n=!0);return n||(t.selectedIndex=-1),s}}}}),M.each(["radio","checkbox"],(function(){M.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=M.inArray(M(t).val(),e)>-1}},g.checkOn||(M.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var Pe=i.location,Ie={guid:Date.now()},Re=/\?/;M.parseXML=function(t){var e,n;if(!t||"string"!=typeof t)return null;try{e=(new i.DOMParser).parseFromString(t,"text/xml")}catch(t){}return n=e&&e.getElementsByTagName("parsererror")[0],e&&!n||M.error("Invalid XML: "+(n?M.map(n.childNodes,(function(t){return t.textContent})).join("\n"):t)),e};var ke=/^(?:focusinfocus|focusoutblur)$/,De=function(t){t.stopPropagation()};M.extend(M.event,{trigger:function(t,e,n,r){var s,o,a,l,c,u,h,d,f=[n||y],m=p.call(t,"type")?t.type:t,g=p.call(t,"namespace")?t.namespace.split("."):[];if(o=d=a=n=n||y,3!==n.nodeType&&8!==n.nodeType&&!ke.test(m+M.event.triggered)&&(m.indexOf(".")>-1&&(g=m.split("."),m=g.shift(),g.sort()),c=m.indexOf(":")<0&&"on"+m,(t=t[M.expando]?t:new M.Event(m,"object"==typeof t&&t)).isTrigger=r?2:3,t.namespace=g.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),e=null==e?[t]:M.makeArray(e,[t]),h=M.event.special[m]||{},r||!h.trigger||!1!==h.trigger.apply(n,e))){if(!r&&!h.noBubble&&!v(n)){for(l=h.delegateType||m,ke.test(l+m)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(n.ownerDocument||y)&&f.push(a.defaultView||a.parentWindow||i)}for(s=0;(o=f[s++])&&!t.isPropagationStopped();)d=o,t.type=s>1?l:h.bindType||m,(u=(at.get(o,"events")||Object.create(null))[t.type]&&at.get(o,"handle"))&&u.apply(o,e),(u=c&&o[c])&&u.apply&&st(o)&&(t.result=u.apply(o,e),!1===t.result&&t.preventDefault());return t.type=m,r||t.isDefaultPrevented()||h._default&&!1!==h._default.apply(f.pop(),e)||!st(n)||c&&_(n[m])&&!v(n)&&((a=n[c])&&(n[c]=null),M.event.triggered=m,t.isPropagationStopped()&&d.addEventListener(m,De),n[m](),t.isPropagationStopped()&&d.removeEventListener(m,De),M.event.triggered=void 0,a&&(n[c]=a)),t.result}},simulate:function(t,e,n){var i=M.extend(new M.Event,n,{type:t,isSimulated:!0});M.event.trigger(i,null,e)}}),M.fn.extend({trigger:function(t,e){return this.each((function(){M.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var n=this[0];if(n)return M.event.trigger(t,e,n,!0)}});var Le=/\[\]$/,Oe=/\r?\n/g,Ne=/^(?:submit|button|image|reset|file)$/i,Fe=/^(?:input|select|textarea|keygen)/i;function Be(t,e,n,i){var r;if(Array.isArray(e))M.each(e,(function(e,r){n||Le.test(t)?i(t,r):Be(t+"["+("object"==typeof r&&null!=r?e:"")+"]",r,n,i)}));else if(n||"object"!==w(e))i(t,e);else for(r in e)Be(t+"["+r+"]",e[r],n,i)}M.param=function(t,e){var n,i=[],r=function(t,e){var n=_(e)?e():e;i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==n?"":n)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!M.isPlainObject(t))M.each(t,(function(){r(this.name,this.value)}));else for(n in t)Be(n,t[n],e,r);return i.join("&")},M.fn.extend({serialize:function(){return M.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=M.prop(this,"elements");return t?M.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!M(this).is(":disabled")&&Fe.test(this.nodeName)&&!Ne.test(t)&&(this.checked||!Mt.test(t))})).map((function(t,e){var n=M(this).val();return null==n?null:Array.isArray(n)?M.map(n,(function(t){return{name:e.name,value:t.replace(Oe,"\r\n")}})):{name:e.name,value:n.replace(Oe,"\r\n")}})).get()}});var Ue=/%20/g,ze=/#.*$/,Ve=/([?&])_=[^&]*/,He=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ge=/^(?:GET|HEAD)$/,$e=/^\/\//,je={},We={},qe="*/".concat("*"),Xe=y.createElement("a");function Ye(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var i,r=0,s=e.toLowerCase().match(q)||[];if(_(n))for(;i=s[r++];)"+"===i[0]?(i=i.slice(1)||"*",(t[i]=t[i]||[]).unshift(n)):(t[i]=t[i]||[]).push(n)}}function Ke(t,e,n,i){var r={},s=t===We;function o(a){var l;return r[a]=!0,M.each(t[a]||[],(function(t,a){var c=a(e,n,i);return"string"!=typeof c||s||r[c]?s?!(l=c):void 0:(e.dataTypes.unshift(c),o(c),!1)})),l}return o(e.dataTypes[0])||!r["*"]&&o("*")}function Ze(t,e){var n,i,r=M.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((r[n]?t:i||(i={}))[n]=e[n]);return i&&M.extend(!0,t,i),t}Xe.href=Pe.href,M.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Pe.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Pe.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":M.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Ze(Ze(t,M.ajaxSettings),e):Ze(M.ajaxSettings,t)},ajaxPrefilter:Ye(je),ajaxTransport:Ye(We),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,r,s,o,a,l,c,u,h,d,p=M.ajaxSetup({},e),f=p.context||p,m=p.context&&(f.nodeType||f.jquery)?M(f):M.event,g=M.Deferred(),_=M.Callbacks("once memory"),v=p.statusCode||{},b={},x={},w="canceled",S={readyState:0,getResponseHeader:function(t){var e;if(c){if(!o)for(o={};e=He.exec(s);)o[e[1].toLowerCase()+" "]=(o[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=o[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?s:null},setRequestHeader:function(t,e){return null==c&&(t=x[t.toLowerCase()]=x[t.toLowerCase()]||t,b[t]=e),this},overrideMimeType:function(t){return null==c&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)S.always(t[S.status]);else for(e in t)v[e]=[v[e],t[e]];return this},abort:function(t){var e=t||w;return n&&n.abort(e),A(0,e),this}};if(g.promise(S),p.url=((t||p.url||Pe.href)+"").replace($e,Pe.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(q)||[""],null==p.crossDomain){l=y.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Xe.protocol+"//"+Xe.host!=l.protocol+"//"+l.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=M.param(p.data,p.traditional)),Ke(je,p,e,S),c)return S;for(h in(u=M.event&&p.global)&&0==M.active++&&M.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Ge.test(p.type),r=p.url.replace(ze,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Ue,"+")):(d=p.url.slice(r.length),p.data&&(p.processData||"string"==typeof p.data)&&(r+=(Re.test(r)?"&":"?")+p.data,delete p.data),!1===p.cache&&(r=r.replace(Ve,"$1"),d=(Re.test(r)?"&":"?")+"_="+Ie.guid+++d),p.url=r+d),p.ifModified&&(M.lastModified[r]&&S.setRequestHeader("If-Modified-Since",M.lastModified[r]),M.etag[r]&&S.setRequestHeader("If-None-Match",M.etag[r])),(p.data&&p.hasContent&&!1!==p.contentType||e.contentType)&&S.setRequestHeader("Content-Type",p.contentType),S.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+qe+"; q=0.01":""):p.accepts["*"]),p.headers)S.setRequestHeader(h,p.headers[h]);if(p.beforeSend&&(!1===p.beforeSend.call(f,S,p)||c))return S.abort();if(w="abort",_.add(p.complete),S.done(p.success),S.fail(p.error),n=Ke(We,p,e,S)){if(S.readyState=1,u&&m.trigger("ajaxSend",[S,p]),c)return S;p.async&&p.timeout>0&&(a=i.setTimeout((function(){S.abort("timeout")}),p.timeout));try{c=!1,n.send(b,A)}catch(t){if(c)throw t;A(-1,t)}}else A(-1,"No Transport");function A(t,e,o,l){var h,d,y,b,x,w=e;c||(c=!0,a&&i.clearTimeout(a),n=void 0,s=l||"",S.readyState=t>0?4:0,h=t>=200&&t<300||304===t,o&&(b=function(t,e,n){for(var i,r,s,o,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=t.mimeType||e.getResponseHeader("Content-Type"));if(i)for(r in a)if(a[r]&&a[r].test(i)){l.unshift(r);break}if(l[0]in n)s=l[0];else{for(r in n){if(!l[0]||t.converters[r+" "+l[0]]){s=r;break}o||(o=r)}s=s||o}if(s)return s!==l[0]&&l.unshift(s),n[s]}(p,S,o)),!h&&M.inArray("script",p.dataTypes)>-1&&M.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),b=function(t,e,n,i){var r,s,o,a,l,c={},u=t.dataTypes.slice();if(u[1])for(o in t.converters)c[o.toLowerCase()]=t.converters[o];for(s=u.shift();s;)if(t.responseFields[s]&&(n[t.responseFields[s]]=e),!l&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=u.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(o=c[l+" "+s]||c["* "+s]))for(r in c)if((a=r.split(" "))[1]===s&&(o=c[l+" "+a[0]]||c["* "+a[0]])){!0===o?o=c[r]:!0!==c[r]&&(s=a[0],u.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}(p,b,S,h),h?(p.ifModified&&((x=S.getResponseHeader("Last-Modified"))&&(M.lastModified[r]=x),(x=S.getResponseHeader("etag"))&&(M.etag[r]=x)),204===t||"HEAD"===p.type?w="nocontent":304===t?w="notmodified":(w=b.state,d=b.data,h=!(y=b.error))):(y=w,!t&&w||(w="error",t<0&&(t=0))),S.status=t,S.statusText=(e||w)+"",h?g.resolveWith(f,[d,w,S]):g.rejectWith(f,[S,w,y]),S.statusCode(v),v=void 0,u&&m.trigger(h?"ajaxSuccess":"ajaxError",[S,p,h?d:y]),_.fireWith(f,[S,w]),u&&(m.trigger("ajaxComplete",[S,p]),--M.active||M.event.trigger("ajaxStop")))}return S},getJSON:function(t,e,n){return M.get(t,e,n,"json")},getScript:function(t,e){return M.get(t,void 0,e,"script")}}),M.each(["get","post"],(function(t,e){M[e]=function(t,n,i,r){return _(n)&&(r=r||i,i=n,n=void 0),M.ajax(M.extend({url:t,type:e,dataType:r,data:n,success:i},M.isPlainObject(t)&&t))}})),M.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),M._evalUrl=function(t,e,n){return M.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){M.globalEval(t,e,n)}})},M.fn.extend({wrapAll:function(t){var e;return this[0]&&(_(t)&&(t=t.call(this[0])),e=M(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return _(t)?this.each((function(e){M(this).wrapInner(t.call(this,e))})):this.each((function(){var e=M(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)}))},wrap:function(t){var e=_(t);return this.each((function(n){M(this).wrapAll(e?t.call(this,n):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){M(this).replaceWith(this.childNodes)})),this}}),M.expr.pseudos.hidden=function(t){return!M.expr.pseudos.visible(t)},M.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},M.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(t){}};var Qe={0:200,1223:204},Je=M.ajaxSettings.xhr();g.cors=!!Je&&"withCredentials"in Je,g.ajax=Je=!!Je,M.ajaxTransport((function(t){var e,n;if(g.cors||Je&&!t.crossDomain)return{send:function(r,s){var o,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)a[o]=t.xhrFields[o];for(o in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)a.setRequestHeader(o,r[o]);e=function(t){return function(){e&&(e=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(Qe[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=e(),n=a.onerror=a.ontimeout=e("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){e&&n()}))},e=e("abort");try{a.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}})),M.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),M.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return M.globalEval(t),t}}}),M.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),M.ajaxTransport("script",(function(t){var e,n;if(t.crossDomain||t.scriptAttrs)return{send:function(i,r){e=M("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",n=function(t){e.remove(),n=null,t&&r("error"===t.type?404:200,t.type)}),y.head.appendChild(e[0])},abort:function(){n&&n()}}}));var tn,en=[],nn=/(=)\?(?=&|$)|\?\?/;M.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=en.pop()||M.expando+"_"+Ie.guid++;return this[t]=!0,t}}),M.ajaxPrefilter("json jsonp",(function(t,e,n){var r,s,o,a=!1!==t.jsonp&&(nn.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&nn.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return r=t.jsonpCallback=_(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(nn,"$1"+r):!1!==t.jsonp&&(t.url+=(Re.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return o||M.error(r+" was not called"),o[0]},t.dataTypes[0]="json",s=i[r],i[r]=function(){o=arguments},n.always((function(){void 0===s?M(i).removeProp(r):i[r]=s,t[r]&&(t.jsonpCallback=e.jsonpCallback,en.push(r)),o&&_(s)&&s(o[0]),o=s=void 0})),"script"})),g.createHTMLDocument=((tn=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===tn.childNodes.length),M.parseHTML=function(t,e,n){return"string"!=typeof t?[]:("boolean"==typeof e&&(n=e,e=!1),e||(g.createHTMLDocument?((i=(e=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,e.head.appendChild(i)):e=y),s=!n&&[],(r=z.exec(t))?[e.createElement(r[1])]:(r=kt([t],e,s),s&&s.length&&M(s).remove(),M.merge([],r.childNodes)));var i,r,s},M.fn.load=function(t,e,n){var i,r,s,o=this,a=t.indexOf(" ");return a>-1&&(i=Me(t.slice(a)),t=t.slice(0,a)),_(e)?(n=e,e=void 0):e&&"object"==typeof e&&(r="POST"),o.length>0&&M.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done((function(t){s=arguments,o.html(i?M("<div>").append(M.parseHTML(t)).find(i):t)})).always(n&&function(t,e){o.each((function(){n.apply(this,s||[t.responseText,e,t])}))}),this},M.expr.pseudos.animated=function(t){return M.grep(M.timers,(function(e){return t===e.elem})).length},M.offset={setOffset:function(t,e,n){var i,r,s,o,a,l,c=M.css(t,"position"),u=M(t),h={};"static"===c&&(t.style.position="relative"),a=u.offset(),s=M.css(t,"top"),l=M.css(t,"left"),("absolute"===c||"fixed"===c)&&(s+l).indexOf("auto")>-1?(o=(i=u.position()).top,r=i.left):(o=parseFloat(s)||0,r=parseFloat(l)||0),_(e)&&(e=e.call(t,n,M.extend({},a))),null!=e.top&&(h.top=e.top-a.top+o),null!=e.left&&(h.left=e.left-a.left+r),"using"in e?e.using.call(t,h):u.css(h)}},M.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){M.offset.setOffset(this,t,e)}));var e,n,i=this[0];return i?i.getClientRects().length?(e=i.getBoundingClientRect(),n=i.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,n,i=this[0],r={top:0,left:0};if("fixed"===M.css(i,"position"))e=i.getBoundingClientRect();else{for(e=this.offset(),n=i.ownerDocument,t=i.offsetParent||n.documentElement;t&&(t===n.body||t===n.documentElement)&&"static"===M.css(t,"position");)t=t.parentNode;t&&t!==i&&1===t.nodeType&&((r=M(t).offset()).top+=M.css(t,"borderTopWidth",!0),r.left+=M.css(t,"borderLeftWidth",!0))}return{top:e.top-r.top-M.css(i,"marginTop",!0),left:e.left-r.left-M.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===M.css(t,"position");)t=t.offsetParent;return t||mt}))}}),M.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var n="pageYOffset"===e;M.fn[t]=function(i){return tt(this,(function(t,i,r){var s;if(v(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===r)return s?s[e]:t[i];s?s.scrollTo(n?s.pageXOffset:r,n?r:s.pageYOffset):t[i]=r}),t,i,arguments.length)}})),M.each(["top","left"],(function(t,e){M.cssHooks[e]=te(g.pixelPosition,(function(t,n){if(n)return n=Jt(t,e),Xt.test(n)?M(t).position()[e]+"px":n}))})),M.each({Height:"height",Width:"width"},(function(t,e){M.each({padding:"inner"+t,content:e,"":"outer"+t},(function(n,i){M.fn[i]=function(r,s){var o=arguments.length&&(n||"boolean"!=typeof r),a=n||(!0===r||!0===s?"margin":"border");return tt(this,(function(e,n,r){var s;return v(e)?0===i.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===r?M.css(e,n,a):M.style(e,n,r,a)}),e,o?r:void 0,o)}}))})),M.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){M.fn[e]=function(t){return this.on(e,t)}})),M.fn.extend({bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)},hover:function(t,e){return this.on("mouseenter",t).on("mouseleave",e||t)}}),M.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){M.fn[e]=function(t,n){return arguments.length>0?this.on(e,null,t,n):this.trigger(e)}}));var rn=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;M.proxy=function(t,e){var n,i,r;if("string"==typeof e&&(n=t[e],e=t,t=n),_(t))return i=a.call(arguments,2),r=function(){return t.apply(e||this,i.concat(a.call(arguments)))},r.guid=t.guid=t.guid||M.guid++,r},M.holdReady=function(t){t?M.readyWait++:M.ready(!0)},M.isArray=Array.isArray,M.parseJSON=JSON.parse,M.nodeName=E,M.isFunction=_,M.isWindow=v,M.camelCase=rt,M.type=w,M.now=Date.now,M.isNumeric=function(t){var e=M.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},M.trim=function(t){return null==t?"":(t+"").replace(rn,"$1")},void 0===(n=function(){return M}.apply(e,[]))||(t.exports=n);var sn=i.jQuery,on=i.$;return M.noConflict=function(t){return i.$===M&&(i.$=on),t&&i.jQuery===M&&(i.jQuery=sn),M},void 0===r&&(i.jQuery=i.$=M),M}))},485:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AngleRepresentation:()=>G_,ArrowBuffer:()=>py,Assembly:()=>Kf,AxesRepresentation:()=>rv,BackboneRepresentation:()=>ov,BallAndStickRepresentation:()=>sv,BaseRepresentation:()=>av,Box3:()=>pe,BoxBuffer:()=>vy,BufferRepresentation:()=>Hm,CartoonRepresentation:()=>fv,Collection:()=>wg,Color:()=>Pn,Colormaker:()=>sl,ColormakerRegistry:()=>ic,Component:()=>xg,ComponentCollection:()=>$g,ConeBuffer:()=>uy,ContactRepresentation:()=>mv,Counter:()=>kc,CylinderBuffer:()=>iv,DatasourceRegistry:()=>rc,Debug:()=>Ql,DecompressorRegistry:()=>lc,DihedralHistogramRepresentation:()=>yv,DihedralRepresentation:()=>gv,DistanceRepresentation:()=>xv,EllipsoidBuffer:()=>Ay,Euler:()=>Ke,Frames:()=>Cg,HelixorientRepresentation:()=>Mv,HyperballRepresentation:()=>Lv,Kdtree:()=>jf,KeyActions:()=>df,LabelRepresentation:()=>Nv,LeftMouseButton:()=>yu,LicoriceRepresentation:()=>Cv,LineRepresentation:()=>Bv,ListingDatasource:()=>dc,Matrix3:()=>Ft,Matrix4:()=>ze,MdsrvDatasource:()=>YM,MeasurementDefaultParams:()=>Kl,MeshBuffer:()=>tf,MiddleMouseButton:()=>bu,MolecularSurface:()=>Gv,MolecularSurfaceRepresentation:()=>$v,MouseActions:()=>lf,OctahedronBuffer:()=>Py,ParserRegistry:()=>oc,PdbWriter:()=>Ec,PickingProxy:()=>Fu,Plane:()=>Ti,PointBuffer:()=>rg,PointRepresentation:()=>jv,Quaternion:()=>ce,Queue:()=>rh,RepresentationCollection:()=>Sg,RepresentationElement:()=>_g,RepresentationRegistry:()=>sc,RibbonRepresentation:()=>Yv,RightMouseButton:()=>xu,RocketRepresentation:()=>Kv,RopeRepresentation:()=>Zv,ScriptExtensions:()=>ec,SdfWriter:()=>Tc,Selection:()=>Ll,Shape:()=>Vm,ShapeComponent:()=>Yg,Signal:()=>va.Signal,SpacefillRepresentation:()=>Qv,SpatialHash:()=>Yh,SphereBuffer:()=>tg,Stage:()=>Xg,StaticDatasource:()=>XM,StlWriter:()=>Rc,Structure:()=>Fm,StructureComponent:()=>Vg,StructureComponentDefaultParameters:()=>zg,StructureRepresentation:()=>E_,Superposition:()=>Eg,SurfaceComponent:()=>Hg,TetrahedronBuffer:()=>Ly,TextBuffer:()=>U_,TorusBuffer:()=>zy,TraceRepresentation:()=>ey,TrajectoryDatasource:()=>pc,TrajectoryPlayer:()=>Pg,TubeRepresentation:()=>ny,UIStageParameters:()=>tC,UnitcellRepresentation:()=>iy,ValidationRepresentation:()=>ry,Vector2:()=>Nt,Vector3:()=>ue,Version:()=>eC,Viewer:()=>vu,Volume:()=>qp,VolumeComponent:()=>Gg,WidelineBuffer:()=>H_,autoLoad:()=>Mc,concatStructures:()=>fm,download:()=>Ia,flatten:()=>Ea,getDataInfo:()=>Ac,getFileInfo:()=>Sc,getQuery:()=>Sa,guessElement:()=>dm,setDebug:()=>tc,setListingDatasource:()=>fc,setMeasurementDefaultParams:()=>Zl,setTrajectoryDatasource:()=>mc,superpose:()=>Ug,throttle:()=>Ra,uniqueArray:()=>Oa});const i="158",r=0,s=1,o=2,a=100,l=101,c=102,u=200,h=201,d=202,p=203,f=204,m=205,g=206,_=207,v=208,y=209,b=210,x=211,w=212,S=213,A=214,M=301,C=302,E=306,T=1e3,P=1001,I=1002,R=1003,k=1004,D=1005,L=1006,O=1007,N=1008,F=1009,B=1012,U=1014,z=1015,V=1016,H=1020,G=1023,$=1026,j=1027,W=33776,q=33777,X=33778,Y=33779,K=36492,Z=2300,Q=2301,J=2302,tt=3001,et="",nt="srgb",it="srgb-linear",rt="display-p3",st="display-p3-linear",ot="linear",at="srgb",lt="rec709",ct="p3",ut=7680,ht=512,dt=513,pt=514,ft=515,mt=516,gt=517,_t=518,vt=519,yt=35044,bt=35048,xt="300 es",wt=1035,St=2e3,At=2001;class Mt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const Ct=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Et=Math.PI/180,Tt=180/Math.PI;function Pt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Ct[255&t]+Ct[t>>8&255]+Ct[t>>16&255]+Ct[t>>24&255]+"-"+Ct[255&e]+Ct[e>>8&255]+"-"+Ct[e>>16&15|64]+Ct[e>>24&255]+"-"+Ct[63&n|128]+Ct[n>>8&255]+"-"+Ct[n>>16&255]+Ct[n>>24&255]+Ct[255&i]+Ct[i>>8&255]+Ct[i>>16&255]+Ct[i>>24&255]).toLowerCase()}function It(t,e,n){return Math.max(e,Math.min(n,t))}function Rt(t,e,n){return(1-n)*t+n*e}function kt(t){return!(t&t-1)&&0!==t}function Dt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Lt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Ot(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}class Nt{constructor(t=0,e=0){Nt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(It(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ft{constructor(t,e,n,i,r,s,o,a,l){Ft.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,o,a,l)}set(t,e,n,i,r,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=r,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],_=i[1],v=i[4],y=i[7],b=i[2],x=i[5],w=i[8];return r[0]=s*f+o*_+a*b,r[3]=s*m+o*v+a*x,r[6]=s*g+o*y+a*w,r[1]=l*f+c*_+u*b,r[4]=l*m+c*v+u*x,r[7]=l*g+c*y+u*w,r[2]=h*f+d*_+p*b,r[5]=h*m+d*v+p*x,r[8]=h*g+d*y+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*r*c+n*o*a+i*r*l-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*r,d=l*r-s*a,p=e*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(i*l-c*n)*f,t[2]=(o*n-i*s)*f,t[3]=h*f,t[4]=(c*e-i*a)*f,t[5]=(i*r-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-i*l,i*a,-i*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Bt.makeScale(t,e)),this}rotate(t){return this.premultiply(Bt.makeRotation(-t)),this}translate(t,e){return this.premultiply(Bt.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Bt=new Ft;function Ut(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function zt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Vt(){const t=zt("canvas");return t.style.display="block",t}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const Ht={};function Gt(t){t in Ht||(Ht[t]=!0,console.warn(t))}const $t=(new Ft).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),jt=(new Ft).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Wt={[it]:{transfer:ot,primaries:lt,toReference:t=>t,fromReference:t=>t},[nt]:{transfer:at,primaries:lt,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[st]:{transfer:ot,primaries:ct,toReference:t=>t.applyMatrix3(jt),fromReference:t=>t.applyMatrix3($t)},[rt]:{transfer:at,primaries:ct,toReference:t=>t.convertSRGBToLinear().applyMatrix3(jt),fromReference:t=>t.applyMatrix3($t).convertLinearToSRGB()}},qt=new Set([it,st]),Xt={enabled:!0,_workingColorSpace:it,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(t){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!t},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!qt.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;const i=Wt[e].toReference;return(0,Wt[n].fromReference)(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Wt[t].primaries},getTransfer:function(t){return t===et?ot:Wt[t].transfer}};function Yt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Kt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Zt;class Qt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Zt&&(Zt=zt("canvas")),Zt.width=t.width,Zt.height=t.height;const n=Zt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Zt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=zt("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*Yt(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Yt(e[t]/255)):e[t]=Yt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Jt=0;class te{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Jt++}),this.uuid=Pt(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(ee(i[e].image)):t.push(ee(i[e]))}else t=ee(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function ee(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Qt.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ne=0;class ie extends Mt{constructor(t=ie.DEFAULT_IMAGE,e=ie.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,o=1023,a=1009,l=ie.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ne++}),this.uuid=Pt(),this.name="",this.source=new te(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Nt(0,0),this.repeat=new Nt(1,1),this.center=new Nt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ft,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(Gt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===tt?nt:et),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case T:t.x=t.x-Math.floor(t.x);break;case P:t.x=t.x<0?0:1;break;case I:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case T:t.y=t.y-Math.floor(t.y);break;case P:t.y=t.y<0?0:1;break;case I:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Gt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===nt?tt:3e3}set encoding(t){Gt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===tt?nt:et}}ie.DEFAULT_IMAGE=null,ie.DEFAULT_MAPPING=300,ie.DEFAULT_ANISOTROPY=1;class re{constructor(t=0,e=0,n=0,i=1){re.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,_=(g+1)/2,v=(c+h)/4,y=(u+f)/4,b=(p+m)/4;return t>a&&t>_?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=v/n,r=y/n):a>_?a<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=v/i,r=b/i):_<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=y/r,i=b/r),this.set(n,i,r,e),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class se extends Mt{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new re(0,0,t,e),this.scissorTest=!1,this.viewport=new re(0,0,t,e);const i={width:t,height:e,depth:1};void 0!==n.encoding&&(Gt("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===tt?nt:et),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:L,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new ie(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new te(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class oe extends se{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class ae extends ie{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=R,this.minFilter=R,this.wrapR=P,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class le extends ie{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=R,this.minFilter=R,this.wrapR=P,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ce{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,o){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||a!==h||l!==d||c!==p){let t=1-o;const e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*t+h*r,l=l*t+d*r,c=c*t+p*r,u=u*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,r,s){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,i=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(It(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+i*l-r*a,this._y=i*c+s*a+r*o-n*l,this._z=r*c+s*l+n*a-i*o,this._w=s*c-n*o-i*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ue{constructor(t=0,e=0,n=0){ue.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(de.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(de.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*i-o*n),c=2*(o*e-r*i),u=2*(r*n-s*e);return this.x=e+a*l+s*u-o*c,this.y=n+a*c+o*l-r*u,this.z=i+a*u+r*c-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return he.copy(this).projectOnVector(t),this.sub(he)}reflect(t){return this.sub(he.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(It(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const he=new ue,de=new ce;class pe{constructor(t=new ue(1/0,1/0,1/0),e=new ue(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(me.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(me.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=me.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,n=i.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,me):me.fromBufferAttribute(i,e),me.applyMatrix4(t.matrixWorld),this.expandByPoint(me);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),ge.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),ge.copy(n.boundingBox)),ge.applyMatrix4(t.matrixWorld),this.union(ge)}const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,me),me.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Se),Ae.subVectors(this.max,Se),_e.subVectors(t.a,Se),ve.subVectors(t.b,Se),ye.subVectors(t.c,Se),be.subVectors(ve,_e),xe.subVectors(ye,ve),we.subVectors(_e,ye);let e=[0,-be.z,be.y,0,-xe.z,xe.y,0,-we.z,we.y,be.z,0,-be.x,xe.z,0,-xe.x,we.z,0,-we.x,-be.y,be.x,0,-xe.y,xe.x,0,-we.y,we.x,0];return!!Ee(e,_e,ve,ye,Ae)&&(e=[1,0,0,0,1,0,0,0,1],!!Ee(e,_e,ve,ye,Ae)&&(Me.crossVectors(be,xe),e=[Me.x,Me.y,Me.z],Ee(e,_e,ve,ye,Ae)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,me).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(me).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(fe[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),fe[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),fe[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),fe[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),fe[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),fe[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),fe[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),fe[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(fe)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const fe=[new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue],me=new ue,ge=new pe,_e=new ue,ve=new ue,ye=new ue,be=new ue,xe=new ue,we=new ue,Se=new ue,Ae=new ue,Me=new ue,Ce=new ue;function Ee(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){Ce.fromArray(t,s);const o=r.x*Math.abs(Ce.x)+r.y*Math.abs(Ce.y)+r.z*Math.abs(Ce.z),a=e.dot(Ce),l=n.dot(Ce),c=i.dot(Ce);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Te=new pe,Pe=new ue,Ie=new ue;class Re{constructor(t=new ue,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Te.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Pe.subVectors(t,this.center);const e=Pe.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(Pe,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Ie.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Pe.copy(t.center).add(Ie)),this.expandByPoint(Pe.copy(t.center).sub(Ie))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ke=new ue,De=new ue,Le=new ue,Oe=new ue,Ne=new ue,Fe=new ue,Be=new ue;class Ue{constructor(t=new ue,e=new ue(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ke)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ke.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ke.copy(this.origin).addScaledVector(this.direction,e),ke.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){De.copy(t).add(e).multiplyScalar(.5),Le.copy(e).sub(t).normalize(),Oe.copy(this.origin).sub(De);const r=.5*t.distanceTo(e),s=-this.direction.dot(Le),o=Oe.dot(this.direction),a=-Oe.dot(Le),l=Oe.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*a-o,h=s*o-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const t=1/c;u*=t,h*=t,d=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-s*r+o)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(s*r+o)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(De).addScaledVector(Le,h),d}intersectSphere(t,e){ke.subVectors(t.center,this.origin);const n=ke.dot(this.direction),i=ke.dot(ke)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),c>=0?(r=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(r=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,ke)}intersectTriangle(t,e,n,i,r){Ne.subVectors(e,t),Fe.subVectors(n,t),Be.crossVectors(Ne,Fe);let s,o=this.direction.dot(Be);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Oe.subVectors(this.origin,t);const a=s*this.direction.dot(Fe.crossVectors(Oe,Fe));if(a<0)return null;const l=s*this.direction.dot(Ne.cross(Oe));if(l<0)return null;if(a+l>o)return null;const c=-s*Oe.dot(Be);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ze{constructor(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){ze.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m)}set(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ze).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Ve.setFromMatrixColumn(t,0).length(),r=1/Ve.setFromMatrixColumn(t,1).length(),s=1/Ve.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=s*c,n=s*u,i=o*c,r=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*u,i=l*c,r=l*u;e[0]=t+r*o,e[4]=i*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*u,i=l*c,r=l*u;e[0]=t-r*o,e[4]=-s*u,e[8]=i+n*o,e[1]=n+i*o,e[5]=s*c,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*u,i=o*c,r=o*u;e[0]=a*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=a*u,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=r-t*u,e[8]=i*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+i,e[10]=t-r*u}else if("XZY"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+r,e[5]=s*c,e[9]=n*u-i,e[2]=i*u-n,e[6]=o*c,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ge,t,$e)}lookAt(t,e,n){const i=this.elements;return qe.subVectors(t,e),0===qe.lengthSq()&&(qe.z=1),qe.normalize(),je.crossVectors(n,qe),0===je.lengthSq()&&(1===Math.abs(n.z)?qe.x+=1e-4:qe.z+=1e-4,qe.normalize(),je.crossVectors(n,qe)),je.normalize(),We.crossVectors(qe,je),i[0]=je.x,i[4]=We.x,i[8]=qe.x,i[1]=je.y,i[5]=We.y,i[9]=qe.y,i[2]=je.z,i[6]=We.z,i[10]=qe.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],b=n[15],x=i[0],w=i[4],S=i[8],A=i[12],M=i[1],C=i[5],E=i[9],T=i[13],P=i[2],I=i[6],R=i[10],k=i[14],D=i[3],L=i[7],O=i[11],N=i[15];return r[0]=s*x+o*M+a*P+l*D,r[4]=s*w+o*C+a*I+l*L,r[8]=s*S+o*E+a*R+l*O,r[12]=s*A+o*T+a*k+l*N,r[1]=c*x+u*M+h*P+d*D,r[5]=c*w+u*C+h*I+d*L,r[9]=c*S+u*E+h*R+d*O,r[13]=c*A+u*T+h*k+d*N,r[2]=p*x+f*M+m*P+g*D,r[6]=p*w+f*C+m*I+g*L,r[10]=p*S+f*E+m*R+g*O,r[14]=p*A+f*T+m*k+g*N,r[3]=_*x+v*M+y*P+b*D,r[7]=_*w+v*C+y*I+b*L,r[11]=_*S+v*E+y*R+b*O,r[15]=_*A+v*T+y*k+b*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+r*a*u-i*l*u-r*o*h+n*l*h+i*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+r*s*h-i*s*d+i*l*c-r*a*c)+t[11]*(+e*l*u-e*o*d-r*s*u+n*s*d+r*o*c-n*l*c)+t[15]*(-i*o*c-e*a*u+e*o*h+i*s*u-n*s*h+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],_=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,v=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,y=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,b=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,x=e*_+n*v+i*y+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=_*w,t[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,t[2]=(o*m*r-f*a*r+f*i*l-n*m*l-o*i*g+n*a*g)*w,t[3]=(u*a*r-o*h*r-u*i*l+n*h*l+o*i*d-n*a*d)*w,t[4]=v*w,t[5]=(c*m*r-p*h*r+p*i*d-e*m*d-c*i*g+e*h*g)*w,t[6]=(p*a*r-s*m*r-p*i*l+e*m*l+s*i*g-e*a*g)*w,t[7]=(s*h*r-c*a*r+c*i*l-e*h*l-s*i*d+e*a*d)*w,t[8]=y*w,t[9]=(p*u*r-c*f*r-p*n*d+e*f*d+c*n*g-e*u*g)*w,t[10]=(s*f*r-p*o*r+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(c*o*r-s*u*r-c*n*l+e*u*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(c*f*i-p*u*i+p*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(p*o*i-s*f*i-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*u*i-c*o*i+c*n*a-e*u*a-s*n*h+e*o*h)*w,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,o=t.y,a=t.z,l=r*s,c=r*o;return this.set(l*s+n,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+n,c*a-i*s,0,l*a-i*o,c*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,c=s+s,u=o+o,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=o*u,_=a*l,v=a*c,y=a*u,b=n.x,x=n.y,w=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+y)*b,i[2]=(p-v)*b,i[3]=0,i[4]=(d-y)*x,i[5]=(1-(h+g))*x,i[6]=(m+_)*x,i[7]=0,i[8]=(p+v)*w,i[9]=(m-_)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Ve.set(i[0],i[1],i[2]).length();const s=Ve.set(i[4],i[5],i[6]).length(),o=Ve.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],He.copy(this);const a=1/r,l=1/s,c=1/o;return He.elements[0]*=a,He.elements[1]*=a,He.elements[2]*=a,He.elements[4]*=l,He.elements[5]*=l,He.elements[6]*=l,He.elements[8]*=c,He.elements[9]*=c,He.elements[10]*=c,e.setFromRotationMatrix(He),n.x=r,n.y=s,n.z=o,this}makePerspective(t,e,n,i,r,s,o=2e3){const a=this.elements,l=2*r/(e-t),c=2*r/(n-i),u=(e+t)/(e-t),h=(n+i)/(n-i);let d,p;if(o===St)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(o!==At)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-r),p=-s*r/(s-r)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,i,r,s,o=2e3){const a=this.elements,l=1/(e-t),c=1/(n-i),u=1/(s-r),h=(e+t)*l,d=(n+i)*c;let p,f;if(o===St)p=(s+r)*u,f=-2*u;else{if(o!==At)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=r*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Ve=new ue,He=new ze,Ge=new ue(0,0,0),$e=new ue(1,1,1),je=new ue,We=new ue,qe=new ue,Xe=new ze,Ye=new ce;class Ke{constructor(t=0,e=0,n=0,i=Ke.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(It(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-It(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(It(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-It(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(It(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-It(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Xe.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Xe,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ye.setFromEuler(this),this.setFromQuaternion(Ye,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ke.DEFAULT_ORDER="XYZ";class Ze{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Qe=0;const Je=new ue,tn=new ce,en=new ze,nn=new ue,rn=new ue,sn=new ue,on=new ce,an=new ue(1,0,0),ln=new ue(0,1,0),cn=new ue(0,0,1),un={type:"added"},hn={type:"removed"};class dn extends Mt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Qe++}),this.uuid=Pt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=dn.DEFAULT_UP.clone();const t=new ue,e=new Ke,n=new ce,i=new ue(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ze},normalMatrix:{value:new Ft}}),this.matrix=new ze,this.matrixWorld=new ze,this.matrixAutoUpdate=dn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=dn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Ze,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return tn.setFromAxisAngle(t,e),this.quaternion.multiply(tn),this}rotateOnWorldAxis(t,e){return tn.setFromAxisAngle(t,e),this.quaternion.premultiply(tn),this}rotateX(t){return this.rotateOnAxis(an,t)}rotateY(t){return this.rotateOnAxis(ln,t)}rotateZ(t){return this.rotateOnAxis(cn,t)}translateOnAxis(t,e){return Je.copy(t).applyQuaternion(this.quaternion),this.position.add(Je.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(an,t)}translateY(t){return this.translateOnAxis(ln,t)}translateZ(t){return this.translateOnAxis(cn,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(en.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?nn.copy(t):nn.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),rn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?en.lookAt(rn,nn,this.up):en.lookAt(nn,rn,this.up),this.quaternion.setFromRotationMatrix(en),i&&(en.extractRotation(i.matrixWorld),tn.setFromRotationMatrix(en),this.quaternion.premultiply(tn.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(un)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(hn)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),en.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),en.multiply(t.parent.matrixWorld)),t.applyMatrix4(en),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e){let n=[];this[t]===e&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectsByProperty(t,e);r.length>0&&(n=n.concat(r))}return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rn,t,sn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rn,on,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){const i=e[n];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),u=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}dn.DEFAULT_UP=new ue(0,1,0),dn.DEFAULT_MATRIX_AUTO_UPDATE=!0,dn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const pn=new ue,fn=new ue,mn=new ue,gn=new ue,_n=new ue,vn=new ue,yn=new ue,bn=new ue,xn=new ue,wn=new ue;let Sn=!1;class An{constructor(t=new ue,e=new ue,n=new ue){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),pn.subVectors(t,e),i.cross(pn);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){pn.subVectors(i,e),fn.subVectors(n,e),mn.subVectors(t,e);const s=pn.dot(pn),o=pn.dot(fn),a=pn.dot(mn),l=fn.dot(fn),c=fn.dot(mn),u=s*l-o*o;if(0===u)return r.set(-2,-1,-1);const h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,gn),gn.x>=0&&gn.y>=0&&gn.x+gn.y<=1}static getUV(t,e,n,i,r,s,o,a){return!1===Sn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Sn=!0),this.getInterpolation(t,e,n,i,r,s,o,a)}static getInterpolation(t,e,n,i,r,s,o,a){return this.getBarycoord(t,e,n,i,gn),a.setScalar(0),a.addScaledVector(r,gn.x),a.addScaledVector(s,gn.y),a.addScaledVector(o,gn.z),a}static isFrontFacing(t,e,n,i){return pn.subVectors(n,e),fn.subVectors(t,e),pn.cross(fn).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return pn.subVectors(this.c,this.b),fn.subVectors(this.a,this.b),.5*pn.cross(fn).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return An.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return An.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return!1===Sn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Sn=!0),An.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}getInterpolation(t,e,n,i,r){return An.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return An.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return An.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,o;_n.subVectors(i,n),vn.subVectors(r,n),bn.subVectors(t,n);const a=_n.dot(bn),l=vn.dot(bn);if(a<=0&&l<=0)return e.copy(n);xn.subVectors(t,i);const c=_n.dot(xn),u=vn.dot(xn);if(c>=0&&u<=c)return e.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(_n,s);wn.subVectors(t,r);const d=_n.dot(wn),p=vn.dot(wn);if(p>=0&&d<=p)return e.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(vn,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return yn.subVectors(r,i),o=(u-c)/(u-c+(d-p)),e.copy(i).addScaledVector(yn,o);const g=1/(m+f+h);return s=f*g,o=h*g,e.copy(n).addScaledVector(_n,s).addScaledVector(vn,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Mn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Cn={h:0,s:0,l:0},En={h:0,s:0,l:0};function Tn(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class Pn{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=nt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Xt.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=Xt.workingColorSpace){return this.r=t,this.g=e,this.b=n,Xt.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=Xt.workingColorSpace){if(t=(t%(r=1)+r)%r,e=It(e,0,1),n=It(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Tn(r,i,t+1/3),this.g=Tn(r,i,t),this.b=Tn(r,i,t-1/3)}var r;return Xt.toWorkingColorSpace(this,i),this}setStyle(t,e=nt){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===r)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=nt){const n=Mn[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Yt(t.r),this.g=Yt(t.g),this.b=Yt(t.b),this}copyLinearToSRGB(t){return this.r=Kt(t.r),this.g=Kt(t.g),this.b=Kt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=nt){return Xt.fromWorkingColorSpace(In.copy(this),t),65536*Math.round(It(255*In.r,0,255))+256*Math.round(It(255*In.g,0,255))+Math.round(It(255*In.b,0,255))}getHexString(t=nt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Xt.workingColorSpace){Xt.fromWorkingColorSpace(In.copy(this),e);const n=In.r,i=In.g,r=In.b,s=Math.max(n,i,r),o=Math.min(n,i,r);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=c<=.5?t/(s+o):t/(2-s-o),s){case n:a=(i-r)/t+(i<r?6:0);break;case i:a=(r-n)/t+2;break;case r:a=(n-i)/t+4}a/=6}return t.h=a,t.s=l,t.l=c,t}getRGB(t,e=Xt.workingColorSpace){return Xt.fromWorkingColorSpace(In.copy(this),e),t.r=In.r,t.g=In.g,t.b=In.b,t}getStyle(t=nt){Xt.fromWorkingColorSpace(In.copy(this),t);const e=In.r,n=In.g,i=In.b;return t!==nt?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(t,e,n){return this.getHSL(Cn),this.setHSL(Cn.h+t,Cn.s+e,Cn.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Cn),t.getHSL(En);const n=Rt(Cn.h,En.h,e),i=Rt(Cn.s,En.s,e),r=Rt(Cn.l,En.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const In=new Pn;Pn.NAMES=Mn;let Rn=0;class kn extends Mt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Rn++}),this.uuid=Pt(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=a,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Pn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ut,this.stencilZFail=ut,this.stencilZPass=ut,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==a&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ut&&(n.stencilFail=this.stencilFail),this.stencilZFail!==ut&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==ut&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class Dn extends kn{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Pn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Ln=new ue,On=new Nt;class Nn{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=yt,this.updateRange={offset:0,count:-1},this.gpuType=z,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)On.fromBufferAttribute(this,e),On.applyMatrix3(t),this.setXY(e,On.x,On.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.applyMatrix3(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.applyMatrix4(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.applyNormalMatrix(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.transformDirection(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Lt(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Ot(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Lt(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ot(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Lt(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ot(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Lt(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ot(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Lt(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ot(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Ot(e,this.array),n=Ot(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Ot(e,this.array),n=Ot(n,this.array),i=Ot(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Ot(e,this.array),n=Ot(n,this.array),i=Ot(i,this.array),r=Ot(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==yt&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}class Fn extends Nn{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Bn extends Nn{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Un extends Nn{constructor(t,e,n){super(new Float32Array(t),e,n)}}let zn=0;const Vn=new ze,Hn=new dn,Gn=new ue,$n=new pe,jn=new pe,Wn=new ue;class qn extends Mt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zn++}),this.uuid=Pt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ut(t)?Bn:Fn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Ft).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Vn.makeRotationFromQuaternion(t),this.applyMatrix4(Vn),this}rotateX(t){return Vn.makeRotationX(t),this.applyMatrix4(Vn),this}rotateY(t){return Vn.makeRotationY(t),this.applyMatrix4(Vn),this}rotateZ(t){return Vn.makeRotationZ(t),this.applyMatrix4(Vn),this}translate(t,e,n){return Vn.makeTranslation(t,e,n),this.applyMatrix4(Vn),this}scale(t,e,n){return Vn.makeScale(t,e,n),this.applyMatrix4(Vn),this}lookAt(t){return Hn.lookAt(t),Hn.updateMatrix(),this.applyMatrix4(Hn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Gn).negate(),this.translate(Gn.x,Gn.y,Gn.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Un(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new pe);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ue(-1/0,-1/0,-1/0),new ue(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];$n.setFromBufferAttribute(n),this.morphTargetsRelative?(Wn.addVectors(this.boundingBox.min,$n.min),this.boundingBox.expandByPoint(Wn),Wn.addVectors(this.boundingBox.max,$n.max),this.boundingBox.expandByPoint(Wn)):(this.boundingBox.expandByPoint($n.min),this.boundingBox.expandByPoint($n.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Re);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ue,1/0);if(t){const n=this.boundingSphere.center;if($n.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];jn.setFromBufferAttribute(n),this.morphTargetsRelative?(Wn.addVectors($n.min,jn.min),$n.expandByPoint(Wn),Wn.addVectors($n.max,jn.max),$n.expandByPoint(Wn)):($n.expandByPoint(jn.min),$n.expandByPoint(jn.max))}$n.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Wn.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Wn));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Wn.fromBufferAttribute(s,e),o&&(Gn.fromBufferAttribute(t,e),Wn.add(Gn)),i=Math.max(i,n.distanceToSquared(Wn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Nn(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new ue,c[t]=new ue;const u=new ue,h=new ue,d=new ue,p=new Nt,f=new Nt,m=new Nt,g=new ue,_=new ue;function v(t,e,n){u.fromArray(i,3*t),h.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),_.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(_),c[e].add(_),c[n].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let t=0,e=y.length;t<e;++t){const e=y[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)v(n[t+0],n[t+1],n[t+2])}const b=new ue,x=new ue,w=new ue,S=new ue;function A(t){w.fromArray(r,3*t),S.copy(w);const e=l[t];b.copy(e),b.sub(w.multiplyScalar(w.dot(e))).normalize(),x.crossVectors(S,e);const n=x.dot(c[t])<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=n}for(let t=0,e=y.length;t<e;++t){const e=y[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)A(n[t+0]),A(n[t+1]),A(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Nn(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new ue,r=new ue,s=new ue,o=new ue,a=new ue,l=new ue,c=new ue,u=new ue;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Wn.fromBufferAttribute(t,e),Wn.normalize(),t.setXYZ(e,Wn.x,Wn.y,Wn.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let o=0,a=0;for(let r=0,l=e.length;r<l;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[a++]=n[o++]}return new Nn(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new qn,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],o=r[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Xn=new ze,Yn=new Ue,Kn=new Re,Zn=new ue,Qn=new ue,Jn=new ue,ti=new ue,ei=new ue,ni=new ue,ii=new Nt,ri=new Nt,si=new Nt,oi=new ue,ai=new ue,li=new ue,ci=new ue,ui=new ue;class hi extends dn{constructor(t=new qn,e=new Dn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(r&&o){ni.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=o[n],a=r[n];0!==i&&(ei.fromBufferAttribute(a,t),s?ni.addScaledVector(ei,i):ni.addScaledVector(ei.sub(e),i))}e.add(ni)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Kn.copy(n.boundingSphere),Kn.applyMatrix4(r),Yn.copy(t.ray).recast(t.near),!1===Kn.containsPoint(Yn.origin)){if(null===Yn.intersectSphere(Kn,Zn))return;if(Yn.origin.distanceToSquared(Zn)>(t.far-t.near)**2)return}Xn.copy(r).invert(),Yn.copy(t.ray).applyMatrix4(Xn),null!==n.boundingBox&&!1===Yn.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,Yn)}}_computeIntersections(t,e,n){let i;const r=this.geometry,s=this.material,o=r.index,a=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(s))for(let r=0,a=h.length;r<a;r++){const a=h[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3)i=di(this,p,t,n,l,c,u,o.getX(r),o.getX(r+1),o.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,e.push(i))}else for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3)i=di(this,s,t,n,l,c,u,o.getX(r),o.getX(r+1),o.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),e.push(i));else if(void 0!==a)if(Array.isArray(s))for(let r=0,o=h.length;r<o;r++){const o=h[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3)i=di(this,p,t,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,e.push(i))}else for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3)i=di(this,s,t,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}function di(t,e,n,i,r,s,o,a,l,c){t.getVertexPosition(a,Qn),t.getVertexPosition(l,Jn),t.getVertexPosition(c,ti);const u=function(t,e,n,i,r,s,o,a){let l;if(l=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,0===e.side,a),null===l)return null;ui.copy(a),ui.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(ui);return c<n.near||c>n.far?null:{distance:c,point:ui.clone(),object:t}}(t,e,n,i,Qn,Jn,ti,ci);if(u){r&&(ii.fromBufferAttribute(r,a),ri.fromBufferAttribute(r,l),si.fromBufferAttribute(r,c),u.uv=An.getInterpolation(ci,Qn,Jn,ti,ii,ri,si,new Nt)),s&&(ii.fromBufferAttribute(s,a),ri.fromBufferAttribute(s,l),si.fromBufferAttribute(s,c),u.uv1=An.getInterpolation(ci,Qn,Jn,ti,ii,ri,si,new Nt),u.uv2=u.uv1),o&&(oi.fromBufferAttribute(o,a),ai.fromBufferAttribute(o,l),li.fromBufferAttribute(o,c),u.normal=An.getInterpolation(ci,Qn,Jn,ti,oi,ai,li,new ue),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const t={a,b:l,c,normal:new ue,materialIndex:0};An.getNormal(Qn,Jn,ti,t.normal),u.face=t}return u}class pi extends qn{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(t,e,n,i,r,s,p,f,m,g,_){const v=s/m,y=p/g,b=s/2,x=p/2,w=f/2,S=m+1,A=g+1;let M=0,C=0;const E=new ue;for(let s=0;s<A;s++){const o=s*y-x;for(let a=0;a<S;a++){const h=a*v-b;E[t]=h*i,E[e]=o*r,E[n]=w,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[n]=f>0?1:-1,c.push(E.x,E.y,E.z),u.push(a/m),u.push(1-s/g),M+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+S*t,i=h+e+S*(t+1),r=h+(e+1)+S*(t+1),s=h+(e+1)+S*t;a.push(n,i,s),a.push(i,r,s),C+=6}o.addGroup(d,C,_),d+=C,h+=M}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new Un(l,3)),this.setAttribute("normal",new Un(c,3)),this.setAttribute("uv",new Un(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new pi(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function fi(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function mi(t){const e={};for(let n=0;n<t.length;n++){const i=fi(t[n]);for(const t in i)e[t]=i[t]}return e}function gi(t){return null===t.getRenderTarget()?t.outputColorSpace:Xt.workingColorSpace}const _i={clone:fi,merge:mi};class vi extends kn{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=fi(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class yi extends dn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ze,this.projectionMatrix=new ze,this.projectionMatrixInverse=new ze,this.coordinateSystem=St}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class bi extends yi{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Tt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Et*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Tt*Math.atan(Math.tan(.5*Et*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Et*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/o,i*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const xi=-90;class wi extends dn{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new bi(xi,1,t,e);i.layers=this.layers,this.add(i);const r=new bi(xi,1,t,e);r.layers=this.layers,this.add(r);const s=new bi(xi,1,t,e);s.layers=this.layers,this.add(s);const o=new bi(xi,1,t,e);o.layers=this.layers,this.add(o);const a=new bi(xi,1,t,e);a.layers=this.layers,this.add(a);const l=new bi(xi,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,s,o,a]=e;for(const t of e)this.remove(t);if(t===St)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==At)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,s,o,a,l,c]=this.children,u=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,s),t.setRenderTarget(n,2,i),t.render(e,o),t.setRenderTarget(n,3,i),t.render(e,a),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,i),t.render(e,c),t.setRenderTarget(u,h,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Si extends ie{constructor(t,e,n,i,r,s,o,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:M,n,i,r,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Ai extends oe{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];void 0!==e.encoding&&(Gt("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===tt?nt:et),this.texture=new Si(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:L}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new pi(5,5,5),o=new vi({name:"CubemapFromEquirect",uniforms:fi(n),vertexShader:i,fragmentShader:r,side:1,blending:0});o.uniforms.tEquirect.value=e;const a=new hi(s,o),l=e.minFilter;return e.minFilter===N&&(e.minFilter=L),new wi(1,10,this).update(t,a),e.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}const Mi=new ue,Ci=new ue,Ei=new Ft;class Ti{constructor(t=new ue(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Mi.subVectors(n,e).cross(Ci.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(Mi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Ei.getNormalMatrix(t),i=this.coplanarPoint(Mi).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Pi=new Re,Ii=new ue;class Ri{constructor(t=new Ti,e=new Ti,n=new Ti,i=new Ti,r=new Ti,s=new Ti){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,i=t.elements,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],_=i[13],v=i[14],y=i[15];if(n[0].setComponents(a-r,h-l,m-d,y-g).normalize(),n[1].setComponents(a+r,h+l,m+d,y+g).normalize(),n[2].setComponents(a+s,h+c,m+p,y+_).normalize(),n[3].setComponents(a-s,h-c,m-p,y-_).normalize(),n[4].setComponents(a-o,h-u,m-f,y-v).normalize(),e===St)n[5].setComponents(a+o,h+u,m+f,y+v).normalize();else{if(e!==At)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(o,u,f,v).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),Pi.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),Pi.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Pi)}intersectsSprite(t){return Pi.center.set(0,0,0),Pi.radius=.7071067811865476,Pi.applyMatrix4(t.matrixWorld),this.intersectsSphere(Pi)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(Ii.x=i.normal.x>0?t.max.x:t.min.x,Ii.y=i.normal.y>0?t.max.y:t.min.y,Ii.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Ii)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ki(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Di(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);void 0===s?i.set(e,function(e,i){const r=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback(),r instanceof Float32Array)a=t.FLOAT;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=t.HALF_FLOAT}else a=t.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=t.SHORT;else if(r instanceof Uint32Array)a=t.UNSIGNED_INT;else if(r instanceof Int32Array)a=t.INT;else if(r instanceof Int8Array)a=t.BYTE;else if(r instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function(e,i,r){const s=i.array,o=i.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(n?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),i.onUploadCallback()}(s.buffer,e,r),s.version=e.version)}}}class Li extends qn{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,o=Math.floor(n),a=Math.floor(i),l=o+1,c=a+1,u=t/o,h=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*h-s;for(let n=0;n<l;n++){const i=n*u-r;p.push(i,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,i=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Un(p,3)),this.setAttribute("normal",new Un(f,3)),this.setAttribute("uv",new Un(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Li(t.width,t.height,t.widthSegments,t.heightSegments)}}const Oi={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Ni={common:{diffuse:{value:new Pn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ft},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ft}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ft}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ft}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ft},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ft},normalScale:{value:new Nt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ft},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ft}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ft}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ft}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Pn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Pn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0},uvTransform:{value:new Ft}},sprite:{diffuse:{value:new Pn(16777215)},opacity:{value:1},center:{value:new Nt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ft},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0}}},Fi={basic:{uniforms:mi([Ni.common,Ni.specularmap,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.fog]),vertexShader:Oi.meshbasic_vert,fragmentShader:Oi.meshbasic_frag},lambert:{uniforms:mi([Ni.common,Ni.specularmap,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)}}]),vertexShader:Oi.meshlambert_vert,fragmentShader:Oi.meshlambert_frag},phong:{uniforms:mi([Ni.common,Ni.specularmap,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)},specular:{value:new Pn(1118481)},shininess:{value:30}}]),vertexShader:Oi.meshphong_vert,fragmentShader:Oi.meshphong_frag},standard:{uniforms:mi([Ni.common,Ni.envmap,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.roughnessmap,Ni.metalnessmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Oi.meshphysical_vert,fragmentShader:Oi.meshphysical_frag},toon:{uniforms:mi([Ni.common,Ni.aomap,Ni.lightmap,Ni.emissivemap,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.gradientmap,Ni.fog,Ni.lights,{emissive:{value:new Pn(0)}}]),vertexShader:Oi.meshtoon_vert,fragmentShader:Oi.meshtoon_frag},matcap:{uniforms:mi([Ni.common,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,Ni.fog,{matcap:{value:null}}]),vertexShader:Oi.meshmatcap_vert,fragmentShader:Oi.meshmatcap_frag},points:{uniforms:mi([Ni.points,Ni.fog]),vertexShader:Oi.points_vert,fragmentShader:Oi.points_frag},dashed:{uniforms:mi([Ni.common,Ni.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Oi.linedashed_vert,fragmentShader:Oi.linedashed_frag},depth:{uniforms:mi([Ni.common,Ni.displacementmap]),vertexShader:Oi.depth_vert,fragmentShader:Oi.depth_frag},normal:{uniforms:mi([Ni.common,Ni.bumpmap,Ni.normalmap,Ni.displacementmap,{opacity:{value:1}}]),vertexShader:Oi.meshnormal_vert,fragmentShader:Oi.meshnormal_frag},sprite:{uniforms:mi([Ni.sprite,Ni.fog]),vertexShader:Oi.sprite_vert,fragmentShader:Oi.sprite_frag},background:{uniforms:{uvTransform:{value:new Ft},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Oi.background_vert,fragmentShader:Oi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Oi.backgroundCube_vert,fragmentShader:Oi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Oi.cube_vert,fragmentShader:Oi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Oi.equirect_vert,fragmentShader:Oi.equirect_frag},distanceRGBA:{uniforms:mi([Ni.common,Ni.displacementmap,{referencePosition:{value:new ue},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Oi.distanceRGBA_vert,fragmentShader:Oi.distanceRGBA_frag},shadow:{uniforms:mi([Ni.lights,Ni.fog,{color:{value:new Pn(0)},opacity:{value:1}}]),vertexShader:Oi.shadow_vert,fragmentShader:Oi.shadow_frag}};Fi.physical={uniforms:mi([Fi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ft},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ft},clearcoatNormalScale:{value:new Nt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ft},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ft},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ft},sheen:{value:0},sheenColor:{value:new Pn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ft},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ft},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ft},transmissionSamplerSize:{value:new Nt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ft},attenuationDistance:{value:0},attenuationColor:{value:new Pn(0)},specularColor:{value:new Pn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ft},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ft},anisotropyVector:{value:new Nt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ft}}]),vertexShader:Oi.meshphysical_vert,fragmentShader:Oi.meshphysical_frag};const Bi={r:0,b:0,g:0};function Ui(t,e,n,i,r,s,o){const a=new Pn(0);let l,c,u=!0===s?0:1,h=null,d=0,p=null;function f(e,n){e.getRGB(Bi,gi(t)),i.buffers.color.setClear(Bi.r,Bi.g,Bi.b,n,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),u=e,f(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,f(a,u)},render:function(s,m){let g=!1,_=!0===m.isScene?m.background:null;_&&_.isTexture&&(_=(m.backgroundBlurriness>0?n:e).get(_)),null===_?f(a,u):_&&_.isColor&&(f(_,1),g=!0);const v=t.xr.getEnvironmentBlendMode();"additive"===v?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===v&&i.buffers.color.setClear(0,0,0,0,o),(t.autoClear||g)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),_&&(_.isCubeTexture||_.mapping===E)?(void 0===c&&(c=new hi(new pi(1,1,1),new vi({name:"BackgroundCubeMaterial",uniforms:fi(Fi.backgroundCube.uniforms),vertexShader:Fi.backgroundCube.vertexShader,fragmentShader:Fi.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=Xt.getTransfer(_.colorSpace)!==at,h===_&&d===_.version&&p===t.toneMapping||(c.material.needsUpdate=!0,h=_,d=_.version,p=t.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new hi(new Li(2,2),new vi({name:"BackgroundMaterial",uniforms:fi(Fi.background.uniforms),vertexShader:Fi.background.vertexShader,fragmentShader:Fi.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=Xt.getTransfer(_.colorSpace)!==at,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),h===_&&d===_.version&&p===t.toneMapping||(l.material.needsUpdate=!0,h=_,d=_.version,p=t.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null))}}}function zi(t,e,n,i){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=p(null);let c=l,u=!1;function h(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function f(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function m(t){g(t,0)}function g(n,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==r&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r)}function _(){const e=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function v(e,n,i,r,s,o,a){!0===a?t.vertexAttribIPointer(e,n,i,s,o):t.vertexAttribPointer(e,n,i,r,s,o)}function y(){b(),u=!0,c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,y,b){let x=!1;if(o){const e=function(e,n,r){const o=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];return void 0===u&&(u=p(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(y,d,l);c!==e&&(c=e,h(c.object)),x=function(t,e,n,i){const r=c.attributes,s=e.attributes;let o=0;const a=n.getAttributes();for(const e in a)if(a[e].location>=0){const n=r[e];let i=s[e];if(void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;o++}return c.attributesNum!==o||c.index!==i}(r,y,d,b),x&&function(t,e,n,i){const r={},s=e.attributes;let o=0;const a=n.getAttributes();for(const e in a)if(a[e].location>=0){let n=s[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[e]=i,o++}c.attributes=r,c.attributesNum=o,c.index=i}(r,y,d,b)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===t||(c.geometry=y.id,c.program=d.id,c.wireframe=t,x=!0)}null!==b&&n.update(b,t.ELEMENT_ARRAY_BUFFER),(x||u)&&(u=!1,function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const e in c){const s=c[e];if(s.location>=0){let o=l[e];if(void 0===o&&("instanceMatrix"===e&&r.instanceMatrix&&(o=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(o=r.instanceColor)),void 0!==o){const e=o.normalized,l=o.itemSize,c=n.get(o);if(void 0===c)continue;const u=c.buffer,h=c.type,d=c.bytesPerElement,p=!0===i.isWebGL2&&(h===t.INT||h===t.UNSIGNED_INT||1013===o.gpuType);if(o.isInterleavedBufferAttribute){const n=o.data,i=n.stride,c=o.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<s.locationSize;t++)g(s.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<s.locationSize;t++)m(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,u);for(let t=0;t<s.locationSize;t++)v(s.location+t,l/s.locationSize,h,e,i*d,(c+l/s.locationSize*t)*d,p)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<s.locationSize;t++)g(s.location+t,o.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<s.locationSize;t++)m(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,u);for(let t=0;t<s.locationSize;t++)v(s.location+t,l/s.locationSize,h,e,l*d,l/s.locationSize*t*d,p)}}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(s.location,n);break;case 3:t.vertexAttrib3fv(s.location,n);break;case 4:t.vertexAttrib4fv(s.location,n);break;default:t.vertexAttrib1fv(s.location,n)}}}}_()}(r,l,d,y),null!==b&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)d(i[t].object),delete i[t];delete n[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function Vi(t,e,n,i){const r=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,o,a),n.update(o,s,a)}}function Hi(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),_=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,y=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0}}function Gi(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new Ti,a=new Ft,l={value:null,needsUpdate:!1};function c(t,n,i,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){n=c(t,e,0)},this.setState=function(o,a,u){const h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!r||null===h||0===h.length||s&&!p)s?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0);else{const t=s?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=c(h,a,e,u);for(let t=0;t!==e;++t)r[t]=n[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function $i(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=M:304===e&&(t.mapping=C),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(303===s||304===s){if(e.has(r))return n(e.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const o=new Ai(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}class ji extends yi{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Wi=[.125,.215,.35,.446,.526,.582],qi=new ji,Xi=new Pn;let Yi=null,Ki=0,Zi=0;const Qi=(1+Math.sqrt(5))/2,Ji=1/Qi,tr=[new ue(1,1,1),new ue(-1,1,1),new ue(1,1,-1),new ue(-1,1,-1),new ue(0,Qi,Ji),new ue(0,Qi,-Ji),new ue(Ji,0,Qi),new ue(-Ji,0,Qi),new ue(Qi,Ji,0),new ue(-Qi,Ji,0)];class er{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Yi=this._renderer.getRenderTarget(),Ki=this._renderer.getActiveCubeFace(),Zi=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=sr(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=rr(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Yi,Ki,Zi),t.scissorTest=!1,ir(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===M||t.mapping===C?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Yi=this._renderer.getRenderTarget(),Ki=this._renderer.getActiveCubeFace(),Zi=this._renderer.getActiveMipmapLevel();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:L,minFilter:L,generateMipmaps:!1,type:V,format:G,colorSpace:it,depthBuffer:!1},i=nr(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=nr(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+Wi.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>t-4?a=Wi[o-t+4-1]:0===o&&(a=0),i.push(a);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*d),v=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];_.set(i,f*p*t),v.set(h,m*p*t);const r=[t,t,t,t,t,t];y.set(r,g*p*t)}const b=new qn;b.setAttribute("position",new Nn(_,f)),b.setAttribute("uv",new Nn(v,m)),b.setAttribute("faceIndex",new Nn(y,g)),e.push(b),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(20),r=new ue(0,1,0);return new vi({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,t,e)}return i}_compileMaterial(t){const e=new hi(this._lodPlanes[0],t);this._renderer.compile(e,qi)}_sceneToCubeUV(t,e,n,i){const r=new bi(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(Xi),a.toneMapping=0,a.autoClear=!1;const u=new Dn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new hi(new pi,u);let d=!1;const p=t.background;p?p.isColor&&(u.color.copy(p),t.background=null,d=!0):(u.color.copy(Xi),d=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1===n?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e]));const l=this._cubeSize;ir(i,n*l,e>2?l:0,l,l),a.setRenderTarget(i),d&&a.render(h,r),a.render(t,r)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===M||t.mapping===C;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=sr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=rr());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new hi(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const o=this._cubeSize;ir(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,qi)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=tr[(e-1)%tr.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new hi(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=d,u.mipInt.value=_-n;const v=this._sizeLods[i];ir(e,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(e),a.render(c,qi)}}function nr(t,e,n){const i=new oe(t,e,n);return i.texture.mapping=E,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ir(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function rr(){return new vi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function sr(){return new vi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function or(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=303===s||304===s,a=s===M||s===C;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=e.get(r);return null===n&&(n=new er(t)),i=o?n.fromEquirectangular(r,i):n.fromCubemap(r,i),e.set(r,i),i.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(t){let e=0;for(let n=0;n<6;n++)void 0!==t[n]&&e++;return 6===e}(s)){null===n&&(n=new er(t));const s=o?n.fromEquirectangular(r):n.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ar(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function lr(t,e,n,i){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);for(const t in a.morphAttributes){const n=a.morphAttributes[t];for(let t=0,i=n.length;t<i;t++)e.remove(n[t])}a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}}const a=new(Ut(n)?Bn:Fn)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(n){const i=n.attributes;for(const n in i)e.update(i[n],t.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)e.update(i[n],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function cr(t,e,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,o,e*a),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,h;if(r)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,i*a,c),n.update(l,s,c)}}function ur(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function hr(t,e){return t[0]-e[0]}function dr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function pr(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new re,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,c,u){const h=l.morphTargetInfluences;if(!0===e.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let f=s.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const _=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],x=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let S=0;!0===_&&(S=1),!0===v&&(S=2),!0===y&&(S=3);let A=c.attributes.position.count*S,M=1;A>e.maxTextureSize&&(M=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const C=new Float32Array(A*M*4*p),E=new ae(C,A,M,p);E.type=z,E.needsUpdate=!0;const T=4*S;for(let I=0;I<p;I++){const R=b[I],k=x[I],D=w[I],L=A*M*4*I;for(let O=0;O<R.count;O++){const N=O*T;!0===_&&(o.fromBufferAttribute(R,O),C[L+N+0]=o.x,C[L+N+1]=o.y,C[L+N+2]=o.z,C[L+N+3]=0),!0===v&&(o.fromBufferAttribute(k,O),C[L+N+4]=o.x,C[L+N+5]=o.y,C[L+N+6]=o.z,C[L+N+7]=0),!0===y&&(o.fromBufferAttribute(D,O),C[L+N+8]=o.x,C[L+N+9]=o.y,C[L+N+10]=o.z,C[L+N+11]=4===D.itemSize?o.w:1)}}function P(){E.dispose(),s.delete(c),c.removeEventListener("dispose",P)}f={count:p,texture:E,size:new Nt(A,M)},s.set(c,f),c.addEventListener("dispose",P)}let m=0;for(let F=0;F<h.length;F++)m+=h[F];const g=c.morphTargetsRelative?1:1-m;u.getUniforms().setValue(t,"morphTargetBaseInfluence",g),u.getUniforms().setValue(t,"morphTargetInfluences",h),u.getUniforms().setValue(t,"morphTargetsTexture",f.texture,n),u.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const B=void 0===h?0:h.length;let U=i[c.id];if(void 0===U||U.length!==B){U=[];for(let j=0;j<B;j++)U[j]=[j,0];i[c.id]=U}for(let W=0;W<B;W++){const q=U[W];q[0]=W,q[1]=h[W]}U.sort(dr);for(let X=0;X<8;X++)X<B&&U[X][1]?(a[X][0]=U[X][0],a[X][1]=U[X][1]):(a[X][0]=Number.MAX_SAFE_INTEGER,a[X][1]=0);a.sort(hr);const V=c.morphAttributes.position,H=c.morphAttributes.normal;let G=0;for(let Y=0;Y<8;Y++){const K=a[Y],Z=K[0],Q=K[1];Z!==Number.MAX_SAFE_INTEGER&&Q?(V&&c.getAttribute("morphTarget"+Y)!==V[Z]&&c.setAttribute("morphTarget"+Y,V[Z]),H&&c.getAttribute("morphNormal"+Y)!==H[Z]&&c.setAttribute("morphNormal"+Y,H[Z]),r[Y]=Q,G+=Q):(V&&!0===c.hasAttribute("morphTarget"+Y)&&c.deleteAttribute("morphTarget"+Y),H&&!0===c.hasAttribute("morphNormal"+Y)&&c.deleteAttribute("morphNormal"+Y),r[Y]=0)}const $=c.morphTargetsRelative?1:1-G;u.getUniforms().setValue(t,"morphTargetBaseInfluence",$),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function fr(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(o){const a=i.render.frame,l=o.geometry,c=e.get(o,l);if(r.get(c)!==a&&(e.update(c),r.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),r.get(o)!==a&&(n.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,t.ARRAY_BUFFER),r.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;r.get(t)!==a&&(t.update(),r.set(t,a))}return c},dispose:function(){r=new WeakMap}}}const mr=new ie,gr=new ae,_r=new le,vr=new Si,yr=[],br=[],xr=new Float32Array(16),wr=new Float32Array(9),Sr=new Float32Array(4);function Ar(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=yr[r];if(void 0===s&&(s=new Float32Array(r),yr[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function Mr(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Cr(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Er(t,e){let n=br[e];void 0===n&&(n=new Int32Array(e),br[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Tr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Pr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Mr(n,e))return;t.uniform2fv(this.addr,e),Cr(n,e)}}function Ir(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Mr(n,e))return;t.uniform3fv(this.addr,e),Cr(n,e)}}function Rr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Mr(n,e))return;t.uniform4fv(this.addr,e),Cr(n,e)}}function kr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Mr(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Cr(n,e)}else{if(Mr(n,i))return;Sr.set(i),t.uniformMatrix2fv(this.addr,!1,Sr),Cr(n,i)}}function Dr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Mr(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Cr(n,e)}else{if(Mr(n,i))return;wr.set(i),t.uniformMatrix3fv(this.addr,!1,wr),Cr(n,i)}}function Lr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Mr(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Cr(n,e)}else{if(Mr(n,i))return;xr.set(i),t.uniformMatrix4fv(this.addr,!1,xr),Cr(n,i)}}function Or(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Nr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Mr(n,e))return;t.uniform2iv(this.addr,e),Cr(n,e)}}function Fr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Mr(n,e))return;t.uniform3iv(this.addr,e),Cr(n,e)}}function Br(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Mr(n,e))return;t.uniform4iv(this.addr,e),Cr(n,e)}}function Ur(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function zr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Mr(n,e))return;t.uniform2uiv(this.addr,e),Cr(n,e)}}function Vr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Mr(n,e))return;t.uniform3uiv(this.addr,e),Cr(n,e)}}function Hr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Mr(n,e))return;t.uniform4uiv(this.addr,e),Cr(n,e)}}function Gr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(e||mr,r)}function $r(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||_r,r)}function jr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||vr,r)}function Wr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||gr,r)}function qr(t,e){t.uniform1fv(this.addr,e)}function Xr(t,e){const n=Ar(e,this.size,2);t.uniform2fv(this.addr,n)}function Yr(t,e){const n=Ar(e,this.size,3);t.uniform3fv(this.addr,n)}function Kr(t,e){const n=Ar(e,this.size,4);t.uniform4fv(this.addr,n)}function Zr(t,e){const n=Ar(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Qr(t,e){const n=Ar(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Jr(t,e){const n=Ar(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function ts(t,e){t.uniform1iv(this.addr,e)}function es(t,e){t.uniform2iv(this.addr,e)}function ns(t,e){t.uniform3iv(this.addr,e)}function is(t,e){t.uniform4iv(this.addr,e)}function rs(t,e){t.uniform1uiv(this.addr,e)}function ss(t,e){t.uniform2uiv(this.addr,e)}function os(t,e){t.uniform3uiv(this.addr,e)}function as(t,e){t.uniform4uiv(this.addr,e)}function ls(t,e,n){const i=this.cache,r=e.length,s=Er(n,r);Mr(i,s)||(t.uniform1iv(this.addr,s),Cr(i,s));for(let t=0;t!==r;++t)n.setTexture2D(e[t]||mr,s[t])}function cs(t,e,n){const i=this.cache,r=e.length,s=Er(n,r);Mr(i,s)||(t.uniform1iv(this.addr,s),Cr(i,s));for(let t=0;t!==r;++t)n.setTexture3D(e[t]||_r,s[t])}function us(t,e,n){const i=this.cache,r=e.length,s=Er(n,r);Mr(i,s)||(t.uniform1iv(this.addr,s),Cr(i,s));for(let t=0;t!==r;++t)n.setTextureCube(e[t]||vr,s[t])}function hs(t,e,n){const i=this.cache,r=e.length,s=Er(n,r);Mr(i,s)||(t.uniform1iv(this.addr,s),Cr(i,s));for(let t=0;t!==r;++t)n.setTexture2DArray(e[t]||gr,s[t])}class ds{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Tr;case 35664:return Pr;case 35665:return Ir;case 35666:return Rr;case 35674:return kr;case 35675:return Dr;case 35676:return Lr;case 5124:case 35670:return Or;case 35667:case 35671:return Nr;case 35668:case 35672:return Fr;case 35669:case 35673:return Br;case 5125:return Ur;case 36294:return zr;case 36295:return Vr;case 36296:return Hr;case 35678:case 36198:case 36298:case 36306:case 35682:return Gr;case 35679:case 36299:case 36307:return $r;case 35680:case 36300:case 36308:case 36293:return jr;case 36289:case 36303:case 36311:case 36292:return Wr}}(e.type)}}class ps{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return qr;case 35664:return Xr;case 35665:return Yr;case 35666:return Kr;case 35674:return Zr;case 35675:return Qr;case 35676:return Jr;case 5124:case 35670:return ts;case 35667:case 35671:return es;case 35668:case 35672:return ns;case 35669:case 35673:return is;case 5125:return rs;case 36294:return ss;case 36295:return os;case 36296:return as;case 35678:case 36198:case 36298:case 36306:case 35682:return ls;case 35679:case 36299:case 36307:return cs;case 35680:case 36300:case 36308:case 36293:return us;case 36289:case 36303:case 36311:case 36292:return hs}}(e.type)}}class fs{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}}}const ms=/(\w+)(\])?(\[|\.)?/g;function gs(t,e){t.seq.push(e),t.map[e.id]=e}function _s(t,e,n){const i=t.name,r=i.length;for(ms.lastIndex=0;;){const s=ms.exec(i),o=ms.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){gs(n,void 0===c?new ds(a,t,e):new ps(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new fs(a),gs(n,t)),n=t}}}class vs{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);_s(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function ys(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let bs=0;function xs(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=r;t<s;t++){const r=t+1;i.push(`${r===e?">":" "} ${r}: ${n[t]}`)}return i.join("\n")}(t.getShaderSource(e),i)}return r}function ws(t,e){const n=function(t){const e=Xt.getPrimaries(Xt.workingColorSpace),n=Xt.getPrimaries(t);let i;switch(e===n?i="":e===ct&&n===lt?i="LinearDisplayP3ToLinearSRGB":e===lt&&n===ct&&(i="LinearSRGBToLinearDisplayP3"),t){case it:case st:return[i,"LinearTransferOETF"];case nt:case rt:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[i,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function Ss(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function As(t){return""!==t}function Ms(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Cs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Es=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ts(t){return t.replace(Es,Is)}const Ps=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Is(t,e){let n=Oi[e];if(void 0===n){const t=Ps.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=Oi[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return Ts(n)}const Rs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ks(t){return t.replace(Rs,Ds)}function Ds(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Ls(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Os(t,e,n,i){const r=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case M:case C:e="ENVMAP_TYPE_CUBE";break;case E:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===C&&(e="ENVMAP_MODE_REFRACTION"),e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(As).join("\n")}(n),f=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),m=r.createProgram();let g,_,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(As).join("\n"),g.length>0&&(g+="\n"),_=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(As).join("\n"),_.length>0&&(_+="\n")):(g=[Ls(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(As).join("\n"),_=[p,Ls(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Oi.tonemapping_pars_fragment:"",0!==n.toneMapping?Ss("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Oi.colorspace_pars_fragment,ws("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(As).join("\n")),o=Ts(o),o=Ms(o,n),o=Cs(o,n),a=Ts(a),a=Ms(a,n),a=Cs(a,n),o=ks(o),a=ks(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===xt?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===xt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const y=v+g+o,b=v+_+a,x=ys(r,r.VERTEX_SHADER,y),w=ys(r,r.FRAGMENT_SHADER,b);function S(e){if(t.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(x).trim(),s=r.getShaderInfoLog(w).trim();let o=!0,a=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(o=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(r,m,x,w);else{const t=xs(r,x,"vertex"),e=xs(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+n+"\n"+t+"\n"+e)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==s||(a=!1);a&&(e.diagnostics={runnable:o,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:s,prefix:_}})}r.deleteShader(x),r.deleteShader(w),A=new vs(r,m),T=function(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let o=1;i.type===t.FLOAT_MAT2&&(o=2),i.type===t.FLOAT_MAT3&&(o=3),i.type===t.FLOAT_MAT4&&(o=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(r,m)}let A,T;r.attachShader(m,x),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===A&&S(this),A},this.getAttributes=function(){return void 0===T&&S(this),T};let P=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===P&&(P=r.getProgramParameter(m,37297)),P},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=bs++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}let Ns=0;class Fs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new Bs(t),e.set(t,n)),n}}class Bs{constructor(t){this.id=Ns++,this.code=t,this.usedTimes=0}}function Us(t,e,n,i,r,s,o){const a=new Ze,l=new Fs,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return 0===t?"uv":`uv${t}`}return{getParameters:function(s,a,c,g,_){const v=g.fog,y=_.geometry,b=s.isMeshStandardMaterial?g.environment:null,x=(s.isMeshStandardMaterial?n:e).get(s.envMap||b),w=x&&x.mapping===E?x.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const A=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,M=void 0!==A?A.length:0;let C,T,P,I,R=0;if(void 0!==y.morphAttributes.position&&(R=1),void 0!==y.morphAttributes.normal&&(R=2),void 0!==y.morphAttributes.color&&(R=3),S){const t=Fi[S];C=t.vertexShader,T=t.fragmentShader}else C=s.vertexShader,T=s.fragmentShader,l.update(s),P=l.getVertexShaderID(s),I=l.getFragmentShaderID(s);const k=t.getRenderTarget(),D=!0===_.isInstancedMesh,L=!!s.map,O=!!s.matcap,N=!!x,F=!!s.aoMap,B=!!s.lightMap,U=!!s.bumpMap,z=!!s.normalMap,V=!!s.displacementMap,H=!!s.emissiveMap,G=!!s.metalnessMap,$=!!s.roughnessMap,j=s.anisotropy>0,W=s.clearcoat>0,q=s.iridescence>0,X=s.sheen>0,Y=s.transmission>0,K=j&&!!s.anisotropyMap,Z=W&&!!s.clearcoatMap,Q=W&&!!s.clearcoatNormalMap,J=W&&!!s.clearcoatRoughnessMap,tt=q&&!!s.iridescenceMap,et=q&&!!s.iridescenceThicknessMap,nt=X&&!!s.sheenColorMap,rt=X&&!!s.sheenRoughnessMap,st=!!s.specularMap,ot=!!s.specularColorMap,lt=!!s.specularIntensityMap,ct=Y&&!!s.transmissionMap,ut=Y&&!!s.thicknessMap,ht=!!s.gradientMap,dt=!!s.alphaMap,pt=s.alphaTest>0,ft=!!s.alphaHash,mt=!!s.extensions,gt=!!y.attributes.uv1,_t=!!y.attributes.uv2,vt=!!y.attributes.uv3;let yt=0;return s.toneMapped&&(null!==k&&!0!==k.isXRRenderTarget||(yt=t.toneMapping)),{isWebGL2:u,shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:C,fragmentShader:T,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:I,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:D,instancingColor:D&&null!==_.instanceColor,supportsVertexTextures:d,outputColorSpace:null===k?t.outputColorSpace:!0===k.isXRRenderTarget?k.texture.colorSpace:it,map:L,matcap:O,envMap:N,envMapMode:N&&x.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:B,bumpMap:U,normalMap:z,displacementMap:d&&V,emissiveMap:H,normalMapObjectSpace:z&&1===s.normalMapType,normalMapTangentSpace:z&&0===s.normalMapType,metalnessMap:G,roughnessMap:$,anisotropy:j,anisotropyMap:K,clearcoat:W,clearcoatMap:Z,clearcoatNormalMap:Q,clearcoatRoughnessMap:J,iridescence:q,iridescenceMap:tt,iridescenceThicknessMap:et,sheen:X,sheenColorMap:nt,sheenRoughnessMap:rt,specularMap:st,specularColorMap:ot,specularIntensityMap:lt,transmission:Y,transmissionMap:ct,thicknessMap:ut,gradientMap:ht,opaque:!1===s.transparent&&1===s.blending,alphaMap:dt,alphaTest:pt,alphaHash:ft,combine:s.combine,mapUv:L&&m(s.map.channel),aoMapUv:F&&m(s.aoMap.channel),lightMapUv:B&&m(s.lightMap.channel),bumpMapUv:U&&m(s.bumpMap.channel),normalMapUv:z&&m(s.normalMap.channel),displacementMapUv:V&&m(s.displacementMap.channel),emissiveMapUv:H&&m(s.emissiveMap.channel),metalnessMapUv:G&&m(s.metalnessMap.channel),roughnessMapUv:$&&m(s.roughnessMap.channel),anisotropyMapUv:K&&m(s.anisotropyMap.channel),clearcoatMapUv:Z&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:Q&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:J&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:tt&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:et&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:nt&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:rt&&m(s.sheenRoughnessMap.channel),specularMapUv:st&&m(s.specularMap.channel),specularColorMapUv:ot&&m(s.specularColorMap.channel),specularIntensityMapUv:lt&&m(s.specularIntensityMap.channel),transmissionMapUv:ct&&m(s.transmissionMap.channel),thicknessMapUv:ut&&m(s.thicknessMap.channel),alphaMapUv:dt&&m(s.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(z||j),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUv1s:gt,vertexUv2s:_t,vertexUv3s:vt,pointsUvs:!0===_.isPoints&&!!y.attributes.uv&&(L||dt),fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:M,morphTextureStride:R,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:yt,useLegacyLights:t._useLegacyLights,decodeVideoTexture:L&&!0===s.map.isVideoTexture&&Xt.getTransfer(s.map.colorSpace)===at,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:mt&&!0===s.extensions.derivatives,extensionFragDepth:mt&&!0===s.extensions.fragDepth,extensionDrawBuffers:mt&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:mt&&!0===s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0),e.supportsVertexTextures&&a.enable(1),e.instancing&&a.enable(2),e.instancingColor&&a.enable(3),e.matcap&&a.enable(4),e.envMap&&a.enable(5),e.normalMapObjectSpace&&a.enable(6),e.normalMapTangentSpace&&a.enable(7),e.clearcoat&&a.enable(8),e.iridescence&&a.enable(9),e.alphaTest&&a.enable(10),e.vertexColors&&a.enable(11),e.vertexAlphas&&a.enable(12),e.vertexUv1s&&a.enable(13),e.vertexUv2s&&a.enable(14),e.vertexUv3s&&a.enable(15),e.vertexTangents&&a.enable(16),e.anisotropy&&a.enable(17),e.alphaHash&&a.enable(18),t.push(a.mask),a.disableAll(),e.fog&&a.enable(0),e.useFog&&a.enable(1),e.flatShading&&a.enable(2),e.logarithmicDepthBuffer&&a.enable(3),e.skinning&&a.enable(4),e.morphTargets&&a.enable(5),e.morphNormals&&a.enable(6),e.morphColors&&a.enable(7),e.premultipliedAlpha&&a.enable(8),e.shadowMapEnabled&&a.enable(9),e.useLegacyLights&&a.enable(10),e.doubleSided&&a.enable(11),e.flipSided&&a.enable(12),e.useDepthPacking&&a.enable(13),e.dithering&&a.enable(14),e.transmission&&a.enable(15),e.sheen&&a.enable(16),e.opaque&&a.enable(17),e.pointsUvs&&a.enable(18),e.decodeVideoTexture&&a.enable(19),t.push(a.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=Fi[e];n=_i.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new Os(t,n,e,s),c.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function zs(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function Vs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Hs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Gs(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,o,a){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,o,a,l,c){const u=s(t,e,o,a,l,c);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(t,e,o,a,l,c){const u=s(t,e,o,a,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Vs),i.length>1&&i.sort(e||Hs),r.length>1&&r.sort(e||Hs)}}}function $s(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new Gs,t.set(e,[r])):n>=i.length?(r=new Gs,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function js(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new ue,color:new Pn};break;case"SpotLight":n={position:new ue,direction:new ue,color:new Pn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ue,color:new Pn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ue,skyColor:new Pn,groundColor:new Pn};break;case"RectAreaLight":n={color:new Pn,position:new ue,halfWidth:new ue,halfHeight:new ue}}return t[e.id]=n,n}}}let Ws=0;function qs(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Xs(t,e){const n=new js,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)r.probe.push(new ue);const s=new ue,o=new ze,a=new ze;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0,v=0,y=0,b=0;s.sort(qs);const x=!0===o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,w=e.intensity,S=e.distance,A=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*w*x,l+=o.g*w*x,c+=o.b*w*x;else if(e.isLightProbe){for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],w);b++}else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=A,r.directionalShadowMatrix[u]=e.shadow.matrix,m++}r.directional[u]=t,u++}else if(e.isSpotLight){const t=n.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(w*x),t.distance=S,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,r.spot[d]=t;const s=e.shadow;if(e.map&&(r.spotLightMap[v]=e.map,v++,s.updateMatrices(e),e.castShadow&&y++),r.spotLightMatrix[d]=s.matrix,e.castShadow){const t=i.get(e);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,r.spotShadow[d]=t,r.spotShadowMap[d]=A,_++}d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(o).multiplyScalar(w),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=A,r.pointShadowMatrix[h]=e.shadow.matrix,g++}r.point[h]=t,h++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(w*x),t.groundColor.copy(e.groundColor).multiplyScalar(w*x),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Ni.LTC_FLOAT_1,r.rectAreaLTC2=Ni.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Ni.LTC_HALF_1,r.rectAreaLTC2=Ni.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const w=r.hash;w.directionalLength===u&&w.pointLength===h&&w.spotLength===d&&w.rectAreaLength===p&&w.hemiLength===f&&w.numDirectionalShadows===m&&w.numPointShadows===g&&w.numSpotShadows===_&&w.numSpotMaps===v&&w.numLightProbes===b||(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=_+v-y,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=y,r.numLightProbes=b,w.directionalLength=u,w.pointLength=h,w.spotLength=d,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=_,w.numSpotMaps=v,w.numLightProbes=b,r.version=Ws++)},setupView:function(t,e){let n=0,i=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),n++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),a.identity(),o.copy(d.matrixWorld),o.premultiply(h),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),i++}else if(d.isHemisphereLight){const t=r.hemi[u];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),u++}}},state:r}}function Ys(t,e){const n=new Xs(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function Ks(t,e){let n=new WeakMap;return{get:function(i,r=0){const s=n.get(i);let o;return void 0===s?(o=new Ys(t,e),n.set(i,[o])):r>=s.length?(o=new Ys(t,e),s.push(o)):o=s[r],o},dispose:function(){n=new WeakMap}}}class Zs extends kn{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Qs extends kn{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Js(t,e,n){let i=new Ri;const a=new Nt,l=new Nt,c=new re,u=new Zs({depthPacking:3201}),h=new Qs,d={},p=n.maxTextureSize,f={[r]:1,[s]:0,[o]:2},m=new vi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Nt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),g=m.clone();g.defines.HORIZONTAL_PASS=1;const _=new qn;_.setAttribute("position",new Nn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new hi(_,m),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let b=this.type;function x(n,i){const r=e.update(v);m.defines.VSM_SAMPLES!==n.blurSamples&&(m.defines.VSM_SAMPLES=n.blurSamples,g.defines.VSM_SAMPLES=n.blurSamples,m.needsUpdate=!0,g.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new oe(a.x,a.y)),m.uniforms.shadow_pass.value=n.map.texture,m.uniforms.resolution.value=n.mapSize,m.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,m,v,null),g.uniforms.shadow_pass.value=n.mapPass.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,g,v,null)}function w(e,n,i,r){let s=null;const o=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===i.isPointLight?h:u,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=s.uuid,e=n.uuid;let i=d[t];void 0===i&&(i={},d[t]=i);let r=i[e];void 0===r&&(r=s.clone(),i[e]=r),s=r}return s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:f[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial&&(t.properties.get(s).light=i),s}function S(n,r,s,o,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=r[c.materialIndex];if(u&&u.visible){const e=w(n,u,o,a);t.renderBufferDirect(s,null,i,e,n,c)}}}else if(r.visible){const e=w(n,r,o,a);t.renderBufferDirect(s,null,i,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)S(l[t],r,s,o,a)}this.render=function(e,n,r){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===e.length)return;const s=t.getRenderTarget(),o=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),h=t.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const d=3!==b&&3===this.type,f=3===b&&3!==this.type;for(let s=0,o=e.length;s<o;s++){const o=e[s],u=o.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",o,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;a.copy(u.mapSize);const m=u.getFrameExtents();if(a.multiply(m),l.copy(u.mapSize),(a.x>p||a.y>p)&&(a.x>p&&(l.x=Math.floor(p/m.x),a.x=l.x*m.x,u.mapSize.x=l.x),a.y>p&&(l.y=Math.floor(p/m.y),a.y=l.y*m.y,u.mapSize.y=l.y)),null===u.map||!0===d||!0===f){const t=3!==this.type?{minFilter:R,magFilter:R}:{};null!==u.map&&u.map.dispose(),u.map=new oe(a.x,a.y,t),u.map.texture.name=o.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const g=u.getViewportCount();for(let t=0;t<g;t++){const e=u.getViewport(t);c.set(l.x*e.x,l.y*e.y,l.x*e.z,l.y*e.w),h.viewport(c),u.updateMatrices(o,t),i=u.getFrustum(),S(n,r,u.camera,o,this.type)}!0!==u.isPointLightShadow&&3===this.type&&x(u,r),u.needsUpdate=!1}b=this.type,y.needsUpdate=!1,t.setRenderTarget(s,o,u)}}function to(t,e,n){const i=n.isWebGL2,r=new function(){let e=!1;const n=new re;let i=null;const r=new re(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,o,a){!0===a&&(e*=o,i*=o,s*=o),n.set(e,i,s,o),!1===r.equals(n)&&(t.clearColor(e,i,s,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(e){e?ot(t.DEPTH_TEST):at(t.DEPTH_TEST)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},o=new function(){let e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(n){e||(n?ot(t.STENCIL_TEST):at(t.STENCIL_TEST))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&s===o||(t.stencilFunc(e,n,o),i=e,r=n,s=o)},setOp:function(e,n,i){o===e&&a===n&&l===i||(t.stencilOp(e,n,i),o=e,a=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null}}},M=new WeakMap,C=new WeakMap;let E={},T={},P=new WeakMap,I=[],R=null,k=!1,D=null,L=null,O=null,N=null,F=null,B=null,U=null,z=new Pn(0,0,0),V=0,H=!1,G=null,$=null,j=null,W=null,q=null;const X=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Y=!1,K=0;const Z=t.getParameter(t.VERSION);-1!==Z.indexOf("WebGL")?(K=parseFloat(/^WebGL (\d)/.exec(Z)[1]),Y=K>=1):-1!==Z.indexOf("OpenGL ES")&&(K=parseFloat(/^OpenGL ES (\d)/.exec(Z)[1]),Y=K>=2);let Q=null,J={};const tt=t.getParameter(t.SCISSOR_BOX),et=t.getParameter(t.VIEWPORT),nt=(new re).fromArray(tt),it=(new re).fromArray(et);function rt(e,n,r,s){const o=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let a=0;a<r;a++)!i||e!==t.TEXTURE_3D&&e!==t.TEXTURE_2D_ARRAY?t.texImage2D(n+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,o):t.texImage3D(n,0,t.RGBA,1,1,s,0,t.RGBA,t.UNSIGNED_BYTE,o);return a}const st={};function ot(e){!0!==E[e]&&(t.enable(e),E[e]=!0)}function at(e){!1!==E[e]&&(t.disable(e),E[e]=!1)}st[t.TEXTURE_2D]=rt(t.TEXTURE_2D,t.TEXTURE_2D,1),st[t.TEXTURE_CUBE_MAP]=rt(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(st[t.TEXTURE_2D_ARRAY]=rt(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),st[t.TEXTURE_3D]=rt(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),ot(t.DEPTH_TEST),s.setFunc(3),ht(!1),dt(1),ot(t.CULL_FACE),ut(0);const lt={[a]:t.FUNC_ADD,[l]:t.FUNC_SUBTRACT,[c]:t.FUNC_REVERSE_SUBTRACT};if(i)lt[103]=t.MIN,lt[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(lt[103]=t.MIN_EXT,lt[104]=t.MAX_EXT)}const ct={[u]:t.ZERO,[h]:t.ONE,[d]:t.SRC_COLOR,[f]:t.SRC_ALPHA,[b]:t.SRC_ALPHA_SATURATE,[v]:t.DST_COLOR,[g]:t.DST_ALPHA,[p]:t.ONE_MINUS_SRC_COLOR,[m]:t.ONE_MINUS_SRC_ALPHA,[y]:t.ONE_MINUS_DST_COLOR,[_]:t.ONE_MINUS_DST_ALPHA,[x]:t.CONSTANT_COLOR,[w]:t.ONE_MINUS_CONSTANT_COLOR,[S]:t.CONSTANT_ALPHA,[A]:t.ONE_MINUS_CONSTANT_ALPHA};function ut(e,n,i,r,s,o,l,c,u,h){if(0!==e){if(!1===k&&(ot(t.BLEND),k=!0),5===e)s=s||n,o=o||i,l=l||r,n===L&&s===F||(t.blendEquationSeparate(lt[n],lt[s]),L=n,F=s),i===O&&r===N&&o===B&&l===U||(t.blendFuncSeparate(ct[i],ct[r],ct[o],ct[l]),O=i,N=r,B=o,U=l),!1!==c.equals(z)&&u===V||(t.blendColor(c.r,c.g,c.b,u),z.copy(c),V=u),D=e,H=!1;else if(e!==D||h!==H){if(L===a&&F===a||(t.blendEquation(t.FUNC_ADD),L=a,F=a),h)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}O=null,N=null,B=null,U=null,z.set(0,0,0),V=0,D=e,H=h}}else!0===k&&(at(t.BLEND),k=!1)}function ht(e){G!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),G=e)}function dt(e){0!==e?(ot(t.CULL_FACE),e!==$&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):at(t.CULL_FACE),$=e}function pt(e,n,i){e?(ot(t.POLYGON_OFFSET_FILL),W===n&&q===i||(t.polygonOffset(n,i),W=n,q=i)):at(t.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:s,stencil:o},enable:ot,disable:at,bindFramebuffer:function(e,n){return T[e]!==n&&(t.bindFramebuffer(e,n),T[e]=n,i&&(e===t.DRAW_FRAMEBUFFER&&(T[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(T[t.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let s=I,o=!1;if(i)if(s=P.get(r),void 0===s&&(s=[],P.set(r,s)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(s.length!==e.length||s[0]!==t.COLOR_ATTACHMENT0){for(let n=0,i=e.length;n<i;n++)s[n]=t.COLOR_ATTACHMENT0+n;s.length=e.length,o=!0}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,o=!0);else s[0]!==t.BACK&&(s[0]=t.BACK,o=!0);o&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return R!==e&&(t.useProgram(e),R=e,!0)},setBlending:ut,setMaterial:function(e,n){2===e.side?at(t.CULL_FACE):ot(t.CULL_FACE);let i=1===e.side;n&&(i=!i),ht(i),1===e.blending&&!1===e.transparent?ut(0):ut(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const a=e.stencilWrite;o.setTest(a),a&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),pt(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ot(t.SAMPLE_ALPHA_TO_COVERAGE):at(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:ht,setCullFace:dt,setLineWidth:function(e){e!==j&&(Y&&t.lineWidth(e),j=e)},setPolygonOffset:pt,setScissorTest:function(e){e?ot(t.SCISSOR_TEST):at(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+X-1),Q!==e&&(t.activeTexture(e),Q=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===Q?t.TEXTURE0+X-1:Q);let r=J[i];void 0===r&&(r={type:void 0,texture:void 0},J[i]=r),r.type===e&&r.texture===n||(Q!==i&&(t.activeTexture(i),Q=i),t.bindTexture(e,n||st[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=J[Q];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,n){let i=C.get(n);void 0===i&&(i=new WeakMap,C.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=C.get(n).get(e);M.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),M.set(n,i))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===nt.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),nt.copy(e))},viewport:function(e){!1===it.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),it.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===i&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),E={},Q=null,J={},T={},P=new WeakMap,I=[],R=null,k=!1,D=null,L=null,O=null,N=null,F=null,B=null,U=null,z=new Pn(0,0,0),V=0,H=!1,G=null,$=null,j=null,W=null,q=null,nt.set(0,0,t.canvas.width,t.canvas.height),it.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),o.reset()}}}function eo(t,e,n,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function v(t,e){return _?new OffscreenCanvas(t,e):zt("canvas")}function y(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?Dt:Math.floor,s=i(r*t.width),o=i(r*t.height);void 0===m&&(m=v(s,o));const a=n?v(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function b(t){return kt(t.width)&&kt(t.height)}function x(t,e){return t.generateMipmaps&&e&&t.minFilter!==R&&t.minFilter!==L}function w(e){t.generateMipmap(e)}function S(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;if(i===t.RED&&(r===t.FLOAT&&(l=t.R32F),r===t.HALF_FLOAT&&(l=t.R16F),r===t.UNSIGNED_BYTE&&(l=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(l=t.R8UI),r===t.UNSIGNED_SHORT&&(l=t.R16UI),r===t.UNSIGNED_INT&&(l=t.R32UI),r===t.BYTE&&(l=t.R8I),r===t.SHORT&&(l=t.R16I),r===t.INT&&(l=t.R32I)),i===t.RG&&(r===t.FLOAT&&(l=t.RG32F),r===t.HALF_FLOAT&&(l=t.RG16F),r===t.UNSIGNED_BYTE&&(l=t.RG8)),i===t.RGBA){const e=o?ot:Xt.getTransfer(s);r===t.FLOAT&&(l=t.RGBA32F),r===t.HALF_FLOAT&&(l=t.RGBA16F),r===t.UNSIGNED_BYTE&&(l=e===at?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)}return l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function A(t,e,n){return!0===x(t,n)||t.isFramebufferTexture&&t.minFilter!==R&&t.minFilter!==L?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function M(e){return e===R||1004===e||e===D?t.NEAREST:t.LINEAR}function C(t){const e=t.target;e.removeEventListener("dispose",C),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=g.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&W(t),0===Object.keys(r).length&&g.delete(n)}i.remove(t)}(e),e.isVideoTexture&&f.delete(e)}function E(e){const n=e.target;n.removeEventListener("dispose",E),function(e){const n=e.texture,r=i.get(e),s=i.get(n);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(r.__webglFramebuffer[e]))for(let n=0;n<r.__webglFramebuffer[e].length;n++)t.deleteFramebuffer(r.__webglFramebuffer[e][n]);else t.deleteFramebuffer(r.__webglFramebuffer[e]);r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e])}else{if(Array.isArray(r.__webglFramebuffer))for(let e=0;e<r.__webglFramebuffer.length;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let e=0;e<r.__webglColorRenderbuffer.length;e++)r.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[e]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),i.remove(n[e])}i.remove(n),i.remove(e)}(n)}function W(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete g.get(r)[n.__cacheKey],o.memory.textures--}let q=0;function X(e,r){const s=i.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void tt(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+r)}const Y={[T]:t.REPEAT,[P]:t.CLAMP_TO_EDGE,[I]:t.MIRRORED_REPEAT},K={[R]:t.NEAREST,[k]:t.NEAREST_MIPMAP_NEAREST,[D]:t.NEAREST_MIPMAP_LINEAR,[L]:t.LINEAR,[O]:t.LINEAR_MIPMAP_NEAREST,[N]:t.LINEAR_MIPMAP_LINEAR},Z={[ht]:t.NEVER,[vt]:t.ALWAYS,[dt]:t.LESS,[ft]:t.LEQUAL,[pt]:t.EQUAL,[_t]:t.GEQUAL,[mt]:t.GREATER,[gt]:t.NOTEQUAL};function Q(n,s,o){if(o?(t.texParameteri(n,t.TEXTURE_WRAP_S,Y[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,Y[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,Y[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,K[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,K[s.minFilter])):(t.texParameteri(n,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(n,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS===P&&s.wrapT===P||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,t.TEXTURE_MAG_FILTER,M(s.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,M(s.minFilter)),s.minFilter!==R&&s.minFilter!==L&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,Z[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.magFilter===R)return;if(s.minFilter!==D&&s.minFilter!==N)return;if(s.type===z&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===V&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function J(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",C));const r=n.source;let s=g.get(r);void 0===s&&(s={},g.set(r,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&W(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return i}function tt(e,r,o){let l=t.TEXTURE_2D;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),r.isData3DTexture&&(l=t.TEXTURE_3D);const c=J(e,r),h=r.source;n.bindTexture(l,e.__webglTexture,t.TEXTURE0+o);const d=i.get(h);if(h.version!==d.__version||!0===c){n.activeTexture(t.TEXTURE0+o);const e=Xt.getPrimaries(Xt.workingColorSpace),i=r.colorSpace===et?null:Xt.getPrimaries(r.colorSpace),p=r.colorSpace===et||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const f=function(t){return!a&&(t.wrapS!==P||t.wrapT!==P||t.minFilter!==R&&t.minFilter!==L)}(r)&&!1===b(r.image);let m=y(r.image,f,!1,u);m=ut(r,m);const g=b(m)||a,_=s.convert(r.format,r.colorSpace);let v,M=s.convert(r.type),C=S(r.internalFormat,_,M,r.colorSpace,r.isVideoTexture);Q(l,r,g);const E=r.mipmaps,T=a&&!0!==r.isVideoTexture,I=void 0===d.__version||!0===c,k=A(r,m,g);if(r.isDepthTexture)C=t.DEPTH_COMPONENT,a?C=r.type===z?t.DEPTH_COMPONENT32F:r.type===U?t.DEPTH_COMPONENT24:r.type===H?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:r.type===z&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===$&&C===t.DEPTH_COMPONENT&&r.type!==B&&r.type!==U&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=U,M=s.convert(r.type)),r.format===j&&C===t.DEPTH_COMPONENT&&(C=t.DEPTH_STENCIL,r.type!==H&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=H,M=s.convert(r.type))),I&&(T?n.texStorage2D(t.TEXTURE_2D,1,C,m.width,m.height):n.texImage2D(t.TEXTURE_2D,0,C,m.width,m.height,0,_,M,null));else if(r.isDataTexture)if(E.length>0&&g){T&&I&&n.texStorage2D(t.TEXTURE_2D,k,C,E[0].width,E[0].height);for(let e=0,i=E.length;e<i;e++)v=E[e],T?n.texSubImage2D(t.TEXTURE_2D,e,0,0,v.width,v.height,_,M,v.data):n.texImage2D(t.TEXTURE_2D,e,C,v.width,v.height,0,_,M,v.data);r.generateMipmaps=!1}else T?(I&&n.texStorage2D(t.TEXTURE_2D,k,C,m.width,m.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,m.width,m.height,_,M,m.data)):n.texImage2D(t.TEXTURE_2D,0,C,m.width,m.height,0,_,M,m.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){T&&I&&n.texStorage3D(t.TEXTURE_2D_ARRAY,k,C,E[0].width,E[0].height,m.depth);for(let e=0,i=E.length;e<i;e++)v=E[e],r.format!==G?null!==_?T?n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,v.width,v.height,m.depth,_,v.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,C,v.width,v.height,m.depth,0,v.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,v.width,v.height,m.depth,_,M,v.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,C,v.width,v.height,m.depth,0,_,M,v.data)}else{T&&I&&n.texStorage2D(t.TEXTURE_2D,k,C,E[0].width,E[0].height);for(let e=0,i=E.length;e<i;e++)v=E[e],r.format!==G?null!==_?T?n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,v.width,v.height,_,v.data):n.compressedTexImage2D(t.TEXTURE_2D,e,C,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?n.texSubImage2D(t.TEXTURE_2D,e,0,0,v.width,v.height,_,M,v.data):n.texImage2D(t.TEXTURE_2D,e,C,v.width,v.height,0,_,M,v.data)}else if(r.isDataArrayTexture)T?(I&&n.texStorage3D(t.TEXTURE_2D_ARRAY,k,C,m.width,m.height,m.depth),n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,_,M,m.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,C,m.width,m.height,m.depth,0,_,M,m.data);else if(r.isData3DTexture)T?(I&&n.texStorage3D(t.TEXTURE_3D,k,C,m.width,m.height,m.depth),n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,_,M,m.data)):n.texImage3D(t.TEXTURE_3D,0,C,m.width,m.height,m.depth,0,_,M,m.data);else if(r.isFramebufferTexture){if(I)if(T)n.texStorage2D(t.TEXTURE_2D,k,C,m.width,m.height);else{let e=m.width,i=m.height;for(let r=0;r<k;r++)n.texImage2D(t.TEXTURE_2D,r,C,e,i,0,_,M,null),e>>=1,i>>=1}}else if(E.length>0&&g){T&&I&&n.texStorage2D(t.TEXTURE_2D,k,C,E[0].width,E[0].height);for(let e=0,i=E.length;e<i;e++)v=E[e],T?n.texSubImage2D(t.TEXTURE_2D,e,0,0,_,M,v):n.texImage2D(t.TEXTURE_2D,e,C,_,M,v);r.generateMipmaps=!1}else T?(I&&n.texStorage2D(t.TEXTURE_2D,k,C,m.width,m.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,_,M,m)):n.texImage2D(t.TEXTURE_2D,0,C,_,M,m);x(r,g)&&w(l),d.__version=h.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}function nt(e,r,o,a,l,c){const u=s.convert(o.format,o.colorSpace),h=s.convert(o.type),p=S(o.internalFormat,u,h,o.colorSpace);if(!i.get(r).__hasExternalTextures){const e=Math.max(1,r.width>>c),i=Math.max(1,r.height>>c);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?n.texImage3D(l,c,p,e,i,r.depth,0,u,h,null):n.texImage2D(l,c,p,e,i,0,u,h,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),ct(r)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,l,i.get(o).__webglTexture,0,lt(r)):(l===t.TEXTURE_2D||l>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,a,l,i.get(o).__webglTexture,c),n.bindFramebuffer(t.FRAMEBUFFER,null)}function rt(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer){let r=!0===a?t.DEPTH_COMPONENT24:t.DEPTH_COMPONENT16;if(i||ct(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===z?r=t.DEPTH_COMPONENT32F:e.type===U&&(r=t.DEPTH_COMPONENT24));const i=lt(n);ct(n)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,i,r,n.width,n.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,i,r,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,r,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=lt(n);i&&!1===ct(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,n.width,n.height):ct(n)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<e.length;r++){const o=e[r],a=s.convert(o.format,o.colorSpace),l=s.convert(o.type),c=S(o.internalFormat,a,l,o.colorSpace),u=lt(n);i&&!1===ct(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,c,n.width,n.height):ct(n)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,c,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,c,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function st(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),X(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=lt(r);if(r.depthTexture.format===$)ct(r)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==j)throw new Error("Unknown depthTexture format");ct(r)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),rt(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),rt(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function lt(t){return Math.min(h,t.samples)}function ct(t){const n=i.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function ut(t,n){const i=t.colorSpace,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===wt||i!==it&&i!==et&&(Xt.getTransfer(i)===at?!1===a?!0===e.has("EXT_sRGB")&&r===G?(t.format=wt,t.minFilter=L,t.generateMipmaps=!1):n=Qt.sRGBToLinear(n):r===G&&s===F||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const t=q;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),q+=1,t},this.resetTextureUnits=function(){q=0},this.setTexture2D=X,this.setTexture2DArray=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?tt(s,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?tt(s,e,r):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,r){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,r,o){if(6!==r.image.length)return;const l=J(e,r),u=r.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+o);const h=i.get(u);if(u.version!==h.__version||!0===l){n.activeTexture(t.TEXTURE0+o);const e=Xt.getPrimaries(Xt.workingColorSpace),i=r.colorSpace===et?null:Xt.getPrimaries(r.colorSpace),d=r.colorSpace===et||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const p=r.isCompressedTexture||r.image[0].isCompressedTexture,f=r.image[0]&&r.image[0].isDataTexture,m=[];for(let t=0;t<6;t++)m[t]=p||f?f?r.image[t].image:r.image[t]:y(r.image[t],!1,!0,c),m[t]=ut(r,m[t]);const g=m[0],_=b(g)||a,v=s.convert(r.format,r.colorSpace),M=s.convert(r.type),C=S(r.internalFormat,v,M,r.colorSpace),E=a&&!0!==r.isVideoTexture,T=void 0===h.__version||!0===l;let P,I=A(r,g,_);if(Q(t.TEXTURE_CUBE_MAP,r,_),p){E&&T&&n.texStorage2D(t.TEXTURE_CUBE_MAP,I,C,g.width,g.height);for(let e=0;e<6;e++){P=m[e].mipmaps;for(let i=0;i<P.length;i++){const s=P[i];r.format!==G?null!==v?E?n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,s.width,s.height,v,s.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,C,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):E?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,s.width,s.height,v,M,s.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,C,s.width,s.height,0,v,M,s.data)}}}else{P=r.mipmaps,E&&T&&(P.length>0&&I++,n.texStorage2D(t.TEXTURE_CUBE_MAP,I,C,m[0].width,m[0].height));for(let e=0;e<6;e++)if(f){E?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,m[e].width,m[e].height,v,M,m[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,C,m[e].width,m[e].height,0,v,M,m[e].data);for(let i=0;i<P.length;i++){const r=P[i].image[e].image;E?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,r.width,r.height,v,M,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,C,r.width,r.height,0,v,M,r.data)}}else{E?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,v,M,m[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,C,v,M,m[e]);for(let i=0;i<P.length;i++){const r=P[i];E?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,v,M,r.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,C,v,M,r.image[e])}}}x(r,_)&&w(t.TEXTURE_CUBE_MAP),h.__version=u.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}(o,e,r):n.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture,t.TEXTURE0+r)},this.rebindTextures=function(e,n,r){const s=i.get(e);void 0!==n&&nt(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&st(e)},this.setupRenderTarget=function(e){const l=e.texture,c=i.get(e),u=i.get(l);e.addEventListener("dispose",E),!0!==e.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=t.createTexture()),u.__version=l.version,o.memory.textures++);const h=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=b(e)||a;if(h){c.__webglFramebuffer=[];for(let e=0;e<6;e++)if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[e]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[e][n]=t.createFramebuffer()}else c.__webglFramebuffer[e]=t.createFramebuffer()}else{if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let e=0;e<l.mipmaps.length;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else c.__webglFramebuffer=t.createFramebuffer();if(d)if(r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&e.samples>0&&!1===ct(e)){const i=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const o=s.convert(r.format,r.colorSpace),a=s.convert(r.type),l=S(r.internalFormat,o,a,r.colorSpace,!0===e.isXRRenderTarget),u=lt(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,u,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,c.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),rt(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(h){n.bindTexture(t.TEXTURE_CUBE_MAP,u.__webglTexture),Q(t.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(a&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)nt(c.__webglFramebuffer[n][i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else nt(c.__webglFramebuffer[n],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);x(l,p)&&w(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){const r=e.texture;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i.get(o);n.bindTexture(t.TEXTURE_2D,a.__webglTexture),Q(t.TEXTURE_2D,o,p),nt(c.__webglFramebuffer,e,o,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D,0),x(o,p)&&w(t.TEXTURE_2D)}n.unbindTexture()}else{let i=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?i=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,u.__webglTexture),Q(i,l,p),a&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)nt(c.__webglFramebuffer[n],e,l,t.COLOR_ATTACHMENT0,i,n);else nt(c.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,i,0);x(l,p)&&w(i),n.unbindTexture()}e.depthBuffer&&st(e)},this.updateRenderTargetMipmap=function(e){const r=b(e)||a,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=s.length;o<a;o++){const a=s[o];if(x(a,r)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=i.get(a).__webglTexture;n.bindTexture(r,s),w(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===ct(e)){const r=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const l=[],c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=i.get(e),h=!0===e.isWebGLMultipleRenderTargets;if(h)for(let e=0;e<r.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&l.push(c);const d=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===d&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),h&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===d&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[c]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[c])),h){const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,t.NEAREST),p&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),h)for(let e=0;e<r.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,u.__webglColorRenderbuffer[e]);const s=i.get(r[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=st,this.setupFrameBufferTexture=nt,this.useMultisampledRTT=ct}function no(t,e,n){const i=n.isWebGL2;return{convert:function(n,r=""){let s;const o=Xt.getTransfer(r);if(n===F)return t.UNSIGNED_BYTE;if(1017===n)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return t.BYTE;if(1011===n)return t.SHORT;if(n===B)return t.UNSIGNED_SHORT;if(1013===n)return t.INT;if(n===U)return t.UNSIGNED_INT;if(n===z)return t.FLOAT;if(n===V)return i?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return t.ALPHA;if(n===G)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(n===$)return t.DEPTH_COMPONENT;if(n===j)return t.DEPTH_STENCIL;if(n===wt)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1028===n)return t.RED;if(1029===n)return t.RED_INTEGER;if(1030===n)return t.RG;if(1031===n)return t.RG_INTEGER;if(1033===n)return t.RGBA_INTEGER;if(n===W||n===q||n===X||n===Y)if(o===at){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===W)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===q)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===X)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Y)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===W)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===q)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===X)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Y)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===n)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===n)return o===at?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return o===at?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===K||36494===n||36495===n){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(n===K)return o===at?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(s=e.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===K)return s.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===H?i?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[n]?t[n]:null}}}class io extends bi{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class ro extends dn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const so={type:"move"};class oo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ro,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ro,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ue,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ue),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ro,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ue,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ue),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n),r=this._getHandJoint(l,i);null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=t.radius),r.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(so)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new ro;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class ao extends ie{constructor(t,e,n,i,r,s,o,a,l,c){if((c=void 0!==c?c:$)!==$&&c!==j)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===$&&(n=U),void 0===n&&c===j&&(n=H),super(null,i,r,s,o,a,c,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:R,this.minFilter=void 0!==a?a:R,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class lo extends Mt{constructor(t,e){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=1,l=null,c=null,u=null,h=null,d=null,p=null;const f=e.getContextAttributes();let m=null,g=null;const _=[],v=[],y=new bi;y.layers.enable(1),y.viewport=new re;const b=new bi;b.layers.enable(2),b.viewport=new re;const x=[y,b],w=new io;w.layers.enable(1),w.layers.enable(2);let S=null,A=null;function M(t){const e=v.indexOf(t.inputSource);if(-1===e)return;const n=_[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||s),n.dispatchEvent({type:t.type,data:t.inputSource}))}function C(){i.removeEventListener("select",M),i.removeEventListener("selectstart",M),i.removeEventListener("selectend",M),i.removeEventListener("squeeze",M),i.removeEventListener("squeezestart",M),i.removeEventListener("squeezeend",M),i.removeEventListener("end",C),i.removeEventListener("inputsourceschange",E);for(let t=0;t<_.length;t++){const e=v[t];null!==e&&(v[t]=null,_[t].disconnect(e))}S=null,A=null,t.setRenderTarget(m),d=null,h=null,u=null,i=null,g=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function E(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=v.indexOf(n);i>=0&&(v[i]=null,_[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=v.indexOf(n);if(-1===i){for(let t=0;t<_.length;t++){if(t>=v.length){v.push(n),i=t;break}if(null===v[t]){v[t]=n,i=t;break}}if(-1===i)break}const r=_[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=_[t];return void 0===e&&(e=new oo,_[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=_[t];return void 0===e&&(e=new oo,_[t]=e),e.getGripSpace()},this.getHand=function(t){let e=_[t];return void 0===e&&(e=new oo,_[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(m=t.getRenderTarget(),i.addEventListener("select",M),i.addEventListener("selectstart",M),i.addEventListener("selectend",M),i.addEventListener("squeeze",M),i.addEventListener("squeezestart",M),i.addEventListener("squeezeend",M),i.addEventListener("end",C),i.addEventListener("inputsourceschange",E),!0!==f.xrCompatible&&await e.makeXRCompatible(),void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:d}),g=new oe(d.framebufferWidth,d.framebufferHeight,{format:G,type:F,colorSpace:t.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,s=null,o=null;f.depth&&(o=f.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=f.stencil?j:$,s=f.stencil?H:U);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:r};u=new XRWebGLBinding(i,e),h=u.createProjectionLayer(a),i.updateRenderState({layers:[h]}),g=new oe(h.textureWidth,h.textureHeight,{format:G,type:F,depthTexture:new ao(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:t.outputColorSpace,samples:f.antialias?4:0}),t.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await i.requestReferenceSpace(o),k.setContext(i),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const T=new ue,P=new ue;function I(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;w.near=b.near=y.near=t.near,w.far=b.far=y.far=t.far,S===w.near&&A===w.far||(i.updateRenderState({depthNear:w.near,depthFar:w.far}),S=w.near,A=w.far);const e=t.parent,n=w.cameras;I(w,e);for(let t=0;t<n.length;t++)I(n[t],e);2===n.length?function(t,e,n){T.setFromMatrixPosition(e.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const i=T.distanceTo(P),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=i/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,_=a+f,v=d-m,y=p+(i-m),b=l*a/_*g,x=c*a/_*g;t.projectionMatrix.makePerspective(v,y,b,x,g,_),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(w,y,b):w.projectionMatrix.copy(y.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Tt*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,w,e)},this.getCamera=function(){return w},this.getFoveation=function(){if(null!==h||null!==d)return a},this.setFoveation=function(t){a=t,null!==h&&(h.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)};let R=null;const k=new ki;k.setAnimationLoop((function(e,i){if(c=i.getViewerPose(l||s),p=i,null!==c){const e=c.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let n=!1;e.length!==w.cameras.length&&(w.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==d)s=d.getViewport(r);else{const e=u.getViewSubImage(h,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(g,e.colorTexture,h.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}let o=x[i];void 0===o&&(o=new bi,o.layers.enable(i),o.viewport=new re,x[i]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&(w.matrix.copy(o.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),!0===n&&w.cameras.push(o)}}for(let t=0;t<_.length;t++){const e=v[t],n=_[t];null!==e&&void 0!==n&&n.update(e,i,l||s)}R&&R(e,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(t){R=t},this.dispose=function(){}}}function co(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,1===r.side&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),1===r.side&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const s=e.get(r).envMap;if(s&&(i.envMap.value=s,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*e,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,gi(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,r,s,o,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,i){t.metalness.value=i.metalness,i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,t.metalnessMapTransform)),t.roughness.value=i.roughness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,t.roughnessMapTransform));e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform))),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),1===e.side&&t.clearcoatNormalScale.value.negate())),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform))),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform))),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform)),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,a)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){const i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,s,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function uo(t,e,n,i){let r={},s={},o=[];const a=n.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(t,e,n){const i=t.value;if(void 0===n[e]){if("number"==typeof i)n[e]=i;else{const t=Array.isArray(i)?i:[i],r=[];for(let e=0;e<t.length;e++)r.push(t[e].clone());n[e]=r}return!0}if("number"==typeof i){if(n[e]!==i)return n[e]=i,!0}else{const t=Array.isArray(n[e])?n[e]:[n[e]],r=Array.isArray(i)?i:[i];for(let e=0;e<t.length;e++){const n=t[e];if(!1===n.equals(r[e]))return n.copy(r[e]),!0}}return!1}function c(t){const e={boundary:0,storage:0};return"number"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function u(e){const n=e.target;n.removeEventListener("dispose",u);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,h){let d=r[n.id];void 0===d&&(function(t){const e=t.uniforms;let n=0;let i=0;for(let t=0,r=e.length;t<r;t++){const r=e[t],s={boundary:0,storage:0},o=Array.isArray(r.value)?r.value:[r.value];for(let t=0,e=o.length;t<e;t++){const e=c(o[t]);s.boundary+=e.boundary,s.storage+=e.storage}r.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,t>0&&(i=n%16,0!==i&&16-i-s.boundary<0&&(n+=16-i,r.__offset=n)),n+=s.storage}i=n%16,i>0&&(n+=16-i),t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=e.render.frame;s[n.id]!==f&&(function(e){const n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let e=0,n=i.length;e<n;e++){const n=i[e];if(!0===l(n,e,s)){const e=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let r=0;for(let s=0;s<i.length;s++){const o=i[s],a=c(o);"number"==typeof o?(n.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+r,n.__data)):o.isMatrix3?(n.__data[0]=o.elements[0],n.__data[1]=o.elements[1],n.__data[2]=o.elements[2],n.__data[3]=o.elements[0],n.__data[4]=o.elements[3],n.__data[5]=o.elements[4],n.__data[6]=o.elements[5],n.__data[7]=o.elements[0],n.__data[8]=o.elements[6],n.__data[9]=o.elements[7],n.__data[10]=o.elements[8],n.__data[11]=o.elements[0]):(o.toArray(n.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,n.__data)}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);o=[],r={},s={}}}}class ho{constructor(t={}){const{canvas:e=Vt(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=t;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:o;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const _=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=nt,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let b=!1,x=0,w=0,S=null,A=-1,M=null;const C=new re,E=new re;let T=null;const P=new Pn(0);let I=0,R=e.width,k=e.height,D=1,L=null,O=null;const $=new re(0,0,R,k),j=new re(0,0,R,k);let W=!1;const q=new Ri;let X=!1,Y=!1,K=null;const Z=new ze,Q=new Nt,J=new ue,tt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function et(){return null===S?D:1}let rt,st,ot,at,lt,ct,ut,ht,dt,pt,ft,mt,gt,_t,vt,yt,bt,xt,wt,St,At,Mt,Ct,Et,Tt=n;function Pt(t,n){for(let i=0;i<t.length;i++){const r=t[i],s=e.getContext(r,n);if(null!==s)return s}return null}try{const t={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${i}`),e.addEventListener("webglcontextlost",kt,!1),e.addEventListener("webglcontextrestored",Lt,!1),e.addEventListener("webglcontextcreationerror",Ot,!1),null===Tt){const e=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&e.shift(),Tt=Pt(e,t),null===Tt)throw Pt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&Tt instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Tt.getShaderPrecisionFormat&&(Tt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function It(){rt=new ar(Tt),st=new Hi(Tt,rt,t),rt.init(st),Mt=new no(Tt,rt,st),ot=new to(Tt,rt,st),at=new ur(Tt),lt=new zs,ct=new eo(Tt,rt,ot,lt,st,Mt,at),ut=new $i(y),ht=new or(y),dt=new Di(Tt,st),Ct=new zi(Tt,rt,dt,st),pt=new lr(Tt,dt,at,Ct),ft=new fr(Tt,pt,dt,at),wt=new pr(Tt,st,ct),yt=new Gi(lt),mt=new Us(y,ut,ht,rt,st,Ct,yt),gt=new co(y,lt),_t=new $s,vt=new Ks(rt,st),xt=new Ui(y,ut,ht,ot,ft,d,l),bt=new Js(y,ft,st),Et=new uo(Tt,at,st,ot),St=new Vi(Tt,rt,at,st),At=new cr(Tt,rt,at,st),at.programs=mt.programs,y.capabilities=st,y.extensions=rt,y.properties=lt,y.renderLists=_t,y.shadowMap=bt,y.state=ot,y.info=at}It();const Rt=new lo(y,Tt);function kt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Lt(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const t=at.autoReset,e=bt.enabled,n=bt.autoUpdate,i=bt.needsUpdate,r=bt.type;It(),at.autoReset=t,bt.enabled=e,bt.autoUpdate=n,bt.needsUpdate=i,bt.type=r}function Ot(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Ft(t){const e=t.target;e.removeEventListener("dispose",Ft),function(t){(function(t){const e=lt.get(t).programs;void 0!==e&&(e.forEach((function(t){mt.releaseProgram(t)})),t.isShaderMaterial&&mt.releaseShaderCache(t))})(t),lt.remove(t)}(e)}function Bt(t,e,n){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=1,t.needsUpdate=!0,Xt(t,e,n),t.side=0,t.needsUpdate=!0,Xt(t,e,n),t.side=2):Xt(t,e,n)}this.xr=Rt,this.getContext=function(){return Tt},this.getContextAttributes=function(){return Tt.getContextAttributes()},this.forceContextLoss=function(){const t=rt.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=rt.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(t){void 0!==t&&(D=t,this.setSize(R,k,!1))},this.getSize=function(t){return t.set(R,k)},this.setSize=function(t,n,i=!0){Rt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=t,k=n,e.width=Math.floor(t*D),e.height=Math.floor(n*D),!0===i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(R*D,k*D).floor()},this.setDrawingBufferSize=function(t,n,i){R=t,k=n,D=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(C)},this.getViewport=function(t){return t.copy($)},this.setViewport=function(t,e,n,i){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,e,n,i),ot.viewport(C.copy($).multiplyScalar(D).floor())},this.getScissor=function(t){return t.copy(j)},this.setScissor=function(t,e,n,i){t.isVector4?j.set(t.x,t.y,t.z,t.w):j.set(t,e,n,i),ot.scissor(E.copy(j).multiplyScalar(D).floor())},this.getScissorTest=function(){return W},this.setScissorTest=function(t){ot.setScissorTest(W=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){O=t},this.getClearColor=function(t){return t.copy(xt.getClearColor())},this.setClearColor=function(){xt.setClearColor.apply(xt,arguments)},this.getClearAlpha=function(){return xt.getClearAlpha()},this.setClearAlpha=function(){xt.setClearAlpha.apply(xt,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;if(t){let t=!1;if(null!==S){const e=S.texture.format;t=1033===e||1031===e||1029===e}if(t){const t=S.texture.type,e=t===F||t===U||t===B||t===H||1017===t||1018===t,n=xt.getClearColor(),i=xt.getClearAlpha(),r=n.r,s=n.g,o=n.b;e?(p[0]=r,p[1]=s,p[2]=o,p[3]=i,Tt.clearBufferuiv(Tt.COLOR,0,p)):(f[0]=r,f[1]=s,f[2]=o,f[3]=i,Tt.clearBufferiv(Tt.COLOR,0,f))}else i|=Tt.COLOR_BUFFER_BIT}e&&(i|=Tt.DEPTH_BUFFER_BIT),n&&(i|=Tt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Tt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",kt,!1),e.removeEventListener("webglcontextrestored",Lt,!1),e.removeEventListener("webglcontextcreationerror",Ot,!1),_t.dispose(),vt.dispose(),lt.dispose(),ut.dispose(),ht.dispose(),ft.dispose(),Ct.dispose(),Et.dispose(),mt.dispose(),Rt.dispose(),Rt.removeEventListener("sessionstart",zt),Rt.removeEventListener("sessionend",Ht),K&&(K.dispose(),K=null),Gt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=tt);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,n,i,r){!0!==e.isScene&&(e=tt),ct.resetTextureUnits();const s=e.fog,o=i.isMeshStandardMaterial?e.environment:null,a=null===S?y.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:it,l=(i.isMeshStandardMaterial?ht:ut).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;i.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=y.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,_=void 0!==m?m.length:0,v=lt.get(i),b=g.state.lights;if(!0===X&&(!0===Y||t!==M)){const e=t===M&&i.id===A;yt.setState(i,t,e)}let x=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==b.state.version||v.outputColorSpace!==a||r.isInstancedMesh&&!1===v.instancing?x=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?x=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||v.envMap!==l||!0===i.fog&&v.fog!==s?x=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===yt.numPlanes&&v.numIntersection===yt.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==h||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||!0===st.isWebGL2&&v.morphTargetsCount!==_)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,v.__version=i.version);let w=v.currentProgram;!0===x&&(w=Xt(i,e,r));let C=!1,E=!1,T=!1;const P=w.getUniforms(),I=v.uniforms;if(ot.useProgram(w.program)&&(C=!0,E=!0,T=!0),i.id!==A&&(A=i.id,E=!0),C||M!==t){P.setValue(Tt,"projectionMatrix",t.projectionMatrix),P.setValue(Tt,"viewMatrix",t.matrixWorldInverse);const e=P.map.cameraPosition;void 0!==e&&e.setValue(Tt,J.setFromMatrixPosition(t.matrixWorld)),st.logarithmicDepthBuffer&&P.setValue(Tt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(Tt,"isOrthographic",!0===t.isOrthographicCamera),M!==t&&(M=t,E=!0,T=!0)}if(r.isSkinnedMesh){P.setOptional(Tt,r,"bindMatrix"),P.setOptional(Tt,r,"bindMatrixInverse");const t=r.skeleton;t&&(st.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(Tt,"boneTexture",t.boneTexture,ct),P.setValue(Tt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const R=n.morphAttributes;var L,O;if((void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===st.isWebGL2)&&wt.update(r,n,w),(E||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,P.setValue(Tt,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),E&&(P.setValue(Tt,"toneMappingExposure",y.toneMappingExposure),v.needsLights&&(O=T,(L=I).ambientLightColor.needsUpdate=O,L.lightProbe.needsUpdate=O,L.directionalLights.needsUpdate=O,L.directionalLightShadows.needsUpdate=O,L.pointLights.needsUpdate=O,L.pointLightShadows.needsUpdate=O,L.spotLights.needsUpdate=O,L.spotLightShadows.needsUpdate=O,L.rectAreaLights.needsUpdate=O,L.hemisphereLights.needsUpdate=O),s&&!0===i.fog&&gt.refreshFogUniforms(I,s),gt.refreshMaterialUniforms(I,i,D,k,K),vs.upload(Tt,Yt(v),I,ct)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(vs.upload(Tt,Yt(v),I,ct),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&P.setValue(Tt,"center",r.center),P.setValue(Tt,"modelViewMatrix",r.modelViewMatrix),P.setValue(Tt,"normalMatrix",r.normalMatrix),P.setValue(Tt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++)if(st.isWebGL2){const n=t[e];Et.update(n,w),Et.bind(n,w)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return w}(t,e,n,i,r);ot.setMaterial(i,o);let l=n.index,c=1;if(!0===i.wireframe){if(l=pt.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==s&&(d=Math.max(d,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;Ct.setup(r,i,a,n,l);let _=St;if(null!==l&&(m=dt.get(l),_=At,_.setIndex(m)),r.isMesh)!0===i.wireframe?(ot.setLineWidth(i.wireframeLinewidth*et()),_.setMode(Tt.LINES)):_.setMode(Tt.TRIANGLES);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),ot.setLineWidth(t*et()),r.isLineSegments?_.setMode(Tt.LINES):r.isLineLoop?_.setMode(Tt.LINE_LOOP):_.setMode(Tt.LINE_STRIP)}else r.isPoints?_.setMode(Tt.POINTS):r.isSprite&&_.setMode(Tt.TRIANGLES);if(r.isInstancedMesh)_.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);_.renderInstances(d,f,e)}else _.render(d,f)},this.compile=function(t,e,n=null){null===n&&(n=t),g=vt.get(n),g.init(),v.push(g),n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))})),t!==n&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))})),g.setupLights(y._useLegacyLights);const i=new Set;return t.traverse((function(t){const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const s=e[r];Bt(s,n,t),i.add(s)}else Bt(e,n,t),i.add(e)})),v.pop(),g=null,i},this.compileAsync=function(t,e,n=null){const i=this.compile(t,e,n);return new Promise((e=>{function n(){i.forEach((function(t){lt.get(t).currentProgram.isReady()&&i.delete(t)})),0!==i.size?setTimeout(n,10):e(t)}null!==rt.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ut=null;function zt(){Gt.stop()}function Ht(){Gt.start()}const Gt=new ki;function $t(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)g.pushLight(t),t.castShadow&&g.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||q.intersectsSprite(t)){i&&J.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Z);const e=ft.update(t),r=t.material;r.visible&&m.push(t,e,r,n,J.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||q.intersectsObject(t))){const e=ft.update(t),r=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),J.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),J.copy(e.boundingSphere.center)),J.applyMatrix4(t.matrixWorld).applyMatrix4(Z)),Array.isArray(r)){const i=e.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r[o.materialIndex];a&&a.visible&&m.push(t,e,a,n,J.z,o)}}else r.visible&&m.push(t,e,r,n,J.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)$t(r[t],e,n,i)}function jt(t,e,n,i){const r=t.opaque,s=t.transmissive,o=t.transparent;g.setupLightsView(n),!0===X&&yt.setGlobalState(y.clippingPlanes,n),s.length>0&&function(t,e,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;const r=st.isWebGL2;null===K&&(K=new oe(1,1,{generateMipmaps:!0,type:rt.has("EXT_color_buffer_half_float")?V:F,minFilter:N,samples:r?4:0})),y.getDrawingBufferSize(Q),r?K.setSize(Q.x,Q.y):K.setSize(Dt(Q.x),Dt(Q.y));const s=y.getRenderTarget();y.setRenderTarget(K),y.getClearColor(P),I=y.getClearAlpha(),I<1&&y.setClearColor(16777215,.5),y.clear();const o=y.toneMapping;y.toneMapping=0,Wt(t,n,i),ct.updateMultisampleRenderTarget(K),ct.updateRenderTargetMipmap(K);let a=!1;for(let t=0,r=e.length;t<r;t++){const r=e[t],s=r.object,o=r.geometry,l=r.material,c=r.group;if(2===l.side&&s.layers.test(i.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,qt(s,n,i,o,l,c),l.side=t,l.needsUpdate=!0,a=!0}}!0===a&&(ct.updateMultisampleRenderTarget(K),ct.updateRenderTargetMipmap(K)),y.setRenderTarget(s),y.setClearColor(P,I),y.toneMapping=o}(r,s,e,n),i&&ot.viewport(C.copy(i)),r.length>0&&Wt(r,e,n),s.length>0&&Wt(s,e,n),o.length>0&&Wt(o,e,n),ot.buffers.depth.setTest(!0),ot.buffers.depth.setMask(!0),ot.buffers.color.setMask(!0),ot.setPolygonOffset(!1)}function Wt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===i?s.material:i,c=s.group;o.layers.test(n.layers)&&qt(o,e,n,a,l,c)}}function qt(t,e,n,i,r,s){t.onBeforeRender(y,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(y,e,n,i,t,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=2):y.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(y,e,n,i,r,s)}function Xt(t,e,n){!0!==e.isScene&&(e=tt);const i=lt.get(t),r=g.state.lights,s=g.state.shadowsArray,o=r.state.version,a=mt.getParameters(t,r.state,s,e,n),l=mt.getProgramCacheKey(a);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?ht:ut).get(t.envMap||i.environment),void 0===c&&(t.addEventListener("dispose",Ft),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Kt(t,a),u}else a.uniforms=mt.getUniforms(t),t.onBuild(n,a,y),t.onBeforeCompile(a,y),u=mt.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const h=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=yt.uniform),Kt(t,a),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Yt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=vs.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Kt(t,e){const n=lt.get(t);n.outputColorSpace=e.outputColorSpace,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Gt.setAnimationLoop((function(t){Ut&&Ut(t)})),"undefined"!=typeof self&&Gt.setContext(self),this.setAnimationLoop=function(t){Ut=t,Rt.setAnimationLoop(t),null===t?Gt.stop():Gt.start()},Rt.addEventListener("sessionstart",zt),Rt.addEventListener("sessionend",Ht),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Rt.enabled&&!0===Rt.isPresenting&&(!0===Rt.cameraAutoUpdate&&Rt.updateCamera(e),e=Rt.getCamera()),!0===t.isScene&&t.onBeforeRender(y,t,e,S),g=vt.get(t,v.length),g.init(),v.push(g),Z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),q.setFromProjectionMatrix(Z),Y=this.localClippingEnabled,X=yt.init(this.clippingPlanes,Y),m=_t.get(t,_.length),m.init(),_.push(m),$t(t,e,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(L,O),this.info.render.frame++,!0===X&&yt.beginShadows();const n=g.state.shadowsArray;if(bt.render(n,t,e),!0===X&&yt.endShadows(),!0===this.info.autoReset&&this.info.reset(),xt.render(m,t),g.setupLights(y._useLegacyLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];jt(m,t,i,i.viewport)}}else jt(m,t,e);null!==S&&(ct.updateMultisampleRenderTarget(S),ct.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(y,t,e),Ct.resetDefaultState(),A=-1,M=null,v.pop(),g=v.length>0?v[v.length-1]:null,_.pop(),m=_.length>0?_[_.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,n){lt.get(t.texture).__webglTexture=e,lt.get(t.depthTexture).__webglTexture=n;const i=lt.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===rt.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const n=lt.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){S=t,x=e,w=n;let i=!0,r=null,s=!1,o=!1;if(t){const a=lt.get(t);void 0!==a.__useDefaultFramebuffer?(ot.bindFramebuffer(Tt.FRAMEBUFFER,null),i=!1):void 0===a.__webglFramebuffer?ct.setupRenderTarget(t):a.__hasExternalTextures&&ct.rebindTextures(t,lt.get(t.texture).__webglTexture,lt.get(t.depthTexture).__webglTexture);const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=lt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(c[e])?c[e][n]:c[e],s=!0):r=st.isWebGL2&&t.samples>0&&!1===ct.useMultisampledRTT(t)?lt.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,C.copy(t.viewport),E.copy(t.scissor),T=t.scissorTest}else C.copy($).multiplyScalar(D).floor(),E.copy(j).multiplyScalar(D).floor(),T=W;if(ot.bindFramebuffer(Tt.FRAMEBUFFER,r)&&st.drawBuffers&&i&&ot.drawBuffers(t,r),ot.viewport(C),ot.scissor(E),ot.setScissorTest(T),s){const i=lt.get(t.texture);Tt.framebufferTexture2D(Tt.FRAMEBUFFER,Tt.COLOR_ATTACHMENT0,Tt.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.__webglTexture,n)}else if(o){const i=lt.get(t.texture),r=e||0;Tt.framebufferTextureLayer(Tt.FRAMEBUFFER,Tt.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}A=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=lt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){ot.bindFramebuffer(Tt.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==G&&Mt.convert(a)!==Tt.getParameter(Tt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===V&&(rt.has("EXT_color_buffer_half_float")||st.isWebGL2&&rt.has("EXT_color_buffer_float"));if(!(l===F||Mt.convert(l)===Tt.getParameter(Tt.IMPLEMENTATION_COLOR_READ_TYPE)||l===z&&(st.isWebGL2||rt.has("OES_texture_float")||rt.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&Tt.readPixels(e,n,i,r,Mt.convert(a),Mt.convert(l),s)}finally{const t=null!==S?lt.get(S).__webglFramebuffer:null;ot.bindFramebuffer(Tt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);ct.setTexture2D(e,0),Tt.copyTexSubImage2D(Tt.TEXTURE_2D,n,0,0,t.x,t.y,r,s),ot.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,o=Mt.convert(n.format),a=Mt.convert(n.type);ct.setTexture2D(n,0),Tt.pixelStorei(Tt.UNPACK_FLIP_Y_WEBGL,n.flipY),Tt.pixelStorei(Tt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Tt.pixelStorei(Tt.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?Tt.texSubImage2D(Tt.TEXTURE_2D,i,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?Tt.compressedTexSubImage2D(Tt.TEXTURE_2D,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):Tt.texSubImage2D(Tt.TEXTURE_2D,i,t.x,t.y,o,a,e.image),0===i&&n.generateMipmaps&&Tt.generateMipmap(Tt.TEXTURE_2D),ot.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=Mt.convert(i.format),c=Mt.convert(i.type);let u;if(i.isData3DTexture)ct.setTexture3D(i,0),u=Tt.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ct.setTexture2DArray(i,0),u=Tt.TEXTURE_2D_ARRAY}Tt.pixelStorei(Tt.UNPACK_FLIP_Y_WEBGL,i.flipY),Tt.pixelStorei(Tt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Tt.pixelStorei(Tt.UNPACK_ALIGNMENT,i.unpackAlignment);const h=Tt.getParameter(Tt.UNPACK_ROW_LENGTH),d=Tt.getParameter(Tt.UNPACK_IMAGE_HEIGHT),p=Tt.getParameter(Tt.UNPACK_SKIP_PIXELS),f=Tt.getParameter(Tt.UNPACK_SKIP_ROWS),m=Tt.getParameter(Tt.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;Tt.pixelStorei(Tt.UNPACK_ROW_LENGTH,g.width),Tt.pixelStorei(Tt.UNPACK_IMAGE_HEIGHT,g.height),Tt.pixelStorei(Tt.UNPACK_SKIP_PIXELS,t.min.x),Tt.pixelStorei(Tt.UNPACK_SKIP_ROWS,t.min.y),Tt.pixelStorei(Tt.UNPACK_SKIP_IMAGES,t.min.z),n.isDataTexture||n.isData3DTexture?Tt.texSubImage3D(u,r,e.x,e.y,e.z,s,o,a,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Tt.compressedTexSubImage3D(u,r,e.x,e.y,e.z,s,o,a,l,g.data)):Tt.texSubImage3D(u,r,e.x,e.y,e.z,s,o,a,l,c,g),Tt.pixelStorei(Tt.UNPACK_ROW_LENGTH,h),Tt.pixelStorei(Tt.UNPACK_IMAGE_HEIGHT,d),Tt.pixelStorei(Tt.UNPACK_SKIP_PIXELS,p),Tt.pixelStorei(Tt.UNPACK_SKIP_ROWS,f),Tt.pixelStorei(Tt.UNPACK_SKIP_IMAGES,m),0===r&&i.generateMipmaps&&Tt.generateMipmap(u),ot.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?ct.setTextureCube(t,0):t.isData3DTexture?ct.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?ct.setTexture2DArray(t,0):ct.setTexture2D(t,0),ot.unbindTexture()},this.resetState=function(){x=0,w=0,S=null,ot.reset(),Ct.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return St}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===rt?"display-p3":"srgb",e.unpackColorSpace=Xt.workingColorSpace===st?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===nt?tt:3e3}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===tt?nt:it}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}(class extends ho{}).prototype.isWebGL1Renderer=!0;class po{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new Pn(t),this.near=e,this.far=n}clone(){return new po(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class fo extends dn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e}}class mo extends ie{constructor(t=null,e=1,n=1,i,r,s,o,a,l=1003,c=1003,u,h){super(null,s,o,a,l,c,i,r,u,h),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class go extends kn{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Pn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const _o=new ue,vo=new ue,yo=new ze,bo=new Ue,xo=new Re;class wo extends dn{constructor(t=new qn,e=new go){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)_o.fromBufferAttribute(e,t-1),vo.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=_o.distanceTo(vo);t.setAttribute("lineDistance",new Un(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),xo.copy(n.boundingSphere),xo.applyMatrix4(i),xo.radius+=r,!1===t.ray.intersectsSphere(xo))return;yo.copy(i).invert(),bo.copy(t.ray).applyMatrix4(yo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new ue,c=new ue,u=new ue,h=new ue,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p)for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){const i=p.getX(n),r=p.getX(n+1);if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,r),bo.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(h);s<t.near||s>t.far||e.push({distance:s,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count)-1;n<i;n+=d){if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1),bo.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(h);i<t.near||i>t.far||e.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const So=new ue,Ao=new ue;class Mo extends wo{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)So.fromBufferAttribute(e,t),Ao.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+So.distanceTo(Ao);t.setAttribute("lineDistance",new Un(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Co extends kn{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Pn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Eo=new ze,To=new Ue,Po=new Re,Io=new ue;class Ro extends dn{constructor(t=new qn,e=new Co){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Po.copy(n.boundingSphere),Po.applyMatrix4(i),Po.radius+=r,!1===t.ray.intersectsSphere(Po))return;Eo.copy(i).invert(),To.copy(t.ray).applyMatrix4(Eo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);Io.fromBufferAttribute(c,r),ko(Io,r,a,i,t,e,this)}else for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)Io.fromBufferAttribute(c,n),ko(Io,n,a,i,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function ko(t,e,n,i,r,s,o){const a=To.distanceSqToPoint(t);if(a<n){const n=new ue;To.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}class Do extends ie{constructor(t,e,n,i,r,s,o,a,l){super(t,e,n,i,r,s,o,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Lo extends qn{constructor(t=1,e=1,n=1,i=32,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function _(n){const r=p,s=new Nt,f=new ue;let _=0;const v=!0===n?t:e,y=!0===n?1:-1;for(let t=1;t<=i;t++)u.push(0,m*y,0),h.push(0,y,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=i;t++){const e=t/i*a+o,n=Math.cos(e),r=Math.sin(e);f.x=v*r,f.y=m*y,f.z=v*n,u.push(f.x,f.y,f.z),h.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),_+=3}l.addGroup(g,_,!0===n?1:2),g+=_}!function(){const s=new ue,_=new ue;let v=0;const y=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*a+o,l=Math.sin(r),f=Math.cos(r);_.x=v*l,_.y=-g*n+m,_.z=v*f,u.push(_.x,_.y,_.z),s.set(l,y,f).normalize(),h.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];c.push(n,i,s),c.push(i,r,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&_(!0),e>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Un(u,3)),this.setAttribute("normal",new Un(h,3)),this.setAttribute("uv",new Un(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Lo(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Oo extends Lo{constructor(t=1,e=1,n=32,i=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,n,i,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new Oo(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class No extends qn{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function o(t,e,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const o=t.clone().lerp(n,i/r),a=e.clone().lerp(n,i/r),l=r-i;for(let t=0;t<=l;t++)s[i][t]=0===t&&i===r?o:o.clone().lerp(a,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(s[t][n+1]),a(s[t+1][n]),a(s[t][n])):(a(s[t][n+1]),a(s[t+1][n+1]),a(s[t+1][n]))}}function a(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function c(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new ue,i=new ue,r=new ue;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],i),l(e[s+2],r),o(n,i,r,t)}(i),function(t){const e=new ue;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new ue;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=u(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(i,1-o)}var e;(function(){const t=new ue,e=new ue,n=new ue,i=new ue,o=new Nt,a=new Nt,l=new Nt;for(let h=0,d=0;h<r.length;h+=9,d+=6){t.set(r[h+0],r[h+1],r[h+2]),e.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=u(i);c(o,d+0,t,p),c(a,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),o=Math.min(e,n,i);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Un(r,3)),this.setAttribute("normal",new Un(r.slice(),3)),this.setAttribute("uv",new Un(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new No(t.vertices,t.indices,t.radius,t.details)}}class Fo extends No{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Fo(t.radius,t.detail)}}class Bo extends No{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Bo(t.radius,t.detail)}}class Uo extends No{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Uo(t.radius,t.detail)}}class zo extends qn{constructor(t=1,e=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],o=[],a=[],l=[],c=new ue,u=new ue,h=new ue;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(p),u.y=(t+e*Math.cos(f))*Math.sin(p),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/i),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,o=(i+1)*(t-1)+e,a=(i+1)*t+e;s.push(n,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new Un(o,3)),this.setAttribute("normal",new Un(a,3)),this.setAttribute("uv",new Un(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new zo(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}function Vo(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}class Ho{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const o=e[1];t<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Go extends Ho{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=t,o=2*e-n;break;case 2402:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=t,a=2*n-e;break;case 2402:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let t=0;t!==o;++t)r[t]=g*s[c+t]+_*s[l+t]+v*s[a+t]+y*s[u+t];return r}}class $o extends Ho{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(i-e),u=1-c;for(let t=0;t!==o;++t)r[t]=s[l+t]*u+s[a+t]*c;return r}}class jo extends Ho{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Wo{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Vo(e,this.TimeBufferType),this.values=Vo(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Vo(t.times,Array),values:Vo(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new jo(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new $o(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Go(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Z:e=this.InterpolantFactoryMethodDiscrete;break;case Q:e=this.InterpolantFactoryMethodLinear;break;case J:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Z;case this.InterpolantFactoryMethodLinear:return Q;case this.InterpolantFactoryMethodSmooth:return J}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&(o=i,ArrayBuffer.isView(o)&&!(o instanceof DataView)))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}var o;return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===J,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const i=o*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,o=0;o!==n;++o)e[i+o]=e[t+o];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Wo.prototype.TimeBufferType=Float32Array,Wo.prototype.ValueBufferType=Float32Array,Wo.prototype.DefaultInterpolation=Q;class qo extends Wo{}qo.prototype.ValueTypeName="bool",qo.prototype.ValueBufferType=Array,qo.prototype.DefaultInterpolation=Z,qo.prototype.InterpolantFactoryMethodLinear=void 0,qo.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Wo{}).prototype.ValueTypeName="color";(class extends Wo{}).prototype.ValueTypeName="number";class Xo extends Ho{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(i-e);let l=t*o;for(let t=l+o;l!==t;l+=4)ce.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Yo extends Wo{InterpolantFactoryMethodLinear(t){return new Xo(this.times,this.values,this.getValueSize(),t)}}Yo.prototype.ValueTypeName="quaternion",Yo.prototype.DefaultInterpolation=Q,Yo.prototype.InterpolantFactoryMethodSmooth=void 0;class Ko extends Wo{}Ko.prototype.ValueTypeName="string",Ko.prototype.ValueBufferType=Array,Ko.prototype.DefaultInterpolation=Z,Ko.prototype.InterpolantFactoryMethodLinear=void 0,Ko.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Wo{}).prototype.ValueTypeName="vector";Error;class Zo extends dn{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Pn(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}const Qo=new ze,Jo=new ue,ta=new ue;class ea{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Nt(512,512),this.map=null,this.mapPass=null,this.matrix=new ze,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ri,this._frameExtents=new Nt(1,1),this._viewportCount=1,this._viewports=[new re(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Jo.setFromMatrixPosition(t.matrixWorld),e.position.copy(Jo),ta.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(ta),e.updateMatrixWorld(),Qo.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qo),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Qo)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class na extends ea{constructor(){super(new ji(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ia extends Zo{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(dn.DEFAULT_UP),this.updateMatrix(),this.target=new dn,this.shadow=new na}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class ra extends Zo{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}const sa=new ze,oa=new ze,aa=new ze;class la{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new bi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new bi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,aa.copy(t.projectionMatrix);const n=e.eyeSep/2,i=n*e.near/e.focus,r=e.near*Math.tan(Et*e.fov*.5)/e.zoom;let s,o;oa.elements[12]=-n,sa.elements[12]=n,s=-r*e.aspect+i,o=r*e.aspect+i,aa.elements[0]=2*e.near/(o-s),aa.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(aa),s=-r*e.aspect-i,o=r*e.aspect-i,aa.elements[0]=2*e.near/(o-s),aa.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(aa)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(oa),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(sa)}}const ca="\\[\\]\\.:\\/",ua=new RegExp("["+ca+"]","g"),ha="[^"+ca+"]",da="[^"+ca.replace("\\.","")+"]",pa=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",ha)+/(WCOD+)?/.source.replace("WCOD",da)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ha)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ha)+"$"),fa=["material","materials","bones","map"];class ma{constructor(t,e,n){this.path=e,this.parsedPath=n||ma.parseTrackName(e),this.node=ma.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new ma.Composite(t,e,n):new ma(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(ua,"")}static parseTrackName(t){const e=pa.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==fa.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=ma.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ma.Composite=class{constructor(t,e,n){const i=n||ma.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},ma.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ma.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ma.prototype.GetterByBindingType=[ma.prototype._getValue_direct,ma.prototype._getValue_array,ma.prototype._getValue_arrayElement,ma.prototype._getValue_toArray],ma.prototype.SetterByBindingTypeAndVersioning=[[ma.prototype._setValue_direct,ma.prototype._setValue_direct_setNeedsUpdate,ma.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ma.prototype._setValue_array,ma.prototype._setValue_array_setNeedsUpdate,ma.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ma.prototype._setValue_arrayElement,ma.prototype._setValue_arrayElement_setNeedsUpdate,ma.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ma.prototype._setValue_fromArray,ma.prototype._setValue_fromArray_setNeedsUpdate,ma.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class ga{constructor(t){this.value=t}clone(){return new ga(void 0===this.value.clone?this.value:this.value.clone())}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i);var _a=n(9894),va=n(6407),ya=n(2917);function ba(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function xa(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ba(Object(n),!0).forEach((function(e){wa(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ba(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function wa(t,e,n){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Sa(t){if("undefined"==typeof window)return;const e=new RegExp(`${t}=([^&#=]*)`).exec(window.location.search);return e?decodeURIComponent(e[1]):void 0}function Aa(t,e){return void 0!==t?t:e}function Ma(t,e){const n=Object.assign({},t);for(const i in e)void 0===t[i]&&(n[i]=e[i]);return n}function Ca(t,e){for(const n in e){const i=e[n];void 0!==i&&(t[n]=i)}return t}function Ea(t,e){e=Aa(e,[]);for(let n=0;n<t.length;n++)Array.isArray(t[n])?Ea(t[n],e):e.push(t[n]);return e}function Ta(){if("undefined"==typeof window)return!1;const t=window.navigator.userAgent;return/Opera|OPR/.test(t)?"Opera":/Chrome/i.test(t)?"Chrome":/Firefox/i.test(t)?"Firefox":/Mobile(\/.*)? Safari/i.test(t)?"Mobile Safari":/MSIE/i.test(t)?"Internet Explorer":!!/Safari/i.test(t)&&"Safari"}function Pa(t){window.open(t,"_blank")||(window.location.href=t)}function Ia(t,e="download"){if(!t)return;const n="Safari"===Ta(),i=/CriOS\/[\d]+/.test(window.navigator.userAgent),r=document.createElement("a");function s(t){Pa(i?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"))}if("undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if((n||i)&&FileReader)if(t instanceof Blob){var o=new FileReader;o.onloadend=function(){s(o.result)},o.readAsDataURL(t)}else s(t);else{let n=!1;t instanceof Blob&&(t=URL.createObjectURL(t),n=!0),"download"in r?(r.style.display="hidden",document.body.appendChild(r),r.href=t,r.download=e,r.target="_blank",r.click(),document.body.removeChild(r)):Pa(t),n&&window.URL.revokeObjectURL(t)}}function Ra(t,e,n){let i,r,s,o=null,a=0;function l(){a=!1===n.leading?0:Date.now(),o=null,s=t.apply(i,r),o||(i=r=null)}return n||(n={}),function(){var c=Date.now();a||!1!==n.leading||(a=c);var u=e-(c-a);return i=this,r=arguments,u<=0||u>e?(o&&(clearTimeout(o),o=null),a=c,s=t.apply(i,r),o||(i=r=null)):o||!1===n.trailing||(o=setTimeout(l,u)),s}}function ka(t,e){return t<e?-1:t>e?1:0}function Da(t,e,n=ka){let i=0,r=t.length-1;for(;i<=r;){const s=i+r>>1,o=n(e,t[s]);if(o>0)i=s+1;else{if(!(o<0))return s;r=s-1}}return-i-1}function La(t,e,n){const i=function(t,e){let n=t.length-1;if(t[n]<e)return-1;let i=0;for(;i<=n;){const r=i+n>>1;t[r]>=e?n=r-1:i=r+1}return n+1}(t,e),r=function(t,e){if(t[0]>e)return-1;let n=0,i=t.length-1;for(;n<=i;){const r=n+i>>1;t[r]>e?i=r-1:n=r+1}return n-1}(t,n);return-1===i||-1===r||i>r?0:r-i+1}function Oa(t){return t.sort().filter((function(t,e,n){return 0===e||t!==n[e-1]}))}function Na(t){const e=28672;if(t.length>e){const n=[];for(let i=0;i<t.length;i+=e)n.push(String.fromCharCode.apply(null,t.subarray(i,i+e)));return n.join("")}return String.fromCharCode.apply(null,t)}function Fa(t,e){switch(t){case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"float32":return new Float32Array(e);default:throw new Error("arrayType unknown: "+t)}}function Ba(t,e){return new(e>65535?Uint32Array:Uint16Array)(t)}function Ua(t){return t.buffer&&t.buffer instanceof ArrayBuffer?t.buffer:t}function za(t,e){return void 0===t?t=new e:Array.isArray(t)&&(t=(new e).fromArray(t)),t}function Va(t){return za(t,ue)}function Ha(t){return za(t,ze)}function Ga(t){return za(t,ce)}function $a(t){return(e=t)instanceof(n=Float32Array)?e:new n(e);var e,n}function ja(t){return Aa(t,"").toString().toLowerCase()}class Wa{constructor(t){this.name=t,this._dict={}}add(t,e){this._dict[ja(t)]=e}get(t){return this._dict[ja(t)]}get names(){return Object.keys(this._dict)}}function qa(t){return.01745*t}const Xa="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Ya=new Array(36);function Ka(){let t,e=0;for(let n=0;n<36;n++)8===n||13===n||18===n||23===n?Ya[n]="-":14===n?Ya[n]="4":(e<=2&&(e=33554432+16777216*Math.random()|0),t=15&e,e>>=4,Ya[n]=Xa[19===n?3&t|8:t]);return Ya.join("")}function Za(t,e,n){return Math.max(e,Math.min(n,t))}function Qa(t,e,n){return t+(e-t)*n}function Ja(t,e,n,i,r,s){const o=(n-t)*s,a=(i-e)*s,l=r*r;return(2*e-2*n+o+a)*(r*l)+(-3*e+3*n-2*o-a)*l+o*r+e}function tl(t,e,n){var i;return i=function(t,e,n){return(t-e)/(n-e)}(n,t,e),(n=Za(i,0,1))*n*(3-2*n)}var el="sRGB";const nl={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},il=new Pn;function rl(t,e,n){const i=n.value;return n.value=function(t,e){let n=i.bind(this,t,e)();return"linear"==el?(il.set(n),il.convertSRGBToLinear(),il.getHex()):n},n}class sl{constructor(t={}){this.parameters=Ma(t,nl),"string"==typeof this.parameters.value&&(this.parameters.value=il.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(t={}){const e=Ma(t,this.parameters);return"rainbow"===e.scale?e.scale=["red","orange","yellow","green","blue"]:"rwb"===e.scale&&(e.scale=["red","white","blue"]),e.reverse&&(e.domain=e.domain.slice().reverse()),_a.scale(e.scale).mode(e.mode).domain(e.domain).out("num")}colorToArray(t,e=[],n=0){return e[n]=(t>>16&255)/255,e[n+1]=(t>>8&255)/255,e[n+2]=(255&t)/255,e}atomColorToArray(t,e,n){return this.colorToArray(this.atomColor?this.atomColor(t):0,e,n)}bondColor(t,e){return this.atomProxy&&this.atomColor?(this.atomProxy.index=e?t.atomIndex1:t.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(t,e,n,i){return this.colorToArray(this.bondColor(t,e),n,i)}volumeColorToArray(t,e,n){return this.colorToArray(this.volumeColor?this.volumeColor(t):0,e,n)}positionColorToArray(t,e,n){return this.colorToArray(this.positionColor?this.positionColor(t):0,e,n)}}var ol,al;(al=ol||(ol={}))[al.PROTEIN=1]="PROTEIN",al[al.NUCLEIC=2]="NUCLEIC",al[al.RNA=3]="RNA",al[al.DNA=4]="DNA",al[al.POLYMER=5]="POLYMER",al[al.WATER=6]="WATER",al[al.HELIX=7]="HELIX",al[al.SHEET=8]="SHEET",al[al.TURN=9]="TURN",al[al.BACKBONE=10]="BACKBONE",al[al.SIDECHAIN=11]="SIDECHAIN",al[al.ALL=12]="ALL",al[al.HETERO=13]="HETERO",al[al.ION=14]="ION",al[al.SACCHARIDE=15]="SACCHARIDE",al[al.SUGAR=15]="SUGAR",al[al.BONDED=16]="BONDED",al[al.RING=17]="RING",al[al.AROMATICRING=18]="AROMATICRING",al[al.METAL=19]="METAL",al[al.POLARH=20]="POLARH",al[al.NONE=21]="NONE";const ll=["*","","ALL"],cl=["NONE"],ul=[ol.BACKBONE,ol.SIDECHAIN,ol.BONDED,ol.RING,ol.AROMATICRING,ol.METAL,ol.POLARH],hl=[ol.POLYMER,ol.WATER],dl=["ALA","GLY","SER"],pl=["CYS","SER","THR"],fl=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],ml=["PHE","TRP","TYR","HIS"],gl=["ASN","GLN"],_l=["ASP","GLU"],vl=["ARG","HIS","LYS"],yl=["ARG","ASP","GLU","HIS","LYS"],bl=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],xl=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],wl=["HIS","PHE","PRO","TRP","TYR"],Sl=["ALA","GLY","ILE","LEU","VAL"];function Al(t,e){if(void 0===e.atomname&&void 0===e.element&&void 0===e.altloc&&void 0===e.atomindex&&void 0===e.keyword&&void 0===e.inscode&&void 0===e.resname&&void 0===e.sstruc&&void 0===e.resno&&void 0===e.chainname&&void 0===e.model)return-1;if(void 0!==e.keyword){if(e.keyword===ol.BACKBONE&&!t.isBackbone())return!1;if(e.keyword===ol.SIDECHAIN&&!t.isSidechain())return!1;if(e.keyword===ol.BONDED&&!t.isBonded())return!1;if(e.keyword===ol.RING&&!t.isRing())return!1;if(e.keyword===ol.AROMATICRING&&!t.isAromatic())return!1;if(e.keyword===ol.HETERO&&!t.isHetero())return!1;if(e.keyword===ol.PROTEIN&&!t.isProtein())return!1;if(e.keyword===ol.NUCLEIC&&!t.isNucleic())return!1;if(e.keyword===ol.RNA&&!t.isRna())return!1;if(e.keyword===ol.DNA&&!t.isDna())return!1;if(e.keyword===ol.POLYMER&&!t.isPolymer())return!1;if(e.keyword===ol.WATER&&!t.isWater())return!1;if(e.keyword===ol.HELIX&&!t.isHelix())return!1;if(e.keyword===ol.SHEET&&!t.isSheet())return!1;if(e.keyword===ol.TURN&&!t.isTurn())return!1;if(e.keyword===ol.ION&&!t.isIon())return!1;if(e.keyword===ol.SACCHARIDE&&!t.isSaccharide())return!1;if(e.keyword===ol.METAL&&!t.isMetal())return!1;if(e.keyword===ol.POLARH&&!t.isPolarHydrogen())return!1}if(void 0!==e.atomname&&e.atomname!==t.atomname)return!1;if(void 0!==e.element&&e.element!==t.element)return!1;if(void 0!==e.altloc&&e.altloc!==t.altloc)return!1;if(void 0!==e.atomindex&&Da(e.atomindex,t.index)<0)return!1;if(void 0!==e.resname)if(Array.isArray(e.resname)){if(!e.resname.includes(t.resname))return!1}else if(e.resname!==t.resname)return!1;if(void 0!==e.sstruc&&e.sstruc!==t.sstruc)return!1;if(void 0!==e.resno)if(Array.isArray(e.resno)&&2===e.resno.length){if(e.resno[0]>t.resno||e.resno[1]<t.resno)return!1}else if(e.resno!==t.resno)return!1;return!(void 0!==e.inscode&&e.inscode!==t.inscode||void 0!==e.chainname&&e.chainname!==t.chainname||void 0!==e.model&&e.model!==t.modelIndex)}function Ml(t,e){if(void 0===e.resname&&void 0===e.resno&&void 0===e.inscode&&void 0===e.sstruc&&void 0===e.model&&void 0===e.chainname&&void 0===e.atomindex&&(void 0===e.keyword||ul.includes(e.keyword)))return-1;if(void 0!==e.keyword){if(e.keyword===ol.HETERO&&!t.isHetero())return!1;if(e.keyword===ol.PROTEIN&&!t.isProtein())return!1;if(e.keyword===ol.NUCLEIC&&!t.isNucleic())return!1;if(e.keyword===ol.RNA&&!t.isRna())return!1;if(e.keyword===ol.DNA&&!t.isDna())return!1;if(e.keyword===ol.POLYMER&&!t.isPolymer())return!1;if(e.keyword===ol.WATER&&!t.isWater())return!1;if(e.keyword===ol.HELIX&&!t.isHelix())return!1;if(e.keyword===ol.SHEET&&!t.isSheet())return!1;if(e.keyword===ol.TURN&&!t.isTurn())return!1;if(e.keyword===ol.ION&&!t.isIon())return!1;if(e.keyword===ol.SACCHARIDE&&!t.isSaccharide())return!1}if(void 0!==e.atomindex&&0===La(e.atomindex,t.atomOffset,t.atomEnd))return!1;if(void 0!==e.resname)if(Array.isArray(e.resname)){if(!e.resname.includes(t.resname))return!1}else if(e.resname!==t.resname)return!1;if(void 0!==e.sstruc&&e.sstruc!==t.sstruc)return!1;if(void 0!==e.resno)if(Array.isArray(e.resno)&&2===e.resno.length){if(e.resno[0]>t.resno||e.resno[1]<t.resno)return!1}else if(e.resno!==t.resno)return!1;return!(void 0!==e.inscode&&e.inscode!==t.inscode||void 0!==e.chainname&&e.chainname!==t.chainname||void 0!==e.model&&e.model!==t.modelIndex)}function Cl(t,e){if(!(void 0!==e.chainname||void 0!==e.model||void 0!==e.atomindex||void 0!==e.keyword&&hl.includes(e.keyword)&&t.entity))return-1;if(void 0!==e.keyword){if(e.keyword===ol.POLYMER&&!t.entity.isPolymer())return!1;if(e.keyword===ol.WATER&&!t.entity.isWater())return!1}return!(void 0!==e.atomindex&&0===La(e.atomindex,t.atomOffset,t.atomEnd)||void 0!==e.chainname&&e.chainname!==t.chainname||void 0!==e.model&&e.model!==t.modelIndex)}function El(t,e){return void 0===e.model&&void 0===e.atomindex?-1:!(void 0!==e.atomindex&&0===La(e.atomindex,t.atomOffset,t.atomEnd)||void 0!==e.model&&e.model!==t.index)}function Tl(t,e){if(null===t)return!1;if(t.error)return!1;if(!t.rules||0===t.rules.length)return!1;const n=t.rules.length,i=!t.negate,r=!!t.negate,s=[];for(let i=0;i<n;++i){const n=t.rules[i];n.hasOwnProperty("operator")&&(s[i]=Tl(n,e))}return function(o){const a="AND"===t.operator;let l=!1;for(let c=0;c<n;++c){const n=t.rules[c];let u;if(n.hasOwnProperty("operator")){const t=s[c];if(u=!1!==t?t(o):-1,-1===u){l=!0;continue}if(!0===u){if(a)continue;return i}if(a)return r}else{if(n.keyword===ol.ALL){if(a)continue;return i}if(n.keyword===ol.NONE){if(a)continue;return r}if(u=e(o,n),-1!==u){if(!0===u){if(a)continue;return i}if(a)return r}else l=!0}}return l?-1:a?i:r}}function Pl(t,e){if(t.error)return t;if(!t.rules||0===t.rules.length)return t;const n=t.rules.length,i={operator:t.operator,rules:[]};t.hasOwnProperty("negate")&&(i.negate=t.negate);for(let r=0;r<n;++r){const n=t.rules[r];if(n.hasOwnProperty("operator")){const t=Pl(n,e);null!==t&&i.rules.push(t)}else e(n)||i.rules.push(n)}return i.rules.length>0?t:null}function Il(t,e=!1){let n=t;return e&&(n=Pl(t,(function(t){return void 0!==t.keyword&&!ul.includes(t.keyword)||void 0!==t.model||void 0!==t.chainname||void 0!==t.resname||void 0!==t.resno||void 0!==t.sstruc}))),Tl(n,Al)}function Rl(t,e=!1){let n=t;return e&&(n=Pl(t,(function(t){return!(void 0===t.keyword||!ul.includes(t.keyword))||void 0!==t.model||void 0!==t.chainname||void 0!==t.atomname||void 0!==t.element||void 0!==t.altloc}))),Tl(n,Ml)}function kl(t,e=!1){let n=t;return e&&(n=Pl(t,(function(t){return void 0!==t.keyword&&!hl.includes(t.keyword)||void 0!==t.resname||void 0!==t.resno||void 0!==t.atomname||void 0!==t.element||void 0!==t.altloc||void 0!==t.sstruc||void 0!==t.inscode}))),Tl(n,Cl)}function Dl(t,e=!1){let n=t;return e&&(n=Pl(t,(function(t){return void 0!==t.keyword||void 0!==t.chainname||void 0!==t.resname||void 0!==t.resno||void 0!==t.atomname||void 0!==t.element||void 0!==t.altloc||void 0!==t.sstruc||void 0!==t.inscode}))),Tl(n,El)}class Ll{constructor(t){this.signals={stringChanged:new va.Signal},this.setString(t)}get type(){return"selection"}setString(t,e){if(void 0===t&&(t=this.string||""),t===this.string)return;try{this.selection=function(t){let e={operator:void 0,rules:[]};if(!t)return e;let n,i,r=e;const s=[];"("===(t=t.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)&&")"===t.substr(-1)&&(t=t.slice(1,-1).trim());const o=t.split(/\s+/),a=t=>{n={operator:t,rules:[]},void 0===r?(r=n,e=n):(r.rules.push(n),s.push(r),r=n)},l=function(t){i=r,r=s.pop(),void 0===r&&(a(t),c(i))},c=function(t){r.rules.push(t)};let u=!1;for(let t=0;t<o.length;++t){const e=o[t],n=e.toUpperCase();if("("===e){u=!1,a();continue}if(")"===e){l(),r.negate&&l();continue}if(u>0)if("NOT"===n)u=1;else if(1===u)u=2;else{if(2!==u)throw new Error("something went wrong with 'not'");u=!1,l()}if("AND"===n){if("OR"===r.operator){const t=r.rules.pop();a("AND"),c(t)}else r.operator="AND";continue}if("OR"===n){"AND"===r.operator?l("OR"):r.operator="OR";continue}if("NOT"===e.toUpperCase()){u=1,a(),r.negate=!0;continue}if(+n!=+n){const t=ol[n];if(void 0!==t){c({keyword:t});continue}}if("HYDROGEN"===n){c({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if("SMALL"===n){c({resname:dl});continue}if("NUCLEOPHILIC"===n){c({resname:pl});continue}if("HYDROPHOBIC"===n){c({resname:fl});continue}if("AROMATIC"===n){c({resname:ml});continue}if("AMIDE"===n){c({resname:gl});continue}if("ACIDIC"===n){c({resname:_l});continue}if("BASIC"===n){c({resname:vl});continue}if("CHARGED"===n){c({resname:yl});continue}if("POLAR"===n){c({resname:bl});continue}if("NONPOLAR"===n){c({resname:xl});continue}if("CYCLIC"===n){c({resname:wl});continue}if("ALIPHATIC"===n){c({resname:Sl});continue}if("SIDECHAINATTACHED"===n){c({operator:"OR",rules:[{keyword:ol.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:ol.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:ol.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if("APOLARH"===n){c({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:ol.POLARH}]}]});continue}if("LIGAND"===n){c({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:ol.HETERO},{negate:!0,operator:void 0,rules:[{keyword:ol.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:ol.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:ol.WATER},{keyword:ol.ION}]}]}]});continue}if(-1!==ll.indexOf(n)){c({keyword:ol.ALL});continue}if("@"===e.charAt(0)){const t=e.substr(1).split(",").map((t=>parseInt(t)));t.sort((function(t,e){return t-e})),c({atomindex:t});continue}if("#"===e.charAt(0)){console.error("# for element selection deprecated, use _"),c({element:n.substr(1)});continue}if("_"===e.charAt(0)){c({element:n.substr(1)});continue}if("["===e[0]&&"]"===e[e.length-1]){const t=n.substr(1,e.length-2).split(","),i=t.length>1?t:t[0];c({resname:i});continue}if(e.length>=1&&e.length<=4&&"^"!==e[0]&&":"!==e[0]&&"."!==e[0]&&"%"!==e[0]&&"/"!==e[0]&&isNaN(parseInt(e))){c({resname:n});continue}const i={operator:"AND",rules:[]},s=e.split("/");if(s.length>1&&s[1]){if(isNaN(parseInt(s[1])))throw new Error("model must be an integer");i.rules.push({model:parseInt(s[1])})}const h=s[0].split("%");h.length>1&&i.rules.push({altloc:h[1]});const d=h[0].split(".");if(d.length>1&&d[1]){if(d[1].length>4)throw new Error("atomname must be one to four characters");i.rules.push({atomname:d[1].substring(0,4).toUpperCase()})}const p=d[0].split(":");p.length>1&&p[1]&&i.rules.push({chainname:p[1]});const f=p[0].split("^");if(f.length>1&&i.rules.push({inscode:f[1]}),f[0]){let t,e;"-"===f[0][0]&&(f[0]=f[0].substr(1),t=!0),f[0].includes("--")&&(f[0]=f[0].replace("--","-"),e=!0);let n=f[0].split("-");if(1===n.length){let e=parseInt(n[0]);if(isNaN(e))throw new Error("resi must be an integer");t&&(e*=-1),i.rules.push({resno:e})}else{if(2!==n.length)throw new Error("resi range must contain one '-'");{const r=n.map((t=>parseInt(t)));t&&(r[0]*=-1),e&&(r[1]*=-1),i.rules.push({resno:[r[0],r[1]]})}}}if(1===i.rules.length)c(i.rules[0]);else{if(!(i.rules.length>1))throw new Error("empty selection chunk");c(i)}}return void 0===e.operator&&1===e.rules.length&&e.rules[0].hasOwnProperty("operator")&&(e=e.rules[0]),e}(t)}catch(t){this.selection={error:t.message}}const n=this.selection;this.string=t,this.test=Il(n),this.residueTest=Rl(n),this.chainTest=kl(n),this.modelTest=Dl(n),this.atomOnlyTest=Il(n,!0),this.residueOnlyTest=Rl(n,!0),this.chainOnlyTest=kl(n,!0),this.modelOnlyTest=Dl(n,!0),e||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return ll.includes(this.string.toUpperCase())}isNoneSelection(){return cl.includes(this.string.toUpperCase())}}class Ol extends sl{constructor(t){super(t),this.colormakerList=[],this.selectionList=[],(t.dataList||[]).forEach((t=>{const[e,n,i={}]=t;ic.hasScheme(e)?Object.assign(i,{scheme:e,structure:this.parameters.structure}):Object.assign(i,{scheme:"uniform",value:new Pn(e).getHex()}),this.colormakerList.push(ic.getScheme(i)),this.selectionList.push(new Ll(n))}))}atomColor(t){for(let e=0,n=this.selectionList.length;e<n;++e){const n=this.selectionList[e].test;if(n&&n(t))return this.colormakerList[e].atomColor(t)}return 16777215}}const Nl={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},Fl={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function Bl(t){const e=t;return t.forEach((function(t){t.__deps&&Array.prototype.push.apply(e,Bl(t.__deps))})),e}function Ul(t){return Oa(Bl(t)).map((function(t){return t.toString()})).join("\n\n\n")}function zl(t){const e=t.data.__name,n=t.data.__postId;if(void 0===e)console.error("message __name undefined");else if(void 0===self.func)console.error("worker func undefined",e);else{const e=function(t,e){t=t||{},void 0!==n&&(t.__postId=n);try{self.postMessage(t,e)}catch(e){console.error("self.postMessage:",e),self.postMessage(t)}};self.func(t,e)}}function Vl(t,e){let n="'use strict';\n\n"+Ul(e);return n+="\n\n\nself.func = "+t.toString()+";",n+="\n\n\nself.onmessage = "+zl.toString()+";",new Blob([n],{type:"application/javascript"})}const Hl=Ta();let Gl=!1;try{const t=Object.defineProperty({},"passive",{get:function(){Gl=!0}});window.addEventListener("test",(t=>{}),t)}catch(al){}const $l="undefined"!=typeof window&&void 0!==window.orientation;let jl=!1;function Wl(t){jl=t}let ql=!1;function Xl(t){ql=t}const Yl={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let Kl={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1};function Zl(t={}){Object.assign(Kl,t)}let Ql=!!(Jl=Sa("debug"))&&("string"!=typeof Jl||/^1|true|t|yes|y$/i.test(Jl));var Jl;function tc(t){Ql=t}const ec=["ngl","js"],nc=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(t,e,n){this._funcDict[t]=e,this._depsDict[t]=n}get(t){return this._blobDict[t]||(this._blobDict[t]=Vl(this._funcDict[t],this._depsDict[t])),this._blobDict[t]}},ic=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(t){const e=((t||{}).scheme||"").toLowerCase();let n;return n=e in this.schemes?this.schemes[e]:e in this.userSchemes?this.userSchemes[e]:sl,new n(t)}getSchemes(){const t={};return Object.keys(this.schemes).forEach((function(e){t[e]=e})),Object.keys(this.userSchemes).forEach((function(e){t[e]=e.split("|")[1]})),t}getScales(){return Nl}getModes(){return Fl}add(t,e){t=t.toLowerCase(),this.schemes[t]=e}addScheme(t,e){return function(t){return t instanceof sl}(t)||(t=this._createScheme(t)),this._addUserScheme(t,e)}_addUserScheme(t,e){e=e||"";const n=`${Ka()}|${e}`.toLowerCase();return this.userSchemes[n]=t,n}removeScheme(t){t=t.toLowerCase(),delete this.userSchemes[t]}_createScheme(t){return class extends sl{constructor(e){super(e),t.call(this,e)}}}addSelectionScheme(t,e){return this._addUserScheme(class extends Ol{constructor(e){super(Object.assign({dataList:t},e))}},e)}hasScheme(t){return(t=t.toLowerCase())in this.schemes||t in this.userSchemes}},rc=new Wa("datasource"),sc=new Wa("representatation"),oc=new class extends Wa{constructor(){super("parser")}__hasObjName(t,e){const n=this.get(t);return n&&n.prototype.__objName===e}isTrajectory(t){return this.__hasObjName(t,"frames")}isStructure(t){return this.__hasObjName(t,"structure")}isVolume(t){return this.__hasObjName(t,"volume")}isSurface(t){return this.__hasObjName(t,"surface")}isBinary(t){const e=this.get(t);return e&&e.prototype.isBinary}isXml(t){const e=this.get(t);return e&&e.prototype.isXml}isJson(t){const e=this.get(t);return e&&e.prototype.isJson}getTrajectoryExtensions(){return this.names.filter((t=>this.isTrajectory(t)))}getStructureExtensions(){return this.names.filter((t=>this.isStructure(t)))}getVolumeExtensions(){return this.names.filter((t=>this.isVolume(t)))}getSurfaceExtensions(){return this.names.filter((t=>this.isSurface(t)))}},ac=new Wa("shader"),lc=new Wa("decompressor"),cc=new Wa("component"),uc=new Wa("buffer"),hc=new Wa("picker");let dc,pc;function fc(t){dc=t}function mc(t){pc=t}class gc{constructor(t,e={}){this.chunkSize=10485760,this.newline="\n",this.__pointer=0,this.__partialLine="",this.compressed=Aa(e.compressed,!1),this.binary=Aa(e.binary,!1),this.json=Aa(e.json,!1),this.xml=Aa(e.xml,!1),this.src=t}isBinary(){return this.binary||this.compressed}read(){return this._read().then((t=>{const e=this.compressed?lc.get(this.compressed):void 0;return this.compressed&&e?this.data=e(t):((this.binary||this.compressed)&&t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.data=t),this.data}))}_chunk(t,e){return e=Math.min(this.data.length,e),0===t&&this.data.length===e?this.data:this.isBinary()?this.data.subarray(t,e):this.data.substring(t,e)}chunk(t){const e=t+this.chunkSize;return this._chunk(t,e)}peekLines(t){const e=this.data,n=e.length,i=this.isBinary()?this.newline.charCodeAt(0):this.newline;let r,s=0;for(r=0;r<n&&(e[r]===i&&++s,s!==t);++r);const o=this._chunk(0,r+1);return this.chunkToLines(o,"",r>n).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?Na(this.data):this.data}chunkToLines(t,e,n){const i=this.newline;if(!this.isBinary()&&t.length===this.data.length)return{lines:t.split(i),partialLine:""};let r=[];const s=this.isBinary()?Na(t):t,o=s.lastIndexOf(i);if(-1===o)e+=s;else{const t=e+s.substr(0,o);r=r.concat(t.split(i)),e=o===s.length-i.length?"":s.substr(o+i.length)}return n&&""!==e&&r.push(e),{lines:r,partialLine:e}}nextChunk(){const t=this.__pointer;if(!(t>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(t)}nextChunkOfLines(){const t=this.nextChunk();if(void 0===t)return;const e=this.__pointer>this.data.length,n=this.chunkToLines(t,this.__partialLine,e);return this.__partialLine=n.partialLine,n.lines}eachChunk(t){const e=this.chunkSize,n=this.data.length,i=this.chunkCount();for(let r=0;r<n;r+=e)t(this.chunk(r),Math.round(r/e),i)}eachChunkOfLines(t){this.eachChunk(((e,n,i)=>{const r=n===i+1,s=this.chunkToLines(e,this.__partialLine,r);this.__partialLine=s.partialLine,t(s.lines,n,i)}))}dispose(){delete this.src}}class _c extends gc{_read(){return new Promise(((t,e)=>{const n=this.src,i=new FileReader;i.onload=e=>{e.target&&t(e.target.result)},i.onerror=t=>e(t),this.binary||this.compressed?i.readAsArrayBuffer(n):i.readAsText(n)}))}}class vc extends gc{_read(){return new Promise(((t,e)=>{const n=this.src,i=new XMLHttpRequest;i.open("GET",n,!0),i.addEventListener("load",(()=>{if(200===i.status||304===i.status||0===i.status)try{t(i.response)}catch(t){e(t)}else e(i.statusText)}),!1),i.addEventListener("error",(t=>e("network error")),!1),this.isBinary()?i.responseType="arraybuffer":this.json?i.responseType="json":this.xml?i.responseType="document":i.responseType="text",i.send()}))}}class yc{constructor(t,e={}){this.parameters=Ma(e,{ext:"",compressed:!1,binary:oc.isBinary(e.ext||""),name:"",dir:"",path:"",protocol:""});const n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:oc.isJson(this.parameters.ext),xml:oc.isXml(this.parameters.ext)};"undefined"!=typeof File&&t instanceof File||"undefined"!=typeof Blob&&t instanceof Blob?this.streamer=new _c(t,n):this.streamer=new vc(t,n)}}class bc extends yc{constructor(t,e={}){super(t,e),this.parserParams={voxelSize:e.voxelSize,firstModelOnly:e.firstModelOnly,asTrajectory:e.asTrajectory,cAlphaOnly:e.cAlphaOnly,delimiter:e.delimiter,comment:e.comment,columnNames:e.columnNames,inferBonds:e.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(oc.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class xc{constructor(t,e,n){this.name=e,this.path=n,this.signals={elementAdded:new va.Signal,elementRemoved:new va.Signal,nameChanged:new va.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",t)}catch(t){Yl.error("Script compilation failed",t),this.fn=function(){}}}run(t){return new Promise(((e,n)=>{try{this.fn.apply(null,[t,this.name,this.path,this.dir]),e()}catch(t){Yl.error("Script.fn",t),n(t)}}))}}class wc extends yc{load(){return this.streamer.read().then((()=>new xc(this.streamer.asText(),this.parameters.name,this.parameters.path)))}}function Sc(t){const e=lc.names;let n,i,r="";n=t instanceof File?t.name:t instanceof Blob?"":t;const s=n.lastIndexOf("?"),o=-1!==s?n.substring(s):"";n=n.substring(0,-1===s?n.length:s);const a=n.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const c=a.split(".");let u=c.length>1?(c.pop()||"").toLowerCase():"";const h=n.match(/^(.+):\/\/(.+)$/);h&&(r=h[1].toLowerCase(),n=h[2]||"");const d=n.substring(0,n.lastIndexOf("/")+1);if(e.includes(u)){i=u;const t=n.length-u.length-1;u=(n.substr(0,t).split(".").pop()||"").toLowerCase();const e=l.length-u.length-1;l=l.substr(0,e)}else i=!1;return{path:n,name:a,ext:u,base:l,dir:d,compressed:i,protocol:r,query:o,src:t}}function Ac(t){let e=Sc(t);const n=rc.get(e.protocol);return n&&(e=Sc(n.getUrl(e.src)),!e.ext&&n.getExt&&(e.ext=n.getExt(t))),e}function Mc(t,e={}){const n=Object.assign(Ac(t),e);let i;return oc.names.includes(n.ext)?i=new bc(n.src,n):ec.includes(n.ext)&&(i=new wc(n.src,n)),i?i.load():Promise.reject(new Error(`autoLoad: ext '${n.ext}' unknown`))}class Cc{getBlob(){return new Blob([this.getData()],{type:this.mimeType})}download(t,e){t=Aa(t,this.defaultName),e=Aa(e,this.defaultExt),Ia(this.getBlob(),`${t}.${e}`)}}class Ec extends Cc{constructor(t,e){super(),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="pdb";const n=Object.assign({},e);this.renumberSerial=Aa(n.renumberSerial,!0),this.remarks=function(t){return Array.isArray(t)?t:[t]}(Aa(n.remarks,[])),this.structure=t,this._records=[]}_writeRecords(){this._records.length=0,this._writeTitle(),this._writeRemarks(),this._writeAtoms()}_writeTitle(){this._records.push((0,ya.sprintf)("TITLE %-74s",this.structure.name))}_writeRemarks(){this.remarks.forEach((t=>{this._records.push((0,ya.sprintf)("REMARK %-73s",t))})),this.structure.trajectory&&(this._records.push((0,ya.sprintf)("REMARK %-73s","Trajectory '"+this.structure.trajectory.name+"'")),this._records.push((0,ya.sprintf)("REMARK %-73s",`Frame ${this.structure.trajectory.frame}`)))}_writeAtoms(){let t=1,e=1,n=" ",i=" ";const r=this.structure.modelStore.count>1;this.structure.eachModel((s=>{r&&this._records.push((0,ya.sprintf)("MODEL     %4d%-66s",e++,"")),s.eachAtom((e=>{const r=e.hetero?"HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s":"ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s",s=this.renumberSerial?t:e.serial;let o=e.atomname;(1===o.length||o.length<4&&1===e.element.length&&o[0]===e.element)&&(o=" "+o),e.formalCharge?(n=Math.abs(e.formalCharge).toPrecision(1),i=e.formalCharge>0?"+":"-"):(n=" ",i=" "),this._records.push((0,ya.sprintf)(r,s,o,e.resname,Aa(e.chainname," "),e.resno,e.x,e.y,e.z,Aa(e.occupancy,1),Aa(e.bfactor,0),"",Aa(e.element,""),n,i)),t+=1}),this.structure.getSelection()),r&&this._records.push((0,ya.sprintf)("%-80s","ENDMDL"))})),this._records.push((0,ya.sprintf)("%-80s","END"))}getString(){return console.warn("PdbWriter.getString() is deprecated, use .getData instead"),this.getData()}getData(){return this._writeRecords(),this._records.join("\n")}}class Tc extends Cc{constructor(t){super(),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="sdf",this.structure=t,this._records=[]}get idString(){return this.structure.id}get titleString(){return"  "+this.structure.title}get countsString(){return(0,ya.sprintf)("%3i%3i  0  0  0  0  0  0  0  0999 V2000",this.structure.atomCount,this.structure.bondCount)}get chargeLines(){const t=[];this.structure.eachAtom((e=>{null!=e.formalCharge&&0!==e.formalCharge&&t.push([e.index,e.formalCharge])}));const e=[];for(let n=0;n<t.length;n+=8){const i=Math.min(8,t.length-n);let r=(0,ya.sprintf)("M  CHG%3i",i);for(let e=n;e<n+i;e++)r+=(0,ya.sprintf)(" %3i %3i",t[e][0]+1,t[e][1]);e.push(r)}return e}formatAtom(t){let e=0;null!=t.formalCharge&&0!==t.formalCharge&&(e=4-t.formalCharge);const n=(0,ya.sprintf)("%10.4f%10.4f%10.4f %-3s 0%3i  0  0  0",t.x,t.y,t.z,t.element,e);if(48!==n.length)throw new Error("Incompatible atom for sdf format");return n}formatBond(t){return(0,ya.sprintf)("%3i%3i%3i  0  0  0",t.atomIndex1+1,t.atomIndex2+1,t.bondOrder)}_writeRecords(){this._records.length=0,this._writeHeader(),this._writeCTab(),this._writeFooter()}_writeHeader(){this._records.push(this.idString,this.titleString,"")}_writeCTab(){this._records.push(this.countsString),this.structure.eachAtom((t=>{this._records.push(this.formatAtom(t))})),this.structure.eachBond((t=>{this._records.push(this.formatBond(t))})),this.chargeLines.forEach((t=>{this._records.push(t)})),this._records.push("M  END")}_writeFooter(){this._records.push("$$$$")}getData(){return this._writeRecords(),this._records.join("\n")}}const Pc=[];class Ic{constructor(t,e={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;void 0===t&&(t=8192),"number"==typeof t?t=new ArrayBuffer(t):n=!0;const i=e.offset?e.offset>>>0:0;let r=t.byteLength-i,s=i;t instanceof ArrayBuffer||(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+i),t=t.buffer),this._lastWrittenByte=n?r:0,this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=s,this._data=new DataView(this.buffer,s,r)}available(t){return void 0===t&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return void 0===t&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const e=2*(this.offset+t),n=new Uint8Array(e);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);for(var e=new Uint8Array(t),n=0;n<t;n++)e[n]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){Pc.length=t;for(var e=0;e<t;e++)Pc[e]=this.readChar();return Pc.join("")}writeBoolean(t=!1){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class Rc extends Cc{constructor(t){super(),this.mimeType="application/vnd.ms-pki.stl",this.defaultName="surface",this.defaultExt="stl",this.surface=t}getData(){const t=this.surface.index.length/3,e=new Ic(2*t+3*t*4*4+80+4);e.skip(80),e.writeUint32(t);const n=new ue,i=new ue,r=new ue,s=new ue;for(let o=0;o<t;o++){const t=[this.surface.index[3*o],this.surface.index[3*o+1],this.surface.index[3*o+2]];i.fromArray(this.surface.normal,3*t[0]),r.fromArray(this.surface.normal,3*t[1]),s.fromArray(this.surface.normal,3*t[2]),n.addVectors(i,r).add(s).normalize(),e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z);for(let i=0;i<3;i++)n.fromArray(this.surface.position,3*t[i]),e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z);e.writeUint16(0)}return new DataView(e.buffer)}}class kc{constructor(){this.count=0,this.signals={countChanged:new va.Signal}}clear(){this.change(-this.count)}change(t){this.count+=t,this.signals.countChanged.dispatch(t,this.count),this.count<0&&Yl.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(t){this.change(t.count),t.signals.countChanged.add(this.change,this)}unlisten(t){const e=t.signals.countChanged;e.has(this.change,this)&&e.remove(this.change,this)}onZeroOnce(t,e){if(0===this.count)t.call(e);else{const n=()=>{0===this.count&&(this.signals.countChanged.remove(n,this),t.call(e))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}ac.add("shader/BasicLine.vert","void main(){\n#include begin_vertex\n#include project_vertex\n}"),ac.add("shader/BasicLine.frag","uniform vec3 uColor;\n#include common\n#include fog_pars_fragment\nvoid main(){\ngl_FragColor = vec4( uColor, 1.0 );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n}"),ac.add("shader/Quad.vert","varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),ac.add("shader/Quad.frag","varying vec2 vUv;\nuniform sampler2D tForeground;\nuniform float scale;\nvoid main() {\nvec4 foreground = texture2D( tForeground, vUv );\ngl_FragColor = foreground * scale;\n}");class Dc{constructor(){this.signals={updated:new va.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const t=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=t-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,t>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=t,this.frames=0),t}}ac.add("shader/chunk/fog_fragment.glsl","#ifdef USE_FOG\nfloat depth = length( vViewPosition );\n#ifdef FOG_EXP2\nfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif"),ac.add("shader/chunk/interior_fragment.glsl","if( gl_FrontFacing == false ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}"),ac.add("shader/chunk/matrix_scale.glsl","float matrixScale( in mat4 m ){\nvec4 r = m[ 0 ];\nreturn sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );\n}"),ac.add("shader/chunk/nearclip_vertex.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear - 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),ac.add("shader/chunk/nearclip_fragment.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear )\ndiscard;\n#endif"),ac.add("shader/chunk/opaque_back_fragment.glsl","#ifdef OPAQUE_BACK\n#ifdef FLIP_SIDED\nif( gl_FrontFacing == true ){\ngl_FragColor.a = 1.0;\n}\n#else\nif( gl_FrontFacing == false ){\ngl_FragColor.a = 1.0;\n}\n#endif\n#endif"),ac.add("shader/chunk/radiusclip_vertex.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),ac.add("shader/chunk/radiusclip_fragment.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius )\ndiscard;\n#endif"),ac.add("shader/chunk/unpack_color.glsl","vec3 unpackColor(float f) {\nvec3 color;\ncolor.r = floor(f / 256.0 / 256.0);\ncolor.g = floor((f - color.r * 256.0 * 256.0) / 256.0);\ncolor.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);\nreturn color / 255.0;\n}");const Lc=/^(?!\/\/)\s*#include\s+(\S+)/gim,Oc={};function Nc(t,e={}){let n=t+"|";for(const t in e)n+=t+":"+e[t];if(!Oc[n]){const i=function(t){if(void 0===t)return"";const e=[];for(const n in t){const i=t[n];i&&e.push(`#define ${n} ${i}`)}return e.join("\n")+"\n"}(e);let r=ac.get(`shader/${t}`);if(!r)throw new Error(`empty shader, '${t}'`);r=r.replace(Lc,(function(t,e){const n=`shader/chunk/${e}.glsl`,i=ac.get(n)||Oi[e];if(!i)throw new Error(`empty chunk, '${e}'`);return i})),Oc[n]=i+r}return Oc[n]}if("undefined"!=typeof WebGLRenderingContext){const t=WebGLRenderingContext.prototype,e=t.getShaderParameter;t.getShaderParameter=function(){return!Ql||e.apply(this,arguments)};const n=t.getShaderInfoLog;t.getShaderInfoLog=function(){return Ql?n.apply(this,arguments):""};const i=t.getProgramParameter;t.getProgramParameter=function(e,n){return!Ql&&n===t.LINK_STATUS||i.apply(this,arguments)};const r=t.getProgramInfoLog;t.getProgramInfoLog=function(){return Ql?r.apply(this,arguments):""}}const Fc=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];Fc.forEach((t=>{t.forEach((t=>{t[0]*=.0625,t[1]*=.0625}))}));class Bc{constructor(t,e,n,i){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=Aa(i.factor,2),this._antialias=Aa(i.antialias,!1),this._onProgress=i.onProgress,this._onFinish=i.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)}_renderTile(t){const e=this._viewer,n=this._width,i=this._height,r=this._factor,s=t%r*n,o=Math.floor(t/r)*i;if(e.camera.setViewOffset(n*r,i*r,s,o,n,i),e.render(),this._antialias){const t=Math.round((s+n)/2)-Math.round(s/2),r=Math.round((o+i)/2)-Math.round(o/2);this._ctx.drawImage(e.renderer.domElement,Math.round(s/2),Math.round(o/2),t,r)}else this._ctx.drawImage(e.renderer.domElement,Math.floor(s),Math.floor(o),Math.ceil(n),Math.ceil(i));"function"==typeof this._onProgress&&this._onProgress(t+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,"function"==typeof this._onFinish&&this._onFinish(this._n+1,this._n,!1)}render(){for(let t=0;t<=this._n;++t)t===this._n?this._finalize():this._renderTile(t)}renderAsync(){let t=0;const e=this._n,n=()=>{t===e?this._finalize():this._renderTile(t),t+=1};for(let t=0;t<=e;++t)setTimeout(n,0)}}const Uc=2*Math.PI,zc=180/Math.PI;function Vc(t,e,n=1,i=0,r){const s=r?r.length:t.length/n;let o=0,a=0;if(r)for(let l=0;l<s;++l){const s=(t[r[l]*n+i]+e)%e/e*Uc-Math.PI;o+=Math.cos(s),a+=Math.sin(s)}else for(let r=i;r<s;r+=n){const n=(t[r]+e)%e/e*Uc-Math.PI;o+=Math.cos(n),a+=Math.sin(n)}return o/=s,a/=s,(Math.atan2(a,o)+Math.PI)/Uc*e}function Hc(t,e,n,i=0){const r=t.length,s=n||new Float32Array(r);for(let n=0;n<r;n+=3)s[i+n+0]=(t[n+0]+e[n+0])/2,s[i+n+1]=(t[n+1]+e[n+1])/2,s[i+n+2]=(t[n+2]+e[n+2])/2;return s}function Gc(t,e){const n=t.length,i=new Float32Array(n);for(let r=0;r<n;r+=3)i[r+0]=e[r+0]-t[r+0],i[r+1]=e[r+1]-t[r+1],i[r+2]=e[r+2]-t[r+2];return i}function $c(t,e,n){const i=n||new Float32Array(t);for(let n=0;n<t;++n)i[n]=e;return i}function jc(t,e,n,i,r){const s=r||new Float32Array(3*t);for(let r=0;r<t;++r){const t=3*r;s[t+0]=e,s[t+1]=n,s[t+2]=i}return s}function Wc(t){const e=new Float32Array(t);for(let n=0;n<t;++n)e[n]=n;return e}function qc(t,e,n=0,i){const r=i||new Float32Array(t*e);for(let i=0;i<t;++i){const t=n+i*e;for(let n=0;n<e;++n)r[t+n]=i}return r}function Xc(t,e){const n=t.length,i=new Float32Array(n*e);for(let r=0;r<n;++r){const n=r*e,s=t[r];for(let t=0;t<e;++t)i[n+t]=s}return i}function Yc(t,e,n,i,r){for(let s=0;s<r;++s)e[i+s]=t[n+s]}function Kc(t,e,n,i){Yc(t,t,e,n,i)}function Zc(t){let e=-1/0;for(let n=0,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}function Qc(t){let e=1/0;for(let n=0,i=t.length;n<i;++n)t[n]<e&&(e=t[n]);return e}function Jc(t,e=1,n=0){const i=t.length;let r=0;for(let s=n;s<i;s+=e)r+=t[s];return r}function tu(t,e=1,n=0){return Jc(t,e,n)/(t.length/e)}const eu={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0},nu=new ue,iu=new ze,ru=new ze,su=new Nt,ou=new ze,au=new ze;function lu(t,e){ou.copy(e.projectionMatrix).invert(),au.copy(e.projectionMatrix).transpose(),t.traverse((function(t){const e=t.material;if(!e)return;const n=e.uniforms;n&&(n.projectionMatrixInverse&&n.projectionMatrixInverse.value.copy(ou),n.projectionMatrixTranspose&&n.projectionMatrixTranspose.value.copy(au))}))}function cu(t,e,n){const i=t.createShader(n);if(i)return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.log(`error compiling shader ${i}: ${t.getShaderInfoLog(i)}`),t.deleteShader(i),null);console.log(`error creating WebGL shader ${n}`)}function uu(t,e){const n=t.getExtension(e);return n||console.log(`extension '${e}' not available`),n}const hu=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function du(t){const e=document.createElement("canvas");e.width=16,e.height=16,e.style.width="16px",e.style.height="16px";const n=e.getContext("webgl")||e.getContext("experimental-webgl");if(!n)return console.log(`error creating webgl context for ${t}`),!1;if(!(n instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;uu(n,"OES_texture_float"),uu(n,"OES_texture_half_float"),uu(n,"WEBGL_color_buffer_float");const i=cu(n,"\nattribute vec4 a_position;\n\nvoid main() {\n  gl_Position = a_position;\n}",n.VERTEX_SHADER),r=cu(n,"\nprecision mediump float;\nuniform vec4 u_color;\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;\n}",n.FRAGMENT_SHADER);if(!i||!r)return!1;const s=function(t,e){const n=t.createProgram();return n?(e.forEach((e=>t.attachShader(n,e))),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)?n:(console.log(`error linking program: ${t.getProgramInfoLog(n)}`),t.deleteProgram(n),null)):void console.log("error creating WebGL program")}(n,[i,r]);if(!s)return console.log("error creating WebGL program"),!1;n.useProgram(s);const o=n.getAttribLocation(s,"a_position"),a=n.getUniformLocation(s,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,hu,n.STATIC_DRAW),n.enableVertexAttribArray(o),n.vertexAttribPointer(o,2,n.FLOAT,!1,0,0);const c=n.createTexture(),u=new Uint8Array([255,255,255,255]);n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,u);const h=n.createTexture();n.bindTexture(n.TEXTURE_2D,h),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,t,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);const d=n.createFramebuffer();if(n.bindFramebuffer(n.FRAMEBUFFER,d),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,h,0),n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE)return console.log(`error creating framebuffer for ${t}`),!1;n.bindTexture(n.TEXTURE_2D,c),n.uniform4fv(a,[0,10,20,1]),n.drawArrays(n.TRIANGLES,0,6),n.bindTexture(n.TEXTURE_2D,h),n.bindFramebuffer(n.FRAMEBUFFER,null),n.clearColor(1,0,0,1),n.clear(n.COLOR_BUFFER_BIT),n.uniform4fv(a,[0,.1,.05,1]),n.drawArrays(n.TRIANGLES,0,6);const p=new Uint8Array(4);if(n.readPixels(0,0,1,1,n.RGBA,n.UNSIGNED_BYTE,p),0!==p[0]||p[1]<248||p[2]<248||p[3]<254)return console.log(`not able to actually render to ${t} texture`),!1;if(t===n.FLOAT){n.bindFramebuffer(n.FRAMEBUFFER,d);const t=new Float32Array(4);n.readPixels(0,0,1,1,n.RGBA,n.FLOAT,t);const e=n.getError();if(e)return console.log(`error reading pixels as float: '${function(t,e){switch(e){case t.NO_ERROR:return"no error";case t.INVALID_ENUM:return"invalid enum";case t.INVALID_VALUE:return"invalid value";case t.INVALID_OPERATION:return"invalid operation";case t.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case t.OUT_OF_MEMORY:return"out of memory";case t.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}(n,e)}'`),!1}return!0}const pu=new Float32Array(100),fu=new Uint8Array(100),mu=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],gu=new ze;function _u(t,e,n,i,r){const s=r.uniforms,o=[];if(s&&(s.objectId&&(s.objectId.value=jl?this.id:this.id/255,o.push("objectId")),(s.modelViewMatrixInverse||s.modelViewMatrixInverseTranspose||s.modelViewProjectionMatrix||s.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld),s.modelViewMatrixInverse&&(s.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),o.push("modelViewMatrixInverse")),s.modelViewMatrixInverseTranspose&&(s.modelViewMatrixInverse?s.modelViewMatrixInverseTranspose.value.copy(s.modelViewMatrixInverse.value).transpose():s.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),o.push("modelViewMatrixInverseTranspose")),s.modelViewProjectionMatrix&&(s.modelViewProjectionMatrix.value.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),s.modelViewProjectionMatrixInverse&&(s.modelViewProjectionMatrix?(gu.copy(s.modelViewProjectionMatrix.value),s.modelViewProjectionMatrixInverse.value.copy(gu.invert())):(gu.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),s.modelViewProjectionMatrixInverse.value.copy(gu.invert())),o.push("modelViewProjectionMatrixInverse")),o.length)){const e=t.properties.get(r);if(e.program){const n=t.getContext(),i=e.program;n.useProgram(i.program);const r=i.getUniforms();o.forEach((function(t){r.setValue(n,t,s[t].value)}))}}}class vu{constructor(t){if(this.boundingBox=new pe,this.boundingBoxSize=new ue,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new ue,this.signals={ticked:new va.Signal,rendered:new va.Signal},"string"==typeof t){const e=document.getElementById(t);this.container=null===e?document.createElement("div"):e}else t instanceof HTMLElement?this.container=t:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const t=this.container.getBoundingClientRect();this.width=t.width||1,this.height=t.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),!1!==this._initRenderer()?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):Yl.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new Pn(0),fogNear:50,fogFar:100,backgroundColor:new Pn(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Pn(14540253),lightIntensity:1.2,ambientColor:new Pn(14540253),ambientIntensity:.3,sampleLevel:0,outputColorSpace:"srgb-linear"}}_initCamera(){const t=new ue(0,0,0),{width:e,height:n}=this;this.perspectiveCamera=new bi(this.parameters.cameraFov,e/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(t),this.orthographicCamera=new ji(e/-2,e/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(t),this.stereoCamera=new la,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const i=this.parameters.cameraType;if("orthographic"===i)this.camera=this.orthographicCamera;else{if("perspective"!==i&&"stereo"!==i)throw new Error(`Unknown cameraType '${i}'`);this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new Dc}_initScene(){this.scene||(this.scene=new fo,this.scene.name="scene"),this.rotationGroup=new ro,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new ro,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new ro,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new ro,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new ro,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new ro,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new po(this.parameters.fogColor.getHex()),this.directionalLight=new ia(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.directionalLight),this.ambientLight=new ra(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const t=window.devicePixelRatio,{width:e,height:n}=this;try{this.renderer=new ho({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch(t){return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(t),this.renderer.setSize(e,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputColorSpace=this.parameters.outputColorSpace,this.renderer.useLegacyLights=!0;const i=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(Xl(!0),Wl(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(Xl(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),Wl(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&du(i.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&du(36193)),this.wrapper.appendChild(this.renderer.domElement);const r=e*t,s=n*t;Ql&&console.log(JSON.stringify({Browser:Hl,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":du(i.FLOAT),"testTextureSupport HalfFloat":du(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:jl},null,2)),this.pickingTarget=new oe(r,s,{minFilter:R,magFilter:R,stencilBuffer:!1,format:G,type:jl?z:F}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.colorSpace=this.parameters.outputColorSpace,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new oe(r,s,{minFilter:L,magFilter:L,format:G,type:this.supportsHalfFloat?V:jl?z:F}),this.sampleTarget.texture.colorSpace=this.parameters.outputColorSpace,this.holdTarget=new oe(r,s,{minFilter:R,magFilter:R,format:G,type:this.supportsHalfFloat?V:jl?z:F}),this.holdTarget.texture.colorSpace=this.parameters.outputColorSpace,this.compositeUniforms={tForeground:new ga(this.sampleTarget.texture),scale:new ga(1)},this.compositeMaterial=new vi({uniforms:this.compositeUniforms,vertexShader:Nc("Quad.vert"),fragmentShader:Nc("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.compositeCamera=new ji(-1,1,1,-1,0,1),this.compositeScene=new fo,this.compositeScene.name="compositeScene",this.compositeScene.add(new hi(new Li(2,2),this.compositeMaterial))}_initHelper(){const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),e=new Float32Array(24),n=new qn;n.setIndex(new Nn(t,1)),n.setAttribute("position",new Nn(e,3));const i=new vi({uniforms:{uColor:{value:new Pn("skyblue")}},vertexShader:Nc("BasicLine.vert"),fragmentShader:Nc("BasicLine.frag")});this.boundingBoxMesh=new Mo(n,i),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const t=this.boundingBoxMesh.geometry.attributes.position,e=t.array,{min:n,max:i}=this.boundingBox;e[0]=i.x,e[1]=i.y,e[2]=i.z,e[3]=n.x,e[4]=i.y,e[5]=i.z,e[6]=n.x,e[7]=n.y,e[8]=i.z,e[9]=i.x,e[10]=n.y,e[11]=i.z,e[12]=i.x,e[13]=i.y,e[14]=n.z,e[15]=n.x,e[16]=i.y,e[17]=n.z,e[18]=n.x,e[19]=n.y,e[20]=n.z,e[21]=i.x,e[22]=n.y,e[23]=n.z,t.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(t){this.camera.position.z=-t}add(t,e){e?e.forEach((e=>this.addBuffer(t,e))):this.addBuffer(t),t.group.name="meshGroup",t.wireframeGroup.name="wireframeGroup",t.parameters.background?(this.backgroundGroup.add(t.group),this.backgroundGroup.add(t.wireframeGroup)):(this.modelGroup.add(t.group),this.modelGroup.add(t.wireframeGroup)),t.pickable&&this.pickingGroup.add(t.pickingGroup),Ql&&this.updateHelper()}addBuffer(t,e){function n(i){i instanceof ro?i.children.forEach(n):(i.userData.buffer=t,i.userData.instance=e,i.onBeforeRender=_u)}const i=t.getMesh();e&&i.applyMatrix4(e.matrix),n(i),t.group.add(i);const r=t.getWireframeMesh();if(e&&(r.matrix.copy(i.matrix),r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale)),n(r),t.wireframeGroup.add(r),t.pickable){const r=t.getPickingMesh();e&&(r.matrix.copy(i.matrix),r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale)),n(r),t.pickingGroup.add(r)}e?this._updateBoundingBox(t.geometry,t.matrix,e.matrix):this._updateBoundingBox(t.geometry,t.matrix)}remove(t){this.translationGroup.children.forEach((function(e){e.remove(t.group),e.remove(t.wireframeGroup)})),t.pickable&&this.pickingGroup.remove(t.pickingGroup),this.updateBoundingBox(),Ql&&this.updateHelper()}_updateBoundingBox(t,e,n){const i=this.boundingBox;function r(t,e,n){null==t.boundingBox&&t.computeBoundingBox();const r=t.boundingBox.clone();e&&r.applyMatrix4(e),n&&r.applyMatrix4(n),r.min.equals(r.max)&&r.expandByScalar(5),i.union(r)}function s(t){if(void 0!==t.geometry){let e,n;t.userData.buffer&&(e=t.userData.buffer.matrix),t.userData.instance&&(n=t.userData.instance.matrix),r(t.geometry,e,n)}}t?r(t,e,n):(i.makeEmpty(),this.modelGroup.traverse(s),this.backgroundGroup.traverse(s)),i.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),Ql&&this.updateHelper()}getPickingPixels(){const{width:t,height:e}=this,n=t*e*4,i=jl?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,t,e,i),i}getImage(t){return new Promise((e=>{if(t){const{width:t,height:n}=this,i=t*n*4;let r=this.getPickingPixels();if(jl){const t=new Uint8Array(i);for(let e=0;e<i;++e)t[e]=Math.round(255*r[e]);r=t}const s=document.createElement("canvas");s.width=t,s.height=n;const o=s.getContext("2d"),a=o.getImageData(0,0,t,n);a.data.set(r),o.putImageData(a,0,0),s.toBlob(e,"image/png")}else this.renderer.domElement.toBlob(e,"image/png")}))}makeImage(t={}){return function(t,e={}){const{trim:n,factor:i,antialias:r,transparent:s}=Ma(e,eu),o=t.renderer,a=t.camera,l=o.getClearAlpha(),c=o.getClearColor(new Pn);function u(e=!1){let n=i;r&&(n*=2),e&&(n=1/n),t.scene.traverse((function(t){const e=t.material;e&&e.linewidth&&(e.linewidth*=n),e&&e.uniforms&&e.uniforms.size&&void 0===e.uniforms.size.__seen&&(e.uniforms.size.value*=n,e.uniforms.size.__seen=!0),e&&e.uniforms&&e.uniforms.linewidth&&void 0===e.uniforms.linewidth.__seen&&(e.uniforms.linewidth.value*=n,e.uniforms.linewidth.__seen=!0)})),t.scene.traverse((function(t){const e=t.material;e&&e.uniforms&&e.uniforms.size&&delete e.uniforms.size.__seen,e&&e.uniforms&&e.uniforms.linewidth&&delete e.uniforms.linewidth.__seen}))}function h(t){if(n){const e=c;return function(t,e,n,i,r){const s=t.height,o=t.width,a=t.getContext("2d").getImageData(0,0,o,s).data;let l,c,u,h;for(u=!1,c=0;c<s;c++){for(l=0;l<o;l++)if(h=4*(c*o+l),a[h]!==e||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const d=c;for(u=!1,l=0;l<o;l++){for(c=0;c<s;c++)if(h=4*(c*o+l),a[h]!==e||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const p=l;for(u=!1,c=s-1;c>=0;c--){for(l=o-1;l>=0;l--)if(h=4*(c*o+l),a[h]!==e||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const f=c;for(u=!1,l=o-1;l>=0;l--){for(c=s-1;c>=0;c--)if(h=4*(c*o+l),a[h]!==e||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const m=l,g=document.createElement("canvas");return g.width=m-p,g.height=f-d,g.getContext("2d").drawImage(t,p,d,g.width,g.height,0,0,g.width,g.height),g}(t,s?0:255*e.r,s?0:255*e.g,s?0:255*e.b,s?0:255)}return t}function d(t,n,i){"function"==typeof e.onProgress&&e.onProgress(t,n,i)}return new Promise((function(e,n){const c=new Bc(o,a,t,{factor:i,antialias:r,onProgress:d,onFinish:function(i,r){h(c.canvas).toBlob((function(i){o.setClearAlpha(l),u(!0),t.requestRender(),d(r,r,!0),i?e(i):n("error creating image")}),"image/png")}});o.setClearAlpha(s?0:1),u(),c.renderAsync()}))}(this,t)}setLight(t,e,n,i){const r=this.parameters;void 0!==t&&r.lightColor.set(t),void 0!==e&&(r.lightIntensity=e),void 0!==n&&r.ambientColor.set(n),void 0!==i&&(r.ambientIntensity=i),this.requestRender()}setFog(t,e,n){const i=this.parameters;void 0!==t&&i.fogColor.set(t),void 0!==e&&(i.fogNear=e),void 0!==n&&(i.fogFar=n),this.requestRender()}setBackground(t){const e=this.parameters;t&&e.backgroundColor.set(t),this.setFog(e.backgroundColor),this.renderer.setClearColor(e.backgroundColor,0),this.renderer.domElement.style.backgroundColor=e.backgroundColor.getStyle(),this.requestRender()}setSampling(t){void 0!==t&&(this.parameters.sampleLevel=t,this.sampleLevel=t),this.requestRender()}setOutputEncoding(t){this.parameters.outputColorSpace=t,this.renderer.outputColorSpace=t,this.pickingTarget.texture.colorSpace=t,this.sampleTarget.texture.colorSpace=t,this.holdTarget.texture.colorSpace=t}setColorWorkflow(t){if("srgb-linear"!=t&&"srgb"!=t)throw new Error(`setColorWorkflow: invalid color workflow ${t}`);el="srgb-linear"==t?"linear":"sRGB",this.setOutputEncoding("srgb-linear"==t?"srgb":"srgb-linear"),this.requestRender()}setCamera(t,e,n){const i=this.parameters;if(t&&(i.cameraType=t),e&&(i.cameraFov=e),n&&(i.cameraEyeSep=n),"orthographic"===i.cameraType)this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if("perspective"!==i.cameraType&&"stereo"!==i.cameraType)throw new Error(`Unknown cameraType '${i.cameraType}'`);this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=i.cameraFov,this.stereoCamera.eyeSep=i.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(t,e,n,i,r){const s=this.parameters;void 0!==t&&(s.clipNear=t),void 0!==e&&(s.clipFar=e),void 0!==n&&(s.clipDist=n),void 0!==i&&(s.clipMode=i),void 0!==r&&(s.clipScale=r),this.requestRender()}setSize(t,e){this.width=t||1,this.height=e||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(t,e);const i=this.width*n,r=this.height*n;this.pickingTarget.setSize(i,r),this.sampleTarget.setSize(i,r),this.holdTarget.setSize(i,r),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const t=this.container.getBoundingClientRect();this.setSize(t.width,t.height)}}updateInfo(t){const{memory:e,render:n}=this.info;if(t)e.programs=0,e.geometries=0,e.textures=0,n.calls=0,n.vertices=0,n.points=0;else{const t=this.renderer.info,i=t.memory,r=t.render;e.geometries=i.geometries,e.textures=i.textures,n.calls+=r.calls,n.faces+=r.triangles,n.points+=r.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&-1!==this.sampleLevel){const t=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=t,Ql&&Yl.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(t,e){if("stereo"===this.parameters.cameraType)return{pid:0,instance:void 0,picker:void 0};t*=window.devicePixelRatio,e*=window.devicePixelRatio,t=Math.max(t-2,0),e=Math.max(e-2,0);let n,i,r=0;const s=jl?pu:fu;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,t,e,5,5,s);for(let t=0;t<mu.length;t++){const e=4*mu[t],o=Math.round(s[e+3]),a=this.pickingGroup.getObjectById(o);a&&(n=a.userData.instance,i=a.userData.buffer.picking,r=jl?Math.round(255*s[e])<<16&16711680|Math.round(255*s[e+1])<<8&65280|255&Math.round(255*s[e+2]):s[e]<<16|s[e+1]<<8|s[e+2])}return{pid:r,instance:n,picker:i}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame((()=>{this.render(),this.stats.update()})))}updateZoom(){const t=qa(this.perspectiveCamera.fov),e=2*Math.tan(t/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/e}absoluteToRelative(t){return 50*(1-t/this.bRadius)}relativeToAbsolute(t){return this.bRadius*(1-t/50)}__updateClipping(){const t=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(t.cameraZ),this.cDist=Math.abs(t.cameraZ));const e=this.scene.fog;if(e.color.set(t.fogColor),"camera"===t.clipMode)this.camera.near=t.clipNear,this.camera.far=t.clipFar,e.near=t.fogNear,e.far=t.fogFar;else if("absolute"===t.clipScale)this.camera.near=this.cDist-t.clipNear,this.camera.far=this.cDist+t.clipFar,e.near=this.cDist-t.fogNear,e.far=this.cDist+t.fogFar;else{const n=(50-t.clipNear)/50,i=-(50-t.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*i;const r=(50-t.fogNear)/50,s=-(50-t.fogFar)/50;e.near=this.cDist-this.bRadius*r,e.far=this.cDist+this.bRadius*s}"camera"!==t.clipMode&&("PerspectiveCamera"===this.camera.type?(this.camera.near=Math.max(.1,t.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),e.near=Math.max(.1,e.near),e.far=Math.max(1,e.far)):"OrthographicCamera"===this.camera.type&&t.clipDist>0&&(this.camera.near=Math.max(t.clipDist,this.camera.near)))}__updateCamera(){const t=this.camera;t.updateMatrix(),t.updateMatrixWorld(!0),t.updateProjectionMatrix(),function(t,e,n,i,r){let s=new Nt;n.getSize(s);const o=s.height,a=n.getPixelRatio(),l="OrthographicCamera"===e.type;su.set(s.width,s.height),ou.copy(e.projectionMatrix).invert(),au.copy(e.projectionMatrix).transpose(),t.traverse((function(t){const e=t.material;if(!e)return;const n=e.uniforms;if(n){if(e.clipNear){const t=(50-e.clipNear)/50,s=i-r*t;n.clipNear.value=s}n.canvasHeight&&(n.canvasHeight.value=o),n.resolution&&n.resolution.value.copy(su),n.pixelRatio&&(n.pixelRatio.value=a),n.projectionMatrixInverse&&n.projectionMatrixInverse.value.copy(ou),n.projectionMatrixTranspose&&n.projectionMatrixTranspose.value.copy(au),n.ortho&&(n.ortho.value=l)}}))}(this.scene,t,this.renderer,this.cDist,this.bRadius),function(t,e){t.traverseVisible((function(t){if(!(t instanceof Ro&&t.userData.buffer.parameters.sortParticles))return;const n=t.geometry.attributes,i=n.position.count;if(0===i)return;let r,s,o,a,l,c,u,h;iu.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld),ru.multiplyMatrices(e.projectionMatrix,iu),t.userData.sortData?(r=t.userData.sortData,o=r.__zArray,s=r.__sortArray,a=r.__cmpFn):(o=new Float32Array(i),s=new Uint32Array(i),a=function(t,e){const n=o[t],i=o[e];return n>i?1:n<i?-1:0},r={__zArray:o,__sortArray:s,__cmpFn:a},t.userData.sortData=r);for(let t=0;t<i;++t)nu.fromArray(n.position.array,3*t),nu.applyMatrix4(ru),o[t]=-nu.z,s[t]=t;!function(t,e,n=0,i){e=e||function(t,e){return t>e?1:t<e?-1:0};const r=[];let s,o,a,l=-1,c=n,u=i=(i||t.length)-1;function h(e,n){const i=t[e];t[e]=t[n],t[n]=i}for(;;)if(u-c<=25){for(let n=c+1;n<=u;++n){for(s=t[n],o=n-1;o>=c&&e(t[o],s)>0;)t[o+1]=t[o],--o;t[o+1]=s}if(-1===l)break;u=r[l--],c=r[l--]}else{for(o=c+1,a=u,h(c+u>>1,o),e(t[c],t[u])>0&&h(c,u),e(t[o],t[u])>0&&h(o,u),e(t[c],t[o])>0&&h(c,o),s=t[o];;){do{o++}while(e(t[o],s)<0);do{a--}while(e(t[a],s)>0);if(a<o)break;h(o,a)}t[c+1]=t[a],t[a]=s,u-o+1>=a-c?(r[++l]=o,r[++l]=u,u=a-1):(r[++l]=c,r[++l]=a-1,c=o)}}(s,a);for(let t in n){const e=n[t],o=e.array,a=e.itemSize;r[t]||(r[t]=new Float32Array(a*i)),h=r[t],r[t]=o;for(let t=0;t<i;++t){l=s[t];for(let e=0;e<a;++e)c=l*a+e,u=t*a+e,h[u]=o[c]}n[t].array=h,n[t].needsUpdate=!0}}))}(this.scene,t)}__setVisibility(t,e,n,i){this.modelGroup.visible=t,this.pickingGroup.visible=e,this.backgroundGroup.visible=n,this.helperGroup.visible=i}__updateLights(){this.directionalLight.color.set(this.parameters.lightColor),this.directionalLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.directionalLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(t){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,t),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(t,e){this.renderer.setRenderTarget(e||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,t),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,Ql),this.renderer.render(this.scene,t),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(t,e){const n=Fc[Math.max(0,Math.min(this.sampleLevel,5))],i=1/n.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let r=this.sampleTarget.width;const s=this.sampleTarget.height;"stereo"===this.parameters.cameraType&&(r/=2);for(let e=0;e<n.length;++e){const o=n[e];t.setViewOffset(r,s,o[0],o[1],r,s),t.updateProjectionMatrix(),lu(this.scene,t);let a=i;a+=.03125*((e+.5)/n.length-.5),this.compositeUniforms.scale.value=a,this.__renderModelGroup(t,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),0===e&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,t.clearViewOffset(),this.renderer.setRenderTarget(e||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(t=!1,e){const n=this.stereoCamera;n.update(this.perspectiveCamera);const i=this.renderer;let r=new Nt;i.getSize(r),i.setScissorTest(!0),i.setScissor(0,0,r.width/2,r.height),i.setViewport(0,0,r.width/2,r.height),lu(this.scene,n.cameraL),this.__render(t,n.cameraL),i.setScissor(r.width/2,0,r.width/2,r.height),i.setViewport(r.width/2,0,r.width/2,r.height),lu(this.scene,n.cameraR),this.__render(t,n.cameraR),i.setScissorTest(!1),i.setViewport(0,0,r.width,r.height)}__render(t=!1,e,n){t?this.lastRenderedPicking||this.__renderPickingGroup(e):this.sampleLevel>0&&"stereo"!==this.parameters.cameraType?this.__renderSuperSample(e,n):this.__renderModelGroup(e,n)}render(t=!1,e){if(this.rendering)Yl.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),"stereo"===this.parameters.cameraType?this.__renderStereo(t,e):this.__render(t,this.camera,e),this.lastRenderedPicking=t}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){Yl.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}const yu=1,bu=2,xu=3;function wu(t){const e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;return Math.sqrt(e*e+n*n)}class Su{constructor(t,e={}){this.domElement=t,this.signals={moved:new va.Signal,scrolled:new va.Signal,dragged:new va.Signal,dropped:new va.Signal,clicked:new va.Signal,hovered:new va.Signal,doubleClicked:new va.Signal},this.position=new Nt,this.prevPosition=new Nt,this.down=new Nt,this.canvasPosition=new Nt,this.prevClickCP=new Nt,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=Aa(e.hoverTimeout,50),this.handleScroll=Aa(e.handleScroll,!0),this.doubleClickSpeed=Aa(e.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)}get key(){let t=0;return this.altKey&&(t+=1),this.ctrlKey&&(t+=2),this.metaKey&&(t+=4),this.shiftKey&&(t+=8),t}setParameters(t={}){this.hoverTimeout=Aa(t.hoverTimeout,this.hoverTimeout)}_listen(){const t=window.performance.now(),e=this.canvasPosition;this.doubleClickPending&&t-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),t-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,-1!==this.hoverTimeout&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(e.x,e.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(t){if(t.target!==this.domElement||!this.handleScroll)return;t.preventDefault(),this._setKeys(t);let e=0;"deltaY"in t&&"deltaMode"in t&&void 0!==t.deltaY&&void 0!==t.deltaMode?e=t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-t.deltaY:t.deltaMode===WheelEvent.DOM_DELTA_LINE?-t.deltaY*(2.5/3):2.5*-t.deltaY:"deltaY"in t&&!("detail"in t)?e=.025*-t.deltaY:void 0!==t.wheelDelta?e=.025*-t.wheelDelta:void 0!==t.wheelDeltaY?e=.025*-t.wheelDeltaY:void 0!==t.detail&&(e=-t.detail/3),this.signals.scrolled.dispatch(e),setTimeout((()=>{this.scrolled=!0}),this.hoverTimeout)}_onMousemove(t){t.target===this.domElement?(t.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(t),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(t.clientX,t.clientY),this._setCanvasPosition(t);const e=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(e,n),this.pressed&&this.signals.dragged.dispatch(e,n)}_onMousedown(t){t.target===this.domElement&&(t.preventDefault(),this._setKeys(t),this.moving=!1,this.hovering=!1,this.down.set(t.clientX,t.clientY),this.position.set(t.clientX,t.clientY),this.which=t.which,this.buttons=function(t){if("object"==typeof t){if("buttons"in t)return t.buttons;if("which"in t){const e=t.which;if(2===e)return 4;if(3===e)return 2;if(e>0)return 1<<e-1}else if("button"in t){const e=t.button;if(1===e)return 4;if(2===e)return 2;if(e>=0)return 1<<e}}return 0}(t),this.pressed=!0,this._setCanvasPosition(t))}_onMouseup(t){t.target===this.domElement&&t.preventDefault(),this._setKeys(t);const e=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(e)<4&&(this.signals.doubleClicked.dispatch(e.x,e.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(e.x,e.y),this.doubleClickPending=!0,this.prevClickCP.copy(e)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(t){t.target===this.domElement&&t.preventDefault()}_onTouchstart(t){if(t.target===this.domElement)switch(t.preventDefault(),this.pressed=!0,t.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(t.touches[0].pageX,t.touches[0].pageY),this.position.set(t.touches[0].pageX,t.touches[0].pageY),this._setCanvasPosition(t.touches[0]);break;case 2:this.down.set((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2),this.position.set((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2),this.lastTouchDistance=wu(t)}}_onTouchend(t){t.target===this.domElement&&t.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(t){switch(t.target===this.domElement?(t.preventDefault(),this.overElement=!0):this.overElement=!1,t.touches.length){case 1:{this._setKeys(t),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(t.touches[0].pageX,t.touches[0].pageY),this._setCanvasPosition(t.touches[0]);const e=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(e,n),this.pressed&&this.signals.dragged.dispatch(e,n);break}case 2:{const e=wu(t),n=e-this.lastTouchDistance;if(this.lastTouchDistance=e,this.prevPosition.copy(this.position),this.position.set((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2),Math.abs(n)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(n/2);else{this.which=3,this.buttons=2;const t=this.prevPosition.x-this.position.x,e=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,e),this.pressed&&this.signals.dragged.dispatch(t,e)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(t){const e=this.domElement.getBoundingClientRect();let n,i;"clientX"in t&&"clientY"in t?(n=t.clientX-e.left,i=t.clientY-e.top):(n=t.offsetX,i=t.offsetY),this.canvasPosition.set(n,e.height-i)}_setKeys(t){this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.metaKey=t.metaKey,this.shiftKey=t.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const Au=new ze,Mu=new ze,Cu=new ze,Eu=new ze,Tu=new ze,Pu=new ue,Iu=new ce,Ru=new ce,ku=new ze,Du=new ue,Lu=new ue;class Ou{constructor(t,e={}){this.stage=t,this.rotateSpeed=Aa(e.rotateSpeed,2),this.zoomSpeed=Aa(e.zoomSpeed,1.2),this.panSpeed=Aa(e.panSpeed,1),this.viewer=t.viewer,this.mouse=t.mouseObserver,this.controls=t.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(t,e,n=0){const i=this.controls.getCanvasScaleFactor(n);Du.set(t,e,0),Du.multiplyScalar(this.panSpeed*i)}_getRotateXY(t,e){return[this.rotateSpeed*-t*.01,this.rotateSpeed*e*.01]}_getCameraRotation(t){return t.extractRotation(this.viewer.camera.matrixWorld),t.multiply(Mu.makeRotationY(Math.PI)),t}_transformPanVector(){this.component&&(ku.extractRotation(this.component.transform),ku.premultiply(this.viewer.rotationGroup.matrix),ku.invert(),ku.multiply(this._getCameraRotation(Eu)),Du.applyMatrix4(ku))}zoom(t){this.controls.zoom(this.zoomSpeed*t*.02)}pan(t,e){this._setPanVector(t,e),ku.copy(this.viewer.rotationGroup.matrix).invert(),ku.multiply(this._getCameraRotation(Eu)),Du.applyMatrix4(ku),this.controls.translate(Du)}panComponent(t,e){this.component&&(this._setPanVector(t,e),this._transformPanVector(),this.component.position.add(Du),this.component.updateMatrix())}panAtom(t,e){this.atom&&this.component&&(this.atom.positionToVector3(Lu),Lu.add(this.viewer.translationGroup.position),Lu.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(t,e,Lu.z),this._transformPanVector(),this.atom.positionAdd(Du),this.component.updateRepresentations({position:!0}))}rotate(t,e){const[n,i]=this._getRotateXY(t,e);this._getCameraRotation(Eu),Pu.set(1,0,0),Pu.applyMatrix4(Eu),Iu.setFromAxisAngle(Pu,i),Pu.set(0,1,0),Pu.applyMatrix4(Eu),Ru.setFromAxisAngle(Pu,n),Iu.multiply(Ru),Eu.makeRotationFromQuaternion(Iu),this.controls.applyMatrix(Eu)}zRotate(t,e){const n=this.rotateSpeed*((-t+e)/-2)*.01;Cu.makeRotationZ(n),this.controls.applyMatrix(Cu)}rotateComponent(t,e){if(!this.component)return;const[n,i]=this._getRotateXY(t,e);this._getCameraRotation(Tu),Eu.extractRotation(this.component.transform),Eu.premultiply(this.viewer.rotationGroup.matrix),Eu.invert(),Eu.premultiply(Tu),Pu.set(1,0,0),Pu.applyMatrix4(Eu),Au.makeRotationAxis(Pu,i),Pu.set(0,1,0),Pu.applyMatrix4(Eu),Mu.makeRotationAxis(Pu,n),Au.multiply(Mu),Iu.setFromRotationMatrix(Au),this.component.quaternion.premultiply(Iu),this.component.quaternion.normalize(),this.component.updateMatrix()}}const Nu=new ue;class Fu{constructor(t,e){this.stage=e,this.pid=t.pid,this.picker=t.picker,this.instance=t.instance,this.stage=e,this.controls=e.viewerControls,this.mouse=e.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if("bond"!==this.type||!this.bond)return;const t=this.bond,e=this.controls,n=this.canvasPosition,i=t.atom1.positionToVector3(),r=t.atom2.positionToVector3();return i.applyMatrix4(this.component.matrix),r.applyMatrix4(this.component.matrix),o=e.getPositionOnCanvas(i),a=e.getPositionOnCanvas(r),(s=n).distanceTo(o)<s.distanceTo(a)?t.atom1:t.atom2;var s,o,a}get closeAtom(){const t=this.canvasPosition,e=this.closestBondAtom;if(!e)return;const n=e.positionToVector3().applyMatrix4(this.component.matrix),i=this.controls.getPositionOnCanvas(n);e.positionToVector3(Nu),this.instance&&Nu.applyMatrix4(this.instance.matrix),Nu.applyMatrix4(this.component.matrix);const r=this.controls.viewer;Nu.add(r.translationGroup.position),Nu.applyMatrix4(r.rotationGroup.matrix);const s=this.controls.getCanvasScaleFactor(Nu.z),o=this.component.getMaxRepresentationRadius(e.index);return t.distanceTo(i)<=o/s?e:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(t){return this.type===t?this.object:void 0}getLabel(){const t=this.atom||this.closeAtom;let e="nothing";return this.arrow?e=this.arrow.name:t?e=`atom: ${t.qualifiedName()} (${t.structure.name})`:this.axes?e="axes":this.bond?e=`bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`:this.box?e=this.box.name:this.cone?e=this.cone.name:this.clash?e=`clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`:this.contact?e=`${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`:this.cylinder?e=this.cylinder.name:this.distance?e=`distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`:this.ellipsoid?e=this.ellipsoid.name:this.octahedron?e=this.octahedron.name:this.point?e=this.point.name:this.mesh?e=`mesh: ${this.mesh.name||this.mesh.serial} (${this.mesh.shape.name})`:this.slice?e=`slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`:this.sphere?e=this.sphere.name:this.surface?e=`surface: ${this.surface.surface.name}`:this.tetrahedron?e=this.tetrahedron.name:this.torus?e=this.torus.name:this.unitcell?e=`unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`:this.unknown?e="unknown":this.volume?e=`volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`:this.wideline&&(e=this.wideline.name),e}}class Bu{constructor(t){this.stage=t,this.viewer=t.viewer}pick(t,e){const n=this.viewer.pick(t,e);if(n.picker&&"ignore"!==n.picker.type&&void 0!==n.pid){const t=n.picker.array;if(!(t&&n.pid>=t.length))return new Fu(n,this.stage);console.error("pid >= picker.array.length")}}}const Uu=new ce,zu=new ue,Vu=new ue,Hu=new ue,Gu=new ue,$u=new ze,ju=new ue,Wu=new ze;class qu{constructor(t){this.stage=t,this.signals={changed:new va.Signal},this.viewer=t.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(t,e){const n=za(e,Nt),i=this.viewer;return Hu.copy(t).add(i.translationGroup.position).applyMatrix4(i.rotationGroup.matrix).project(i.camera),n.set((Hu.x+1)*i.width/2,(Hu.y+1)*i.height/2)}getCanvasScaleFactor(t=0){const e=this.viewer.camera;if(e instanceof ji)return 1/e.zoom;{t=Math.abs(t),t+=this.getCameraDistance();const n=qa(e.fov);return 2*t*Math.tan(n/2)/this.viewer.height}}getOrientation(t){const e=Ha(t);e.copy(this.viewer.rotationGroup.matrix);const n=this.getCameraDistance();return e.scale(Gu.set(n,n,n)),e.setPosition(this.viewer.translationGroup.position),e}orient(t){Ha(t).decompose(zu,Uu,Vu);const e=this.viewer;e.rotationGroup.setRotationFromQuaternion(Uu),e.translationGroup.position.copy(zu),e.cameraDistance=Vu.z,e.updateZoom(),this.changed()}translate(t){this.viewer.translationGroup.position.add(Va(t)),this.changed()}center(t){this.viewer.translationGroup.position.copy(Va(t)).negate(),this.changed()}zoom(t){this.distance(this.getCameraDistance()*(1-t))}getCameraDistance(){return this.viewer.cameraDistance}distance(t){this.viewer.cameraDistance=Math.max(Math.abs(t),.2),this.viewer.updateZoom(),this.changed()}spin(t,e){$u.copy(this.viewer.rotationGroup.matrix).invert(),ju.copy(Va(t)).applyMatrix4($u),this.viewer.rotationGroup.rotateOnAxis(ju,e),this.changed()}rotate(t){this.viewer.rotationGroup.setRotationFromQuaternion(Ga(t)),this.changed()}align(t){Wu.copy(Ha(t)).invert(),this.viewer.rotationGroup.setRotationFromMatrix(Wu),this.changed()}applyMatrix(t){this.viewer.rotationGroup.applyMatrix4(Ha(t)),this.changed()}}class Xu{constructor(t,e,...n){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=Aa(t,1e3),this.controls=e,this.startTime=window.performance.now(),this._init(...n)}get done(){return 1===this.alpha}get paused(){return this._paused}tick(t){if(!this._paused)return this.elapsedDuration=t.currentTime-this.startTime-this.pausedDuration,0===this.duration?this.alpha=1:this.alpha=tl(0,1,this.elapsedDuration/this.duration),this._tick(t),this.done&&this._resolveList.forEach((t=>t())),this.done}pause(t){t&&(this._hold=!0),-1===this.pausedTime&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(t){!t&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(t){let e;return e=this.done?Promise.resolve():new Promise((t=>this._resolveList.push(t))),e.then(t)}}class Yu extends Xu{constructor(t,e,...n){super(Aa(t,1/0),e,...n)}_init(t,e){Array.isArray(t)?this.axis=(new ue).fromArray(t):this.axis=Aa(t,new ue(0,1,0)),this.angle=Aa(e,.01)}_tick(t){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*t.lastDuration/16)}}class Ku extends Xu{constructor(t,e,...n){super(Aa(t,1/0),e,...n),this.angleSum=0,this.direction=1}_init(t,e,n){Array.isArray(t)?this.axis=(new ue).fromArray(t):this.axis=Aa(t,new ue(0,1,0)),this.angleStep=Aa(e,.01),this.angleEnd=Aa(n,.2)}_tick(t){if(!this.axis||!this.angleStep||!this.angleEnd)return;const e=tl(0,1,Math.abs(this.angleSum)/this.angleEnd),n=this.angleStep*this.direction*(1.1-e);this.controls.spin(this.axis,n*t.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class Zu extends Xu{_init(t,e){this.moveFrom=Va(Aa(t,new ue)),this.moveTo=Va(Aa(e,new ue))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class Qu extends Xu{_init(t,e){this.zoomFrom=t,this.zoomTo=e}_tick(){this.controls.distance(Qa(this.zoomFrom,this.zoomTo,this.alpha))}}class Ju extends Xu{constructor(){super(...arguments),this._currentRotation=new ce}_init(t,e){this.rotateFrom=Ga(t),this.rotateTo=Ga(e),this._currentRotation=new ce}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class th extends Xu{_init(t,e,n){this.valueFrom=t,this.valueTo=e,this.callback=n}_tick(){this.callback(Qa(this.valueFrom,this.valueTo,this.alpha))}}class eh extends Xu{_init(t){this.callback=t}_tick(){1===this.alpha&&this.callback()}}class nh{constructor(t=[]){this._resolveList=[],this._list=t}get done(){return this._list.every((t=>t.done))}then(t){let e;return e=this.done?Promise.resolve():new Promise((t=>{this._resolveList.push(t),this._list.forEach((t=>{t.then((()=>{this._resolveList.forEach((t=>{t()})),this._resolveList.length=0}))}))})),e.then(t)}}class ih{constructor(t){this.stage=t,this.animationList=[],this.finishedList=[],this.viewer=t.viewer,this.controls=t.viewerControls}get paused(){return this.animationList.every((t=>t.paused))}add(t){return 0===t.duration?t.tick(this.viewer.stats):this.animationList.push(t),t}remove(t){const e=this.animationList,n=e.indexOf(t);n>-1&&e.splice(n,1)}run(t){const e=this.finishedList,n=this.animationList,i=n.length;for(let r=0;r<i;++r){const i=n[r];i.tick(t)&&e.push(i)}const r=e.length;if(r){for(let t=0;t<r;++t)this.remove(e[t]);e.length=0}}spin(t,e,n){return this.add(new Yu(n,this.controls,t,e))}rock(t,e,n,i){return this.add(new Ku(i,this.controls,t,e,n))}rotate(t,e){const n=this.viewer.rotationGroup.quaternion.clone();return this.add(new Ju(e,this.controls,n,t))}move(t,e){const n=this.controls.position.clone().negate();return this.add(new Zu(e,this.controls,n,t))}zoom(t,e){const n=this.viewer.camera.position.z;return this.add(new Qu(e,this.controls,n,t))}zoomMove(t,e,n){return new nh([this.move(t,n),this.zoom(e,n)])}orient(t,e){const n=new ue,i=new ce,r=new ue;return Ha(t).decompose(n,i,r),new nh([this.move(n.negate(),e),this.rotate(i,e),this.zoom(-r.x,e)])}value(t,e,n,i){return this.add(new th(i,this.controls,t,e,n))}timeout(t,e){return this.add(new eh(e,this.controls,t))}spinComponent(t,e,n,i){return this.add(new Yu(i,t.controls,e,n))}rockComponent(t,e,n,i,r){return this.add(new Ku(r,t.controls,e,n,i))}moveComponent(t,e,n){const i=t.controls.position.clone().negate();return this.add(new Zu(n,t.controls,i,e))}pause(){this.animationList.forEach((t=>t.pause()))}resume(){this.animationList.forEach((t=>t.resume()))}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class rh{constructor(t,e){if(this.fn=t,this.queue=[],this.pending=!1,this.next=this.next.bind(this),e){for(let t=0,n=e.length;t<n;++t)this.queue.push(e[t]);this.next()}}run(t){this.fn(t,this.next)}next(){const t=this.queue.shift();void 0!==t?(this.pending=!0,setTimeout((()=>this.run(t)))):this.pending=!1}push(t){this.queue.push(t),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class sh{constructor(t,e,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:ic.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:ic.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=e,this.tasks=new kc,this.queue=new rh(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=ic.getSchemes()),this.toBePrepared=!1}init(t){const e=t||{};this.clipNear=Aa(e.clipNear,0),this.clipRadius=Aa(e.clipRadius,0),this.clipCenter=Aa(e.clipCenter,new ue),this.flatShaded=Aa(e.flatShaded,!1),this.side=Aa(e.side,"double"),this.opacity=Aa(e.opacity,1),this.depthWrite=Aa(e.depthWrite,!0),this.wireframe=Aa(e.wireframe,!1),this.setColor(e.color,e),this.colorData=Aa(e.colorData,void 0),this.colorScheme=Aa(e.colorScheme,"uniform"),this.colorScale=Aa(e.colorScale,""),this.colorReverse=Aa(e.colorReverse,!1),this.colorValue=Aa(e.colorValue,9474192),this.colorDomain=Aa(e.colorDomain,void 0),this.colorMode=Aa(e.colorMode,"hcl"),this.visible=Aa(e.visible,!0),this.quality=Aa(e.quality,void 0),this.roughness=Aa(e.roughness,.4),this.metalness=Aa(e.metalness,0),this.diffuse=Aa(e.diffuse,16777215),this.diffuseInterior=Aa(e.diffuseInterior,!1),this.useInteriorColor=Aa(e.useInteriorColor,!1),this.interiorColor=Aa(e.interiorColor,2236962),this.interiorDarkening=Aa(e.interiorDarkening,0),this.lazy=Aa(e.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=Aa(e.matrix,new ze),this.disablePicking=Aa(e.disablePicking,!1);const n=this.parameters;!0===n.sphereDetail&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),!0===n.radialSegments&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),!0===n.openEnded&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),!0===n.disableImpostor&&(n.disableImpostor={type:"boolean",rebuild:!0}),"low"===e.quality?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):"medium"===e.quality?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):"high"===e.quality?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=Aa(e.sphereDetail,1)),n.radialSegments&&(this.radialSegments=Aa(e.radialSegments,10))),n.openEnded&&(this.openEnded=Aa(e.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=Aa(e.disableImpostor,!1))}getColorParams(t){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},t)}getBufferParams(t={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},t)}setColor(t,e){const n=Object.keys(ic.getSchemes());if("string"==typeof t&&n.includes(t.toLowerCase()))e?e.colorScheme=t:this.setParameters({colorScheme:t});else if(void 0!==t){let n=new Pn(t).getHex();e?(e.colorScheme="uniform",e.colorValue=n):this.setParameters({colorScheme:"uniform",colorValue:n})}return this}prepare(t){}create(){}update(t){this.build()}build(t){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(t||!1)}else this.lazyProps.build=!0}make(t,e){Ql&&Yl.time("Representation.make "+this.type);const n=()=>{t?(this.update(t),this.viewer.requestRender(),this.tasks.decrement(),e&&e()):(this.clear(),this.create(),this.manualAttach||this.disposed||(Ql&&Yl.time("Representation.attach "+this.type),this.attach((()=>{Ql&&Yl.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),e&&e()})))),Ql&&Yl.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(n):n()}attach(t){this.setVisibility(this.visible),t()}setVisibility(t,e){if(this.visible=t,this.visible&&this.opacity){const t=this.lazyProps,e=t.bufferParams,n=t.what;if(t.build)return t.build=!1,this.build(),this;(Object.keys(e).length||Object.keys(n).length)&&(t.bufferParams={},t.what={},this.updateParameters(e,n))}return this.bufferList.forEach((function(e){e.setVisibility(t)})),e||this.viewer.requestRender(),this}setParameters(t,e={},n=!1){const i=t||{},r=this.parameters,s={};this.opacity||void 0===i.opacity||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(s,this.lazyProps.bufferParams),Object.assign(e,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(i.color,i);for(let t in i)void 0!==i[t]&&null!=r[t]&&(r[t].int&&(i[t]=parseInt(i[t])),r[t].float&&(i[t]=parseFloat(i[t])),i[t]!==this[t]||i[t].equals&&!i[t].equals(this[t]))&&(this[t]&&this[t].copy&&i[t].copy?this[t].copy(i[t]):this[t]&&this[t].set?this[t].set(i[t]):this[t]=i[t],r[t].buffer&&(!0===r[t].buffer?s[t]=i[t]:s[r[t].buffer]=i[t]),r[t].update&&(e[r[t].update]=!0),!r[t].rebuild||"impostor"===r[t].rebuild&&ql&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(s,e),this}updateParameters(t={},e){if(this.lazy&&(!this.visible||!this.opacity)&&!1===t.hasOwnProperty("opacity"))return Object.assign(this.lazyProps.bufferParams,t),void Object.assign(this.lazyProps.what,e);this.bufferList.forEach((function(e){e.setParameters(t)})),Object.keys(e).length&&this.update(e),this.viewer.requestRender()}getParameters(){const t={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach((e=>{null!==this.parameters[e]&&(t[e]=this[e])})),t}clear(){this.bufferList.forEach((t=>{this.viewer.remove(t),t.dispose()})),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class oh{constructor(t){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=t,this.blobUrl=window.URL.createObjectURL(nc.get(t)),this.worker=new Worker(this.blobUrl),nc.activeWorkerCount+=1,this.worker.onmessage=e=>{this.pending-=1;const n=e.data.__postId;Ql&&Yl.timeEnd("Worker.postMessage "+t+" #"+n);const i=this.onmessageDict[n];i&&i.call(this.worker,e),delete this.onmessageDict[n],delete this.onerrorDict[n]},this.worker.onerror=e=>{if(this.pending-=1,e.data){const n=e.data.__postId,i=this.onerrorDict[n];i?i.call(this.worker,e):Yl.error("Worker.onerror",n,t,e),delete this.onmessageDict[n],delete this.onerrorDict[n]}else Yl.error("Worker.onerror",t,e)}}post(t={},e,n,i){this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=i,t.__name=this.name,t.__postId=this.postCount,t.__debug=Ql,Ql&&Yl.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(t,e)}catch(e){Yl.error("worker.post:",e),this.worker.postMessage(t)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),nc.activeWorkerCount-=1):Yl.log("no worker to terminate")}}class ah{constructor(t,e=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,e),this.name=t}post(t={},e,n,i){const r=this.getNextWorker();return r?r.post(t,e,n,i):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach((function(t){t.terminate()}))}getNextWorker(){let t,e=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){t=new oh(this.name),this.pool.push(t),this.count+=1;break}const i=this.pool[n];if(0===i.pending){t=i;break}i.pending<e&&(e=i.pending,t=i)}return t}}function lh(t){const e=t.length,n=e/3;let i=0,r=0,s=0;for(let n=0;n<e;n+=3)i+=t[n+0],r+=t[n+1],s+=t[n+2];return new ue(i/n,r/n,s/n)}function ch(t,e,n){return n?t.sub(n).projectOnVector(e).add(n):t.projectOnVector(e),t}function uh(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>s&&(s=c),u>o&&(o=u)}return[fh([e,n,i]),fh([r,s,o])]}function hh(t,e){for(let n=0,i=e.length;n<i;n+=3){const i=e[n],r=e[n+1],s=e[n+2];e[n]=t[0]*i+t[4]*r+t[8]*s+t[12],e[n+1]=t[1]*i+t[5]*r+t[9]*s+t[13],e[n+2]=t[2]*i+t[6]*r+t[10]*s+t[14]}}function dh(t,e){for(let n=0,i=e.length;n<i;n+=3){const i=e[n],r=e[n+1],s=e[n+2];e[n]=t[0]*i+t[3]*r+t[6]*s,e[n+1]=t[1]*i+t[4]*r+t[7]*s,e[n+2]=t[2]*i+t[5]*r+t[8]*s}}function ph(t){for(let e=0,n=t.length;e<n;e+=3){const n=t[e],i=t[e+1],r=t[e+2],s=n*n+i*i+r*r;if(s>0){const o=1/Math.sqrt(s);t[e]=n*o,t[e+1]=i*o,t[e+2]=r*o}}}function fh(t){return new Float32Array(t||3)}function mh(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o}function gh(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _h(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2]}function vh(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2]}function yh(t,e,n=0){t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2]}function bh(t,e,n=0){e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2]}function xh(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function wh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function Sh(t,e,n){Ah(t,e,1/n)}function Ah(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}function Mh(t,e){const n=xh(e);0==n?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):Ah(t,e,1/Math.sqrt(n))}function Ch(t,e,n){t[0]=e[0]-n,t[1]=e[1]-n,t[2]=e[2]-n}function Eh(t,e,n){t[0]=e[0]+n,t[1]=e[1]+n,t[2]=e[2]+n}function Th(t,e){t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2])}function Ph(t,e){t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2])}function Ih(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2]}function Rh(t,e){const n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=i*a-r*o,c=r*s-n*a,u=n*o-i*s,h=Math.sqrt(l*l+c*c+u*u),d=n*s+i*o+r*a;return Math.atan2(h,d)}function kh(t,e=9){const n=Math.floor(e/2),i=t.position1.length/3,r=n*i*3,s=1/e,o=Gc(t.position1,t.position2),a=new Float32Array(r),l=new Float32Array(r),c=new ue;for(let e=0;e<i;++e){const i=3*e;c.set(o[i],o[i+1],o[i+2]);const r=t.position1[i],u=t.position1[i+1],h=t.position1[i+2];for(let t=0;t<n;++t){const e=n*i+3*t,o=s*(2*t+1),d=s*(2*t+2);a[e]=r+c.x*o,a[e+1]=u+c.y*o,a[e+2]=h+c.z*o,l[e]=r+c.x*d,l[e+1]=u+c.y*d,l[e+2]=h+c.z*d}}const u=Hc(a,l),h=function(t,e){const n=t.length/3,i=new Float32Array(n*e*3);for(let r=0;r<n;++r){const n=3*r,s=r*e*3,o=t[n+0],a=t[n+1],l=t[n+2];for(let t=0;t<e;++t){const e=s+3*t;i[e+0]=o,i[e+1]=a,i[e+2]=l}}return i}(t.color,n),d={position:u,position1:a,position2:l,color:h,color2:h};return t.radius&&(d.radius=Xc(t.radius,n)),t.picking&&t.picking.array&&(t.picking.array=Xc(t.picking.array,n),d.picking=t.picking),t.primitiveId&&(d.primitiveId=Xc(t.primitiveId,n)),d}function Dh(t,e=.1){const n=Gc(t.position1,t.position2),i=[],r=[],s=[],o=t.radius?[]:void 0,a=t.picking?[]:void 0,l=t.primitiveId?[]:void 0,c=new ue,u=t.position1.length/3;let h=0;for(let d=0;d<u;++d){const u=3*d;c.set(n[u],n[u+1],n[u+2]);const p=c.length()/e,f=Math.floor(p/2),m=1/p,g=t.position1[u],_=t.position1[u+1],v=t.position1[u+2];for(let e=0;e<f;++e){const n=3*h+3*e,p=m*(2*e+1),f=m*(2*e+2);i[n]=g+c.x*p,i[n+1]=_+c.y*p,i[n+2]=v+c.z*p,r[n]=g+c.x*f,r[n+1]=_+c.y*f,r[n+2]=v+c.z*f,t.color&&(s[n]=t.color[u],s[n+1]=t.color[u+1],s[n+2]=t.color[u+2]),o&&(o[h+e]=t.radius[d]),a&&(t.picking.array?a[h+e]=t.picking.array[d]:a[h+e]=d),l&&(l[h+e]=t.primitiveId[d])}h+=f}const d=new Float32Array(i),p=new Float32Array(r),f=Hc(d,p),m=new Float32Array(s),g={position:f,position1:d,position2:p,color:m,color2:m};return o&&(g.radius=new Float32Array(o)),a&&t.picking&&(t.picking.array=new Float32Array(a),g.picking=t.picking),l&&(g.primitiveId=new Float32Array(l)),g}function Lh(t,e=.1){const n=Gc(t.position1,t.position2),i=[],r=[],s=[],o=t.radius?[]:void 0,a=t.picking?[]:void 0,l=t.primitiveId?[]:void 0,c=new ue,u=t.position1.length/3;let h=e,d=!0,p=0,f=0,m=0;for(let g=0;g<u;++g){const u=3*g,_=t.position1[u],v=t.position1[u+1],y=t.position1[u+2];c.set(n[u],n[u+1],n[u+2]);const b=c.length();d&&(i[f]=_,i[f+1]=v,i[f+2]=y);let x=h;const w=1/b;for(;x<b;){const t=d?r:i;t[f]=_+c.x*x*w,t[f+1]=v+c.y*x*w,t[f+2]=y+c.z*x*w,d&&(p++,f=3*p),d=!d,h=e,x+=e}d&&(r[f]=t.position2[u],r[f+1]=t.position2[u+1],r[f+2]=t.position2[u+2],p++,f=3*p),h=x-b;for(let e=m;e<p;e++){if(t.color){const n=3*e;s[n]=t.color[u],s[n+1]=t.color[u+1],s[n+2]=t.color[u+2]}o&&(o[e]=t.radius[g]),a&&(t.picking.array?a[e]=t.picking.array[g]:a[e]=g),l&&(l[e]=t.primitiveId[g])}m=p}if(!d&&u>0){const e=3*p;r[e]=t.position2[3*u-3],r[e+1]=t.position2[3*u-2],r[e+1]=t.position2[3*u-1]}const g=new Float32Array(i),_=new Float32Array(r),v=Hc(g,_),y=new Float32Array(s),b={position:v,position1:g,position2:_,color:y,color2:y};return o&&(b.radius=new Float32Array(o)),a&&t.picking&&(t.picking.array=new Float32Array(a),b.picking=t.picking),l&&(b.primitiveId=new Float32Array(l)),b}ah.prototype.constructor=ah,uh.__deps=[fh],Sh.__deps=[Ah],Mh.__deps=[Ah,xh];const Oh=new ue;class Nh{static get Picker(){return hc.get(this.type)}static get Buffer(){return uc.get(this.type)}static getShapeKey(t){return this.type+t[0].toUpperCase()+t.substr(1)}static expandBoundingBox(t,e){}static valueToShape(t,e,n){const i=t._primitiveData[this.getShapeKey(e)];switch(this.fields[e]){case"v3":case"c":!function(t,e){void 0!==t.toArray?t=t.toArray():void 0!==t.x?t=[t.x,t.y,t.z]:void 0!==t.r&&(t=[t.r,t.g,t.b]),e.push.apply(e,t)}(n,i);break;default:i.push(n)}}static objectToShape(t,e){Object.keys(this.fields).forEach((n=>{this.valueToShape(t,n,e[n])})),this.valueToShape(t,"name",e.name),this.expandBoundingBox(t.boundingBox,e)}static valueFromShape(t,e,n){const i=t._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return(new ue).fromArray(i,3*e);case"c":return(new Pn).fromArray(i,3*e);default:return i[e]}}static objectFromShape(t,e){let n=this.valueFromShape(t,e,"name");void 0===n&&(n=`${this.type}: ${e} (${t.name})`);const i={shape:t,name:n};return Object.keys(this.fields).forEach((n=>{i[n]=this.valueFromShape(t,e,n)})),i}static arrayFromShape(t,e){const n=t._primitiveData[this.getShapeKey(e)];return"s"===this.fields[e]?n:new Float32Array(n)}static dataFromShape(t){const e={};return this.Picker&&(e.picking=new this.Picker(t)),Object.keys(this.fields).forEach((n=>{e[n]=this.arrayFromShape(t,n)})),e}static bufferFromShape(t,e){return new this.Buffer(this.dataFromShape(t),e)}}Nh.type="",Nh.fields={};class Fh extends Nh{static positionFromShape(t,e){return this.valueFromShape(t,e,"position")}static expandBoundingBox(t,e){t.expandByPoint(Oh.fromArray(e.position))}}Fh.type="sphere",Fh.fields={position:"v3",color:"c",radius:"f"};class Bh extends Nh{static positionFromShape(t,e){return this.valueFromShape(t,e,"position")}static expandBoundingBox(t,e){t.expandByPoint(Oh.fromArray(e.position))}}Bh.type="box",Bh.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class Uh extends Bh{}Uh.type="octahedron";class zh extends Bh{}zh.type="tetrahedron";class Vh extends Nh{static positionFromShape(t,e){const n=this.valueFromShape(t,e,"position1"),i=this.valueFromShape(t,e,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(t,e){t.expandByPoint(Oh.fromArray(e.position1)),t.expandByPoint(Oh.fromArray(e.position2))}static bufferFromShape(t,e={}){let n=this.dataFromShape(t);return"cylinder"===this.type&&e.dashedCylinder&&(n=Dh(n)),new this.Buffer(n,e)}}Vh.type="cylinder",Vh.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class Hh extends Vh{}Hh.type="arrow";class Gh extends Vh{}Gh.type="cone";class $h extends Fh{}$h.type="ellipsoid",$h.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class jh extends $h{}jh.type="torus";class Wh extends Nh{static positionFromShape(t,e){return this.valueFromShape(t,e,"position")}static expandBoundingBox(t,e){t.expandByPoint(Oh.fromArray(e.position))}}Wh.type="text",Wh.fields={position:"v3",color:"c",size:"f",text:"s"};class qh extends Nh{static positionFromShape(t,e){return this.valueFromShape(t,e,"position")}static expandBoundingBox(t,e){t.expandByPoint(Oh.fromArray(e.position))}}qh.type="point",qh.fields={position:"v3",color:"c"};class Xh extends Nh{static positionFromShape(t,e){const n=this.valueFromShape(t,e,"position1"),i=this.valueFromShape(t,e,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(t,e){t.expandByPoint(Oh.fromArray(e.position1)),t.expandByPoint(Oh.fromArray(e.position2))}}Xh.type="wideline",Xh.fields={position1:"v3",position2:"v3",color:"c"};class Yh{constructor(t,e){this.exp=3;const n=e||function(t){const{x:e,y:n,z:i}=t,r=new pe,s=e.length,{min:o,max:a}=r;for(let t=0;t<s;t++)o.x=Math.min(e[t],o.x),o.y=Math.min(n[t],o.y),o.z=Math.min(i[t],o.z),a.x=Math.max(e[t],a.x),a.y=Math.max(n[t],a.y),a.z=Math.max(i[t],a.z);return r}(t);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const i=this.boundX*this.boundY*this.boundZ,r=void 0!==t.count?t.count:t.x.length,s=t.x,o=t.y,a=t.z;let l=0;const c=new Uint32Array(i),u=new Int32Array(r);for(let t=0;t<r;++t){const e=s[t]-this.minX>>this.exp,n=o[t]-this.minY>>this.exp,i=a[t]-this.minZ>>this.exp,r=(e*this.boundY+n)*this.boundZ+i;1===(c[r]+=1)&&(l+=1),u[t]=r}const h=new Uint16Array(l);for(let t=0,e=0;t<i;++t){const n=c[t];n>0&&(c[t]=e+1,h[e]=n,e+=1)}const d=new Uint32Array(l);for(let t=1;t<l;++t)d[t]+=d[t-1]+h[t-1];const p=new Uint16Array(l),f=new Int32Array(r);for(let t=0;t<r;++t){const e=c[u[t]];if(e>0){const n=e-1;f[d[n]+p[n]]=t,p[n]+=1}}this.grid=c,this.bucketCount=h,this.bucketOffset=d,this.bucketArray=f,this.xArray=s,this.yArray=o,this.zArray=a}within(t,e,n,i){const r=[];return this.eachWithin(t,e,n,i,(t=>r.push(t))),r}eachWithin(t,e,n,i,r){const s=i*i,o=Math.max(0,t-i-this.minX>>this.exp),a=Math.max(0,e-i-this.minY>>this.exp),l=Math.max(0,n-i-this.minZ>>this.exp),c=Math.min(this.boundX,1+(t+i-this.minX>>this.exp)),u=Math.min(this.boundY,1+(e+i-this.minY>>this.exp)),h=Math.min(this.boundZ,1+(n+i-this.minZ>>this.exp));for(let i=o;i<c;++i)for(let o=a;o<u;++o)for(let a=l;a<h;++a){const l=(i*this.boundY+o)*this.boundZ+a,c=this.grid[l];if(c>0){const i=c-1,o=this.bucketOffset[i],a=o+this.bucketCount[i];for(let i=o;i<a;++i){const o=this.bucketArray[i],a=this.xArray[o]-t,l=this.yArray[o]-e,c=this.zArray[o]-n,u=a*a+l*l+c*c;u<=s&&r(o,u)}}}}}class Kh{constructor(t=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(t){this.length=t,this.count=0;for(let t=0,e=this._fields.length;t<e;++t){const[e,n,i]=this._fields[t];this._initField(e,n,i)}}_initField(t,e,n){this[t]=Fa(n,this.length*e)}addField(t,e,n){this._fields.push([t,e,n]),this._initField(t,e,n)}resize(t){this.length=Math.round(t||0),this.count=Math.min(this.count,this.length);for(let t=0,e=this._fields.length;t<e;++t){const e=this._fields[t][0],n=this._fields[t][1],i=this.length*n,r=new this[e].constructor(i);this[e].length>i?r.set(this[e].subarray(0,i)):r.set(this[e]),this[e]=r}}growIfFull(){if(this.count>=this.length){const t=Math.round(1.5*this.length);this.resize(Math.max(256,t))}}copyFrom(t,e,n,i){for(let r=0,s=this._fields.length;r<s;++r){const s=this._fields[r][0],o=this._fields[r][1],a=this[s],l=t[s];for(let t=0;t<i;++t){const i=o*(e+t),r=o*(n+t);for(let t=0;t<o;++t)a[i+t]=l[r+t]}}}copyWithin(t,e,n){for(let i=0,r=this._fields.length;i<r;++i){const r=this._fields[i][0],s=this._fields[i][1],o=this[r];for(let i=0;i<n;++i){const n=s*(t+i),r=s*(e+i);for(let t=0;t<s;++t)o[n+t]=o[r+t]}}}sort(t){Yl.time("Store.sort");const e=this,n=new this.constructor(1);!function i(r,s){if(r<s){let l=Math.floor((r+s)/2),c=r,u=s;do{for(;t(c,l)<0;)c+=1;for(;t(u,l)>0;)u-=1;c<=u&&(c===l?l=u:u===l&&(l=c),(o=c)!==(a=u)&&(n.copyFrom(e,0,o,1),e.copyWithin(o,a,1),e.copyFrom(n,a,0,1)),c+=1,u-=1)}while(c<=u);i(r,u),i(c,s)}var o,a}(0,this.count-1),Yl.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let t=0,e=this._fields.length;t<e;++t)delete this[this._fields[t][0]]}}class Zh extends Kh{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(t,e,n){this.growIfFull();const i=this.count;t<e?(this.index1[i]=t,this.index2[i]=e):(this.index2[i]=t,this.index1[i]=e),n&&(this.type[i]=n),this.count+=1}}function Qh(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}class Jh{constructor(t,e){this.length=t,this._words=new Uint32Array(t+32>>>5),!0===e&&this.setAll()}get(t){return!!(this._words[t>>>5]&1<<t)}set(t){this._words[t>>>5]|=1<<t}clear(t){this._words[t>>>5]&=~(1<<t)}flip(t){this._words[t>>>5]^=1<<t}_assignRange(t,e,n){if(e<t)return;const i=this._words,r=!0===n?4294967295:0,s=t>>>5,o=e>>>5;for(let t=s+1;t<o;++t)i[t]=r;const a=s<<5,l=o<<5;if(!0===n)if(e-t<32)for(let n=t,r=e+1;n<r;++n)i[n>>>5]|=1<<n;else{for(let e=t,n=a+32;e<n;++e)i[e>>>5]|=1<<e;for(let t=l,n=e+1;t<n;++t)i[t>>>5]|=1<<t}else if(e-t<32)for(let n=t,r=e+1;n<r;++n)i[n>>>5]&=~(1<<n);else{for(let e=t,n=a+32;e<n;++e)i[e>>>5]&=~(1<<e);for(let t=l,n=e+1;t<n;++t)i[t>>>5]&=~(1<<t)}return this}setRange(t,e){return this._assignRange(t,e,!0)}clearRange(t,e){return this._assignRange(t,e,!1)}setBits(...t){const e=this._words,n=t.length;for(let i=0;i<n;++i){const n=t[i];e[n>>>5]|=1<<n}return this}clearBits(...t){const e=this._words,n=t.length;for(let i=0;i<n;++i){const n=t[i];e[n>>>5]&=~(1<<n)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const t=this._words.length,e=this._words,n=32-this.length%32;for(let n=0;n<t-1;++n)e[n]=~e[n];return e[t-1]=~(e[t-1]<<n)>>>n,this}_isRangeValue(t,e,n){if(e<t)return;const i=this._words,r=!0===n?4294967295:0,s=t>>>5,o=e>>>5;for(let t=s+1;t<o;++t)if(i[t]!==r)return!1;if(e-t<32){for(let r=t,s=e+1;r<s;++r)if(!!(i[r>>>5]&1<<r)!==n)return!1}else{const r=o<<5;for(let e=t,r=32+(s<<5);e<r;++e)if(!!(i[e>>>5]&1<<e)!==n)return!1;for(let t=r,s=e+1;t<s;++t)if(!!(i[t>>>5]&1<<t)!==n)return!1}return!0}isRangeSet(t,e){return this._isRangeValue(t,e,!0)}isRangeClear(t,e){return this._isRangeValue(t,e,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...t){const e=this._words,n=t.length;for(let i=0;i<n;++i){const n=t[i];if(!(e[n>>>5]&1<<n))return!1}return!0}isClear(...t){const e=this._words,n=t.length;for(let i=0;i<n;++i){const n=t[i];if(e[n>>>5]&1<<n)return!1}return!0}isEqualTo(t){const e=this._words,n=t._words,i=Math.min(e.length,n.length);for(let t=0;t<i;++t)if(e[t]!==n[t])return!1;return!0}getSize(){const t=this._words.length,e=this._words;let n=0;for(let i=0;i<t;++i)n+=Qh(e[i]);return n}difference(t){const e=this._words,n=t._words,i=Math.min(e.length,n.length);for(let t=0;t<i;++t)e[t]=e[t]&~n[t];for(let t=e.length;t<i;++t)e[t]=0;return this}union(t){const e=this._words,n=t._words,i=Math.min(e.length,n.length);for(let t=0;t<i;++t)e[t]|=n[t];for(let t=e.length;t<i;++t)e[t]=0;return this}intersection(t){const e=this._words,n=t._words,i=Math.min(e.length,n.length);for(let t=0;t<i;++t)e[t]&=n[t];for(let t=e.length;t<i;++t)e[t]=0;return this}intersects(t){const e=this._words,n=t._words,i=Math.min(e.length,n.length);for(let t=0;t<i;++t)if(e[t]&n[t])return!0;return!1}getIntersectionSize(t){const e=this._words,n=t._words,i=Math.min(e.length,n.length);let r=0;for(let t=0;t<i;++t)r+=Qh(e[t]&n[t]);return r}makeIntersection(t){const e=this._words,n=t._words,i=Math.min(e.length,n.length),r=new Uint32Array(i),s=Object.create(Jh.prototype);s._words=r,s.length=Math.min(this.length,t.length);for(let t=0;t<i;++t)r[t]=e[t]&n[t];return s}forEach(t){const e=this._words.length,n=this._words;let i=0;for(let r=0;r<e;++r){let e=n[r];for(;0!==e;){const n=e&-e;t((r<<5)+Qh(n-1),i),e^=n,++i}}}toArray(){const t=this._words,e=new Array(this.getSize()),n=this._words.length;let i=0;for(let r=0;r<n;++r){let n=t[r];for(;0!==n;){const t=n&-n;e[i++]=(r<<5)+Qh(t-1),n^=t}}return e}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const t=this.toArray().join(",");return t?"@"+t:"NONE"}clone(){const t=Object.create(Jh.prototype);return t.length=this.length,t._words=new Uint32Array(this._words),t}}function td(t){const{edgeCount:e,nodeCount:n,nodeArray1:i,nodeArray2:r}=t,s=new Uint8Array(n),o=new Int32Array(n);for(let t=0;t<e;++t)s[i[t]]+=1,s[r[t]]+=1;for(let t=1;t<n;++t)o[t]+=o[t-1]+s[t-1];const a=2*e,l=new Int32Array(a);for(let t=0;t<a;++t)l[t]=-1;for(let t=0;t<e;++t){const e=i[t],n=r[t];let s=o[e];for(;-1!==l[s]&&s<a;)s+=1;l[s]=t;let c=o[n];for(;-1!==l[c]&&c<a;)c+=1;l[c]=t}return{countArray:s,offsetArray:o,indexArray:l}}function ed(t=0,e=0){return{type:t,group:e,x:0,y:0,z:0,atomSet:[]}}function nd(t,e){t.x+=e.x,t.y+=e.y,t.z+=e.z,t.atomSet.push(e.index)}function id(t,e){const n=e.atomSet.length;if(n>0){const{types:i,groups:r,centers:s,atomSets:o}=t;i.push(e.type),r.push(e.group),s.x.push(e.x/n),s.y.push(e.y/n),s.z.push(e.z/n),o.push(e.atomSet)}}const rd=0,sd=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],od=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],ad=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],ld=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],cd=["NON-POLYMER"].concat(["OTHER"],ld),ud=["h","g","i"],hd=["e","b"],dd=["s","t","l",""],pd={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},fd={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},md={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},gd={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},_d={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},vd={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},yd=[0,0,0],bd={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},xd=Object.keys(bd),wd=["A","C","T","G","U","I"],Sd=["DA","DC","DT","DG","DU","DI"],Ad=["A","G","I","DA","DG","DI"],Md=wd.concat(Sd),Cd=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],Ed=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],Td=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],Pd=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],Id=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],Rd={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};Rd[rd]={};const kd={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function Dd(t){switch(t){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const Ld=new Map([[2,qa(180)],[3,qa(120)],[4,qa(109.4721)],[6,qa(90)]]);function Od(t,e){let n=[];const i=new ue,r=new ue;return i.subVectors(e,t),t.eachBondedAtom((e=>{1!==e.number&&(r.subVectors(e,t),n.push(i.angleTo(r)))})),n}function Nd(t,e){const n=t.clone(),i=new ue;i.subVectors(e,t);const r=[new ue,new ue];let s=0;if(t.eachBondedAtom((e=>{s>1||1!==e.number&&(n.index=e.index,r[s++].subVectors(e,t))})),1===s&&n.eachBondedAtom((e=>{s>1||1!==e.number&&e.index!==t.index&&r[s++].subVectors(e,t)})),2!==s)return;const o=r[0].cross(r[1]);return Math.abs(Math.PI/2-o.angleTo(i))}function Fd(t){if(t["@valenceModel"])return t["@valenceModel"];const e=function(t,e){const n=t.structure,i=n.atomCount,r=new Int8Array(i),s=new Int8Array(i),o=new Int8Array(i),a=new Int8Array(i);return n.eachAtom((t=>{const n=t.index,[i,l,c,u]=function(t,e){const n=t.bondToElementCount(1);let i=t.formalCharge||0;const r="always"===e.assignCharge||"auto"===e.assignCharge&&0===i,s="always"===e.assignH||"auto"===e.assignH&&0===n,o=t.bondCount,a=function(t){let e=0;return t.eachBond((t=>e+=t.bondOrder)),e}(t),l=function(t){const e=t.structure.getBondProxy(),n=t.number,i=8===n||7===n;if(i&&4===t.bondCount)return!1;let r=!1;return t.eachBond((n=>{if(n.bondOrder>1)r=!0;else if(i){const i=n.getOtherAtom(t);i.eachBond((t=>{if(t.bondOrder>1){const e=i.number;if((15===e||16===e)&&8===t.getOtherAtom(i).number)return;r=!0}}),e)}})),r}(t),c=a-o>0;let u=0,h=8;switch(t.number){case 1:r&&(0===o?(i=1,h=0):1===o&&(i=0,h=1));break;case 6:r&&(i=0),s&&(u=Math.max(0,4-a-Math.abs(i))),h=Dd(o+u+Math.max(0,-i));break;case 7:if(r)if(s)if(l&&a<4)i=o-n==1&&a-n==2?1:0;else{let e=!1;t.eachBondedAtom((t=>{(16===t.number||t.isMetal())&&(e=!0)})),i=e?0:1}else i=a-3;s&&(u=Math.max(0,3-a+i)),h=Dd(l&&!c?o+u-i:o+u+1-i);break;case 8:r&&(s||(i=a-2),1===a&&t.eachBondedAtom((e=>{e.eachBond((n=>{const r=n.getOtherAtom(e);r.index!==t.index&&8===r.number&&2===n.bondOrder&&(i=-1)}))}))),s&&(u=Math.max(0,2-a+i)),h=Dd(l&&!c?o+u-i+1:o+u-i+2);break;case 16:r&&(s||(i=a<=3&&!t.bondToElementCount(8)?a-2:0)),s&&a<2&&(u=Math.max(0,2-a+i)),a<=3&&(h=Dd(o+u-i+2));break;case 9:case 17:case 35:case 53:case 85:r&&(i=a-1);break;case 3:case 11:case 19:case 37:case 55:case 87:r&&(i=1-a);break;case 4:case 12:case 20:case 38:case 56:case 88:r&&(i=2-a);break;default:console.warn("Requested charge, protonation for an unhandled element",t.element)}return[i,u,u+n,h]}(t,e);r[n]=i,s[n]=l,o[n]=c,a[n]=u})),{charge:r,implicitH:s,totalH:o,idealGeometry:a}}(t,{assignCharge:"auto",assignH:"auto"});return t["@valenceModel"]=e,e}function Bd(t){return 15===t.number&&t.bondToElementCount(8)===t.bondCount}const Ud=["ARG","HIS","LYS"],zd=["GLU","ASP"];function Vd(t,e){return 2===t&&1===e||1===t&&2===e}function Hd(t,e){return 3===t&&3===e}function Gd(t,e){return 3===t&&1===e||1===t&&3===e}function $d(t){return"HIS"===t.resname&&7==t.number&&t.isRing()}function jd(t,e){return 5===t&&4===e||4===t&&5===e}function Wd(t,e){return 9===t&&5===e||5===t&&9===e}const qd=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function Xd(t,e){return 12===t?11===e||12===e:13===t?10===e:void 0}const Yd=[17,35,53,85],Kd=[7,8,16],Zd=[6,7,15,16],Qd=qa(180),Jd=qa(120);function tp(t,e,n){return!np(t,e,n)&&(t.modelIndex!==e.modelIndex||t.altloc&&e.altloc&&t.altloc!==e.altloc)}const ep={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function np(t,e,n){return t.modelIndex===n&&e.modelIndex!==n||e.modelIndex===n&&t.modelIndex!==n}function ip(t,e,n){return!np(t,e,n)&&(t.modelIndex!==e.modelIndex||t.residueIndex===e.residueIndex||t.altloc&&e.altloc&&t.altloc!==e.altloc)}function rp(t){switch(t){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const sp={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},op=new Pn;class ap{constructor(t){this.array=t}get type(){return""}get data(){return{}}getIndex(t){return this.array?this.array[t]:t}getObject(t){return{}}_applyTransformations(t,e,n){return e&&t.applyMatrix4(e.matrix),n&&t.applyMatrix4(n.matrix),t}_getPosition(t){return new ue}getPosition(t,e,n){return this._applyTransformations(this._getPosition(t),e,n)}}class lp extends ap{constructor(t){super(),this.shape=t}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(t){return this.primitive.objectFromShape(this.shape,this.getIndex(t))}_getPosition(t){return this.primitive.positionFromShape(this.shape,this.getIndex(t))}}class cp extends ap{constructor(t,e){super(t),this.structure=e}get type(){return"atom"}get data(){return this.structure}getObject(t){return this.structure.getAtomProxy(this.getIndex(t))}_getPosition(t){return(new ue).copy(this.getObject(t))}}class up extends ap{constructor(t){super(),this.axes=t}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class hp extends ap{constructor(t,e,n){super(t),this.structure=e,this.bondStore=n||e.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(t){const e=this.structure.getBondProxy(this.getIndex(t));return e.bondStore=this.bondStore,e}_getPosition(t){const e=this.getObject(t);return(new ue).copy(e.atom1).add(e.atom2).multiplyScalar(.5)}}class dp extends ap{constructor(t,e,n){super(t),this.contacts=e,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(t){const e=this.getIndex(t),{features:n,contactStore:i}=this.contacts,{centers:r,atomSets:s}=n,{x:o,y:a,z:l}=r,{index1:c,index2:u,type:h}=i,d=c[e],p=u[e];return{center1:new ue(o[d],a[d],l[d]),center2:new ue(o[p],a[p],l[p]),atom1:this.structure.getAtomProxy(s[d][0]),atom2:this.structure.getAtomProxy(s[p][0]),type:rp(h[e])}}_getPosition(t){const{center1:e,center2:n}=this.getObject(t);return(new ue).addVectors(e,n).multiplyScalar(.5)}}class pp extends ap{constructor(t,e,n){super(t),this.validation=e,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(t){const e=this.validation,n=this.getIndex(t);return{validation:e,index:n,clash:e.clashArray[n]}}_getAtomProxyFromSele(t){const e=new Ll(t),n=this.structure.getAtomIndices(e)[0];return this.structure.getAtomProxy(n)}_getPosition(t){const e=this.getObject(t).clash,n=this._getAtomProxyFromSele(e.sele1),i=this._getAtomProxyFromSele(e.sele2);return(new ue).copy(n).add(i).multiplyScalar(.5)}}class fp extends hp{get type(){return"distance"}}class mp extends ap{get type(){return"ignore"}}class gp extends lp{constructor(t,e){super(t),this.mesh=e}get type(){return"mesh"}getObject(){const t=this.mesh;return{shape:this.shape,name:t.name,serial:t.serial}}_getPosition(){return this.__position||(this.__position=lh(this.mesh.position)),this.__position}}class _p extends ap{constructor(t,e){super(t),this.surface=e}get type(){return"surface"}get data(){return this.surface}getObject(t){return{surface:this.surface,index:this.getIndex(t)}}_getPosition(){return this.surface.center.clone()}}class vp extends ap{constructor(t,e){super(),this.unitcell=t,this.structure=e}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class yp extends ap{constructor(t,e){super(t),this.volume=e}get type(){return"volume"}get data(){return this.volume}getObject(t){const e=this.volume,n=this.getIndex(t);return{volume:e,index:n,value:e.data[n]}}_getPosition(t){const e=this.volume.position,n=this.getIndex(t);return new ue(e[3*n],e[3*n+1],e[3*n+2])}}class bp extends yp{get type(){return"slice"}}function xp(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function wp(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function Sp(t,e,n,i,r){var s,o,a,l,c,u,h,d=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],p=0,f=!1,m=!1,g=!1,_=!1,v=-1,y=e*n*i,b=e,x=e*n,w=new Int32Array(12),S=[],A=[],M=[],C=[],E=xp(),T=wp();function P(t,e,n){return t+(e-t)*n}function I(t,r,s){return x*(s=(s+h)%i)+b*(r=(r+u)%n)+(t+c)%e}function R(t,e,n,i,l,c,u){var h=3*t;if(o[h]<0){var d=(p-c)/(u-c),m=s,g=3*a;if(S[g]=n+d,S[g+1]=i,S[g+2]=l,!f){var _=3*t;A[g]=v*P(m[_],m[_+3],d),A[g+1]=v*P(m[_+1],m[_+4],d),A[g+2]=v*P(m[_+2],m[_+5],d)}r&&(C[a]=r[t+Math.round(d)]),o[h]=a,w[e]=a,a+=1}else w[e]=o[h]}function k(t,e,n,i,l,c,u){var h=3*t+1;if(o[h]<0){var d=(p-c)/(u-c),m=s,g=3*a;if(S[g]=n,S[g+1]=i+d,S[g+2]=l,!f){var _=3*t,y=_+3*b;A[g]=v*P(m[_],m[y],d),A[g+1]=v*P(m[_+1],m[y+1],d),A[g+2]=v*P(m[_+2],m[y+2],d)}r&&(C[a]=r[t+Math.round(d)*b]),o[h]=a,w[e]=a,a+=1}else w[e]=o[h]}function D(t,e,n,i,l,c,u){var h=3*t+2;if(o[h]<0){var d=(p-c)/(u-c),m=s,g=3*a;if(S[g]=n,S[g+1]=i,S[g+2]=l+d,!f){var _=3*t,y=_+3*x;A[g]=v*P(m[_],m[y],d),A[g+1]=v*P(m[_+1],m[y+1],d),A[g+2]=v*P(m[_+2],m[y+2],d)}r&&(C[a]=r[t+Math.round(d)*x]),o[h]=a,w[e]=a,a+=1}else w[e]=o[h]}function L(e){var n=3*e;0===s[n]&&(s[n]=t[(e-1+y)%y]-t[(e+1)%y],s[n+1]=t[(e-b+y)%y]-t[(e+b)%y],s[n+2]=t[(e-x+y)%y]-t[(e+x)%y])}function O(e,n,i,r,s){var o,a,c,u,h,v,y;g?(r=I(e,n,i),o=I(e+1,n,i),a=I(e,n+1,i),c=I(e,n,i+1),u=I(e+1,n+1,i),h=I(e+1,n,i+1),v=I(e,n+1,i+1),y=I(e+1,n+1,i+1)):(o=r+1,u=(a=r+b)+1,h=(c=r+x)+1,y=(v=a+x)+1);var S=0,A=t[r],C=t[o],P=t[a],O=t[u],N=t[c],F=t[h],B=t[v],U=t[y];A<p&&(S|=1),C<p&&(S|=2),P<p&&(S|=8),O<p&&(S|=4),N<p&&(S|=16),F<p&&(S|=32),B<p&&(S|=128),U<p&&(S|=64);var z=E[S];if(0===z)return 0;var V=e+1,H=n+1,G=i+1;1&z&&(f||(L(r),L(o)),R(r,0,e,n,i,A,C)),2&z&&(f||(L(o),L(u)),k(o,1,V,n,i,C,O)),4&z&&(f||(L(a),L(u)),R(a,2,e,H,i,P,O)),8&z&&(f||(L(r),L(a)),k(r,3,e,n,i,A,P)),16&z&&(f||(L(c),L(h)),R(c,4,e,n,G,N,F)),32&z&&(f||(L(h),L(y)),k(h,5,V,n,G,F,U)),64&z&&(f||(L(v),L(y)),R(v,6,e,H,G,B,U)),128&z&&(f||(L(c),L(v)),k(c,7,e,n,G,N,B)),256&z&&(f||(L(r),L(c)),D(r,8,e,n,i,A,N)),512&z&&(f||(L(o),L(h)),D(o,9,V,n,i,C,F)),1024&z&&(f||(L(u),L(y)),D(u,10,V,H,i,O,U)),2048&z&&(f||(L(a),L(v)),D(a,11,e,H,i,P,B));for(var $,j,W,q=S<<4,X=0;-1!==T[q+X];)$=T[q+X],j=T[q+X+1],W=T[q+X+2],m?(d[$][j]&s&&(M[l++]=w[$],M[l++]=w[j]),d[j][W]&s&&(M[l++]=w[j],M[l++]=w[W]),d[$][W]&s&&(M[l++]=w[$],M[l++]=w[W])):(M[l++]=w[_?$:j],M[l++]=w[_?j:$],M[l++]=w[W]),X+=3}function N(r,s,a,l,c,u){let h,d,m,_,v,y,w,S,A,M,C,E,T;if(r=void 0!==r?r:0,s=void 0!==s?s:0,a=void 0!==a?a:0,l=void 0!==l?l:e-1,c=void 0!==c?c:n-1,u=void 0!==u?u:i-1,g||(f?(r=Math.max(0,r),s=Math.max(0,s),a=Math.max(0,a),l=Math.min(e-1,l),c=Math.min(n-1,c),u=Math.min(i-1,u)):(r=Math.max(1,r),s=Math.max(1,s),a=Math.max(1,a),l=Math.min(e-2,l),c=Math.min(n-2,c),u=Math.min(i-2,u))),g)for(S=r-2,A=s-2,M=a-2,C=l+2,E=c+2,T=u+2,v=M;v<T;++v)for(_=A;_<E;++_)for(m=S;m<C;++m)d=3*I(m,_,v),o[d]=-1,o[d+1]=-1,o[d+2]=-1;else for(S=Math.max(0,r-2),A=Math.max(0,s-2),M=Math.max(0,a-2),C=Math.min(e,l+2),E=Math.min(n,c+2),T=Math.min(i,u+2),v=M;v<T;++v)for(w=x*v,_=A;_<E;++_)for(y=w+b*_,m=S;m<C;++m)h=3*(y+m),o[h]=-1,o[h+1]=-1,o[h+2]=-1;if(!g){var P,R=r,k=s,D=a,L=l,N=c,F=u;for(P=!1,v=a;v<u;++v){for(_=s;_<c;++_){for(m=r;m<l;++m)if(h=e*n*v+e*_+m,t[h]>=p){D=v,P=!0;break}if(P)break}if(P)break}for(P=!1,_=s;_<c;++_){for(v=D;v<u;++v){for(m=r;m<l;++m)if(h=e*n*v+e*_+m,t[h]>=p){k=_,P=!0;break}if(P)break}if(P)break}for(P=!1,m=r;m<l;++m){for(_=k;_<c;++_){for(v=D;v<u;++v)if(h=e*n*v+e*_+m,t[h]>=p){R=m,P=!0;break}if(P)break}if(P)break}for(P=!1,v=u;v>=a;--v){for(_=c;_>=s;--_){for(m=l;m>=r;--m)if(h=e*n*v+e*_+m,t[h]>=p){F=v,P=!0;break}if(P)break}if(P)break}for(P=!1,_=c;_>=s;--_){for(v=F;v>=a;--v){for(m=l;m>=r;--m)if(h=e*n*v+e*_+m,t[h]>=p){N=_,P=!0;break}if(P)break}if(P)break}for(P=!1,m=l;m>=r;--m){for(_=N;_>=s;--_){for(v=F;v>=a;--v)if(h=e*n*v+e*_+m,t[h]>=p){L=m,P=!0;break}if(P)break}if(P)break}f?(r=Math.max(0,R-1),s=Math.max(0,k-1),a=Math.max(0,D-1),l=Math.min(e-1,L+1),c=Math.min(n-1,N+1),u=Math.min(i-1,F+1)):(r=Math.max(1,R-1),s=Math.max(1,k-1),a=Math.max(1,D-1),l=Math.min(e-2,L+1),c=Math.min(n-2,N+1),u=Math.min(i-2,F+1))}var B=15;for(v=a;v<u;++v,B&=-5)for(w=x*v,B|=2,_=s;_<c;++_,B&=-3)for(y=w+b*_,B|=1,m=r;m<l;++m,B&=-2)h=y+m,O(m,_,v,h,B)}this.triangulate=function(t,d,b,x,w){_=(p=t)<0,m=x,g=w,(f=d||m)||(v=p>0?-1:1,s||(s=new Float32Array(3*y)));var E=3*y;if(o&&o.length===E||(o=new Int32Array(E)),a=0,l=0,void 0!==b){var T=b[0].map(Math.round),P=b[1].map(Math.round);c=e*Math.ceil(Math.abs(T[0])/e),u=n*Math.ceil(Math.abs(T[1])/n),h=i*Math.ceil(Math.abs(T[2])/i),N(T[0],T[1],T[2],P[0],P[1],P[2])}else c=u=h=0,N();return S.length=3*a,f||(A.length=3*a),M.length=l,r&&(C.length=a),{position:new Float32Array(S),normal:f?void 0:new Float32Array(A),index:Ba(M,S.length/3),atomindex:r?new Int32Array(C):void 0,contour:m}}}hc.add("arrow",class extends lp{get primitive(){return Hh}}),hc.add("box",class extends lp{get primitive(){return Bh}}),hc.add("cone",class extends lp{get primitive(){return Gh}}),hc.add("cylinder",class extends lp{get primitive(){return Vh}}),hc.add("ellipsoid",class extends lp{get primitive(){return $h}}),hc.add("octahedron",class extends lp{get primitive(){return Uh}}),hc.add("sphere",class extends lp{get primitive(){return Fh}}),hc.add("tetrahedron",class extends lp{get primitive(){return zh}}),hc.add("torus",class extends lp{get primitive(){return jh}}),hc.add("point",class extends lp{get primitive(){return qh}}),hc.add("wideline",class extends lp{get primitive(){return Xh}}),Object.assign(Sp,{__deps:[xp,wp,Ba]});class Ap{constructor(t,e){this.cols=t,this.rows=e,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(t){t.data.set(this.data)}}function Mp(t,e){let n=0,i=0;const r=e.rows,s=e.cols;let o=0,a=0,l=0;const c=e.data,u=t.data;for(;n<r;a+=1,o+=s,n++)for(l=a,i=0;i<s;l+=r,i++)u[l]=c[o+i]}function Cp(t,e,n){let i=0,r=0,s=0,o=0,a=0,l=0,c=0;const u=e.cols,h=e.rows,d=n.rows,p=e.data,f=n.data,m=t.data;let g=0;for(;i<h;o+=u,i++)for(l=0,r=0;r<d;c++,r++){for(a=o,g=0,s=0;s<u;a++,l++,s++)g+=p[a]*f[l];m[c]=g}}function Ep(t,e,n){const i=t.data,r=e.data,s=n.data,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],p=r[7],f=r[8],m=s[0],g=s[1],_=s[2],v=s[3],y=s[4],b=s[5],x=s[6],w=s[7],S=s[8];i[0]=o*m+a*v+l*x,i[1]=o*g+a*y+l*w,i[2]=o*_+a*b+l*S,i[3]=c*m+u*v+h*x,i[4]=c*g+u*y+h*w,i[5]=c*_+u*b+h*S,i[6]=d*m+p*v+f*x,i[7]=d*g+p*y+f*w,i[8]=d*_+p*b+f*S}function Tp(t){const e=t.rows,n=t.cols,i=t.data,r=new Array(n);for(let t=0;t<n;++t)r[t]=0;for(let t=0,s=0;t<e;++t)for(let t=0;t<n;++t,++s)r[t]+=i[s];for(let t=0;t<n;++t)r[t]/=e;return r}function Pp(t,e){const n=t.rows,i=t.cols,r=t.data;for(let t=0,s=0;t<n;++t)for(let t=0;t<i;++t,++s)r[s]-=e[t]}function Ip(t,e,n,i){i=t[e],t[e]=t[n],t[n]=i}function Rp(t,e){return(t=Math.abs(t))>(e=Math.abs(e))?(e/=t,t*Math.sqrt(1+e*e)):e>0?(t/=e,e*Math.sqrt(1+t*t)):0}function kp(t,e,n,i){let r=0,s=0;const o=t.rows,a=t.cols;let l=o,c=a;l<c&&(r=1,s=l,l=c,c=s);const u=new Ap(l,l),h=new Ap(1,c),d=new Ap(c,c);if(0===r)Mp(u,t);else{for(s=0;s<a*o;s++)u.data[s]=t.data[s];for(;s<c*l;s++)u.data[s]=0}if(function(t,e,n,i,r,s,o,a){let l=0,c=0,u=0,h=0;const d=Math.max(s,30);let p=0,f=0,m=0,g=0,_=0,v=0,y=0,b=0,x=0,w=0,S=0,A=0,M=0,C=0,E=0,T=0,P=0,I=4660,R=0,k=0,D=0;const L=new Float64Array(o<<3);for(;l<o;l++){for(u=0,S=0;u<s;u++)b=t[l*e+u],S+=b*b;if(L[l]=S,i){for(u=0;u<o;u++)i[l*r+u]=0;i[l*r+l]=1}}for(;h<d;h++){for(_=0,l=0;l<o-1;l++)for(c=l+1;c<o;c++){for(p=l*e|0,f=c*e|0,E=L[l],T=0,P=L[c],u=2,T+=t[p]*t[f],T+=t[p+1]*t[f+1];u<s;u++)T+=t[p+u]*t[f+u];if(!(Math.abs(T)<=2.384185792e-7*Math.sqrt(E*P))){for(T*=2,A=E-P,M=Rp(T,A),A<0?(C=.5*(M-A),y=Math.sqrt(C/M),v=T/(M*y*2)):(v=Math.sqrt((M+A)/(2*M)),y=T/(M*v*2)),E=0,P=0,u=2,x=v*t[p]+y*t[f],w=-y*t[p]+v*t[f],t[p]=x,t[f]=w,E+=x*x,P+=w*w,x=v*t[p+1]+y*t[f+1],w=-y*t[p+1]+v*t[f+1],t[p+1]=x,t[f+1]=w,E+=x*x,P+=w*w;u<s;u++)x=v*t[p+u]+y*t[f+u],w=-y*t[p+u]+v*t[f+u],t[p+u]=x,t[f+u]=w,E+=x*x,P+=w*w;if(L[l]=E,L[c]=P,_=1,i)for(m=l*r|0,g=c*r|0,u=2,x=v*i[m]+y*i[g],w=-y*i[m]+v*i[g],i[m]=x,i[g]=w,x=v*i[m+1]+y*i[g+1],w=-y*i[m+1]+v*i[g+1],i[m+1]=x,i[g+1]=w;u<o;u++)x=v*i[m+u]+y*i[g+u],w=-y*i[m+u]+v*i[g+u],i[m+u]=x,i[g+u]=w}}if(0===_)break}for(l=0;l<o;l++){for(u=0,S=0;u<s;u++)b=t[l*e+u],S+=b*b;L[l]=Math.sqrt(S)}for(l=0;l<o-1;l++){for(c=l,u=l+1;u<o;u++)L[c]<L[u]&&(c=u);if(l!==c&&(Ip(L,l,c,S),i)){for(u=0;u<s;u++)Ip(t,l*e+u,c*e+u,b);for(u=0;u<o;u++)Ip(i,l*r+u,c*r+u,b)}}for(l=0;l<o;l++)n[l]=L[l];if(i)for(l=0;l<a;l++){for(S=l<o?L[l]:0;S<=1e-37;){for(k=1/s,u=0;u<s;u++)I=214013*I+2531011,R=256&I>>16?k:-k,t[l*e+u]=R;for(h=0;h<2;h++)for(c=0;c<l;c++){for(S=0,u=0;u<s;u++)S+=t[l*e+u]*t[c*e+u];for(D=0,u=0;u<s;u++)b=t[l*e+u]-S*t[c*e+u],t[l*e+u]=b,D+=Math.abs(b);for(D=D?1/D:0,u=0;u<s;u++)t[l*e+u]*=D}for(S=0,u=0;u<s;u++)b=t[l*e+u],S+=b*b;S=Math.sqrt(S)}for(y=1/S,u=0;u<s;u++)t[l*e+u]*=y}}(u.data,l,h.data,d.data,c,l,c,l),e){for(s=0;s<c;s++)e.data[s]=h.data[s];for(;s<a;s++)e.data[s]=0}0===r?(n&&Mp(n,u),i&&Mp(i,d)):(n&&Mp(n,d),i&&Mp(i,u))}function Dp(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Lp(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g){t[0]=e,t[4]=n,t[8]=i,t[12]=r,t[1]=s,t[5]=o,t[9]=a,t[13]=l,t[2]=c,t[6]=u,t[10]=h,t[14]=d,t[3]=p,t[7]=f,t[11]=m,t[15]=g}function Op(t,e,n){const i=e[0],r=e[4],s=e[8],o=e[12],a=e[1],l=e[5],c=e[9],u=e[13],h=e[2],d=e[6],p=e[10],f=e[14],m=e[3],g=e[7],_=e[11],v=e[15],y=n[0],b=n[4],x=n[8],w=n[12],S=n[1],A=n[5],M=n[9],C=n[13],E=n[2],T=n[6],P=n[10],I=n[14],R=n[3],k=n[7],D=n[11],L=n[15];t[0]=i*y+r*S+s*E+o*R,t[4]=i*b+r*A+s*T+o*k,t[8]=i*x+r*M+s*P+o*D,t[12]=i*w+r*C+s*I+o*L,t[1]=a*y+l*S+c*E+u*R,t[5]=a*b+l*A+c*T+u*k,t[9]=a*x+l*M+c*P+u*D,t[13]=a*w+l*C+c*I+u*L,t[2]=h*y+d*S+p*E+f*R,t[6]=h*b+d*A+p*T+f*k,t[10]=h*x+d*M+p*P+f*D,t[14]=h*w+d*C+p*I+f*L,t[3]=m*y+g*S+_*E+v*R,t[7]=m*b+g*A+_*T+v*k,t[11]=m*x+g*M+_*P+v*D,t[15]=m*w+g*C+_*I+v*L}function Np(t,e,n,i){Lp(t,e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1)}function Fp(t,e,n,i){Lp(t,1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1)}function Bp(t,e){const n=Math.cos(e),i=Math.sin(e);Lp(t,n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1)}function Up(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function zp(t,e){const n=fh([e[0],e[1],e[2]]),i=fh([e[4],e[5],e[6]]),r=fh([e[8],e[9],e[10]]),s=fh();mh(s,i,r),t[0]=s[0],t[1]=s[1],t[2]=s[2],mh(s,r,n),t[3]=s[0],t[4]=s[1],t[5]=s[2],mh(s,n,i),t[6]=s[0],t[7]=s[1],t[8]=s[2]}function Vp(t,e,n,i){n=n||1,i=i||!0;const r=t.length/3,s=e.length/3;let o;i&&(o=new Float32Array(3*r));const a=new Float32Array(3*r);let l;const c=new Array(20);for(l=0;l<20;++l)c[l]=new Uint32Array(r);for(l=0;l<r;++l)c[0][l]=0;let u,h,d;for(l=0;l<s;++l){var p=3*l,f=3*l+1,m=3*l+2;for(d=!0,u=0,h=c[0][e[p]];u<h;++u)if(e[f]===c[u+1][e[p]]){d=!1;break}for(d&&(c[0][e[p]]++,c[c[0][e[p]]][e[p]]=e[f]),d=!0,u=0,h=c[0][e[p]];u<h;++u)if(e[m]===c[u+1][e[p]]){d=!1;break}for(d&&(c[0][e[p]]++,c[c[0][e[p]]][e[p]]=e[m]),d=!0,u=0,h=c[0][e[f]];u<h;++u)if(e[p]===c[u+1][e[f]]){d=!1;break}for(d&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[p]),d=!0,u=0,h=c[0][e[f]];u<h;++u)if(e[m]===c[u+1][e[f]]){d=!1;break}for(d&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[m]),d=!0,u=0;u<c[0][e[m]];++u)if(e[p]===c[u+1][e[m]]){d=!1;break}for(d&&(c[0][e[m]]++,c[c[0][e[m]]][e[m]]=e[p]),d=!0,u=0,h=c[0][e[m]];u<h;++u)if(e[f]===c[u+1][e[m]]){d=!1;break}d&&(c[0][e[m]]++,c[c[0][e[m]]][e[m]]=e[f])}for(var g,_,v,y,b,x=.5,w=.75/4.5,S=0;S<n;++S){for(l=0;l<r;++l)if(g=3*l,(v=c[0][l])<3)a[g]=t[g],a[g+1]=t[g+1],a[g+2]=t[g+2];else if(3===v||4===v){for(a[g]=0,a[g+1]=0,a[g+2]=0,u=0;u<v;++u)_=3*c[u+1][l],a[g]+=t[_],a[g+1]+=t[_+1],a[g+2]+=t[_+2];a[g]+=x*t[g],a[g+1]+=x*t[g+1],a[g+2]+=x*t[g+2],b=x+v,a[g]/=b,a[g+1]/=b,a[g+2]/=b}else{for(a[g]=0,a[g+1]=0,a[g+2]=0,u=0;u<v;++u)_=3*c[u+1][l],a[g]+=t[_],a[g+1]+=t[_+1],a[g+2]+=t[_+2];a[g]+=1*t[g],a[g+1]+=1*t[g+1],a[g+2]+=1*t[g+2],y=1+v,a[g]/=y,a[g+1]/=y,a[g+2]/=y}if(t.set(a),i){Hp(t,e,o);var A=3*r;for(g=0;g<A;g+=3)t[g]+=-1*w*o[g],t[g+1]+=-1*w*o[g+1],t[g+2]+=-1*w*o[g+2]}}}function Hp(t,e,n){var i,r;if(void 0===n)n=new Float32Array(t.length);else for(i=0,r=n.length;i<r;i++)n[i]=0;var s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);if(e)for(i=0,r=e.length;i<r;i+=3){var u=3*e[i],h=3*e[i+1],d=3*e[i+2];yh(s,t,u),yh(o,t,h),yh(a,t,d),_h(l,a,o),_h(c,s,o),mh(l,l,c),n[u]+=l[0],n[u+1]+=l[1],n[u+2]+=l[2],n[h]+=l[0],n[h+1]+=l[1],n[h+2]+=l[2],n[d]+=l[0],n[d+1]+=l[1],n[d+2]+=l[2]}else for(i=0,r=t.length;i<r;i+=9)yh(s,t,i),yh(o,t,i+3),yh(a,t,i+6),_h(l,a,o),_h(c,s,o),mh(l,l,c),n[i]=l[0],n[i+1]=l[1],n[i+2]=l[2],n[i+3]=l[0],n[i+4]=l[1],n[i+5]=l[2],n[i+6]=l[0],n[i+7]=l[1],n[i+8]=l[2];return ph(n),n}function Gp(t){for(var e={},n=0,i=t.length;n<i;++n)e[t[n]]=!0;return e}function $p(t,e,n,i,r){var s=1/i*3;Ch(t,t,r+(s+=n)),Eh(e,e,r+s),Ah(t,t,i),Th(t,t),Sh(t,t,i),Ah(e,e,i),Ph(e,e),Sh(e,e,i);var o=new Float32Array(3);_h(o,e,t),Ah(o,o,i),Ph(o,o),Eh(o,o,1);var a=256*Math.pow(10,6),l=o[0]*o[1]*o[2]*3;a<=l&&(Ah(t,t,i*=Math.pow(a/l,1/3)),Th(t,t),Sh(t,t,i),Ah(e,e,i),Ph(e,e),Sh(e,e,i),_h(o,e,t),Ah(o,o,i),Ph(o,o),Eh(o,o,1));var c=new Float32Array(t);Ih(c,c);var u=Dp(),h=Dp();Bp(h,qa(90)),Op(u,u,h);var d=Dp();Np(d,-1/i,1/i,1/i),Op(u,u,d);var p=Dp();return Fp(p,-i*c[2],-i*c[1],-i*c[0]),Op(u,u,p),{dim:o,tran:c,matrix:u,scaleFactor:i}}Np.__deps=[Lp],Fp.__deps=[Lp],Bp.__deps=[Lp],zp.__deps=[fh,mh],Object.assign(Vp,{__deps:[Hp]}),Object.assign(Hp,{__deps:[_h,mh,yh,ph]}),Object.assign($p,{__deps:[qa,Ch,Eh,Sh,Ah,Th,Ph,_h,Ih,Dp,Op,Fp,Np,Bp]});class jp{constructor(t,e,n){this.name=t||"",this.path=e||"",this.info={},this.center=new ue,this.boundingBox=new pe,n instanceof qn||n instanceof ro?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(t,e,n,i,r,s=!1){this.position=t,this.index=e,this.normal=n,this.color=i,this.atomindex=r,this.size=t.length/3,this.contour=s}fromGeometry(t){let e,n,i,r;if(Ql&&Yl.time("GeometrySurface.fromGeometry"),e=t instanceof qn?t:t[0],e.boundingBox||e.computeBoundingBox(),this.boundingBox.copy(e.boundingBox),this.boundingBox.getCenter(this.center),e instanceof qn){const t=e.attributes,s=!!t.normal&&t.normal.array;(!s||0===s[0]&&0===s[1]&&0===s[2])&&e.computeVertexNormals(),n=t.position.array,i=t.index?t.index.array:null,r=t.normal.array}this.set(n,i,r,void 0,void 0),Ql&&Yl.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(t){const e=t||{};e.surface=this;const n=this.size,i=new Float32Array(3*n),r=ic.getScheme(e);if(r.volumeColor||"random"===e.scheme)for(let t=0;t<n;++t)r.volumeColorToArray(t,i,3*t);else if(r.positionColor){const t=new ue,e=this.position;for(let o=0;o<n;++o){var s=3*o;t.set(e[s],e[s+1],e[s+2]),r.positionColorToArray(t,i,s)}}else if(r.atomColor&&this.atomindex){const t=e.structure.getAtomProxy(),s=this.atomindex;for(let e=0;e<n;++e)t.index=s[e],r.atomColorToArray(t,i,3*e)}else{const t=new Pn(e.value);jc(n,t.r,t.g,t.b,i)}return i}getPicking(t){return this.atomindex&&t?new cp(this.atomindex,t):new _p(Wc(this.size),this)}getNormal(){return this.normal}getSize(t,e){return $c(this.size,t*e)}getIndex(){return this.index}getFilteredIndex(t,e){if(t&&this.atomindex){const n=new Ll(t),i=e.getAtomSet(n),r=[],s=this.atomindex,o=this.index,a=o.length,l=this.contour?2:3;let c=0;for(let t=0;t<a;t+=l){let e=!0;for(let n=0;n<l;n++){const r=s[o[t+n]];if(!i.get(r)){e=!1;break}}if(e)for(let e=0;e<l;e++,c++)r[c]=o[t+e]}return Ba(r,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function Wp(t,e,n,i,r){var s=new Sp(t,e,n,i,r);this.getSurface=function(t,e,n,i,r,o=!1){const a=s.triangulate(t,e,n,r,o);if(e&&!r&&(Vp(a.position,a.index,e,!0),a.normal=Hp(a.position,a.index)),i&&(hh(i,a.position),a.normal)){const t=Up();zp(t,i),dh(t,a.normal)}return a}}Object.assign(Wp,{__deps:[Vp,Hp,Sp,hh,dh,Up,zp]}),nc.add("surf",(function(t,e){const n=t.data.args,i=t.data.params;if(n&&(self.volsurf=new Wp(n[0],n[1],n[2],n[3],n[4])),i){const t=self.volsurf.getSurface(i.isolevel,i.smooth,i.box,i.matrix,i.contour,i.wrap),n=[t.position.buffer,t.index.buffer];t.normal&&n.push(t.normal.buffer),t.atomindex&&n.push(t.atomindex.buffer),e({sd:t,p:i},n)}}),[Wp]);class qp{constructor(t,e,n,i,r,s,o){this.name=t,this.path=e,this.matrix=new ze,this.normalMatrix=new Ft,this.inverseMatrix=new ze,this.center=new ue,this.boundingBox=new pe,this.setData(n,i,r,s,o)}get type(){return"Volume"}setData(t,e,n,i,r){this.nx=e||1,this.ny=n||1,this.nz=i||1,this.data=t||new Float32Array(1),this.setAtomindex(r),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(t,e,n,i){this._min=t,this._max=e,this._mean=n,this._rms=i}setMatrix(t){this.matrix.copy(t);const e=this.boundingBox,n=this.center,i=this.nx-1,r=this.ny-1,s=this.nz-1;e.makeEmpty(),e.expandByPoint(n.set(i,r,s)),e.expandByPoint(n.set(i,r,0)),e.expandByPoint(n.set(i,0,s)),e.expandByPoint(n.set(i,0,0)),e.expandByPoint(n.set(0,r,s)),e.expandByPoint(n.set(0,0,s)),e.expandByPoint(n.set(0,r,0)),e.expandByPoint(n.set(0,0,0)),e.applyMatrix4(this.matrix),e.getCenter(this.center);const o=this.matrix.elements,a=new ue(o[0],o[1],o[2]),l=new ue(o[4],o[5],o[6]),c=new ue(o[8],o[9],o[10]),u=new ue,h=this.normalMatrix.elements;u.crossVectors(l,c),h[0]=u.x,h[1]=u.y,h[2]=u.z,u.crossVectors(c,a),h[3]=u.x,h[4]=u.y,h[5]=u.z,u.crossVectors(a,l),h[6]=u.x,h[7]=u.y,h[8]=u.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(t){this.atomindex=t}getBox(t,e,n){return n||(n=new pe),n.set(t,t),n.expandByScalar(e),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(t,e){if(!t||!e)return;this.__box||(this.__box=new pe);const n=this.getBox(t,e,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(t,e,n){const i=this.name+"@"+e.toPrecision(2),r=new jp(i,"",t);return r.info.isolevel=e,r.info.smooth=n,r.info.volume=this,r}getSurface(t,e,n,i,r,s=!1){t=isNaN(t)?this.getValueForSigma(2):t,e=Aa(e,0),void 0===this.volsurf&&(this.volsurf=new Wp(this.data,this.nx,this.ny,this.nz,this.atomindex));const o=this._getBox(n,i),a=this.volsurf.getSurface(t,e,o,this.matrix.elements,r,s);return this._makeSurface(a,t,e)}getSurfaceWorker(t,e,n,i,r,s,o){if(t=isNaN(t)?this.getValueForSigma(2):t,e=e||0,window.hasOwnProperty("Worker")){void 0===this.workerPool&&(this.workerPool=new ah("surf",2));const a={},l=this.workerPool.getNextWorker();0===l.postCount&&Object.assign(a,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(a,{params:{isolevel:t,smooth:e,box:this._getBox(n,i),matrix:this.matrix.elements,contour:r,wrap:s}}),l.post(a,void 0,(t=>{const e=t.data.sd,n=t.data.p;o(this._makeSurface(e,n.isolevel,n.smooth))}),(a=>{console.warn("Volume.getSurfaceWorker error - trying without worker",a);const l=this.getSurface(t,e,n,i,r,s);o(l)}))}else{const a=this.getSurface(t,e,n,i,r,s);o(a)}}getValueForSigma(t){return this.mean+Aa(t,2)*this.rms}getSigmaForValue(t){return(Aa(t,0)-this.mean)/this.rms}get position(){if(!this._position){const t=this.nz,e=this.ny,n=this.nx,i=new Float32Array(n*e*t*3);let r=0;for(let s=0;s<t;++s)for(let t=0;t<e;++t)for(let e=0;e<n;++e)i[r+0]=e,i[r+1]=t,i[r+2]=s,r+=3;hh(this.matrix.elements,i),this._position=i}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(t){const e=t||{};e.volume=this,e.scale=e.scale||"Spectral",e.domain=e.domain||[this.min,this.max];const n=ic.getScheme(e),i=this.position.length/3,r=new Float32Array(3*i);for(let t=0;t<i;++t)n.volumeColorToArray(t,r,3*t);return r}getDataPicking(){const t=Wc(this.position.length/3);return new yp(t,this)}getDataSize(t,e){const n=this.data,i=this.position.length/3;let r;switch(t){case"value":case"deviation":r=new Float32Array(n);break;case"abs-value":r=new Float32Array(n);for(let t=0;t<i;++t)r[t]=Math.abs(r[t]);break;case"value-min":{r=new Float32Array(n);const t=this.min;for(let e=0;e<i;++e)r[e]-=t;break}default:r=$c(i,t)}if(1!==e)for(let t=0;t<i;++t)r[t]*=e;return r}get min(){return void 0===this._min&&(this._min=Qc(this.data)),this._min}get max(){return void 0===this._max&&(this._max=Zc(this.data)),this._max}get sum(){return void 0===this._sum&&(this._sum=Jc(this.data)),this._sum}get mean(){return void 0===this._mean&&(this._mean=tu(this.data)),this._mean}get rms(){return void 0===this._rms&&(this._rms=function(t){const e=t.length;let n=0;for(let i=0;i<e;++i){const e=t[i];n+=e*e}return Math.sqrt(n/e)}(this.data)),this._rms}clone(){const t=new qp(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return t.matrix.copy(this.matrix),t.header=Object.assign({},this.header),t}dispose(){this.workerPool&&this.workerPool.terminate()}}function Xp(t){return"front"===t?0:"back"===t?1:2}ac.add("shader/Mesh.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#elif defined( NOLIGHT )\nvColor = color;\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),ac.add("shader/Mesh.frag","#define STANDARD\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#elif defined( NOLIGHT )\ngl_FragColor = vec4( vColor, opacity );\n#else\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n#include interior_fragment\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#include opaque_back_fragment\n#endif\n}");const Yp={f:1,v2:2,v3:3,c:3};function Kp(t,e){t.matrix.copy(e),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0}const Zp={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new ue,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new ze,disablePicking:!1,sortParticles:!1,background:!1},Qp={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class Jp{constructor(t,e={}){this.parameterTypes=Qp,this.geometry=new qn,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=Ma(e,this.defaultParameters),this.uniforms=_i.merge([Ni.common,{fogColor:{value:new Pn(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Pn(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Pn(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},Ni.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=t.position||t.position1;this._positionDataSize=n?n.length/3:0,t.primitiveId||(t.primitiveId=Wc(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:t.position},color:{type:"c",value:t.color},primitiveId:{type:"f",value:t.primitiveId}}),e.matrix&&(this.matrix=e.matrix),t.index&&this.initIndex(t.index),this.picking=t.picking,this.makeWireframeGeometry()}get defaultParameters(){return Zp}set matrix(t){this.setMatrix(t)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(t){Kp(this.group,t),Kp(this.wireframeGroup,t),Kp(this.pickingGroup,t)}initIndex(t){this.geometry.setIndex(new Nn(t,1));const e=this.geometry.getIndex();e?e.setUsage(this.dynamic?bt:yt):Yl.error("Index is null")}makeMaterial(){const t=Xp(this.parameters.side),e=new vi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:t});e.vertexColors=!0,e.extensions.derivatives=!0,e.extensions.fragDepth=this.isImpostor;const n=new vi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:t});n.vertexColors=!0;const i=new vi({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:t,blending:0});i.vertexColors=!0,i.extensions.fragDepth=this.isImpostor,e.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,this.material=e,this.wireframeMaterial=n,this.pickingMaterial=i,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const t=this.geometry,e=this.wireframeIndex,n=new qn;n.attributes=t.attributes,e&&(n.setIndex(new Nn(e,1).setUsage(this.dynamic?bt:yt)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const t=[];function e(e,n){if(e>n){const t=e;e=n,n=t}const i=t[e];return void 0===i?(t[e]=[n],!0):!i.includes(n)&&(i.push(n),!0)}const n=this.geometry,i=n.index;if(this.parameters.wireframe)if(i){const r=i.array;let s,o=r.length;n.drawRange.count!==1/0&&(o=n.drawRange.count),s=this.wireframeIndex&&this.wireframeIndex.length>2*o?this.wireframeIndex:Ba(2*o,n.attributes.position.count);let a=0;t.length=0;for(let t=0;t<o;t+=3){const n=r[t+0],i=r[t+1],o=r[t+2];e(n,i)&&(s[a+0]=n,s[a+1]=i,a+=2),e(i,o)&&(s[a+0]=i,s[a+1]=o,a+=2),e(o,n)&&(s[a+0]=o,s[a+1]=n,a+=2)}this.wireframeIndex=s,this.wireframeIndexCount=a,this.wireframeIndexVersion=this.indexVersion}else{const t=n.attributes.position.count;let e;e=this.wireframeIndex&&this.wireframeIndex.length>2*t?this.wireframeIndex:Ba(2*t,t);for(let n=0,i=0;n<t;n+=3)e[i+0]=n,e[i+1]=n+1,e[i+2]=n+1,e[i+3]=n+2,e[i+4]=n+2,e[i+5]=n,i+=6;this.wireframeIndex=e,this.wireframeIndexCount=2*t,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new Nn(this.wireframeIndex,1).setUsage(this.dynamic?bt:yt));else{const t=this.wireframeGeometry.getIndex();if(!t)return void Yl.error("Index is null");t.set(this.wireframeIndex),t.needsUpdate=this.wireframeIndexCount>0,t.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let t=0;return this.isText?t=1:this.transparent&&(t=this.isSurface?3:2),t}_getMesh(t){this.material||this.makeMaterial();const e=this.geometry,n=this[t];let i;return i=this.isLine?new Mo(e,n):this.isPoint?new Ro(e,n):new hi(e,n),i.frustumCulled=!1,i.renderOrder=this.getRenderOrder(),i}getMesh(){return this._getMesh("material")}getWireframeMesh(){let t;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),t=new Mo(this.wireframeGeometry,this.wireframeMaterial),t.frustumCulled=!1,t.renderOrder=this.getRenderOrder(),t}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(t,e){return Nc(t,this.getDefines(e))}getVertexShader(t){return this.getShader(this.vertexShader,t)}getFragmentShader(t){return this.getShader(this.fragmentShader,t)}getDefines(t){const e={};return this.parameters.clipNear&&(e.NEAR_CLIP=1),this.parameters.clipRadius&&(e.RADIUS_CLIP=1),"picking"===t?e.PICKING=1:(("background"===t||this.parameters.background)&&(e.NOLIGHT=1),this.parameters.flatShaded&&(e.FLAT_SHADED=1),this.parameters.opaqueBack&&(e.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(e.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(e.USE_INTERIOR_COLOR=1)),e}getParameters(){return this.parameters}addUniforms(t){this.uniforms=_i.merge([this.uniforms,t]),this.pickingUniforms=_i.merge([this.pickingUniforms,t])}addAttributes(t){for(let e in t){let n;const i=t[e],r=this.attributeSize*Yp[i.type];i.value?(r!==i.value.length&&Yl.error("attribute value has wrong length",e),n=i.value):n=Fa("float32",r),this.geometry.setAttribute(e,new Nn(n,Yp[i.type]).setUsage(this.dynamic?bt:yt))}}updateRenderOrder(){const t=this.getRenderOrder();function e(e){e.renderOrder=t}this.group.children.forEach(e),this.pickingGroup&&this.pickingGroup.children.forEach(e)}updateShader(){const t=this.material,e=this.wireframeMaterial,n=this.pickingMaterial;t.vertexShader=this.getVertexShader(),t.fragmentShader=this.getFragmentShader(),t.needsUpdate=!0,e.vertexShader=this.getShader("Line.vert"),e.fragmentShader=this.getShader("Line.frag"),e.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(t){const e=t,n=this.parameterTypes,i=this.parameters,r={},s={};let o=!1,a=!1;for(const t in e){const l=e[t];void 0!==l&&(i[t]=l,void 0!==n[t]&&(n[t].property&&(!0!==n[t].property?r[n[t].property]=l:r[t]=l),n[t].uniform&&(!0!==n[t].uniform?s[n[t].uniform]=l:s[t]=l),n[t].updateShader&&(o=!0),n[t].updateVisibility&&(a=!0),this.dynamic&&"wireframe"===t&&!0===l&&this.updateWireframeIndex(),"forceTransparent"===t&&(r.transparent=this.transparent),"matrix"===t&&(this.matrix=l)))}this.setProperties(r),this.setUniforms(s),o&&this.updateShader(),a&&this.setVisibility(this.visible)}setAttributes(t){const e=this.geometry,n=e.attributes;for(const i in t){if("picking"===i)continue;const r=t[i],s=r.length;if("index"===i){const t=e.getIndex();if(!t){Yl.error("Index is null");continue}e.setDrawRange(0,1/0),s>t.array.length?e.setIndex(new Nn(r,1).setUsage(this.dynamic?bt:yt)):(t.set(r),t.needsUpdate=s>0,t.updateRange.count=s,e.setDrawRange(0,s)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const t=n[i];s>t.array.length?e.setAttribute(i,new Nn(r,t.itemSize).setUsage(this.dynamic?bt:yt)):(n[i].set(r),n[i].needsUpdate=s>0,n[i].updateRange.count=s)}}}setUniforms(t){if(!t)return;const e=this.material.uniforms,n=this.wireframeMaterial.uniforms,i=this.pickingMaterial.uniforms;for(let r in t)"opacity"===r&&this.setProperties({transparent:this.transparent}),void 0!==e[r]&&(e[r].value.isVector3?e[r].value.copy(t[r]):e[r].value.set?e[r].value.set(t[r]):e[r].value=t[r]),void 0!==n[r]&&(n[r].value.isVector3?n[r].value.copy(t[r]):n[r].value.set?n[r].value.set(t[r]):n[r].value=t[r]),void 0!==i[r]&&(i[r].value.isVector3?i[r].value.copy(t[r]):i[r].value.set?i[r].value.set(t[r]):i[r].value=t[r])}setProperties(t){if(!t)return;const e=this.material,n=this.wireframeMaterial,i=this.pickingMaterial;for(const r in t){const s=r;let o=t[s];"transparent"===s?this.updateRenderOrder():"side"===s&&(o=Xp(o)),e[s]=o,n[s]=o,i[s]=o}e.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}setVisibility(t){this.visible=t,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=t,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=t,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=t))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var t={};for(var e in this)"group"!==e&&"wireframeGroup"!==e&&"pickingGroup"!=e&&"picking"!==e&&(t[e]=this[e]);return t}}class tf extends Jp{constructor(t,e={}){super(t,e),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:t.normal}}),void 0===t.normal&&this.geometry.computeVertexNormals()}}class ef extends tf{constructor(){super(...arguments),this.isSurface=!0}}function nf(t){t.visible=!0}function rf(t){t.visible=!1}class sf{constructor(t){this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.frontMeshes=[],this.backMeshes=[],this.size=t.size,this.side=t.parameters.side,this.visible=t.visible,this.geometry=t.geometry,this.picking=t.picking,this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.matrix=t.matrix;const e=t,n=new t.constructor({position:new Float32Array(0)});e.makeMaterial(),n.makeMaterial(),n.picking=t.picking,n.geometry=t.geometry,n.wireframeGeometry=t.wireframeGeometry,n.setParameters(t.getParameters()),n.updateShader(),e.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=t,this.frontBuffer=e,this.backBuffer=n}set matrix(t){Jp.prototype.setMatrix.call(this,t)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const t=Object.assign({},this.buffer.parameters);return t.side=this.side,t}getMesh(t){let e,n;return t?(n=this.backBuffer.getPickingMesh(),e=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),e=this.frontBuffer.getMesh()),this.frontMeshes.push(e),this.backMeshes.push(n),this.setParameters({side:this.side}),(new ro).add(n,e)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(t){this.buffer.setAttributes(t)}setParameters(t){"front"===(t=Object.assign({},t)).side?(this.frontMeshes.forEach(nf),this.backMeshes.forEach(rf)):"back"===t.side?(this.frontMeshes.forEach(rf),this.backMeshes.forEach(nf)):"double"===t.side&&(this.frontMeshes.forEach(nf),this.backMeshes.forEach(nf)),void 0!==t.side&&(this.side=t.side),delete t.side,void 0!==t.matrix&&(this.matrix=t.matrix),delete t.matrix,this.frontBuffer.setParameters(t),void 0!==t.wireframe&&(this.wireframe=t.wireframe,this.setVisibility(this.visible)),delete t.wireframe,this.backBuffer.setParameters(t)}setVisibility(t){this.visible=t,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=t,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=t,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=t))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var t={};for(var e in this)["side","size","visible","matrix","parameters"].includes(e)&&(t[e]=this[e]);return t}}ac.add("shader/Line.vert","uniform float clipNear;\nuniform vec3 clipCenter;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include color_pars_vertex\nvoid main(){\n#include color_vertex\n#include begin_vertex\n#include project_vertex\nvViewPosition = -mvPosition.xyz;\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),ac.add("shader/Line.frag","uniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\ngl_FragColor = vec4( vColor, opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n}");class of extends Jp{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class af extends sh{constructor(t,e,n){super(t,e,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),t instanceof qp?(this.surface=void 0,this.volume=t):(this.surface=t,this.volume=void 0),this.boxCenter=new ue,this.__boxCenter=new ue,this.box=new pe,this.__box=new pe,this._position=new ue,this.inverseMatrix=new ze,this.setBox=function(){this._position.copy(e.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(t){const e=t||{};e.colorScheme=Aa(e.colorScheme,"uniform"),e.colorValue=Aa(e.colorValue,14540253),this.isolevelType=Aa(e.isolevelType,"sigma"),this.isolevel=Aa(e.isolevel,2),this.negateIsolevel=Aa(e.negateIsolevel,!1),this.isolevelScroll=Aa(e.isolevelScroll,!1),this.smooth=Aa(e.smooth,0),this.background=Aa(e.background,!1),this.opaqueBack=Aa(e.opaqueBack,!0),this.boxSize=Aa(e.boxSize,0),this.colorVolume=Aa(e.colorVolume,void 0),this.contour=Aa(e.contour,!1),this.useWorker=Aa(e.useWorker,!0),this.wrap=Aa(e.wrap,!1),super.init(e),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(t){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),t()}prepare(t){if(this.volume){let e;if(e="sigma"===this.isolevelType?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(e*=-1),!this.surface||this.__isolevel!==e||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=e,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=e=>{this.surface=e,t()};this.useWorker?this.volume.getSurfaceWorker(e,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(e,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else t()}else t()}create(){const t={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let e;if(this.contour)e=new of(t,this.getBufferParams({wireframe:!1}));else{Object.assign(t,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new ef(t,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));e=new sf(n)}this.bufferList.push(e)}update(t){if(0===this.bufferList.length)return;const e={};(t=t||{}).position&&(e.position=this.surface.getPosition()),t.color&&(e.color=this.surface.getColor(this.getColorParams())),t.index&&(e.index=this.surface.getIndex()),t.normal&&(e.normal=this.surface.getNormal()),this.bufferList.forEach((function(t){t.setAttributes(e)}))}setParameters(t,e,n){return t&&void 0!==t.isolevelType&&this.volume&&("value"===this.isolevelType&&"sigma"===t.isolevelType?this.isolevel=this.volume.getSigmaForValue(this.isolevel):"sigma"===this.isolevelType&&"value"===t.isolevelType&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=t.isolevelType),t&&t.boxCenter&&(this.boxCenter.copy(t.boxCenter),delete t.boxCenter),t&&t.wireframe&&(t.contour||void 0===t.contour&&this.contour)&&(t.wireframe=!1),super.setParameters(t,e,n),t.matrix&&this.inverseMatrix.copy(t.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),t&&void 0!==t.colorVolume&&e&&(e.color=!0),this.surface&&(void 0!==t.isolevel||void 0!==t.negateIsolevel||void 0!==t.smooth||void 0!==t.wrap||void 0!==t.boxSize||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const t=super.getColorParams();return t.volume=this.colorVolume,t}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class lf{static zoomScroll(t,e){t.trackballControls.zoom(e)}static clipNearScroll(t,e){const n=t.getParameters();t.setParameters({clipNear:n.clipNear+e/10})}static focusScroll(t,e){const n=t.getFocus(),i=Math.sign(e)*function(t){if(t>5)return t;const e=t/5;return(-4.6*e+9.4)*e*e+.2}((100-n)/10);t.setFocus(n+i)}static zoomFocusScroll(t,e){t.trackballControls.zoom(e);const n=t.viewer.camera.position.z;t.setFocus(100-Math.abs(n/8))}static isolevelScroll(t,e){const n=Math.sign(e)/10;t.eachRepresentation(((t,e)=>{if(t.repr instanceof af){const e=t.getParameters();e.isolevelScroll&&t.setParameters({isolevel:e.isolevel+n})}}))}static panDrag(t,e,n){t.trackballControls.pan(e,n)}static rotateDrag(t,e,n){t.trackballControls.rotate(e,n)}static zRotateDrag(t,e,n){t.trackballControls.zRotate(e,n)}static zoomDrag(t,e,n){t.trackballControls.zoom((e+n)/-2)}static zoomFocusDrag(t,e,n){t.trackballControls.zoom((e+n)/-2);const i=t.viewer.camera.position.z;t.setFocus(100-Math.abs(i/8))}static panComponentDrag(t,e,n){t.trackballControls.panComponent(e,n)}static panAtomDrag(t,e,n){t.trackballControls.panAtom(e,n)}static rotateComponentDrag(t,e,n){t.trackballControls.rotateComponent(e,n)}static movePick(t,e){e&&t.animationControls.move(e.position.clone())}static tooltipPick(t,e){const n=t.tooltip;if(t.getParameters().tooltip&&e){const t=e.mouse.position;n.innerText=e.getLabel(),n.style.bottom=window.innerHeight-t.y+3+"px",n.style.left=t.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(t,e){if(e&&(e.atom||e.bond)){const t=e.atom||e.closestBondAtom;e.component.measurePick(t)}else t.measureClear()}}const cf={default:[["scroll",lf.zoomScroll],["scroll-shift",lf.focusScroll],["scroll-ctrl",lf.isolevelScroll],["scroll-shift-ctrl",lf.zoomFocusScroll],["drag-left",lf.rotateDrag],["drag-right",lf.panDrag],["drag-ctrl-left",lf.panDrag],["drag-ctrl-right",lf.zRotateDrag],["drag-shift-left",lf.zoomDrag],["drag-middle",lf.zoomFocusDrag],["drag-ctrl-shift-right",lf.panComponentDrag],["drag-ctrl-shift-left",lf.rotateComponentDrag],["clickPick-right",lf.measurePick],["clickPick-ctrl-left",lf.measurePick],["clickPick-middle",lf.movePick],["clickPick-left",lf.movePick],["hoverPick",lf.tooltipPick]],pymol:[["drag-left",lf.rotateDrag],["drag-middle",lf.panDrag],["drag-right",lf.zoomDrag],["scroll",lf.focusScroll],["drag-shift-right",lf.focusScroll],["clickPick-ctrl+shift-middle",lf.movePick],["hoverPick",lf.tooltipPick]],coot:[["scroll",lf.isolevelScroll],["drag-left",lf.rotateDrag],["drag-middle",lf.panDrag],["drag-ctrl-left",lf.panDrag],["drag-right",lf.zoomFocusDrag],["drag-ctrl-right",lf.focusScroll],["clickPick-middle",lf.movePick],["hoverPick",lf.tooltipPick]],astexviewer:[["drag-left",lf.rotateDrag],["drag-ctrl-left",lf.panDrag],["drag-shift-left",lf.zoomDrag],["scroll",lf.focusScroll],["clickPick-middle",lf.movePick],["hoverPick",lf.tooltipPick]]};function uf(t){const e=t.split(/[-+]/);let n="";e.includes("scroll")&&(n="scroll"),e.includes("drag")&&(n="drag"),e.includes("click")&&(n="click"),e.includes("doubleClick")&&(n="doubleClick"),e.includes("hover")&&(n="hover"),e.includes("clickPick")&&(n="clickPick"),e.includes("hoverPick")&&(n="hoverPick");let i=0;e.includes("alt")&&(i+=1),e.includes("ctrl")&&(i+=2),e.includes("meta")&&(i+=4),e.includes("shift")&&(i+=8);let r=0;return e.includes("left")&&(r+=1),e.includes("right")&&(r+=2),e.includes("middle")&&(r+=4),[n,i,r]}class hf{constructor(t,e={}){this.stage=t,this.actionList=[],this.mouse=t.mouseObserver,this.disabled=e.disabled||!1,this.preset(e.preset||"default")}run(t,...e){if(this.disabled)return;const n=this.mouse.key||0,i=this.mouse.buttons||0;this.actionList.forEach((r=>{r.type===t&&r.key===n&&r.button===i&&r.callback(this.stage,...e)}))}add(t,e){const[n,i,r]=uf(t);this.actionList.push({type:n,key:i,button:r,callback:e})}remove(t,e){const n=t.includes("*"),[i,r,s]=uf(t),o=this.actionList.filter((function(t){return!((t.type===i||n&&""===i)&&(t.key===r||n&&0===r)&&(t.button===s||n&&0===s)&&(t.callback===e||void 0===e))}));this.actionList=o}preset(t){this.clear(),(cf[t]||[]).forEach((t=>this.add(t[0],t[1])))}clear(){this.actionList.length=0}}class df{static autoView(t){t.autoView(1e3)}static toggleAnimations(t){t.animationControls.toggle()}static toggleRock(t){t.toggleRock()}static toggleSpin(t){t.toggleSpin()}static toggleAntialiasing(t){const e=t.getParameters();t.setParameters({sampleLevel:-1===e.sampleLevel?0:-1})}}const pf={default:[["i",df.toggleSpin],["k",df.toggleRock],["p",df.toggleAnimations],["a",df.toggleAntialiasing],["r",df.autoView]]};class ff{constructor(t,e={}){this.stage=t,this.actionList=[],this.disabled=e.disabled||!1,this.preset(e.preset||"default")}run(t){this.disabled||this.actionList.forEach((e=>{e.key===t&&e.callback(this.stage)}))}add(t,e){this.actionList.push({key:t,callback:e})}remove(t,e){const n=this.actionList.filter((function(n){return!(n.key===t&&(n.callback===e||void 0===e))}));this.actionList=n}preset(t){this.clear(),(pf[t]||[]).forEach((t=>this.add(t[0],t[1])))}clear(){this.actionList.length=0}}class mf{constructor(t){this.stage=t,this.stage=t,this.mouse=t.mouseObserver,this.controls=t.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(t,e){const n=this.stage.pickingControls.pick(t,e);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)}_onHover(t,e){const n=this.stage.pickingControls.pick(t,e);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class gf{constructor(t){this.stage=t,this.stage=t,this.mouse=t.mouseObserver,this.controls=t.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(t){this.controls.run("scroll",t)}_onDrag(t,e){this.controls.run("drag",t,e)}_onClick(t,e){this.controls.run("click",t,e)}_onDblclick(t,e){this.controls.run("doubleClick",t,e)}_onHover(t,e){this.controls.run("hover",t,e)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class _f{constructor(t){this.stage=t,this.viewer=t.viewer,this.animationControls=t.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(t){this.animationControls.run(t)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const vf=!!Gl&&{passive:!0};class yf{constructor(t){this.stage=t,this.stage=t,this.controls=t.keyControls,this.domElement=t.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,vf),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(t){let e;e="key"in KeyboardEvent.prototype?t.key:String.fromCharCode(t.which||t.keyCode),this.controls.run(e)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,vf),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class bf{constructor(t,e,n,i={}){this.component=t,this.position=e,this.offsetX=Aa(i.offsetX,0),this.offsetY=Aa(i.offsetY,0),this.visible=Aa(i.visible,!0),this.stage=t.stage,this.viewer=t.stage.viewer,this._viewerPosition=new ue,this._updateViewerPosition(),this._canvasPosition=new Nt,this._cameraPosition=new ue,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(t){const e=this.element.style.display;if("none"===e&&(this.element.style.left="-10000px",this.element.style.display="block"),t instanceof HTMLElement)this.element.appendChild(t);else{const e=document.createElement("div");e.innerText=t,Object.assign(e.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(e)}this._clientRect=this.element.getBoundingClientRect(),"none"===e&&(this.element.style.display=e)}setVisibility(t){this.visible=t,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const t=this.element.style,e=this._canvasPosition,n=this._viewerPosition,i=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(t.display="none");t.display="block";const r=this._cameraPosition.length(),s=this.viewer.scene.fog;t.opacity=(1-tl(s.near,s.far,r)).toString(),t.zIndex=Math.round(100*(s.far-r)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,e),t.bottom=this.offsetX+e.y+i.height/2+"px",t.left=this.offsetY+e.x-i.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const xf=new ze,wf=new ue,Sf=new ce;class Af{constructor(t){this.component=t,this.signals={changed:new va.Signal},this.stage=t.stage,this.viewer=t.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(t,e){xf.copy(this.viewer.rotationGroup.matrix).invert(),wf.copy(Va(t)).applyMatrix4(xf),xf.extractRotation(this.component.transform),xf.premultiply(this.viewer.rotationGroup.matrix),xf.invert(),wf.copy(Va(t)),wf.applyMatrix4(xf),xf.makeRotationAxis(wf,e),Sf.setFromRotationMatrix(xf),this.component.quaternion.premultiply(Sf),this.changed()}}const Mf={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class Cf{constructor(t={}){this.max=10,this.type=Aa(t.type,"size"),this.scale=Aa(t.scale,1),this.size=Aa(t.size,1),this.data=Aa(t.data,{})}atomRadius(t){let e;switch(this.type){case"vdw":e=t.vdw;break;case"covalent":e=t.covalent;break;case"bfactor":e=t.bfactor||1;break;case"sstruc":const n=t.sstruc;e="h"===n||"g"===n||"i"===n||"e"===n||"b"===n?.25:Id.includes(t.atomname)?.4:.1;break;case"data":e=Aa(this.data[t.index],1);break;case"explicit":e=t.radius,null===e&&(e=this.size);break;default:e=this.size}return Math.min(e*this.scale,this.max)}}Cf.types=Mf;const Ef=new ue(-1,-1,-1),Tf=new ze;class Pf{constructor(t){const e=t.rows,n=e/3,i=new Ap(e,3),r=new Ap(3,3),s=new Ap(1,3),o=new Ap(3,3),a=new Ap(3,3),l=Tp(t);Pp(t,l),Mp(i,t),Cp(r,i,i),kp(r,s,o,a);const c=new ue(l[0],l[1],l[2]),u=new ue(o.data[0],o.data[3],o.data[6]),h=new ue(o.data[1],o.data[4],o.data[7]),d=new ue(o.data[2],o.data[5],o.data[8]),p=u.clone().multiplyScalar(Math.sqrt(s.data[0]/n)),f=h.clone().multiplyScalar(Math.sqrt(s.data[1]/n)),m=d.clone().multiplyScalar(Math.sqrt(s.data[2]/n));this.begA=c.clone().sub(p),this.endA=c.clone().add(p),this.begB=c.clone().sub(f),this.endB=c.clone().add(f),this.begC=c.clone().sub(m),this.endC=c.clone().add(m),this.center=c,this.vecA=p,this.vecB=f,this.vecC=m,this.normVecA=u,this.normVecB=h,this.normVecC=d}getBasisMatrix(t=new ze){const e=t;return e.makeBasis(this.normVecB,this.normVecA,this.normVecC),e.determinant()<0&&e.scale(Ef),e}getRotationQuaternion(t=new ce){const e=t;return e.setFromRotationMatrix(this.getBasisMatrix(Tf)),e.invert()}getProjectedScaleForAtoms(t){let e=-1/0,n=-1/0,i=-1/0,r=-1/0,s=-1/0,o=-1/0;const a=new ue,l=new ue,c=this.center,u=this.normVecA,h=this.normVecB,d=this.normVecC;return t.eachAtom((function(t){ch(a.copy(t),u,c);const p=l.subVectors(a,c).normalize().dot(u),f=a.distanceTo(c);p>0?f>e&&(e=f):f>n&&(n=f),ch(a.copy(t),h,c);const m=l.subVectors(a,c).normalize().dot(h),g=a.distanceTo(c);m>0?g>i&&(i=g):g>r&&(r=g),ch(a.copy(t),d,c);const _=l.subVectors(a,c).normalize().dot(d),v=a.distanceTo(c);_>0?v>s&&(s=v):v>o&&(o=v)})),{d1a:e,d2a:i,d3a:s,d1b:-n,d2b:-r,d3b:-o}}}class If{constructor(t,e,n,i){this.volume=t,this.setFilter(e,n,i)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(t,e,n){return JSON.stringify([t,e,n])}setFilter(t,e,n){isNaN(t)&&this.header&&(t=this.header.DMEAN+2*this.header.ARMS),t=void 0===t||isNaN(t)?-1/0:t,e=Aa(e,1/0),n=Aa(n,!1);const i=this.volume.data,r=this.volume.position,s=this.volume.atomindex,o=this._getFilterHash(t,e,n);if(o!==this._filterHash){if(t===-1/0&&e===1/0)this.data=i,this.position=r,this.atomindex=s;else{const o=i.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*o),this._positionBuffer=new ArrayBuffer(3*o*4),s&&(this._atomindexBuffer=new ArrayBuffer(4*o)));const a=new Float32Array(this._dataBuffer),l=new Float32Array(this._positionBuffer);let c;s&&(c=new Uint32Array(this._atomindexBuffer));let u=0;for(let h=0;h<o;++h){const o=3*h,d=i[h];if(!n&&d>=t&&d<=e||n&&(d<t||d>e)){const t=3*u;a[u]=d,l[t+0]=r[o+0],l[t+1]=r[o+1],l[t+2]=r[o+2],s&&c&&(c[u]=s[h]),u+=1}}this.data=new Float32Array(this._dataBuffer,0,u),this.position=new Float32Array(this._positionBuffer,0,3*u),s&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,u))}this._filterHash=o}}}If.prototype.getValueForSigma=qp.prototype.getValueForSigma,If.prototype.getSigmaForValue=qp.prototype.getSigmaForValue,If.prototype.getDataAtomindex=qp.prototype.getDataAtomindex,If.prototype.getDataPosition=qp.prototype.getDataPosition,If.prototype.getDataColor=qp.prototype.getDataColor,If.prototype.getDataPicking=qp.prototype.getDataPicking,If.prototype.getDataSize=qp.prototype.getDataSize;class Rf{constructor(t,e){const n=td({nodeArray1:t.atomIndex1,nodeArray2:t.atomIndex2,edgeCount:t.count,nodeCount:e});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class kf extends Kh{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(t,e,n){this.growIfFull();const i=this.count,r=t.index,s=e.index;r<s?(this.atomIndex1[i]=r,this.atomIndex2[i]=s):(this.atomIndex2[i]=r,this.atomIndex1[i]=s),n&&(this.bondOrder[i]=n),this.count+=1}addBondIfConnected(t,e,n){return!!t.connectedTo(e)&&(this.addBond(t,e,n),!0)}}class Df extends Kh{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(t,e){this.altloc[t]=e.charCodeAt(0)}getAltloc(t){const e=this.altloc[t];return e?String.fromCharCode(e):""}}class Lf extends Kh{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(t,e){this.sstruc[t]=e.charCodeAt(0)}getSstruc(t){const e=this.sstruc[t];return e?String.fromCharCode(e):""}setInscode(t,e){this.inscode[t]=e.charCodeAt(0)}getInscode(t){const e=this.inscode[t];return e?String.fromCharCode(e):""}}class Of extends Kh{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(t,e){const n=4*t;this.chainname[n]=e.charCodeAt(0),this.chainname[n+1]=e.charCodeAt(1),this.chainname[n+2]=e.charCodeAt(2),this.chainname[n+3]=e.charCodeAt(3)}getChainname(t){let e="";for(let n=0;n<4;++n){const i=this.chainname[4*t+n];if(!i)break;e+=String.fromCharCode(i)}return e}setChainid(t,e){const n=4*t;this.chainid[n]=e.charCodeAt(0),this.chainid[n+1]=e.charCodeAt(1),this.chainid[n+2]=e.charCodeAt(2),this.chainid[n+3]=e.charCodeAt(3)}getChainid(t){let e="";for(let n=0;n<4;++n){const i=this.chainid[4*t+n];if(!i)break;e+=String.fromCharCode(i)}return e}}class Nf extends Kh{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class Ff{constructor(t){this.polymer=t,this.size=t.residueCount}getCenterIterator(t=0){const e=this.getPosition().center,n=e.length/3;let i=0,r=-1;const s=[new ue,new ue,new ue,new ue];return{size:n,next:function(){const t=this.get(r);return r+=1,t},get:function(r){r=Math.min(n-1,Math.max(0,r));const o=s[i%4],a=3*r;if(o.fromArray(e,a),t){const i=Math.min(t,r,n-r-1);for(let t=1;t<=i;++t){const n=3*t,r=(i+1-t)/(i+1);o.x+=r*e[a-n+0]+r*e[a+n+0],o.y+=r*e[a-n+1]+r*e[a+n+1],o.z+=r*e[a-n+2]+r*e[a+n+2]}o.x/=i+1,o.y/=i+1,o.z/=i+1}return i+=1,o},reset:function(){i=0,r=-1}}}getColor(t){const e=this.polymer,n=e.structure,i=e.residueCount,r=e.residueIndexStart,s=new Float32Array(3*i),o=t||{};o.structure=n;const a=ic.getScheme(o),l=n.getResidueProxy(),c=n.getAtomProxy();for(let t=0;t<i;++t)l.index=r+t,c.index=l.traceAtomIndex,a.atomColorToArray(c,s,3*t);return{color:s}}getPicking(){const t=this.polymer,e=t.structure,n=t.residueCount,i=t.residueIndexStart,r=new Float32Array(n),s=e.getResidueProxy();for(let t=0;t<n;++t)s.index=i+t,r[t]=s.traceAtomIndex;return{picking:new cp(r,e)}}getSize(t){const e=this.polymer,n=e.structure,i=e.residueCount,r=e.residueIndexStart,s=new Float32Array(i),o=new Cf(t),a=n.getResidueProxy(),l=n.getAtomProxy();for(let t=0;t<i;++t)a.index=r+t,l.index=a.traceAtomIndex,s[t]=o.atomRadius(l);return{size:s}}getPosition(){const t=this.polymer,e=t.structure,n=t.residueCount,i=n-3,r=new Float32Array(3*n),s=new Float32Array(3*n),o=new Float32Array(n),a=new Float32Array(n),l=new Float32Array(n),c=new Float32Array(n),u=new Float32Array(3*n),h=new ue,d=new ue,p=new ue,f=new ue,m=new ue,g=new ue,_=new ue,v=new ue,y=new ue,b=new ue,x=new ue,w=new ue(0,0,0),S="trace",A=e.getAtomProxy(),M=e.getAtomProxy(t.getAtomIndexByType(0,S)),C=e.getAtomProxy(t.getAtomIndexByType(1,S)),E=e.getAtomProxy(t.getAtomIndexByType(2,S));for(let e=0;e<i;++e){A.index=M.index,M.index=C.index,C.index=E.index,E.index=t.getAtomIndexByType(e+3,S);const n=3*e;h.subVectors(M,A),d.subVectors(C,M),p.subVectors(E,C),f.subVectors(h,d),m.subVectors(d,p),y.crossVectors(f,m).normalize(),y.toArray(s,n),e>0&&(o[e]=y.angleTo(b));const i=Math.cos(f.angleTo(m));c[e]=180/Math.PI*Math.acos(i);const v=f.length(),T=m.length();a[e]=Math.sqrt(T*v)/Math.max(2,2*(1-i)),l[e]=Math.abs(d.dot(y)),g.copy(f).multiplyScalar(a[e]/v),_.copy(m).multiplyScalar(a[e]/T),g.subVectors(M,g),_.subVectors(C,_),g.toArray(r,n+3),_.toArray(r,n+6),x.subVectors(A,w),x.toArray(u,n),b.copy(y),w.copy(g)}g.fromArray(r,3),_.fromArray(r,6),y.subVectors(g,_).normalize(),A.index=t.getAtomIndexByType(0,S),w.copy(A),v.copy(A),ch(v,y,g),v.toArray(r,0),x.subVectors(w,g),x.toArray(u,0),g.fromArray(r,3*n-6),_.fromArray(r,3*n-9),y.subVectors(g,_).normalize(),A.index=t.getAtomIndexByType(n-1,S),w.copy(A),v.copy(A),ch(v,y,g),v.toArray(r,3*n-3);for(let e=n-3;e<n;++e)g.fromArray(r,3*e),A.index=t.getAtomIndexByType(e,S),w.copy(A),x.subVectors(w,g),x.toArray(u,3*e);const T=new Float32Array(n),P=new Float32Array(n),I=new Float32Array(n),R=new Float32Array(n);T[1]=a[0],P[1]=c[0],I[1]=a[0];for(let t=2;t<n-2;++t)T[t]=.5*(a[t-2]+a[t-1]),P[t]=.5*(c[t-2]+c[t-1]),I[t]=.5*(l[t-2]+l[t-1]),g.fromArray(s,3*(t-2)),_.fromArray(s,3*(t-1)),R[t]=180/Math.PI*Math.acos(Math.cos(g.angleTo(_)));T[n-2]=a[n-4],P[n-2]=c[n-4],I[n-2]=l[n-4];const k=new Float32Array(3*n);Yc(s,k,0,0,3),Yc(s,k,0,3,3);for(let t=2;t<n-2;++t)g.fromArray(s,3*(t-2)),_.fromArray(s,3*(t-1)),y.addVectors(_,g).multiplyScalar(.5).normalize(),y.toArray(k,3*t);return Yc(s,k,3*n-12,3*n-6,3),Yc(s,k,3*n-12,3*n-3,3),{center:r,axis:k,bending:R,radius:T,rise:I,twist:P,resdir:u}}}class Bf{constructor(t){this.polymer=t,this.helixorient=new Ff(t),this.position=this.helixorient.getPosition()}getAxis(t,e,n,i,r){t=t||30,e=e||2.5,n=void 0!==n&&n;const s=this.polymer,o=s.structure,a=s.residueCount,l=s.residueIndexStart,c=this.position,u=i||{};u.structure=o;const h=ic.getScheme(u),d=new Cf(r);let p=0,f=0;const m=[],g=[],_=[],v=[],y=[],b=[],x=[],w=[],S=[];let A,M,C=new Float32Array(3*a),E=new Float32Array(3*a);const T=new ue,P=new ue,I=o.getResidueProxy(),R=o.getResidueProxy(),k=o.getAtomProxy(),D=new ue,L=new ue;let O=!1;for(let i=0;i<a;++i)if(I.index=l+i,D.fromArray(c.center,3*i),i===a-1?O=!0:(R.index=l+i+1,L.fromArray(c.center,3*i+3),(n&&I.sstruc!==R.sstruc||D.distanceTo(L)>e||c.bending[i]>t)&&(O=!0)),O){if(i-p<4){p=i,O=!1;continue}k.index=I.traceAtomIndex,C=c.axis.subarray(3*p+3,3*i),E=c.center.subarray(3*p,3*i+3),A=lh(C).normalize(),M=lh(E),T.fromArray(E),ch(T,A,M),P.fromArray(E,E.length-3),ch(P,A,M),A.subVectors(P,T),A.toArray(m,f),M.toArray(g,f),T.toArray(_,f),P.toArray(v,f),h.atomColorToArray(k,y,f),b.push(k.index),x.push(d.atomRadius(k)),w.push(l+p),S.push(l+i+1-p),f+=3,p=i,O=!1}const N=new Float32Array(b);return{axis:new Float32Array(m),center:new Float32Array(g),begin:new Float32Array(_),end:new Float32Array(v),color:new Float32Array(y),picking:new cp(N,o),size:new Float32Array(x),residueOffset:w,residueCount:S}}}class Uf{constructor(t){this.scoreFunction=t,this.content=[],this.scoreFunction=t}push(t){this.content.push(t),this.bubbleUp(this.content.length-1)}pop(){const t=this.content[0],e=this.content.pop();return e&&this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t}peek(){return this.content[0]}remove(t){const e=this.content.length;for(let n=0;n<e;n++)if(this.content[n]===t){const i=this.content.pop();return void(i&&n!==e-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(t){const e=this.content[t];for(;t>0;){const n=Math.floor((t+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[n]=e,this.content[t]=i,t=n}}sinkDown(t){const e=this.content.length,n=this.content[t],i=this.scoreFunction(n);let r=0,s=0;for(;;){const o=2*(t+1),a=o-1;let l=null;if(a<e){const t=this.content[a];r=this.scoreFunction(t),r<i&&(l=a)}if(o<e){const t=this.content[o];s=this.scoreFunction(t),s<(null===l?i:r)&&(l=o)}if(null===l)break;this.content[t]=this.content[l],this.content[l]=n,t=l}}}class zf{constructor(t,e){this.points=t,this.metric=e,this.maxDepth=0,this.currentNode=0;const n=t.length/3,i=new Uint32Array(n);for(let t=0;t<n;++t)i[t]=t;this.indices=i,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(t,e,n,i){t>this.maxDepth&&(this.maxDepth=t);const r=i-n;if(0===r)return-1;const s=4*this.currentNode,o=this.nodes;if(this.currentNode+=1,1===r)return o[s]=n,o[s+1]=-1,o[s+2]=-1,o[s+3]=e,s;const a=this.indices,l=this.points,c=n+Math.floor(r/2),u=t%3;let h,d,p,f,m,g=n,_=i-1;for(;_>g;){for(p=g+_>>1,f=l[3*a[p]+u],d=a[p],a[p]=a[_],a[_]=d,m=g,h=g;h<_;++h)l[3*a[h]+u]<f&&(d=a[m],a[m]=a[h],a[h]=d,++m);if(d=a[_],a[_]=a[m],a[m]=d,p=m,c===p)break;c<p?_=p-1:g=p+1}return o[s]=c,o[s+1]=this.buildTree(t+1,s,n,c),o[s+2]=this.buildTree(t+1,s,c+1,i),o[s+3]=e,s}getNodeDepth(t){const e=this.nodes[t+3];return-1===e?0:this.getNodeDepth(e)+1}nearest(t,e,n){const i=new Uf((t=>-t[1])),r=this.nodes,s=this.points,o=this.indices,a=l=>{let c,u;const h=this.getNodeDepth(l)%3,d=3*o[r[l]],p=[s[d+0],s[d+1],s[d+2]],f=this.metric(t,p);function m(t,n){i.push([t,n]),i.size()>e&&i.pop()}const g=r[l+1],_=r[l+2];if(-1===_&&-1===g)return void((i.size()<e||f<i.peek()[1])&&f<=n&&m(l,f));c=-1===_?g:-1===g?_:t[h]<=s[d+h]?g:_,a(c),(i.size()<e||f<i.peek()[1])&&f<=n&&m(l,f);const v=[];for(let e=0;e<3;e+=1)v[e]=e===h?t[e]:s[d+e];const y=this.metric(v,p);(i.size()<e||Math.abs(y)<i.peek()[1])&&Math.abs(y)<=n&&(u=c===g?_:g,-1!==u&&a(u))};a(this.rootIndex);const l=[];for(let t=0,n=Math.min(i.size(),e);t<n;t+=1)l.push(i.content[t]);return l}verify(t,e=0){let n=1;if(void 0===t&&(t=this.rootIndex),-1===t)throw new Error("node is null");const i=e%3,r=this.nodes,s=this.points,o=this.indices,a=r[t+1],l=r[t+2];if(-1!==a){if(s[3*o[r[a]]+i]>s[3*o[r[t]]+i])throw new Error("left child is > parent!");n+=this.verify(a,e+1)}if(-1!==l){if(s[3*o[r[l]]+i]<s[3*o[r[t]]+i])throw new Error("right child is < parent!");n+=this.verify(l,e+1)}return n}}class Vf{constructor(t,e=0){this.structure=t,this.index=e,this.chainStore=t.chainStore,this.residueStore=t.residueStore,this.atomStore=t.atomStore,this.residueMap=t.residueMap,this.atomMap=t.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(t){this.atomStore.residueIndex[this.index]=t}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(t){this.atomStore.x[this.index]=t}get y(){return this.atomStore.y[this.index]}set y(t){this.atomStore.y[this.index]=t}get z(){return this.atomStore.z[this.index]}set z(t){this.atomStore.z[this.index]=t}get serial(){return this.atomStore.serial[this.index]}set serial(t){this.atomStore.serial[this.index]=t}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(t){this.atomStore.bfactor[this.index]=t}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(t){this.atomStore.occupancy[this.index]=t}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(t){this.atomStore.setAltloc(this.index,t)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(t){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=t)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(t){this.atomStore.radius&&(this.atomStore.radius[this.index]=t)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(t){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=t)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(t){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=t)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(t,e){e=e||this.structure._bp;const n=this.index,i=this.bondHash,r=i.indexArray,s=i.countArray[n],o=i.offsetArray[n];for(let n=0;n<s;++n)e.index=r[o+n],t(e)}eachBondedAtom(t,e){const n=e||this.structure._ap,i=this.index;this.eachBond((function(e){n.index=i!==e.atomIndex1?e.atomIndex1:e.atomIndex2,t(n)})),this.index=i}hasBondTo(t){let e=!1;return this.eachBondedAtom((function(n){t.index===n.index&&(e=!0)})),e}bondToElementCount(t){let e=0;const n=this.index;return this.eachBondedAtom((function(n){n.number===t&&(e+=1)})),this.index=n,e}hasBondToElement(t){return this.bondToElementCount(t)>0}isBackbone(){const t=this.residueType.backboneIndexList;return t.length>0&&t.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const t=this.residueType.moleculeType;return 3===t||4===t||5===t}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const t=this.residueType.backboneType;return 4===t||5===t||6===t}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return 1===this.residueType.hetero}isProtein(){return 3===this.residueType.moleculeType}isNucleic(){const t=this.residueType.moleculeType;return 4===t||5===t}isRna(){return 4===this.residueType.moleculeType}isDna(){return 5===this.residueType.moleculeType}isWater(){return 1===this.residueType.moleculeType}isIon(){return 2===this.residueType.moleculeType}isSaccharide(){return 6===this.residueType.moleculeType}isHelix(){return ud.includes(this.sstruc)}isSheet(){return hd.includes(this.sstruc)}isTurn(){return dd.includes(this.sstruc)&&this.isProtein()}isBonded(){return 0!==this.bondHash.countArray[this.index]}isRing(){return void 0!==this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]}isAromatic(){return 1===this.aromatic}isPolarHydrogen(){let t=!1;return 1!==this.number||(t=!this.hasBondToElement(6)),t}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(t){const e=this.atomStore,n=t.atomStore,i=this.index,r=t.index,s=e.x[i]-n.x[r],o=e.y[i]-n.y[r],a=e.z[i]-n.z[r],l=s*s+o*o+a*a;return Math.sqrt(l)}connectedTo(t){const e=this.atomStore,n=t.atomStore,i=this.index,r=t.index;if(e.altloc&&n.altloc){const t=e.altloc[i],s=n.altloc[r];if(0!==t&&0!==s&&32!==t&&32!==s&&t!==s)return!1}const s=e.x[i]-n.x[r],o=e.y[i]-n.y[r],a=e.z[i]-n.z[r],l=s*s+o*o+a*a;if(l<48&&this.isCg())return!0;if(isNaN(l))return!1;const c=this.covalent+t.covalent,u=c+.3,h=c-.5;return l<u*u&&l>h*h}positionFromArray(t,e=0){return this.x=t[e+0],this.y=t[e+1],this.z=t[e+2],this}positionToArray(t=[],e=0){const n=this.index,i=this.atomStore;return t[e+0]=i.x[n],t[e+1]=i.y[n],t[e+2]=i.z[n],t}positionToVector3(t){return void 0===t&&(t=new ue),t.x=this.x,t.y=this.y,t.z=this.z,t}positionFromVector3(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}positionAdd(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}positionSub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}getResidueBonds(t=!1){const e=this.residueAtomOffset,n=this.index-this.residueAtomOffset,i=this.residueType.getBonds(),r=i.atomIndices1,s=i.atomIndices2;let o,a,l,c;for(t||(c=[]),o=r.indexOf(n);-1!==o;){if(l=s[o]+e,!c)return l;c.push(l),o=r.indexOf(n,o+1)}for(a=s.indexOf(n);-1!==a;){if(l=r[a]+e,!c)return l;c.push(l),a=s.indexOf(n,a+1)}return c}qualifiedName(t=!1){var e="";return this.resname&&!t&&(e+="["+this.resname+"]"),void 0!==this.resno&&(e+=this.resno),this.inscode&&(e+="^"+this.inscode),this.chainname&&(e+=":"+this.chainname),this.atomname&&(e+="."+this.atomname),this.altloc&&(e+="%"+this.altloc),this.structure.modelStore.count>1&&(e+="/"+this.modelIndex),e}clone(){return new Vf(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function Hf(t,e){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function Gf(t,e){return Math.sqrt(Hf(t,e))}const $f=new Float32Array(3);class jf{constructor(t,e=!1){Ql&&Yl.time("Kdtree build");const n=e?Hf:Gf,i=new Float32Array(3*t.atomCount),r=new Uint32Array(t.atomCount);let s=0;t.eachAtom((function(t){i[s+0]=t.x,i[s+1]=t.y,i[s+2]=t.z,r[s/3]=t.index,s+=3})),this.atomIndices=r,this.points=i,this.kdtree=new zf(i,n),Ql&&Yl.timeEnd("Kdtree build")}nearest(t,e,n){t instanceof ue?t.toArray($f):t instanceof Vf&&t.positionToArray($f);const i=this.kdtree.nearest($f,e,n),r=this.kdtree.indices,s=this.kdtree.nodes,o=this.atomIndices,a=[];for(let t=0,e=i.length;t<e;++t){const e=i[t],n=e[0],l=e[1];a.push({index:o[r[s[n]]],distance:l})}return a}}const Wf={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},qf={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},Xf=/^[1-9]$/;function Yf(t){let e="";return t.length>0&&(e=":"+Oa(t).join(" OR :")),new Ll(e)}class Kf{constructor(t=""){this.name=t,this.partList=[]}get type(){return"Assembly"}addPart(t,e){const n=new Zf(t,e);return this.partList.push(n),n}getAtomCount(t){return this.partList.reduce(((e,n)=>e+n.getAtomCount(t)),0)}getResidueCount(t){return this.partList.reduce(((e,n)=>e+n.getResidueCount(t)),0)}getInstanceCount(){let t=0;return this.partList.forEach((function(e){t+=e.matrixList.length})),t}isIdentity(t){if(1!==this.partList.length)return!1;const e=this.partList[0];if(1!==e.matrixList.length)return!1;if(!(new ze).equals(e.matrixList[0]))return!1;let n=[];return t.eachChain((function(t){n.push(t.chainname)})),n=Oa(n),e.chainList.length===n.length}getBoundingBox(t){const e=new pe;return this.partList.forEach((function(n){const i=n.getBoundingBox(t);e.expandByPoint(i.min),e.expandByPoint(i.max)})),e}getCenter(t){return this.getBoundingBox(t).getCenter(new ue)}getSelection(){let t=[];return this.partList.forEach((function(e){t=t.concat(e.chainList)})),Yf(t)}}class Zf{constructor(t=[],e=[]){this.matrixList=t,this.chainList=e}get type(){return"AssemblyPart"}_getCount(t,e){let n=0;return t.eachChain((t=>{(0===this.chainList.length||this.chainList.includes(t.chainname))&&(n+=t[e])})),this.matrixList.length*n}getAtomCount(t){return this._getCount(t,"atomCount")}getResidueCount(t){return this._getCount(t,"residueCount")}getBoundingBox(t){const e=new pe,n=new pe,i=this.getSelection(),r=t.getBoundingBox(i);return this.matrixList.forEach((function(t){n.copy(r).applyMatrix4(t),e.expandByPoint(n.min),e.expandByPoint(n.max)})),e}getSelection(){return Yf(this.chainList)}getView(t){const e=this.getSelection();return e?t.getView(e):t}getInstanceList(){const t=[];for(let e=0,n=this.matrixList.length;e<n;++e)t.push({id:e+1,name:e,matrix:this.matrixList[e]});return t}}class Qf{constructor(t){this.structure=t,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(t){var e,n;const i=this.structure.atomStore,r=this.structure.residueStore,s=this.structure.residueMap,o=null===(e=this.structure.chemCompMap)||void 0===e?void 0:e.dict[this.previousResname],a=r.atomCount[t],l=r.atomOffset[t],c=new Array(a);for(let t=0;t<a;++t)c[t]=i.atomTypeId[l+t];const u=null==o?void 0:o.chemCompType,h=o?null===(n=this.structure.chemCompMap)||void 0===n?void 0:n.getBonds(this.previousResname,c):void 0;r.residueTypeId[t]=s.add(this.previousResname,c,this.previousHetero,u,h)}addAtom(t,e,n,i,r,s,o,a){const l=this.structure.atomStore,c=this.structure.residueStore,u=this.structure.chainStore,h=this.structure.modelStore;let d=!1,p=!1,f=!1;this.currentModelindex!==t?(d=!0,p=!0,f=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(p=!0,f=!0,this.ci+=1,this.ri+=1):this.currentResno===r&&this.currentResname===i&&this.currentInscode===a||(f=!0,this.ri+=1),this.ai+=1,d&&(h.growIfFull(),h.chainOffset[this.mi]=this.ci,h.chainCount[this.mi]=0,h.count+=1,u.modelIndex[this.ci]=this.mi),p&&(u.growIfFull(),u.setChainname(this.ci,e),u.setChainid(this.ci,n),u.residueOffset[this.ci]=this.ri,u.residueCount[this.ci]=0,u.count+=1,u.modelIndex[this.ci]=this.mi,h.chainCount[this.mi]+=1,c.chainIndex[this.ri]=this.ci),f&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),c.growIfFull(),c.resno[this.ri]=r,void 0!==o&&(c.sstruc[this.ri]=o.charCodeAt(0)),void 0!==a&&(c.inscode[this.ri]=a.charCodeAt(0)),c.atomOffset[this.ri]=this.ai,c.atomCount[this.ri]=0,c.count+=1,c.chainIndex[this.ri]=this.ci,u.residueCount[this.ci]+=1),l.count+=1,l.residueIndex[this.ai]=this.ri,c.atomCount[this.ri]+=1,this.currentModelindex=t,this.currentChainid=n,this.currentResname=i,this.currentResno=r,this.currentInscode=a,this.currentHetero=s}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function Jf(t,e){if(!e)return;Ql&&Yl.time("assignSecondaryStructure");const n=[];t.eachModel((function(t){t.eachChain((function(t){n.push(t.chainname)}))}));const i=n.slice().sort(),r=[];i.forEach((function(t){r.push(n.indexOf(t))}));const s=e.helices.filter((function(t){return Da(i,t[0])>=0}));s.sort((function(t,e){const n=t[0],s=e[0],o=t[1],a=e[1];if(n===s)return o===a?0:o<a?-1:1;{const t=Da(i,n),e=Da(i,s);return r[t]<r[e]?-1:1}}));const o=t.residueStore;t.eachModel((function(t){let e=0;const n=s.length;if(0===n)return;let i=s[e],r=!1,a=!1;t.eachChain((function(t){let l=!1;if(t.chainname===i[0]){const c=t.residueCount,u=t.residueOffset,h=u+c;for(let c=u;c<h;++c)if(o.resno[c]===i[1]&&o.getInscode(c)===i[2]&&(r=!0),r&&(o.sstruc[c]=i[6],o.resno[c]===i[4]&&o.getInscode(c)===i[5]&&(r=!1,e+=1,e<n?(c=u-1,i=s[e],l=t.chainname!==i[0]):a=!0)),l||a)return}}))}));const a=e.sheets.filter((function(t){return Da(i,t[0])>=0}));a.sort((function(t,e){const n=t[0],s=e[0];if(n===s)return 0;const o=Da(i,n),a=Da(i,s);return r[o]<r[a]?-1:1}));const l="e".charCodeAt(0);t.eachModel((function(t){let e=0;const n=a.length;if(0===n)return;let i=a[e],r=!1,s=!1;t.eachChain((function(t){let c=!1;if(t.chainname===i[0]){const u=t.residueCount,h=t.residueOffset,d=h+u;for(let u=h;u<d;++u)if(o.resno[u]===i[1]&&o.getInscode(u)===i[2]&&(r=!0),r&&(o.sstruc[u]=l,o.resno[u]===i[4]&&o.getInscode(u)===i[5]&&(r=!1,e+=1,e<n?(u=h-1,i=a[e],c=t.chainname!==i[0]):s=!0)),c||s)return}}))})),Ql&&Yl.timeEnd("assignSecondaryStructure")}const tm=function(){const t=function(t,e,n,i){const r=t.structure,s=t.residueIndexStart,o=r.getResidueProxy(),a=r.getResidueProxy(),l=r.getAtomProxy(),c=r.getAtomProxy();for(let r=Math.max(0,e-2);r<=e;++r)for(let e=2;e<5;++e){if(r+e>=t.residueCount)continue;o.index=s+r,a.index=s+r+e,l.index=o.traceAtomIndex,c.index=a.traceAtomIndex;const u=l.distanceTo(c);if(Math.abs(u-n[e-2])>i)return!1}return!0},e=function(e,n){return t(e,n,[5.45,5.18,6.37],2.1)},n=function(e,n){return t(e,n,[6.1,10.4,13],1.42)};return function(t){Ql&&Yl.time("calculateSecondaryStructure"),t.eachPolymer((function(t){if(t.residueCount<4)return;if(t.isCg())!function(t){const e=t.residueStore,n=t.residueIndexStart,i=new Bf(t).position,r=new ue,s=new ue;for(let o=0,a=t.residueCount;o<a;++o){r.fromArray(i.center,3*o),s.fromArray(i.center,3*o+3);const t=r.distanceTo(s);t<2&&t>1&&i.bending[o]<20&&(e.sstruc[n+o]="h".charCodeAt(0),e.sstruc[n+o+1]="h".charCodeAt(0))}}(t);else{if(!t.isProtein())return;!function(t){const i=t.residueStore,r=t.residueIndexStart;for(let s=0,o=t.residueCount;s<o;++s){let o="c";e(t,s)?o="h":n(t,s)&&(o="e"),i.sstruc[r+s]=o.charCodeAt(0)}}(t)}let i,r=0;t.eachResidue((function(t){t.sstruc===i?r+=1:(1===r&&(t.index-=1,t.sstruc="c"),r=1,i=t.sstruc)}))})),Ql&&Yl.timeEnd("calculateSecondaryStructure")}}(),em="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function nm(t){let e=t,n=0,i=em[e%26];for(;e>=26;)e=Math.floor(e/26),i+=em[e%26],n+=1;return n>=5&&Yl.warn("chainname overflow"),i}function im(t,e=!1){Ql&&Yl.time("calculateChainnames");let n=!0;if(t.eachChain((function(t){t.chainname&&(n=!1)})),n){const n=t.modelStore,i=t.chainStore,r=t.residueStore,s=function(t,e,s,o){const a=i.count;for(let t=0;t<o;++t)r.chainIndex[s+t]=a;i.growIfFull(),i.modelIndex[a]=t,i.setChainname(a,e),i.setChainid(a,e),i.residueOffset[a]=s,i.residueCount[a]=o,i.count+=1,n.chainCount[t]+=1},o=t.getAtomProxy(),a=t.getAtomProxy();let l=0,c=0,u=0,h=0;const d=[];1===r.count?d.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):t.eachResidueN(2,(function(t,n){let i=!1;const s=t.backboneType,p=n.backboneType,f=rd;h=t.index,t.modelIndex!==n.modelIndex||t.moleculeType!==n.moleculeType?i=!0:s!==f&&s===p&&(o.index=t.backboneEndAtomIndex,a.index=n.backboneStartAtomIndex,i=e?!o.hasBondTo(a):!o.connectedTo(a)),i||n.index!==r.count-1||(i=!0,h=n.index),i&&(d.push({mIndex:c,chainname:nm(l),rStart:u,rCount:h-u+1}),l+=1,t.modelIndex!==n.modelIndex&&(l=0,c+=1),n.index===r.count-1&&h!==n.index&&d.push({mIndex:c,chainname:nm(l),rStart:r.count-1,rCount:1}),u=n.index,h=n.index)})),i.count=0,n.chainCount.fill(0,0,n.count),n.chainOffset.fill(0,0,n.count),d.forEach((function(t){s(t.mIndex,t.chainname,t.rStart,t.rCount)}));let p=0;t.eachModel((function(t){n.chainOffset[t.index]=p,p+=n.chainCount[t.index]}))}Ql&&Yl.timeEnd("calculateChainnames")}function rm(t,e="all"){"none"!==e&&(Ql&&Yl.time("calculateBonds"),am(t,!1,e),lm(t),Ql&&Yl.timeEnd("calculateBonds"))}const sm={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function om(t,e,n){return[e,n]=e<n?[e,n]:[n,e],xd.includes(t)&&"C"===e&&"O"===n||Md.includes(t)&&"OP1"===e&&"P"===n?2:sm[`${t}|${e}|${n}`]||1}function am(t,e=!1,n="all"){Ql&&Yl.time("calculateBondsWithin");const i=t.bondStore,r=t.rungBondStore,s=t.getAtomSet(!1),o=t.getAtomProxy(),a=t.getAtomProxy(),l=t.getBondProxy(),c=e?null:function(t){Ql&&Yl.time("calculateAtomBondMap");var e=[];return t.eachBond((function(t){var n=t.atomIndex1,i=t.atomIndex2;void 0===e[n]&&(e[n]=[]),e[n][i]=t.index})),Ql&&Yl.timeEnd("calculateAtomBondMap"),e}(t);let u;e||"auto"!==n||(u=new Set,c.forEach(((t,e)=>{u.add(e),t.forEach((t=>{u.add(t)}))}))),t.eachResidue((function(t){if(!e&&c){const e=t.atomCount,r=t.atomOffset;if(e>500)return void Yl.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());if("auto"===n&&t.hetero)for(let e=t.atomOffset;e<t.atomEnd;e++)if(u.has(e))return;const s=t.getBonds(),h=s.atomIndices1,d=s.atomIndices2,p=s.bondOrders,f=h.length;for(let e=0;e<f;++e){const n=h[e],s=d[e],u=n+r,f=s+r,m=c[u];void 0!==m&&void 0!==m[f]?(l.index=m[f],p[t.residueType.getBondIndex(n,s)]=l.bondOrder):(o.index=u,a.index=f,i.addBond(o,a,p[e]))}}const h=t.residueType.traceAtomIndex,d=t.residueType.rungEndAtomIndex;-1!==h&&-1!==d&&(o.index=t.traceAtomIndex,a.index=t.rungEndAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))})),t.atomSetDict.rung=s,Ql&&Yl.timeEnd("calculateBondsWithin")}function lm(t,e=!1,n=!1){Ql&&Yl.time("calculateBondsBetween");const i=t.bondStore,r=t.backboneBondStore,s=t.getAtomSet(!1),o=t.getAtomProxy(),a=t.getAtomProxy();function l(t,l){const c=t.backboneType,u=l.backboneType;if(c!==rd&&c===u){o.index=t.backboneEndAtomIndex,a.index=l.backboneStartAtomIndex;let c=!1,u=!1;n&&o.hasBondTo(a)?(c=!1,u=!0):o.connectedTo(a)&&(c=!e,u=!0),c&&i.addBond(o,a,1),u&&(o.index=t.traceAtomIndex,a.index=l.traceAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))}}0===r.count&&r.resize(t.residueStore.count),t.eachResidueN(2,l);const c=t.getResidueProxy(),u=t.getResidueProxy();if(t.eachChain((function(t){0!==t.residueCount&&(c.index=t.residueOffset,u.index=t.residueOffset+t.residueCount-1,l(u,c))})),t.atomSetDict.backbone=s,!e){Ql&&Yl.time("calculateBondsBetween inter");const e=t.spatialHash;t.eachResidue((function(t){t.backboneType!==rd||t.isWater()||t.eachAtom((function(t){t.isMetal()||e.eachWithin(t.x,t.y,t.z,4,(function(e){a.index=e,t.modelIndex!==a.modelIndex||t.residueIndex===a.residueIndex||a.isMetal()||i.addBondIfConnected(t,a,1)}))}))})),Ql&&Yl.timeEnd("calculateBondsBetween inter")}Ql&&Yl.timeEnd("calculateBondsBetween")}function cm(t){if(!t.unitcell)return;Ql&&Yl.time("buildUnitcellAssembly");const e=t.unitcell,n=t.center.clone().applyMatrix4(e.cartToFrac),i=n.clone().floor(),r=function(t){const e=qf[t],n={};if(void 0===e)return console.warn(`spacegroup '${t}' not found in symop library`),n;const i=[];for(let t=0,n=e.length;t<n;t+=3){const n=[];for(let i=0;i<3;++i)n.push(Wf[e[t+i]]);i.push(n)}return i.forEach((function(t){let e=0;const i=(new ze).set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),r=i.elements;n[t.toString()]=i,t.forEach((function(t){let n=!1,i=!1;for(let s=0,o=t.length;s<o;++s){const o=t[s];if("-"===o)n=!0;else if("+"===o)n=!1;else if("/"===o)i=!0;else if("X"===o)r[0+e]=n?-1:1;else if("Y"===o)r[4+e]=n?-1:1;else if("Z"===o)r[8+e]=n?-1:1;else if(Xf.test(o)){const t=parseInt(o);i?r[12+e]/=t:r[12+e]=t}else Yl.warn(`getSymmetryOperations: unknown token '${o}'`)}e+=1}))})),n}(e.spacegroup),s=new ue,o=new ue;function a(t){const a=[];return Object.keys(r).forEach((function(l){const c=r[l].clone();s.copy(n).applyMatrix4(c).floor(),o.setFromMatrixPosition(c),o.sub(s),o.add(i),t&&o.add(t),c.setPosition(o),c.multiplyMatrices(e.fracToCart,c),c.multiply(e.cartToFrac),a.push(c)})),a}const l=new Kf("UNITCELL"),c=a(),u=[];if(t.biomolDict.NCS){u.push(new ze,...t.biomolDict.NCS.partList[0].matrixList);const e=[];c.forEach((t=>{u.forEach((n=>{e.push(t.clone().multiply(n))}))})),l.addPart(e)}else l.addPart(c);const h=new ue,d=new Kf("SUPERCELL"),p=Array.prototype.concat.call(a(h.set(1,0,0)),a(h.set(0,1,0)),a(h.set(0,0,1)),a(h.set(-1,0,0)),a(h.set(0,-1,0)),a(h.set(0,0,-1)),a(h.set(1,1,0)),a(h.set(1,0,1)),a(h.set(0,1,1)),a(h.set(-1,-1,0)),a(h.set(-1,0,-1)),a(h.set(0,-1,-1)),a(h.set(1,-1,-1)),a(h.set(1,1,-1)),a(h.set(1,-1,1)),a(h.set(-1,1,1)),a(h.set(-1,-1,1)),a(h.set(-1,1,-1)),a(h.set(0,1,-1)),a(h.set(0,-1,1)),a(h.set(1,0,-1)),a(h.set(-1,0,1)),a(h.set(1,-1,0)),a(h.set(-1,1,0)),a(),a(h.set(1,1,1)),a(h.set(-1,-1,-1)));if(t.biomolDict.NCS){const t=[];p.forEach((function(e){u.forEach((function(n){t.push(e.clone().multiply(n))}))})),d.addPart(t)}else d.addPart(p);t.biomolDict.UNITCELL=l,t.biomolDict.SUPERCELL=d,Ql&&Yl.timeEnd("buildUnitcellAssembly")}const um=["H","C","O","N","S","P"],hm=["NA","CL","FE"];function dm(t){let e=t.toUpperCase(),n=0,i=0;for(let t=0;t<e.length;t++)if(e.charCodeAt(t)<65){if(i>0)break;++n}else i=t+1;(n>0||i<e.length)&&(e=e.substring(n,i));const r=e.length;if(0===r)return"";if(1===r)return e;if(2===r){if(-1!==hm.indexOf(e))return e;if(-1!==um.indexOf(e[0]))return e[0];if(e in pd)return e}return r>=3&&-1!==um.indexOf(e[0])?e[0]:""}function pm(t){const e=t.bondHash,n=e.countArray,i=e.offsetArray,r=e.indexArray,s=t.getBondProxy();t.eachResidue((function(t){const e=t.residueType;if(void 0!==e.bonds)return;var o=t.atomOffset,a=[],l=[],c=[],u={};const h=o+t.atomCount;t.eachAtom((function(t){const e=t.index,d=i[e];for(let t=0,i=n[e];t<i;++t){s.index=r[d+t];let e=s.atomIndex1;if(e<o||e>=h)continue;let n=s.atomIndex2;if(n<o||n>=h)continue;if(e>n){const t=n;n=e,e=t}const i=e+"|"+n;void 0===u[i]&&(u[i]=!0,a.push(e-o),l.push(n-o),c.push(s.bondOrder))}})),e.bonds={atomIndices1:a,atomIndices2:l,bondOrders:c}}))}function fm(t,...e){Ql&&Yl.time("concatStructures");const n=new Fm(t,""),i=new Qf(n),r=n.atomStore,s=n.atomMap;r.addField("formalCharge",1,"int8"),r.addField("partialCharge",1,"float32");const o={};let a=0,l=0,c=0;e.forEach((t=>{t.eachAtom((t=>{r.growIfFull(),r.atomTypeId[a]=s.add(t.atomname,t.element),r.x[a]=t.x,r.y[a]=t.y,r.z[a]=t.z,r.serial[a]=t.serial,r.formalCharge[a]=t.formalCharge,r.partialCharge[a]=t.partialCharge,r.altloc[a]=t.altloc,r.occupancy[a]=t.occupancy,r.bfactor[a]=t.bfactor,i.addAtom(t.modelIndex+c,t.chainname,t.chainid,t.resname,t.resno,1===t.hetero,t.sstruc,t.inscode),o[t.index+l]=a,a+=1})),l+=t.atomStore.count,c+=t.modelStore.count}));const u=n.bondStore,h=n.getAtomProxy(),d=n.getAtomProxy();return l=0,e.forEach((t=>{t.eachBond((t=>{h.index=o[t.atomIndex1+l],d.index=o[t.atomIndex2+l],u.addBond(h,d,t.bondOrder)})),l+=t.atomStore.count})),i.finalize(),lm(n,!0),am(n,!0),n.finalizeAtoms(),n.finalizeBonds(),pm(n),Ql&&Yl.timeEnd("concatStructures"),n}const mm=[3,11,19,37,55,87],gm=[4,12,20,38,56,88],_m=[6,15,16,34],vm=[1,7,8,9,17,35,53],ym=[2,10,18,36,54,86],bm=[13,30,31,48,49,50,80,81,82,83,84,85,112],xm=[5,14,32,33,51,52,85],wm=[9,17,35,53,85];class Sm{constructor(t,e,n){this.structure=t,this.atomname=e,n=n||dm(e),this.element=n,this.number=pd[n]||0,this.vdw=fd[this.number]||2,this.covalent=md[this.number]||1.6}getDefaultValence(){const t=gd[this.number];return t?t[0]:-1}getValenceList(){return gd[this.number]||[]}getOuterShellElectronCount(){return _d[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return xm.includes(this.number)}isHalogen(){return wm.includes(this.number)}isDiatomicNonmetal(){return vm.includes(this.number)}isPolyatomicNonmetal(){return _m.includes(this.number)}isAlkaliMetal(){return mm.includes(this.number)}isAlkalineEarthMetal(){return gm.includes(this.number)}isNobleGas(){return ym.includes(this.number)}isTransitionMetal(){const t=this.number;return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}isPostTransitionMetal(){return bm.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class Am{constructor(t){this.structure=t,this.dict={},this.list=[],this.structure=t}add(t,e){const n=function(t,e){return t+"|"+e}(t=t.toUpperCase(),e=e?e.toUpperCase():dm(t));let i=this.dict[n];if(void 0===i){const r=new Sm(this.structure,t,e);i=this.list.length,this.dict[n]=i,this.list.push(r)}return i}get(t){return this.list[t]}}class Mm{constructor(t,e,n,i,r,s){this.structure=t,this.bondReferenceAtomIndices=[],this.resname=e,this.atomTypeIdList=n,this.hetero=i?1:0,this.chemCompType=r,this.bonds=s,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const o=Rd[this.backboneType],a=Rd[this.backboneStartType],l=Rd[this.backboneEndType],c=this.getAtomIndexByName(o.trace);this.traceAtomIndex=Aa(c,-1);const u=this.getAtomIndexByName(o.direction1);this.direction1AtomIndex=Aa(u,-1);const h=this.getAtomIndexByName(o.direction2);this.direction2AtomIndex=Aa(h,-1);const d=this.getAtomIndexByName(a.backboneStart);this.backboneStartAtomIndex=Aa(d,-1);const p=this.getAtomIndexByName(l.backboneEnd);let f;this.backboneEndAtomIndex=Aa(p,-1),f=Ad.includes(e)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=Aa(f,-1)}getBackboneIndexList(){const t=[];let e;switch(this.moleculeType){case 3:e=Pd;break;case 4:case 5:e=Id;break;default:return t}const n=this.structure.atomMap,i=this.atomTypeIdList;for(let r=0,s=this.atomCount;r<s;++r){const s=n.get(i[r]);e.includes(s.atomname)&&t.push(r)}return t}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(t){return this.hasProteinBackbone(t)?1:this.hasRnaBackbone(t)?2:this.hasDnaBackbone(t)?3:this.hasCgProteinBackbone(t)?4:this.hasCgRnaBackbone(t)?5:this.hasCgDnaBackbone(t)?6:rd}isProtein(){return this.chemCompType?sd.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||xd.includes(this.resname)}isCg(){const t=this.backboneType;return 4===t||5===t||6===t}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?od.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||wd.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?ad.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||Sd.includes(this.resname))}isHetero(){return 1===this.hetero}isIon(){return Ed.includes(this.resname)}isWater(){return Cd.includes(this.resname)}isSaccharide(){return this.chemCompType?ld.includes(this.chemCompType):Td.includes(this.resname)}isStandardAminoacid(){return xd.includes(this.resname)}isStandardBase(){return Md.includes(this.resname)}hasBackboneAtoms(t,e){const n=Rd[e];return-1===t?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):0===t?this.hasAtomWithName(n.trace,n.direction1,n.direction2):1===t?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(t){return this.isProtein()&&this.hasBackboneAtoms(t,1)}hasRnaBackbone(t){return this.isRna()&&this.hasBackboneAtoms(t,2)}hasDnaBackbone(t){return this.isDna()&&this.hasBackboneAtoms(t,3)}hasCgProteinBackbone(t){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(t,4)}hasCgRnaBackbone(t){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(t,5)}hasCgDnaBackbone(t){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(t,6)}hasBackbone(t){return this.hasProteinBackbone(t)||this.hasRnaBackbone(t)||this.hasDnaBackbone(t)||this.hasCgProteinBackbone(t)||this.hasCgRnaBackbone(t)||this.hasCgDnaBackbone(t)}getAtomIndexByName(t){const e=this.atomCount,n=this.structure.atomMap,i=this.atomTypeIdList;if(Array.isArray(t))for(let r=0;r<e;++r){const e=i[r];if(t.includes(n.get(e).atomname))return r}else for(let r=0;r<e;++r){const e=i[r];if(t===n.get(e).atomname)return r}}hasAtomWithName(...t){const e=t.length;for(let n=0;n<e;++n)if(void 0!==t[n]&&void 0===this.getAtomIndexByName(t[n]))return!1;return!0}getBonds(t){return void 0===this.bonds&&(this.bonds=function(t){const e=t.structure,n=e.getAtomProxy(),i=e.getAtomProxy(),r=t.atomCount,s=t.atomOffset,o=s+r-1,a=[],l=[],c=[];if(r>500)Ql&&Yl.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(r>50){const e=new jf(t,!0),r=t.isCg()?1.2:2.3;for(let t=s;t<o;++t){n.index=t;const o=n.covalent+r+.3,u=e.nearest(n,1/0,o*o),h=u.length;for(let t=0;t<h;++t)i.index=u[t].index,n.index<i.index&&n.connectedTo(i)&&(a.push(n.index-s),l.push(i.index-s),c.push(om(n.resname,n.atomname,i.atomname)))}}else for(let t=s;t<o;++t){n.index=t;for(let e=t+1;e<=o;++e)i.index=e,n.connectedTo(i)&&(a.push(t-s),l.push(e-s),c.push(om(n.resname,n.atomname,i.atomname)))}return{atomIndices1:a,atomIndices2:l,bondOrders:c}}(t)),this.bonds}getRings(){return void 0===this.rings&&this.calculateRings(),this.rings}getBondGraph(){return void 0===this.bondGraph&&this.calculateBondGraph(),this.bondGraph}getAromatic(t){return void 0===this.aromaticAtoms&&this.calculateAromatic(this.structure.getResidueProxy(t.residueIndex)),this.aromaticAtoms}getAromaticRings(t){return void 0===this.aromaticRings&&this.calculateAromatic(t),this.aromaticRings}calculateBondGraph(){const t=this.bondGraph={},e=this.getBonds(),n=e.atomIndices1.length,i=e.atomIndices1,r=e.atomIndices2;for(let e=0;e<n;++e){const n=i[e],s=r[e];(t[n]=t[n]||[]).push(s),(t[s]=t[s]||[]).push(n)}}calculateRings(){const t=function(t,e){const n={count:e,visited:new Int32Array(e),queue:new Int32Array(e),pred:new Int32Array(e),left:new Int32Array(Im),right:new Int32Array(Im),color:new Int32Array(e),currentColor:0,rings:[],atomRings:[],bonds:t};for(let t=0;t<e;t++)n.visited[t]=-1,n.pred[t]=-1;return n}(this.getBondGraph(),this.atomCount);for(let e=0;e<t.count;e++)t.visited[e]>=0||Pm(t,e);this.rings={atomRings:t.atomRings,rings:t.rings}}isAromatic(t){return this.aromaticAtoms=this.getAromatic(t),1===this.aromaticAtoms[t.index-t.residueAtomOffset]}calculateAromatic(t){const e=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,i=n.map((e=>function(t){if(t.some((t=>!Cm.includes(t.number))))return!1;let e=0;const n=new Ap(3,t.length),i=n.data;return t.forEach((t=>{i[e+0]=t.x,i[e+1]=t.y,i[e+2]=t.z,e+=3})),new Pf(n).vecC.length()<Em}(e.map((e=>this.structure.getAtomProxy(e+t.atomOffset)))))),r=this.aromaticRings=[];n.forEach(((t,n)=>{i[n]&&(r.push(t),t.forEach((t=>e[t]=1)))}))}assignBondReferenceAtomIndices(){const t=this.getBondGraph(),e=this.getRings(),n=e.atomRings,i=e.rings,r=this.bonds,s=r.atomIndices1,o=r.atomIndices2,a=r.bondOrders,l=this.bondReferenceAtomIndices,c=r.atomIndices1.length;l.length=0;for(let e=0;e<c;++e){if(a[e]<=1)continue;let r;const c=s[e],u=o[e],h=n[c],d=n[u];if(h&&d)for(let t=0;t<h.length;t++)if(-1!==d.indexOf(h[t])){r=i[h[t]];break}if(t[c].length>1)for(let n=0;n<t[c].length;++n){const i=t[c][n];if(i!==u&&(void 0===r||-1!==r.indexOf(i))){l[e]=i;break}}else if(t[u].length>1)for(let n=0;n<t[u].length;++n){const i=t[u][n];if(i!==c&&(void 0===r||-1!==r.indexOf(i))){l[e]=i;break}}}}getBondIndex(t,e){const n=this.bonds,i=n.atomIndices1,r=n.atomIndices2;let s=i.indexOf(t),o=r.indexOf(e);const a=o;for(;-1!==s;){for(;-1!==o;){if(s===o)return s;o=r.indexOf(e,o+1)}s=i.indexOf(t,s+1),o=a}}getBondReferenceAtomIndex(t,e){const n=this.getBondIndex(t,e);if(void 0!==n)return 0===this.bondReferenceAtomIndices.length&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const Cm=[5,6,7,8,14,15,16,32,33,50,51,83],Em=.05;function Tm(t,e,n){if(n<e)return;const{pred:i,color:r,left:s,right:o}=t,a=++t.currentColor;let l=e;for(let t=0;t<Im&&(r[l]=a,l=i[l],!(l<0));t++);let c=0,u=0,h=!1,d=0;l=n;for(let t=0;t<Im;t++){if(r[l]===a){d=l,h=!0;break}if(o[u++]=l,l=i[l],l<0)break}if(!h)return;l=e;for(let t=0;t<Im&&(s[c++]=l,d!==l)&&(l=i[l],!(l<0));t++);const p=c+u,f=new Array(p);let m=0;for(let t=0;t<c;t++)f[m++]=s[t];for(let t=u-1;t>=0;t--)f[m++]=o[t];const g=t.rings.length;for(let e=0;e<p;++e){const n=f[e];t.atomRings[n]?t.atomRings[n].push(g):t.atomRings[n]=[g]}t.rings.push(f)}function Pm(t,e){const{bonds:n,visited:i,queue:r,pred:s}=t;i[e]=1,r[0]=e;let o=0,a=1;for(;o<a;){const e=r[o++],l=0;if(void 0===n[e])continue;const c=n[e].length;for(let o=l;o<c;o++){const l=n[e][o];i[l]>0?s[l]!==e&&s[e]!==l&&Tm(t,e,l):(i[l]=1,r[a++]=l,s[l]=e)}}}const Im=4;class Rm{constructor(t){this.structure=t,this.dict={},this.list=[]}add(t,e,n,i="",r){const s=function(t,e,n,i=""){return t+"|"+e.join(",")+"|"+(n?1:0)+"|"+i}(t=t.toUpperCase(),e,n,i);let o=this.dict[s];if(void 0===o){const a=new Mm(this.structure,t,e,n,i,r);o=this.list.length,this.dict[s]=o,this.list.push(a)}return o}get(t){return this.list[t]}}class km{constructor(t,e=0){this.structure=t,this.index=e,this.bondStore=t.bondStore,this._v12=new ue,this._v13=new ue,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(t){this.bondStore.atomIndex1[this.index]=t}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(t){this.bondStore.atomIndex2[this.index]=t}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(t){this.bondStore.bondOrder[this.index]=t}getOtherAtomIndex(t){return t===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(t){return this.structure.getAtomProxy(this.getOtherAtomIndex(t.index))}getReferenceAtomIndex(){const t=this._ap1,e=this._ap2;if(t.index=this.atomIndex1,e.index=this.atomIndex2,t.residueIndex!==e.residueIndex)return;const n=t.index-t.residueAtomOffset,i=e.index-e.residueAtomOffset,r=t.residueType.getBondReferenceAtomIndex(n,i);if(void 0!==r)return r+t.residueAtomOffset;console.warn("No reference atom found",t.index,e.index)}calculateShiftDir(t=new ue){const e=this._ap1,n=this._ap2,i=this._ap3,r=this._v12,s=this._v13;e.index=this.atomIndex1,n.index=this.atomIndex2;const o=this.getReferenceAtomIndex();r.subVectors(e,n).normalize(),void 0!==o?(i.index=o,s.subVectors(e,i)):s.copy(e),s.normalize();let a=r.dot(s);return 1-Math.abs(a)<1e-5&&(s.set(1,0,0),a=r.dot(s),1-Math.abs(a)<1e-5&&(s.set(0,1,0),a=r.dot(s))),t.copy(s.sub(r.multiplyScalar(a))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new km(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class Dm{constructor(t,e=0){this.structure=t,this.index=e,this.chainStore=t.chainStore,this.residueStore=t.residueStore,this.atomStore=t.atomStore,this.residueMap=t.residueMap,this.atomMap=t.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(t){this.residueStore.chainIndex[this.index]=t}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(t){this.residueStore.atomOffset[this.index]=t}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(t){this.residueStore.atomCount[this.index]=t}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(t){this.residueStore.resno[this.index]=t}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(t){this.residueStore.setSstruc(this.index,t)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(t){this.residueStore.setInscode(this.index,t)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let t=0;for(let e=this.atomOffset;e<=this.atomEnd;++e)t+=this.atomStore.x[e];return t/this.atomCount}get y(){let t=0;for(let e=this.atomOffset;e<=this.atomEnd;++e)t+=this.atomStore.y[e];return t/this.atomCount}get z(){let t=0;for(let e=this.atomOffset;e<=this.atomEnd;++e)t+=this.atomStore.z[e];return t/this.atomCount}eachAtom(t,e){const n=this.atomCount,i=this.atomOffset,r=this.structure._ap,s=i+n;if(e&&e.atomOnlyTest){const n=e.atomOnlyTest;for(let e=i;e<s;++e)r.index=e,n(r)&&t(r)}else for(let e=i;e<s;++e)r.index=e,t(r)}positionToArray(t=[],e=0){return t[e+0]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}isProtein(){return 3===this.residueType.moleculeType}isNucleic(){const t=this.residueType.moleculeType;return 4===t||5===t}isRna(){return 4===this.residueType.moleculeType}isDna(){return 5===this.residueType.moleculeType}isCg(){const t=this.residueType.backboneType;return 4===t||5===t||6===t}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const t=this.residueType.moleculeType;return 3===t||4===t||5===t}}isHetero(){return 1===this.residueType.hetero}isWater(){return 1===this.residueType.moleculeType}isIon(){return 2===this.residueType.moleculeType}isSaccharide(){return 6===this.residueType.moleculeType}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return ud.includes(this.sstruc)}isSheet(){return hd.includes(this.sstruc)}isTurn(){return dd.includes(this.sstruc)&&this.isProtein()}getAtomType(t){return this.atomMap.get(this.atomStore.atomTypeId[t])}getResname1(){return bd[this.resname.toUpperCase()]||"X"}getBackboneType(t){switch(t){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(t){let e=this.residueType.getAtomIndexByName(t);return void 0!==e&&(e+=this.atomOffset),e}hasAtomWithName(t){return this.residueType.hasAtomWithName(t)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const t=this.atomCount,e=this.atomOffset,n=new Array(t);for(let i=0;i<t;++i)n[i]=this.getAtomType(e+i).atomname;return n}connectedTo(t){const e=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(t.backboneStartAtomIndex);return!(!e||!n)&&e.connectedTo(n)}getNextConnectedResidue(){const t=this.chainStore.residueOffset[this.chainIndex],e=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<t+e){const t=this.structure.getResidueProxy(n);if(this.connectedTo(t))return t}else if(n===t+e){const e=this.structure.getResidueProxy(t);if(this.connectedTo(e))return e}}getPreviousConnectedResidue(t){const e=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=e){const e=Aa(t,this.structure.getResidueProxy());if(e.index=n,e.connectedTo(this))return e}else if(n===e-1){const n=this.chainStore.residueCount[this.chainIndex],i=Aa(t,this.structure.getResidueProxy());if(i.index=e+n-1,i.connectedTo(this))return i}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(t=!1){let e="";return this.resname&&!t&&(e+="["+this.resname+"]"),void 0!==this.resno&&(e+=this.resno),this.inscode&&(e+="^"+this.inscode),this.chain&&(e+=":"+this.chainname),e+="/"+this.modelIndex,e}clone(){return new Dm(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class Lm{constructor(t,e,n){this.structure=t,this.residueIndexStart=e,this.residueIndexEnd=n,this.chainStore=t.chainStore,this.residueStore=t.residueStore,this.atomStore=t.atomStore,this.residueCount=n-e+1;const i=this.structure.getResidueProxy(this.residueIndexStart),r=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=void 0!==i.getPreviousConnectedResidue();const s=r.getNextConnectedResidue();this.isNextConnected=void 0!==s,this.isNextNextConnected=void 0!==s&&void 0!==s.getNextConnectedResidue(),this.isCyclic=r.connectedTo(i),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(t){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(t)}getAtomIndexByType(t,e){this.isCyclic?-1===t?t=this.residueCount-1:t===this.residueCount&&(t=0):(-1!==t||this.isPrevConnected||(t+=1),t!==this.residueCount||this.isNextNextConnected||(t-=1));const n=this.__residueProxy;let i;switch(n.index=this.residueIndexStart+t,e){case"trace":i=n.traceAtomIndex;break;case"direction1":i=n.direction1AtomIndex;break;case"direction2":i=n.direction2AtomIndex;break;default:i=n.getAtomIndexByName(e)}return i}eachAtom(t,e){this.eachResidue((function(n){n.eachAtom(t,e)}))}eachAtomN(t,e,n){const i=this.residueCount,r=new Array(t);for(let e=0;e<t;++e)r[e]=this.structure.getAtomProxy(this.getAtomIndexByType(e,n));e.apply(this,r);for(var s=t;s<i;++s){for(let e=1;e<t;++e)r[e-1].index=r[e].index;r[t-1].index=this.getAtomIndexByType(s,n),e.apply(this,r)}}eachResidue(t){const e=this.structure.getResidueProxy(),n=this.residueCount,i=this.residueIndexStart;for(let r=0;r<n;++r)e.index=i+r,t(e)}qualifiedName(){const t=this.structure.getResidueProxy(this.residueIndexStart),e=this.structure.getResidueProxy(this.residueIndexEnd);return t.qualifiedName()+" - "+e.qualifiedName()}}class Om{constructor(t,e=0){this.structure=t,this.index=e,this.chainStore=t.chainStore,this.residueStore=t.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(t){this.chainStore.entityIndex[this.index]=t}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(t){this.chainStore.modelIndex[this.index]=t}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(t){this.chainStore.residueOffset[this.index]=t}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(t){this.chainStore.residueCount[this.index]=t}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(t){this.chainStore.setChainname(this.index,t)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(t){this.chainStore.setChainid(this.index,t)}eachAtom(t,e){this.eachResidue((function(n){n.eachAtom(t,e)}),e)}eachResidue(t,e){const n=this.residueCount,i=this.residueOffset,r=this.structure._rp,s=i+n;if(e&&e.test){const n=e.residueOnlyTest;if(n)for(let e=i;e<s;++e)r.index=e,n(r)&&t(r);else for(let e=i;e<s;++e)r.index=e,t(r)}else for(let e=i;e<s;++e)r.index=e,t(r)}eachResidueN(t,e){const n=this.residueCount,i=this.residueOffset,r=i+n;if(n<t)return;const s=new Array(t);for(let e=0;e<t;++e)s[e]=this.structure.getResidueProxy(i+e);e.apply(this,s);for(let n=i+t;n<r;++n){for(let e=0;e<t;++e)s[e].index+=1;e.apply(this,s)}}eachPolymer(t,e){let n=0,i=0;const r=e?e.residueOnlyTest:void 0,s=this.model.structure,o=this.residueCount,a=this.residueOffset,l=a+o,c=this.structure.getResidueProxy(),u=this.structure.getResidueProxy(a),h=this.structure.getAtomProxy(),d=this.structure.getAtomProxy();let p=!0;for(let e=a+1;e<l;++e){c.index=u.index,u.index=e;const o=p?c.backboneEndType:c.backboneType,a=u.backboneType;p&&(n=c.index,p=!1),i=u.index,o!==rd&&o===a?(h.index=c.backboneEndAtomIndex,d.index=u.backboneStartAtomIndex,h&&d&&h.connectedTo(d)&&(!r||r(c)&&r(u))||(c.index-n>1&&t(new Lm(s,n,c.index)),n=i)):(o!==rd&&c.index-n>1&&t(new Lm(s,n,c.index)),n=i)}i-n>1&&this.structure.getResidueProxy(n).backboneEndType&&t(new Lm(s,n,i))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new Om(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class Nm{constructor(t,e=0){this.structure=t,this.index=e,this.modelStore=t.modelStore,this.chainStore=t.chainStore,this.residueStore=t.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(t){this.modelStore.chainOffset[this.index]=t}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(t){this.modelStore.chainCount[this.index]=t}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return 0===this.chainCount?0:this.residueEnd-this.residueOffset+1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}eachAtom(t,e){this.eachChain((function(n){n.eachAtom(t,e)}),e)}eachResidue(t,e){this.eachChain((function(n){n.eachResidue(t,e)}),e)}eachPolymer(t,e){if(e&&e.chainOnlyTest){const n=e.chainOnlyTest;this.eachChain((function(i){n(i)&&i.eachPolymer(t,e)}))}else this.eachChain((function(n){n.eachPolymer(t,e)}))}eachChain(t,e){const n=this.chainCount,i=this.chainOffset,r=this.structure._cp,s=i+n;if(e&&e.test){const n=e.chainOnlyTest;if(n)for(let e=i;e<s;++e)r.index=e,n(r)&&t(r);else for(let e=i;e<s;++e)r.index=e,t(r)}else for(let e=i;e<s;++e)r.index=e,t(r)}qualifiedName(){return"/"+this.index}clone(){return new Nm(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class Fm{constructor(t="",e=""){this.signals={refreshed:new va.Signal},this.init(t,e)}init(t,e){this.name=t,this.path=e,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new kf(0),this.backboneBondStore=new kf(0),this.rungBondStore=new kf(0),this.atomStore=new Df(0),this.residueStore=new Lf(0),this.chainStore=new Of(0),this.modelStore=new Nf(0),this.atomMap=new Am(this),this.residueMap=new Rm(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new ue,this.boundingBox=new pe,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new ue),this.spatialHash=new Yh(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new Rf(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let t in this.atomSetDict)this.atomSetCache["__"+t]=this.atomSetDict[t].clone()}getBondProxy(t){return new km(this,t)}getAtomProxy(t){return new Vf(this,t)}getResidueProxy(t){return new Dm(this,t)}getChainProxy(t){return new Om(this,t)}getModelProxy(t){return new Nm(this,t)}getBondSet(){const t=this.bondStore.count,e=new Jh(t),n=this.atomSet;if(n)if(n.isAllSet())e.setAll();else if(n.isAllClear())e.clearAll();else{const i=this.getBondProxy();for(let r=0;r<t;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&e.set(i.index)}else e.setAll();return e}getBackboneBondSet(){const t=this.backboneBondStore.count,e=new Jh(t),n=this.atomSetCache.__backbone;if(n){const i=this.getBondProxy();i.bondStore=this.backboneBondStore;for(let r=0;r<t;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&e.set(i.index)}else e.setAll();return e}getRungBondSet(){const t=this.rungBondStore.count,e=new Jh(t),n=this.atomSetCache.__rung;if(n){const i=this.getBondProxy();i.bondStore=this.rungBondStore;for(let r=0;r<t;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&e.set(i.index)}else e.setAll();return e}getAtomSet(t){const e=this.atomStore.count;if(void 0===t)return new Jh(e,!0);if(t instanceof Jh)return t;if(!0===t)return new Jh(e,!0);if(t&&t.test){const n=t.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(""===n)return new Jh(e,!0);{const i=new Jh(e);return this.eachAtom((function(t){i.set(t.index)}),t),this.atomSetCache[n]=i,i}}return!1===t?new Jh(e):new Jh(e,!0)}getAtomSetWithinSelection(t,e){const n=this.spatialHash,i=this.getAtomSet(!1),r=this.getAtomProxy();return n?(this.getAtomSet(t).forEach((function(t){r.index=t,n.within(r.x,r.y,r.z,e).forEach((function(t){i.set(t)}))})),i):i}getAtomSetWithinPoint(t,e){const n=t,i=this.getAtomSet(!1);return this.spatialHash?(this.spatialHash.within(n.x,n.y,n.z,e).forEach((function(t){i.set(t)})),i):i}getAtomSetWithinVolume(t,e,n,i,r){const s=new If(t,n,i,r),o=s.getDataPosition(),a=o.length,l=s.matrix.getMaxScaleOnAxis(),c=this.getAtomSet(!1);if(!this.spatialHash)return c;for(let t=0;t<a;t+=3)this.spatialHash.within(o[t],o[t+1],o[t+2],l).forEach((function(t){c.set(t)}));return c}getAtomSetWithinGroup(t){const e=this.atomStore.residueIndex,n=this.getAtomSet(!1),i=this.getResidueProxy();return this.getAtomSet(t).forEach((function(t){i.index=e[t];for(let t=i.atomOffset;t<=i.atomEnd;++t)n.set(t)})),n}getSelection(){}getStructure(){return this}eachEntity(t,e){this.entityList.forEach((function(n){void 0!==e&&n.getEntityType()!==e||t(n)}))}eachBond(t,e){const n=this.getBondProxy();let i;if(e&&e.test&&(i=this.getBondSet(),this.bondSet&&i.intersection(this.bondSet)),i)i.forEach((function(e){n.index=e,t(n)}));else{const e=this.bondStore.count;for(let i=0;i<e;++i)n.index=i,t(n)}}eachAtom(t,e){if(e&&e.test)this.eachModel((function(n){n.eachAtom(t,e)}),e);else{const e=this.atomStore.count,n=this.getAtomProxy();for(let i=0;i<e;++i)n.index=i,t(n)}}eachResidue(t,e){if(e&&e.test){const n=this.modelStore.count,i=this.getModelProxy(),r=e.modelOnlyTest;if(r)for(let s=0;s<n;++s)i.index=s,r(i)&&i.eachResidue(t,e);else for(let r=0;r<n;++r)i.index=r,i.eachResidue(t,e)}else{const e=this.residueStore.count,n=this.getResidueProxy();for(let i=0;i<e;++i)n.index=i,t(n)}}eachResidueN(t,e){const n=this.residueStore.count;if(n<t)return;const i=new Array(t);for(let e=0;e<t;++e)i[e]=this.getResidueProxy(e);e.apply(this,i);for(let r=t;r<n;++r){for(let e=0;e<t;++e)i[e].index+=1;e.apply(this,i)}}eachPolymer(t,e){if(e&&e.modelOnlyTest){const n=e.modelOnlyTest;this.eachModel((function(i){n(i)&&i.eachPolymer(t,e)}))}else this.eachModel((function(n){n.eachPolymer(t,e)}))}eachChain(t,e){if(e&&e.test)this.eachModel((function(n){n.eachChain(t,e)}));else{const e=this.chainStore.count,n=this.getChainProxy();for(let i=0;i<e;++i)n.index=i,t(n)}}eachModel(t,e){const n=this.modelStore.count,i=this.getModelProxy();if(e&&e.test){const r=e.modelOnlyTest;if(r)for(let e=0;e<n;++e)i.index=e,r(i)&&t(i);else for(let e=0;e<n;++e)i.index=e,t(i)}else for(let e=0;e<n;++e)i.index=e,t(i)}getAtomData(t){const e=Object.assign({},t);e.colorParams&&(e.colorParams.structure=this.getStructure());const n=e.what,i=Aa(e.atomSet,this.atomSet);let r,s;const o={},a=this.getAtomProxy(),l=i.getSize();n&&!n.position||(o.position=new Float32Array(3*l)),n&&!n.color||!e.colorParams||(o.color=new Float32Array(3*l),s=ic.getScheme(e.colorParams)),n&&!n.picking||(o.picking=new cp(new Float32Array(l),this.getStructure())),n&&!n.radius||(o.radius=new Float32Array(l),r=new Cf(e.radiusParams)),n&&!n.index||(o.index=new Uint32Array(l));const{position:c,color:u,picking:h,radius:d,index:p}=o;return i.forEach(((t,e)=>{const n=3*e;a.index=t,c&&a.positionToArray(c,n),u&&s.atomColorToArray(a,u,n),h&&(h.array[e]=t),d&&(d[e]=r.atomRadius(a)),p&&(p[e]=t)})),o}getBondData(t){const e=Object.assign({},t);e.colorParams&&(e.colorParams.structure=this.getStructure());const n=e.what,i=Aa(e.bondSet,this.bondSet),r=Aa(e.multipleBond,"off"),s="off"!==r,o="offset"===r,a=Aa(e.bondScale,.4),l=Aa(e.bondSpacing,1);let c,u;const h={},d=this.getBondProxy();e.bondStore&&(d.bondStore=e.bondStore);const p=this.getAtomProxy(),f=this.getAtomProxy();let m;if(s){const t=d.bondStore.bondOrder;m=0,i.forEach((function(e){m+=t[e]}))}else m=i.getSize();n&&!n.position||(h.position1=new Float32Array(3*m),h.position2=new Float32Array(3*m)),n&&!n.color||!e.colorParams||(h.color=new Float32Array(3*m),h.color2=new Float32Array(3*m),u=ic.getScheme(e.colorParams)),n&&!n.picking||(h.picking=new hp(new Float32Array(m),this.getStructure(),e.bondStore)),(!n||n.radius||s&&n.position)&&(c=new Cf(e.radiusParams)),n&&!n.radius||(h.radius=new Float32Array(m),e.radius2&&(h.radius2=new Float32Array(m)));const{position1:g,position2:_,color:v,color2:y,picking:b,radius:x,radius2:w}=h;let S,A,M,C,E,T,P=0;const I=new ue,R=new ue,k=new ue;return i.forEach((t=>{if(A=3*P,d.index=t,p.index=d.atomIndex1,f.index=d.atomIndex2,C=d.bondOrder,g)if(s&&C>1){const t=c.atomRadius(p);T=t*a/(.5*C),d.calculateShiftDir(k),o?(E=2*l*t,k.multiplyScalar(E),k.negate(),R.subVectors(f,p).multiplyScalar(Math.max(.1,E/1.88)),p.positionToArray(g,A),f.positionToArray(_,A),C>=2&&(I.addVectors(p,k).add(R).toArray(g,A+3),I.addVectors(f,k).sub(R).toArray(_,A+3),C>=3&&(I.subVectors(p,k).add(R).toArray(g,A+6),I.subVectors(f,k).sub(R).toArray(_,A+6)))):(E=(l-a)*t,k.multiplyScalar(E),2===C?(I.addVectors(p,k).toArray(g,A),I.subVectors(p,k).toArray(g,A+3),I.addVectors(f,k).toArray(_,A),I.subVectors(f,k).toArray(_,A+3)):3===C?(p.positionToArray(g,A),I.addVectors(p,k).toArray(g,A+3),I.subVectors(p,k).toArray(g,A+6),f.positionToArray(_,A),I.addVectors(f,k).toArray(_,A+3),I.subVectors(f,k).toArray(_,A+6)):(p.positionToArray(g,A),f.positionToArray(_,A)))}else p.positionToArray(g,A),f.positionToArray(_,A);if(v&&y&&(u.bondColorToArray(d,1,v,A),u.bondColorToArray(d,0,y,A),s&&C>1))for(S=1;S<C;++S)M=3*S+A,Kc(v,A,M,3),Kc(y,A,M,3);if(b&&b.array&&(b.array[P]=t,s&&C>1))for(S=1;S<C;++S)b.array[P+S]=t;if(x&&(x[P]=c.atomRadius(p),s&&C>1))for(T=x[P]*a/(o?1:.5*C),S=o?1:0;S<C;++S)x[P+S]=T;if(w&&(w[P]=c.atomRadius(f),s&&C>1))for(T=w[P]*a/(o?1:.5*C),S=o?1:0;S<C;++S)w[P+S]=T;P+=s?C:1})),h}getBackboneAtomData(t){return t=Object.assign({atomSet:this.atomSetCache.__backbone},t),this.getAtomData(t)}getBackboneBondData(t){return t=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},t),this.getBondData(t)}getRungAtomData(t){return t=Object.assign({atomSet:this.atomSetCache.__rung},t),this.getAtomData(t)}getRungBondData(t){return t=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},t),this.getBondData(t)}getBoundingBox(t,e){Ql&&Yl.time("getBoundingBox"),e=e||new pe;let n=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;return this.eachAtom((t=>{const e=t.x,l=t.y,c=t.z;e<n&&(n=e),l<i&&(i=l),c<r&&(r=c),e>s&&(s=e),l>o&&(o=l),c>a&&(a=c)}),t),e.min.set(n,i,r),e.max.set(s,o,a),Ql&&Yl.timeEnd("getBoundingBox"),e}getPrincipalAxes(t){Ql&&Yl.time("getPrincipalAxes");let e=0;const n=new Ap(3,this.atomCount),i=n.data;return this.eachAtom((t=>{i[e+0]=t.x,i[e+1]=t.y,i[e+2]=t.z,e+=3}),t),Ql&&Yl.timeEnd("getPrincipalAxes"),new Pf(n)}atomCenter(t){return t?this.getBoundingBox(t).getCenter(new ue):this.center.clone()}hasCoords(){if(void 0===this._hasCoords){const t=this.atomStore;this._hasCoords=0!==Qc(t.x)||0!==Zc(t.x)||0!==Qc(t.y)||0!==Zc(t.y)||0!==Qc(t.z)||0!==Zc(t.z)||t.count/this.modelStore.count==1}return this._hasCoords}getSequence(t){const e=[],n=this.getResidueProxy();return this.eachAtom((function(t){n.index=t.residueIndex,t.index===n.traceAtomIndex&&e.push(n.getResname1())}),t),e}getAtomIndices(t){if(t&&t.string){const e=[];return this.eachAtom((function(t){e.push(t.index)}),t),new Uint32Array(e)}{const t={what:{index:!0}};return this.getAtomData(t).index}}getChainnameCount(t){const e=new Set;return this.eachChain((function(t){t.residueCount&&e.add(t.chainname)}),t),e.size}updatePosition(t,e=!0){let n=0;this.eachAtom((function(e){e.positionFromArray(t,n),n+=3}),void 0),this._hasCoords=void 0,e&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new Yh(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const Bm=new pe,Um=[Hh,Bh,Gh,Vh,$h,Uh,Fh,zh,Wh,jh,qh,Xh],zm={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class Vm{constructor(t="shape",e={}){this.boundingBox=new pe,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=t,this.parameters=Ma(e,zm),Um.forEach((t=>{Object.keys(t.fields).forEach((e=>{this._primitiveData[t.getShapeKey(e)]=[]})),this._primitiveData[t.getShapeKey("name")]=[]}))}addBuffer(t){this.bufferList.push(t);const e=t.geometry;return e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox),this}addMesh(t,e,n,i,r){let s;t=$a(t),e=$a(e),Array.isArray(n)&&(n=Ba(n,t.length)),i&&(i=$a(i)),s=void 0===i||0==i.length?{position:t,color:e,index:n}:{position:t,color:e,index:n,normal:i};const o=new gp(this,Object.assign({serial:this.meshCount,name:r},s)),a=new tf(Object.assign({picking:o},s));return this.bufferList.push(a),Bm.setFromArray(t),this.boundingBox.union(Bm),this.meshCount+=1,this}addSphere(t,e,n,i){return Fh.objectToShape(this,{position:t,color:e,radius:n,name:i}),this}addEllipsoid(t,e,n,i,r,s){return $h.objectToShape(this,{position:t,color:e,radius:n,majorAxis:i,minorAxis:r,name:s}),this}addTorus(t,e,n,i,r,s){return jh.objectToShape(this,{position:t,color:e,radius:n,majorAxis:i,minorAxis:r,name:s}),this}addCylinder(t,e,n,i,r){return Vh.objectToShape(this,{position1:t,position2:e,color:n,radius:i,name:r}),this}addCone(t,e,n,i,r){return Gh.objectToShape(this,{position1:t,position2:e,color:n,radius:i,name:r}),this}addArrow(t,e,n,i,r){return Hh.objectToShape(this,{position1:t,position2:e,color:n,radius:i,name:r}),this}addBox(t,e,n,i,r,s){return Bh.objectToShape(this,{position:t,color:e,size:n,heightAxis:i,depthAxis:r,name:s}),this}addOctahedron(t,e,n,i,r,s){return Uh.objectToShape(this,{position:t,color:e,size:n,heightAxis:i,depthAxis:r,name:s}),this}addTetrahedron(t,e,n,i,r,s){return zh.objectToShape(this,{position:t,color:e,size:n,heightAxis:i,depthAxis:r,name:s}),this}addText(t,e,n,i){return Wh.objectToShape(this,{position:t,color:e,size:n,text:i}),this}addPoint(t,e,n){return qh.objectToShape(this,{position:t,color:e,name:n}),this}addWideline(t,e,n,i,r){return this.parameters.linewidth=i,Xh.objectToShape(this,{position1:t,position2:e,color:n,name:r}),this}addLabel(t,e,n,i){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(t,e,n,i)}getBufferList(){const t=[];return Um.forEach((e=>{this._primitiveData[e.getShapeKey("color")].length&&t.push(e.bufferFromShape(this,this.parameters))})),this.bufferList.concat(t)}dispose(){this.bufferList.forEach((function(t){t.dispose()})),this.bufferList.length=0,Um.forEach((t=>{Object.keys(t.fields).forEach((e=>{this._primitiveData[t.getShapeKey(e)].length=0})),this._primitiveData[t.getShapeKey("name")].length=0}))}get center(){return this._center||(this._center=this.boundingBox.getCenter(new ue)),this._center}get type(){return"Shape"}}class Hm extends sh{constructor(t,e,n){Array.isArray(t)||(t=[t]),super(t,e,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=t,this.init(n)}init(t){super.init(t),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(t){this.bufferList.forEach((t=>{this.viewer.add(t),t.setParameters(this.getBufferParams())})),this.setVisibility(this.visible),t()}}const Gm=new ze,$m=new Ft;class jm extends tf{constructor(t,e={},n){super(function(t,e){const n=e.attributes.position.array,i=e.index?e.index.array:void 0,r=t.position.length/3,s=n.length/3,o=r*s,a=new Float32Array(3*o),l=new Float32Array(3*o),c=new Float32Array(3*o);let u;return i&&(u=Ba(r*i.length,o)),{position:a,color:c,index:u,normal:l,primitiveId:t.primitiveId||qc(r,s),picking:t.picking}}(t,n),e),this.updateNormals=!1;const i=n.attributes.position.array,r=n.attributes.normal.array,s=n.index?n.index.array:void 0;this.geoPosition=i,this.geoNormal=r,this.geoIndex=s,this.positionCount=t.position.length/3,this.geoPositionCount=i.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const o=this.geometry.attributes;if(this.meshPosition=o.position.array,this.meshColor=o.color.array,this.meshNormal=o.normal.array,this.setAttributes(t),s){const t=this.geometry.getIndex();if(!t)return void Yl.error("Index is null");this.meshIndex=t.array,this.makeIndex()}}setAttributes(t={},e=!1){const n=this.geometry.attributes;let i,r,s,o,a,l,c,u,h;const d=this.updateNormals;t.position&&(i=t.position,s=this.geoPosition,c=this.meshPosition,a=this.transformedGeoPosition,n.position.needsUpdate=!0,(d||e)&&(o=this.geoNormal,h=this.meshNormal,l=this.transformedGeoNormal,n.normal.needsUpdate=!0)),t.color&&(r=t.color,u=this.meshColor,n.color.needsUpdate=!0);const p=this.positionCount,f=this.geoPositionCount;for(let t=0;t<p;++t){let n,p;const m=t*f*3,g=3*t;if(i&&a&&c&&h&&s&&o&&(a.set(s),Gm.makeTranslation(i[g],i[g+1],i[g+2]),this.applyPositionTransform(Gm,t,g),hh(Gm.elements,a),c.set(a,m),d&&l?(l.set(o),$m.getNormalMatrix(Gm),dh($m.elements,l),h.set(l,m)):e&&h.set(o,m)),r&&u)for(n=0;n<f;++n)p=m+3*n,u[p]=r[g],u[p+1]=r[g+1],u[p+2]=r[g+2]}}makeIndex(){const t=this.geoIndex,e=this.meshIndex;if(!t)return;const n=this.positionCount,i=this.geoPositionCount,r=t.length/3*3;for(let s=0;s<n;++s){const n=s*r,o=n+r;e.set(t,n);for(let t=n;t<o;++t)e[t]+=s*i}}}const Wm=new ue,qm=Object.assign({sphereDetail:1},Zp);class Xm extends jm{constructor(t,e={}){super(t,e,new Fo(1,Aa(e.sphereDetail,1))),this.setAttributes(t,!0)}get defaultParameters(){return qm}applyPositionTransform(t,e){const n=this._radius[e];Wm.set(n,n,n),t.scale(Wm)}setAttributes(t={},e){t.radius&&(this._radius=t.radius),super.setAttributes(t,e)}}ac.add("shader/SphereImpostor.vert","uniform mat4 projectionMatrixInverse;\nuniform float clipNear;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\nattribute vec2 mapping;\nattribute float radius;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\n#include matrix_scale\nconst mat4 D = mat4(\n1.0, 0.0, 0.0, 0.0,\n0.0, 1.0, 0.0, 0.0,\n0.0, 0.0, 1.0, 0.0,\n0.0, 0.0, 0.0, -1.0\n);\nmat4 transposeM( in mat4 inMatrix ) {\nvec4 i0 = inMatrix[0];\nvec4 i1 = inMatrix[1];\nvec4 i2 = inMatrix[2];\nvec4 i3 = inMatrix[3];\nmat4 outMatrix = mat4(\nvec4(i0.x, i1.x, i2.x, i3.x),\nvec4(i0.y, i1.y, i2.y, i3.y),\nvec4(i0.z, i1.z, i2.z, i3.z),\nvec4(i0.w, i1.w, i2.w, i3.w)\n);\nreturn outMatrix;\n}\nvoid ComputePointSizeAndPositionInClipCoordSphere(){\nvec2 xbc;\nvec2 ybc;\nmat4 T = mat4(\nradius, 0.0, 0.0, 0.0,\n0.0, radius, 0.0, 0.0,\n0.0, 0.0, radius, 0.0,\nposition.x, position.y, position.z, 1.0\n);\nmat4 R = transposeM( projectionMatrix * modelViewMatrix * T );\nfloat A = dot( R[ 3 ], D * R[ 3 ] );\nfloat B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );\nfloat C = dot( R[ 0 ], D * R[ 0 ] );\nxbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nxbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;\nA = dot( R[ 3 ], D * R[ 3 ] );\nB = -2.0 * dot( R[ 1 ], D * R[ 3 ] );\nC = dot( R[ 1 ], D * R[ 1 ] );\nybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;\ngl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );\ngl_Position.xy -= mapping * vec2( sx, sy );\ngl_Position.xy *= gl_Position.w;\n}\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\nvRadius = radius * matrixScale( modelViewMatrix );\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nmvPosition.z -= vRadius;\ngl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );\nComputePointSizeAndPositionInClipCoordSphere();\nvRadiusSq = vRadius * vRadius;\nvec4 vPoint4 = projectionMatrixInverse * gl_Position;\nvPoint = vPoint4.xyz / vPoint4.w;\nvPointViewPosition = -mvPosition.xyz / mvPosition.w;\n}"),ac.add("shader/SphereImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool flag2 = false;\nbool interior = false;\nvec3 cameraPos;\nvec3 cameraNormal;\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nbool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){\nvec3 cameraSpherePos = -vPointViewPosition;\ncameraSpherePos.z += vRadius;\nvec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );\nvec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );\nvec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );\nfloat B = dot( rayDirection, cameraSphereDir );\nfloat det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );\nif( det < 0.0 ){\ndiscard;\nreturn false;\n}\nfloat sqrtDet = sqrt( det );\nfloat posT = mix( B + sqrtDet, B + sqrtDet, ortho );\nfloat negT = mix( B - sqrtDet, sqrtDet - B, ortho );\ncameraPos = rayDirection * negT + rayOrigin;\n#ifdef NEAR_CLIP\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}else if( calcClip( cameraPos ) > 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\nflag2 = true;\n}\n#else\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}\n#endif\ncameraNormal = normalize( cameraPos - cameraSpherePos );\ncameraNormal *= float(!interior) * 2.0 - 1.0;\nreturn !interior;\n}\nvoid main(void){\nbool flag = Impostor( cameraPos, cameraNormal );\n#ifdef NEAR_CLIP\nif( calcClip( cameraPos ) > 0.0 )\ndiscard;\n#endif\ngl_FragDepthEXT = calcDepth( cameraPos );\nif( !flag ){\n#ifdef NEAR_CLIP\nif( flag2 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}else if( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#else\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#endif\n}\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vNormal = cameraNormal;\nvec3 vViewPosition = -cameraPos;\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");class Ym extends Jp{constructor(t,e,n={}){super(e,n),this.index=Ba(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:t,value:null}}),this.setAttributes({primitiveId:Wc(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(t){const e={};for(const n in t){const i=t[n];e[n]={type:i.type,value:null}}super.addAttributes(e)}getAttributeIndex(t){return 3*t*this.mappingSize}setAttributes(t){t&&!t.position&&t.position1&&t.position2&&(t.position=Hc(t.position1,t.position2));const e=this.size,n=this.mappingSize,i=this.geometry.attributes;let r,s,o,a,l,c,u;for(const h in t)if("index"!==h&&"picking"!==h){s=t[h],r=i[h],o=r.itemSize,a=r.array;for(let t=0;t<e;++t){l=t*o,c=l*n;for(let t=0;t<n;++t){u=c+o*t;for(let t=0;t<o;++t)a[u+t]=s[l+t]}}r.needsUpdate=!0}}makeMapping(){const t=this.size,e=this.mapping,n=this.mappingSize,i=this.mappingItemSize,r=this.geometry.attributes.mapping.array;for(let s=0;s<t;s++)r.set(e,s*i*n)}makeIndex(){const t=this.size,e=this.mappingSize,n=this.mappingIndices,i=this.mappingIndicesSize,r=this.index;for(let s=0;s<t;s++){const t=s*i,o=s*e;r.set(n,t);for(let e=0;e<i;++e)r[t+e]+=o}}}const Km=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Zm=new Uint16Array([0,1,2,1,3,2]);class Qm extends Ym{constructor(t,e={}){super("v2",t,e)}get mapping(){return Km}get mappingIndices(){return Zm}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class Jm extends Qm{constructor(t,e={}){super(t,e),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new ze},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(t),this.makeMapping()}}Object.assign({disableImpostor:!1},qm);const tg=class{constructor(t,e){return!ql||e&&e.disableImpostor?new Xm(t,e):new Jm(t,e)}};function eg(t,e,n,i){const r=n-t,s=i-e;return Math.sqrt(r*r+s*s)}uc.add("sphere",tg),ac.add("shader/Point.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float size;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\nvarying vec3 vViewPosition;\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\n#include begin_vertex\n#include project_vertex\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );\n#else\ngl_PointSize = size * pixelRatio;\n#endif\n#ifndef PICKING\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),ac.add("shader/Point.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include alphatest_pars_fragment\nvarying vec3 vViewPosition;\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\n#ifdef USE_MAP\nif( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )\ndiscard;\n#endif\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\n#ifdef USE_MAP\ndiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif\n#include color_fragment\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const ng=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},Zp),ig=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},Qp);class rg extends Jp{constructor(t,e={}){super(t,e),this.parameterTypes=ig,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return ng}makeMaterial(){super.makeMaterial(),this.makeTexture();const t=this.material,e=this.wireframeMaterial,n=this.pickingMaterial;t.uniforms.map.value=this.tex,t.needsUpdate=!0,e.uniforms.map.value=this.tex,e.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=function(t){const e=t||{},n=Aa(e.width,256),i=Aa(e.height,256),r=[n/2,i/2],s=Math.min(n/2,i/2),o=Aa(e.delta,1/(s+1))*s;let a=0,l=0;const c=new Uint8Array(n*i*4);for(let t=0,e=c.length;t<e;t+=4){const e=1-tl(s-o,s,eg(a,l,r[0],r[1]));c[t]=255*e,c[t+1]=255*e,c[t+2]=255*e,c[t+3]=255*e,++a===n&&(a=0,l++)}const u=new mo(c,n,i);return u.needsUpdate=!0,u}({delta:this.parameters.edgeBleach})}getDefines(t){const e=super.getDefines(t);return this.parameters.sizeAttenuation&&(e.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(e.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(e.USE_ALPHATEST=1),e}setUniforms(t){t&&void 0!==t.edgeBleach&&(this.makeTexture(),t.map=this.tex),super.setUniforms(t)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}uc.add("point",rg);class sg extends sh{constructor(t,e,n){super(t,e,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),t instanceof qp?(this.surface=void 0,this.volume=new If(t)):(this.surface=t,this.volume=void 0),this.init(n)}init(t){var e=t||{};e.colorScheme=Aa(e.colorScheme,"uniform"),e.colorValue=Aa(e.colorValue,14540253),this.thresholdType=Aa(e.thresholdType,"sigma"),this.thresholdMin=Aa(e.thresholdMin,2),this.thresholdMax=Aa(e.thresholdMax,1/0),this.thresholdOut=Aa(e.thresholdOut,!1),this.dotType=Aa(e.dotType,"point"),this.radius=Aa(e.radius,.1),this.scale=Aa(e.scale,1),this.pointSize=Aa(e.pointSize,1),this.sizeAttenuation=Aa(e.sizeAttenuation,!0),this.sortParticles=Aa(e.sortParticles,!1),this.useTexture=Aa(e.useTexture,!1),this.alphaTest=Aa(e.alphaTest,.5),this.forceTransparent=Aa(e.forceTransparent,!1),this.edgeBleach=Aa(e.edgeBleach,0),super.init(e),this.build()}attach(t){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),t()}create(){var t={};if(this.volume){var e,n,i=this.volume;"sigma"===this.thresholdType?(e=i.getValueForSigma(this.thresholdMin),n=i.getValueForSigma(this.thresholdMax)):(e=this.thresholdMin,n=this.thresholdMax),i.setFilter(e,n,this.thresholdOut),Object.assign(t,{position:i.getDataPosition(),color:i.getDataColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(t,{radius:i.getDataSize(this.radius,this.scale),picking:i.getDataPicking()})}else{var r=this.surface;Object.assign(t,{position:r.getPosition(),color:r.getColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(t,{radius:r.getSize(this.radius,this.scale),picking:r.getPicking()})}"sphere"===this.dotType?this.dotBuffer=new tg(t,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new rg(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(t={}){if(0===this.bufferList.length)return;const e={};t.color&&(this.volume?Object.assign(e,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(e,{color:this.surface.getColor(this.getColorParams())})),"sphere"===this.dotType&&(t.radius||t.scale)&&(this.volume?Object.assign(e,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(e,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(e)}setParameters(t,e={},n){return t&&void 0!==t.thresholdType&&this.volume instanceof qp&&("value"===this.thresholdType&&"sigma"===t.thresholdType?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):"sigma"===this.thresholdType&&"value"===t.thresholdType&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=t.thresholdType),t&&void 0!==t.radiusType&&("radius"===t.radiusType?this.radius=.1:this.radius=parseFloat(t.radiusType),e.radius=!0,"sphere"!==this.dotType||ql&&!this.disableImpostor||(n=!0)),t&&void 0!==t.radius&&(e.radius=!0,"sphere"!==this.dotType||ql&&!this.disableImpostor||(n=!0)),t&&void 0!==t.scale&&(e.scale=!0,"sphere"!==this.dotType||ql&&!this.disableImpostor||(n=!0)),super.setParameters(t,e,n),this}}ac.add("shader/Image.vert","uniform float clipRadius;\nuniform vec3 clipCenter;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid main() {\n#include begin_vertex\n#include project_vertex\nvUv = uv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n}"),ac.add("shader/Image.frag","uniform sampler2D map;\nuniform float opacity;\nuniform vec2 mapSize;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform sampler2D pickingMap;\nuniform float objectId;\n#else\n#include fog_pars_fragment\n#endif\n#if defined( CUBIC_INTERPOLATION )\n#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )\n#if defined( CATMULROM_FILTER )\nconst float B = 0.0;\nconst float C = 0.5;\n#elif defined( MITCHELL_FILTER )\nconst float B = 0.333;\nconst float C = 0.333;\n#endif\nfloat applyFilter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f < 1.0 ){\nreturn ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +\n( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +\n( 6.0 - 2.0 * B ) ) / 6.0;\n}else if( f >= 1.0 && f < 2.0 ){\nreturn ( ( -B - 6.0 * C ) * ( f * f * f )\n+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +\n( - ( 12.0 * B ) - 48.0 * C ) * f +\n8.0 * B + 24.0 * C ) / 6.0;\n}else{\nreturn 0.0;\n}\n}\n#elif defined( BSPLINE_FILTER )\nfloat applyFilter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f >= 0.0 && f <= 1.0 ){\nreturn ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );\n}else if( f > 1.0 && f <= 2.0 ){\nreturn 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );\n}\nreturn 1.0;\n}\n#else\nfloat applyFilter( float x ){\nreturn 1.0;\n}\n#endif\nvec4 biCubic( sampler2D tex, vec2 texCoord ){\nvec2 texelSize = 1.0 / mapSize;\ntexCoord -= texelSize / 2.0;\nvec4 nSum = vec4( 0.0 );\nfloat nDenom = 0.0;\nvec2 cell = fract( texCoord * mapSize );\nfor( float m = -1.0; m <= 2.0; ++m ){\nfor( float n = -1.0; n <= 2.0; ++n ){\nvec4 vecData = texture2D(\ntex, texCoord + texelSize * vec2( m, n )\n);\nfloat c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );\nnSum += vecData * c;\nnDenom += c;\n}\n}\nreturn nSum / nDenom;\n}\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( CUBIC_INTERPOLATION )\ngl_FragColor = biCubic( map, vUv );\n#else\ngl_FragColor = texture2D( map, vUv );\n#endif\n#if defined( PICKING )\nif( gl_FragColor.a < 0.3 )\ndiscard;\ngl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );\n#else\nif( gl_FragColor.a < 0.01 )\ndiscard;\ngl_FragColor.a *= opacity;\n#include fog_fragment\n#endif\n}");const og=new Uint16Array([0,1,2,1,3,2]),ag=new Float32Array([0,1,0,0,1,1,1,0]),lg=Object.assign({filter:"nearest",forceTransparent:!0},Zp),cg=Object.assign({filter:{updateShader:!0,uniform:!0}},Qp);class ug extends Jp{constructor(t,e){super({position:t.position,index:og,picking:t.picking},e),this.parameterTypes=cg,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:i,height:r}=t,s=new mo(n,i,r);s.flipY=!0,this.tex=s;const o=n.length,a=new Uint8Array(o);for(let t=0;t<o;t+=4){const e=t/4;a[t]=e>>16&255,a[t+1]=e>>8&255,a[t+2]=255&e}const l=new mo(a,i,r);l.flipY=!0,l.minFilter=R,l.magFilter=R,this.pickingTex=l,this.addUniforms({map:{value:s},pickingMap:{value:l},mapSize:{value:new Nt(i,r)}}),this.geometry.setAttribute("uv",new Nn(ag,2))}get defaultParameters(){return lg}getDefines(t){const e=super.getDefines(t),n=this.parameters.filter;return n.startsWith("cubic")&&(e.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?e.BSPLINE_FILTER=1:n.endsWith("catmulrom")?e.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(e.MITCHELL_FILTER=1)),e}updateTexture(){const t=this.tex,e=this.parameters.filter;e.startsWith("cubic")?(t.minFilter=R,t.magFilter=R):"linear"===e?(t.minFilter=L,t.magFilter=L):(t.minFilter=R,t.magFilter=R),t.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const t=this.material;t.uniforms.map.value=this.tex,t.blending=1,t.needsUpdate=!0;const e=this.wireframeMaterial;e.uniforms.map.value=this.tex,e.blending=1,e.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=1,n.needsUpdate=!0}setUniforms(t){t&&void 0!==t.filter&&(this.updateTexture(),t.map=this.tex),super.setUniforms(t)}}class hg{constructor(t,e){const n=e||{};this.dimension=Aa(n.dimension,"x"),this.positionType=Aa(n.positionType,"percent"),this.position=Aa(n.position,30),this.thresholdType=Aa(n.thresholdType,"sigma"),this.thresholdMin=Aa(n.thresholdMin,-1/0),this.thresholdMax=Aa(n.thresholdMax,1/0),this.normalize=Aa(n.normalize,!1),this.volume=t}getPositionFromCoordinate(t){const e=this.dimension,n=this.volume,i=n.matrix,r=(new ue).setFromMatrixPosition(i)[e],s=(new ue).setFromMatrixScale(i)[e];let o;return o="x"===e?n.nx:"y"===e?n.ny:n.nz,Math.round(((t-r)/(o/100)+1)/s)}getData(t){t=t||{};const e=this.volume,n=e.data,i=e.matrix;let r;function s(t){return Math.round(t/100*(r-1))}function o(t,n,i,r){return 3*(i*e.ny*e.nx+n*e.nx+t)+r}r="coordinate"===this.positionType?this.getPositionFromCoordinate(this.position):this.position;const a=new Float32Array(12),l=new ue;let c,u,h,d,p,f=0,m=0,g=0,_=e.nx,v=e.ny,y=e.nz;function b(t,e,n,r){l.set(t,e,n).applyMatrix4(i).toArray(a,r)}"x"===this.dimension?(h=s(e.nx),d=e.ny-1,p=e.nz-1,c=e.nz,u=e.ny,f=h,_=f+1,b(h,0,0,0),b(h,d,0,3),b(h,0,p,6),b(h,d,p,9)):"y"===this.dimension?(h=e.nx-1,d=s(e.ny),p=e.nz-1,c=e.nz,u=e.nx,m=d,v=m+1,b(0,d,0,0),b(h,d,0,3),b(0,d,p,6),b(h,d,p,9)):"z"===this.dimension&&(h=e.nx-1,d=e.ny-1,p=s(e.nz),c=e.nx,u=e.ny,g=p,y=g+1,b(0,0,p,0),b(0,d,p,3),b(h,0,p,6),b(h,d,p,9));let x=0,w=0;const S=new Uint8Array(c*u*4),A=new Float32Array(c*u);let M,C;"sigma"===this.thresholdType?(M=e.getValueForSigma(this.thresholdMin),C=e.getValueForSigma(this.thresholdMax)):(M=this.thresholdMin,C=this.thresholdMax);const E=Object.assign({},t.colorParams,{volume:e});this.normalize&&(E.domain=[0,1]);const T=ic.getScheme(E),P=new Float32Array(3),I=T.getScale();let R,k=0,D=0;if(this.normalize){k=1/0,R=-1/0;for(let t=m;t<v;++t)for(let e=f;e<_;++e)for(let i=g;i<y;++i){const r=n[o(e,t,i,0)/3];r<k&&(k=r),r>R&&(R=r)}D=R-k}for(let t=m;t<v;++t)for(let e=f;e<_;++e)for(let i=g;i<y;++i){const r=o(e,t,i,0)/3;let s=n[r];this.normalize&&(s=(s-k)/D),T.colorToArray(I(s),P),S[x]=Math.round(255*P[0]),S[x+1]=Math.round(255*P[1]),S[x+2]=Math.round(255*P[2]),S[x+3]=s>M&&s<C?255:0,A[w]=r,++w,x+=4}const L=new bp(A,e);return{position:a,imageData:S,width:c,height:u,picking:L}}}class dg extends sh{constructor(t,e,n){super(t,e,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=t,this.init(n)}init(t){const e=this.volume,n=t||{};n.colorDomain=Aa(n.colorDomain,[e.min,e.max]),n.colorScheme=Aa(n.colorScheme,"value"),n.colorScale=Aa(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=Aa(n.dimension,"x"),this.filter=Aa(n.filter,"cubic-bspline"),this.positionType=Aa(n.positionType,"percent"),this.position=Aa(n.position,30),this.thresholdType=Aa(n.thresholdType,"sigma"),this.thresholdMin=Aa(n.thresholdMin,-1/0),this.thresholdMax=Aa(n.thresholdMax,1/0),this.normalize=Aa(n.normalize,!1),super.init(n),this.build()}attach(t){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),t()}create(){const t=new hg(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),e=new ug(t.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(e)}}function pg(t){Yl.error(`makeRepresentation: representation type ${t} unknown`)}const fg={name:"some element",status:""};class mg{constructor(t,e={}){this.stage=t,this.signals={statusChanged:new va.Signal,nameChanged:new va.Signal,disposed:new va.Signal},this.parameters=Ma(e,this.defaultParameters),this.uuid=Ka()}get defaultParameters(){return fg}get name(){return this.parameters.name}setStatus(t){return this.parameters.status=t,this.signals.statusChanged.dispatch(t),this}setName(t){return this.parameters.name=t,this.signals.nameChanged.dispatch(t),this}dispose(){this.signals.disposed.dispatch()}}const gg=Object.assign({visible:!0},fg);class _g extends mg{constructor(t,e,n={},i){super(t,Object.assign({name:e.type},n)),this.parent=i,this.signals=Object.assign({visibilityChanged:new va.Signal,parametersChanged:new va.Signal},this.signals),this.setRepresentation(e)}get defaultParameters(){return gg}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(t){this._disposeRepresentation(),this.repr=t,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(t){return this.parameters.visible=t,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(t){return this.repr.update(t),this}build(t){return this.repr.build(t),this}setSelection(t){const e=this.repr;return e.setSelection&&e.setSelection(t),this}setParameters(t){return this.repr.setParameters(t),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(t){return this.repr.setColor(t),this}}const vg=new ze,yg=new ue,bg={name:"",status:"",visible:!0};class xg{constructor(t,e,n={}){this.stage=t,this.object=e,this.signals={representationAdded:new va.Signal,representationRemoved:new va.Signal,visibilityChanged:new va.Signal,matrixChanged:new va.Signal,statusChanged:new va.Signal,nameChanged:new va.Signal,disposed:new va.Signal},this.reprList=[],this.annotationList=[],this.matrix=new ze,this.position=new ue,this.quaternion=new ce,this.scale=new ue(1,1,1),this.transform=new ze,this.parameters=Ma(n,this.defaultParameters),this.uuid=Ka(),this.viewer=t.viewer,this.controls=new Af(this)}get defaultParameters(){return bg}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(t){return Array.isArray(t)?this.position.fromArray(t):this.position.copy(t),this.updateMatrix(),this}setRotation(t){if(Array.isArray(t))if(3===t.length){const e=(new Ke).fromArray(t);this.quaternion.setFromEuler(e)}else this.quaternion.fromArray(t);else t instanceof Ke?this.quaternion.setFromEuler(t):this.quaternion.copy(t);return this.updateMatrix(),this}setScale(t){return this.scale.set(t,t,t),this.updateMatrix(),this}setTransform(t){return this.transform.copy(t),this.updateMatrix(),this}updateMatrix(){const t=this.getCenterUntransformed(yg);this.matrix.makeTranslation(-t.x,-t.y,-t.z),vg.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(vg),vg.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(vg);const e=this.position;vg.makeTranslation(e.x+t.x,e.y+t.y,e.z+t.z),this.matrix.premultiply(vg),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach((t=>{t.setParameters({matrix:this.matrix})}))}addAnnotation(t,e,n){const i=new bf(this,t,e,n);return this.annotationList.push(i),i}eachAnnotation(t){this.annotationList.slice().forEach(t)}removeAnnotation(t){const e=this.annotationList.indexOf(t);-1!==e&&(this.annotationList.splice(e,1),t.dispose())}removeAllAnnotations(){this.eachAnnotation((t=>t.dispose())),this.annotationList.length=0}_addRepresentation(t,e,n,i=!1){const r=n||{},s=this.stage.getParameters();r.matrix=this.matrix.clone(),r.quality=r.quality||s.quality,r.disableImpostor=Aa(r.disableImpostor,!s.impostor),r.useWorker=Aa(r.useWorker,s.workerDefault),r.visible=Aa(r.visible,!0);const o=Object.assign({},r,{visible:this.parameters.visible&&r.visible}),a=function(t,e,n,i){var r;if(Ql&&Yl.time("makeRepresentation "+t),e instanceof Fm){if(!(r=sc.get(t)))return void pg(t)}else if(e instanceof jp)if("surface"===t)r=af;else{if("dot"!==t)return void pg(t);r=sg}else if(e instanceof qp)if("surface"===t)r=af;else if("dot"===t)r=sg;else{if("slice"!==t)return void pg(t);r=dg}else if(e instanceof Vm)r=Hm,e=e.getBufferList();else{if("buffer"!==t)return void Yl.error("makeRepresentation: object "+e+" unknown");r=Hm}const s=new r(e,n,i);return Ql&&Yl.timeEnd("makeRepresentation "+t),s}(t,e,this.viewer,o),l=new _g(this.stage,a,r,this);return i||(this.reprList.push(l),this.signals.representationAdded.dispatch(l)),l}addBufferRepresentation(t,e){return this._addRepresentation.call(this,"buffer",t,e)}hasRepresentation(t){return-1!==this.reprList.indexOf(t)}eachRepresentation(t){this.reprList.slice().forEach(t)}removeRepresentation(t){const e=this.reprList.indexOf(t);-1!==e&&(this.reprList.splice(e,1),t.dispose(),this.signals.representationRemoved.dispatch(t))}updateRepresentations(t){this.reprList.forEach((e=>e.update(t))),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation((t=>t.dispose()))}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(t){return this.parameters.visible=t,this.eachRepresentation((t=>t.updateVisibility())),this.eachAnnotation((t=>t.updateVisibility())),this.signals.visibilityChanged.dispatch(t),this}setStatus(t){return this.parameters.status=t,this.signals.statusChanged.dispatch(t),this}setName(t){return this.parameters.name=t,this.signals.nameChanged.dispatch(t),this}getBox(...t){return this.getBoxUntransformed(...t).clone().applyMatrix4(this.matrix)}getCenter(...t){return this.getCenterUntransformed(...t).clone().applyMatrix4(this.matrix)}getZoom(...t){return this.stage.getZoomForBox(this.getBox(...t))}getBoxUntransformed(...t){return new pe}getCenterUntransformed(...t){return this.getBoxUntransformed().getCenter(new ue)}autoView(t){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),Aa(t,0))}}class wg{constructor(t=[]){this.list=t;const e=t.length;for(let n=0;n<e;++n)t[n].signals.disposed.add(this._remove,this)}_remove(t){const e=this.list.indexOf(t);-1!==e&&this.list.splice(e,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(t){return this.list.forEach(t),this}dispose(){return this.forEach((t=>t.dispose()))}}class Sg extends wg{setParameters(t){return this.forEach((e=>e.setParameters(t)))}setVisibility(t){return this.forEach((e=>e.setVisibility(t)))}setSelection(t){return this.forEach((e=>e.setSelection(t)))}setColor(t){return this.forEach((e=>e.setColor(t)))}update(t){return this.forEach((e=>e.update(t)))}build(t){return this.forEach((e=>e.build(t)))}dispose(t){return this.forEach((t=>t.dispose()))}}const Ag=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},fg);class Mg extends mg{constructor(t,e,n={}){super(t,Object.assign({name:e.name},n)),this.trajectory=e,this.signals=Object.assign(this.signals,{frameChanged:new va.Signal,playerChanged:new va.Signal,countChanged:new va.Signal,parametersChanged:new va.Signal}),e.signals.frameChanged.add((t=>{this.signals.frameChanged.dispatch(t)})),e.signals.playerChanged.add((t=>{this.signals.playerChanged.dispatch(t)})),e.signals.countChanged.add((t=>{this.signals.countChanged.dispatch(t)})),void 0!==n.initialFrame&&this.setFrame(n.initialFrame)}get defaultParameters(){return Ag}get type(){return"trajectory"}setFrame(t){this.trajectory.setFrame(t)}setParameters(t={}){this.trajectory.setParameters(t),this.signals.parametersChanged.dispatch(t)}dispose(){this.trajectory.dispose(),super.dispose()}}class Cg{constructor(t,e){this.name=t,this.path=e,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class Eg{constructor(t,e){let n,i;if(this.A=new Ap(3,3),this.W=new Ap(1,3),this.U=new Ap(3,3),this.V=new Ap(3,3),this.VH=new Ap(3,3),this.R=new Ap(3,3),this.tmp=new Ap(3,3),this.c=new Ap(3,3),t instanceof Fm)n=t.atomCount;else{if(!(t instanceof Float32Array))return;n=t.length/3}if(e instanceof Fm)i=e.atomCount;else{if(!(e instanceof Float32Array))return;i=e.length/3}const r=Math.min(n,i),s=new Ap(3,r),o=new Ap(3,r);this.coords1t=new Ap(r,3),this.coords2t=new Ap(r,3),this.transformationMatrix=new ze,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(t,s,r,!1),this.prepCoords(e,o,r,!1),this._superpose(s,o)}_superpose(t,e){this.mean1=Tp(t),this.mean2=Tp(e),Pp(t,this.mean1),Pp(e,this.mean2),Mp(this.coords1t,t),Mp(this.coords2t,e),Cp(this.A,this.coords2t,this.coords1t),kp(this.A,this.W,this.U,this.V),function(t,e){const n=t.data,i=e.data,r=n[4],s=n[8],o=n[5],a=n[7],l=n[0],c=l*r,u=l*o,h=n[3],d=n[1],p=h*d,f=n[2],m=h*f,g=n[6],_=g*d,v=g*f,y=1/(c*s-u*a-p*s+m*a+_*o-v*r);i[0]=(r*s-o*a)*y,i[1]=-(d*s-f*a)*y,i[2]=-(-d*o+f*r)*y,i[3]=-(h*s-o*g)*y,i[4]=(l*s-v)*y,i[5]=-(u-m)*y,i[6]=-(-h*a+r*g)*y,i[7]=-(l*a-_)*y,i[8]=(c-p)*y}(this.V,this.VH),Ep(this.R,this.U,this.VH),function(t){const e=t.data;return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[3]*e[1]*e[8]+e[3]*e[2]*e[7]+e[6]*e[1]*e[5]-e[6]*e[2]*e[4]}(this.R)<0&&(Ql&&Yl.log("R not a right handed system"),Ep(this.tmp,this.c,this.VH),Ep(this.R,this.U,this.tmp));const n=new Ap(4,4),i=new Ap(4,4),r=new Ap(4,4),s=new Ap(4,4),o=new Ap(4,4),a=new Ap(4,4),l=this.R.data,c=this.mean1,u=this.mean2;s.data.set([1,0,0,-c[0],0,1,0,-c[1],0,0,1,-c[2],0,0,0,1]),o.data.set([l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1]),a.data.set([1,0,0,u[0],0,1,0,u[1],0,0,1,u[2],0,0,0,1]),Mp(i,s),Cp(n,o,i),Mp(r,n),Cp(i,a,r),Mp(n,i),this.transformationMatrix.elements=n.data}prepCoords(t,e,n,i){let r=0;const s=e.data;let o=3,a=3*n;if(i&&(a=4*n,o=4),t instanceof Fm)t.eachAtom((function(t){r<a&&(s[r+0]=t.x,s[r+1]=t.y,s[r+2]=t.z,i&&(s[r+3]=1),r+=o)}));else if(t instanceof Float32Array)for(;r<a;r+=o)r<a&&(s[r]=t[r],s[r+1]=t[r+1],s[r+2]=t[r+2],i&&(s[r+3]=1));else Yl.warn("prepCoords: input type unknown")}transform(t){let e;if(t instanceof Fm)e=t.atomCount;else{if(!(t instanceof Float32Array))return;e=t.length/3}const n=new Ap(4,e),i=new Ap(e,4);this.prepCoords(t,n,e,!0);const r=this.transformationMatrix,s=r.determinant();if(!s)return s;const o=new Ap(4,4);o.data=r.elements,function(t,e,n){let i=0,r=0,s=0,o=0,a=0,l=0,c=0,u=0;const h=e.cols,d=e.rows,p=n.cols,f=e.data,m=n.data,g=t.data;let _=0;for(;i<d;o+=h,i++)for(c=0,r=0;r<p;u++,c++,r++){for(l=c,a=o,_=0,s=0;s<h;a++,l+=p,s++)_+=f[a]*m[l];g[u]=_}}(i,n,o);let a=0;const l=i.data;if(t instanceof Fm){t.eachAtom((function(t){t.x=l[a],t.y=l[a+1],t.z=l[a+2],a+=4}));const e=new ze;e.copy(r).invert();const n=t.biomolDict;for(let t in n)n.hasOwnProperty(t)&&n[t].partList.forEach((function(t){t.matrixList.forEach((function(t){t.premultiply(r),t.multiply(e)}))}))}else if(t instanceof Float32Array){const n=4*e;for(;a<n;a+=4)t[a]=l[a],t[a+1]=l[a+1],t[a+2]=l[a+2]}else Yl.warn("transform: input type unknown");return this.transformationMatrix}}const Tg={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class Pg{constructor(t,e={}){this.signals={startedRunning:new va.Signal,haltedRunning:new va.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,t.signals.playerChanged.add((t=>{t!==this&&this.pause()}),this);const n=Aa(t.frameCount,1);this.traj=t,this.parameters=Ma(e,Tg),this.parameters.end=Math.min(Aa(e.end,n-1),n-1),this.parameters.step=Aa(e.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction="bounce"===this.parameters.direction?"forward":this.parameters.direction,t.signals.countChanged.add((t=>{this.parameters.end=Math.min(Aa(this.parameters.end,t-1),t-1)}),this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(t={}){Ca(this.parameters,t),void 0!==t.direction&&"bounce"!==this.parameters.direction&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const t=this._currentTime-this._previousTime,e=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/e,i=this.traj;if(i&&i.frameCount&&!i.inProgress&&t>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),1===this._currentStep&&(this._currentFrame=this._nextInterpolated()),i.hasFrame(this._currentFrame)){this._currentStep+=1;const t=this._currentStep/(this.parameters.interpolateStep+1),[e,n,r,s]=this._currentFrame;i.setFrameInterpolated(e,n,r,s,t,this.parameters.interpolateType),this._previousTime=this._currentTime}else i.loadFrame(this._currentFrame);else{const t=this._next();i.hasFrame(t)?(i.setFrame(t),this._previousTime=this._currentTime):i.loadFrame(t)}window.requestAnimationFrame(this._animate)}_next(){const t=this.parameters;let e;return e="forward"===this._direction?this.traj.currentFrame+t.step:this.traj.currentFrame-t.step,(e>t.end||e<t.start)&&("bounce"===t.direction&&("forward"===this._direction?this._direction="backward":this._direction="forward"),"once"===t.mode?(this.pause(),e="forward"===t.direction?t.end:"backward"===t.direction||"forward"===this._direction?t.start:t.end):"forward"===this._direction?(e=t.start,t.interpolateType&&(e=Math.min(t.end,e+t.step))):(e=t.end,t.interpolateType&&(e=Math.max(t.start,e-t.step)))),e}_nextInterpolated(){const t=this.parameters,e=this._next();let n,i,r;return"forward"===this._direction?(n=Math.max(t.start,e-t.step),i=Math.max(t.start,e-2*t.step),r=Math.max(t.start,e-3*t.step)):(n=Math.min(t.end,e+t.step),i=Math.min(t.end,e+2*t.step),r=Math.min(t.end,e+3*t.step)),[e,n,i,r]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const t=this.parameters,e=this.traj.currentFrame;let n=Math.ceil(e/t.step)*t.step;"forward"===t.direction&&e>=t.end?n=t.start:"backward"===t.direction&&e<=t.start&&(n=t.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class Ig{constructor(t,e,n={}){this.signals={countChanged:new va.Signal,frameChanged:new va.Signal,playerChanged:new va.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=Aa(n.deltaTime,0),this.timeOffset=Aa(n.timeOffset,0),this.centerPbc=Aa(n.centerPbc,!1),this.removePbc=Aa(n.removePbc,!1),this.removePeriodicity=Aa(n.removePeriodicity,!1),this.superpose=Aa(n.superpose,!1),this.name=t.replace(/^.*[\\/]/,""),this.trajPath=t,this.selection=new Ll(Aa(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add((()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}))}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(t){this.setStructure(t),this._loadFrameCount(),this.setPlayer(new Pg(this))}_loadFrameCount(){}setStructure(t){this.structure=t,this.atomCount=t.atomCount,this.backboneIndices=this._getIndices(new Ll("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,(()=>this._saveInitialCoords()))}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(t){return this.selection.setString(t),this}_getIndices(t){let e=0;const n=t.test,i=[];return n&&this.structure.eachAtom((t=>{n(t)&&i.push(e),e+=1})),i}_makeSuperposeCoords(){const t=3*this.selectionIndices.length;this.coords1=new Float32Array(t),this.coords2=new Float32Array(t);const e=this.initialCoords,n=this.coords2;for(let i=0;i<t;i+=3){const t=3*this.selectionIndices[i/3];n[i+0]=e[t+0],n[i+1]=e[t+1],n[i+2]=e[t+2]}}_makeAtomIndices(){Yl.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(t={}){let e=!1;void 0!==t.centerPbc&&t.centerPbc!==this.centerPbc&&(this.centerPbc=t.centerPbc,e=!0),void 0!==t.removePeriodicity&&t.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=t.removePeriodicity,e=!0),void 0!==t.removePbc&&t.removePbc!==this.removePbc&&(this.removePbc=t.removePbc,e=!0),void 0!==t.superpose&&t.superpose!==this.superpose&&(this.superpose=t.superpose,e=!0),this.deltaTime=Aa(t.deltaTime,this.deltaTime),this.timeOffset=Aa(t.timeOffset,this.timeOffset),e&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(t){return Array.isArray(t)?t.every((t=>!!this.frameCache[t])):!!this.frameCache[t]}setFrame(t,e){return void 0===t||(this.inProgress=!0,-1===t||this.frameCache[t]?(this._updateStructure(t),e&&e()):this.loadFrame(t,(()=>{this._updateStructure(t),e&&e()}))),this}_interpolate(t,e,n,i,r,s){const o=this.frameCache;let a;a="spline"===s?function(t,e,n,i,r){const s=t.length,o=new Float32Array(s);for(let a=0;a<s;a+=3){const s=a+1,l=a+2;o[a]=Ja(i[a],n[a],e[a],t[a],r,1),o[s]=Ja(i[s],n[s],e[s],t[s],r,1),o[l]=Ja(i[l],n[l],e[l],t[l],r,1)}return o}(o[t],o[e],o[n],o[i],r):function(t,e,n){const i=t.length,r=new Float32Array(i);for(let s=0;s<i;s+=3){const i=s+1,o=s+2;r[s]=Qa(e[s],t[s],n),r[i]=Qa(e[i],t[i],n),r[o]=Qa(e[o],t[o],n)}return r}(o[t],o[e],r),this.structure.updatePosition(a),this._currentFrame=t,this.signals.frameChanged.dispatch(t)}setFrameInterpolated(t,e,n,i,r,s,o){if(void 0===t)return this;const a=this.frameCache,l=[];return a[i]||l.push(i),a[n]||l.push(n),a[e]||l.push(e),a[t]||l.push(t),l.length?this.loadFrame(l,(()=>{this._interpolate(t,e,n,i,r,s),o&&o()})):(this._interpolate(t,e,n,i,r,s),o&&o()),this}loadFrame(t,e){Array.isArray(t)?t.forEach((t=>{this.loadQueue[t]||this.frameCache[t]||(this.loadQueue[t]=!0,this._loadFrame(t,(()=>{delete this.loadQueue[t]})))})):this.loadQueue[t]||this.frameCache[t]||(this.loadQueue[t]=!0,this._loadFrame(t,(()=>{delete this.loadQueue[t],e&&e()})))}_loadFrame(t,e){Yl.error("Trajectory._loadFrame not implemented",t,e)}_updateStructure(t){this._disposed?console.error("updateStructure: traj disposed"):(-1===t?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[t]),this.structure.trajectory={name:this.trajPath,frame:t},this._currentFrame=t,this.inProgress=!1,this.signals.frameChanged.dispatch(t))}_doSuperpose(t){const e=3*this.selectionIndices.length,n=this.coords1,i=this.coords2;for(let i=0;i<e;i+=3){const e=3*this.selectionIndices[i/3];n[i+0]=t[e+0],n[i+1]=t[e+1],n[i+2]=t[e+2]}new Eg(n,i).transform(t)}_process(t,e,n,i){if(this._setFrameCount(i),e){if(this.backboneIndices.length>0&&this.centerPbc){const t=[e[0],e[4],e[8]],i=function(t,e,n){return[Vc(e,n[0],3,0,t),Vc(e,n[1],3,1,t),Vc(e,n[2],3,2,t)]}(this.backboneIndices,n,t);!function(t,e,n){if(0===n[0]||0===n[8]||0===n[4])return;const i=t.length,r=n[0],s=n[1],o=n[2],a=-e[0]+r+r/2,l=-e[1]+s+s/2,c=-e[2]+o+o/2;for(let e=0;e<i;e+=3)t[e+0]=(t[e+0]+a)%r,t[e+1]=(t[e+1]+l)%s,t[e+2]=(t[e+2]+c)%o}(n,i,t)}this.removePeriodicity&&function(t,e,n){if(0===e[0]||0===e[8]||0===e[4])return;const i=t.length;for(let r=3;r<i;r+=3)for(let i=0;i<3;++i){const s=(t[r+i]-n[i])/e[3*i+i];Math.abs(s)>.5&&(t[r+i]-=e[3*i+i]*Math.round(s))}}(n,e,function(t){return[tu(t,3,0),tu(t,3,1),tu(t,3,2)]}(n)),this.removePbc&&function(t,e){if(0===e[0]||0===e[8]||0===e[4])return;const n=t.length;for(let i=3;i<n;i+=3)for(let n=0;n<3;++n){const r=t[i+n]-t[i-3+n];if(Math.abs(r)>.9*e[3*n+n])if(r>0)for(let r=0;r<3;++r)t[i+r]-=e[3*n+r];else for(let r=0;r<3;++r)t[i+r]+=e[3*n+r]}}(n,e)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[t]=n,this.boxCache[t]=e,this.frameCacheSize+=1}_setFrameCount(t){t!==this._frameCount&&(this._frameCount=t,this.signals.countChanged.dispatch(t))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(t){this.player=t,this.signals.playerChanged.dispatch(t)}getFrameTime(t){return this.timeOffset+t*this.deltaTime}}class Rg extends Ig{constructor(t,e,n){const i=n||{};i.timeOffset=Aa(i.timeOffset,t.timeOffset),i.deltaTime=Aa(i.deltaTime,t.deltaTime),super("",e,i),this.name=t.name,this.path=t.path,this.frames=t.coordinates,this.boxes=t.boxes,this._init(e)}get type(){return"frames"}_makeAtomIndices(){"StructureView"===this.structure.type?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(t,e){let n;const i=this.frames[t];if(this.atomIndices){const t=this.atomIndices,e=t.length;n=new Float32Array(3*e);for(let r=0;r<e;++r){const e=3*r,s=3*t[r];n[e+0]=i[s+0],n[e+1]=i[s+1],n[e+2]=i[s+2]}}else n=new Float32Array(i);const r=this.boxes[t],s=this.frames.length;this._process(t,r,n,s),"function"==typeof e&&e()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class kg extends Ig{constructor(t,e,n){super("",e,n),this._init(e)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(t,e){let n;const i=this.structure,r=i.frames[t];if(this.atomIndices){const t=this.atomIndices,e=t.length;n=new Float32Array(3*e);for(let i=0;i<e;++i){const e=3*i,s=3*t[i];n[e+0]=r[s+0],n[e+1]=r[s+1],n[e+2]=r[s+2]}}else n=new Float32Array(r);const s=i.boxes[t],o=i.frames.length;this._process(t,s,n,o),"function"==typeof e&&e()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class Dg extends Ig{constructor(t,e,n){super(t,e,n),this._init(e)}get type(){return"remote"}_makeAtomIndices(){const t=[];if("StructureView"===this.structure.type){const e=this.structure.getAtomIndices(),n=e.length;let i=e[0],r=e[0];for(let s=1;s<n;++s){const n=e[s];r+1<n&&(t.push([i,r+1]),i=n),r=n}t.push([i,r+1])}else t.push([0,this.atomCount]);this.atomIndices=t}_loadFrame(t,e){const n=new XMLHttpRequest,i=pc.getFrameUrl(this.trajPath,t),r=pc.getFrameParams(this.trajPath,this.atomIndices);n.open("POST",i,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("load",(()=>{const r=n.response;if(!r)return void Yl.error(`empty arrayBuffer for '${i}'`);const s=new Int32Array(r,0,1)[0],o=new Float32Array(r,8,9),a=new Float32Array(r,44);this._process(t,o,a,s),"function"==typeof e&&e()}),!1),n.send(r)}_loadFrameCount(){const t=new XMLHttpRequest,e=pc.getCountUrl(this.trajPath);t.open("GET",e,!0),t.addEventListener("load",(()=>{this._setFrameCount(parseInt(t.response))}),!1),t.send()}}class Lg extends Ig{constructor(t,e,n){super("",e,n),this.requestCallback=t,this._init(e)}get type(){return"callback"}_makeAtomIndices(){const t=[];if("StructureView"===this.structure.type){const e=this.structure.getAtomIndices(),n=e.length;let i=e[0],r=e[0];for(let s=1;s<n;++s){const n=e[s];r+1<n&&(t.push([i,r+1]),i=n),r=n}t.push([i,r+1])}else t.push([0,this.atomCount]);this.atomIndices=t}_loadFrame(t,e){this.requestCallback(((t,n,i,r)=>{this._process(t,n,i,r),"function"==typeof e&&e()}),t,this.atomIndices)}_loadFrameCount(){this.requestCallback((t=>this._setFrameCount(t)))}}Fm.prototype.getView=function(t){return new Og(this,t)};class Og extends Fm{constructor(t,e){super(),this.structure=t,this.selection=e,this.center=new ue,this.boundingBox=new pe,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(t){this.structure._hasCoords=t}refresh(){Ql&&Yl.time("StructureView.refresh"),this.atomSetCache={};const t=this.structure;if(this.selection.isAllSelection()&&t!==this&&t.atomSet&&t.bondSet){this.atomSet=t.atomSet.clone(),this.bondSet=t.bondSet.clone();for(let t in this.atomSetDict){const e=this.atomSetDict[t];this.atomSetCache["__"+t]=e.clone()}this.atomCount=t.atomCount,this.bondCount=t.bondCount,this.boundingBox.copy(t.boundingBox),this.center.copy(t.center)}else if(this.selection.isNoneSelection()&&t!==this&&t.atomSet&&t.bondSet){this.atomSet=new Jh(t.atomCount),this.bondSet=new Jh(t.bondCount);for(let e in this.atomSetDict)this.atomSetCache["__"+e]=new Jh(t.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),t.atomSet&&(this.atomSet=this.atomSet.intersection(t.atomSet)),this.bondSet=this.getBondSet();for(let t in this.atomSetDict){const e=this.atomSetDict[t];this.atomSetCache["__"+t]=e.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new ue)}Ql&&Yl.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(t){this.selection=t,this.refresh()}getSelection(t){const e=[];t&&t.string&&e.push(t.string);const n=this.structure.getSelection();n&&n.string&&e.push(n.string),this.selection&&this.selection.string&&e.push(this.selection.string);let i="";return e.length>0&&(i=`( ${e.join(" ) AND ( ")} )`),new Ll(i)}getStructure(){return this.structure.getStructure()}eachBond(t,e){this.structure.eachBond(t,this.getSelection(e))}eachAtom(t,e){const n=this.getAtomProxy(),i=this.getAtomSet(e),r=this.atomStore.count;if(i.getSize()<r)i.forEach((function(e){n.index=e,t(n)}));else for(let e=0;e<r;++e)n.index=e,t(n)}eachResidue(t,e){this.structure.eachResidue(t,this.getSelection(e))}eachResidueN(t,e){console.error("StructureView.eachResidueN() not implemented")}eachChain(t,e){this.structure.eachChain(t,this.getSelection(e))}eachModel(t,e){this.structure.eachModel(t,this.getSelection(e))}getAtomSet(t,e=!1){let n=this.structure.getAtomSet(t);return!e&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(t){return this.structure.getAtomIndices(this.getSelection(t))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new Fm,delete this.atomSet,delete this.bondSet}}function Ng(t,e){let n,i=0;const r={};return e.forEach((function(e){n=0;const s={};e.forEach((function(e){s[t[n++]]=e})),r[t[i++]]=s})),r}const Fg={blosum62:Ng("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:Ng("ACDEFGHIKLMNPQRSTVWY",[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]])};class Bg{constructor(t,e,n=-10,i=-1,r="blosum62"){this.seq1=t,this.seq2=e,this.gapPenalty=n,this.gapExtensionPenalty=i,r&&(this.substMatrix=Fg[r])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let t=0;t<=this.n;++t){this.S[t]=[],this.V[t]=[],this.H[t]=[];for(let e=0;e<=this.m;++e)this.S[t][e]=0,this.V[t][e]=0,this.H[t][e]=0}for(let t=0;t<=this.n;++t)this.S[t][0]=this.gap(0),this.H[t][0]=-1/0;for(let t=0;t<=this.m;++t)this.S[0][t]=this.gap(0),this.V[0][t]=-1/0;this.S[0][0]=0}gap(t){return this.gapPenalty+t*this.gapExtensionPenalty}makeScoreFn(){const t=this.seq1,e=this.seq2,n=this.substMatrix;return n?function(i,r){const s=t[i],o=e[r];try{return n[s][o]}catch(t){return-4}}:(Yl.warn("Alignment: no subst matrix"),function(n,i){return t[n]===e[i]?5:-3})}calc(){Ql&&Yl.time("Alignment.calc"),this.initMatrices();const t=this.gap(0),e=this.makeScoreFn(),n=this.gapExtensionPenalty,i=this.V,r=this.H,s=this.S,o=this.n,a=this.m;let l,c,u,h,d;for(let p=1;p<=o;++p){c=s[p-1],l=i[p-1],u=i[p],h=r[p],d=s[p];for(let i=1;i<=a;++i)u[i]=Math.max(c[i]+t,l[i]+n),h[i]=Math.max(d[i-1]+t,h[i-1]+n),d[i]=Math.max(c[i-1]+e(p-1,i-1),u[i],h[i])}Ql&&Yl.timeEnd("Alignment.calc"),Ql&&Yl.log(this.S,this.V,this.H)}trace(){Ql&&Yl.time("Alignment.trace"),this.ali1="",this.ali2="";const t=this.makeScoreFn();let e,n=this.n,i=this.m;for(this.S[n][i]>=this.V[n][i]?(e="S",this.score=this.S[n][i]):this.V[n][i]>=this.H[n][i]?(e="V",this.score=this.V[n][i]):(e="H",this.score=this.H[n][i]),Ql&&Yl.log("Alignment: SCORE",this.score),Ql&&Yl.log("Alignment: S, V, H",this.S[n][i],this.V[n][i],this.H[n][i]);n>0&&i>0;)"S"===e?this.S[n][i]===this.S[n-1][i-1]+t(n-1,i-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--n,--i,e="S"):this.S[n][i]===this.V[n][i]?e="V":this.S[n][i]===this.H[n][i]?e="H":(--n,--i):"V"===e?this.V[n][i]===this.V[n-1][i]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,e="V"):this.V[n][i]===this.S[n-1][i]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,e="S"):--n:"H"===e?this.H[n][i]===this.H[n][i-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,e="H"):this.H[n][i]===this.S[n][i-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,e="S"):--i:Yl.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;i>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i;Ql&&Yl.timeEnd("Alignment.trace"),Ql&&Yl.log([this.ali1,this.ali2])}}function Ug(t,e,n=!1,i="",r=""){let s,o,a,l,c;if(n){let n=t,u=e;i&&r&&(n=t.getView(new Ll(i)),u=e.getView(new Ll(r)));const h=n.getSequence(),d=u.getSequence(),p=new Bg(h.join(""),d.join(""));let f,m;p.calc(),p.trace(),s=0,o=0,a=p.ali1.length;const g=[],_=[];for(let t=0;t<a;++t){const e=p.ali1[t],n=p.ali2[t];f=0,m=0,"-"===e?_[o]=!1:(_[o]=!0,f=1),"-"===n?g[s]=!1:(g[s]=!0,m=1),s+=f,o+=m}const v=[],y=[],b=n.getAtomProxy(),x=u.getAtomProxy();s=0,n.eachResidue((function(t){void 0!==t.traceAtomIndex&&t.traceAtomIndex===t.getAtomIndexByName("CA")&&(g[s]&&(b.index=t.getAtomIndexByName("CA"),v.push(b.x,b.y,b.z)),s+=1)})),s=0,u.eachResidue((function(t){void 0!==t.traceAtomIndex&&t.traceAtomIndex===t.getAtomIndexByName("CA")&&(_[s]&&(x.index=t.getAtomIndexByName("CA"),y.push(x.x,x.y,x.z)),s+=1)})),l=new Float32Array(v),c=new Float32Array(y)}else l=t.getView(new Ll(`${i} and .CA`)),c=e.getView(new Ll(`${r} and .CA`));const u=new Eg(l,c).transform(t);return t.refreshPosition(),u}const zg=Object.assign({sele:"",defaultAssembly:""},bg);class Vg extends xg{constructor(t,e,n={}){super(t,e,Object.assign({name:e.name},n)),this.structure=e,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new va.Signal,trajectoryRemoved:new va.Signal,defaultAssemblyChanged:new va.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=function(){let t=0,e=0;const n=[];return{has:function(t){return-1!==n.indexOf(t)},get:function(t){return n[t]},push:function(i){n[t]=i,t=(4+t+1)%4,++e},get count(){return e},get data(){return n.slice(0,Math.min(e,4))},clear:function(){e=0,t=0,n.length=0}}}(),this.pickDict=function(){const t={};return{has:function(e){return void 0!==t[JSON.stringify(e)]},add:function(e,n){t[JSON.stringify(e)]=n},del:function(e){delete t[JSON.stringify(e)]},get values(){return Object.keys(t).map((e=>t[e]))}}}(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:Kl.opacity,color:Kl.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",Kl,!0),this.angleRepresentation=this.addRepresentation("angle",Kl,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",Kl,!0),this.measureRepresentations=new Sg([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add((()=>{this.updateRepresentations({position:!0})}))}get defaultParameters(){return zg}get type(){return"structure"}initSelection(t){this.selection=new Ll(t),this.structureView=new Og(this.structure,this.selection),this.selection.signals.stringChanged.add((()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()}))}setSelection(t){return this.parameters.sele=t,this.selection.setString(t),this}setDefaultAssembly(t){if(void 0===this.structure.biomolDict[t]&&(t=""),this.parameters.defaultAssembly!==t){const e={defaultAssembly:t};this.reprList.forEach((t=>t.setParameters(e))),this.measureRepresentations.setParameters(e),this.parameters.defaultAssembly=t,this.signals.defaultAssemblyChanged.dispatch(t)}return this}rebuildRepresentations(){this.reprList.forEach((t=>{t.build()})),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach((t=>{t.trajectory.setStructure(this.structureView)}))}updateRepresentations(t){super.updateRepresentations(t),this.measureRepresentations.update(t)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(t,e={},n=!1){e.defaultAssembly=this.parameters.defaultAssembly;const i=this._addRepresentation(t,this.structureView,e,n);return n||i.signals.parametersChanged.add((()=>this.measureUpdate())),i}addTrajectory(t="",e={}){const n=function(t,e,n){let i;return i=t&&t instanceof Cg?new Rg(t,e,n):!t&&e.frames?new kg(t,e,n):t&&"function"==typeof t?new Lg(t,e,n):new Dg(t,e,n),i}(t,this.structureView,e),i=new Mg(this.stage,n,e);return this.trajList.push(i),this.signals.trajectoryAdded.dispatch(i),i}removeTrajectory(t){const e=this.trajList.indexOf(t);-1!==e&&this.trajList.splice(e,1),t.dispose(),this.signals.trajectoryRemoved.dispatch(t)}dispose(){this.trajList.slice().forEach((t=>t.dispose())),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(t,e){"number"==typeof t&&(e=t,t=""),this.stage.animationControls.zoomMove(this.getCenter(t),this.getZoom(t),Aa(e,0))}getBoxUntransformed(t){let e;return e=t?this.structureView.getBoundingBox(new Ll(t)):this.structureView.boundingBox,e}getCenterUntransformed(t){return t&&"string"==typeof t?this.structure.atomCenter(new Ll(t)):this.structure.center}superpose(t,e,n,i){return Ug(this.structureView,t.structureView,e,n,i),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(t){let e=0;const n=this.structure.getAtomProxy(t);return this.eachRepresentation((t=>{if(t.getVisibility()){const i=t.repr;e=Math.max(i.getAtomRadius(n),e)}})),e}measurePick(t){const e=this.pickBuffer.count;if(this.lastPick===t.index&&e>=1){if(e>1){const t=this.pickBuffer.data,n=this.pickBuffer.data.sort();this.pickDict.has(n)?this.pickDict.del(n):this.pickDict.add(n,t),2===e?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter((t=>2===t.length))}):3===e?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter((t=>3===t.length))}):4===e&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter((t=>4===t.length))})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(t.index)||this.pickBuffer.push(t.index),this.lastPick=t.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const t=this.measureData();this.distanceRepresentation.setParameters({atomPair:t.distance}),this.angleRepresentation.setParameters({atomTriple:t.angle}),this.dihedralRepresentation.setParameters({atomQuad:t.dihedral})}measureUpdate(){const t=this.pickBuffer.data,e={};t.forEach((t=>{const n=Math.max(.1,this.getMaxRepresentationRadius(t));e[t]=n*(2.3-tl(.1,2,n))})),this.spacefillRepresentation.setSelection(t.length?"@"+t.join(","):"none"),t.length&&this.spacefillRepresentation.setParameters({radiusData:e})}measureData(){const t=this.pickDict.values;return{distance:t.filter((t=>2===t.length)),angle:t.filter((t=>3===t.length)),dihedral:t.filter((t=>4===t.length))}}removeAllMeasurements(t){const e=this.pickDict,n=e.values,i=function(t){n.filter((e=>e.length===t)).forEach((t=>e.del(t.slice().sort())))};(!t||1&t)&&i(2),(!t||2&t)&&i(3),(!t||4&t)&&i(4),this.measureBuild()}removeMeasurement(t){this.pickDict.del(t.slice().sort()),this.measureBuild()}addMeasurement(t){if(t.length<2||t.length>4)return;const e=t.slice().sort();this.pickDict.has(e)||this.pickDict.add(e,t),this.measureBuild()}}cc.add("structure",Vg),cc.add("structureview",Vg);class Hg extends xg{constructor(t,e,n={}){super(t,e,Object.assign({name:e.name},n)),this.surface=e}get type(){return"surface"}addRepresentation(t,e={}){return this._addRepresentation(t,this.surface,e)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}cc.add("surface",Hg);class Gg extends xg{constructor(t,e,n={}){super(t,e,Object.assign({name:e.name},n)),this.volume=e}get type(){return"volume"}addRepresentation(t,e={}){return this._addRepresentation(t,this.volume,e)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}cc.add("volume",Gg);class $g extends wg{addRepresentation(t,e){return this.forEach((n=>n.addRepresentation(t,e)))}autoView(t){return this.forEach((e=>e.autoView(t)))}}function jg(t,e){return t instanceof RegExp?null!==e.name.match(t):e.name===t}const Wg=new ue,qg={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1.2,ambientColor:14540253,ambientIntensity:.3,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class Xg{constructor(t,e={}){this.signals={parametersChanged:new va.Signal,fullscreenChanged:new va.Signal,componentAdded:new va.Signal,componentRemoved:new va.Signal,clicked:new va.Signal,hovered:new va.Signal},this.tasks=new kc,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new vu(t),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new Su(this.viewer.renderer.domElement),this.viewerControls=new qu(this),this.trackballControls=new Ou(this),this.pickingControls=new Bu(this),this.animationControls=new ih(this),this.mouseControls=new hf(this),this.keyControls=new ff(this),this.pickingBehavior=new mf(this),this.mouseBehavior=new gf(this),this.animationBehavior=new _f(this),this.keyBehavior=new yf(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=Ma(e,qg),this.setParameters(this.parameters),this.viewer.animate())}setParameters(t={}){Ca(this.parameters,t);const e=t,n=this.parameters,i=this.viewer,r=this.trackballControls;return void 0!==e.quality&&this.setQuality(n.quality),void 0!==e.impostor&&this.setImpostor(n.impostor),void 0!==e.rotateSpeed&&(r.rotateSpeed=n.rotateSpeed),void 0!==e.zoomSpeed&&(r.zoomSpeed=n.zoomSpeed),void 0!==e.panSpeed&&(r.panSpeed=n.panSpeed),void 0!==e.mousePreset&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),i.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),i.setFog(void 0,n.fogNear,n.fogFar),i.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),i.setSampling(n.sampleLevel),i.setBackground(n.backgroundColor),i.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(t){console.log("STAGE LOG",t),this.logList.push(t)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(t){if(t instanceof Vg){let e,n,i;t.setSelection("/0");const r=t.structure;if(r.biomolDict.BU1){const s=r.biomolDict.BU1;e=s.getAtomCount(r),n=s.getResidueCount(r),i=s.getInstanceCount(),t.setDefaultAssembly("BU1")}else e=r.getModelProxy(0).atomCount,n=r.getModelProxy(0).residueCount,i=1;let s=e;$l&&(s*=4);const o=r.atomStore.count/r.residueStore.count<2;o&&(s*=10);let a="chainname",l="RdYlBu",c=!1;if(1===r.getChainnameCount(new Ll("polymer and /0"))&&(a="residueindex",l="Spectral",c=!0),Ql&&console.log(s,e,i,o),n/i<4)t.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(i>5&&s>15e3||s>7e5){let e=Math.min(2,Math.max(.1,6e3/(s/i)));o&&(e=Math.min(e,.5)),t.addRepresentation("surface",{colorScheme:a,colorScale:l,colorReverse:c,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:e,useWorker:!1})}else s>25e4?t.addRepresentation("backbone",{colorScheme:a,colorScale:l,colorReverse:c,lineOnly:!0}):s>1e5?t.addRepresentation("backbone",{colorScheme:a,colorScale:l,colorReverse:c,quality:"low",disableImpostor:!0,radiusScale:2}):s>8e4?t.addRepresentation("backbone",{colorScheme:a,colorScale:l,colorReverse:c,radiusScale:2}):(t.addRepresentation("cartoon",{colorScheme:a,colorScale:l,colorReverse:c,radiusScale:.7,aspectRatio:5,quality:"auto"}),s<5e4&&t.addRepresentation("base",{colorScheme:a,colorScale:l,colorReverse:c,quality:"auto"}),t.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));t.structure.frames.length&&t.addTrajectory()}else(t instanceof Hg||t instanceof Gg)&&t.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(t,e={}){const n=Object.assign({},this.defaultFileParams,e),i=Sc(t).name;this.tasks.increment(),this.log(`loading file '${i}'`);const r=Aa(n.ext,Sc(t).ext);let s;return s=oc.isTrajectory(r)?Promise.reject(new Error(`loadFile: ext '${r}' is a trajectory and must be loaded into a structure component`)):Mc(t,n),s.then((t=>{this.log(`loaded '${i}'`);const e=this.addComponentFromObject(t,n);return n.defaultRepresentation&&this.defaultFileRepresentation(e),this.tasks.decrement(),e}),(t=>{this.tasks.decrement();const e=`error loading file: '${t}'`;throw this.log(e),e}))}loadScript(t){const e=Sc(t).name;return this.log(`loading script '${e}'`),Mc(t).then((t=>{this.tasks.increment(),this.log(`running script '${e}'`),t.run(this).then((()=>{this.tasks.decrement(),this.log(`finished script '${e}'`)})),this.log(`called script '${e}'`)}),(t=>{this.tasks.decrement();const n=`errored script '${e}' "${t}"`;throw this.log(n),n}))}addComponent(t){t?(this.compList.push(t),this.signals.componentAdded.dispatch(t)):Yl.warn("Stage.addComponent: no component given")}addComponentFromObject(t,e={}){const n=cc.get(t.type);if(n){const i=new n(this,t,e);return this.addComponent(i),i}Yl.warn("no component for object type",t.type)}removeComponent(t){const e=this.compList.indexOf(t);-1!==e&&(this.compList.splice(e,1),t.dispose(),this.signals.componentRemoved.dispatch(t))}removeAllComponents(){this.compList.slice().forEach((t=>this.removeComponent(t)))}handleResize(){this.viewer.handleResize()}setSize(t,e){const n=this.viewer.container;n!==document.body&&(void 0!==t&&(n.style.width=t),void 0!==e&&(n.style.height=e),this.handleResize())}toggleFullscreen(t){if(!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))return void Yl.log("fullscreen mode (currently) not possible");const e=this;function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function i(){if(!n()&&e.lastFullscreenElement){const t=e.lastFullscreenElement;t.style.width=t.dataset.normalWidth||"",t.style.height=t.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),e.handleResize(),e.signals.fullscreenChanged.dispatch(!1)}}t=t||this.viewer.container,this.lastFullscreenElement=t,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(t.dataset.normalWidth=t.style.width||"",t.dataset.normalHeight=t.style.height||"",t.style.width=window.screen.width+"px",t.style.height=window.screen.height+"px",t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout((function(){e.handleResize()}),100))}setSpin(t){t?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(t){t?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const t=this.parameters;if("scene"!==t.clipMode)return 0;let e=t.clipNear;return"absolute"===t.clipScale&&(e=this.viewer.absoluteToRelative(e)),2*e}setFocus(t){if("scene"!==this.parameters.clipMode)return;let e,n,i,r;"relative"===this.parameters.clipScale?(e=Za(t/2,0,49.9),n=100-e,i=50,r=function(t){return Za(t,0,100)}(2*n-50)):(e=this.viewer.relativeToAbsolute(t/2),n=e,i=0,r=2*n),this.setParameters({clipNear:e,clipFar:n,fogNear:i,fogFar:r})}getZoomForBox(t){const e=t.getSize(Wg),n=Math.max(e.x,e.y,e.z),i=Math.min(e.x,e.y,e.z);let r=n+Math.sqrt(i);const s=qa(this.viewer.perspectiveCamera.fov),o=this.viewer.width,a=this.viewer.height,l=a<o?1:o/a;return r=Math.abs(.5*r/l/Math.sin(s/2)),r+=this.parameters.clipDist,-r}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(t){return this.getBox().getCenter(t||new ue)}autoView(t){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),Aa(t,0))}makeImage(t={}){return new Promise(((e,n)=>{this.tasks.onZeroOnce((()=>{this.tasks.increment(),this.viewer.makeImage(t).then((t=>{this.tasks.decrement(),e(t)})).catch((t=>{this.tasks.decrement(),n(t)}))}))}))}setImpostor(t){this.parameters.impostor=t;const e=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(n){if(!e.includes(n.getType()))return;const i=n.getParameters();i.disableImpostor=!t,n.build(i)}))}setQuality(t){this.parameters.quality=t;const e=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(i){const r=i.getParameters();if(!e.includes(i.getType())){if(!n.includes(i.getType()))return;if(!r.disableImpostor)return void(i.repr.quality=t)}r.quality=t,i.build(r)}))}eachComponent(t,e){this.compList.slice().forEach((n=>{void 0!==e&&e!==n.type||t(n)}))}eachRepresentation(t,e){this.eachComponent((n=>{n.reprList.slice().forEach((i=>{void 0!==e&&e!==i.getType()||t(i,n)}))}))}getComponentsByName(t){const e=[];return this.eachComponent((n=>{(void 0===t||jg(t,n))&&e.push(n)})),new $g(e)}getComponentsByObject(t){const e=[];return this.eachComponent((n=>{n.object===t&&e.push(n)})),new $g(e)}getRepresentationsByName(t){const e=[];return this.eachRepresentation(((n,i)=>{(void 0===t||jg(t,n))&&e.push(n)})),new Sg(e)}measureClear(){this.eachComponent((t=>t.measureClear()),"structure")}measureUpdate(){this.eachComponent((t=>t.measureUpdate()),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class Yg extends xg{constructor(t,e,n={}){super(t,e,Object.assign({name:e.name},n)),this.shape=e}get type(){return"shape"}addRepresentation(t,e={}){return this._addRepresentation(t,this.shape,e)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function Kg(t,e,n,i){var r,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,n,o):r(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function Zg(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){t.done?r(t.value):function(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(o,a)}l((i=i.apply(t,e||[])).next())}))}cc.add("shape",Yg),"function"==typeof SuppressedError&&SuppressedError;class Qg extends sl{constructor(t){super(t),t.scale||(this.parameters.scale="rainbow",this.parameters.reverse=Aa(t.reverse,!0)),this.scalePerModel={},t.structure.eachModel((t=>{this.parameters.domain=[t.atomOffset,t.atomEnd],this.scalePerModel[t.index]=this.getScale()}))}atomColor(t){return this.scalePerModel[t.modelIndex](t.index)}}Kg([rl],Qg.prototype,"atomColor",null),ic.add("atomindex",Qg);class Jg extends sl{constructor(t){if(super(t),t.scale||(this.parameters.scale="OrRd"),!t.domain){let e,n=1/0,i=-1/0;t.sele&&(e=new Ll(t.sele)),t.structure.eachAtom((function(t){const e=t.bfactor;n=Math.min(n,e),i=Math.max(i,e)}),e),this.parameters.domain=[n,i]}this.bfactorScale=this.getScale()}atomColor(t){return this.bfactorScale(t.bfactor)}}Kg([rl],Jg.prototype,"atomColor",null),ic.add("bfactor",Jg);class t_ extends sl{constructor(t){super(t),this.chainidDictPerModel={},this.scalePerModel={},t.scale||(this.parameters.scale="Spectral"),t.structure.eachModel((t=>{let e=0;const n={};t.eachChain((function(t){void 0===n[t.chainid]&&(n[t.chainid]=e,e+=1)})),this.parameters.domain=[0,e-1],this.chainidDictPerModel[t.index]=n,this.scalePerModel[t.index]=this.getScale()}))}atomColor(t){const e=this.chainidDictPerModel[t.modelIndex];return this.scalePerModel[t.modelIndex](e[t.chainid])}}Kg([rl],t_.prototype,"atomColor",null),ic.add("chainid",t_);class e_ extends sl{constructor(t){super(t),this.scalePerModel={},t.scale||(this.parameters.scale="Spectral"),t.structure.eachModel((t=>{this.parameters.domain=[t.chainOffset,t.chainEnd],this.scalePerModel[t.index]=this.getScale()}))}atomColor(t){return this.scalePerModel[t.modelIndex](t.chainIndex)}}Kg([rl],e_.prototype,"atomColor",null),ic.add("chainindex",e_);class n_ extends sl{constructor(t){super(t),this.chainnameDictPerModel={},this.scalePerModel={},t.scale||(this.parameters.scale="Spectral"),t.structure.eachModel((t=>{let e=0;const n={};t.eachChain((function(t){void 0===n[t.chainname]&&(n[t.chainname]=e,e+=1)})),this.parameters.domain=[0,e-1],this.chainnameDictPerModel[t.index]=n,this.scalePerModel[t.index]=this.getScale()}))}atomColor(t){const e=this.chainnameDictPerModel[t.modelIndex];return this.scalePerModel[t.modelIndex](e[t.chainname])}}Kg([rl],n_.prototype,"atomColor",null),ic.add("chainname",n_);class i_ extends sl{constructor(t){super(t),this.rsrzDict={},this.rsccDict={},t.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const e=t.structure.validation;e&&(this.rsrzDict=e.rsrzDict,this.rsccDict=e.rsccDict)}atomColor(t){let e=t.resno+"";t.inscode&&(e+="^"+t.inscode),t.chainname&&(e+=":"+t.chainname),e+="/"+t.modelIndex;const n=this.rsrzDict[e];if(void 0!==n)return this.rsrzScale(n);const i=this.rsccDict[e];return void 0!==i?this.rsccScale(i):9474192}}Kg([rl],i_.prototype,"atomColor",null),ic.add("densityfit",i_);const r_={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class s_ extends sl{constructor(t){super(t),this.delta=new ue,this.hCharges=[],t.scale||(this.parameters.scale="rwb"),t.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(t.structure.atomCount);const e=[];t.structure.eachAtom((t=>{var n;if(this.charges[t.index]=(null!==(n=t).partialCharge?n.partialCharge:n.isProtein()&&(r_[n.resname]&&r_[n.resname][n.atomname]||r_.backbone[n.atomname])||0)*t.occupancy,"N"===t.atomname){if(t.bondCount>=3)return;if(t.bondToElementCount(1))return;const n=function(t,e=new ue){let n=!1,i=!1,r=!1;return e.set(2*t.x,2*t.y,2*t.z),t.eachBondedAtom((function(t){if(!n)return"H"===t.atomname?(e.set(t.x,t.y,t.z),void(n=!0)):void(i||"CA"!==t.atomname?r||"C"!==t.atomname||(r=!0,e.sub(t)):(e.sub(t),i=!0))})),n?e:i&&r?(e.normalize(),e.multiplyScalar(1.04),e.add(t),e):void 0}(t);void 0!==n&&(e.push(n),this.hCharges.push(.25*t.occupancy))}}));const n=t.structure.getBoundingBox();n.expandByScalar(1.04),this.hStore=function(t){const e=t.length,n=new Float32Array(e),i=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e++){const s=t[e];n[e]=s.x,i[e]=s.y,r[e]=s.z}return{x:n,y:i,z:r,count:e}}(e),this.hHash=new Yh(this.hStore,n),this.hash=new Yh(t.structure.atomStore,n)}positionColor(t){const e=this.charges,n=this.hCharges;let i=0;return this.hash.eachWithin(t.x,t.y,t.z,12,((t,n)=>{const r=e[t];0!==r&&(i+=r/n)})),this.hHash.eachWithin(t.x,t.y,t.z,12,((t,e)=>{const r=n[t];0!==r&&(i+=r/e)})),this.scale(332*i)}}Kg([rl],s_.prototype,"positionColor",null),ic.add("electrostatic",s_);const o_={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class a_ extends sl{constructor(t){t.value=Aa(t.value,o_.C),super(t)}atomColor(t){const e=t.element;return"C"===e?this.parameters.value:o_[e]||16777215}}Kg([rl],a_.prototype,"atomColor",null),ic.add("element",a_);class l_ extends sl{constructor(t){super(t),t.scale||(this.parameters.scale="Spectral"),t.domain||(this.parameters.domain=[0,t.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(t){return this.entityindexScale(t.entityIndex)}}Kg([rl],l_.prototype,"atomColor",null),ic.add("entityindex",l_);class c_ extends sl{atomColor(t){const e=t.entity;switch(e?e.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}Kg([rl],c_.prototype,"atomColor",null),ic.add("entitytype",c_);class u_ extends sl{constructor(t){super(t),this.geoAtomDict={},this.geoDict={};const e=t.structure.validation;e&&(this.geoAtomDict=e.geoAtomDict,this.geoDict=e.geoDict)}atomColor(t){let e,n=t.resno+"";t.inscode&&(n+="^"+t.inscode),t.chainname&&(n+=":"+t.chainname),n+="/"+t.modelIndex;const i=this.geoAtomDict[n];var r;return void 0!==i?(r=i[t.atomname]||0,e=16843009*((r=(858993459&(r-=r>>1&1431655765))+(r>>2&858993459))+(r>>4)&252645135)>>24):e=this.geoDict[n]||0,0===e?2188972:1===e?16703627:2===e?16018755:e>=3?10813478:9474192}}Kg([rl],u_.prototype,"atomColor",null),ic.add("geoquality",u_);class h_ extends sl{constructor(t){super(t),this.resHF={},t.scale||(this.parameters.scale="RdYlGn");for(const t in vd)this.resHF[t]=vd[t][0];if(this.defaultResidueHydrophobicity=yd[0],!t.domain){let t=1/0,e=-1/0;for(const n in this.resHF){const i=this.resHF[n];t=Math.min(t,i),e=Math.max(e,i)}this.parameters.domain=[t,0,e]}this.hfScale=this.getScale()}atomColor(t){return this.hfScale(this.resHF[t.resname]||this.defaultResidueHydrophobicity)}}Kg([rl],h_.prototype,"atomColor",null),ic.add("hydrophobicity",h_);class d_ extends sl{constructor(t){super(t),t.scale||(this.parameters.scale="rainbow"),t.domain||(this.parameters.domain=[0,t.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(t){return this.modelindexScale(t.modelIndex)}}Kg([rl],d_.prototype,"atomColor",null),ic.add("modelindex",d_);class p_ extends sl{atomColor(t){switch(t.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}Kg([rl],p_.prototype,"atomColor",null),ic.add("moleculetype",p_);class f_ extends sl{constructor(t){super(t),t.scale||(this.parameters.scale="PuBu"),t.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(t){return this.occupancyScale(t.occupancy)}}Kg([rl],f_.prototype,"atomColor",null),ic.add("occupancy",f_);class m_ extends sl{constructor(t){super(t),t.scale||(this.parameters.scale="rwb"),t.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(t){return this.partialchargeScale(t.partialCharge||0)}}function g_(){return 16777215*Math.random()}Kg([rl],m_.prototype,"atomColor",null),ic.add("partialcharge",m_);class __ extends sl{atomColor(){return g_()}volumeColor(){return g_()}positionColor(){return g_()}}Kg([rl],__.prototype,"atomColor",null),Kg([rl],__.prototype,"volumeColor",null),Kg([rl],__.prototype,"positionColor",null),ic.add("random",__);class v_ extends sl{constructor(t){super(t),this.rciDict={},t.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const e=t.structure.validation;e&&(this.rciDict=e.rciDict)}atomColor(t){let e=`[${t.resname}]${t.resno}`;t.chainname&&(e+=":"+t.chainname);const n=this.rciDict[e];return void 0!==n?this.rciScale(n):9474192}}Kg([rl],v_.prototype,"atomColor",null),ic.add("randomcoilindex",v_);class y_ extends sl{constructor(t){super(t),this.scalePerChain={},t.scale||(this.parameters.scale="rainbow",this.parameters.reverse=Aa(t.reverse,!0)),t.structure.eachChain((t=>{this.parameters.domain=[t.residueOffset,t.residueEnd],this.scalePerChain[t.index]=this.getScale()}))}atomColor(t){return this.scalePerChain[t.chainIndex](t.residueIndex)}}Kg([rl],y_.prototype,"atomColor",null),ic.add("residueindex",y_);const b_={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class x_ extends sl{atomColor(t){return b_[t.resname]||16711935}}Kg([rl],x_.prototype,"atomColor",null),ic.add("resname",x_);class w_ extends sl{constructor(t){super(t),this.residueProxy=t.structure.getResidueProxy()}atomColor(t){const e=t.sstruc,n=this.residueProxy;return"h"===e?16711808:"g"===e?10485888:"i"===e?6291584:"e"===e||"b"===e?16762880:"t"===e?6324479:(n.index=t.residueIndex,n.isDna()?11403518:n.isRna()?16580962:n.isSaccharide()?10921722:n.isProtein()||"s"===e||"l"===e?16777215:8421504)}}Kg([rl],w_.prototype,"atomColor",null),ic.add("sstruc",w_);class S_ extends sl{constructor(t){var e,n;super(t),t.scale||(this.parameters.scale="rwb"),this.atomData=null===(e=this.parameters.data)||void 0===e?void 0:e.atomData,this.bondData=null===(n=this.parameters.data)||void 0===n?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(t){var e;const n=null===(e=this.atomData)||void 0===e?void 0:e[t.index];return void 0!==n?this.scale(n):this.parameters.value}bondColor(t,e){var n;const i=null===(n=this.bondData)||void 0===n?void 0:n[t.index];return void 0!==i?this.scale(i):this.atomProxy?(this.atomProxy.index=e?t.atomIndex1:t.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}Kg([rl],S_.prototype,"atomColor",null),Kg([rl],S_.prototype,"bondColor",null),ic.add("structuredata",S_);class A_ extends sl{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}Kg([rl],A_.prototype,"atomColor",null),Kg([rl],A_.prototype,"bondColor",null),Kg([rl],A_.prototype,"valueColor",null),Kg([rl],A_.prototype,"volumeColor",null),ic.add("uniform",A_);class M_ extends sl{constructor(t){super(t),this.valueScale=this.getScale()}volumeColor(t){return this.valueScale(this.parameters.volume.data[t])}}Kg([rl],M_.prototype,"volumeColor",null),ic.add("value",M_);class C_ extends sl{constructor(t){super(t),this.vec=new ue,this.valueScale=this.getScale()}positionColor(t){const e=this.parameters.volume;if(!e||!e.inverseMatrix)return this.parameters.value;const n=this.vec,i=e.data,r=e.nx,s=e.ny,o=r*s;n.copy(t),n.applyMatrix4(e.inverseMatrix);const a=Math.floor(n.x),l=Math.floor(n.y),c=Math.floor(n.z),u=(c*s+l)*r+a,h=u+1,d=u+r,p=u+o,f=d+1,m=p+1,g=d+o,_=g+1,v=i[u],y=i[h],b=i[d],x=i[p],w=i[f],S=i[m],A=i[g],M=i[_],C=n.x-a,E=n.y-l,T=n.z-c,P=Qa(v,y,C),I=Qa(x,S,C),R=Qa(b,w,C),k=Qa(A,M,C),D=Qa(P,R,E),L=Qa(I,k,E),O=Qa(D,L,T);return this.valueScale(O)}}Kg([rl],C_.prototype,"positionColor",null),ic.add("volume",C_);class E_ extends sh{constructor(t,e,n){const i=n||{};if(super(t,e,i),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:Cf.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new Ll(i.sele),this.dataList=[],this.structure=t,this.structureView=this.structure.getView(this.selection),t.biomolDict){const e={default:"default","":t.unitcell?"AU":"FULL"};Object.keys(t.biomolDict).forEach((function(t){e[t]=t})),this.parameters.assembly={type:"select",options:e,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(t){const e=t||{};e.colorScheme=Aa(e.colorScheme,"element"),this.setRadius(e.radius,e),this.radiusType=Aa(e.radiusType,"vdw"),this.radiusData=Aa(e.radiusData,{}),this.radiusSize=Aa(e.radiusSize,1),this.radiusScale=Aa(e.radiusScale,1),this.assembly=Aa(e.assembly,"default"),this.defaultAssembly=Aa(e.defaultAssembly,""),"auto"===e.quality&&(e.quality=this.getQuality()),super.init(e),this.selection.signals.stringChanged.add((()=>{this.build()})),this.build()}setRadius(t,e){const n=Object.keys(Mf);return"string"==typeof t&&n.includes(t.toLowerCase())?e.radiusType=t:void 0!==t&&(e.radiusType="size",e.radiusSize=t),this}getAssembly(){const t="default"===this.assembly?this.defaultAssembly:this.assembly;return this.structure.biomolDict[t]}getQuality(){let t;const e=this.structureView,n=this.getAssembly();return t=n?n.getAtomCount(e):e.atomCount,$l&&(t*=4),e.atomStore.count/e.residueStore.count<2&&(t*=10),t<15e3?"high":t<8e4?"medium":"low"}create(){if(0===this.structureView.atomCount)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const t=this.getAssembly();if(t)t.partList.forEach(((t,e)=>{const n=t.getView(this.structureView);if(0===n.atomCount)return;const i=this.createData(n,e);i&&(i.sview=n,i.instanceList=t.getInstanceList(),this.dataList.push(i))}));else{const t=this.createData(this.structureView,0);t&&(t.sview=this.structureView,this.dataList.push(t))}}update(t){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach((e=>{e.bufferList.length>0&&this.updateData(t,e)}),this):Object.assign(this.lazyProps.what,t)}updateData(t,e){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(t){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(t,e){return Object.assign({what:t,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},e)}getBondParams(t,e){return Object.assign({what:t,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},e)}getAtomRadius(t){return this.structureView.atomSet.isSet(t.index)?new Cf(this.getRadiusParams()).atomRadius(t):0}setSelection(t,e){return this.selection.setString(t,e),this}setParameters(t,e={},n=!1){const i=t||{};return this.setRadius(i.radius,i),void 0===i.radiusType&&void 0===i.radiusData&&void 0===i.radiusSize&&void 0===i.radiusScale||(e.radius=!0,ql&&!this.disableImpostor||(n=!0)),void 0!==i.defaultAssembly&&i.defaultAssembly!==this.defaultAssembly&&("default"===this.assembly&&void 0===i.assembly||"default"===i.assembly)&&(n=!0),super.setParameters(i,e,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(t){const e=this.viewer,n=this.bufferList;this.dataList.forEach((function(t){t.bufferList.forEach((function(i){n.push(i),e.add(i,t.instanceList)}))})),this.setVisibility(this.visible),t()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class T_ extends E_{constructor(t,e,n){super(t,e,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(t){const e=t||{};this.labelVisible=Aa(e.labelVisible,!0),this.labelSize=Aa(e.labelSize,2),this.labelColor=Aa(e.labelColor,16777215),this.labelFontFamily=Aa(e.labelFontFamily,"sans-serif"),this.labelFontStyle=Aa(e.labelFontstyle,"normal"),this.labelFontWeight=Aa(e.labelFontWeight,"bold"),this.labelsdf=Aa(e.labelsdf,"Chrome"===Hl),this.labelXOffset=Aa(e.labelXOffset,0),this.labelYOffset=Aa(e.labelYOffset,0),this.labelZOffset=Aa(e.labelZOffset,.5),this.labelAttachment=Aa(e.labelAttachment,"bottom-left"),this.labelBorder=Aa(e.labelBorder,!1),this.labelBorderColor=Aa(e.labelBorderColor,"lightgrey"),this.labelBorderWidth=Aa(e.labelBorderWidth,.15),this.labelBackground=Aa(e.labelBackground,!1),this.labelBackgroundColor=Aa(e.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=Aa(e.labelBackgroundMargin,.5),this.labelBackgroundOpacity=Aa(e.labelBackgroundOpacity,1),this.labelFixedSize=Aa(e.labelFixedSize,!1),this.lineOpacity=Aa(e.lineOpacity,1),this.linewidth=Aa(e.linewidth,2),super.init(e)}update(t){t.position?this.build():super.update(t)}updateData(t,e){const n={};if(t&&!t.labelSize||Object.assign(n,{size:$c(this.n,this.labelSize)}),!t||t.labelColor){const t=new Pn(this.labelColor);Object.assign(n,{color:jc(this.n,t.r,t.g,t.b)})}this.textBuffer.setAttributes(n)}setParameters(t,e={},n=!1){return t&&t.labelSize&&(e.labelSize=!0),t&&(t.labelColor||0===t.labelColor)&&(e.labelColor=!0,n=!0),super.setParameters(t,e,n),t&&void 0!==t.opacity&&this.textBuffer.setParameters({opacity:1}),t&&void 0!==t.labelVisible&&this.setVisibility(this.visible),this}setVisibility(t,e){return super.setVisibility(t,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),e||this.viewer.requestRender(),this}getLabelBufferParams(t={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},t,{opacity:1}))}getAtomRadius(){return 0}}function P_(t,e){const n=t.getAtomProxy(),i=new Ll,r=e.length;if(0===r)return new Float32Array(0);const s=e[0].length,o=t.getAtomSet(),a=new Float32Array(r*s*3);let l=0;return e.forEach((function(e){let r=!1;for(let c=0;c<s;c++){const s=e[c];if("number"==typeof s&&Number.isInteger(s)){if(!o.get(s)){r=!0;break}n.index=s}else{i.setString(s);const e=t.getAtomIndices(i);if(!e.length){r=!0;break}n.index=e[0]}let u=l+3*c;a[u++]=n.x,a[u++]=n.y,a[u++]=n.z}r||(l+=3*s)})),a.subarray(0,l)}function I_(t,e,n,i,r){const s=Math.cos(r),o=Math.sin(r);t[0]=e[0]+n[0]*s+i[0]*o,t[1]=e[1]+n[1]*s+i[1]*o,t[2]=e[2]+n[2]*s+i[2]*o}function R_(t,e,n,i,r,s,o){for(let a=0;a<e;a++){for(let r=0;r<n;r++)i[r]=t[r*e+a];k_(i,r,s,o,n);for(let i=0;i<n;i++)t[i*e+a]=r[i]}for(let a=0;a<n;a++){for(let n=0;n<e;n++)i[n]=t[a*e+n];k_(i,r,s,o,e);for(let n=0;n<e;n++)t[a*e+n]=Math.sqrt(r[n])}}function k_(t,e,n,i,r){n[0]=0,i[0]=Number.MIN_SAFE_INTEGER,i[1]=Number.MAX_SAFE_INTEGER;for(let e=1,s=0;e<r;e++){let r=(t[e]+e*e-(t[n[s]]+n[s]*n[s]))/(2*e-2*n[s]);for(;r<=i[s];)s--,r=(t[e]+e*e-(t[n[s]]+n[s]*n[s]))/(2*e-2*n[s]);s++,n[s]=e,i[s]=r,i[s+1]=Number.MAX_SAFE_INTEGER}for(let s=0,o=0;s<r;s++){for(;i[o+1]<s;)o++;e[s]=(s-n[o])*(s-n[o])+t[n[o]]}}ac.add("shader/SDFFont.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float xOffset;\nuniform float yOffset;\nuniform float zOffset;\nuniform bool ortho;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\nattribute vec2 mapping;\nattribute vec2 inputTexCoord;\nattribute float inputSize;\n#include matrix_scale\n#include common\nvoid main(void){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\ntexCoord = inputTexCoord;\nfloat scale = matrixScale( modelViewMatrix );\nfloat _xOffset = xOffset * scale;\nfloat _yOffset = yOffset * scale;\nfloat _zOffset = zOffset * scale;\nif( texCoord.x == 10.0 ){\n_zOffset -= 0.001;\n}\nvec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );\n#ifdef FIXED_SIZE\nif ( ortho ) {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;\n} else {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;\n}\n#endif\nvec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );\ncameraCornerPos.xy += mapping * inputSize * 0.01 * scale;\ncameraCornerPos.x += _xOffset;\ncameraCornerPos.y += _yOffset;\nif( ortho ){\ncameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;\n} else {\ncameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;\n}\ngl_Position = projectionMatrix * cameraCornerPos;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -cameraCornerPos.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),ac.add("shader/SDFFont.frag","uniform sampler2D fontTexture;\nuniform float opacity;\nuniform bool showBorder;\nuniform vec3 borderColor;\nuniform float borderWidth;\nuniform vec3 backgroundColor;\nuniform float backgroundOpacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\nconst vec3 vColor = vec3( 0.0 );\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#endif\nconst float gamma = 2.2 * 1.4142 / 128.0;\nconst float padding = 0.75;\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\nif( texCoord.x > 1.0 ){\ngl_FragColor = vec4( backgroundColor, backgroundOpacity );\n}else{\nfloat sdf = texture2D( fontTexture, texCoord ).a;\nif( showBorder ) sdf += borderWidth;\nfloat a = smoothstep(padding - gamma, padding + gamma, sdf);\nif( a < 0.2 ) discard;\na *= opacity;\nvec3 outgoingLight = vColor;\nif( showBorder && sdf < ( padding + borderWidth ) ){\noutgoingLight = borderColor;\n}\ngl_FragColor = vec4( outgoingLight, a );\n}\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const D_={},L_={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class O_{constructor(t={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=Ma(t,L_);const e=this.parameters;this.radius=e.size/8,this.padding=e.size/3;const n=this.lineHeight=e.size+2*e.outline+Math.round(e.size/4),i=this.maxWidth=e.width/4,r=this.canvas=document.createElement("canvas");r.width=i,r.height=n;const s=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});s.font=`${e.style} ${e.variant} ${e.weight} ${e.size}px ${e.font}`,s.fillStyle="black",s.textAlign="left",s.textBaseline="bottom",s.lineJoin="round",this.gridOuter=new Float64Array(n*i),this.gridInner=new Float64Array(n*i),this.f=new Float64Array(Math.max(n,i)),this.d=new Float64Array(Math.max(n,i)),this.z=new Float64Array(Math.max(n,i)+1),this.v=new Int16Array(Math.max(n,i)),this.data=new Uint8Array(e.width*e.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=e.width,this.canvas2.height=e.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map(String.fromCharCode(65533));for(let t=32;t<=126;++t)this.map(String.fromCharCode(t));this.map(String.fromCharCode(176)),this.map(String.fromCharCode(8491)),this.texture=new Do(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(t){const e=this.parameters;return void 0===this.mapped[t]&&(this.draw(t),this.currentX+this.scratchW>e.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>e.height&&console.warn("canvas to small"),this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[t]}get(t){return this.mapped[t]||this.placeholder}draw(t){const e=this.parameters,n=this.lineHeight,i=e.outline,r=this.context,s=this.maxWidth,o=i,a=n-e.outline,l=r.measureText(t),c=Math.min(s,Math.ceil(l.width+2*o+1)),u=c*n;r.clearRect(0,0,c,n),r.fillText(t,o,a);const h=r.getImageData(0,0,c,n),d=h.data;for(let t=0;t<u;t++){const e=h.data[4*t+3]/255;this.gridOuter[t]=1===e?0:0===e?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-e),2),this.gridInner[t]=1===e?Number.MAX_SAFE_INTEGER:0===e?0:Math.pow(Math.max(0,e-.5),2)}R_(this.gridOuter,c,n,this.f,this.d,this.v,this.z),R_(this.gridInner,c,n,this.f,this.d,this.v,this.z);for(let t=0;t<u;t++){const e=this.gridOuter[t]-this.gridInner[t];d[4*t+3]=Math.max(0,Math.min(255,Math.round(255-255*(e/this.radius+this.cutoff))))}r.putImageData(h,0,0),this.scratchW=c,this.scratchH=n}}const N_=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},Zp),F_=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},Qp);function B_(t,e){const n=t.position.length/3;let i=0;for(let e=0;e<n;++e)i+=t.text[e].length;return e.showBackground&&(i+=n),i}class U_ extends Qm{constructor(t,e={}){super({position:new Float32Array(3*B_(t,e)),color:new Float32Array(3*B_(t,e)),picking:new mp},e),this.parameterTypes=F_,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=t.text,this.positionCount=t.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Pn(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Pn(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(t),this.makeTexture(),this.makeMapping()}get defaultParameters(){return N_}makeMaterial(){super.makeMaterial();const t=this.texture,e=this.material;e.transparent=!0,e.extensions.derivatives=!0,e.lights=!1,e.uniforms.fontTexture.value=t,e.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=t,n.needsUpdate=!0;const i=this.pickingMaterial;i.extensions.derivatives=!0,i.lights=!1,i.uniforms.fontTexture.value=t,i.needsUpdate=!0}setAttributes(t={}){let e,n,i,r,s,o;const a=this.text,l=this.geometry.attributes;t.position&&(e=t.position,r=l.position.array,l.position.needsUpdate=!0),t.size&&(n=t.size,s=l.inputSize.array,l.inputSize.needsUpdate=!0),t.color&&(i=t.color,o=l.color.array,l.color.needsUpdate=!0);const c=this.positionCount;let u,h,d,p,f,m=0;for(let t=0;t<c;++t)for(h=3*t,d=a[t],f=d.length,this.parameters.showBackground&&(f+=1),p=0;p<f;++p,++m)for(let a=0;a<4;a++)u=4*m*3+3*a,e&&(r[u]=e[h],r[u+1]=e[h+1],r[u+2]=e[h+2]),n&&(s[4*m+a]=n[t]),i&&(o[u]=i[h],o[u+1]=i[h+1],o[u+2]=i[h+2])}makeTexture(){this.textAtlas=function(t){const e=JSON.stringify(t);return void 0===D_[e]&&(D_[e]=new O_(t)),D_[e]}({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const t=this.textAtlas,e=this.text,n=this.parameters.attachment,i=t.lineHeight*this.parameters.backgroundMargin*.1-10,r=this.geometry.attributes,s=r.inputTexCoord.array,o=r.mapping.array,a=this.positionCount;let l,c,u,h,d,p,f,m,g=0;for(let r=0;r<a;++r){for(u=e[r],h=0,p=u.length,d=0;d<p;++d)l=t.get(u[d]),h+=l.w-2*t.parameters.outline;for(m=n.startsWith("top")?t.lineHeight/1.25:n.startsWith("middle")?t.lineHeight/2.5:0,f=n.endsWith("right")?h:n.endsWith("center")?h/2:0,f+=t.parameters.outline,m+=t.parameters.outline,this.parameters.showBackground&&(c=2*g*4,o[c+0]=-t.lineHeight/6-f-i,o[c+1]=t.lineHeight-m+i,o[c+2]=-t.lineHeight/6-f-i,o[c+3]=0-m-i,o[c+4]=h+t.lineHeight/6-f+2*t.parameters.outline+i,o[c+5]=t.lineHeight-m+i,o[c+6]=h+t.lineHeight/6-f+2*t.parameters.outline+i,o[c+7]=0-m-i,s[c+0]=10,s[c+2]=10,s[c+4]=10,s[c+6]=10,g+=1),h=0,d=0;d<p;++d,++g){l=t.get(u[d]),c=2*g*4,o[c+0]=h-f,o[c+1]=l.h-m,o[c+2]=h-f,o[c+3]=0-m,o[c+4]=h+l.w-f,o[c+5]=l.h-m,o[c+6]=h+l.w-f,o[c+7]=0-m;const e=t.parameters.width,n=t.parameters.height,i=[l.x/e,l.y/n,l.x/e,(l.y+l.h)/n,(l.x+l.w)/e,l.y/n,(l.x+l.w)/e,(l.y+l.h)/n];s.set(i,c),h+=l.w-2*t.parameters.outline}}r.inputTexCoord.needsUpdate=!0,r.mapping.needsUpdate=!0}getDefines(t){const e=super.getDefines(t);return this.parameters.fixedSize&&(e.FIXED_SIZE=1),e}setUniforms(t){!t||void 0===t.fontFamily&&void 0===t.fontStyle&&void 0===t.fontWeight&&void 0===t.fontSize||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,t.fontTexture=this.texture),super.setUniforms(t)}}uc.add("text",U_),ac.add("shader/WideLine.vert","\nuniform float clipNear;\nuniform vec3 clipCenter;\nuniform float linewidth;\nuniform vec2 resolution;\nuniform mat4 projectionMatrixInverse;\nattribute vec2 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid trimSegment( const in vec4 start, inout vec4 end ) {\nfloat a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;\nfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\nend.xyz = mix( start.xyz, end.xyz, alpha );\n}\nvoid main() {\nfloat aspect = resolution.x / resolution.y;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nflag = mapping.y;\nvColor = color;\nvColor2 = color2;\n#endif\nvec4 start = modelViewMatrix * vec4( position1, 1.0 );\nvec4 end = modelViewMatrix * vec4( position2, 1.0 );\nbool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {\nif ( start.z < 0.0 && end.z >= 0.0 ) {\ntrimSegment( start, end );\n} else if ( end.z < 0.0 && start.z >= 0.0 ) {\ntrimSegment( end, start );\n}\n}\nvec4 clipStart = projectionMatrix * start;\nvec4 clipEnd = projectionMatrix * end;\nvec2 ndcStart = clipStart.xy / clipStart.w;\nvec2 ndcEnd = clipEnd.xy / clipEnd.w;\nvec2 dir = ndcEnd - ndcStart;\ndir.x *= aspect;\ndir = normalize( dir );\nvec2 offset = vec2( dir.y, - dir.x );\ndir.x /= aspect;\noffset.x /= aspect;\nif ( mapping.x < 0.0 ) offset *= - 1.0;\noffset *= linewidth;\noffset /= resolution.y;\nvec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;\noffset *= clip.w;\nclip.xy += offset;\ngl_Position = clip;\n#ifndef PICKING\nvViewPosition = ( projectionMatrixInverse * clip ).xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),ac.add("shader/WideLine.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include fog_pars_fragment\nvarying vec3 vViewPosition;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\n#endif\nvoid main() {\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\nif ( flag < 0.0 ) {\ndiffuseColor.rgb *= vColor;\n} else {\ndiffuseColor.rgb *= vColor2;\n}\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const z_=Object.assign({linewidth:2},Zp),V_=Object.assign({linewidth:{uniform:!0}},Qp);class H_ extends Qm{constructor(t,e={}){super(t,e),this.parameterTypes=V_,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!t.color2&&t.color&&(t.color2=t.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new Nt},projectionMatrixInverse:{value:new ze}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(t),this.makeMapping()}get defaultParameters(){return z_}setParameters(t){super.setParameters(t)}}uc.add("wideline",H_);class G_ extends T_{constructor(t,e,n){super(t,e,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(t){const e=t||{};e.side=Aa(e.side,"double"),e.opacity=Aa(e.opacity,.5),this.atomTriple=Aa(e.atomTriple,[]),this.arcVisible=Aa(e.arcVisible,!0),this.sectorVisible=Aa(e.sectorVisible,!0),this.vectorVisible=Aa(e.vectorVisible,!0),super.init(e)}createData(t){if(!t.atomCount||!this.atomTriple.length)return;const e=function(t,e){return function(t){const e=[],n=t.length/9;for(let i=0;i<n;i++){let n=!0;for(let e=i;e<i+3;e+=3)t[e]===t[e+3]&&t[e+1]===t[e+4]&&t[e+2]===t[e+5]&&(n=!1);n&&e.push(i)}const i=new Float32Array(9*e.length);let r=0;return e.forEach((function(e){Yc(t,i,9*e,9*r,9),r++})),i}(P_(t,e))}(t,this.atomTriple),n=function(t,e={}){const n=Aa(e.angleStep,Math.PI/90),i=t.length/9,r=new Float32Array(i),s=new Float32Array(3*i),o=new Array(i),a=new Float32Array(6*i),l=new Float32Array(6*i),c=new Array(i),u=new Array(i),h=new Array(i);let d=0;const p=fh(),f=fh(),m=fh(),g=fh(),_=fh(),v=fh(),y=fh(),b=fh(),x=fh();for(var w=0;w<i;w++){let e=9*w;yh(p,t,e),yh(f,t,e+3),yh(m,t,e+6);let i=6*w;bh(p,a,i),bh(f,l,i),bh(f,a,i+3),bh(m,l,i+3),_h(g,p,f),_h(_,m,f),Mh(g,g),Mh(_,_),mh(v,g,_);const S=wh(v),A=gh(g,_),M=r[w]=Math.atan2(S,A);o[w]=(zc*M).toFixed(1)+String.fromCharCode(176),0===wh(v)&&(v[0]=1,v[1]=0,v[2]=0),mh(y,v,g),Mh(y,y),I_(b,f,g,y,M/2),bh(b,s,3*w);const C=Math.ceil(M/n),E=new Float32Array(9*C);h[w]=E;const T=new Float32Array(3*C),P=new Float32Array(3*C);c[w]=T,u[w]=P,vh(x,f,g);const I=function(t,e){const n=9*e,i=3*e;bh(f,E,n),bh(x,E,n+3),bh(x,T,i),I_(x,f,g,y,t),bh(x,E,n+6),bh(x,P,i)};let R=0;for(let t=n;t<M;t+=n)I(t,R),R++;I(M,R),d+=C}const S=3*d,A=9*d,M=new Float32Array(S),C=new Float32Array(S),E=new Float32Array(A);let T=0,P=0;for(let t=0;t<i;t++){const e=c[t],n=u[t];Yc(e,M,0,P,e.length),Yc(n,C,0,P,n.length),P+=e.length;const i=h[t];Yc(i,E,0,T,i.length),T+=i.length}return{labelPosition:s,labelText:o,vectorPosition1:a,vectorPosition2:l,arcPosition1:M,arcPosition2:C,sectorPosition:E}}(e),i=this.n=n.labelPosition.length/3,r=new Pn(this.labelColor);this.textBuffer=new U_({position:n.labelPosition,size:$c(i,this.labelSize),color:jc(i,r.r,r.g,r.b),text:n.labelText},this.getLabelBufferParams());const s=new Pn(this.colorValue);return this.vectorBuffer=new H_(Lh({position1:n.vectorPosition1,position2:n.vectorPosition2,color:jc(2*i,s.r,s.g,s.b),color2:jc(2*i,s.r,s.g,s.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=n.arcPosition1.length/3,this.arcBuffer=new H_(Lh({position1:n.arcPosition1,position2:n.arcPosition2,color:jc(this.arcLength,s.r,s.g,s.b),color2:jc(this.arcLength,s.r,s.g,s.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=n.sectorPosition.length/3,this.sectorBuffer=new tf({position:n.sectorPosition,color:jc(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(t,e){super.updateData(t,e);const n={},i={},r={};if(t.color){const t=new Pn(this.colorValue);Object.assign(n,{color:jc(2*this.n,t.r,t.g,t.b),color2:jc(2*this.n,t.r,t.g,t.b)}),Object.assign(i,{color:jc(this.arcLength,t.r,t.g,t.b),color2:jc(this.arcLength,t.r,t.g,t.b)}),Object.assign(r,{color:jc(this.sectorLength,t.r,t.g,t.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(i),this.sectorBuffer.setAttributes(r)}setParameters(t){return super.setParameters(t,{},!1),!t||void 0===t.vectorVisible&&void 0===t.arcVisible&&void 0===t.sectorVisible||this.setVisibility(this.visible),t&&t.lineOpacity&&(this.vectorBuffer.setParameters({opacity:t.lineOpacity}),this.arcBuffer.setParameters({opacity:t.lineOpacity})),t&&void 0!==t.opacity&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),t&&t.linewidth&&(this.vectorBuffer.setParameters({linewidth:t.linewidth}),this.arcBuffer.setParameters({linewidth:t.linewidth})),this}setVisibility(t,e){return super.setVisibility(t,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),e||this.viewer.requestRender(),this}}sc.add("angle",G_);const $_=new ue,j_=new ue,W_=new ue,q_=new ue(0,1,0),X_=Object.assign({radialSegments:1,openEnded:!0},Zp);function Y_(t={}){const e=Aa(t.radialSegments,10),n=Aa(t.openEnded,!0),i=(new ze).makeRotationX(Math.PI/2),r=new Lo(1,1,1,e,1,n);return r.applyMatrix4(i),r}class K_ extends jm{constructor(t,e={}){super(function(t,e={}){const n=Y_(e),i=t.position1.length,r=n.attributes.position.array.length/3,s=i/3,o=new Float32Array(2*s*r);return qc(s,r,0,o),qc(s,r,s*r,o),{position:new Float32Array(2*i),color:new Float32Array(2*i),primitiveId:o,picking:t.picking}}(t,e),e,Y_(e)),this.updateNormals=!0;const n=t.position1.length,i=t.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*i),this.setAttributes(t,!0)}get defaultParameters(){return X_}applyPositionTransform(t,e,n){j_.fromArray(this._from,n),W_.fromArray(this._to,n),t.lookAt(j_,W_,q_);const i=this._radius[e];$_.set(i,i,j_.distanceTo(W_)),t.scale($_)}setAttributes(t={},e){const n={};t.position1&&t.position2&&(Hc(t.position1,t.position2,this.__center),Hc(t.position1,this.__center,this._position),Hc(this.__center,t.position2,this._position,t.position1.length),this._from.set(t.position1),this._from.set(this.__center,t.position1.length),this._to.set(this.__center),this._to.set(t.position2,this.__center.length),n.position=this._position),t.color&&t.color2&&(this._color.set(t.color),this._color.set(t.color2,t.color.length),n.color=this._color),t.radius&&(this._radius.set(t.radius),this._radius.set(t.radius,t.radius.length),n.radius=this._radius),super.setAttributes(n,e)}}ac.add("shader/CylinderImpostor.vert","\nattribute vec3 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\nattribute float radius;\nvarying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform mat4 modelViewMatrixInverse;\nuniform float ortho;\n#include matrix_scale\nvoid main(){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nbase_radius.w = radius * matrixScale( modelViewMatrix );\nvec3 center = position;\nvec3 dir = normalize( position2 - position1 );\nfloat ext = length( position2 - position1 ) / 2.0;\nvec3 cam_dir;\nif( ortho == 0.0 ){\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;\n}else{\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;\n}\ncam_dir = normalize( cam_dir );\nvec3 ldir;\nfloat b = dot( cam_dir, dir );\nend_b.w = b;\nif( b < 0.0 )\nldir = -ext * dir;\nelse\nldir = ext * dir;\nvec3 left = radius * normalize( cross( cam_dir, ldir ) );\nvec3 up = radius * normalize( cross( left, ldir ) );\naxis = normalize( normalMatrix * ldir );\nU = normalize( normalMatrix * up );\nV = normalize( normalMatrix * left );\nvec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );\nbase_radius.xyz = base4.xyz / base4.w;\nvec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );\nend_b.xyz = end4.xyz / end4.w;\nw = modelViewMatrix * vec4(\ncenter + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0\n);\ngl_Position = projectionMatrix * w;\ngl_Position.z = 0.99;\n}"),ac.add("shader/CylinderImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying vec3 axis;\nvarying vec4 base_radius;\nvarying vec4 end_b;\nvarying vec3 U;\nvarying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat distSq3( vec3 v3a, vec3 v3b ){\nreturn (\n( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +\n( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +\n( v3a.z - v3b.z ) * ( v3a.z - v3b.z )\n);\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nvoid main(){\nvec3 ray_target = w.xyz / w.w;\nvec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;\nvec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);\nvec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);\nmat3 basis = mat3( U, V, axis );\nvec3 diff = ray_target - 0.5 * (base + end);\nvec3 P = diff * basis;\nfloat dz = dot( axis, ray_direction );\nfloat radius2 = vRadius*vRadius;\nvec3 D = vec3(dot(U, ray_direction),\ndot(V, ray_direction),\ndz);\nfloat a0 = P.x*P.x + P.y*P.y - radius2;\nfloat a1 = P.x*D.x + P.y*D.y;\nfloat a2 = D.x*D.x + D.y*D.y;\nfloat d = a1*a1 - a0*a2;\nif (d < 0.0) {\ndiscard;\n}\nfloat dist = (-a1 + sqrt(d)) / a2;\nvec3 surface_point = ray_target + dist * ray_direction;\nvec3 base_to_surface = surface_point - base;\nvec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );\nfloat base_cap_test = dot( base_to_surface, axis );\nfloat end_cap_test = dot((surface_point - end), axis);\n#ifndef CAP\nvec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\nvec3 tmp_point2 = new_point2 - base;\n#endif\nif (base_cap_test < 0.0) {\nfloat dNV;\nfloat near;\nvec3 front_point;\nif ( ortho == 1.0 ) {\nfront_point = ray_target;\n} else {\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nfront_point = ray_direction * near + ray_origin;\n}\nif (dot(front_point - base, front_point-base) > radius2) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = front_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(axis, end) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - end, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\nif( end_cap_test > 0.0 )\n{\nfloat dNV;\nfloat near;\nvec3 end_point;\nif ( ortho == 1.0 ) {\nend_point = ray_target;\n} else {\ndNV = dot(axis, ray_direction);\nif (dNV < 0.0) {\ndiscard;\n}\nnear = dot(axis, end) / dNV;\nend_point = ray_direction * near + ray_origin;\n}\nif( dot(end_point - end, end_point-base) > radius2 ) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = end_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - base, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\ngl_FragDepthEXT = calcDepth( surface_point );\n#ifdef NEAR_CLIP\nif( calcClip( surface_point ) > 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\nif( calcClip( surface_point ) > 0.0 ) {\ndiscard;\n}\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#endif\nif (gl_FragDepthEXT < 0.0) {\ndiscard;\n}\nif (gl_FragDepthEXT > 1.0) {\ndiscard;\n}\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -surface_point;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){\nif( b < 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}else{\nif( b > 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 nonPerturbedNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const Z_=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),Q_=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class J_ extends Ym{constructor(t,e={}){super("v3",t,e)}get mapping(){return Z_}get mappingIndices(){return Q_}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const tv=Object.assign({openEnded:!1},Zp),ev=Object.assign({openEnded:{updateShader:!0}},Qp);class nv extends J_{constructor(t,e={}){super(t,e),this.parameterTypes=ev,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new ze},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(t),this.makeMapping()}get defaultParameters(){return tv}getDefines(t){const e=J_.prototype.getDefines.call(this,t);return this.parameters.openEnded||(e.CAP=1),e}}Object.assign({disableImpostor:!1},X_,tv);const iv=class{constructor(t,e={}){return!t.color2&&t.color&&(t.color2=t.color),!ql||e&&e.disableImpostor?new K_(t,e):new nv(t,e)}};uc.add("cylinder",iv);class rv extends E_{constructor(t,e,n){super(t,e,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(t){const e=t||{};e.radiusSize=Aa(e.radiusSize,.5),e.colorValue=Aa(e.colorValue,"lightgreen"),e.useInteriorColor=Aa(e.useInteriorColor,!0),this.showAxes=Aa(e.showAxes,!0),this.showBox=Aa(e.showBox,!1),super.init(e)}getPrincipalAxes(){let t;const e=this.getAssembly();return e&&(t=e.partList[0].getSelection()),this.structureView.getPrincipalAxes(t)}getAxesData(t){const e=this.getPrincipalAxes(),n=new Pn(this.colorValue);let i=0,r=0;this.showAxes&&(i+=6,r+=3),this.showBox&&(i+=8,r+=12);const s=new Float32Array(3*i),o=jc(i,n.r,n.g,n.b),a=$c(i,this.radiusSize),l=new Float32Array(3*r),c=new Float32Array(3*r),u=jc(r,n.r,n.g,n.b),h=$c(r,this.radiusSize);let d=0;if(this.showAxes){const t=function(t,e){t.toArray(s,2*d),e.toArray(s,2*d+3),t.toArray(l,d),e.toArray(c,d),d+=3};t(e.begA,e.endA),t(e.begB,e.endB),t(e.begC,e.endC)}if(this.showBox){const n=new ue,{d1a:i,d2a:r,d3a:o,d1b:a,d2b:u,d3b:h}=e.getProjectedScaleForAtoms(t);let p=2*d;const f=function(t,i,r){n.copy(e.center).addScaledVector(e.normVecA,t).addScaledVector(e.normVecB,i).addScaledVector(e.normVecC,r),n.toArray(s,p),p+=3};f(i,r,o),f(i,r,h),f(i,u,h),f(i,u,o),f(a,u,h),f(a,u,o),f(a,r,o),f(a,r,h);let m=d;const g=function(t,e){n.fromArray(s,2*d+3*t).toArray(l,m),n.fromArray(s,2*d+3*e).toArray(c,m),m+=3};g(0,1),g(0,3),g(0,6),g(1,2),g(1,7),g(2,3),g(2,4),g(3,5),g(4,5),g(4,7),g(5,6),g(6,7)}const p=new up(e);return{vertex:{position:s,color:o,radius:a,picking:p},edge:{position1:l,position2:c,color:u,color2:u,radius:h,picking:p}}}create(){const t=this.getAxesData(this.structureView);this.sphereBuffer=new tg(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new iv(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(t){}updateData(t,e){const n=this.getAxesData(e.sview),i={},r={};t&&!t.position||(Object.assign(i,{position:n.vertex.position}),Object.assign(r,{position1:n.edge.position1,position2:n.edge.position2})),t&&!t.color||(Object.assign(i,{color:n.vertex.color}),Object.assign(r,{color:n.edge.color,color2:n.edge.color})),t&&!t.radius||(Object.assign(i,{radius:n.vertex.radius}),Object.assign(r,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(i),this.cylinderBuffer.setAttributes(r)}}sc.add("axes",rv);class sv extends E_{constructor(t,e,n){super(t,e,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(t){var e=t||{};e.radiusType=Aa(e.radiusType,"size"),e.radiusSize=Aa(e.radiusSize,.15),e.useInteriorColor=Aa(e.useInteriorColor,!0),this.aspectRatio=Aa(e.aspectRatio,2),this.lineOnly=Aa(e.lineOnly,!1),this.cylinderOnly=Aa(e.cylinderOnly,!1),this.multipleBond=Aa(e.multipleBond,"off"),this.bondSpacing=Aa(e.bondSpacing,1),this.bondScale=Aa(e.bondScale,.4),this.linewidth=Aa(e.linewidth,2),super.init(e)}getAtomRadius(t){return this.aspectRatio*super.getAtomRadius(t)}getAtomParams(t,e){var n=super.getAtomParams(t,e);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(t,e,n){return t.getAtomData(this.getAtomParams(e,n))}getBondParams(t,e){return e=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},e),super.getBondParams(t,e)}getBondData(t,e,n){return t.getBondData(this.getBondParams(e,n))}createData(t){const e=[];if(this.lineOnly)this.lineBuffer=new H_(this.getBondData(t,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),e.push(this.lineBuffer);else{const n=new iv(this.getBondData(t),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(e.push(n),!this.cylinderOnly){const n=new tg(this.getAtomData(t),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));e.push(n)}}return{bufferList:e}}updateData(t,e){"off"!==this.multipleBond&&t&&t.radius&&(t.position=!0);const n=this.getBondData(e.sview,t);if(this.lineOnly){const i={};t&&!t.position||Object.assign(i,{position1:n.position1,position2:n.position2}),t&&!t.color||Object.assign(i,{color:n.color,color2:n.color2}),e.bufferList[0].setAttributes(i)}else{var i={};if(t&&!t.position||Object.assign(i,{position1:n.position1,position2:n.position2}),t&&!t.color||Object.assign(i,{color:n.color,color2:n.color2}),t&&!t.radius||Object.assign(i,{radius:n.radius}),e.bufferList[0].setAttributes(i),!this.cylinderOnly){var r=this.getAtomData(e.sview,t),s={};t&&!t.position||Object.assign(s,{position:r.position}),t&&!t.color||Object.assign(s,{color:r.color}),t&&!t.radius||Object.assign(s,{radius:r.radius}),e.bufferList[1].setAttributes(s)}}}setParameters(t={}){let e=!1;const n={};return(t.aspectRatio||t.bondSpacing||t.bondScale)&&(Object.assign(n,{radius:!0}),ql&&!this.disableImpostor||(e=!0)),super.setParameters(t,n,e),this}}sc.add("ball+stick",sv);class ov extends sv{constructor(t,e,n){super(t,e,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(t){var e=t||{};e.aspectRatio=Aa(e.aspectRatio,1),e.radiusSize=Aa(e.radiusSize,.25),super.init(e)}getAtomRadius(t){return t.isTrace()?super.getAtomRadius(t):0}getAtomData(t,e,n){return t.getBackboneAtomData(this.getAtomParams(e,n))}getBondData(t,e,n){return t.getBackboneBondData(this.getBondParams(e,n))}}sc.add("backbone",ov);class av extends sv{constructor(t,e,n){super(t,e,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(t){let e=t||{};e.aspectRatio=Aa(e.aspectRatio,1),e.radiusSize=Aa(e.radiusSize,.3),super.init(e)}getAtomData(t,e,n){return t.getRungAtomData(this.getAtomParams(e,n))}getBondData(t,e,n){let i=this.getBondParams(e,n);return Object.assign(i.colorParams,{rung:!0}),t.getRungBondData(i)}}sc.add("base",av);class lv{constructor(t,e){this.m=t,this.tension=e,this.dt=1/this.m,this.delta=1e-4,this.vec1=new ue,this.vec2=new ue,this.vDir=new ue,this.vTan=new ue,this.vNorm=new ue,this.vBin=new ue,this.m2=Math.ceil(this.m/2)}interpolateToArr(t,e,n,i,r,s,o){s[o+0]=Ja(t.x,e.x,n.x,i.x,r,this.tension),s[o+1]=Ja(t.y,e.y,n.y,i.y,r,this.tension),s[o+2]=Ja(t.z,e.z,n.z,i.z,r,this.tension)}interpolateToVec(t,e,n,i,r,s){s.x=Ja(t.x,e.x,n.x,i.x,r,this.tension),s.y=Ja(t.y,e.y,n.y,i.y,r,this.tension),s.z=Ja(t.z,e.z,n.z,i.z,r,this.tension)}interpolatePosition(t,e,n,i,r,s){for(var o=0;o<this.m;++o){var a=s+3*o,l=this.dt*o;this.interpolateToArr(t,e,n,i,l,r,a)}}interpolateTangent(t,e,n,i,r,s){for(var o=0;o<this.m;++o){var a=this.dt*o,l=a-this.delta,c=a+this.delta,u=s+3*o;l<0&&(l=0),c>1&&(c=1),this.interpolateToVec(t,e,n,i,l,this.vec1),this.interpolateToVec(t,e,n,i,c,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(r,u)}}vectorSubdivide(t,e,n,i,r){let s,o=e.next(),a=e.next(),l=e.next();const c=e.size,u=c-1;let h=i||0;for(let i=0;i<u;++i)s=o,o=a,a=l,l=e.next(),t.apply(this,[s,o,a,l,n,h]),h+=3*this.m;r&&(s=e.get(c-2),o=e.get(c-1),a=e.get(0),l=e.get(1),t.apply(this,[s,o,a,l,n,h]),h+=3*this.m)}getPosition(t,e,n,i){t.reset(),this.vectorSubdivide(this.interpolatePosition,t,e,n,i);var r=t.size-1,s=r*this.m*3;i&&(s+=3*this.m);var o=t.get(i?0:r);e[s]=o.x,e[s+1]=o.y,e[s+2]=o.z}getTangent(t,e,n,i){t.reset(),this.vectorSubdivide(this.interpolateTangent,t,e,n,i);let r=(t.size-1)*this.m*3;i&&(r+=3*this.m),Yc(e,e,r-3,r,3)}interpolateNormalDir(t,e,n,i,r,s,o,a,l,c,u,h,d){for(let p=0;p<this.m;++p){let f=h+3*p;d&&(f+=3*this.m2);const m=this.dt*p;this.interpolateToVec(t,e,n,i,m,this.vec1),this.interpolateToVec(r,s,o,a,m,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(l,f),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(u,f),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(c,f)}}interpolateNormal(t,e,n,i,r){for(var s=0;s<this.m;++s){var o=r+3*s;t.copy(this.vNorm),this.vTan.fromArray(e,o),this.vBin.crossVectors(t,this.vTan).normalize(),this.vBin.toArray(i,o),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,o)}}getNormal(t,e,n,i,r,s){this.vNorm.set(0,0,1);const o=t-1;let a=r||0;for(var l=0;l<o;++l)this.interpolateNormal(this.vDir,e,n,i,a),a+=3*this.m;s&&(this.interpolateNormal(this.vDir,e,n,i,a),a+=3*this.m),this.vBin.toArray(i,a),this.vNorm.toArray(n,a)}getNormalDir(t,e,n,i,r,s,o,a){t.reset(),e.reset();const l=new ue,c=new ue,u=new ue,h=new ue,d=new ue,p=(new ue).copy(t.next()),f=(new ue).copy(t.next()),m=(new ue).copy(t.next()),g=new ue,_=(new ue).copy(e.next()),v=(new ue).copy(e.next()),y=(new ue).copy(e.next());this.vNorm.set(0,0,1);let b=t.size,x=b-1,w=s||0;for(var S=0;S<x;++S)d.copy(p),p.copy(f),f.copy(m),m.copy(t.next()),g.copy(_),_.copy(v),v.copy(y),y.copy(e.next()),0===S?(l.subVectors(g,d),c.subVectors(_,p),l.dot(c)<0&&(c.multiplyScalar(-1),_.addVectors(p,c)),u.subVectors(v,f),c.dot(u)<0&&(u.multiplyScalar(-1),v.addVectors(f,u))):u.copy(h),h.subVectors(y,m),u.dot(h)<0&&(h.multiplyScalar(-1),y.addVectors(m,h)),this.interpolateNormalDir(d,p,f,m,g,_,v,y,n,i,r,w,a),w+=3*this.m;if(o&&(d.copy(t.get(b-2)),p.copy(t.get(b-1)),f.copy(t.get(0)),m.copy(t.get(1)),g.copy(e.get(b-2)),_.copy(e.get(b-1)),v.copy(e.get(0)),y.copy(e.get(1)),u.copy(h),h.subVectors(y,m),u.dot(h)<0&&(h.multiplyScalar(-1),y.addVectors(m,h)),this.interpolateNormalDir(d,p,f,m,g,_,v,y,n,i,r,w,a),w+=3*this.m),a){this.vBin.fromArray(r,3*this.m2),this.vNorm.fromArray(i,3*this.m2);for(var A=0;A<this.m2;++A)this.vBin.toArray(r,3*A),this.vNorm.toArray(i,3*A)}else this.vBin.toArray(r,w),this.vNorm.toArray(i,w)}interpolateColor(t,e,n,i,r){var s,o;for(s=0;s<this.m2;++s)o=r+3*s,n.apply(this,[t,i,o]);for(s=this.m2;s<this.m;++s)o=r+3*s,n.apply(this,[e,i,o])}getColor(t,e,n,i,r){let s;t.reset(),t.next();let o=t.next();for(var a=t.size,l=a-1,c=i||0,u=0;u<l;++u)s=o,o=t.next(),this.interpolateColor(s,o,e,n,c),c+=3*this.m;r&&(s=t.get(a-1),o=t.get(0),this.interpolateColor(s,o,e,n,c),c+=3*this.m),n[c]=n[c-3],n[c+1]=n[c-2],n[c+2]=n[c-1]}interpolatePicking(t,e,n,i,r){var s;for(s=0;s<this.m2;++s)i[r+s]=n.apply(this,[t]);for(s=this.m2;s<this.m;++s)i[r+s]=n.apply(this,[e])}getPicking(t,e,n,i,r){let s;t.reset(),t.next();let o=t.next();const a=t.size,l=a-1;let c=i||0;for(var u=0;u<l;++u)s=o,o=t.next(),this.interpolatePicking(s,o,e,n,c),c+=this.m;r&&(s=t.get(a-1),o=t.get(0),this.interpolatePicking(s,o,e,n,c),c+=this.m),n[c]=n[c-1]}interpolateSize(t,e,n,i,r){const s=n.apply(this,[t]),o=n.apply(this,[e]);for(let t=0;t<this.m;++t){let e=t/this.m;i[r+t]=(1-e)*s+e*o}}getSize(t,e,n,i,r){let s;t.reset(),t.next();let o=t.next();const a=t.size,l=a-1;let c=i||0;for(var u=0;u<l;++u)s=o,o=t.next(),this.interpolateSize(s,o,e,n,c),c+=this.m;r&&(s=t.get(a-1),o=t.get(0),this.interpolateSize(s,o,e,n,c),c+=this.m),n[c]=n[c-1]}}class cv{constructor(t,e){this.polymer=t,this.size=t.residueCount;var n=e||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new lv(this.subdiv,this.tension)}getAtomIterator(t,e){const n=this.polymer,i=n.structure,r=n.residueCount;let s=0,o=-1;const a=[i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy()],l=[new ue,new ue,new ue,new ue];var c=i.getAtomProxy(),u=i.getAtomProxy();function h(i){var o=a[s%4];if(o.index=n.getAtomIndexByType(i,t),e&&i>0&&i<r&&"e"===o.sstruc){var h=l[s%4];return c.index=n.getAtomIndexByType(i+1,t),u.index=n.getAtomIndexByType(i-1,t),h.addVectors(c,u).add(o).add(o).multiplyScalar(.25),s+=1,h}return s+=1,o}return{size:r,next:function(){var t=h(o);return o+=1,t},get:h,reset:function(){s=0,o=-1}}}getSubdividedColor(t){var e=this.subdiv,n=this.polymer,i=(n.residueCount-1)*e*3+3;n.isCyclic&&(i+=3*e);var r=new Float32Array(i),s=this.getAtomIterator("trace"),o=t||{};o.structure=n.structure;var a=ic.getScheme(o);return this.interpolator.getColor(s,(function(t,e,n){a.atomColorToArray(t,e,n)}),r,0,n.isCyclic),{color:r}}getSubdividedPicking(){var t=this.subdiv,e=this.polymer,n=(e.residueCount-1)*t+1;e.isCyclic&&(n+=t);var i=e.structure,r=this.getAtomIterator("trace"),s=new Float32Array(n);return this.interpolator.getPicking(r,(function(t){return t.index}),s,0,e.isCyclic),{picking:new cp(s,i)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const t=this.getTangent(),e=this.getNormals(t);return{tangent:t,normal:e.normal,binormal:e.binormal}}getSubdividedSize(t){var e=this.subdiv,n=this.polymer,i=(n.residueCount-1)*e+1;n.isCyclic&&(i+=e);var r=new Float32Array(i),s=this.getAtomIterator("trace"),o=new Cf(t);return this.interpolator.getSize(s,(function(t){return o.atomRadius(t)}),r,0,n.isCyclic),{size:r}}getPosition(){const t=this.subdiv,e=this.polymer;let n=(e.residueCount-1)*t*3+3;e.isCyclic&&(n+=3*t);const i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(r,i,0,e.isCyclic),i}getTangent(){const t=this.subdiv,e=this.polymer;let n=(this.size-1)*t*3+3;e.isCyclic&&(n+=3*t);const i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(r,i,0,e.isCyclic),i}getNormals(t){const e=this.subdiv,n=this.polymer,i=n.isProtein(),r=this.size;let s=(r-1)*e*3+3;n.isCyclic&&(s+=3*e);const o=new Float32Array(s),a=new Float32Array(s);if(this.directional&&!this.polymer.isCg()){const e=this.getAtomIterator("direction1"),r=this.getAtomIterator("direction2");this.interpolator.getNormalDir(e,r,t,o,a,0,n.isCyclic,i)}else this.interpolator.getNormal(r,t,o,a,0,n.isCyclic);return{normal:o,binormal:a}}}const uv=new ue,hv=new ue,dv=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},Zp);class pv extends tf{constructor(t,e={}){super(function(t,e={}){const n=Aa(e.radialSegments,4),i=Aa(e.capped,!1),r=i?n:0,s=i?n-2:0,o=t.position.length/3,a=o*n*3+2*r*3,l=2*(o-1)*n*3+2*s*3;return{position:new Float32Array(a),color:new Float32Array(a),index:Ba(l,a/3),normal:new Float32Array(a),picking:t.picking}}(t,e),e),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=t.position.length/3,t.primitiveId=Wc(this.size2),this.setAttributes(t),this.makeIndex()}get defaultParameters(){return dv}setAttributes(t={}){const e=this.parameters.aspectRatio,n=this.size2,i=n-1,r=this.parameters.radialSegments,s=this.geometry.attributes;let o,a,l,c,u,h,d,p,f,m,g,_,v;t.position&&(o=t.position,a=t.normal,l=t.binormal,c=t.tangent,h=t.size,p=s.position.array,m=s.normal.array,s.position.needsUpdate=!0,s.normal.needsUpdate=!0),t.color&&(u=t.color,f=s.color.array,s.color.needsUpdate=!0),t.primitiveId&&(d=t.primitiveId,g=s.primitiveId.array,s.primitiveId.needsUpdate=!0);let y=0,b=0,x=0,w=0,S=0,A=0,M=0,C=0,E=0,T=0;const P=[],I=[],R=[],k=[],D=[],L=[];if(o)for(let t=0;t<r;++t){const n=t/r*2*Math.PI;P[t]=e*Math.cos(n),I[t]=Math.sin(n),R[t]=e*Math.cos(n-.01),k[t]=Math.sin(n-.01),D[t]=e*Math.cos(n+.01),L[t]=Math.sin(n+.01)}for(let t=0;t<n;++t){_=3*t,v=_*r,o&&c&&a&&l&&h&&(uv.set(c[_],c[_+1],c[_+2]),b=a[_],x=a[_+1],w=a[_+2],S=l[_],A=l[_+1],M=l[_+2],C=o[_],E=o[_+1],T=o[_+2],y=h[t]);for(let e=0;e<r;++e){const n=v+3*e;if(o){const t=-y*P[e],i=y*I[e],r=-y*R[e],s=y*k[e],o=-y*D[e],a=y*L[e];p[n]=C+t*b+i*S,p[n+1]=E+t*x+i*A,p[n+2]=T+t*w+i*M,hv.set(o*b+a*S-(r*b+s*S),o*x+a*A-(r*x+s*A),o*w+a*M-(r*w+s*M)).cross(uv),m[n]=hv.x,m[n+1]=hv.y,m[n+2]=hv.z}u&&(f[n]=u[_],f[n+1]=u[_+1],f[n+2]=u[_+2]),d&&(g[t*r+e]=d[t])}}_=0,v=3*n*r;for(let t=0;t<r;++t){const e=_+3*t,i=v+3*t;o&&c&&(p[i]=p[e],p[i+1]=p[e+1],p[i+2]=p[e+2],m[i]=c[_],m[i+1]=c[_+1],m[i+2]=c[_+2]),u&&(f[i]=f[e],f[i+1]=f[e+1],f[i+2]=f[e+2]),d&&(g[n*r+t]=g[0+t])}_=3*(n-1)*r,v=3*(n+1)*r;for(let t=0;t<r;++t){const e=_+3*t,s=v+3*t;o&&c&&(p[s]=p[e],p[s+1]=p[e+1],p[s+2]=p[e+2],m[s]=c[3*i],m[s+1]=c[3*i+1],m[s+2]=c[3*i+2]),u&&(f[s]=f[e],f[s+1]=f[e+1],f[s+2]=f[e+2]),d&&(g[(n+1)*r+t]=g[(n-1)*r+t])}}makeIndex(){const t=this.geometry.getIndex();if(!t)return void Yl.error("Index is null");const e=t.array,n=this.size2,i=n-1,r=this.capTriangles,s=this.parameters.radialSegments,o=this.parameters.radialSegments+1;let a,l;for(let t=0;t<i;++t){const n=t*s*3*2,i=t*s,r=(t+1)*s;for(let t=0;t<s;++t)l=n+3*t*2,e[l]=i+t,e[l+1]=i+(t+1)%s,e[l+2]=r+t,e[l+3]=r+t,e[l+4]=i+(t+1)%s,e[l+5]=r+(t+1)%s}const c=[0];for(let t=1;t<o/2;++t)c.push(t),s-t!==t&&c.push(s-t);l=i*s*3*2,a=n*s;for(let t=0;t<c.length-2;++t)t%2==0?(e[l+3*t+0]=a+c[t+0],e[l+3*t+1]=a+c[t+1],e[l+3*t+2]=a+c[t+2]):(e[l+3*t+0]=a+c[t+2],e[l+3*t+1]=a+c[t+1],e[l+3*t+2]=a+c[t+0]);l=i*s*3*2+3*r,a=n*s+s;for(let t=0;t<c.length-2;++t)t%2==0?(e[l+3*t+0]=a+c[t+0],e[l+3*t+1]=a+c[t+1],e[l+3*t+2]=a+c[t+2]):(e[l+3*t+0]=a+c[t+2],e[l+3*t+1]=a+c[t+1],e[l+3*t+2]=a+c[t+0])}}class fv extends E_{constructor(t,e,n){super(t,e,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(t){var e=t||{};e.colorScheme=Aa(e.colorScheme,"chainname"),e.colorScale=Aa(e.colorScale,"RdYlBu"),e.radiusType=Aa(e.radiusType,"sstruc"),e.radiusScale=Aa(e.radiusScale,.7),e.useInteriorColor=Aa(e.useInteriorColor,!0),this.aspectRatio=Aa(e.aspectRatio,5),this.tension=Aa(e.tension,NaN),this.capped=Aa(e.capped,!0),this.smoothSheet=Aa(e.smoothSheet,!1),"low"===e.quality?(this.subdiv=3,this.radialSegments=6):"medium"===e.quality?this.subdiv=6:"high"===e.quality?this.subdiv=12:this.subdiv=Aa(e.subdiv,6),super.init(e)}getSplineParams(t){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:1!==this.aspectRatio,smoothSheet:this.smoothSheet},t)}getSpline(t){return new cv(t,this.getSplineParams())}getAspectRatio(t){return t.isCg()?1:this.aspectRatio}getAtomRadius(t){return t.isTrace()?super.getAtomRadius(t):0}createData(t){let e=[],n=[];return this.structure.eachPolymer((t=>{if(t.residueCount<4)return;n.push(t);const i=this.getSpline(t),r=this.getAspectRatio(t),s=i.getSubdividedPosition(),o=i.getSubdividedOrientation(),a=i.getSubdividedColor(this.getColorParams()),l=i.getSubdividedPicking(),c=i.getSubdividedSize(this.getRadiusParams());e.push(new pv(Object.assign({},s,o,a,l,c),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:r,capped:this.capped})))}),t.getSelection()),{bufferList:e,polymerList:n}}updateData(t,e){Ql&&Yl.time(this.type+" repr update"),t=t||{};for(var n=0,i=e.polymerList.length;n<i;++n){var r={},s=e.polymerList[n],o=this.getSpline(s),a=this.getAspectRatio(s);if(Object.assign(e.bufferList[n],{aspectRatio:a}),t.position||t.radius){var l=o.getSubdividedPosition(),c=o.getSubdividedOrientation(),u=o.getSubdividedSize(this.getRadiusParams(a));r.position=l.position,r.normal=c.normal,r.binormal=c.binormal,r.tangent=c.tangent,r.size=u.size}if(t.color){var h=o.getSubdividedColor(this.getColorParams());r.color=h.color}if(t.picking){var d=o.getSubdividedPicking();r.picking=d.picking}e.bufferList[n].setAttributes(r)}Ql&&Yl.timeEnd(this.type+" repr update")}setParameters(t){var e={};return t&&t.aspectRatio&&(e.radius=!0),t&&t.tension&&(e.position=!0),super.setParameters(t,e,!1),this}}sc.add("cartoon",fv);class mv extends E_{constructor(t,e,n){super(t,e,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(t){var e=t||{};e.radiusSize=Aa(e.radiusSize,.05),e.useInteriorColor=Aa(e.useInteriorColor,!0),this.hydrogenBond=Aa(e.hydrogenBond,!0),this.weakHydrogenBond=Aa(e.weakHydrogenBond,!1),this.waterHydrogenBond=Aa(e.waterHydrogenBond,!1),this.backboneHydrogenBond=Aa(e.backboneHydrogenBond,!1),this.hydrophobic=Aa(e.hydrophobic,!1),this.halogenBond=Aa(e.halogenBond,!0),this.ionicInteraction=Aa(e.ionicInteraction,!0),this.metalCoordination=Aa(e.metalCoordination,!0),this.cationPi=Aa(e.cationPi,!0),this.piStacking=Aa(e.piStacking,!0),this.filterSele=Aa(e.filterSele,""),this.labelVisible=Aa(e.labelVisible,!1),this.labelFixedSize=Aa(e.labelFixedSize,!1),this.labelSize=Aa(e.labelSize,2),this.labelUnit=Aa(e.labelUnit,""),this.maxHydrophobicDist=Aa(e.maxHydrophobicDist,4),this.maxHbondDist=Aa(e.maxHbondDist,3.5),this.maxHbondSulfurDist=Aa(e.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=Aa(e.maxHbondAccAngle,45),this.maxHbondDonAngle=Aa(e.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=Aa(e.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=Aa(e.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=Aa(e.maxPiStackingDist,5.5),this.maxPiStackingOffset=Aa(e.maxPiStackingOffset,2),this.maxPiStackingAngle=Aa(e.maxPiStackingAngle,30),this.maxCationPiDist=Aa(e.maxCationPiDist,6),this.maxCationPiOffset=Aa(e.maxCationPiOffset,2),this.maxIonicDist=Aa(e.maxIonicDist,5),this.maxHalogenBondDist=Aa(e.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=Aa(e.maxHalogenBondAngle,30),this.maxMetalDist=Aa(e.maxMetalDist,3),this.refineSaltBridges=Aa(e.refineSaltBridges,!0),this.masterModelIndex=Aa(e.masterModelIndex,-1),this.lineOfSightDistFactor=Aa(e.lineOfSightDistFactor,1),super.init(e)}getAtomRadius(){return 0}getContactData(t){const e={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return function(t,e,n){const i=Ma(n,sp),r=[];i.hydrogenBond&&r.push(4),i.hydrophobic&&r.push(6),i.halogenBond&&r.push(5),i.ionicInteraction&&r.push(1),i.metalCoordination&&r.push(7),i.cationPi&&r.push(2),i.piStacking&&r.push(3),i.weakHydrogenBond&&r.push(8),i.waterHydrogenBond&&r.push(9),i.backboneHydrogenBond&&r.push(10);const{features:s,contactSet:o,contactStore:a}=t,{centers:l,atomSets:c}=s,{x:u,y:h,z:d}=l,{index1:p,index2:f,type:m}=a,g=[],_=[],v=[],y=[],b=[];let x;return i.filterSele&&(x=Array.isArray(i.filterSele)?i.filterSele.map((t=>e.getAtomSet(new Ll(t)))):e.getAtomSet(new Ll(i.filterSele))),o.forEach((t=>{const e=m[t];if(!r.includes(e))return;if(x){const e=c[p[t]][0],n=c[f[t]][0];if(Array.isArray(x)){if(!(x[0].isSet(e)&&x[1].isSet(n)||x[1].isSet(e)&&x[0].isSet(n)))return}else if(!x.isSet(e)&&!x.isSet(n))return}const n=p[t],s=f[t];g.push(u[n],h[n],d[n]),_.push(u[s],h[s],d[s]),v.push(...function(t){switch(t){case 4:case 9:case 10:return op.setHex(2851770).toArray();case 6:return op.setHex(8421504).toArray();case 5:return op.setHex(4259775).toArray();case 1:return op.setHex(15779860).toArray();case 7:return op.setHex(9191577).toArray();case 2:return op.setHex(16744448).toArray();case 3:return op.setHex(9220966).toArray();case 8:return op.setHex(12967404).toArray();default:return op.setHex(13421772).toArray()}}(e)),y.push(i.radius),b.push(t)})),{position1:new Float32Array(g),position2:new Float32Array(_),color:new Float32Array(v),color2:new Float32Array(v),radius:new Float32Array(y),picking:new dp(b,t,e)}}(function(t,e=ep){const n=function(t){const{types:e,centers:n}=t;return{features:t,spatialHash:new Yh(n),contactStore:new Zh,featureSet:new Jh(e.length,!1)}}(function(t){const e={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return Ql&&Yl.time("calculateFeatures"),function(t,e){const{charge:n}=Fd(t.data),i={};t.eachResidue((t=>{if(Ud.includes(t.resname)){const n=ed(1);t.eachAtom((t=>{7===t.number&&t.isSidechain()&&nd(n,t)})),id(e,n)}else xd.includes(t.resname)||t.isNucleic()||(t.eachAtom((t=>{let n=!1;const r=ed(1);!function(t){let e=0;return 6===t.number&&3===t.bondCount&&3===t.bondToElementCount(7)&&t.eachBondedAtom((t=>{t.bondCount-t.bondToElementCount(1)==1&&++e})),2===e}(t)?function(t){let e=0;return 6===t.number&&3===t.bondCount&&2===t.bondToElementCount(7)&&1===t.bondToElementCount(6)&&t.eachBondedAtom((t=>{t.bondCount-t.bondToElementCount(1)==1&&++e})),2===e}(t)&&(r.group=9,n=!0):(r.group=8,n=!0),n&&(t.eachBondedAtom((t=>{7===t.number&&(i[t.index]=!0,nd(r,t))})),id(e,r))})),t.eachAtom((t=>{const r=ed(1);n[t.index]>0&&(i[t.index]||(nd(r,t),id(e,r)))})))}))}(t,e),function(t,e){const{charge:n}=Fd(t.data),i={};t.eachResidue((t=>{if(zd.includes(t.resname)){const n=ed(2);t.eachAtom((t=>{8===t.number&&t.isSidechain()&&nd(n,t)})),id(e,n)}else if(Md.includes(t.resname)){const n=ed(2);t.eachAtom((t=>{Bd(t)&&(n.group=6,t.eachBondedAtom((t=>{8===t.number&&nd(n,t)})),id(e,n))}))}else xd.includes(t.resname)||Md.includes(t.resname)||(t.eachAtom((t=>{let n=!1;const r=ed(2);!function(t){return 16===t.number&&3===t.bondToElementCount(8)}(t)?Bd(t)?(r.group=6,n=!0):function(t){return 16===t.number&&4===t.bondToElementCount(8)}(t)?(r.group=5,n=!0):function(t){let e=0;return 6===t.number&&2===t.bondToElementCount(8)&&1===t.bondToElementCount(6)&&t.eachBondedAtom((t=>{8===t.number&&t.bondCount-t.bondToElementCount(1)==1&&++e})),2===e}(t)&&(r.group=10,n=!0):(r.group=4,n=!0),n&&(t.eachBondedAtom((t=>{8===t.number&&(i[t.index]=!0,nd(r,t))})),id(e,r))})),t.eachAtom((t=>{const r=ed(2);n[t.index]<0&&(i[t.index]||(nd(r,t),id(e,r)))})))}))}(t,e),function(t,e){const n=t.getAtomProxy();t.eachResidue((t=>{const i=t.getAromaticRings();if(i){const r=t.atomOffset;i.forEach((t=>{const i=ed(3);t.forEach((t=>{n.index=t+r,nd(i,n)})),id(e,i)}))}}))}(t,e),function(t,e){const{charge:n,implicitH:i,idealGeometry:r}=Fd(t.data);t.eachAtom((t=>{const s=ed(5),o=t.number;if(8===o)nd(s,t),id(e,s);else if(7===o){if($d(t))nd(s,t),id(e,s);else if(n[t.index]<1){const n=t.bondCount+i[t.index],o=r[t.index];(4===o&&n<4||3===o&&n<3||2===o&&n<2)&&(nd(s,t),id(e,s))}}else 16===o&&("CYS"!==t.resname&&"MET"!==t.resname&&-1!==t.formalCharge||(nd(s,t),id(e,s)))}))}(t,e),function(t,e){const{totalH:n}=Fd(t.data);t.eachAtom((t=>{const i=ed(4),r=t.number;($d(t)||n[t.index]>0&&(7===r||8===r||16===r))&&(nd(i,t),id(e,i))}))}(t,e),function(t,e){const{totalH:n}=Fd(t.data);t.eachAtom((t=>{if(6===t.number&&n[t.index]>0&&(t.bondToElementCount(7)>0||t.bondToElementCount(8)>0||function(t){if(!t.isAromatic())return!1;const e=t.residueType.getRings();if(!e)return!1;let n=!1;return e.rings.forEach((e=>{n||e.some((e=>t.index-t.residueAtomOffset===e))&&(n=e.some((e=>{const n=t.residueType.atomTypeIdList[e],i=t.atomMap.get(n).number;return 7===i||8===i})))})),n}(t))){const n=ed(9);nd(n,t),id(e,n)}}))}(t,e),function(t,e){t.eachAtom((t=>{let n=!1,i=!1;const r=xd.includes(t.resname),s=Md.includes(t.resname);if(r||s?r?8===t.number?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(t.resname)&&t.isSidechain()||t.isBackbone())&&(n=!0,i=!0):16===t.number&&"CYS"===t.resname?(n=!0,i=!0):7===t.number&&"HIS"===t.resname&&t.isSidechain()&&(n=!0):s&&(8===t.number&&t.isBackbone()?(n=!0,i=!0):["N3","N4","N7"].includes(t.atomname)?n=!0:["O2","O4","O6"].includes(t.atomname)&&(n=!0,i=!0)):t.isHalogen()||8===t.number||16===t.number?(n=!0,i=!0):7===t.number&&(n=!0),n){const n=ed(11);nd(n,t),id(e,n)}if(i){const n=ed(10);nd(n,t),id(e,n)}}))}(t,e),function(t,e){t.eachAtom((t=>{if(t.isTransitionMetal()||30===t.number||48===t.number){const n=ed(12);nd(n,t),id(e,n)}else if(qd.includes(t.number)){const n=ed(13);nd(n,t),id(e,n)}}))}(t,e),function(t,e){t.eachAtom((t=>{const n=ed(8);let i=!1;6===t.number?(i=!0,t.eachBondedAtom((t=>{const e=t.number;6!==e&&1!==e&&(i=!1)}))):9===t.number&&(i=!0),i&&(nd(n,t),id(e,n))}))}(t,e),function(t,e){t.eachAtom((t=>{if(Kd.includes(t.number)){let n=!1;if(t.eachBondedAtom((t=>{Zd.includes(t.number)&&(n=!0)})),n){const n=ed(7);nd(n,t),id(e,n)}}}))}(t,e),function(t,e){t.eachAtom((t=>{if(Yd.includes(t.number)&&1===t.bondToElementCount(6)){const n=ed(6);nd(n,t),id(e,n)}}))}(t,e),Ql&&Yl.timeEnd("calculateFeatures"),e}(t));Ql&&Yl.time("calculateContacts"),function(t,e,n={}){const i=Aa(n.maxIonicDist,ep.maxIonicDist),r=Aa(n.maxPiStackingDist,ep.maxPiStackingDist),s=Aa(n.maxPiStackingOffset,ep.maxPiStackingOffset),o=Aa(n.maxPiStackingAngle,ep.maxPiStackingAngle),a=Aa(n.maxCationPiDist,ep.maxCationPiDist),l=Aa(n.maxCationPiOffset,ep.maxCationPiOffset),c=Aa(n.masterModelIndex,ep.masterModelIndex),u=Math.max(i+2,r,a),h=r*r,d=a*a,{features:p,spatialHash:f,contactStore:m,featureSet:g}=e,{types:_,centers:v,atomSets:y}=p,{x:b,y:x,z:w}=v,S=_.length,A=t.atomStore.x,M=t.atomStore.y,C=t.atomStore.z,E=t.getAtomProxy(),T=t.getAtomProxy(),P=function(t,e,n){const i=t.length,r=e.length;for(let s=0;s<i;++s){E.index=t[s];for(let t=0;t<r;++t)if(T.index=e[t],E.distanceTo(T)<=n)return!0}return!1},I=new ue,R=new ue,k=new ue,D=new ue,L=new ue,O=new ue,N=new ue,F=function(t,e){I.set(A[t[0]],M[t[0]],C[t[0]]),R.set(A[t[1]],M[t[1]],C[t[1]]),k.set(A[t[2]],M[t[2]],C[t[2]]),D.subVectors(I,R),L.subVectors(I,k),e.crossVectors(D,L)},B=function(t,e,n){return I.set(b[t],x[t],w[t]),R.set(b[e],x[e],w[e]),I.sub(R).projectOnPlane(n).add(R).distanceTo(R)},U=function(t,e,n){g.setBits(t,e),m.addContact(t,e,n)};for(let t=0;t<S;++t)f.eachWithin(b[t],x[t],w[t],u,((e,n)=>{if(e<=t)return;if(E.index=y[t][0],T.index=y[e][0],ip(E,T,c))return;const r=_[t],a=_[e];if(Vd(r,a))P(y[t],y[e],i)&&U(t,e,1);else if(Hd(r,a)){if(n<=h){F(y[t],O),F(y[e],N);const n=57.29578*O.angleTo(N);Math.min(B(t,e,N),B(e,t,O))<=s&&(n<=o||n>=180-o||n<=o+90&&n>=90-o)&&U(t,e,3)}}else if(Gd(r,a)&&n<=d){const[n,i]=3===r?[t,e]:[e,t];F(y[n],O),B(i,n,O)<=l&&U(n,i,2)}}))}(t,n,e),function(t,e,n={}){const i=Aa(n.maxHbondDist,ep.maxHbondDist),r=Aa(n.maxHbondSulfurDist,ep.maxHbondSulfurDist),s=qa(Aa(n.maxHbondAccAngle,ep.maxHbondAccAngle)),o=qa(Aa(n.maxHbondDonAngle,ep.maxHbondDonAngle)),a=qa(Aa(n.maxHbondAccPlaneAngle,ep.maxHbondAccPlaneAngle)),l=qa(Aa(n.maxHbondDonPlaneAngle,ep.maxHbondDonPlaneAngle)),c=Aa(n.masterModelIndex,ep.masterModelIndex),u=Math.max(i,r),h=i*i,{features:d,spatialHash:p,contactStore:f,featureSet:m}=e,{types:g,centers:_,atomSets:v}=d,{x:y,y:b,z:x}=_,w=g.length,{idealGeometry:S}=Fd(t.data),A=t.getAtomProxy(),M=t.getAtomProxy();for(let t=0;t<w;++t)p.eachWithin(y[t],b[t],x[t],u,((e,n)=>{if(e<=t)return;const i=g[t],r=g[e],u=Wd(i,r);if(!u&&!jd(i,r))return;const[d,p]=5===r?[t,e]:[e,t];if(A.index=v[d][0],M.index=v[p][0],M.index===A.index)return;if(ip(A,M,c))return;if(16!==A.number&&16!==M.number&&n>h)return;if(A.connectedTo(M))return;const _=Od(A,M),y=Ld.get(S[A.index])||qa(120);if(_.some((t=>Math.abs(y-t)>o)))return;if(3===S[A.index]){const t=Nd(A,M);if(void 0!==t&&t>l)return}const b=Od(M,A),x=Ld.get(S[M.index])||qa(120);if(b.some((t=>x-t>s)))return;if(3===S[M.index]){const t=Nd(M,A);if(void 0!==t&&t>a)return}m.setBits(d,p);const w=u?8:function(t,e){return t.isWater()&&e.isWater()}(C=A,E=M)?9:function(t,e){return t.isBackbone()&&e.isBackbone()}(C,E)?10:4;var C,E;f.addContact(d,p,w)}))}(t,n,e),function(t,e,n={}){const i=Aa(n.maxMetalDist,ep.maxMetalDist),r=Aa(n.masterModelIndex,ep.masterModelIndex),{features:s,spatialHash:o,contactStore:a,featureSet:l}=e,{types:c,centers:u,atomSets:h}=s,{x:d,y:p,z:f}=u,m=c.length,g=t.getAtomProxy(),_=t.getAtomProxy();for(let t=0;t<m;++t)o.eachWithin(d[t],p[t],f[t],i,((e,n)=>{if(e<=t)return;if(g.index=h[t][0],_.index=h[e][0],ip(g,_,r))return;const i=g.isMetal(),s=_.isMetal();if(!i&&!s)return;const[o,u]=i?[c[t],c[e]]:[c[e],c[t]];Xd(o,u)&&(l.setBits(t,e),a.addContact(t,e,7))}))}(t,n,e),function(t,e,n={}){const i=Aa(n.maxHydrophobicDist,ep.maxHydrophobicDist),r=Aa(n.masterModelIndex,ep.masterModelIndex),{features:s,spatialHash:o,contactStore:a,featureSet:l}=e,{types:c,centers:u,atomSets:h}=s,{x:d,y:p,z:f}=u,m=c.length,g=t.getAtomProxy(),_=t.getAtomProxy();for(let t=0;t<m;++t)o.eachWithin(d[t],p[t],f[t],i,((e,n)=>{var i,s;e<=t||(g.index=h[t][0],_.index=h[e][0],ip(g,_,r)||9===g.number&&9===_.number||g.connectedTo(_)||(i=c[t],s=c[e],8===i&&8===s&&(l.setBits(t,e),a.addContact(t,e,6))))}))}(t,n,e),function(t,e,n={}){const i=Aa(n.maxHalogenBondDist,ep.maxHalogenBondDist),r=qa(Aa(n.maxHalogenBondAngle,ep.maxHalogenBondAngle)),s=Aa(n.masterModelIndex,ep.masterModelIndex),{features:o,spatialHash:a,contactStore:l,featureSet:c}=e,{types:u,centers:h,atomSets:d}=o,{x:p,y:f,z:m}=h,g=u.length,_=t.getAtomProxy(),v=t.getAtomProxy();for(let t=0;t<g;++t)a.eachWithin(p[t],f[t],m[t],i,((e,n)=>{if(e<=t)return;if(_.index=d[t][0],v.index=d[e][0],ip(_,v,s))return;if(i=u[t],o=u[e],!(7===i&&6===o||6===i&&7===o))return;var i,o;const[a,h]=6===u[t]?[_,v]:[v,_],p=Od(a,h);if(1!==p.length)return;if(Qd-p[0]>r)return;const f=Od(h,a);0!==f.length&&(f.some((t=>Jd-t>r))||(c.setBits(t,e),l.addContact(t,e,5)))}))}(t,n,e);const i=function(t){const{index1:e,index2:n,count:i}=t.contactStore,r=td({nodeArray1:e,nodeArray2:n,edgeCount:i,nodeCount:t.featureSet.length}),s=new Jh(t.contactStore.count,!0);return Object.assign({adjacencyList:r,contactSet:s},t)}(n);return function(t,e,n={}){Ql&&Yl.time("refineLineOfSight");const i=Aa(n.lineOfSightDistFactor,ep.lineOfSightDistFactor),r=Aa(n.masterModelIndex,ep.masterModelIndex),s=t.spatialHash,{contactSet:o,contactStore:a,features:l}=e,{index1:c,index2:u}=a,{centers:h,atomSets:d}=l,{x:p,y:f,z:m}=h,g=t.getAtomProxy(),_=t.getAtomProxy(),v=t.getAtomProxy(),y=new ue,b=new ue,x=3*i,w=i*i;o.forEach((t=>{y.set(p[c[t]],f[c[t]],m[c[t]]),b.set(p[u[t]],f[u[t]],m[u[t]]);const e=(y.x+b.x)/2,n=(y.y+b.y)/2,i=(y.z+b.z)/2,a=d[c[t]],l=d[u[t]];g.index=a[0],_.index=l[0],s.eachWithin(e,n,i,x,((e,n)=>{v.index=e,1!==v.number&&v.vdw*v.vdw*w>n&&!tp(g,v,r)&&!tp(_,v,r)&&!a.includes(e)&&!l.includes(e)&&y.distanceToSquared(v)>1&&b.distanceToSquared(v)>1&&(o.clear(t),Ql&&Yl.log("removing",g.qualifiedName(),_.qualifiedName(),"because",v.qualifiedName()))}))})),Ql&&Yl.timeEnd("refineLineOfSight")}(t,i,e),function(t,e){const{contactSet:n,contactStore:i,features:r}=e,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c=t.getAtomProxy(),u=t.getAtomProxy(),h={},d=function(t,e,i){const[r,s]=h[i]||[1/0,-1];t<r?(-1!==s&&n.clear(s),h[i]=[t,e]):n.clear(e)};n.forEach((t=>{if(6!==s[t])return;c.index=l[o[t]][0],u.index=l[a[t]][0];const e=c.distanceTo(u);d(e,t,`${c.index}|${u.residueIndex}`),d(e,t,`${u.index}|${c.residueIndex}`)}))}(t,i),e.refineSaltBridges&&function(t,e){const{contactSet:n,contactStore:i,features:r}=e,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c={},u=function(t,e){c[t]||(c[t]=[]),c[t].push(e)};n.forEach((t=>{1===s[t]&&(l[o[t]].forEach((e=>u(e,t))),l[a[t]].forEach((e=>u(e,t))))})),n.forEach((t=>{if(!function(t){return 4===t||9===t||10===t}(s[t]))return;const e=c[l[o[t]][0]],i=c[l[a[t]][0]];if(!e||!i)return;const r=e.length;for(let s=0;s<r;++s)if(i.includes(e[s]))return void n.clear(t)}))}(0,i),function(t,e){const{contactSet:n,contactStore:i,features:r}=e,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c={},u=function(t,e){c[t]||(c[t]=[]),c[t].push(e)};n.forEach((t=>{3===s[t]&&(l[o[t]].forEach((e=>u(e,t))),l[a[t]].forEach((e=>u(e,t))))})),n.forEach((t=>{if(6!==s[t]&&2!==s[t])return;const e=c[l[o[t]][0]],i=c[l[a[t]][0]];if(!e||!i)return;const r=e.length;for(let s=0;s<r;++s)if(i.includes(e[s]))return void n.clear(t)}))}(0,i),function(t,e){const{contactSet:n,contactStore:i,features:r}=e,{type:s,index1:o,index2:a}=i,{atomSets:l}=r,c={},u=function(t,e){c[t]||(c[t]=[]),c[t].push(e)};n.forEach((t=>{1===s[t]&&(l[o[t]].forEach((e=>u(e,t))),l[a[t]].forEach((e=>u(e,t))))})),n.forEach((t=>{if(7!==s[t])return;const e=c[l[o[t]][0]],i=c[l[a[t]][0]];if(!e||!i)return;const r=e.length;for(let t=0;t<r;++t)if(i.includes(e[t]))return void n.clear(e[t])}))}(0,i),Ql&&Yl.timeEnd("calculateContacts"),i}(t,e),t,n)}createData(t){const e=this.getContactData(t),n=[new iv(kh(e),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const t={size:this.labelSize,unit:this.labelUnit};n.push(new U_(function(t,e){const n=Hc(t.position1,t.position2),i=[],r=Gc(t.position1,t.position2),s=r.length/3;for(let t=0;t<s;t++){const n=3*t,s=Math.sqrt(Math.pow(r[n],2)+Math.pow(r[n+1],2)+Math.pow(r[n+2],2));switch(e.unit){case"angstrom":i[t]=s.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":i[t]=(s/10).toFixed(2)+" nm";break;default:i[t]=s.toFixed(2)}}return{position:n,size:$c(n.length/3,e.size),color:t.color,text:i}}(e,t),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}sc.add("contact",mv);class gv extends T_{constructor(t,e,n){super(t,e,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(t){const e=t||{};e.side=Aa(e.side,"double"),e.opacity=Aa(e.opacity,.5),this.atomQuad=Aa(e.atomQuad,[]),this.extendLine=Aa(e.extendLine,!0),this.lineVisible=Aa(e.lineVisible,!0),this.planeVisible=Aa(e.planeVisible,!0),this.sectorVisible=Aa(e.sectorVisible,!0),super.init(e)}createData(t){if(!t.atomCount||!this.atomQuad.length)return;const e=function(t,e={}){const n=Aa(e.angleStep,Math.PI/90),i=t.length,r=t.length/12,s=new Float32Array(r),o=new Float32Array(3*r),a=new Array(r),l=new Array(r),c=new Array(r),u=new Array(r),h=new Array(r);let d=0,p=0,f=0;const m=fh(),g=fh(),_=fh(),v=fh(),y=fh(),b=fh(),x=fh(),w=fh(),S=fh(),A=fh(),M=fh(),C=fh(),E=fh(),T=fh(),P=fh();let I=0;for(var R=0;R<i;R+=12){if(yh(m,t,R),yh(g,t,R+3),yh(_,t,R+6),yh(v,t,R+9),_h(y,m,g),_h(b,_,g),0===wh(b))continue;_h(x,v,_),Ah(w,b,.5),vh(S,g,w),Mh(y,y),Mh(b,b),Mh(x,x),_h(w,m,S);const i=gh(w,b)>0;_h(w,v,S);const r=gh(w,b)<0;if(Ah(w,b,gh(b,y)),_h(A,y,w),Ah(w,b,gh(b,x)),_h(M,x,w),0===wh(A)||0===wh(M))continue;Mh(A,A),Mh(M,M);const k=s[I]=Rh(A,M);a[I]=(zc*k).toFixed(1)+String.fromCharCode(176),mh(T,A,b),Mh(T,T),gh(T,M)<0&&Ih(T,T),I_(w,S,A,T,k/2),bh(w,o,3*I);const D=Math.ceil(k/n),L=D+(e.extendLine?4:2),O=e.extendLine?36:0,N=new Float32Array(3*L),F=new Float32Array(3*L),B=new Float32Array(9*D),U=new Float32Array(O);l[I]=N,c[I]=F,u[I]=B,h[I]=U,e.extendLine&&(i?(_h(w,m,_),Mh(w,w),Ah(C,w,1/gh(A,w)),vh(C,C,_)):(Ah(C,y,1/gh(A,y)),vh(C,C,g)),r?(_h(w,v,g),Mh(w,w),Ah(E,w,1/gh(M,w)),vh(E,E,g)):(Ah(E,x,1/gh(M,x)),vh(E,E,_))),vh(P,S,A);let z=0;e.extendLine?(bh(m,N,z),bh(C,F,z),z+=3,bh(C,N,z),bh(P,F,z),z+=3,bh(C,U,0),bh(P,U,3),bh(i?_:g,U,6),bh(i?_:g,U,9),bh(P,U,12),bh(S,U,15)):(bh(S,N,z),bh(P,F,z),z+=3);const V=function(t,e){const n=9*e;bh(S,B,n),bh(P,B,n+3),bh(P,N,z),I_(P,S,A,T,t),bh(P,B,n+6),bh(P,F,z),z+=3};let H=0;for(let t=n;t<k;t+=n)V(t,H++);V(k,H++),e.extendLine?(bh(P,N,3*(L-2)),bh(E,F,3*(L-2)),bh(E,N,3*(L-1)),bh(v,F,3*(L-1)),bh(E,U,18),bh(P,U,21),bh(r?g:_,U,24),bh(r?g:_,U,27),bh(P,U,30),bh(S,U,33)):(bh(P,N,z),bh(S,F,z),z+=3),d+=3*L,p+=9*D,f+=O,I+=1}const k=I,D=new Float32Array(d),L=new Float32Array(d),O=new Float32Array(p),N=new Float32Array(f);let F=0,B=0,U=0;for(let t=0;t<k;t++){const e=l[t],n=c[t],i=u[t],r=h[t];Yc(e,D,0,F,e.length),Yc(n,L,0,F,n.length),Yc(i,O,0,B,i.length),Yc(r,N,0,U,r.length),F+=e.length,B+=i.length,U+=r.length}return{labelPosition:o.subarray(0,3*k),labelText:a.slice(0,k),linePosition1:D,linePosition2:L,planePosition:N,sectorPosition:O}}(P_(t,this.atomQuad),{extendLine:this.extendLine}),n=this.n=e.labelText.length,i=new Pn(this.labelColor);this.textBuffer=new U_({position:e.labelPosition,size:$c(n,this.labelSize),color:jc(n,i.r,i.g,i.b),text:e.labelText},this.getLabelBufferParams());const r=new Pn(this.colorValue);this.lineLength=e.linePosition1.length/3;const s=jc(this.lineLength,r.r,r.g,r.b);return this.lineBuffer=new H_(Lh({position1:e.linePosition1,position2:e.linePosition2,color:s,color2:s}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=e.planePosition.length/3,this.planeBuffer=new tf({position:e.planePosition,color:jc(this.planeLength,r.r,r.g,r.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=e.sectorPosition.length/3,this.sectorBuffer=new tf({position:e.sectorPosition,color:jc(this.sectorLength,r.r,r.g,r.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(t,e){super.updateData(t,e);const n={},i={},r={};if(t.color){const t=new Pn(this.colorValue);Object.assign(n,{color:jc(this.lineLength,t.r,t.g,t.b),color2:jc(this.lineLength,t.r,t.g,t.b)}),Object.assign(i,{color:jc(this.planeLength,t.r,t.g,t.b)}),Object.assign(r,{color:jc(this.sectorLength,t.r,t.g,t.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(i),this.sectorBuffer.setAttributes(r)}setParameters(t){return super.setParameters(t,{},!1),!t||void 0===t.lineVisible&&void 0===t.sectorVisible&&void 0===t.planeVisible||this.setVisibility(this.visible),t&&t.lineOpacity&&this.lineBuffer.setParameters({opacity:t.lineOpacity}),t&&void 0!==t.opacity&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),t&&t.linewidth&&this.lineBuffer.setParameters({linewidth:t.linewidth}),this}setVisibility(t,e){return super.setVisibility(t,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),e||this.viewer.requestRender(),this}}function _v(t,e){function n(t,e){return e in t}const i=Object.assign({},t);for(const t in i)n(i,t)&&n(e,t)&&(i[t]=Aa(e[t],i[t]));return i}function vv(t,e){const n=new Pn(t),i=new Float32Array(3*e);return jc(e,n.r,n.g,n.b,i),i}sc.add("dihedral",gv);class yv extends E_{constructor(t,e,n){super(t,e,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(t){const e=t||{},n=_v({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},e);Object.assign(this,n);const i=_v({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},e);Object.assign(this,i),this.histogramsData.forEach((t=>{const e=_v(n,t);Object.assign(t,e)})),e.side=Aa(e.side,"double"),e.opacity=Aa(e.opacity,.5),e.radiusType=Aa(e.radiusType,"size"),e.radiusSize=Aa(e.radiusSize,.15),super.init(e)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(t){if(!t.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach((e=>e.atomPositions=P_(t,[e.atomQuad])));const e=this.scaleBinToSectorArea?function(t){return Math.sqrt(t)}:function(t){return t};function n(t){const e=t.map((t=>t.length)),n=new Float32Array(Jc(e));let i=0;for(let e=0;e<t.length;e++)n.set(t[e],i),i+=t[e].length;return n}function i(t,e){return new H_({position1:n(t.map((t=>t.startPoints))),position2:n(t.map((t=>t.endPoints))),color:n(t.map((t=>t.startColors))),color2:n(t.map((t=>t.endColors)))},e)}function r(t,e){return new tf({position:n(t.map((t=>t.triangles))),color:n(t.map((t=>t.triangleColors)))},e)}this.histogramsData.forEach((t=>t.histogram360Scaled=t.histogram360.map(e)));const s=[];for(let t=0;t<this.histogramsData.length;t++){let e,n=this.histogramsData[t];n.histogram360.length>=3&&(e=bv(n)),void 0!==e&&s.push(e)}return this.frontHistogramBinBordersBuffer=i(s.map((t=>t.frontHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=i(s.map((t=>t.backHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=i(s.map((t=>t.adjacentBondArrows)),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=i(s.map((t=>t.distantBondArrows)),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=r(s.map((t=>t.opaqueMiddleDisc)),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=r(s.map((t=>t.frontHistogram)),this.getHistogramBufferParameters()),this.backHistogramBuffer=r(s.map((t=>t.backHistogram)),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(t){return super.setParameters(t,{},!1),t&&void 0!==t.histogramBinBorderVisible&&this.setVisibility(this.visible),this}setVisibility(t,e){return super.setVisibility(t,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),e||this.viewer.requestRender(),this}}function bv(t){const e=t.atomPositions,n=t.histogram360Scaled,i=n.length<=180?360:2*n.length,r={triangles:new Float32Array(3*i*3),triangleColors:vv(t.opaqueMiddleDiscColor,3*i)},s={triangles:new Float32Array(3*n.length*3),triangleColors:vv(t.frontHistogramColor,3*n.length)},o={triangles:new Float32Array(3*n.length*3),triangleColors:vv(t.backHistogramColor,3*n.length)},a={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:vv(t.histogramBinBorderColor,n.length),endColors:vv(t.histogramBinBorderColor,n.length)},l={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:vv(t.histogramBinBorderColor,n.length),endColors:vv(t.histogramBinBorderColor,n.length)},c={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:vv(t.adjacentBondArrowColor,n.length),endColors:vv(t.adjacentBondArrowColor,n.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:vv(t.distantBondArrowColor,n.length),endColors:vv(t.distantBondArrowColor,n.length)},h=fh(),d=fh(),p=fh(),f=fh(),m=fh(),g=fh(),_=fh(),v=fh(),y=fh(),b=fh(),x=fh(),w=fh(),S=fh(),A=fh(),M=fh(),C=fh(),E=[h,d,p,f];for(let t=0;t<E.length;t++)yh(E[t],e,3*t);if(_h(m,h,d),_h(g,p,d),_h(v,f,p),0===wh(g))return;if(Ah(M,g,.5),vh(y,d,M),Mh(m,m),Mh(g,g),Mh(v,v),Ih(_,g),Ah(M,_,gh(_,m)),_h(b,m,M),Ah(M,g,gh(g,v)),_h(x,v,M),0===wh(b)||0===wh(x))return;Mh(b,b),Mh(x,x);const T=Math.acos(gh(b,x));mh(w,_,b),mh(S,g,x),Mh(w,w),Mh(S,S);let P=T;gh(w,x)<0&&(P=-T),vh(A,y,b);const I=Math.max.apply(null,n),R=2*Math.PI/n.length;function k(t,e,i,r,s){const o=3*e*3;bh(y,t,o);const a=Number(n[e])/I;Ah(M,i,a),Ah(C,r,a),I_(A,y,M,C,e*s),bh(A,t,o+3),I_(A,y,M,C,(e+1)*s),bh(A,t,o+6)}function D(t,e,i,r,s){Yc(y,c.startPoints,0,3*i,y.length),I_(M,y,r,s,0+0*R),Yc(M,c.endPoints,0,3*i,y.length),Yc(y,u.startPoints,0,3*i,y.length),I_(M,y,r,s,P),Yc(M,u.endPoints,0,3*i,y.length);for(let t=0;t<n.length;t++)Yc(y,e.startPoints,0,3*t,y.length),I_(M,y,r,s,0+R*t),Yc(M,e.endPoints,0,3*t,M.length);for(let e=0;e<n.length;e++)k(t.triangles,e,r,s,R)}const L=2*Math.PI/i;for(let t=0;t<i;t++){const e=3*t*3;bh(y,r.triangles,e),I_(A,y,b,w,t*L),bh(A,r.triangles,e+3),I_(A,y,b,w,(t+1)*L),bh(A,r.triangles,e+6)}return Ah(M,g,-.01),vh(y,y,M),D(s,a,0,b,w),Ah(M,g,.02),vh(y,y,M),D(o,l,1,x,S),{opaqueMiddleDisc:r,frontHistogram:s,backHistogram:o,frontHistogramBinBorders:a,backHistogramBinBorders:l,adjacentBondArrows:c,distantBondArrows:u}}sc.add("dihedral-histogram",yv);class xv extends T_{constructor(t,e,n){super(t,e,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(t){const e=t||{};e.linewidth=Aa(e.linewidth,5),e.radiusType=Aa(e.radiusType,"size"),e.radiusSize=Aa(e.radiusSize,.2),this.labelUnit=Aa(e.labelUnit,""),this.useCylinder=Aa(e.useCylinder,!1),this.atomPair=Aa(e.atomPair,[]),super.init(e)}getDistanceData(t,e){let n=e.length;const i=new Array(n);let r=new Float32Array(3*n);const s=new Ll,o=new Ll,a=new kf,l=t.getAtomProxy(),c=t.getAtomProxy();let u=0;const h=t.getAtomSet();e.forEach(((e,n)=>{let d=e[0],p=e[1];if("number"==typeof d&&Number.isInteger(d)&&"number"==typeof p&&Number.isInteger(p)){if(!h.get(d)||!h.get(p))return void(u+=1);l.index=d,c.index=p}else{s.setString(d),o.setString(p);var f=t.getAtomIndices(s),m=t.getAtomIndices(o);if(!f.length||!m.length)return void(u+=1);l.index=f[0],c.index=m[0]}a.addBond(l,c,1),n-=u;var g=l.distanceTo(c);switch(this.labelUnit){case"angstrom":i[n]=g.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":i[n]=(g/10).toFixed(2)+" nm";break;default:i[n]=g.toFixed(2)}var _=3*n;r[_+0]=(l.x+c.x)/2,r[_+1]=(l.y+c.y)/2,r[_+2]=(l.z+c.z)/2})),u>0&&(n-=u,r=r.subarray(0,3*n));var d=new Jh(a.count,!0);return{text:i,position:r,bondSet:d,bondStore:a}}getBondData(t,e,n){const i=t.getBondData(this.getBondParams(e,n));return i.picking&&(i.picking=new fp(i.picking.array,i.picking.structure,n.bondStore)),i}createData(t){if(!t.atomCount||!this.atomPair.length)return;const e=this.atomPair.length,n=new Pn(this.labelColor),i=this.getDistanceData(t,this.atomPair);this.textBuffer=new U_({position:i.position,size:$c(e,this.labelSize),color:jc(e,n.r,n.g,n.b),text:i.text},this.getLabelBufferParams());const r={bondSet:i.bondSet,bondStore:i.bondStore},s=this.getBondData(t,{position:!0,color:!0,picking:!0,radius:this.useCylinder},r);return this.useCylinder?this.distanceBuffer=new iv(s,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new H_(Dh(s),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:i.bondSet,bondStore:i.bondStore,position:i.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(t,e){super.updateData(t,e);const n={bondSet:e.bondSet,bondStore:e.bondStore},i=this.getBondData(e.sview,t,n),r={};t&&!t.color||Object.assign(r,{color:i.color,color2:i.color2}),t&&!t.radius||Object.assign(r,{radius:i.radius}),this.distanceBuffer.setAttributes(r)}setParameters(t){return super.setParameters(t,{},!1),this.useCylinder||(t&&t.lineOpacity&&this.distanceBuffer.setParameters({opacity:t.lineOpacity}),t&&void 0!==t.opacity&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),t&&t.linewidth&&this.distanceBuffer.setParameters({linewidth:t.linewidth})),this}}function wv(t){return t.position.length/3*2*3}sc.add("distance",xv);const Sv=Object.assign({scale:1,color:"grey"},Zp);class Av extends Jp{constructor(t,e={}){super({position:new Float32Array(wv(t)),color:new Float32Array(wv(t))},e),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new Pn(this.parameters.color),i=this.geometry.attributes;jc(wv(t)/3,n.r,n.g,n.b,i.color.array),this.setAttributes(t)}get defaultParameters(){return Sv}setAttributes(t={}){const e=this.geometry.attributes;let n,i,r;t.position&&t.vector&&(n=t.position,i=t.vector,r=e.position.array,e.position.needsUpdate=!0);const s=this.size/2,o=this.parameters.scale;if(n&&i)for(let t=0;t<s;t++){const e=2*t*3,s=3*t;r[e+0]=n[s+0],r[e+1]=n[s+1],r[e+2]=n[s+2],r[e+3]=n[s+0]+i[s+0]*o,r[e+4]=n[s+1]+i[s+1]*o,r[e+5]=n[s+2]+i[s+2]*o}}}class Mv extends E_{constructor(t,e,n){super(t,e,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(t){const e=t||{};e.colorScheme=Aa(e.colorScheme,"sstruc"),e.radiusType=Aa(e.radiusType,"size"),e.radiusSize=Aa(e.radiusSize,.15),e.radiusScale=Aa(e.radiusScale,1),e.useInteriorColor=Aa(e.useInteriorColor,!0),super.init(e)}createData(t){const e=[],n=[];return this.structure.eachPolymer((t=>{if(t.residueCount<4)return;n.push(t);const i=new Ff(t),r=i.getPosition(),s=i.getColor(this.getColorParams()),o=i.getSize(this.getRadiusParams()),a=i.getPicking();e.push(new tg({position:r.center,color:s.color,radius:o.size,picking:a.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new Av({position:r.center,vector:r.axis},this.getBufferParams({color:"skyblue",scale:1})),new Av({position:r.center,vector:r.resdir},this.getBufferParams({color:"lightgreen",scale:1})))}),t.getSelection()),{bufferList:e,polymerList:n}}updateData(t,e){Ql&&Yl.time(this.type+" repr update"),t=t||{};for(let n=0,i=e.polymerList.length;n<i;++n){const i=3*n,r={},s=e.polymerList[n],o=new Ff(s);if(t.position){const t=o.getPosition();Object.assign(r,{position:t.center}),e.bufferList[i+1].setAttributes({position:t.center,vector:t.axis}),e.bufferList[i+2].setAttributes({position:t.center,vector:t.resdir})}e.bufferList[i].setAttributes(r)}Ql&&Yl.timeEnd(this.type+" repr update")}}sc.add("helixorient",Mv);class Cv extends sv{constructor(t,e,n){super(t,e,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(t){var e=t||{};e.aspectRatio=1,super.init(e)}}sc.add("licorice",Cv),ac.add("shader/HyperballStickImpostor.vert","\nattribute vec3 mapping;\nattribute float radius;\nattribute float radius2;\nattribute vec3 position1;\nattribute vec3 position2;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform float shrink;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewProjectionMatrixInverse;\nvoid main(){\nvRadius = radius;\nvRadius2 = radius2;\nvec4 spaceposition;\nvec3 position_atom1;\nvec3 position_atom2;\nvec4 vertex_position;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nfloat radius1 = radius;\nposition_atom1 = position1;\nposition_atom2 = position2;\nfloat distance = distance( position_atom1, position_atom2 );\nspaceposition.z = mapping.z * distance;\nif (radius1 > radius2) {\nspaceposition.y = mapping.y * 1.5 * radius1;\nspaceposition.x = mapping.x * 1.5 * radius1;\n} else {\nspaceposition.y = mapping.y * 1.5 * radius2;\nspaceposition.x = mapping.x * 1.5 * radius2;\n}\nspaceposition.w = 1.0;\nvec4 e3 = vec4( 1.0 );\nvec3 e1, e1_temp, e2, e2_temp;\ne3.xyz = normalize(position_atom1-position_atom2);\nif (e3.z == 0.0) { e3.z = 0.0000000000001;}\nif ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}\nif ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}\nif ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}\nvec4 focus = vec4( 1.0 );\nfocus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +\n( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));\nfocus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +\n( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));\nfocus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +\n( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;\ne2 = normalize(e2_temp);\nmat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );\nvertex_position.xyz = R * spaceposition.xyz;\nvertex_position.w = 1.0;\nvertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;\nvertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;\nvertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;\ngl_Position = modelViewProjectionMatrix * vertex_position;\nvec4 i_near, i_far;\nvec4 near = gl_Position;\nnear.z = 0.0 ;\nnear = modelViewProjectionMatrixInverse * near;\ni_near = near;\nvec4 far = gl_Position;\nfar.z = far.w ;\ni_far = modelViewProjectionMatrixInverse * far;\nprime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );\nprime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );\nfloat Rsquare = (radius1*radius1/shrink) - (\n(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +\n(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +\n(position_atom1.z - focus.z)*(position_atom1.z - focus.z)\n);\nfocus.w = Rsquare;\nmatrix_near = mat4( i_near, i_far, focus, e3 );\ngl_Position.z = 1.0;\n}"),ac.add("shader/HyperballStickImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float shrink;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrixInverseTranspose;\nuniform mat4 projectionMatrix;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat calcClip( vec4 cameraPos ){\nreturn dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nfloat calcClip( vec3 cameraPos ){\nreturn calcClip( vec4( cameraPos, 1.0 ) );\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nstruct Ray {\nvec3 origin ;\nvec3 direction ;\n};\nbool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){\nfloat a = x3.x;\nfloat b = x3.y;\nfloat c = x3.z;\nfloat d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;\nfloat l = a*M.x+b*M.y+c*M.z+d;\nif (l<0.0) {return true;}\nelse{return false;}\n}\nvec3 isect_surf(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t1 =(-b-sqrt(delta))/a;\nreturn r.origin+t1*r.direction;\n}\nvec3 isect_surf2(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t2 =(-b+sqrt(delta))/a;\nreturn r.origin+t2*r.direction;\n}\nRay primary_ray(vec4 near1, vec4 far1){\nvec3 near=near1.xyz/near1.w;\nvec3 far=far1.xyz/far1.w;\nreturn Ray(near,far-near);\n}\nfloat update_z_buffer(vec3 M, mat4 ModelViewP){\nfloat depth1;\nvec4 Ms=(ModelViewP*vec4(M,1.0));\nreturn depth1=(1.0+Ms.z/Ms.w)/2.0;\n}\nvoid main(){\nfloat radius = max( vRadius, vRadius2 );\nvec4 i_near, i_far, focus;\nvec3 e3, e1, e1_temp, e2;\ni_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);\ni_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);\nfocus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);\ne3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2 = normalize(cross(e1,e3));\nvec4 equation = focus;\nfloat shrinkfactor = shrink;\nfloat t1 = -1.0/(1.0-shrinkfactor);\nfloat t2 = 1.0/(shrinkfactor);\nvec4 colonne1, colonne2, colonne3, colonne4;\nmat4 mat;\nvec3 equation1 = vec3(t2,t2,t1);\nfloat A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;\nfloat A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;\nfloat A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;\nfloat A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;\nfloat A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;\nfloat A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;\nfloat A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;\nfloat A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;\nfloat A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;\nfloat A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;\nfloat A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;\nfloat A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;\nfloat A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;\ncolonne1 = vec4(A11,A21,A31,A41);\ncolonne2 = vec4(A21,A22,A32,A42);\ncolonne3 = vec4(A31,A32,A33,A43);\ncolonne4 = vec4(A41,A42,A43,A44);\nmat = mat4(colonne1,colonne2,colonne3,colonne4);\nRay ray = primary_ray(i_near,i_far) ;\nvec3 M;\nM = isect_surf(ray, mat);\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nvec4 M1 = vec4(M,1.0);\nvec4 M2 = mat*M1;\nvec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\n#ifdef NEAR_CLIP\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){\nM = isect_surf2(ray, mat);\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )\ndiscard;\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#endif\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\nfloat distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /\ndistance(prime2.xyz,prime1.xyz);\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distance_ratio>0.5 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 nonPerturbedNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include colorspace_fragment\n#include fog_fragment\n#endif\n}");const Ev=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),Tv=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class Pv extends Ym{constructor(t,e={}){super("v3",t,e)}get mapping(){return Ev}get mappingIndices(){return Tv}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const Iv=Object.assign({shrink:.14},Zp),Rv=Object.assign({shrink:{uniform:!0}},Qp);class kv extends Pv{constructor(t,e={}){super(t,e),this.parameterTypes=Rv,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new ze},modelViewProjectionMatrixInverse:{value:new ze},modelViewMatrixInverseTranspose:{value:new ze},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(t),this.makeMapping()}get defaultParameters(){return Iv}}Object.assign({disableImpostor:!1},X_,Iv);const Dv=class{constructor(t,e={}){return!ql||e&&e.disableImpostor?(t.radius=function(t,e){const n=t.length,i=new Float32Array(n);for(let r=0;r<n;r++)i[r]=Math.min(t[r],e[r]);return i}(t.radius,t.radius2),new K_(t,e)):new kv(t,e)}};class Lv extends Cv{constructor(t,e,n){super(t,e,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(t){var e=t||{};e.radiusScale=Aa(e.radiusScale,.2),e.radiusType=Aa(e.radiusType,"vdw"),e.useInteriorColor=Aa(e.useInteriorColor,!0),this.shrink=Aa(e.shrink,.12),super.init(e)}getBondParams(t,e){return t&&!t.radius||(e=Object.assign({radius2:!0},e)),super.getBondParams(t,e)}createData(t){var e=new tg(t.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*t.bondCount),{bufferList:[e,new Dv(t.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(t,e){var n=e.sview.getAtomData(this.getAtomParams()),i=e.sview.getBondData(this.getBondParams()),r={},s={};if(!t||t.position){Object.assign(r,{position:n.position});var o=i.position1,a=i.position2;Object.assign(s,{position:Hc(o,a,this.__center),position1:o,position2:a})}t&&!t.color||(Object.assign(r,{color:n.color}),Object.assign(s,{color:i.color,color2:i.color2})),t&&!t.radius||(Object.assign(r,{radius:n.radius}),Object.assign(s,{radius:i.radius,radius2:i.radius2})),e.bufferList[0].setAttributes(r),e.bufferList[1].setAttributes(s)}}sc.add("hyperball",Lv);class Ov{constructor(t,e={},n=""){this.type=t,this.text=e,this.format=n,this.errorLogged=!1}atomLabel(t){let e;switch(this.type){case"atomname":e=t.atomname;break;case"atomindex":e=`${t.index}`;break;case"occupancy":e=t.occupancy.toFixed(2);break;case"bfactor":e=t.bfactor.toFixed(2);break;case"serial":e=`${t.serial}`;break;case"element":e=t.element;break;case"atom":e=`${t.atomname}|${t.index}`;break;case"resname":e=t.resname;break;case"resno":e=`${t.resno}`;break;case"res":e=`${bd[t.resname.toUpperCase()]||t.resname}${t.resno}`;break;case"residue":const n=bd[t.resname.toUpperCase()];e=n&&!t.inscode?`${n}${t.resno}`:`[${t.resname}]${t.resno}${t.inscode}`;break;case"text":e=this.text[t.index];break;case"format":try{e=(0,ya.sprintf)(this.format,t)}catch(t){this.errorLogged||(this.errorLogged=!0,console.log(t.message))}break;default:e=t.qualifiedName()}return void 0===e?"":e}}Ov.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class Nv extends E_{constructor(t,e,n){super(t,e,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:Ov.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(t){const e=t||{};this.labelType=Aa(e.labelType,"res"),this.labelText=Aa(e.labelText,{}),this.labelFormat=Aa(e.labelFormat,""),this.labelGrouping=Aa(e.labelGrouping,"atom"),this.fontFamily=Aa(e.fontFamily,"sans-serif"),this.fontStyle=Aa(e.fontStyle,"normal"),this.fontWeight=Aa(e.fontWeight,"bold"),this.xOffset=Aa(e.xOffset,0),this.yOffset=Aa(e.yOffset,0),this.zOffset=Aa(e.zOffset,.5),this.attachment=Aa(e.attachment,"bottom-left"),this.showBorder=Aa(e.showBorder,!1),this.borderColor=Aa(e.borderColor,"lightgrey"),this.borderWidth=Aa(e.borderWidth,.15),this.showBackground=Aa(e.showBackground,!1),this.backgroundColor=Aa(e.backgroundColor,"lightgrey"),this.backgroundMargin=Aa(e.backgroundMargin,.5),this.backgroundOpacity=Aa(e.backgroundOpacity,1),this.fixedSize=Aa(e.fixedSize,!1),super.init(e)}getTextData(t,e){const n=this.getAtomParams(e),i=new Ov(this.labelType,this.labelText,this.labelFormat);let r,s,o,a,l,c,u;if("atom"===this.labelGrouping){const l=t.getAtomData(n);r=l.position,s=l.radius,o=l.color,e&&!e.text||(a=[],t.eachAtom((t=>a.push(i.atomLabel(t)))))}else if("residue"===this.labelGrouping){e&&!e.position||(l=[]),e&&!e.color||(u=[]),e&&!e.radius||(c=[]),e&&!e.text||(a=[]),n.colorParams&&(n.colorParams.structure=t.getStructure());const h=ic.getScheme(n.colorParams),d=new Cf(n.radiusParams),p=t.getAtomProxy();let f=0;t.eachResidue((t=>{const n=3*f;t.isProtein()||t.isNucleic()?(p.index=t.traceAtomIndex,e&&!e.position||p.positionToArray(l,n)):(p.index=t.atomOffset,e&&!e.position||t.positionToArray(l,n)),e&&!e.color||h.atomColorToArray(p,u,n),e&&!e.radius||(c[f]=d.atomRadius(p)),e&&!e.text||a.push(i.atomLabel(p)),++f})),e&&!e.position||(r=new Float32Array(l)),e&&!e.color||(o=new Float32Array(u)),e&&!e.radius||(s=new Float32Array(c))}return{position:r,size:s,color:o,text:a}}createData(t){return{bufferList:[new U_(this.getTextData(t,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(t,e){e.bufferList[0].setAttributes(this.getTextData(e.sview,t))}getAtomRadius(){return 0}}function Fv(t){const e=t.getAtomSet(),n=t.getBondSet(),i=t.getBondProxy();return n.forEach((function(t){i.index=t,e.clear(i.atomIndex1),e.clear(i.atomIndex2)})),e}sc.add("label",Nv);class Bv extends E_{constructor(t,e,n){super(t,e,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(t){var e=t||{};this.multipleBond=Aa(e.multipleBond,"off"),this.bondSpacing=Aa(e.bondSpacing,1),this.linewidth=Aa(e.linewidth,2),this.lines=Aa(e.lines,!0),this.crosses=Aa(e.crosses,"lone"),this.crossSize=Aa(e.crossSize,.4),super.init(e)}getAtomRadius(t){return.1}getBondParams(t,e){return e=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},e),super.getBondParams(t,e)}_crossData(t,e){if(t&&!t.position&&!t.color)return;const n={};"lone"===this.crosses&&Object.assign(n,{atomSet:Fv(e)});const i=e.getAtomData(this.getAtomParams(t,n)),r={},s=i.position,o=i.color,a=i.picking,l=(s||o).length,c=3*l;let u=new Float32Array(0),h=new Float32Array(0),d=new Float32Array(0),p=new Float32Array(0),f=0,m=new Float32Array(0);t&&!t.position||(u=r.position1=new Float32Array(c),h=r.position2=new Float32Array(c),f=this.crossSize/2),t&&!t.color||(d=r.color=new Float32Array(c),p=r.color2=new Float32Array(c)),t&&!t.picking||(m=new Float32Array(3*i.picking.array.length));for(let e=0;e<l;e++){const n=3*e,i=3*n;if(!t||t.position){const t=s[n],e=s[n+1],r=s[n+2];u[i]=t-f,u[i+1]=e,u[i+2]=r,h[i]=t+f,h[i+1]=e,h[i+2]=r,u[i+3]=t,u[i+4]=e-f,u[i+5]=r,h[i+3]=t,h[i+4]=e+f,h[i+5]=r,u[i+6]=t,u[i+7]=e,u[i+8]=r-f,h[i+6]=t,h[i+7]=e,h[i+8]=r+f}if(!t||t.color){const t=i+9;for(let e=i;e<t;e+=3)d[e]=p[e]=o[n],d[e+1]=p[e+1]=o[n+1],d[e+2]=p[e+2]=o[n+2]}t&&!t.picking||(m[n]=m[n+1]=m[n+2]=a.array[e])}return t&&!t.picking||(r.picking=new cp(m,a.structure)),r}createData(t){const e={position:!0,color:!0,picking:!0},n=[];if(this.lines){const i=t.getBondData(this.getBondParams(e)),r=new H_(i,this.getBufferParams({linewidth:this.linewidth}));n.push(r)}if("off"!==this.crosses){const i=new H_(this._crossData(e,t),this.getBufferParams({linewidth:this.linewidth}));n.push(i)}return{bufferList:n}}updateData(t,e){let n=0;if(this.lines){const i=e.sview.getBondData(this.getBondParams(t)),r={};t&&!t.position||Object.assign(r,{position1:i.position1,position2:i.position2}),t&&!t.color||Object.assign(r,{color:i.color,color2:i.color2}),e.bufferList[n++].setAttributes(r)}if("off"!==this.crosses){const i=this._crossData(t,e.sview),r={};t&&!t.position||Object.assign(r,{position1:i.position1,position2:i.position2}),t&&!t.color||Object.assign(r,{color:i.color,color2:i.color2}),e.bufferList[n++].setAttributes(r)}}setParameters(t){var e={};return t&&(t.bondSpacing||t.crossSize)&&Object.assign(e,{position:!0}),super.setParameters(t,e,!1),this}}function Uv(t,e,n,i,r){const s=new(i=i||Int32Array)(t*e*n*(r=r||1));function o(t,i,s){return((t*e+i)*n+s)*r}return{data:s,index:o,set:function(t,e,n,...i){const a=o(t,e,n);for(let t=0;t<r;++t)s[a+t]=i[t]},toArray:function(t,e,n,i=[],a=0){const l=o(t,e,n);for(let t=0;t<r;++t)i[a+t]=s[l+t]},fromArray:function(t,e,n,i,a=0){const l=o(t,e,n);for(let t=0;t<r;++t)s[l+t]=i[a+t]},copy:function(t){s.set(t.data)}}}function zv(t,e,n){var i=Gp(e),r=uh(t);0===t.length&&(r[0].set([0,0,0]),r[1].set([0,0,0]));var s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b=r[0],x=r[1];function w(t,e,n,r,w){s=e||1.4,o=n||2,g=w||!0;var S=0;for(var M in i)S=Math.max(S,M);var C=$p(b,x,S,o,t?s:0);l=C.dim[0],c=C.dim[1],u=C.dim[2],h=C.matrix,d=C.tran,o=C.scaleFactor,p={},f={},A(t),m=s*o,a=r||s/o,_=new Uint8Array(l*c*u),t&&(v=new Float64Array(l*c*u)),g&&(y=new Int32Array(l*c*u))}var S=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function A(t){var e,n,r,a,l,c,u,h,d,m;for(var g in i)if(e=parseFloat(g),!p[g]){for(c=(u=t?(e+s)*o+.5:e*o+.5)*u,h=Math.floor(u)+1,d=new Int32Array(h*h),m=0,n=0;n<h;++n)for(r=0;r<h;++r)(a=n*n+r*r)>c?d[m]=-1:(l=Math.sqrt(c-a),d[m]=Math.floor(l)),++m;f[g]=h,p[g]=d}}function M(n){var i,r,s,a,h,m,v,b,x,w,S,A,M,C,E,T,P,I,R=3*n,k=n;i=Math.floor(.5+o*(t[R]+d[0])),r=Math.floor(.5+o*(t[R+1]+d[1])),s=Math.floor(.5+o*(t[R+2]+d[2]));var D,L=e[k],O=p[L],N=0,F=c*u,B=f[L];for(w=0;w<B;++w)for(S=0;S<B;++S){if(-1!==(D=O[N]))for(T=-1;T<2;++T)for(P=-1;P<2;++P)for(I=-1;I<2;++I)if(0!==T&&0!==P&&0!==I)for(v=T*w,x=I*S,A=0;A<=D;++A)if(C=r+(b=A*P),E=s+x,!((M=i+v)<0||C<0||E<0||M>=l||C>=c||E>=u)){var U=M*F+C*u+E;if(g)if(1&_[U]){if(1&_[U]){var z=y[U];z!==R&&v*v+b*b+x*x<(a=i+v-Math.floor(.5+o*(t[z]+d[0])))*a+(h=r+b-Math.floor(.5+o*(t[z+1]+d[1])))*h+(m=s+x-Math.floor(.5+o*(t[z+2]+d[2])))*m&&(y[U]=n)}}else _[U]|=1,y[U]=n;else _[U]|=1}N++}}function C(n){var i,r,s,a,h,m,v,b,x,w,S,A,M,C,E,T,P,I,R,k=3*n,D=n,L=0;i=Math.floor(.5+o*(t[k]+d[0])),r=Math.floor(.5+o*(t[k+1]+d[1])),s=Math.floor(.5+o*(t[k+2]+d[2]));var O=e[D],N=c*u;for(M=0,R=f[O];M<R;++M)for(C=0;C<R;++C){if(-1!==p[O][L])for(T=-1;T<2;++T)for(P=-1;P<2;++P)for(I=-1;I<2;++I)if(0!==T&&0!==P&&0!==I)for(v=T*M,x=I*C,E=0;E<=p[O][L];++E)if(S=r+(b=E*P),A=s+x,!((w=i+v)<0||S<0||A<0||w>=l||S>=c||A>=u)){var F=w*N+S*u+A;if(2&_[F]){if(g){var B=y[F];v*v+b*b+x*x<(a=Math.floor(.5+o*(t[B]+d[0])))*a+(h=Math.floor(.5+o*(t[B+1]+d[1])))*h+(m=Math.floor(.5+o*(t[B+2]+d[2])))*m&&(y[F]=n)}}else _[F]|=2,g&&(y[F]=n)}L++}}function E(){var t,e,n,i;console.time("EDTSurface fastdistancemap");var r,s=Uv(l,c,u,Uint16Array,3),o=c*u,h=m*m,d=0;for(t=0;t<l;++t)for(e=0;e<c;++e)for(n=0;n<u;++n)_[r=t*o+e*u+n]&=-3,1&_[r]&&4&_[r]&&(s.set(t,e,n,t,e,n),v[r]=0,_[r]|=2,d+=1);var p=new Int32Array(3*d),f=0,b=new Int32Array(3*d),x=0;for(t=0;t<l;++t)for(e=0;e<c;++e)for(n=0;n<u;++n)4&_[r=t*o+e*u+n]&&(p[f]=t,p[f+1]=e,p[f+2]=n,f+=3,_[r]&=-5);do{for(x=T(p,s,f,b),f=0,t=0,i=x;t<i;t+=3)r=o*b[t]+u*b[t+1]+b[t+2],_[r]&=-5,v[r]<=1.0404*h&&(p[f]=b[t],p[f+1]=b[t+1],p[f+2]=b[t+2],f+=3)}while(f>0);var w,S=a*a,A=new Uint16Array(3);for(t=0;t<l;++t)for(e=0;e<c;++e)for(n=0;n<u;++n)_[r=t*o+e*u+n]&=-5,1&_[r]&&(2&_[r]&&!(2&_[r]&&v[r]>=S)||(_[r]|=4,g&&2&_[r]&&(s.toArray(t,e,n,A),w=A[0]*o+A[1]*u+A[2],y[r]=y[w])));console.timeEnd("EDTSurface fastdistancemap")}function T(t,e,n,i){var r,s,o,a,h,d,p,f,m,g,y,b,x=new Uint16Array(3),w=0;if(0===n)return w;var A=-1,M=-1,C=-1,E=c*u;for(p=0,m=n;p<m;p+=3)for(r=t[p],s=t[p+1],o=t[p+2],e.toArray(r,s,o,x),f=0;f<6;++f)A=r+(b=S[f])[0],M=s+b[1],C=o+b[2],A<l&&A>-1&&M<c&&M>-1&&C<u&&C>-1&&(1&_[y=A*E+u*M+C]&&!(2&_[y])?(e.fromArray(A,M,C,x),g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d,v[y]=g,_[y]|=2,_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3):1&_[y]&&2&_[y]&&(g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d)<v[y]&&(e.fromArray(A,M,C,x),v[y]=g,4&_[y]||(_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3)));for(p=0,m=n;p<m;p+=3)for(r=t[p],s=t[p+1],o=t[p+2],e.toArray(r,s,o,x),f=6;f<18;f++)A=r+(b=S[f])[0],M=s+b[1],C=o+b[2],A<l&&A>-1&&M<c&&M>-1&&C<u&&C>-1&&(1&_[y=A*E+u*M+C]&&!(2&_[y])?(e.fromArray(A,M,C,x),g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d,v[y]=g,_[y]|=2,_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3):1&_[y]&&2&_[y]&&(g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d)<v[y]&&(e.fromArray(A,M,C,x),v[y]=g,4&_[y]||(_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3)));for(p=0,m=n;p<m;p+=3)for(r=t[p],s=t[p+1],o=t[p+2],e.toArray(r,s,o,x),f=18;f<26;f++)A=r+(b=S[f])[0],M=s+b[1],C=o+b[2],A<l&&A>-1&&M<c&&M>-1&&C<u&&C>-1&&(1&_[y=A*E+u*M+C]&&!(2&_[y])?(e.fromArray(A,M,C,x),g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d,v[y]=g,_[y]|=2,_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3):1&_[y]&&2&_[y]&&(g=(a=A-x[0])*a+(h=M-x[1])*h+(d=C-x[2])*d)<v[y]&&(e.fromArray(A,M,C,x),v[y]=g,4&_[y]||(_[y]|=4,i[w]=A,i[w+1]=M,i[w+2]=C,w+=3)));return w}this.getVolume=function(e,i,r,s,o){console.time("EDTSurface.getVolume");var a="vws"!==e;w(a,i,r,s,o),function(e){var n,i;for(console.time("EDTSurface fillvoxels"),n=0,i=_.length;n<i;++n)_[n]=0,e&&(v[n]=-1),g&&(y[n]=-1);for(n=0,i=t.length/3;n<i;++n)M(n);for(n=0,i=_.length;n<i;++n)1&_[n]&&(_[n]|=2);console.timeEnd("EDTSurface fillvoxels")}(a),function(){var t,e,n,i=c*u;for(t=0;t<l;++t)for(e=0;e<u;++e)for(n=0;n<c;++n){var r=t*i+n*u+e;if(1&_[r])for(var s=0;s<26;){var o=t+S[s][0],a=e+S[s][2],h=n+S[s][1];if(o>-1&&o<l&&h>-1&&h<c&&a>-1&&a<u&&!(1&_[o*i+h*u+a])){_[r]|=4;break}s++}}}(),"ms"!==e&&"ses"!==e||E(),"ses"===e&&(A(!1),function(){var e,n;for(e=0,n=_.length;e<n;++e)_[e]&=-3;for(e=0,n=t.length/3;e<n;++e)C(e)}()),function(t){var e,n=_.length;if("vws"===t)for(e=0;e<n;++e)_[e]&=-5,_[e]=2&_[e]?1:0;else if("ms"===t)for(e=0;e<n;++e)_[e]&=-3,4&_[e]&&(_[e]|=2),_[e]&=-5,_[e]=2&_[e]?1:0;else if("ses"===t)for(e=0;e<n;++e)4&_[e]&&2&_[e]?_[e]&=-5:4&_[e]&&!(2&_[e])&&(_[e]|=2),_[e]=2&_[e]?1:0;else if("sas"===t)for(e=0;e<n;++e)_[e]&=-5,_[e]=2&_[e]?1:0}(e);for(var h=0,d=y.length;h<d;++h)y[h]=n[y[h]];return console.timeEnd("EDTSurface.getVolume"),{data:_,nx:u,ny:c,nz:l,atomindex:y}},this.getSurface=function(t,e,n,i,r,s,o){var a=this.getVolume(t,e,n,i,r);return new Wp(a.data,a.nx,a.ny,a.nz,a.atomindex).getSurface(1,s,void 0,h,o)}}function Vv(t,e,n,i,r,s,o){o=Math.max(.1,o);var a=t.length,l=r[0],c=r[1],u=r[2],h=s[0],d=s[1],p=s[2];function f(t,e){return Math.floor((t-e)/o)}for(var m,g,_,v=f(h,l)+1,y=f(d,c)+1,b=f(p,u)+1,x=v*y*b,w=y*b,S=[],A=0;A<a;A++){var M=(m=t[A],g=e[A],_=n[A],(f(m,l)*y+f(g,c))*b+f(_,u));void 0===S[M]?S[M]=[A]:S[M].push(A)}var C=new Uint32Array(x),E=new Uint16Array(x),T=new Uint32Array(a),P=0,I=0;for(A=0;A<x;A++){var R=C[A]=P,k=S[A];if(void 0!==k)for(var D=0;D<k.length;D++)T[P]=k[D],P++;var L=P-R;E[A]=L,L>I&&(I=L)}return{neighbourListLength:27*I+1,withinRadii:function(r,s,o,a,h){for(var d=0,p=f(r,l),m=f(s,c),g=f(o,u),_=Math.max(0,p-1),x=Math.max(0,m-1),S=Math.max(0,g-1),A=Math.min(v,p+2),M=Math.min(y,m+2),P=Math.min(b,g+2),I=_;I<A;++I)for(var R=I*w,k=x;k<M;++k)for(var D=k*b,L=S;L<P;++L)for(var O=R+D+L,N=C[O],F=N+E[O],B=N;B<F;B++){var U=T[B],z=t[U]-r,V=e[U]-s,H=n[U]-o,G=i[U]+a;z*z+V*V+H*H<=G*G&&(h[d++]=T[B])}h[d]=-1}}}function Hv(t,e,n){const i=e.length,r=new Float32Array(i),s=new Float32Array(i),o=new Float32Array(i);for(let e=0;e<i;e++){const n=3*e;r[e]=t[n],s[e]=t[n+1],o[e]=t[n+2]}let a=uh(t);0===t.length&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],c=a[1];let u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C,E,T=-1;const P=new Float32Array([0,0,0]),I=new Float32Array([0,0,0]),R=new Float32Array([0,0,0]),k=new Float32Array([0,0,0]);let D;function L(t,n,a,P){p=Aa(t,1.4),f=Aa(n,2),m=Aa(a,!0),g=Aa(P,30),u=new Float32Array(i),h=new Float32Array(i);for(let t=0;t<u.length;++t){var I=e[t]+p;u[t]=I,h[t]=I*I}d=0;for(let t=0;t<u.length;++t)u[t]>d&&(d=u[t]);!function(){const t=$p(l,c,d,f,0);f=t.scaleFactor,_=t.dim,v=t.matrix,D=Math.max(5,2+Math.floor(p*f)),y=$c(_[0]*_[1]*_[2],-1001),b=new Int32Array(y.length),x=new Float32Array(_[0]),w=new Float32Array(_[1]),S=new Float32Array(_[2]),O(x,l[0],1/f),O(w,l[1],1/f),O(S,l[2],1/f)}(),function(){var t=0,e=2*Math.PI/g;M=new Float32Array(g),A=new Float32Array(g);for(var n=0;n<g;n++)M[n]=Math.cos(t),A[n]=Math.sin(t),t+=e}(),C=Vv(r,s,o,u,l,c,2.01*d),E=new Int32Array(C.neighbourListLength),T=-1}function O(t,e,n){for(let i=0;i<t.length;i++)t[i]=e+n*i}function N(t,e,n,i,r){let s;if(-1!==T){if(s=T,s!==i&&s!==r&&F(s,t,e,n))return s;T=-1}var o=0;for(s=E[o];s>=0;){if(s!==i&&s!==r&&F(s,t,e,n))return T=s,s;s=E[++o]}return T=-1,-1}function F(e,n,i,r){var s=3*e,o=h[e],a=t[s]-n,l=t[s+1]-i,c=t[s+2]-r;return a*a+l*l+c*c<o}function B(t,e){var n=u[t],i=u[e],a=P[0]=r[e]-r[t],c=P[1]=s[e]-s[t],h=P[2]=o[e]-o[t],d=a*a+c*c+h*h,p=Math.sqrt(d),v=n*((n*n+p*p-i*i)/(2*n*p));Mh(P,P),function(t,e){t[0]=t[1]=t[2]=1,0!==e[0]?t[0]=(e[1]+e[2])/-e[0]:0!==e[1]?t[1]=(e[0]+e[2])/-e[1]:0!==e[2]&&(t[2]=(e[0]+e[1])/-e[2])}(R,P),Mh(R,R),mh(k,P,R),Mh(k,k);var C=Math.sqrt(n*n-v*v);Ah(R,R,C),Ah(k,k,C),Ah(P,P,v),I[0]=P[0]+r[t],I[1]=P[1]+s[t],I[2]=P[2]+o[t],T=-1;for(var E=D,L=0;L<g;L++){var O=M[L],F=A[L],B=I[0]+O*R[0]+F*k[0],U=I[1]+O*R[1]+F*k[1],z=I[2]+O*R[2]+F*k[2];if(-1===N(B,U,z,t,e))for(var V=Math.floor(f*(B-l[0])),H=Math.floor(f*(U-l[1])),G=Math.floor(f*(z-l[2])),$=Math.max(0,V-E),j=Math.max(0,H-E),W=Math.max(0,G-E),q=Math.min(_[0],V+E+2),X=Math.min(_[1],H+E+2),Y=Math.min(_[2],G+E+2),K=$;K<q;K++){a=B-x[K];for(var Z=_[1]*_[2]*K,Q=j;Q<X;Q++)for(var J=a*a+(c=U-w[Q])*c,tt=Z+_[2]*Q,et=W;et<Y;et++){d=J+(h=z-S[et])*h;var nt=et+tt,it=y[nt];if(it>0&&d<it*it&&(y[nt]=Math.sqrt(d),m)){const n=a*P[0]+c*P[1]+h*P[2];b[nt]=n<0?e:t}}}}}function U(t,e,a){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),L(t,e,a),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),function(){for(var t=0;t<i;t++){var e=r[t],n=s[t],a=o[t],c=u[t],d=h[t];C.withinRadii(e,n,a,c,E);for(var p=Math.ceil(c*f),g=Math.floor(f*(e-l[0])),v=Math.floor(f*(n-l[1])),A=Math.floor(f*(a-l[2])),M=Math.max(0,g-p),T=Math.max(0,v-p),P=Math.max(0,A-p),I=Math.min(_[0],g+p+2),R=Math.min(_[1],v+p+2),k=Math.min(_[2],A+p+2),D=M;D<I;D++)for(var L=x[D]-e,O=_[1]*_[2]*D,F=T;F<R;F++)for(var B=w[F]-n,U=L*L+B*B,z=O+_[2]*F,V=P;V<k;V++){var H=S[V]-a,G=U+H*H;if(G<d){var $=V+z;y[$]<0&&(y[$]=-y[$]);var j=Math.sqrt(G),W=c/j,q=L*W,X=B*W,Y=H*W;if(-1===N(q+=e,X+=n,Y+=a,t,-1)){var K=c-j;K<y[$]&&(y[$]=K,m&&(b[$]=t))}}}}}(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),function(){for(var t=0;t<i;t++){C.withinRadii(r[t],s[t],o[t],u[t],E);for(var e=0,n=E[e];n>=0;)t<n&&B(t,n),n=E[++e]}}(),console.timeEnd("AVSurface.projectTorii"),function(){for(var t=0;t<y.length;t++)y[t]<0&&(y[t]=0)}(),function(){for(var t=0;t<b.length;t++)b[t]=n[b[t]]}(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(t,e,n,i,r,s,o){return U(e,n,r),new Wp(y,_[2],_[1],_[0],b).getSurface(e,!1,void 0,v,o)}}sc.add("line",Bv),Object.assign(zv,{__deps:[$p,Gp,Wp,uh,Uv]}),Object.assign(Hv,{__deps:[$p,Wp,$c,uh,Ah,mh,Mh,Vv,Aa]}),nc.add("molsurf",(function(t,e){const n=t.data.args,i=t.data.params;if(n&&i){const t=new("av"===i.type?Hv:zv)(n.coordList,n.radiusList,n.indexList).getSurface(i.type,i.probeRadius,i.scaleFactor,i.cutoff,!0,i.smooth,i.contour),r=[t.position.buffer,t.index.buffer];t.normal&&r.push(t.normal.buffer),t.atomindex&&r.push(t.atomindex.buffer),e({sd:t,p:i},r)}}),[zv,Hv]);class Gv{constructor(t){this.structure=t}_getAtomData(t){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:Aa(t.radiusParams,{type:"vdw",scale:1})})}_makeSurface(t,e){var n=new jp(e.name,"",t);return n.info.type=e.type,n.info.probeRadius=e.probeRadius,n.info.scaleFactor=e.scaleFactor,n.info.smooth=e.smooth,n.info.cutoff=e.cutoff,n}getSurface(t){const e=t||{},n=this._getAtomData(t),i=n.position,r=n.radius,s=n.index,o=new("av"===e.type?Hv:zv)(i,r,s).getSurface(e.type,e.probeRadius,e.scaleFactor,e.cutoff,!0,e.smooth,e.contour);return this._makeSurface(o,e)}getSurfaceWorker(t,e){const n=Object.assign({},t);if(window.hasOwnProperty("Worker")){void 0===this.worker&&(this.worker=new oh("molsurf"));const i=this._getAtomData(t),r=i.position,s=i.radius,o=i.index,a={args:{coordList:r,radiusList:s,indexList:o},params:n},l=[r.buffer,s.buffer,o.buffer];this.worker.post(a,l,(t=>{e(this._makeSurface(t.data.sd,n))}),(t=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",t),this.worker.terminate(),this.worker=void 0;const i=this.getSurface(n);e(i)}))}else{const t=this.getSurface(n);e(t)}}dispose(){this.worker&&this.worker.terminate()}}class $v extends E_{constructor(t,e,n){super(t,e,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add((()=>{this.__forceNewMolsurf=!0})),this.toBePrepared=!0,this.init(n)}init(t){const e=t||{};e.colorScheme=Aa(e.colorScheme,"uniform"),e.colorValue=Aa(e.colorValue,14540253),e.disablePicking=Aa(e.disablePicking,!0),this.surfaceType=Aa(e.surfaceType,"ms"),this.probeRadius=Aa(e.probeRadius,1.4),this.smooth=Aa(e.smooth,2),this.scaleFactor=Aa(e.scaleFactor,2),this.cutoff=Aa(e.cutoff,0),this.contour=Aa(e.contour,!1),this.background=Aa(e.background,!1),this.opaqueBack=Aa(e.opaqueBack,!0),this.filterSele=Aa(e.filterSele,""),this.colorVolume=Aa(e.colorVolume,void 0),this.useWorker=Aa(e.useWorker,!0),super.init(t)}prepareData(t,e,n){let i=this.__infoList[e];if(i||(i={},this.__infoList[e]=i),i.molsurf&&i.sele===t.selection.string)n(e);else{if(this.filterSele){const i=t.structure.getView(new Ll(this.filterSele)),r=i.boundingBox.getSize(new ue),s=Math.max(r.x,r.y,r.z),o=t.getAtomSetWithinPoint(i.center,s/2+6);if(0===(t=t.getView(new Ll(t.getAtomSetWithinSelection(o,3).toSeleString()))).atomCount)return void n(e)}i.sele=t.selection.string,i.molsurf=new Gv(t);const r=this.getSurfaceParams(),s=t=>{i.surface=t,n(e)};this.useWorker?i.molsurf.getSurfaceWorker(r,s):s(i.molsurf.getSurface(r))}}prepare(t){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach((t=>{t&&t.molsurf&&t.molsurf.dispose()})),this.__infoList.length=0),0===this.structureView.atomCount)return void t();const e=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,t()},n="default"===this.assembly?this.defaultAssembly:this.assembly,i=this.structure.biomolDict[n];i?i.partList.forEach(((t,n)=>{const r=t.getView(this.structureView);this.prepareData(r,n,(t=>{t===i.partList.length-1&&e()}))})):this.prepareData(this.structureView,0,e)}createData(t,e){const n=this.__infoList[e],i=n.surface;if(!i)return;const r={position:i.getPosition(),color:i.getColor(this.getColorParams()),index:i.getFilteredIndex(this.filterSele,t)},s=[];if(i.contour){const t=new of(r,this.getBufferParams({wireframe:!1}));s.push(t)}else{Object.assign(r,{normal:i.getNormal(),picking:i.getPicking(t.getStructure())});const e=new ef(r,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if("double"==this.getBufferParams().side){const t=new sf(e);s.push(t)}else s.push(e)}return{bufferList:s,info:n}}updateData(t,e){const n={};if(t.position||t.radius)return this.__forceNewMolsurf=!0,void this.build();t.color&&(n.color=e.info.surface.getColor(this.getColorParams())),t.index&&(n.index=e.info.surface.getFilteredIndex(this.filterSele,e.sview)),e.bufferList[0].setAttributes(n)}setParameters(t,e={},n){return t&&t.filterSele&&(e.index=!0),t&&void 0!==t.colorVolume&&(e.color=!0),t&&t.wireframe&&(t.contour||void 0===t.contour&&this.contour)&&(t.wireframe=!1),super.setParameters(t,e,n),this}getSurfaceParams(t={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},t)}getColorParams(){const t=super.getColorParams();return t.volume=this.colorVolume,t}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach((t=>{t&&t.molsurf&&t.molsurf.dispose()})),this.__infoList.length=0,super.dispose()}}sc.add("surface",$v);class jv extends E_{constructor(t,e,n){super(t,e,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(t){var e=t||{};this.pointSize=Aa(e.pointSize,1),this.sizeAttenuation=Aa(e.sizeAttenuation,!0),this.sortParticles=Aa(e.sortParticles,!1),this.useTexture=Aa(e.useTexture,!1),this.alphaTest=Aa(e.alphaTest,.5),this.forceTransparent=Aa(e.forceTransparent,!1),this.edgeBleach=Aa(e.edgeBleach,0),super.init(e)}createData(t){var e=t.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new rg(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(t,e){var n=e.sview.getAtomData(this.getAtomParams(t)),i={};t&&!t.position||Object.assign(i,{position:n.position}),t&&!t.color||Object.assign(i,{color:n.color}),e.bufferList[0].setAttributes(i)}getAtomRadius(){return.1}}sc.add("point",jv),ac.add("shader/Ribbon.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nattribute vec3 dir;\nattribute float size;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\ntransformed += normalize( dir ) * size;\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}");const Wv=new Uint16Array([0,1,2,1,3,2]);function qv(t){return 4*(t.position.length/3-1)*3}class Xv extends tf{constructor(t,e={}){super({position:new Float32Array(qv(t)),color:new Float32Array(qv(t)),index:Ba(qv(t),qv(t)/3),normal:new Float32Array(qv(t)),picking:t.picking},e),this.vertexShader="Ribbon.vert";const n=t.position.length/3-1,i=4*n,r=3*i;this.addAttributes({dir:{type:"v3",value:new Float32Array(r)}}),this.addAttributes({size:{type:"f",value:new Float32Array(i)}}),t.primitiveId=Wc(n),this.setAttributes(t),this.makeIndex()}setAttributes(t={}){const e=this.size/4,n=this.geometry.attributes;let i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x;t.position&&(i=t.position,c=n.position.array,n.position.needsUpdate=!0),t.normal&&(r=t.normal,u=n.normal.array,n.normal.needsUpdate=!0),t.size&&(s=t.size,h=n.size.array,n.size.needsUpdate=!0),t.dir&&(o=t.dir,d=n.dir.array,n.dir.needsUpdate=!0),t.color&&(a=t.color,p=n.color.array,n.color.needsUpdate=!0),t.primitiveId&&(l=t.primitiveId,f=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let w=s?s[0]:null;for(m=0;m<e;++m){for(b=3*m,_=3*m*4,y=4*m,i&&(c[_]=c[_+3]=i[b],c[_+1]=c[_+4]=i[b+1],c[_+2]=c[_+5]=i[b+2],c[_+6]=c[_+9]=i[b+3],c[_+7]=c[_+10]=i[b+4],c[_+8]=c[_+11]=i[b+5]),r&&(u[_]=u[_+3]=-r[b],u[_+1]=u[_+4]=-r[b+1],u[_+2]=u[_+5]=-r[b+2],u[_+6]=u[_+9]=-r[b+3],u[_+7]=u[_+10]=-r[b+4],u[_+8]=u[_+11]=-r[b+5]),g=0;g<4;++g)v=_+3*g,a&&(p[v]=a[b],p[v+1]=a[b+1],p[v+2]=a[b+2]),l&&(f[y+g]=l[m]);s&&(x=s[m],w!==s[m]?(h[y]=w,h[y+1]=w,h[y+2]=x,h[y+3]=x):(h[y]=x,h[y+1]=x,h[y+2]=x,h[y+3]=x),w=x),o&&(d[_]=o[b],d[_+1]=o[b+1],d[_+2]=o[b+2],d[_+3]=-o[b],d[_+4]=-o[b+1],d[_+5]=-o[b+2],d[_+6]=o[b+3],d[_+7]=o[b+4],d[_+8]=o[b+5],d[_+9]=-o[b+3],d[_+10]=-o[b+4],d[_+11]=-o[b+5])}}makeIndex(){const t=this.geometry.getIndex();if(!t)return void Yl.error("Index is null");const e=t.array,n=e.length/4/3;for(let t=0;t<n;++t){const n=6*t,i=4*t;e.set(Wv,n);for(let t=0;t<6;++t)e[n+t]+=i}}}class Yv extends E_{constructor(t,e,n){super(t,e,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(t){var e=t||{};e.colorScheme=Aa(e.colorScheme,"chainname"),e.colorScale=Aa(e.colorScale,"RdYlBu"),e.radiusType=Aa(e.radiusType,"sstruc"),e.radiusScale=Aa(e.radiusScale,4),"low"===e.quality?this.subdiv=3:"medium"===e.quality?this.subdiv=6:"high"===e.quality?this.subdiv=12:this.subdiv=Aa(e.subdiv,6),this.tension=Aa(e.tension,NaN),this.smoothSheet=Aa(e.smoothSheet,!1),super.init(e)}getSplineParams(t){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},t)}getAtomRadius(t){return t.isTrace()?super.getAtomRadius(t):0}createData(t){var e=[],n=[];return this.structure.eachPolymer((t=>{if(!(t.residueCount<4)){n.push(t);var i=new cv(t,this.getSplineParams()),r=i.getSubdividedPosition(),s=i.getSubdividedOrientation(),o=i.getSubdividedColor(this.getColorParams()),a=i.getSubdividedPicking(),l=i.getSubdividedSize(this.getRadiusParams());e.push(new Xv({position:r.position,normal:s.binormal,dir:s.normal,color:o.color,size:l.size,picking:a.picking},this.getBufferParams()))}}),t.getSelection()),{bufferList:e,polymerList:n}}updateData(t,e){t=t||{};var n=0,i=e.polymerList.length;for(n=0;n<i;++n){var r={},s=new cv(e.polymerList[n],this.getSplineParams());if(t.position){var o=s.getSubdividedPosition(),a=s.getSubdividedOrientation();Object.assign(r,{position:o.position,normal:a.binormal,dir:a.normal})}if(t.radius||t.scale){var l=s.getSubdividedSize(this.getRadiusParams());Object.assign(r,{size:l.size})}if(t.color){var c=s.getSubdividedColor(this.getColorParams());Object.assign(r,{color:c.color})}e.bufferList[n].setAttributes(r)}}setParameters(t){var e={};return t&&t.tension&&Object.assign(e,{position:!0}),super.setParameters(t,e,!1),this}}sc.add("ribbon",Yv);class Kv extends E_{constructor(t,e,n){super(t,e,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(t){let e=t||{};e.colorScheme=Aa(e.colorScheme,"sstruc"),e.radiusSize=Aa(e.radiusSize,1.5),e.radiusScale=Aa(e.radiusScale,1),e.openEnded=Aa(e.openEnded,!1),e.useInteriorColor=Aa(e.useInteriorColor,!0),this.localAngle=Aa(e.localAngle,30),this.centerDist=Aa(e.centerDist,2.5),this.ssBorder=Aa(e.ssBorder,!1),super.init(e)}createData(t){let e=0;const n=[],i=[];this.structure.eachPolymer((t=>{if(t.residueCount<4||t.isNucleic())return;const r=new Bf(t),s=r.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e+=s.size.length,n.push(s),i.push(r)}),t.getSelection());const r={begin:new Float32Array(3*e),end:new Float32Array(3*e),size:new Float32Array(e),color:new Float32Array(3*e),picking:{}};let s=new Float32Array(e),o=0;return n.forEach((function(t){r.begin.set(t.begin,3*o),r.end.set(t.end,3*o),r.size.set(t.size,o),r.color.set(t.color,3*o),s.set(t.picking.array,o),o+=t.size.length})),e&&(r.picking=new cp(s,t.getStructure())),{bufferList:[new iv({position1:r.begin,position2:r.end,color:r.color,color2:r.color,radius:r.size,picking:r.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:i,axisData:r}}updateData(t,e){if((t=t||{}).position)this.build();else{var n={};if(t.color||t.radius){var i=0;e.helixbundleList.forEach((n=>{var r=n.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t.color&&e.axisData.color.set(r.color,3*i),(t.radius||t.scale)&&e.axisData.size.set(r.size,i),i+=r.size.length})),t.color&&Object.assign(n,{color:e.axisData.color,color2:e.axisData.color}),(t.radius||t.scale)&&Object.assign(n,{radius:e.axisData.size})}e.bufferList[0].setAttributes(n)}}}sc.add("rocket",Kv);class Zv extends fv{constructor(t,e,n){super(t,e,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(t){var e=t||{};e.aspectRatio=1,e.tension=Aa(e.tension,.5),e.radiusScale=Aa(e.radiusScale,5),e.smoothSheet=!1,this.smooth=Aa(e.smooth,2),super.init(e)}getSpline(t){var e=new Ff(t);return new cv(t,this.getSplineParams({directional:!1,positionIterator:e.getCenterIterator(this.smooth)}))}}sc.add("rope",Zv);class Qv extends E_{constructor(t,e,n){super(t,e,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(t){var e=t||{};e.useInteriorColor=Aa(e.useInteriorColor,!0),super.init(e)}createData(t){return{bufferList:[new tg(t.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(t,e){var n=e.sview.getAtomData(this.getAtomParams(t)),i={};t&&!t.position||Object.assign(i,{position:n.position}),t&&!t.color||Object.assign(i,{color:n.color}),t&&!t.radius||Object.assign(i,{radius:n.radius}),e.bufferList[0].setAttributes(i)}}function Jv(t){return 3*(t.position.length/3-1)*2}sc.add("spacefill",Qv);class ty extends Jp{constructor(t,e={}){super({position:new Float32Array(Jv(t)),color:new Float32Array(Jv(t))},e),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(t)}setAttributes(t){let e,n,i,r;const s=this.geometry.attributes;if(t.position&&(e=t.position,i=s.position.array,s.position.needsUpdate=!0),t.color&&(n=t.color,r=s.color.array,s.color.needsUpdate=!0),!e&&!n)return void Yl.warn("TraceBuffer.prototype.setAttributes no data");let o,a;const l=this.size-1;for(let t=0;t<l;++t)o=3*t,a=3*t*2,e&&(i[a]=e[o],i[a+1]=e[o+1],i[a+2]=e[o+2],i[a+3]=e[o+3],i[a+4]=e[o+4],i[a+5]=e[o+5]),n&&(r[a]=n[o],r[a+1]=n[o+1],r[a+2]=n[o+2],r[a+3]=n[o+3],r[a+4]=n[o+4],r[a+5]=n[o+5])}}class ey extends E_{constructor(t,e,n){super(t,e,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(t){var e=t||{};e.colorScheme=Aa(e.colorScheme,"chainname"),e.colorScale=Aa(e.colorScale,"RdYlBu"),"low"===e.quality?this.subdiv=3:"medium"===e.quality?this.subdiv=6:"high"===e.quality?this.subdiv=12:this.subdiv=Aa(e.subdiv,6),this.tension=Aa(e.tension,NaN),this.smoothSheet=Aa(e.smoothSheet,!1),super.init(e)}getSplineParams(t){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},t)}getAtomRadius(t){return t.isTrace()?.1:0}createData(t){var e=[],n=[];return this.structure.eachPolymer((t=>{if(!(t.residueCount<4)){n.push(t);var i=new cv(t,this.getSplineParams()),r=i.getSubdividedPosition(),s=i.getSubdividedColor(this.getColorParams());e.push(new ty(Object.assign({},r,s),this.getBufferParams()))}}),t.getSelection()),{bufferList:e,polymerList:n}}updateData(t,e){t=t||{};var n=0,i=e.polymerList.length;for(n=0;n<i;++n){var r={},s=new cv(e.polymerList[n],this.getSplineParams());if(t.position){var o=s.getSubdividedPosition();Object.assign(r,{position:o.position})}if(t.color){var a=s.getSubdividedColor(this.getColorParams());Object.assign(r,{color:a.color})}e.bufferList[n].setAttributes(r)}}setParameters(t){var e={};return t&&t.tension&&Object.assign(e,{position:!0}),super.setParameters(t,e,!1),this}}sc.add("trace",ey);class ny extends fv{constructor(t,e,n){super(t,e,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(t){var e=t||{};e.aspectRatio=1,e.radiusScale=Aa(e.radiusScale,2),"low"===e.quality&&(this.radialSegments=5),super.init(e)}getSplineParams(){return super.getSplineParams({directional:!1})}}sc.add("tube",ny);class iy extends E_{constructor(t,e,n){super(t,e,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(t){const e=t||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),e.radiusSize=Aa(e.radiusSize,n),e.colorValue=Aa(e.colorValue,"orange"),e.useInteriorColor=Aa(e.useInteriorColor,!0),super.init(e)}getUnitcellData(t){return t.unitcell.getData(t)}create(){const t=this.structureView.getStructure();if(!t.unitcell)return;const e=this.getUnitcellData(t);this.sphereBuffer=new tg(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new iv(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(t){}updateData(t,e){const n=e.sview.getStructure();if(!n.unitcell)return;const i=this.getUnitcellData(n),r={},s={};t&&!t.position||(Object.assign(r,{position:i.vertex.position}),Object.assign(s,{position1:i.edge.position1,position2:i.edge.position2})),t&&!t.color||(Object.assign(r,{color:i.vertex.color}),Object.assign(s,{color:i.edge.color,color2:i.edge.color2})),t&&!t.radius||(Object.assign(r,{radius:i.vertex.radius}),Object.assign(s,{radius:i.edge.radius})),this.sphereBuffer.setAttributes(r),this.cylinderBuffer.setAttributes(s)}}sc.add("unitcell",iy);class ry extends E_{constructor(t,e,n){super(t,e,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(t){const e=t||{};e.colorValue=Aa(e.colorValue,"#f0027f"),e.useInteriorColor=Aa(e.useInteriorColor,!0),super.init(e)}createData(t){if(!t.validation)return;const e=t.validation.getClashData({structure:t,color:this.colorValue});return{bufferList:[new iv(e,this.getBufferParams({openEnded:!1}))]}}}sc.add("validation",ry);const sy=new ue,oy=new ue,ay=new ue,ly=new ue(0,1,0),cy=Object.assign({radialSegments:60,openEnded:!1},Zp);class uy extends jm{constructor(t,e={}){super({position:new Float32Array(t.position1.length),color:t.color,picking:t.picking},e,function(t={}){const e=new Oo(1,1,Aa(t.radialSegments,60),1,Aa(t.openEnded,!1));return e.applyMatrix4((new ze).makeRotationX(-Math.PI/2)),e}(e)),this.updateNormals=!0,this._position=new Float32Array(t.position1.length),this.setAttributes(t,!0)}get defaultParameters(){return cy}applyPositionTransform(t,e,n){oy.fromArray(this._position1,n),ay.fromArray(this._position2,n),t.lookAt(oy,ay,ly);const i=this._radius[e];sy.set(i,i,oy.distanceTo(ay)),t.scale(sy)}setAttributes(t={},e){t.position1&&t.position2&&(Hc(t.position1,t.position2,this._position),this._position1=t.position1,this._position2=t.position2,t.position=this._position),t.radius&&(this._radius=t.radius),super.setAttributes(t,e)}}uc.add("cone",uy);class hy{constructor(t=[]){this.geometryList=t}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new pe,this.geometryList.forEach((t=>{t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox)}))}}const dy=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},Zp);class py{constructor(t,e={}){this.group=new ro,this.wireframeGroup=new ro,this.pickingGroup=new ro,this.visible=!0,this.parameters=Ma(e,this.defaultParameters),this.splitPosition=new Float32Array(t.position1.length),this.cylinderRadius=new Float32Array(t.radius.length);const n=this.makeAttributes(t),i={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new iv(n.cylinder,i),this.coneBuffer=new uy(n.cone,i),this.geometry=new hy([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=Aa(e.matrix,new ze),this.picking=t.picking}get defaultParameters(){return dy}set matrix(t){Jp.prototype.setMatrix.call(this,t)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(t={}){const e=this.splitPosition,n=this.cylinderRadius,i=this.parameters.aspectRatio;let r,s;const o={},a={};if(t.radius){for(r=0,s=n.length;r<s;++r)n[r]=t.radius[r]/i;o.radius=n,a.radius=t.radius}if(t.position1&&t.position2){const l=new ue,c=new ue,u=new ue,h=new ue;for(r=0,s=e.length;r<s;r+=3){l.fromArray(t.position1,r),c.fromArray(t.position2,r),u.subVectors(l,c);const s=u.length(),o=n[r/3]*i*2,a=Math.min(s,o);u.setLength(a),h.copy(c).add(u),h.toArray(e,r)}o.position1=t.position1,o.position2=e,a.position1=e,a.position2=t.position2}return t.color&&(o.color=t.color,o.color2=t.color,a.color=t.color),{cylinder:o,cone:a}}getMesh(){return(new ro).add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return(new ro).add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return(new ro).add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(t={}){const e=this.makeAttributes(t);this.cylinderBuffer.setAttributes(e.cylinder),this.coneBuffer.setAttributes(e.cone)}setParameters(t={}){(t=Object.assign({},t))&&void 0!==t.matrix&&(this.matrix=t.matrix),delete t.matrix,t&&void 0!==t.wireframe&&(this.parameters.wireframe=t.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(t),this.coneBuffer.setParameters(t)}setVisibility(t){Jp.prototype.setVisibility.call(this,t)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}uc.add("arrow",py);const fy=new ue,my=new ue,gy=new ue,_y=new ue(0,0,0);class vy extends jm{constructor(t,e={}){super(t,e,new pi(1,1,1)),this.updateNormals=!0,this.setAttributes(t,!0)}applyPositionTransform(t,e,n){my.fromArray(this._heightAxis,n),gy.fromArray(this._depthAxis,n),t.lookAt(_y,my,gy),fy.set(this._size[e],gy.length(),my.length()),t.scale(fy)}setAttributes(t={},e){t.size&&(this._size=t.size),t.heightAxis&&(this._heightAxis=t.heightAxis),t.depthAxis&&(this._depthAxis=t.depthAxis),super.setAttributes(t,e)}}uc.add("box",vy);const yy=new ue,by=new ue,xy=new ue,wy=new ue(0,0,0),Sy=Object.assign({sphereDetail:2},Zp);class Ay extends jm{constructor(t,e={}){super(t,e,new Fo(1,Aa(e.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(t,!0)}get defaultParameters(){return Sy}applyPositionTransform(t,e,n){by.fromArray(this._majorAxis,n),xy.fromArray(this._minorAxis,n),t.lookAt(wy,by,xy),yy.set(this._radius[e],xy.length(),by.length()),t.scale(yy)}setAttributes(t={},e){t.radius&&(this._radius=t.radius),t.majorAxis&&(this._majorAxis=t.majorAxis),t.minorAxis&&(this._minorAxis=t.minorAxis),super.setAttributes(t,e)}}uc.add("ellipsoid",Ay);const My=new ue,Cy=new ue,Ey=new ue,Ty=new ue(0,0,0);class Py extends jm{constructor(t,e={}){super(t,e,new Bo(1,0)),this.updateNormals=!0,this.setAttributes(t,!0)}applyPositionTransform(t,e,n){Cy.fromArray(this._heightAxis,n),Ey.fromArray(this._depthAxis,n),t.lookAt(Ty,Cy,Ey),My.set(this._size[e],Ey.length(),Cy.length()),t.scale(My)}setAttributes(t={},e){t.size&&(this._size=t.size),t.heightAxis&&(this._heightAxis=t.heightAxis),t.depthAxis&&(this._depthAxis=t.depthAxis),super.setAttributes(t,e)}}uc.add("octahedron",Py);const Iy=new ue,Ry=new ue,ky=new ue,Dy=new ue(0,0,0);class Ly extends jm{constructor(t,e={}){super(t,e,new Uo(1,0)),this.updateNormals=!0,this.setAttributes(t,!0)}applyPositionTransform(t,e,n){Ry.fromArray(this._heightAxis,n),ky.fromArray(this._depthAxis,n),t.lookAt(Dy,Ry,ky),Iy.set(this._size[e],ky.length(),Ry.length()),t.scale(Iy)}setAttributes(t={},e){t.size&&(this._size=t.size),t.heightAxis&&(this._heightAxis=t.heightAxis),t.depthAxis&&(this._depthAxis=t.depthAxis),super.setAttributes(t,e)}}uc.add("tetrahedron",Ly);const Oy=new ue,Ny=new ue,Fy=new ue,By=new ue(0,0,0),Uy=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},Zp);class zy extends jm{constructor(t,e={}){super(t,e,new zo(1,Aa(e.radiusRatio,.2),Aa(e.radialSegments,16),Aa(e.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(t,!0)}get defaultParameters(){return Uy}applyPositionTransform(t,e,n){Ny.fromArray(this._majorAxis,n),Fy.fromArray(this._minorAxis,n),t.lookAt(By,Ny,Fy);const i=this._radius[e];Oy.set(i,i,i),t.scale(Oy)}setAttributes(t={},e){t.radius&&(this._radius=t.radius),t.majorAxis&&(this._majorAxis=t.majorAxis),t.minorAxis&&(this._minorAxis=t.minorAxis),super.setAttributes(t,e)}}function Vy(t,e){return{start:e&&void 0!==e.start?Math.max(Math.min(e.start,t-1),0):0,end:e&&void 0!==e.end?Math.min(e.end,t):t}}function Hy(t,e){const n=e&&void 0!==e.array?e.array:Array,{start:i,end:r}=Vy(t,e);return{array:new n(r-i),start:i,end:r}}function Gy(t,e,n){const{array:i,start:r}=Hy(t,n);return function(t,e,n){for(let i=0,r=e.length;i<r;i++)e[i]=t(n+i);return e}(e,i,r)}function $y(t){return!!t.buffer&&"number"==typeof t.byteLength&&"number"==typeof t.BYTES_PER_ELEMENT}function jy(t,e){const{constructor:n,buffer:i,length:r,byteOffset:s,BYTES_PER_ELEMENT:o}=t,{start:a,end:l}=Vy(r,e);return 0===a&&l===r?t:new n(i,s+o*a,Math.min(r,l-a))}uc.add("torus",zy);const Wy=1e-6;function qy(t,e,n){return Math.abs(t-e)<=n}function Xy(t,e,n){return Math.max(e,Math.min(n,t))}function Yy(t,e,n,i,r,s){const o=(n-t)*s,a=(i-e)*s,l=r*r;return(2*e-2*n+o+a)*(r*l)+(-3*e+3*n-2*o-a)*l+o*r+e}function Ky(t,e,n,i){const r=1-i;return r*r*t+2*r*i*e+i*i*n}const Zy=isFinite;function Qy(){return Qy.zero()}!function(t){function e(){const t=[.1,0,0];return t[0]=0,t}function n(t,n,i){const r=e();return r[0]=t,r[1]=n,r[2]=i,r}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function r(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function s(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function o(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function a(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function l(t){const e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function c(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function u(t,e){const n=e[0],i=e[1],r=e[2];let s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function h(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function d(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}t.zero=e,t.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},t.isFinite=function(t){return Zy(t[0])&&Zy(t[1])&&Zy(t[2])},t.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])},t.setNaN=function(t){return t[0]=NaN,t[1]=NaN,t[2]=NaN,t},t.fromObj=function(t){return n(t.x,t.y,t.z)},t.toObj=function(t){return{x:t[0],y:t[1],z:t[2]}},t.fromArray=function(t,e,n){return t[0]=e[n+0],t[1]=e[n+1],t[2]=e[n+2],t},t.toArray=function(t,e,n){return e[n+0]=t[0],e[n+1]=t[1],e[n+2]=t[2],e},t.create=n,t.ofArray=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},t.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},t.copy=i,t.add=r,t.sub=s,t.mul=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},t.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},t.scale=o,t.scaleAndAdd=a,t.scaleAndSub=function(t,e,n,i){return t[0]=e[0]-n[0]*i,t[1]=e[1]-n[1]*i,t[2]=e[2]-n[2]*i,t},t.addScalar=function(t,e,n){return t[0]=e[0]+n,t[1]=e[1]+n,t[2]=e[2]+n,t},t.subScalar=function(t,e,n){return t[0]=e[0]-n,t[1]=e[1]-n,t[2]=e[2]-n,t},t.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},t.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},t.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},t.trunc=function(t,e){return t[0]=Math.trunc(e[0]),t[1]=Math.trunc(e[1]),t[2]=Math.trunc(e[2]),t},t.abs=function(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t},t.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},t.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},t.clamp=function(t,e,n,i){return t[0]=Math.max(n[0],Math.min(i[0],e[0])),t[1]=Math.max(n[1],Math.min(i[1],e[1])),t[2]=Math.max(n[2],Math.min(i[2],e[2])),t},t.distance=function(t,e){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)},t.squaredDistance=function(t,e){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r},t.magnitude=function(t){const e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)},t.squaredMagnitude=l,t.setMagnitude=function(t,e,n){return o(t,u(t,e),n)},t.negate=c,t.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},t.normalize=u,t.dot=h,t.cross=d,t.lerp=function(t,e,n,i){const r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t};const p=e();function f(t,e){const n=Math.sqrt(l(t)*l(e));if(0===n)return Math.PI/2;const i=h(t,e)/n;return Math.acos(Xy(i,-1,1))}t.slerp=function(t,e,n,i){const s=Xy(h(e,n),-1,1),l=Math.acos(s)*i;return a(p,n,e,-s),u(p,p),r(t,o(t,e,Math.cos(l)),o(p,p,Math.sin(l)))},t.hermite=function(t,e,n,i,r,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+n[0]*l+i[0]*c+r[0]*u,t[1]=e[1]*a+n[1]*l+i[1]*c+r[1]*u,t[2]=e[2]*a+n[2]*l+i[2]*c+r[2]*u,t},t.bezier=function(t,e,n,i,r,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,d=l*s;return t[0]=e[0]*c+n[0]*u+i[0]*h+r[0]*d,t[1]=e[1]*c+n[1]*u+i[1]*h+r[1]*d,t[2]=e[2]*c+n[2]*u+i[2]*h+r[2]*d,t},t.quadraticBezier=function(t,e,n,i,r){return t[0]=Ky(e[0],n[0],i[0],r),t[1]=Ky(e[1],n[1],i[1],r),t[2]=Ky(e[2],n[2],i[2],r),t},t.spline=function(t,e,n,i,r,s,o){return t[0]=Yy(e[0],n[0],i[0],r[0],s,o),t[1]=Yy(e[1],n[1],i[1],r[1],s,o),t[2]=Yy(e[2],n[2],i[2],r[2],s,o),t},t.random=function(t,e){const n=2*Math.random()*Math.PI,i=2*Math.random()-1,r=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=i*e,t},t.transformMat4=function(t,e,n){const i=e[0],r=e[1],s=e[2],o=1/(n[3]*i+n[7]*r+n[11]*s+n[15]||1);return t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])*o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])*o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])*o,t},t.transformDirection=function(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=n[0]*i+n[4]*r+n[8]*s,t[1]=n[1]*i+n[5]*r+n[9]*s,t[2]=n[2]*i+n[6]*r+n[10]*s,u(t,t)},t.transformMat4Offset=function(t,e,n,i,r,s){const o=e[0+r],a=e[1+r],l=e[2+r],c=1/(n[3+s]*o+n[7+s]*a+n[11+s]*l+n[15+s]||1);return t[0+i]=(n[0+s]*o+n[4+s]*a+n[8+s]*l+n[12+s])*c,t[1+i]=(n[1+s]*o+n[5+s]*a+n[9+s]*l+n[13+s])*c,t[2+i]=(n[2+s]*o+n[6+s]*a+n[10+s]*l+n[14+s])*c,t},t.transformDirectionOffset=function(t,e,n,i,r,s){const o=e[0+r],a=e[1+r],l=e[2+r];t[0+i]=n[0+s]*o+n[4+s]*a+n[8+s]*l,t[1+i]=n[1+s]*o+n[5+s]*a+n[9+s]*l,t[2+i]=n[2+s]*o+n[6+s]*a+n[10+s]*l;const c=Math.hypot(t[0+i],t[1+i],t[2+i]);return c>0&&(t[0+i]/=c,t[1+i]/=c,t[2+i]/=c),t},t.transformMat3=function(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t},t.transformQuat=function(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,h=c*r+l*i-o*s,d=c*s+o*r-a*i,p=-o*i-a*r-l*s;return t[0]=u*c+p*-o+h*-l-d*-a,t[1]=h*c+p*-a+d*-o-u*-l,t[2]=d*c+p*-l+u*-a-h*-o,t},t.angle=f;const m=e(),g=e(),_=e(),v=e(),y=e(),b=e(),x=e();t.dihedralAngle=function(t,e,n,i){s(m,t,e),s(g,n,e),s(_,e,n),s(v,i,n),d(y,m,g),d(b,_,v);const r=f(y,b);return d(x,y,b),h(g,x)>0?r:-r},t.directionFromSpherical=function(e,n,i,r){return t.set(e,r*Math.cos(i)*Math.sin(n),r*Math.sin(i)*Math.sin(n),r*Math.cos(n))},t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.equals=function(t,e){const n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2];return Math.abs(n-s)<=Wy*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=Wy*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Wy*Math.max(1,Math.abs(r),Math.abs(a))};const w=e();t.makeRotation=function(e,n,i){const r=f(n,i);if(Math.abs(r)<1e-4)return eb.setIdentity(e);if(Math.abs(r-Math.PI)<Wy)return eb.fromScaling(e,t.negUnit);const s=d(w,n,i);return eb.fromRotation(e,r,s)},t.isZero=function(t){return 0===t[0]&&0===t[1]&&0===t[2]},t.projectPointOnVector=function(t,e,n,i){return s(t,e,i),r(t,o(t,n,h(n,t)/l(n)),i)};const S=e();function A(t,e,n){return o(t,n,h(n,e)/l(n))}t.projectPointOnPlane=function(t,e,n,i){return u(S,n),s(t,e,i),s(t,e,o(S,S,h(t,S)))},t.projectOnVector=A;const M=e();t.projectOnPlane=function(t,e,n){return A(M,e,n),s(t,e,M)},t.orthogonalize=function(t,e,n){return u(t,d(t,d(t,e,n),e))},t.matchDirection=function(t,e,n){return h(e,n)>0?i(t,e):c(t,i(t,e)),t};const C=e(),E=e();t.triangleNormal=function(t,e,n,i){return s(C,n,e),s(E,i,e),u(t,d(t,C,E))},t.toString=function(t,e){return`[${t[0].toPrecision(e)} ${t[1].toPrecision(e)} ${t[2].toPrecision(e)}]`},t.origin=n(0,0,0),t.unit=n(1,1,1),t.negUnit=n(-1,-1,-1),t.unitX=n(1,0,0),t.unitY=n(0,1,0),t.unitZ=n(0,0,1),t.negUnitX=n(-1,0,0),t.negUnitY=n(0,-1,0),t.negUnitZ=n(0,0,-1)}(Qy||(Qy={}));const Jy=Math.PI/180;function tb(t){return t*Jy}function eb(){return eb.zero()}function nb(){return nb.zero()}function ib(){return ib.zero()}function rb(){return rb.zero()}function sb(t){throw new Error("unreachable")}function ob(){return ob.zero()}var ab,lb,cb,ub;function hb(t,e,n){let i=e,r=0,s=1;for(45===t.charCodeAt(i)?(s=-1,++i):43===t.charCodeAt(i)&&++i;i<n;i++){const e=t.charCodeAt(i)-48;if(e>9||e<0)return s*r|0;r=10*r+e|0}return s*r}function db(t,e,n,i){return 43===e.charCodeAt(n)&&n++,t*Math.pow(10,hb(e,n,i))}function pb(t,e,n){let i=e,r=1,s=0,o=0,a=1;for(45===t.charCodeAt(i)?(r=-1,++i):43===t.charCodeAt(i)&&++i;i<n;){let e=t.charCodeAt(i)-48;if(!(e>=0&&e<10)){if(-2===e){for(++i;i<n;){if(e=t.charCodeAt(i)-48,!(e>=0&&e<10))return 53===e||21===e?db(r*(s+o/a),t,i+1,n):r*(s+o/a);o=10*o+e,a*=10,++i}return r*(s+o/a)}if(53===e||21===e)return db(r*s,t,i+1,n);break}s=10*s+e,++i}return r*s}function fb(t,e,n,i){return{schema:n,__array:void 0,isDefined:0===i,rowCount:e,value:e=>t,valueKind:t=>i,toArray:n=>{const{array:i}=Hy(e,n);for(let e=0,n=i.length;e<n;e++)i[e]=t;return i},areValuesEqual:(t,e)=>!0}}function mb({value:t,valueKind:e,areValuesEqual:n,rowCount:i,schema:r}){return{schema:r,__array:void 0,isDefined:!0,rowCount:i,value:t,valueKind:e||(t=>0),toArray:e=>{const{array:n,start:r}=Hy(i,e);for(let e=0,i=n.length;e<i;e++)n[e]=t(e+r);return n},areValuesEqual:n||((e,n)=>t(e)===t(n))}}function gb({array:t,schema:e,valueKind:n}){const i=t.length,r=e.T,s="str"===e.valueType?"lowercase"===e.transform?e=>{const n=t[e];return"string"==typeof n?n.toLowerCase():`${null!=n?n:r}`.toLowerCase()}:"uppercase"===e.transform?e=>{const n=t[e];return"string"==typeof n?n.toUpperCase():`${null!=n?n:r}`.toUpperCase()}:e=>{const n=t[e];return"string"==typeof n?n:`${null!=n?n:r}`}:e=>t[e],o=$y(t);return{schema:e,__array:t,isDefined:!0,rowCount:i,value:s,valueKind:n||(t=>0),toArray:"str"===e.valueType?"lowercase"===e.transform?e=>{const{start:n,end:s}=Vy(i,e),o=new(e&&void 0!==e.array?e.array:t.constructor)(s-n);for(let e=0,i=s-n;e<i;e++){const i=t[n+e];o[e]="string"==typeof i?i.toLowerCase():`${null!=i?i:r}`.toLowerCase()}return o}:"uppercase"===e.transform?e=>{const{start:n,end:s}=Vy(i,e),o=new(e&&void 0!==e.array?e.array:t.constructor)(s-n);for(let e=0,i=s-n;e<i;e++){const i=t[n+e];o[e]="string"==typeof i?i.toUpperCase():`${null!=i?i:r}`.toUpperCase()}return o}:e=>{const{start:n,end:s}=Vy(i,e),o=new(e&&void 0!==e.array?e.array:t.constructor)(s-n);for(let e=0,i=s-n;e<i;e++){const i=t[n+e];o[e]="string"==typeof i?i:`${null!=i?i:r}`}return o}:o?e=>jy(t,e):e=>{const{start:n,end:r}=Vy(i,e);if(0===n&&r===t.length)return t;const s=new(e&&void 0!==e.array?e.array:t.constructor)(r-n);for(let e=0,i=r-n;e<i;e++)s[e]=t[n+e];return s},areValuesEqual:(e,n)=>t[e]===t[n]}}function _b(t,e,n){return t[e]-t[n]}function vb(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function yb(t,e,n,i){const r=n+i>>1;return e(t,n,i)>0?e(t,n,r)>0?e(t,r,i)>0?r:i:n:e(t,i,r)>0?e(t,r,n)>0?r:n:i}function bb(t,e,n){const{cmp:i,swap:r,data:s,parts:o}=t;let a=e+1,l=n;for(r(s,e,yb(s,i,e,n));i(s,l,e)>0;)--l;for(let t=e+1;t<=l;t++){const n=i(s,t,e);if(n>0){for(r(s,t,l),--l;i(s,l,e)>0;)--l;t--}else 0===n&&(r(s,t,a),a++)}for(let t=e;t<a;t++)r(s,t,e+l-t);o[0]=l-a+e+1,o[1]=l}function xb({data:t,cmp:e,swap:n},i,r){for(let s=i+1;s<=r;s++){let r=s-1;for(;r>=i&&e(t,r,r+1)>0;)n(t,r,r+1),r-=1}}function wb(t,e,n){const{parts:i}=t;for(;e<n;){if(n-e<16)return void xb(t,e,n);bb(t,e,n);const r=i[0],s=i[1];r-e<n-s?(wb(t,e,r-1),e=s+1):(wb(t,s+1,n),n=r-1)}}function Sb(t,e,n,i){let r=n+1,s=i;vb(t,n,yb(t,_b,n,i));const o=t[n];for(;t[s]>o;)--s;for(let e=n+1;e<=s;e++){const n=t[e];if(n>o){for(vb(t,e,s),--s;t[s]>o;)--s;e--}else n===o&&(vb(t,e,r),++r)}for(let e=n;e<r;e++)vb(t,e,n+s-e);e[0]=s-r+n+1,e[1]=s}function Ab(t,e,n){for(let i=e+1;i<=n;i++){const n=t[i];let r=i-1;for(;r>=e&&t[r]>n;)t[r+1]=t[r],r-=1;t[r+1]=n}}function Mb(t,e,n,i){for(;n<i;){if(i-n<16)return void Ab(t,n,i);Sb(t,e,n,i);const r=e[0],s=e[1];r-n<i-s?(Mb(t,e,n,r-1),n=s+1):(Mb(t,e,s+1,i),i=r-1)}}function Cb(t,e=_b){return function(t,e,n,i=_b){return i===_b?Mb(t,[0,0],e,n-1):wb({data:t,cmp:i,swap:vb,parts:[0,0]},e,n-1),t}(t,0,t.length,e)}!function(t){function e(){const t=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return t[0]=0,t}function n(){const t=e();return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function r(t){for(let e=0;e<16;e++)t[e]=0;return t}t.zero=e,t.identity=n,t.setIdentity=i,t.setZero=r,t.ofRows=function(t){const n=e();for(let e=0;e<4;e++){const i=t[e];for(let t=0;t<4;t++)n[4*t+e]=i[t]}return n};const s=n();function o(t,e,n){for(let i=0;i<16;i++)if(Math.abs(t[i]-e[i])>n)return!1;return!0}function a(t,e,n,i){t[4*n+e]=i}function l(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(t,e){const n=e[0]+e[5]+e[10];let i=0;return n>0?(i=2*Math.sqrt(n+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function u(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],v=n*a-i*o,y=n*l-r*o,b=n*c-s*o,x=i*l-r*a,w=i*c-s*a,S=r*c-s*l,A=u*m-h*f,M=u*g-d*f,C=u*_-p*f,E=h*g-d*m,T=h*_-p*m,P=d*_-p*g;let I=v*P-y*T+b*E+x*C-w*M+S*A;return!!I&&(I=1/I,t[0]=(a*P-l*T+c*E)*I,t[1]=(r*T-i*P-s*E)*I,t[2]=(m*S-g*w+_*x)*I,t[3]=(d*w-h*S-p*x)*I,t[4]=(l*C-o*P-c*M)*I,t[5]=(n*P-r*C+s*M)*I,t[6]=(g*b-f*S-_*y)*I,t[7]=(u*S-d*b+p*y)*I,t[8]=(o*T-a*C+c*A)*I,t[9]=(i*C-n*T-s*A)*I,t[10]=(f*w-m*b+_*v)*I,t[11]=(h*b-u*w-p*v)*I,t[12]=(a*M-o*E-l*A)*I,t[13]=(n*E-i*M+r*A)*I,t[14]=(m*y-f*x-g*v)*I,t[15]=(u*x-h*y+d*v)*I,!0)}function h(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],_=e[14],v=e[15];let y=n[0],b=n[1],x=n[2],w=n[3];return t[0]=y*i+b*a+x*h+w*m,t[1]=y*r+b*l+x*d+w*g,t[2]=y*s+b*c+x*p+w*_,t[3]=y*o+b*u+x*f+w*v,y=n[4],b=n[5],x=n[6],w=n[7],t[4]=y*i+b*a+x*h+w*m,t[5]=y*r+b*l+x*d+w*g,t[6]=y*s+b*c+x*p+w*_,t[7]=y*o+b*u+x*f+w*v,y=n[8],b=n[9],x=n[10],w=n[11],t[8]=y*i+b*a+x*h+w*m,t[9]=y*r+b*l+x*d+w*g,t[10]=y*s+b*c+x*p+w*_,t[11]=y*o+b*u+x*f+w*v,y=n[12],b=n[13],x=n[14],w=n[15],t[12]=y*i+b*a+x*h+w*m,t[13]=y*r+b*l+x*d+w*g,t[14]=y*s+b*c+x*p+w*_,t[15]=y*o+b*u+x*f+w*v,t}function d(t,e,n){let r=n[0],s=n[1],o=n[2],a=Math.sqrt(r*r+s*s+o*o);if(Math.abs(a)<Wy)return i(t);a=1/a,r*=a,s*=a,o*=a;const l=Math.sin(e),c=Math.cos(e),u=1-c;return t[0]=r*r*u+c,t[1]=s*r*u+o*l,t[2]=o*r*u-s*l,t[3]=0,t[4]=r*s*u-o*l,t[5]=s*s*u+c,t[6]=o*s*u+r*l,t[7]=0,t[8]=r*o*u+s*l,t[9]=s*o*u-r*l,t[10]=o*o*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}t.isIdentity=function(t,e){return o(t,s,void 0===e?Wy:e)},t.hasNaN=function(t){for(let e=0;e<16;e++)if(isNaN(t[e]))return!0;return!1},t.areEqual=o,t.setValue=a,t.getValue=function(t,e,n){return t[4*n+e]},t.toArray=function(t,e,n){return e[n+0]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=t[3],e[n+4]=t[4],e[n+5]=t[5],e[n+6]=t[6],e[n+7]=t[7],e[n+8]=t[8],e[n+9]=t[9],e[n+10]=t[10],e[n+11]=t[11],e[n+12]=t[12],e[n+13]=t[13],e[n+14]=t[14],e[n+15]=t[15],e},t.fromArray=function(t,e,n){return t[0]=e[n+0],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],t[4]=e[n+4],t[5]=e[n+5],t[6]=e[n+6],t[7]=e[n+7],t[8]=e[n+8],t[9]=e[n+9],t[10]=e[n+10],t[11]=e[n+11],t[12]=e[n+12],t[13]=e[n+13],t[14]=e[n+14],t[15]=e[n+15],t},t.fromBasis=function(t,e,n,i){return r(t),a(t,0,0,e[0]),a(t,1,0,e[1]),a(t,2,0,e[2]),a(t,0,1,n[0]),a(t,1,1,n[1]),a(t,2,1,n[2]),a(t,0,2,i[0]),a(t,1,2,i[1]),a(t,2,2,i[2]),a(t,3,3,1),t},t.copy=l,t.clone=function(t){return l(e(),t)},t.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.getScaling=function(t,e){const n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(n*n+i*i+r*r),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t},t.getRotation=c,t.extractRotation=function(t,e){const n=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=1/Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=1/Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=0,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=0,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.transpose=function(t,e){if(t===e){const n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},t.tryInvert=u,t.invert=function(t,e){return u(t,e)||console.warn("non-invertible matrix.",e),t},t.mul=h,t.mulOffset=function(t,e,n,i,r,s){const o=e[0+r],a=e[1+r],l=e[2+r],c=e[3+r],u=e[4+r],h=e[5+r],d=e[6+r],p=e[7+r],f=e[8+r],m=e[9+r],g=e[10+r],_=e[11+r],v=e[12+r],y=e[13+r],b=e[14+r],x=e[15+r];let w=n[0+s],S=n[1+s],A=n[2+s],M=n[3+s];return t[0+i]=w*o+S*u+A*f+M*v,t[1+i]=w*a+S*h+A*m+M*y,t[2+i]=w*l+S*d+A*g+M*b,t[3+i]=w*c+S*p+A*_+M*x,w=n[4+s],S=n[5+s],A=n[6+s],M=n[7+s],t[4+i]=w*o+S*u+A*f+M*v,t[5+i]=w*a+S*h+A*m+M*y,t[6+i]=w*l+S*d+A*g+M*b,t[7+i]=w*c+S*p+A*_+M*x,w=n[8+s],S=n[9+s],A=n[10+s],M=n[11+s],t[8+i]=w*o+S*u+A*f+M*v,t[9+i]=w*a+S*h+A*m+M*y,t[10+i]=w*l+S*d+A*g+M*b,t[11+i]=w*c+S*p+A*_+M*x,w=n[12+s],S=n[13+s],A=n[14+s],M=n[15+s],t[12+i]=w*o+S*u+A*f+M*v,t[13+i]=w*a+S*h+A*m+M*y,t[14+i]=w*l+S*d+A*g+M*b,t[15+i]=w*c+S*p+A*_+M*x,t},t.mul3=function(t,e,n,i){return h(t,h(t,e,n),i)},t.translate=function(t,e,n){const i=n[0],r=n[1],s=n[2];let o,a,l,c,u,h,d,p,f,m,g,_;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],d=e[6],p=e[7],f=e[8],m=e[9],g=e[10],_=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=d,t[7]=p,t[8]=f,t[9]=m,t[10]=g,t[11]=_,t[12]=o*i+u*r+f*s+e[12],t[13]=a*i+h*r+m*s+e[13],t[14]=l*i+d*r+g*s+e[14],t[15]=c*i+p*r+_*s+e[15]),t},t.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},t.setTranslation=function(t,e){return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},t.setAxes=function(t,e,n,i){return t[0]=n[0],t[4]=n[1],t[8]=n[2],t[1]=i[0],t[5]=i[1],t[9]=i[2],t[2]=e[0],t[6]=e[1],t[10]=e[2],t},t.rotate=function(t,e,i,r){let s=r[0],o=r[1],a=r[2],l=Math.sqrt(s*s+o*o+a*a);if(Math.abs(l)<Wy)return n();l=1/l,s*=l,o*=l,a*=l;const c=Math.sin(i),u=Math.cos(i),h=1-u,d=e[0],p=e[1],f=e[2],m=e[3],g=e[4],_=e[5],v=e[6],y=e[7],b=e[8],x=e[9],w=e[10],S=e[11],A=s*s*h+u,M=o*s*h+a*c,C=a*s*h-o*c,E=s*o*h-a*c,T=o*o*h+u,P=a*o*h+s*c,I=s*a*h+o*c,R=o*a*h-s*c,k=a*a*h+u;return t[0]=d*A+g*M+b*C,t[1]=p*A+_*M+x*C,t[2]=f*A+v*M+w*C,t[3]=m*A+y*M+S*C,t[4]=d*E+g*T+b*P,t[5]=p*E+_*T+x*P,t[6]=f*E+v*T+w*P,t[7]=m*E+y*T+S*P,t[8]=d*I+g*R+b*k,t[9]=p*I+_*R+x*k,t[10]=f*I+v*R+w*k,t[11]=m*I+y*R+S*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},t.fromRotation=d,t.scale=function(t,e,n){const i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scaleUniformly=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromUniformScaling=function(t,e){return t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromMat3=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[4]=e[3],t[5]=e[4],t[6]=e[5],t[8]=e[6],t[9]=e[7],t[10]=e[8],t},t.compose=function(t,e,n,i){const[r,s,o,a]=n,l=r+r,c=s+s,u=o+o,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=o*u,_=a*l,v=a*c,y=a*u,[b,x,w]=i;return t[0]=(1-(f+g))*b,t[1]=(d+y)*b,t[2]=(p-v)*b,t[3]=0,t[4]=(d-y)*x,t[5]=(1-(h+g))*x,t[6]=(m+_)*x,t[7]=0,t[8]=(p+v)*w,t[9]=(m-_)*w,t[10]=(1-(h+f))*w,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t};const p=[0,0,0],f=e();function m(t){const e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15];return(e*o-n*s)*(h*g-d*m)-(e*a-i*s)*(u*g-d*f)+(e*l-r*s)*(u*m-h*f)+(n*a-i*o)*(c*g-d*p)-(n*l-r*o)*(c*m-h*p)+(i*l-r*a)*(c*f-u*p)}t.decompose=function(t,e,n,i){let r=Qy.magnitude(Qy.set(p,t[0],t[1],t[2]));const s=Qy.magnitude(Qy.set(p,t[4],t[5],t[6])),o=Qy.magnitude(Qy.set(p,t[8],t[9],t[10]));m(t)<0&&(r=-r),e[0]=t[12],e[1]=t[13],e[2]=t[14],l(f,t);const a=1/r,u=1/s,h=1/o;return f[0]*=a,f[1]*=a,f[2]*=a,f[4]*=u,f[5]*=u,f[6]*=u,f[8]*=h,f[9]*=h,f[10]*=h,c(n,f),i[0]=r,i[1]=s,i[2]=o,t},t.makeTable=function(t){let e="";for(let n=0;n<4;n++){for(let i=0;i<4;i++)e+=t[4*i+n].toString(),i<3&&(e+=" ");n<3&&(e+="\n")}return e},t.determinant=m,t.isRotationAndTranslation=function(t,e){return function(t,e){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11];return!!(qy(t[15],1,e)&&qy(s,0,e)&&qy(c,0,e)&&qy(p,0,e))&&!!qy(Math.abs(n*(a*d-l*h)-i*(o*d-l*u)+r*(o*h-a*u)),1,e)}(t,void 0!==e?e:Wy)},t.isTranslationAndUniformScaling=function(t,e){return function(t,e){const n=t[0];return qy(t[1],0,e)&&qy(t[2],0,e)&&qy(t[3],0,e)&&qy(t[4],0,e)&&qy(t[5],n,e)&&qy(t[6],0,e)&&qy(t[7],0,e)&&qy(t[8],0,e)&&qy(t[9],0,e)&&qy(t[10],n,e)&&qy(t[11],0,e)&&qy(t[15],1,e)}(t,void 0!==e?e:Wy)},t.fromQuat=function(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,_=s*l;return t[0]=1-h-f,t[1]=u+_,t[2]=d-g,t[3]=0,t[4]=u-_,t[5]=1-c-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromEuler=function(t,e,n){const i=e[0],r=e[1],s=e[2],o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if("XYZ"===n){const e=o*u,n=o*h,i=a*u,r=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=n+i*c,t[5]=e-r*c,t[9]=-a*l,t[2]=r-e*c,t[6]=i+n*c,t[10]=o*l}else if("YXZ"===n){const e=l*u,n=l*h,i=c*u,r=c*h;t[0]=e+r*a,t[4]=i*a-n,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=o*l}else if("ZXY"===n){const e=l*u,n=l*h,i=c*u,r=c*h;t[0]=e-r*a,t[4]=-o*h,t[8]=i+n*a,t[1]=n+i*a,t[5]=o*u,t[9]=r-e*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if("ZYX"===n){const e=o*u,n=o*h,i=a*u,r=a*h;t[0]=l*u,t[4]=i*c-n,t[8]=e*c+r,t[1]=l*h,t[5]=r*c+e,t[9]=n*c-i,t[2]=-c,t[6]=a*l,t[10]=o*l}else if("YZX"===n){const e=o*l,n=o*c,i=a*l,r=a*c;t[0]=l*u,t[4]=r-e*h,t[8]=i*h+n,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=n*h+i,t[10]=e-r*h}else if("XZY"===n){const e=o*l,n=o*c,i=a*l,r=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=e*h+r,t[5]=o*u,t[9]=n*h-i,t[2]=i*h-n,t[6]=a*u,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.perspective=function(t,e,n,i,r,s,o){const a=2*s/(n-e),l=2*s/(i-r),c=(n+e)/(n-e),u=(i+r)/(i-r),h=-(o+s)/(o-s),d=-2*o*s/(o-s);return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=c,t[9]=u,t[10]=h,t[11]=-1,t[12]=0,t[13]=0,t[14]=d,t[15]=0,t},t.ortho=function(t,e,n,i,r,s,o){const a=1/(n-e),l=1/(i-r),c=1/(o-s),u=(n+e)*a,h=(i+r)*l,d=(o+s)*c;return t[0]=2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=-2*c,t[11]=0,t[12]=-u,t[13]=-h,t[14]=-d,t[15]=1,t},t.lookAt=function(t,e,n,r){let s,o,a,l,c,u,h,d,p,f;const m=e[0],g=e[1],_=e[2],v=r[0],y=r[1],b=r[2],x=n[0],w=n[1],S=n[2];return Math.abs(m-x)<Wy&&Math.abs(g-w)<Wy&&Math.abs(_-S)<Wy?i(t):(h=m-x,d=g-w,p=_-S,f=1/Math.sqrt(h*h+d*d+p*p),h*=f,d*=f,p*=f,s=y*p-b*d,o=b*h-v*p,a=v*d-y*h,f=Math.sqrt(s*s+o*o+a*a),f?(f=1/f,s*=f,o*=f,a*=f):(s=0,o=0,a=0),l=d*a-p*o,c=p*s-h*a,u=h*o-d*s,f=Math.sqrt(l*l+c*c+u*u),f?(f=1/f,l*=f,c*=f,u*=f):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=d,t[7]=0,t[8]=a,t[9]=u,t[10]=p,t[11]=0,t[12]=-(s*m+o*g+a*_),t[13]=-(l*m+c*g+u*_),t[14]=-(h*m+d*g+p*_),t[15]=1,t)},t.targetTo=function(t,e,n,i){const r=e[0],s=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=r-n[0],h=s-n[1],d=o-n[2],p=u*u+h*h+d*d;p>0&&(p=1/Math.sqrt(p),u*=p,h*=p,d*=p);let f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return p=f*f+m*m+g*g,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,g*=p),t[0]=f,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-d*m,t[5]=d*f-u*g,t[6]=u*m-h*f,t[7]=0,t[8]=u,t[9]=h,t[10]=d,t[11]=0,t[12]=r,t[13]=s,t[14]=o,t[15]=1,t},t.fromPermutation=function(t,e){r(t);for(let n=0;n<4;n++)a(t,n,e[n],1);return t},t.getMaxScaleOnAxis=function(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))};const g=[1,0,0],_=[0,1,0],v=[0,0,1];t.rotX90=d(e(),tb(90),g),t.rotX180=d(e(),tb(180),g),t.rotY90=d(e(),tb(90),_),t.rotY180=d(e(),tb(180),_),t.rotY270=d(e(),tb(270),_),t.rotZ90=d(e(),tb(90),v),t.rotZ180=d(e(),tb(180),v),t.rotXY90=h(e(),t.rotX90,t.rotY90),t.rotZY90=h(e(),t.rotZ90,t.rotY90),t.rotZYZ90=h(e(),t.rotZY90,t.rotZ90),t.rotZ90X180=h(e(),t.rotZ90,t.rotX180),t.rotY90Z180=h(e(),t.rotY90,t.rotZ180),t.id=n()}(eb||(eb={})),function(t){function e(){const t=[.1,0,0,0,0,0,0,0,0];return t[0]=0,t}function n(){const t=e();return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}t.zero=e,t.identity=n,t.setIdentity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.toArray=function(t,e,n){return e[n+0]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=t[3],e[n+4]=t[4],e[n+5]=t[5],e[n+6]=t[6],e[n+7]=t[7],e[n+8]=t[8],e},t.fromArray=function(t,e,n){return t[0]=e[n+0],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],t[4]=e[n+4],t[5]=e[n+5],t[6]=e[n+6],t[7]=e[n+7],t[8]=e[n+8],t},t.fromColumns=function(t,e,n,i){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=n[0],t[4]=n[1],t[5]=n[2],t[6]=i[0],t[7]=i[1],t[8]=i[2],t},t.fromMat4=i;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];t.fromEuler=function(t,e,n){return eb.fromEuler(r,e,n),i(t,r)},t.create=function(t,n,i,r,s,o,a,l,c){const u=e();return u[0]=t,u[1]=n,u[2]=i,u[3]=r,u[4]=s,u[5]=o,u[6]=a,u[7]=l,u[8]=c,u};const s=n();function o(t,e,n){for(let i=0;i<9;i++)if(Math.abs(t[i]-e[i])>n)return!1;return!0}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function l(t,e){if(t===e){const n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function c(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l;let f=n*h+i*d+r*p;return f?(f=1/f,t[0]=h*f,t[1]=(-u*i+r*c)*f,t[2]=(a*i-r*o)*f,t[3]=d*f,t[4]=(u*n-r*l)*f,t[5]=(-a*n+r*s)*f,t[6]=p*f,t[7]=(-c*n+i*l)*f,t[8]=(o*n-i*s)*f,t):(console.warn("non-invertible matrix.",e),t)}function u(t){const e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}function h(t){return t[0]+t[4]+t[8]}function d(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function p(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}t.isIdentity=function(t,e){return o(t,s,void 0===e?Wy:e)},t.hasNaN=function(t){for(let e=0;e<9;e++)if(isNaN(t[e]))return!0;return!1},t.clone=function(t){return a(e(),t)},t.areEqual=o,t.setValue=function(t,e,n,i){t[3*n+e]=i},t.getValue=function(t,e,n){return t[3*n+e]},t.copy=a,t.transpose=l,t.invert=c,t.symmtricFromUpper=function(t,e){return t===e?(t[3]=e[1],t[6]=e[2],t[7]=e[5]):(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[1],t[4]=e[4],t[5]=e[5],t[6]=e[2],t[7]=e[5],t[8]=e[8]),t},t.symmtricFromLower=function(t,e){return t===e?(t[1]=e[3],t[2]=e[6],t[5]=e[7]):(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[3],t[4]=e[4],t[5]=e[7],t[6]=e[6],t[7]=e[7],t[8]=e[8]),t},t.determinant=u,t.trace=h,t.sub=d,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},t.mul=function(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],_=n[5],v=n[6],y=n[7],b=n[8];return t[0]=d*i+p*o+f*c,t[1]=d*r+p*a+f*u,t[2]=d*s+p*l+f*h,t[3]=m*i+g*o+_*c,t[4]=m*r+g*a+_*u,t[5]=m*s+g*l+_*h,t[6]=v*i+y*o+b*c,t[7]=v*r+y*a+b*u,t[8]=v*s+y*l+b*h,t},t.subScalar=function(t,e,n){return t[0]=e[0]-n,t[1]=e[1]-n,t[2]=e[2]-n,t[3]=e[3]-n,t[4]=e[4]-n,t[5]=e[5]-n,t[6]=e[6]-n,t[7]=e[7]-n,t[8]=e[8]-n,t},t.addScalar=function(t,e,n){return t[0]=e[0]+n,t[1]=e[1]+n,t[2]=e[2]+n,t[3]=e[3]+n,t[4]=e[4]+n,t[5]=e[5]+n,t[6]=e[6]+n,t[7]=e[7]+n,t[8]=e[8]+n,t},t.mulScalar=p;const f=Math.PI/3,m=e();t.symmetricEigenvalues=function(e,n){const i=n[1]*n[1]+n[2]*n[2]+n[5]*n[5];if(0===i)e[0]=n[0],e[1]=n[4],e[2]=n[8];else{const r=h(n)/3,s=n[0]-r,o=n[4]-r,a=n[8]-r,l=s*s+o*o+a*a+2*i,c=Math.sqrt(l/6);p(m,t.Identity,r),d(m,n,m),p(m,m,1/c);const g=u(m)/2,_=g<=-1?f:g>=1?0:Math.acos(g)/3;e[0]=r+2*c*Math.cos(_),e[2]=r+2*c*Math.cos(_+2*f),e[1]=3*r-e[0]-e[2]}return e};const g=[.1,0,0],_=[.1,0,0],v=[.1,0,0],y=[.1,0,0],b=[.1,0,0],x=[.1,0,0];t.eigenvector=function(t,e,n){Qy.set(g,e[0]-n,e[1],e[2]),Qy.set(_,e[1],e[4]-n,e[5]),Qy.set(v,e[2],e[5],e[8]-n),Qy.cross(y,g,_),Qy.cross(b,g,v),Qy.cross(x,_,v);const i=Qy.dot(y,y),r=Qy.dot(b,b),s=Qy.dot(x,x);let o=i,a=0;return r>o&&(o=r,a=1),s>o&&(a=2),0===a?Qy.scale(t,y,1/Math.sqrt(i)):1===a?Qy.scale(t,b,1/Math.sqrt(r)):Qy.scale(t,x,1/Math.sqrt(s)),t},t.directionTransform=function(t,e){return i(t,e),c(t,t),l(t,t),t},t.Identity=n(),t.innerProduct=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]+t[4]*e[4]+t[5]*e[5]+t[6]*e[6]+t[7]*e[7]+t[8]*e[8]}}(nb||(nb={})),function(t){function e(){const t=[.1,0];return t[0]=0,t}t.zero=e,t.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n},t.create=function(t,n){const i=e();return i[0]=t,i[1]=n,i},t.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])},t.toArray=function(t,e,n){return e[n+0]=t[0],e[n+1]=t[1],e},t.fromArray=function(t,e,n){return t[0]=e[n+0],t[1]=e[n+1],t},t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},t.set=function(t,e,n){return t[0]=e,t[1]=n,t},t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},t.sub=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},t.mul=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},t.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},t.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},t.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},t.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},t.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},t.distance=function(t,e){const n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)},t.squaredDistance=function(t,e){const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},t.magnitude=function(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},t.squaredMagnitude=function(t){const e=t[0],n=t[1];return e*e+n*n},t.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},t.areEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]},t.toString=function(t,e){return`[${t[0].toPrecision(e)} ${t[1].toPrecision(e)}}]`}}(ib||(ib={})),function(t){function e(){const t=[.1,0,0,0];return t[0]=0,t}function n(t,e){return t[0]=e.center[0],t[1]=e.center[1],t[2]=e.center[2],t[3]=e.radius,t}t.zero=e,t.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},t.create=function(t,n,i,r){const s=e();return s[0]=t,s[1]=n,s[2]=i,s[3]=r,s},t.fromSphere=n,t.ofSphere=function(t){return n(e(),t)},t.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])},t.toArray=function(t,e,n){return e[n+0]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=t[3],e},t.fromArray=function(t,e,n){return t[0]=e[n+0],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],t},t.toVec3Array=function(t,e,n){e[n+0]=t[0],e[n+1]=t[1],e[n+2]=t[2]},t.fromVec3Array=function(t,e,n){return t[0]=e[n+0],t[1]=e[n+1],t[2]=e[n+2],t[3]=0,t},t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.set=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},t.distance=function(t,e){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(n*n+i*i+r*r+s*s)},t.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[4]=e[4]*n,t},t.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},t.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},t.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},t.squaredDistance=function(t,e){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],s=e[3]-t[3];return n*n+i*i+r*r+s*s},t.norm=function(t){const e=t[0],n=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+n*n+i*i+r*r)},t.squaredNorm=function(t){const e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r},t.transformMat4=function(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.equals=function(t,e){const n=t[0],i=t[1],r=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(n-o)<=Wy*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=Wy*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=Wy*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=Wy*Math.max(1,Math.abs(s),Math.abs(c))},t.toString=function(t,e){return`[${t[0].toPrecision(e)} ${t[1].toPrecision(e)} ${t[2].toPrecision(e)}  ${t[3].toPrecision(e)}]`}}(rb||(rb={})),function(t){function e(){const t=[.1,0,0,0];return t[0]=0,t}function n(){const t=e();return t[3]=1,t}function i(t,e,n){n*=.5;const i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function r(t,e,n,i){const r=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,h,d,p=n[0],f=n[1],m=n[2],g=n[3];return c=r*p+s*f+o*m+a*g,c<0&&(c=-c,p=-p,f=-f,m=-m,g=-g),1-c>1e-6?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-i)*l)/u,d=Math.sin(i*l)/u):(h=1-i,d=i),t[0]=h*r+d*p,t[1]=h*s+d*f,t[2]=h*o+d*m,t[3]=h*a+d*g,t}function s(t,e){const n=e[0]+e[4]+e[8];let i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const r=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*r+r]-e[3*s+s]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*r+s]-e[3*s+r])*i,t[r]=(e[3*r+n]+e[3*n+r])*i,t[s]=(e[3*s+n]+e[3*n+s])*i}return t}t.zero=e,t.identity=n,t.setIdentity=function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1},t.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])},t.create=function(t,e,i,r){const s=n();return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s},t.setAxisAngle=i,t.getAxisAngle=function(t,e){const n=2*Math.acos(e[3]),i=Math.sin(n/2);return 0!==i?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},t.multiply=function(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+o*a+r*c-s*l,t[1]=r*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-r*a,t[3]=o*u-i*a-r*l-s*c,t},t.rotateX=function(t,e,n){n*=.5;const i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-i*a,t},t.rotateY=function(t,e,n){n*=.5;const i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l-s*a,t[1]=r*l+o*a,t[2]=s*l+i*a,t[3]=o*l-r*a,t},t.rotateZ=function(t,e,n){n*=.5;const i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t},t.calculateW=function(t,e){const n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t},t.slerp=r,t.invert=function(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a,t},t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.fromMat3=s,t.fromEuler=function(t,e,n){const[i,r,s]=e,o=Math.cos(i/2),a=Math.cos(r/2),l=Math.cos(s/2),c=Math.sin(i/2),u=Math.sin(r/2),h=Math.sin(s/2);switch(n){case"XYZ":t[0]=c*a*l+o*u*h,t[1]=o*u*l-c*a*h,t[2]=o*a*h+c*u*l,t[3]=o*a*l-c*u*h;break;case"YXZ":t[0]=c*a*l+o*u*h,t[1]=o*u*l-c*a*h,t[2]=o*a*h-c*u*l,t[3]=o*a*l+c*u*h;break;case"ZXY":t[0]=c*a*l-o*u*h,t[1]=o*u*l+c*a*h,t[2]=o*a*h+c*u*l,t[3]=o*a*l-c*u*h;break;case"ZYX":t[0]=c*a*l-o*u*h,t[1]=o*u*l+c*a*h,t[2]=o*a*h-c*u*l,t[3]=o*a*l+c*u*h;break;case"YZX":t[0]=c*a*l+o*u*h,t[1]=o*u*l+c*a*h,t[2]=o*a*h-c*u*l,t[3]=o*a*l-c*u*h;break;case"XZY":t[0]=c*a*l-o*u*h,t[1]=o*u*l-c*a*h,t[2]=o*a*h+c*u*l,t[3]=o*a*l+c*u*h;break;default:sb()}return t};const o=[0,0,0];function a(t,e){const n=e[0],i=e[1],r=e[2],s=e[3];let o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o),t}t.fromUnitVec3=function(t,e,n){let i=Qy.dot(e,n)+1;return i<Wy?(i=0,Math.abs(e[0])>Math.abs(e[2])?Qy.set(o,-e[1],e[0],0):Qy.set(o,0,-e[2],e[1])):Qy.cross(o,e,n),t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=i,a(t,t),t},t.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},t.toArray=function(t,e,n){return e[n+0]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=t[3],e},t.fromArray=function(t,e,n){return t[0]=e[n+0],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],t},t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.set=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.equals=function(t,e){const n=t[0],i=t[1],r=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(n-o)<=Wy*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=Wy*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=Wy*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=Wy*Math.max(1,Math.abs(s),Math.abs(c))},t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},t.normalize=a;const l=[0,0,0],c=[1,0,0],u=[0,1,0];t.rotationTo=function(t,e,n){const r=Qy.dot(e,n);return r<-.999999?(Qy.cross(l,c,e),Qy.magnitude(l)<1e-6&&Qy.cross(l,u,e),Qy.normalize(l,l),i(t,l,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Qy.cross(l,e,n),t[0]=l[0],t[1]=l[1],t[2]=l[2],t[3]=1+r,a(t,t))};const h=e(),d=e();t.sqlerp=function(t,e,n,i,s,o){return r(h,e,s,o),r(d,n,i,o),r(t,h,d,2*o*(1-o)),t};const p=[0,0,0,0,0,0,0,0,0];t.setAxes=function(t,e,n,i){return p[0]=n[0],p[3]=n[1],p[6]=n[2],p[1]=i[0],p[4]=i[1],p[7]=i[2],p[2]=-e[0],p[5]=-e[1],p[8]=-e[2],a(t,s(t,p))},t.toString=function(t,e){return`[${t[0].toPrecision(e)} ${t[1].toPrecision(e)} ${t[2].toPrecision(e)}  ${t[3].toPrecision(e)}]`},t.Identity=n()}(ob||(ob={})),function(t){function e(t,e,r){const s=function(t,e,n){const i=[];for(let t=0;t<e.length;t++)i[t]=e[e.length-t-1];const r=[1];for(let e=1;e<t.length;e++)r[e]=t[i[e-1]];return{dimensions:t,axisOrderFastToSlow:i,axisOrderSlowToFast:e,accessDimensions:r,defaultCtor:n||Float64Array}}(t,e,r),{get:o,set:a,add:l,dataOffset:c,getCoords:u}=n(s);return{rank:t.length,dimensions:t,axisOrderSlowToFast:e,create:i(s),get:o,set:a,add:l,dataOffset:c,getCoords:u}}function n(t){const{dimensions:e,axisOrderFastToSlow:n}=t;switch(e.length){case 1:return{get:(t,e)=>t[e],set:(t,e,n)=>t[e]=n,add:(t,e,n)=>t[e]+=n,dataOffset:t=>t,getCoords:(t,e)=>(e[0]=t,e)};case 2:if(0===n[0]&&1===n[1]){const t=e[0];return{get:(e,n,i)=>e[i*t+n],set:(e,n,i,r)=>e[i*t+n]=r,add:(e,n,i,r)=>e[i*t+n]+=r,dataOffset:(e,n)=>n*t+e,getCoords:(e,n)=>(n[0]=e%t,n[1]=Math.floor(e/t),n)}}if(1===n[0]&&0===n[1]){const t=e[1];return{get:(e,n,i)=>e[n*t+i],set:(e,n,i,r)=>e[n*t+i]=r,add:(e,n,i,r)=>e[n*t+i]+=r,dataOffset:(e,n)=>e*t+n,getCoords:(e,n)=>(n[0]=Math.floor(e/t),n[1]=e%t,n)}}throw new Error("bad axis order");case 3:if(0===n[0]&&1===n[1]&&2===n[2]){const t=e[0],n=e[1],i=t*n;return{get:(e,n,r,s)=>e[n+r*t+s*i],set:(e,n,r,s,o)=>e[n+r*t+s*i]=o,add:(e,n,r,s,o)=>e[n+r*t+s*i]+=o,dataOffset:(e,n,r)=>e+n*t+r*i,getCoords:(e,i)=>{const r=Math.floor(e/t);return i[0]=e%t,i[1]=r%n,i[2]=Math.floor(r/n),i}}}if(0===n[0]&&2===n[1]&&1===n[2]){const t=e[0],n=e[2],i=t*n;return{get:(e,n,r,s)=>e[n+s*t+r*i],set:(e,n,r,s,o)=>e[n+s*t+r*i]=o,add:(e,n,r,s,o)=>e[n+s*t+r*i]+=o,dataOffset:(e,n,r)=>e+r*t+n*i,getCoords:(e,i)=>{const r=Math.floor(e/t);return i[0]=e%t,i[1]=Math.floor(r/n),i[2]=r%n,i}}}if(1===n[0]&&0===n[1]&&2===n[2]){const t=e[1],n=e[0],i=t*n;return{get:(e,n,r,s)=>e[r+n*t+s*i],set:(e,n,r,s,o)=>e[r+n*t+s*i]=o,add:(e,n,r,s,o)=>e[r+n*t+s*i]+=o,dataOffset:(e,n,r)=>n+e*t+r*i,getCoords:(e,i)=>{const r=Math.floor(e/t);return i[0]=r%n,i[1]=e%t,i[2]=Math.floor(r/n),i}}}if(1===n[0]&&2===n[1]&&0===n[2]){const t=e[1],n=e[2],i=t*n;return{get:(e,n,r,s)=>e[r+s*t+n*i],set:(e,n,r,s,o)=>e[r+s*t+n*i]=o,add:(e,n,r,s,o)=>e[r+s*t+n*i]+=o,dataOffset:(e,n,r)=>n+r*t+e*i,getCoords:(e,i)=>{const r=Math.floor(e/t);return i[0]=Math.floor(r/n),i[1]=e%t,i[2]=r%n,i}}}if(2===n[0]&&0===n[1]&&1===n[2]){const t=e[2],n=e[0],i=t*n;return{get:(e,n,r,s)=>e[s+n*t+r*i],set:(e,n,r,s,o)=>e[s+n*t+r*i]=o,add:(e,n,r,s,o)=>e[s+n*t+r*i]+=o,dataOffset:(e,n,r)=>r+e*t+n*i,getCoords:(e,i)=>{const r=Math.floor(e/t);return i[0]=r%n,i[1]=Math.floor(r/n),i[2]=e%t,i}}}if(2===n[0]&&1===n[1]&&0===n[2]){const t=e[2],n=e[1],i=t*n;return{get:(e,n,r,s)=>e[s+r*t+n*i],set:(e,n,r,s,o)=>e[s+r*t+n*i]=o,add:(e,n,r,s,o)=>e[s+r*t+n*i]+=o,dataOffset:(e,n,r)=>r+n*t+e*i,getCoords:(e,i)=>{const r=Math.floor(e/t);return i[0]=Math.floor(r/n),i[1]=r%n,i[2]=e%t,i}}}throw new Error("bad axis order");default:return{get:(e,...n)=>e[r(t,n)],set:(e,...n)=>e[r(t,n)]=n[n.length-1],add:(e,...n)=>e[r(t,n)]+=n[n.length-1],dataOffset:(...e)=>r(t,e),getCoords:(e,n)=>function(t,e,n){const{dimensions:i,axisOrderFastToSlow:r}=t,s=i.length;let o=e;for(let t=0;t<s;t++){const e=i[r[t]];n[r[t]]=o%e,o=Math.floor(o/e)}return n[r[s+1]]=o,n}(t,e,n)}}}function i(t){const{dimensions:e}=t;let n=1;for(let t=0,i=e.length;t<i;t++)n*=e[t];return e=>new(e||t.defaultCtor)(n)}function r(t,e){const{accessDimensions:n,axisOrderFastToSlow:i}=t,r=n.length-1;let s=n[r]*e[i[r]];for(let t=r-1;t>=0;t--)s=(s+e[i[t]])*n[t];return s}function s(t,e){const n=[];for(let i=0;i<t.length;i++)n[i]=t[e[i]];return n}t.create=function(t,e){return{space:t,data:e}},t.Space=e,t.Data1=function(t){return t},t.Vector=function(t,n){return e([t],[0],n)},t.ColumnMajorMatrix=function(t,n,i){return e([t,n],[1,0],i)},t.RowMajorMatrix=function(t,n,i){return e([t,n],[0,1],i)},t.toMat4=function(t,e,n){if(2!==e.rank)throw new Error("Invalid tensor rank");const i=Math.min(4,e.dimensions[0]),r=Math.min(4,e.dimensions[1]);for(let s=0;s<i;s++)for(let i=0;i<r;i++)eb.setValue(t,s,i,e.get(n,s,i));return t},t.toMat3=function(t,e,n){if(2!==e.rank)throw new Error("Invalid tensor rank");const i=Math.min(3,e.dimensions[0]),r=Math.min(3,e.dimensions[1]);for(let s=0;s<i;s++)for(let i=0;i<r;i++)nb.setValue(t,s,i,e.get(n,s,i));return t},t.toVec3=function(t,e,n){if(1!==e.rank)throw new Error("Invalid tensor rank");const i=Math.min(3,e.dimensions[0]);for(let e=0;e<i;e++)t[e]=n[e];return t},t.toVec4=function(t,e,n){if(1!==e.rank)throw new Error("Invalid tensor rank");const i=Math.min(4,e.dimensions[0]);for(let e=0;e<i;e++)t[e]=n[e];return t},t.areEqualExact=function(t,e){const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0},t.invertAxisOrder=function(t){const e=[];for(let n=0;n<t.length;n++)e[n]=t[t.length-n-1];return e},t.convertToCanonicalAxisIndicesFastToSlow=function(t){const e=new Int32Array(t.length);for(let n=0;n<t.length;n++)e[t[n]]=n;return t=>s(t,e)},t.convertToCanonicalAxisIndicesSlowToFast=function(t){const e=new Int32Array(t.length);for(let n=0;n<t.length;n++)e[t[t.length-n-1]]=n;return t=>s(t,e)}}(ab||(ab={})),function(t){let e;function n(t,e){return fb(e.T,t,e,1)}function i(t){return mb(t)}!function(t){function e(e,n=t.float){return{"@type":"tensor",T:e.create(),space:e,valueType:"tensor",baseType:n}}t.str={"@type":"str",T:"",valueType:"str"},t.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},t.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},t.int={"@type":"int",T:0,valueType:"int"},t.coord={"@type":"coord",T:0,valueType:"float"},t.float={"@type":"float",T:0,valueType:"float"},t.Str=function(t){var e;return{"@type":"str",T:null!==(e=null==t?void 0:t.defaultValue)&&void 0!==e?e:"",transform:null==t?void 0:t.transform,valueType:"str"}},t.Int=function(t=0){return{"@type":"int",T:t,valueType:"int"}},t.Float=function(t=0){return{"@type":"float",T:t,valueType:"float"}},t.Tensor=e,t.Vector=function(n,i=t.float){return e(ab.Vector(n,"int"===i["@type"]?Int32Array:Float64Array),i)},t.Matrix=function(n,i,r=t.float){return e(ab.ColumnMajorMatrix(n,i,"int"===r["@type"]?Int32Array:Float64Array),r)},t.Aliased=function(t){return t},t.List=function(t,e,n=[]){return{"@type":"list",T:n,separator:t,itemParse:e,valueType:"list"}}}(e=t.Schema||(t.Schema={})),t.is=function(t){return!!t&&!!t.schema&&!!t.value},t.ValueKind={Present:0,NotPresent:1,Unknown:2},t.Undefined=n,t.ofConst=function(t,e,n){return fb(t,e,n,0)},t.ofLambda=i,t.range=function(t,n){return i({value:e=>e+t,rowCount:Math.max(n-t+1,0),schema:e.int})},t.ofArray=function(t){return gb(t)},t.ofIntArray=function(t){return gb({array:t,schema:e.int})},t.ofFloatArray=function(t){return gb({array:t,schema:e.float})},t.ofStringArray=function(t){return gb({array:t,schema:e.str})},t.ofStringAliasArray=function(t){return gb({array:t,schema:e.Aliased(e.str)})},t.ofStringListArray=function(t,n=","){return gb({array:t,schema:e.List(n,(t=>t))})},t.ofIntTokens=function(t){const{count:n,data:i,indices:r}=t;return mb({value:t=>hb(i,r[2*t],r[2*t+1])||0,rowCount:n,schema:e.int})},t.ofFloatTokens=function(t){const{count:n,data:i,indices:r}=t;return mb({value:t=>pb(i,r[2*t],r[2*t+1])||0,rowCount:n,schema:e.float})},t.ofStringTokens=function(t){const{count:n,data:i,indices:r}=t;return mb({value:t=>{const e=i.substring(r[2*t],r[2*t+1]);return"."===e||"?"===e?"":e},rowCount:n,schema:e.str})},t.window=function(t,e,n){return function(t,e,n){return t.isDefined?0===e&&n===t.rowCount?t:t.__array&&$y(t.__array)?function(t,e,n){const i=jy(t.__array,{start:e,end:n}),r=t.valueKind;return gb({array:i,schema:t.schema,valueKind:t=>r(e+t)})}(t,e,n):function(t,e,n){const i=t.value,r=t.valueKind,s=t.areValuesEqual,o=0===e?i:t=>i(t+e),a=n-e;return{schema:t.schema,__array:void 0,isDefined:t.isDefined,rowCount:a,value:o,valueKind:0===e?r:t=>r(t+e),toArray:t=>{const{array:n}=Hy(a,t);for(let t=0,r=n.length;t<r;t++)n[t]=i(t+e);return n},areValuesEqual:0===e?s:(t,n)=>s(t+e,n+e)}}(t,e,n):lb.Undefined(n-e,t.schema)}(t,e,n)},t.view=function(t,e,n=!0){return function(t,e,n){return 0===t.rowCount||n&&function(t,e){if(t.length!==e)return!1;for(let e=0,n=t.length;e<n;e++)if(t[e]!==e)return!1;return!0}(e,t.rowCount)?t:t.__array&&typeof t.value(0)==typeof t.__array[0]?function(t,e){const n=t.__array,i=new n.constructor(e.length);for(let t=0,r=e.length;t<r;t++)i[t]=n[e[t]];const r=t.valueKind;return gb({array:i,schema:t.schema,valueKind:t=>r(e[t])})}(t,e):function(t,e){const n=t.value,i=t.valueKind,r=t.areValuesEqual,s=e.length;return{schema:t.schema,__array:void 0,isDefined:t.isDefined,rowCount:s,value:t=>n(e[t]),valueKind:t=>i(e[t]),toArray:t=>{const{array:i}=Hy(s,t);for(let t=0,r=i.length;t<r;t++)i[t]=n(e[t]);return i},areValuesEqual:(t,n)=>r(e[t],e[n])}}(t,e)}(t,e,n)},t.createFirstIndexMap=function(t){return function(t){const e=new Map;for(let n=0,i=t.rowCount;n<i;n++){const i=t.value(n);e.has(i)||e.set(t.value(n),n)}return e}(t)},t.createIndexer=function(t){return function(t){const e=new Map;for(let n=0,i=t.rowCount;n<i;n++){const i=t.value(n);e.has(i)||e.set(t.value(n),n)}return t=>e.has(t)?e.get(t):-1}(t)},t.mapToArray=function(t,e,n){return function(t,e,n){const i=new n(t.rowCount);for(let n=0,r=t.rowCount;n<r;n++)i[n]=e(t.value(n));return i}(t,e,n||Array)},t.areEqual=function(t,e){return function(t,e){return t===e||t.rowCount===e.rowCount&&t.isDefined===e.isDefined&&t.schema.valueType===e.schema.valueType&&(t.__array&&e.__array?function(t,e){const n=t.__array,i=e.__array;for(let e=0,r=t.rowCount;e<r;e++)if(n[e]!==i[e])return!1;return!0}(t,e):function(t,e){const n=t.value,i=e.value;for(let e=0,r=t.rowCount;e<r;e++)if(n(e)!==i(e))return!1;return!0}(t,e))}(t,e)},t.indicesOf=function(t,e){return function(t,e){const n=[],i=t.value;for(let r=0,s=t.rowCount;r<s;r++)e(i(r))&&(n[n.length]=r);return n}(t,e)},t.asArrayColumn=function(t,e){return t.__array?t:t.isDefined?gb({array:t.toArray({array:e}),schema:t.schema,valueKind:t.valueKind}):n(t.rowCount,t.schema)},t.copyToArray=function(t,e,n=0){if(!t.isDefined)return;const i=t.__array;if(i)for(let t=0,r=i.length;t<r;t++)e[n+t]=i[t];else for(let i=0,r=t.rowCount;i<r;i++)e[n+i]=t.value(i)},t.isIdentity=function(t){for(let e=0,n=t.rowCount;e<n;e++)if(e!==t.value(e))return!1;return!0}}(lb||(lb={})),function(t){t.create=function(t){return t},t.has=function(t,e){return!!(t&e)},t.hasAll=function(t,e){return!!e&&(t&e)===e}}(cb||(cb={})),function(t){t.create=function(t=512){return{current:[],offset:0,capacity:t,chunks:[]}},t.getString=function(t){return t.chunks.length?(t.offset>0&&(t.chunks[t.chunks.length]=t.current.length===t.offset?t.current.join(""):t.current.slice(0,t.offset).join("")),t.chunks.join("")):t.current.length===t.offset?t.current.join(""):t.current.splice(0,t.offset).join("")},t.getSize=function(t){let e=0;for(const n of t.chunks)e+=n.length;for(let n=0;n<t.offset;n++)e+=t.current[n].length;return e},t.getChunks=function(t){return t.offset>0&&(t.current.length===t.offset?t.chunks[t.chunks.length]=t.current.join(""):t.chunks[t.chunks.length]=t.current.slice(0,t.offset).join(""),t.offset=0),t.chunks};const e=[];function n(t,n){n>0&&i(t,e[n])}function i(t,e){t.offset===t.capacity&&(t.chunks[t.chunks.length]=t.current.join(""),t.offset=0),t.current[t.offset++]=e}!function(){let t="";for(let n=0;n<512;n++)e[n]=t,t+=" "}(),t.newline=function(t){i(t,"\n")},t.whitespace=n,t.whitespace1=function(t){i(t," ")},t.write=function(t,e){e&&(t.offset===t.capacity&&(t.chunks[t.chunks.length]=t.current.join(""),t.offset=0),t.current[t.offset++]=e)},t.writeSafe=i,t.writePadLeft=function(t,e,r){e?(n(t,r-e.length),i(t,e)):n(t,r)},t.writePadRight=function(t,e,r){if(!e)return void n(t,r);const s=r-e.length;i(t,e),n(t,s)},t.writeInteger=function(t,e){i(t,""+e)},t.writeIntegerAndSpace=function(t,e){i(t,e+" ")},t.writeIntegerPadLeft=function(t,e,r){const s=""+e;n(t,r-s.length),i(t,s)},t.writeIntegerPadRight=function(t,e,r){const s=""+e,o=r-s.length;i(t,s),n(t,o)},t.writeFloat=function(t,e,n){i(t,""+Math.round(n*e)/n)},t.writeFloatPadLeft=function(t,e,r,s){const o=""+Math.round(r*e)/r;n(t,s-o.length),i(t,o)},t.writeFloatPadRight=function(t,e,r,s){const o=""+Math.round(r*e)/r,a=s-o.length;i(t,o),n(t,a)}}(ub||(ub={}));const Eb=function(){if("undefined"!=typeof window&&window.performance){const t=window.performance;return()=>t.now()}return"undefined"!=typeof process&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?()=>{const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();var Tb,Pb,Ib;function Rb(t,e){return t-e}function kb(t=0,e=Number.MAX_SAFE_INTEGER){let n=t;return()=>{const t=n;return n=(n+1)%e,t}}!function(t){const e="undefined"!=typeof btoa?btoa:t=>Buffer.from(t).toString("base64"),n=[];t.create22=function(){let t=+new Date+Eb();for(let e=0;e<16;e++)n[e]=String.fromCharCode((t+255*Math.random())%255|0),t=Math.floor(t/255);return e(n.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},t.createv4=function(){let t=+new Date+Eb();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}))},t.is=function(t){return"string"==typeof t}}(Tb||(Tb={})),function(t){class e{has(t){return!1}forEach(t,e){return e}constructor(){this.size=0}}class n{has(t){return t===this.idx}forEach(t,e){return t(this.idx,e),e}constructor(t){this.idx=t,this.size=1}}class i{has(t){return t<this.length&&!!this.mask[t]}_forEach(t,e){for(let n=0;n<this.length;n++)this.mask[n]&&t(n,e)}forEach(t,e){return this._forEach(t,e),e}constructor(t,e){this.mask=t,this.size=e,this.length=t.length}}class r{has(t){return!0}_forEach(t,e){for(let n=0;n<this.size;n++)t(n,e)}forEach(t,e){return this._forEach(t,e),e}constructor(t){this.size=t}}class s{has(t){return this.set.has(t)}_forEach(t,e){for(const n of this.flatten())t(n,e)}flatten(){if(this._flat)return this._flat;const t=new Int32Array(this.size);let e=0;return this.set.forEach((n=>t[e++]=n)),function(t){Array.prototype.sort.call(t,Rb)}(t),this._flat=t,this._flat}forEach(t,e){return this._forEach(t,e),e}constructor(t){this.set=t,this._flat=void 0,this.size=t.size}}function o(t){return new s(t)}function a(t,e){return new i(t,e)}t.always=function(t){return new r(t)},t.never=new e,t.ofSet=o,t.singleton=function(t){return new n(t)},t.ofUniqueIndices=function(t){const o=t.length;if(0===o)return new e;if(1===o)return new n(t[0]);let a=0;for(const e of t)e>a&&(a=e);if(o===a)return new r(o);if(o/a<1/12){const e=new Set;for(const n of t)e.add(n);return new s(e)}const l=new Int8Array(a+1);for(const e of t)l[e]=1;return new i(l,t.length)},t.ofMask=a,t.hasAny=function(t,e){for(const n of e)if(t.has(n))return!0;return!1},t.complement=function(t,e){let n=0,i=0;if(e.forEach((e=>{t.has(e)||(n++,e>i&&(i=e))})),n/i<1/12){const n=new Set;return e.forEach((e=>{t.has(e)||n.add(e)})),o(n)}{const r=new Uint8Array(i+1);return e.forEach((e=>{t.has(e)||(r[e]=1)})),a(r,n)}}}(Pb||(Pb={})),function(t){t.create=function(t){return{ref:t}},t.set=function(t,e){return t.ref=e,t}}(Ib||(Ib={}));const Db=kb(0,2147483647);var Lb,Ob,Nb,Fb,Bb;function Ub(t){const{data:e,indices:n}=t;return function(t,i){const r=n[2*t],s=n[2*i],o=n[2*t+1]-r;if(o!==n[2*i+1]-s)return!1;for(let t=0;t<o;t++)if(e.charCodeAt(t+r)!==e.charCodeAt(t+s))return!1;return!0}}function zb(t,e){return{name:e,blocks:t}}function Vb(t,e,n,i=[]){return{categoryNames:t,header:n,categories:e,saveFrames:i,getField(t){const[n,i]=t.split(".");return e[n].getField(i||"")}}}function Hb(t,e,n,i){return{rowCount:e,name:t,fieldNames:[...n],getField:t=>i[t]}}!function(t){t.create=function(t,e){return{id:Db(),version:0,value:t,metadata:e}},t.withValue=function(t,e){return{id:t.id,version:t.version+1,value:e,metadata:t.metadata}}}(Lb||(Lb={})),function(t){function e(t,e){return Ib.set(t,Lb.withValue(t.ref,e))}t.create=function(t,e){return Ib.create(Lb.create(t,e))},t.update=e,t.set=function(t,e){return Ib.set(t,e)},t.updateIfChanged=function(t,n){return t.ref.value!==n?e(t,n):t}}(Ob||(Ob={})),function(t){function e(t,e,n){const i=Object.create(null),r=Object.keys(e);i._rowCount=n.length,i._columns=r,i._schema=e;for(const e of r)i[e]=lb.view(t[e],n);return i}function n(t,e){const n=Object.create(null),{_columns:i}=t;for(let r=0;r<i.length;r++){const s=i[r];n[s]=t[s].value(e)}return n}t.is=function(t){return t&&"number"==typeof t._rowCount&&!!t._columns&&!!t._schema},t.pickColumns=function(t,e,n={}){const i=Object.create(null),r=Object.keys(t);i._rowCount=e._rowCount,i._columns=r,i._schema=t;for(const t of r)if(e[t])i[t]=e[t];else{if(!n[t])throw Error(`Cannot find column '${t}'.`);i[t]=n[t]}return i},t.ofColumns=function(t,e){const n=Object.keys(e);return xa({_rowCount:e[n[0]].rowCount,_columns:n,_schema:t},e)},t.ofPartialColumns=function(t,e,n){const i=Object.create(null),r=Object.keys(t);i._rowCount=n,i._columns=r,i._schema=t;for(const s of r)i[s]=s in e?e[s]:lb.Undefined(n,t[s]);return i},t.ofUndefinedColumns=function(t,e){const n=Object.create(null),i=Object.keys(t);n._rowCount=e,n._columns=i,n._schema=t;for(const r of i)n[r]=lb.Undefined(e,t[r]);return n},t.ofRows=function(t,e){const n=Object.create(null),i=e.length,r=Object.keys(t);n._rowCount=i,n._columns=r,n._schema=t;for(const s of r)n[s]=lb.ofLambda({rowCount:i,schema:t[s],value:t=>e[t][s],valueKind:t=>void 0===e[t][s]?1:0});return n},t.ofArrays=function(t,e){var n;const i=Object.create(null),r=Object.keys(t);i._rowCount=0,i._columns=r,i._schema=t;for(const s of r)void 0!==e[s]?(i[s]=lb.ofArray({array:e[s],schema:t[s]}),i._rowCount=null===(n=e[s])||void 0===n?void 0:n.length):i[s]=lb.Undefined(i._rowCount,t[s]);return i},t.view=e,t.pick=function(t,n,i){const r=[];for(let e=0,n=t._rowCount;e<n;++e)i(e)&&r.push(e);return e(t,n,r)},t.window=function(t,e,n,i){if(0===n&&i===t._rowCount)return t;const r=Object.create(null),s=Object.keys(e);r._rowCount=i-n,r._columns=s,r._schema=e;for(const e of s)r[e]=lb.window(t[e],n,i);return r},t.concat=function(t,e){const n=Object.create(null),i=Object.keys(e);n._rowCount=0;for(const e of t)n._rowCount+=e._rowCount;const r={};for(const t of i)r[t]=new Array(n._rowCount);n._columns=i,n._schema=e;let s=0;for(const e of t){for(const t of i)lb.copyToArray(e[t],r[t],s);s+=e._rowCount}for(const t of i)n[t]=lb.ofArray({array:r[t],schema:e[t]});return n},t.columnToArray=function(t,e,n){t[e]=lb.asArrayColumn(t[e],n)},t.sort=function(t,e){const n=new Int32Array(t._rowCount);for(let t=0,e=n.length;t<e;t++)n[t]=t;Cb(n,((t,n,i)=>e(n,i)));let i=!0;for(let t=0,e=n.length;t<e;t++)if(n[t]!==t){i=!1;break}if(i)return t;const r=Object.create(null);r._rowCount=t._rowCount,r._columns=t._columns,r._schema=t._schema;for(const e of t._columns)r[e]=lb.view(t[e],n,!1);return r},t.areEqual=function(t,e){if(t._rowCount!==e._rowCount)return!1;if(t._columns.length!==e._columns.length)return!1;for(const n of t._columns)if(!e[n])return!1;for(const n of t._columns)if(!lb.areEqual(t[n],e[n]))return!1;return!0},t.getRow=n,t.pickRow=function(t,e){for(let i=0,r=t._rowCount;i<r;++i)if(e(i))return n(t,i)},t.getRows=function(t){const e=[],{_rowCount:i}=t;for(let r=0;r<i;r++)e[r]=n(t,r);return e},t.toArrays=function(t){const e={},{_columns:n}=t;for(let i=0;i<n.length;i++){const r=n[i];e[r]=t[r].toArray()}return e},t.formatToString=function(t){const e=ub.create(),{_columns:n,_rowCount:i}=t;let r=1;ub.write(e,"|");for(let t=0;t<n.length;t++)ub.write(e,n[t]),ub.write(e,"|"),r+=n[t].length+1;ub.newline(e),ub.write(e,new Array(r+1).join("-")),ub.newline(e);for(let r=0;r<i;r++){ub.write(e,"|");for(let i=0;i<n.length;i++){const s=t[n[i]];0===s.valueKind(r)?(ub.write(e,s.value(r)),ub.write(e,"|")):ub.write(e,".|")}ub.newline(e)}return ub.getString(e)}}(Nb||(Nb={})),function(t){t.ofTables=function(t,e,n){const i=Object.keys(n),r=Object.create(null),s=[];r._name=t,r._tableNames=s,r._schema=e;for(const t of i)Nb.is(n[t])&&(r[t]=n[t],s[s.length]=t);return r},t.getTablesAsRows=function(t){const e={};for(const n of t._tableNames)e[n]=Nb.getRows(t[n]);return e}}(Fb||(Fb={})),function(t){function e(t,e){const n=Object.keys(e);return{rowCount:n.length>0?e[n[0]].rowCount:0,name:t,fieldNames:n,getField:t=>e[t]}}t.empty=function(t){return{rowCount:0,name:t,fieldNames:[],getField(t){}}},t.ofFields=e,t.ofTable=function(t,n){const i={};for(const t of n._columns)i[t]=Bb.ofColumn(n[t]);return e(t,i)}}(Hb||(Hb={})),function(t){function e(t){const e=t.length,n=e=>{const n=t[e];return n&&"."!==n&&"?"!==n?n:""},i=e=>{const n=t[e];return hb(n,0,n.length)||0},r=e=>{const n=t[e];return pb(n,0,n.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:e,str:n,int:i,float:r,valueKind:e=>{const n=t[e],i=n.length;if(i>1)return 0;if(0===i)return 1;const r=n.charCodeAt(0);return 46===r?1:63===r?2:0},areValuesEqual:(e,n)=>t[e]===t[n],toStringArray:i=>i?Gy(e,n,i):t,toIntArray:t=>Gy(e,i,t),toFloatArray:t=>Gy(e,r,t)}}function n(t){const{rowCount:e,valueKind:n,areValuesEqual:i,isDefined:r}=t;let s,o,a;switch(t.schema.valueType){case"float":case"int":s=e=>""+t.value(e),o=t.value,a=t.value;break;case"str":s=t.value,o=e=>{const n=t.value(e);return hb(n,0,n.length)||0},a=e=>{const n=t.value(e);return pb(n,0,n.length)||0};break;case"list":const{separator:e}=t.schema;s=n=>t.value(n).join(e),o=t=>NaN,a=t=>NaN;break;default:throw new Error(`unsupported valueType '${t.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:r,rowCount:e,str:s,int:o,float:a,valueKind:n,areValuesEqual:i,toStringArray:t=>Gy(e,s,t),toIntArray:t=>Gy(e,o,t),toFloatArray:t=>Gy(e,a,t)}}t.ofString=function(t){return e([t])},t.ofStrings=e,t.ofNumbers=function(t){const e=t.length,n=e=>""+t[e],i=e=>t[e],r=n=>!n||n.array&&t instanceof n.array?t:Gy(e,i,n);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:e,str:n,int:i,float:i,valueKind:t=>0,areValuesEqual:(e,n)=>t[e]===t[n],toStringArray:t=>Gy(e,n,t),toIntArray:r,toFloatArray:r}},t.ofTokens=function(t){const{data:e,indices:n,count:i}=t,r=t=>{const i=e.substring(n[2*t],n[2*t+1]);return"."===i||"?"===i?"":i},s=t=>hb(e,n[2*t],n[2*t+1])||0,o=t=>pb(e,n[2*t],n[2*t+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:r,int:s,float:o,valueKind:t=>{const i=n[2*t],r=n[2*t+1]-i;if(r>1)return 0;if(0===r)return 1;const s=e.charCodeAt(i);return 46===s?1:63===s?2:0},areValuesEqual:Ub(t),toStringArray:t=>Gy(i,r,t),toIntArray:t=>Gy(i,s,t),toFloatArray:t=>Gy(i,o,t)}},t.ofColumn=n,t.ofUndefined=function(t,e){return n(lb.Undefined(t,e))}}(Bb||(Bb={}));const Gb="undefined"!=typeof setImmediate?"undefined"!=typeof window?{setImmediate:(t,...e)=>window.setImmediate(t,...e),clearImmediate:t=>window.clearImmediate(t)}:{setImmediate,clearImmediate}:function(){const t=function(){const t="undefined"!=typeof window&&window,e="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i=void 0!==n.g&&n.g;return t||i||e}(),e={},i="undefined"!=typeof document?document:void 0;let r,s=1;function o(t){delete e[t]}function a(t){const n=e[t];o(t),function(t){const e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(n)}return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?r=function(t){process.nextTick((function(){a(t)}))}:function(){if(t&&t.postMessage&&!t.importScripts){let e=!0;const n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){const e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&a(+n.data.slice(e.length))};window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n),r=function(t){window.postMessage(e+t,"*")}}():"undefined"!=typeof MessageChannel?function(){const t=new MessageChannel;t.port1.onmessage=function(t){a(t.data)},r=function(e){t.port2.postMessage(e)}}():i&&"onreadystatechange"in i.createElement("script")?function(){const t=i.documentElement;r=function(e){let n=i.createElement("script");n.onreadystatechange=function(){a(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():r=function(t){setTimeout(a,0,t)},{setImmediate:function(t,...n){"function"!=typeof t&&(t=new Function(""+t));const i={callback:t,args:n};return e[s]=i,r(s),s++},clearImmediate:o}}();function $b(t){Gb.setImmediate(t)}Gb.setImmediate,Gb.clearImmediate;!function(){try{return!0}catch(t){return!1}}(),function(){try{const t=process.env.DEBUG;return"*"===t||"molstar"===t}catch(t){return!1}}();const jb="undefined"!=typeof performance&&!!performance.mark&&performance.measure&&!1;var Wb;function qb(t){return{taskId:t.id,taskName:t.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function Xb(t){return e=>{t.abortRequested=!0,t.reason=e||t.reason}}function Yb(t){return{progress:xa({},t.progress),children:t.children.map(Yb)}}function Kb(t){return t.progress.canAbort&&t.children.every(Kb)}async function Zb(t,e){Wb.markStart(t),e.node.progress.startedTime=Eb();try{const n=await t.f(e);return Wb.markEnd(t),Wb.measure(t),e.info.abortToken.abortRequested&&Qb(e.info),n}catch(n){throw ix.isAbort(n)&&(e.isAborted=!0,e.node.children.length>0&&await new Promise((t=>{e.onChildrenFinished=t})),t.onAbort&&t.onAbort()),n}}function Qb(t){throw t.abortToken.treeAborted||(t.abortToken.treeAborted=!0,Jb(t.root),tx(t,Eb())),ix.Aborted(t.abortToken.reason)}function Jb(t){const e=t.progress;e.isIndeterminate=!0,e.canAbort=!1,e.message="Aborting...";for(const e of t.children)Jb(e)}function tx(t,e){t.lastNotified=e;const n=function(t){return{root:Yb(t.root),canAbort:Kb(t.root),requestAbort:t.tryAbort}}(t);t.observer(n)}!function(t){function e(t){return`startTask${t.id}`}function n(t){return`endTask${t.id}`}t.markStart=function(t){jb&&performance.mark(e(t))},t.markEnd=function(t){jb&&performance.mark(n(t))},t.measure=function(t){jb&&performance.measure(`✳️ ${t.name}`,e(t),n(t))}}(Wb||(Wb={}));class ex{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,Qb(this.info))}get shouldUpdate(){return this.checkAborted(),Eb()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(t){if(this.checkAborted(),!t)return;const e=this.node.progress;"string"==typeof t?(e.message=t,e.isIndeterminate=!0):(void 0!==t.canAbort&&(e.canAbort=t.canAbort),void 0!==t.message&&(e.message=t.message),void 0!==t.current&&(e.current=t.current),void 0!==t.max&&(e.max=t.max),e.isIndeterminate=void 0===e.current||void 0===e.max,void 0!==t.isIndeterminate&&(e.isIndeterminate=t.isIndeterminate))}update(t,e){if(this.lastUpdatedTime=Eb(),this.updateProgress(t),!e)return tx(this.info,this.lastUpdatedTime),this.checkAborted(),new Promise($b)}async runChild(t,e){this.updateProgress(e);const n={progress:qb(t),children:[]},i=this.node.children;i.push(n);const r=new ex(this.info,n);try{return await Zb(t,r)}catch(t){if(ix.isAbort(t)&&this.isAborted)return;throw t}finally{const t=i.indexOf(n);if(t>=0){for(let e=t,n=i.length-1;e<n;e++)i[e]=i[e+1];i.pop()}0===i.length&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(t,e){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=e,this.info=t}}const nx=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(t,e){}};var ix,rx,sx,ox,ax,lx;async function cx(t,e,n,i,r){let s=Math.max(e,0),o=0,a=0;if(t.isSynchronous)return i(Number.MAX_SAFE_INTEGER,n),n;let l=Eb(),c=0,u=0;for(;(c=i(s,n))>0;){o+=c;const e=Eb()-l;u+=e,a+=e,t.shouldUpdate&&(await r(t,n,o),s=Math.round(u*o/a)+1,l=Eb(),u=0)}return t.shouldUpdate&&await r(t,n,o),n}function ux(t){return{data:t,position:0,length:t.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function hx(t){for(;t.position<t.length;)switch(t.data.charCodeAt(t.position)){case 9:case 10:case 13:case 32:return void(t.tokenEnd=t.position);default:++t.position}t.tokenEnd=t.position}function dx(t){return!(t.length-t.position<2)&&39===t.data.charCodeAt(t.position+1)&&39===t.data.charCodeAt(t.position+2)}function px(t,e,n){let i;const r=n-e,s=t.tokenStart-e,o=t.tokenEnd-t.tokenStart;if(o<r)return!1;for(i=e;i<n;++i)if(t.data.charCodeAt(i)!==t.data.charCodeAt(i+s))return!1;return r===o||46===t.data.charCodeAt(i+s)}function fx(t){let e;for(e=t.tokenStart;e<t.tokenEnd;++e)if(46===t.data.charCodeAt(e))return e;return e}function mx(t,e){return t.data.substring(t.tokenStart,e)}function gx(t){return t.data.substring(t.tokenStart,t.tokenEnd)}function _x(t){const e=function(t){let e=10;for(;t.position<t.length;){const n=t.data.charCodeAt(t.position);switch(n){case 9:case 32:e=n,++t.position;break;case 10:13!==e&&++t.lineNumber,e=n,++t.position;break;case 13:e=n,++t.position,++t.lineNumber;break;default:return e}}return e}(t);if(t.position>=t.length)return void(t.tokenType=6);t.tokenStart=t.position,t.tokenEnd=t.position,t.isEscaped=!1;const n=t.data.charCodeAt(t.position);switch(n){case 35:!function(t){for(;t.position<t.length;){const e=t.data.charCodeAt(t.position);if(10===e||13===e)return;++t.position}}(t),t.tokenType=5;break;case 39:if(dx(t)){!function(t){for(t.position+=3;t.position<t.length;){if(39===t.data.charCodeAt(t.position)&&dx(t))return t.tokenStart+=3,t.tokenEnd=t.position,t.isEscaped=!0,void(t.position+=3);++t.position}t.tokenEnd=t.position}(t),t.tokenType=3;break}case 34:!function(t,e){let n,i;for(++t.position;t.position<t.length;)if(i=t.data.charCodeAt(t.position),i===e)switch(n=t.data.charCodeAt(t.position+1),n){case 9:case 10:case 13:case 32:return t.tokenStart++,t.tokenEnd=t.position,t.isEscaped=!0,void++t.position;default:if(void 0===n)return t.tokenStart++,t.tokenEnd=t.position,t.isEscaped=!0,void++t.position;++t.position}else{if(10===i||13===i)return void(t.tokenEnd=t.position);++t.position}t.tokenEnd=t.position}(t,n),t.tokenType=3;break;case 59:10===e||13===e?function(t){let e,n=59,i=t.position+1;for(;i<t.length;){if(e=t.data.charCodeAt(i),59===e&&(10===n||13===n)){for(t.position=i+1,t.tokenStart++,i--,e=t.data.charCodeAt(i);10===e||13===e;)i--,e=t.data.charCodeAt(i);return t.tokenEnd=i+1,void(t.isEscaped=!0)}(13===e||10===e&&13!==n)&&t.lineNumber++,n=e,++i}t.position=i}(t):hx(t),t.tokenType=3;break;default:t.isImportGet?function(t){for(;t.position<t.length;){if(93===t.data.charCodeAt(t.position))return++t.position,t.tokenEnd=t.position,void(t.isImportGet=!1);++t.position}}(t):hx(t),t.isEscaped?t.tokenType=3:95===t.data.charCodeAt(t.tokenStart)?(t.inSaveFrame&&function(t){return t.tokenEnd-t.tokenStart==11&&105===t.data.charCodeAt(t.tokenStart+1)&&109===t.data.charCodeAt(t.tokenStart+2)&&112===t.data.charCodeAt(t.tokenStart+3)&&111===t.data.charCodeAt(t.tokenStart+4)&&114===t.data.charCodeAt(t.tokenStart+5)&&116===t.data.charCodeAt(t.tokenStart+6)&&46===t.data.charCodeAt(t.tokenStart+7)&&103===t.data.charCodeAt(t.tokenStart+8)&&101===t.data.charCodeAt(t.tokenStart+9)&&116===t.data.charCodeAt(t.tokenStart+10)}(t)&&(t.isImportGet=!0),t.tokenType=4):t.tokenEnd-t.tokenStart>=5&&95===t.data.charCodeAt(t.tokenStart+4)?function(t){let e=t.data.charCodeAt(t.tokenStart);return!(68!==e&&100!==e||(e=t.data.charCodeAt(t.tokenStart+1),65!==e&&97!==e||(e=t.data.charCodeAt(t.tokenStart+2),84!==e&&116!==e||(e=t.data.charCodeAt(t.tokenStart+3),65!==e&&97!==e))))}(t)?t.tokenType=0:function(t){let e=t.data.charCodeAt(t.tokenStart);return!(83!==e&&115!==e||(e=t.data.charCodeAt(t.tokenStart+1),65!==e&&97!==e||(e=t.data.charCodeAt(t.tokenStart+2),86!==e&&118!==e||(e=t.data.charCodeAt(t.tokenStart+3),69!==e&&101!==e))))}(t)?t.tokenType=1:function(t){if(t.tokenEnd-t.tokenStart!=5)return!1;let e=t.data.charCodeAt(t.tokenStart);return!(76!==e&&108!==e||(e=t.data.charCodeAt(t.tokenStart+1),79!==e&&111!==e||(e=t.data.charCodeAt(t.tokenStart+2),79!==e&&111!==e||(e=t.data.charCodeAt(t.tokenStart+3),80!==e&&112!==e))))}(t)?t.tokenType=2:t.tokenType=3:t.tokenType=3}}function vx(t){for(_x(t);5===t.tokenType;)_x(t)}function yx(){return{categoryNames:[],categoryData:Object.create(null)}}function bx(t,e){const n=Object.create(null);for(const i of t){const t=e[i];n[i]=Hb(t.name,t.rowCount,t.fieldNames,t.fields)}return n}function xx(t,e,n){return Vb(t.categoryNames,bx(t.categoryNames,t.categoryData),e,n)}function wx(t,e){return Vb(t.categoryNames,bx(t.categoryNames,t.categoryData),e)}function Sx(t,e,n,i,r){if(e in t.categoryData){const n=t.categoryData[e];n.fieldNames.push(...i),Object.assign(n.fields,r)}else t.categoryData[e]={name:e,rowCount:n,fieldNames:i,fields:r},t.categoryNames.push(e)}function Ax(t,e){const n=t.tokenStart,i=fx(t),r=mx(t,i),s=Object.create(null),o=[];let a=!0;for(;a;){if(4!==t.tokenType||!px(t,n,i)){a=!1;break}const e=gx(t).substring(r.length+1);if(vx(t),3!==t.tokenType)return{hasError:!0,errorLine:t.lineNumber,errorMessage:"Expected value."};s[e]=Bb.ofTokens({data:t.data,indices:[t.tokenStart,t.tokenEnd],count:1}),o[o.length]=e,vx(t)}return Sx(e,r.substr(1),1,o,s),{hasError:!1,errorLine:0,errorMessage:""}}function Mx(t,e){const{tokenizer:n,tokens:i,fieldCount:r}=e;let s=e.tokenCount,o=0;for(;3===n.tokenType&&o<t;)ox.add(i[s++%r],n.tokenStart,n.tokenEnd),vx(n),o++;return e.tokenCount=s,o}function Cx(t,e){return t.update({message:"Parsing...",current:e.tokenizer.position,max:e.tokenizer.data.length})}async function Ex(t,e){const n=t.lineNumber;vx(t);const i=mx(t,fx(t)),r=function(t){let e;for(e=t.tokenStart;e<t.tokenEnd;++e)if(46===t.data.charCodeAt(e))return!1;return!0}(t),s=[];for(;4===t.tokenType;)s[s.length]=r?gx(t):gx(t).substring(i.length+1),vx(t);const o="_atom_site"===i?t.data.length/100|0:32,a=[],l=s.length;for(let e=0;e<l;e++)a[e]=ox.create(t.data,o);const c={fieldCount:l,tokenCount:0,tokenizer:t,tokens:a};if(await cx(t.runtimeCtx,1e6,c,Mx,Cx),c.tokenCount%l!=0)return{hasError:!0,errorLine:t.lineNumber,errorMessage:`The number of values for loop starting at line ${n} is not a multiple of the number of columns.`};const u=c.tokenCount/l|0;if(r)for(let t=0;t<l;t++){const n={"":Bb.ofTokens(a[t])};Sx(e,s[t].substr(1),u,[""],n)}else{const t=Object.create(null);for(let e=0;e<l;e++)t[s[e]]=Bb.ofTokens(a[e]);Sx(e,i.substr(1),u,s,t)}return{hasError:!1,errorLine:0,errorMessage:""}}function Tx(t,e){return ax.error(e,t)}function Px(t){return ix.create("Parse CIF",(async e=>await async function(t,e){const n=[],i=function(t,e){return{data:t,length:t.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:e}}(t,e);let r="",s=yx(),o=[],a=yx();const l=function(t,e){return{categoryNames:t,header:"",categories:e}}(a.categoryNames,bx(a.categoryNames,a.categoryData));let c="";for(e.update({message:"Parsing...",current:0,max:t.length}),vx(i);6!==i.tokenType;){const e=i.tokenType;if(0===e){if(i.inSaveFrame)return Tx(i.lineNumber,"Unexpected data block inside a save frame.");s.categoryNames.length>0&&n.push(xx(s,r,o)),r=t.substring(i.tokenStart+5,i.tokenEnd),s=yx(),o=[],vx(i)}else if(1===e){if(i.tokenEnd-i.tokenStart==5)a.categoryNames.length>0&&(o[o.length]=wx(a,c)),i.inSaveFrame=!1;else{if(i.inSaveFrame)return Tx(i.lineNumber,"Save frames cannot be nested.");i.inSaveFrame=!0,c=t.substring(i.tokenStart+5,i.tokenEnd),a=yx()}vx(i)}else if(2===e){const t=await Ex(i,i.inSaveFrame?a:s);if(t.hasError)return Tx(t.errorLine,t.errorMessage)}else{if(4!==e)return console.log(i.tokenType,ux.getTokenString(i)),Tx(i.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const t=Ax(i,i.inSaveFrame?a:s);if(t.hasError)return Tx(t.errorLine,t.errorMessage)}}}return i.inSaveFrame?Tx(i.lineNumber,`Unfinished save frame (${l.header}).`):((s.categoryNames.length>0||o.length>0)&&n.push(xx(s,r,o)),function(t){return ax.success(t)}(zb(n)))}(t,e)))}!function(t){class e{run(t,e=250){return t?function(t,e,n=250){const i=function(t,e,n){const i={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:n,lastNotified:Eb(),observer:e,abortToken:i,taskId:t.id,root:{progress:qb(t),children:[]},tryAbort:Xb(i)}}(t,e,n);return Zb(t,new ex(i,i.root))}(this,t,e):this.f(nx)}runAsChild(t,e){return t.isSynchronous?this.f(nx):function(t,e,n){return t.runChild(e,n)}(t,this,e)}runInContext(t){return t.isSynchronous?this.f(nx):function(t,e){return Zb(e,t)}(t,this)}constructor(t,e,n){this.name=t,this.f=e,this.onAbort=n,this.id=r()}}function n(t){const e=t;return!!t&&"number"==typeof e.id&&"string"==typeof e.name&&!!e.run}function i(t,n,i){return new e(t,n,i)}t.is=n,t.isAbort=function(t){return!!t&&!!t.isAborted},t.Aborted=function(t){return{isAborted:!0,reason:t,toString:()=>"Aborted"+(t?": "+t:"")}},t.create=i,t.constant=function(t,e){return i(t,(async t=>e))},t.empty=function(){return i("",(async t=>{}))},t.fail=function(t,e){return i(t,(async t=>{throw new Error(e)}))},t.resolveInContext=function(t,e){return n(t)?e?t.runInContext(e):t.run():t};const r=kb(0,1073741823)}(ix||(ix={})),function(t){t.Synchronous=nx}(rx||(rx={})),function(t){function e(t,n=""){const i=t.progress;if(!t.children.length)return i.isIndeterminate?`${n}${i.taskName}: ${i.message}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;const r=n+"  |_ ",s=t.children.map((t=>e(t,r)));return i.isIndeterminate?`${n}${i.taskName}: ${i.message}\n${s.join("\n")}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}\n${s.join("\n")}`}t.format=function(t){return e(t.root)}}(sx||(sx={})),function(t){function e(t){return t.data.substring(t.tokenStart,t.tokenEnd)}function n(t){const{data:e}=t;for(;t.position<t.length;)switch(e.charCodeAt(t.position)){case 10:return t.tokenEnd=t.position,++t.position,++t.lineNumber,!0;case 13:return t.tokenEnd=t.position,++t.position,++t.lineNumber,10===e.charCodeAt(t.position)&&++t.position,!0;default:++t.position}return t.tokenEnd=t.position,t.tokenStart!==t.tokenEnd}function i(t){return t.tokenStart=t.position,n(t)}function r(t,e,n){let r=0;for(let s=0;s<e;s++){if(!i(t))return r;ox.addUnchecked(n,t.tokenStart,t.tokenEnd),r++}return r}function s(t,e,n){const{data:i}=t;let r=e,s=n-1,o=i.charCodeAt(r);for(;(9===o||32===o)&&r<=s;)o=i.charCodeAt(++r);for(o=i.charCodeAt(s);(9===o||32===o)&&s>=r;)o=i.charCodeAt(--s);return t.tokenStart=r,t.tokenEnd=s+1,t.position=n,t}t.getTokenString=e,t.reset=function(t){t.position=0,t.lineNumber=1,t.tokenStart=0,t.tokenEnd=0},t.eatLine=n,t.markStart=function(t){t.tokenStart=t.position},t.markLine=i,t.readLine=function(t){return i(t),e(t)},t.readLineTrim=function(t){i(t);const n=t.position;return s(t,t.tokenStart,t.tokenEnd),t.position=n,e(t)},t.markLines=function(t,e){const n=ox.create(t.data,2*e);return r(t,e,n),n},t.readLines=function(e,n){const i=[];for(let r=0;r<n;r++)i.push(t.readLine(e));return i},t.readLinesAsync=async function(t,e,n,i=1e5){const s=ox.create(t.data,2*e);let o=0;return await cx(n,i,t,((t,n)=>{const i=Math.min(e-o,t);return r(n,i,s),o+=i,i}),((t,e)=>t.update({message:"Parsing...",current:e.position,max:e.length}))),s},t.readAllLines=function(e){const n=t(e),r=ox.create(n.data,Math.max(e.length/80,2));for(;i(n);)ox.add(r,n.tokenStart,n.tokenEnd);return r},t.readAllLinesAsync=async function(e,n,r=1e5){const s=t(e),o=ox.create(s.data,Math.max(e.length/80,2));return await cx(n,r,s,((t,e)=>(function(t,e,n){let r=0;for(let s=0;s<e;s++){if(!i(t))return r;ox.add(n,t.tokenStart,t.tokenEnd),r++}}(e,t,o),e.position<e.length?t:0)),((t,e)=>t.update({message:"Parsing...",current:e.position,max:e.length}))),o},t.eatValue=function(t){for(;t.position<t.length;)switch(t.data.charCodeAt(t.position)){case 9:case 10:case 13:case 32:return void(t.tokenEnd=t.position);default:++t.position}t.tokenEnd=t.position},t.skipWhitespace=function(t){let e=-1;for(;t.position<t.length;){const n=t.data.charCodeAt(t.position);switch(n){case 9:case 32:e=n,++t.position;break;case 10:13!==e&&++t.lineNumber,e=n,++t.position;break;case 13:e=n,++t.position,++t.lineNumber;break;default:return e}}return e},t.trim=s}(ux||(ux={})),function(t){function e(t,e,n){const i=t;i.offset>i.indicesLenMinus2&&function(t){const e=new Uint32Array(1.61*t.indices.length|0);e.set(t.indices),t.indices=e,t.indicesLenMinus2=e.length-2|0}(i),i.indices[i.offset++]=e,i.indices[i.offset++]=n,t.count++}t.add=e,t.addToken=function(t,n){e(t,n.tokenStart,n.tokenEnd)},t.addUnchecked=function(t,e,n){t.indices[t.offset++]=e,t.indices[t.offset++]=n,t.count++},t.create=function(t,e){return{data:t,indicesLenMinus2:(e=Math.max(10,e))-2|0,count:0,offset:0,indices:new Uint32Array(e)}}}(ox||(ox={})),function(t){t.error=function(t,n=-1){return new e(t,n)},t.success=function(t,e=[]){return new n(t,e)};class e{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(t,e){this.message=t,this.line=e,this.isError=!0}}t.Error=e;class n{constructor(t,e){this.result=t,this.warnings=e,this.isError=!1}}t.Success=n}(ax||(ax={})),function(t){var e,n;(e=t.IntDataType||(t.IntDataType={}))[e.Int8=1]="Int8",e[e.Int16=2]="Int16",e[e.Int32=3]="Int32",e[e.Uint8=4]="Uint8",e[e.Uint16=5]="Uint16",e[e.Uint32=6]="Uint32",(n=t.FloatDataType||(t.FloatDataType={}))[n.Float32=32]="Float32",n[n.Float64=33]="Float64",t.getDataType=function(e){let n;return n=e instanceof Int8Array?t.IntDataType.Int8:e instanceof Int16Array?t.IntDataType.Int16:e instanceof Int32Array?t.IntDataType.Int32:e instanceof Uint8Array?t.IntDataType.Uint8:e instanceof Uint16Array?t.IntDataType.Uint16:e instanceof Uint32Array?t.IntDataType.Uint32:e instanceof Float32Array?t.FloatDataType.Float32:e instanceof Float64Array?t.FloatDataType.Float64:t.IntDataType.Int32,n},t.isSignedIntegerDataType=function(t){if(t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array)return!0;for(let e=0,n=t.length;e<n;e++)if(e<0)return!1;return!0}}(lx||(lx={}));const Ix=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0];function Rx(t){let e=t.data;for(let n=t.encoding.length-1;n>=0;n--)e=kx(e,t.encoding[n]);return e}function kx(t,e){switch(e.kind){case"ByteArray":switch(e.type){case lx.IntDataType.Uint8:return t;case lx.IntDataType.Int8:return function(t){return new Int8Array(t.buffer,t.byteOffset)}(t);case lx.IntDataType.Int16:return function(t){return Ox(t,2,Int16Array)}(t);case lx.IntDataType.Uint16:return function(t){return Ox(t,2,Uint16Array)}(t);case lx.IntDataType.Int32:return function(t){return Ox(t,4,Int32Array)}(t);case lx.IntDataType.Uint32:return function(t){return Ox(t,4,Uint32Array)}(t);case lx.FloatDataType.Float32:return function(t){return Ox(t,4,Float32Array)}(t);case lx.FloatDataType.Float64:return function(t){return Ox(t,8,Float64Array)}(t);default:sb(e.type)}case"FixedPoint":return function(t,e){const n=t.length,i=Lx(e.srcType,n),r=1/e.factor;for(let e=0;e<n;e++)i[e]=r*t[e];return i}(t,e);case"IntervalQuantization":return function(t,e){const n=t.length,i=Lx(e.srcType,n),r=(e.max-e.min)/(e.numSteps-1),s=e.min;for(let e=0;e<n;e++)i[e]=s+r*t[e];return i}(t,e);case"RunLength":return function(t,e){const n=Dx(e.srcType,e.srcSize);let i=0;for(let e=0,r=t.length;e<r;e+=2){const r=t[e],s=t[e+1];for(let t=0;t<s;++t)n[i++]=r}return n}(t,e);case"Delta":return function(t,e){const n=t.length,i=Dx(e.srcType,n);if(!n)return t;i[0]=t[0]+(0|e.origin);for(let e=1;e<n;++e)i[e]=t[e]+i[e-1];return i}(t,e);case"IntegerPacking":return function(t,e){return t.length===e.srcSize?t:e.isUnsigned?function(t,e){const n=1===e.byteCount?255:65535,i=t.length,r=new Int32Array(e.srcSize);let s=0,o=0;for(;s<i;){let e=0,i=t[s];for(;i===n;)e+=i,s++,i=t[s];e+=i,r[o]=e,s++,o++}return r}(t,e):function(t,e){const n=1===e.byteCount?127:32767,i=-n-1,r=t.length,s=new Int32Array(e.srcSize);let o=0,a=0;for(;o<r;){let e=0,r=t[o];for(;r===n||r===i;)e+=r,o++,r=t[o];e+=r,s[a]=e,o++,a++}return s}(t,e)}(t,e);case"StringArray":return function(t,e){const n=Rx({encoding:e.offsetEncoding,data:e.offsets}),i=Rx({encoding:e.dataEncoding,data:t}),r=e.stringData,s=new Array(n.length);s[0]="";for(let t=1,e=n.length;t<e;t++)s[t]=r.substring(n[t-1],n[t]);let o=0;const a=new Array(i.length);for(let t=0,e=i.length;t<e;t++)a[o++]=s[i[t]+1];return a}(t,e)}}function Dx(t,e){switch(t){case lx.IntDataType.Int8:return new Int8Array(e);case lx.IntDataType.Int16:return new Int16Array(e);case lx.IntDataType.Int32:return new Int32Array(e);case lx.IntDataType.Uint8:return new Uint8Array(e);case lx.IntDataType.Uint16:return new Uint16Array(e);case lx.IntDataType.Uint32:return new Uint32Array(e);default:return new Int32Array(e)}}function Lx(t,e){switch(t){case lx.FloatDataType.Float32:return new Float32Array(e);case lx.FloatDataType.Float64:default:return new Float64Array(e)}}function Ox(t,e,n){return new n(Ix?t.buffer:function(t,e){const n=new ArrayBuffer(t.length),i=new Uint8Array(n);for(let n=0,r=t.length;n<r;n+=e)for(let r=0;r<e;r++)i[n+e-r-1]=t[n+r];return n}(t,e))}var Nx,Fx,Bx,Ux,zx;function Vx(t,e,n){let i,r=1;for(i=0;i<e;i++){const e=r*t;if(Math.abs(Math.round(e)-e)<=n)return i;r*=10}return-1}function Hx(t){return Fx.classify(t)}!function(t){function e(t){const e=t.growBy*t.elementSize;t.currentSize=e,t.currentIndex=0,t.currentChunk=new t.ctor(e),t.allocatedSize+=e,t.chunks[t.chunks.length]=t.currentChunk}function n(t,e){const{ctor:n,chunks:i,currentIndex:r}=t;if(!i.length)return new n(0);if(1===i.length&&(e||r===t.allocatedSize))return i[0];let s=0;for(let t=0,e=i.length-1;t<e;t++)s+=i[t].length;s+=t.currentIndex;const o=new n(s);let a=0;if(o.buffer)for(let t=0,e=i.length-1;t<e;t++)o.set(i[t],a),a+=i[t].length;else for(let t=0,e=i.length-1;t<e;t++){const e=i[t];for(let t=0,n=e.length;t<n;t++)o[a+t]=e[t];a+=e.length}const l=i[i.length-1];if(o.buffer&&r>=t.currentSize)o.set(l,a);else for(let t=0,e=l.length;t<e;t++)o[a+t]=l[t];return o}t.is=function(t){return t.creator&&t.chunkSize},t.add4=function(t,n,i,r,s){t.currentIndex>=t.currentSize&&e(t);const o=t.currentChunk,a=t.currentIndex;return o[a]=n,o[a+1]=i,o[a+2]=r,o[a+3]=s,t.currentIndex+=4,t.elementCount++},t.add3=function(t,n,i,r){t.currentIndex>=t.currentSize&&e(t);const s=t.currentChunk,o=t.currentIndex;return s[o]=n,s[o+1]=i,s[o+2]=r,t.currentIndex+=3,t.elementCount++},t.add2=function(t,n,i){t.currentIndex>=t.currentSize&&e(t);const r=t.currentChunk,s=t.currentIndex;return r[s]=n,r[s+1]=i,t.currentIndex+=2,t.elementCount++},t.add=function(t,n){return t.currentIndex>=t.currentSize&&e(t),t.currentChunk[t.currentIndex]=n,t.currentIndex+=1,t.elementCount++},t.addRepeat=function(t,n,i){for(let r=0;r<n;r++)t.currentIndex>=t.currentSize&&e(t),t.currentChunk[t.currentIndex++]=i,t.elementCount++;return t.elementCount},t.addMany=function(t,n){const{elementSize:i}=t;for(let r=0,s=n.length;r<s;r+=i){t.currentIndex>=t.currentSize&&e(t);const{currentChunk:s}=t;for(let e=0;e<i;e++)s[t.currentIndex++]=n[r+e];t.elementCount++}return t.elementCount},t.compact=function(t,e=!1){return n(t,e)},t._compact=n,t.create=function(t,e,n,i){const r={ctor:t,elementSize:e,growBy:Math.max(1,Math.ceil(n)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(void 0===i)return r;if("number"==typeof i)return r.currentChunk=new t(i*e),r.allocatedSize=i*e,r.currentSize=r.currentChunk.length,r.chunks[0]=r.currentChunk,r;const s=i;if(s.length%e!=0)throw new Error("initialChunk length must be a multiple of the element size.");return r.currentChunk=s,r.allocatedSize=s.length,r.currentSize=s.length,r.chunks[0]=s,r}}(Nx||(Nx={})),function(t){function e(t,e){return t>=0?Math.ceil((t+1)/e):Math.ceil((t+1)/(-e-1))}function n({limit8:t,limit16:n},i,r){i.pack8+=e(r,t),i.pack16+=e(r,n),i.count+=1}function i(t,n){t.pack8+=e(n,127),t.pack16+=e(n,32767),t.count+=1}function r(t){return 4*t.count<2*t.pack16?{length:4*t.count,elem:4}:2*t.pack16<t.pack8?{length:2*t.pack16,elem:2}:{length:t.pack8,elem:1}}function s(t,e){const i={pack8:0,pack16:0,count:0};for(let r=0,s=t.length;r<s;r++)n(e,i,t[r]);return xa(xa({},r(i)),{},{kind:"pack"})}function o(t,e){const n={pack8:0,pack16:0,count:0};let s=t[0];for(let e=1,r=t.length;e<r;e++)i(n,t[e]-s),s=t[e];return xa(xa({},r(n)),{},{kind:"delta"})}function a(t,e){const i={pack8:0,pack16:0,count:0};let s=1;for(let r=1,o=t.length;r<o;r++)t[r-1]!==t[r]?(n(e,i,t[r-1]),n(e,i,s),s=1):s++;return n(e,i,t[t.length-1]),n(e,i,s),xa(xa({},r(i)),{},{kind:"rle"})}function l(t,e){const n={pack8:0,pack16:0,count:0};let s=1,o=0,a=0;for(let e=1,r=t.length;e<r;e++){const r=t[e]-o;a!==r?(i(n,a),i(n,s),s=1):s++,a=r,o=t[e]}return i(n,a),i(n,s),xa(xa({},r(n)),{},{kind:"delta-rle"})}function c(t){const e=function(t){let e=!1;for(let n=0,i=t.length;n<i;n++)if(t[n]<0){e=!0;break}return e?{signed:e,limit8:127,limit16:32767}:{signed:e,limit8:255,limit16:65535}}(t),n=[s(t,e),a(t,e),o(t),l(t)];return n.sort(((t,e)=>t.length-e.length)),n}t.getSize=c,t.classify=function(t){if(t.length<2)return zx.by(zx.byteArray);switch(c(t)[0].kind){case"pack":return zx.by(zx.integerPacking);case"rle":return zx.by(zx.runLength).and(zx.integerPacking);case"delta":return zx.by(zx.delta).and(zx.integerPacking);case"delta-rle":return zx.by(zx.delta).and(zx.runLength).and(zx.integerPacking);default:sb()}}}(Fx||(Fx={})),function(t){t.classify=function(t){const{mantissaDigits:e,integerDigits:n}=function(t,e,n){let i=1,r=0;for(let e=0,s=t.length;e<s;e++){if(i>=0){const r=Vx(t[e],4,n);r<0?i=-1:r>i&&(i=r)}const s=Math.abs(t[e]);if(s>n){const t=Math.floor(Math.log10(Math.abs(s)))+1;t>r&&(r=t)}}return{mantissaDigits:i,integerDigits:r}}(t,0,1e-6);if(e<0||e+n>10)return zx.by(zx.byteArray);if(0===e)return Fx.classify(t);const i=function(t){let e=1;for(let n=0;n<t;n++)e*=10;return e}(e),r=new Int32Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=Math.round(i*t[e]);const s=Fx.getSize(r)[0],o=zx.by(zx.fixedPoint(i));switch(s.kind){case"pack":return o.and(zx.integerPacking);case"rle":return o.and(zx.runLength).and(zx.integerPacking);case"delta":return o.and(zx.delta).and(zx.integerPacking);case"delta-rle":return o.and(zx.delta).and(zx.runLength).and(zx.integerPacking);default:sb()}}}(Bx||(Bx={}));class Gx{and(t){return new Gx(this.providers.concat([t]))}encode(t){const e=[];for(const n of this.providers){const i=n(t);if(!i.encodings.length)throw new Error("Encodings must be non-empty.");t=i.data;for(const t of i.encodings)e.push(t)}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:e,data:t}}constructor(t){this.providers=t}}!function(t){function e(t){return new Gx([t])}function n(t){switch(t.kind){case"ByteArray":return zx.byteArray;case"FixedPoint":return zx.fixedPoint(t.factor);case"IntervalQuantization":return zx.intervalQuantizaiton(t.min,t.max,t.numSteps);case"RunLength":return zx.runLength;case"Delta":return zx.delta;case"IntegerPacking":return zx.integerPacking;case"StringArray":return zx.stringArray}}t.by=e,t.fromEncoding=function(t){let i=e(n(t[0]));for(let e=1;e<t.length&&"IntegerPacking"!==t[e-1].kind;e++)i=i.and(n(t[e]));return i}}(Ux||(Ux={})),function(t){t.by=function(t){return new Gx([t])};const e={[lx.IntDataType.Int16]:function(t,e,n){t.setInt16(2*e,n,!0)},[lx.IntDataType.Uint16]:function(t,e,n){t.setUint16(2*e,n,!0)},[lx.IntDataType.Int32]:function(t,e,n){t.setInt32(4*e,n,!0)},[lx.IntDataType.Uint32]:function(t,e,n){t.setUint32(4*e,n,!0)},[lx.FloatDataType.Float32]:function(t,e,n){t.setFloat32(4*e,n,!0)},[lx.FloatDataType.Float64]:function(t,e,n){t.setFloat64(8*e,n,!0)}},n={[lx.IntDataType.Int16]:2,[lx.IntDataType.Uint16]:2,[lx.IntDataType.Int32]:4,[lx.IntDataType.Uint32]:4,[lx.FloatDataType.Float32]:4,[lx.FloatDataType.Float64]:8};function i(t){const i=lx.getDataType(t);if(i===lx.IntDataType.Int8)return function(t){return{encodings:[{kind:"ByteArray",type:lx.IntDataType.Int8}],data:new Uint8Array(t.buffer,t.byteOffset)}}(t);if(i===lx.IntDataType.Uint8)return function(t){return{encodings:[{kind:"ByteArray",type:lx.IntDataType.Uint8}],data:t}}(t);const r=new Uint8Array(t.length*n[i]),s=e[i],o=new DataView(r.buffer);for(let e=0,n=t.length;e<n;e++)s(o,e,t[e]);return{encodings:[{kind:"ByteArray",type:i}],data:r}}function r(t,e){let n=0;for(let i=0,r=t.length;i<r;i++)n+=t[i]/e|0;return n+=t.length,n}function s(t,e){const n=-e-1;let i=0;for(let r=0,s=t.length;r<s;r++){const s=t[r];i+=s>=0?s/e|0:s/n|0}return i+=t.length,i}t.byteArray=i,t.fixedPoint=function(t){return e=>function(t,e){const n=lx.getDataType(t),i=new Int32Array(t.length);for(let n=0,r=t.length;n<r;n++)i[n]=Math.round(t[n]*e);return{encodings:[{kind:"FixedPoint",factor:e,srcType:n}],data:i}}(e,t)},t.intervalQuantizaiton=function(t,e,n,i=Int32Array){return r=>function(t,e,n,i,r){const s=lx.getDataType(t);if(!t.length)return{encodings:[{kind:"IntervalQuantization",min:e,max:n,numSteps:i,srcType:s}],data:new Int32Array(0)};if(n<e){const t=e;e=n,n=t}const o=(n-e)/(i-1),a=new r(t.length);for(let r=0,s=t.length;r<s;r++){const s=t[r];a[r]=s<=e?0:s>=n?i-1:0|Math.round((s-e)/o)}return{encodings:[{kind:"IntervalQuantization",min:e,max:n,numSteps:i,srcType:s}],data:a}}(r,t,e,n,i)},t.runLength=function(t){let e=lx.getDataType(t);if(void 0===e&&(t=new Int32Array(t),e=lx.IntDataType.Int32),!t.length)return{encodings:[{kind:"RunLength",srcType:e,srcSize:0}],data:new Int32Array(0)};let n=2;for(let e=1,i=t.length;e<i;e++)t[e-1]!==t[e]&&(n+=2);const i=new Int32Array(n);let r=0,s=1;for(let e=1,n=t.length;e<n;e++)t[e-1]!==t[e]?(i[r]=t[e-1],i[r+1]=s,s=1,r+=2):++s;return i[r]=t[t.length-1],i[r+1]=s,{encodings:[{kind:"RunLength",srcType:e,srcSize:t.length}],data:i}},t.delta=function(t){if(!lx.isSignedIntegerDataType(t))throw new Error("Only signed integer types can be encoded using delta encoding.");let e=lx.getDataType(t);if(void 0===e&&(t=new Int32Array(t),e=lx.IntDataType.Int32),!t.length)return{encodings:[{kind:"Delta",origin:0,srcType:e}],data:new t.constructor(0)};const n=new t.constructor(t.length),i=t[0];n[0]=t[0];for(let e=1,i=t.length;e<i;e++)n[e]=t[e]-t[e-1];return n[0]=0,{encodings:[{kind:"Delta",origin:i,srcType:e}],data:n}},t.integerPacking=function(t){const e=function(t){const e=function(t){for(let e=0,n=t.length;e<n;e++)if(t[e]<0)return!0;return!1}(t),n=e?s(t,127):r(t,255),i=e?s(t,32767):r(t,65535);return 4*t.length<2*i?{isSigned:e,size:t.length,bytesPerElement:4}:2*i<n?{isSigned:e,size:i,bytesPerElement:2}:{isSigned:e,size:n,bytesPerElement:1}}(t);return 4===e.bytesPerElement?i(t):function(t,e){const n=e.isSigned?1===e.bytesPerElement?127:32767:1===e.bytesPerElement?255:65535,r=-n-1,s=t.length,o=e.isSigned?1===e.bytesPerElement?new Int8Array(e.size):new Int16Array(e.size):1===e.bytesPerElement?new Uint8Array(e.size):new Uint16Array(e.size);let a=0;for(let e=0;e<s;e++){let i=t[e];if(i>=0)for(;i>=n;)o[a]=n,++a,i-=n;else for(;i<=r;)o[a]=r,++a,i-=r;o[a]=i,++a}const l=i(o);return{encodings:[{kind:"IntegerPacking",byteCount:e.bytesPerElement,isUnsigned:!e.isSigned,srcSize:s},l.encodings[0]],data:l.data}}(t,e)},t.stringArray=function(t){const e=Object.create(null),n=[],i=new Int32Array(t.length),r=Nx.create(Int32Array,1,Math.min(1024,t.length<32?t.length+1:Math.round(t.length/8)+1));Nx.add(r,0);let s=0,o=0;for(const a of t){if(null==a){i[o++]=-1;continue}let t=e[a];void 0===t&&(s+=a.length,t=n.length,n[t]=a,e[a]=t,Nx.add(r,s)),i[o++]=t}const a=Nx.compact(r),l=Hx(a).encode(a),c=Hx(i).encode(i);return{encodings:[{kind:"StringArray",dataEncoding:c.encoding,stringData:n.join(""),offsetEncoding:l.encoding,offsets:l.data}],data:c.data}}}(zx||(zx={}));const $x=function(){const t=[];for(let e=0;e<1024;e++)t[e]=String.fromCharCode(e);return t}();function jx(t){throw new Error(t)}const Wx="undefined"!=typeof TextDecoder?new TextDecoder:void 0;function qx(t,e){const n={};for(let i=0;i<e;i++)n[Zx(t)]=Zx(t);return n}function Xx(t,e){const n=new Uint8Array(e),i=t.offset;for(let r=0;r<e;r++)n[r]=t.buffer[r+i];return t.offset+=e,n}function Yx(t,e){const n=function(t,e,n){if(Wx){const i=e||n!==t.length?t.subarray(e,e+n):t;return Wx.decode(i)}return function(t,e,n){const i=$x;let r,s=0;const o=[];for(let a=e,l=e+n;a<l;a++){const e=t[a];128&e?192==(224&e)?o[s++]=i[(15&e)<<6|63&t[++a]]:224==(240&e)?o[s++]=String.fromCharCode((15&e)<<12|(63&t[++a])<<6|63&t[++a]):240==(248&e)?o[s++]=String.fromCharCode((7&e)<<18|(63&t[++a])<<12|(63&t[++a])<<6|63&t[++a]):jx("Invalid byte "+e.toString(16)):o[s++]=i[e],512===s&&(r=r||[],r[r.length]=o.join(""),s=0)}return r?(s>0&&(r[r.length]=o.slice(0,s).join("")),r.join("")):o.slice(0,s).join("")}(t,e,n)}(t.buffer,t.offset,e);return t.offset+=e,n}function Kx(t,e){const n=new Array(e);for(let i=0;i<e;i++)n[i]=Zx(t);return n}function Zx(t){const e=t.buffer[t.offset];let n,i;if(!(128&e))return t.offset++,e;if(128==(240&e))return i=15&e,t.offset++,qx(t,i);if(144==(240&e))return i=15&e,t.offset++,Kx(t,i);if(160==(224&e))return i=31&e,t.offset++,Yx(t,i);if(!(224&~e))return n=t.dataView.getInt8(t.offset),t.offset++,n;switch(e){case 192:return t.offset++,null;case 194:return t.offset++,!1;case 195:return t.offset++,!0;case 196:return i=t.dataView.getUint8(t.offset+1),t.offset+=2,Xx(t,i);case 197:return i=t.dataView.getUint16(t.offset+1),t.offset+=3,Xx(t,i);case 198:return i=t.dataView.getUint32(t.offset+1),t.offset+=5,Xx(t,i);case 202:return n=t.dataView.getFloat32(t.offset+1),t.offset+=5,n;case 203:return n=t.dataView.getFloat64(t.offset+1),t.offset+=9,n;case 204:return n=t.buffer[t.offset+1],t.offset+=2,n;case 205:return n=t.dataView.getUint16(t.offset+1),t.offset+=3,n;case 206:return n=t.dataView.getUint32(t.offset+1),t.offset+=5,n;case 208:return n=t.dataView.getInt8(t.offset+1),t.offset+=2,n;case 209:return n=t.dataView.getInt16(t.offset+1),t.offset+=3,n;case 210:return n=t.dataView.getInt32(t.offset+1),t.offset+=5,n;case 217:return i=t.dataView.getUint8(t.offset+1),t.offset+=2,Yx(t,i);case 218:return i=t.dataView.getUint16(t.offset+1),t.offset+=3,Yx(t,i);case 219:return i=t.dataView.getUint32(t.offset+1),t.offset+=5,Yx(t,i);case 220:return i=t.dataView.getUint16(t.offset+1),t.offset+=3,Kx(t,i);case 221:return i=t.dataView.getUint32(t.offset+1),t.offset+=5,Kx(t,i);case 222:return i=t.dataView.getUint16(t.offset+1),t.offset+=3,qx(t,i);case 223:return i=t.dataView.getUint32(t.offset+1),t.offset+=5,qx(t,i)}throw new Error("Unknown type 0x"+e.toString(16))}function Qx(t){const e=Object.create(null),n=Object.create(null);for(const n of t.columns)e[n.name]=n;return{rowCount:t.rowCount,name:t.name.substr(1),fieldNames:t.columns.map((t=>t.name)),getField(t){const i=e[t];if(i)return n[t]||(n[t]=function(t){const e=t.mask?Rx(t.mask):void 0,n=Rx(t.data),i=$y(n),r=i?e?t=>0===e[t]?""+n[t]:"":t=>""+n[t]:e?t=>0===e[t]?n[t]:"":t=>n[t],s=i?t=>n[t]:t=>{const e=n[t];return hb(e,0,e.length)},o=i?t=>n[t]:t=>{const e=n[t];return pb(e,0,e.length)},a=e?t=>e[t]:t=>0,l=n.length;return{__array:n,binaryEncoding:t.data.encoding,isDefined:!0,rowCount:l,str:r,int:s,float:o,valueKind:a,areValuesEqual:(t,e)=>n[t]===n[e],toStringArray:t=>Gy(l,r,t),toIntArray:i?t=>jy(n,t):t=>Gy(l,s,t),toFloatArray:i?t=>jy(n,t):t=>Gy(l,o,t)}}(i)),n[t]}}}function Jx(t){return ix.create("Parse BinaryCIF",(async e=>{const n=[0,3];try{const e=Zx({buffer:i=t,offset:0,dataView:new DataView(i.buffer)});if(!function(t,e){for(let n=0;n<2;n++)if(t[n]>e[n])return!1;return!0}(n,e.version.match(/(\d)\.(\d)\.\d/).slice(1).map((t=>+t))))return ax.error(`Unsupported format version. Current ${e.version}, required ${n.join(".")}.`);const r=zb(e.dataBlocks.map((t=>{const e=Object.create(null);for(const n of t.categories)e[n.name.substr(1)]=Qx(n);return Vb(t.categories.map((t=>t.name.substr(1))),e,t.header)})));return ax.success(r)}catch(t){return ax.error(""+t)}var i}))}var tw;function ew(t,e,n){return function(t,e,n){const i=Object.create(null);for(const r of Object.keys(t))i[r]=lw(r,t[r],e,n);return Fb.ofTables(e.header,t,i)}(t,e,n)}function nw(t){switch(t.valueType){case"str":return(e,n,i)=>function(t,e,n,i){return{schema:t,__array:e.__array,isDefined:e.isDefined,rowCount:e.rowCount,value:"lowercase"===t.transform?t=>n(t).toLowerCase():"uppercase"===t.transform?t=>n(t).toUpperCase():n,valueKind:e.valueKind,areValuesEqual:e.areValuesEqual,toArray:"lowercase"===t.transform?t=>Array.from(i(t)).map((t=>t.toLowerCase())):"uppercase"===t.transform?t=>Array.from(i(t)).map((t=>t.toUpperCase())):i}}(t,e,e.str,e.toStringArray);case"int":return(e,n,i)=>iw(t,e,e.int,e.toIntArray);case"float":return(e,n,i)=>iw(t,e,e.float,e.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function iw(t,e,n,i){return{schema:t,__array:e.__array,isDefined:e.isDefined,rowCount:e.rowCount,value:n,valueKind:e.valueKind,areValuesEqual:e.areValuesEqual,toArray:i}}function rw(t,e,n){const i=t.separator,r=t.itemParse,s=e.getField(n),o=s?t=>s.str(t).split(i).map((t=>r(t.trim()))).filter((t=>!!t)):t=>[];return{schema:t,__array:void 0,isDefined:!!s,rowCount:e.rowCount,value:o,valueKind:s?s.valueKind:()=>1,areValuesEqual:(t,e)=>function(t,e){const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}(o(t),o(e)),toArray:t=>Gy(e.rowCount,o,t)}}function sw(t,e,n){const i=t.space,r=e.fieldNames.includes(`${n}[0]`)||e.fieldNames.includes(`${n}[0][0]`)||e.fieldNames.includes(`${n}[0][0][0]`),s=r?0:1,o=e.fieldNames.includes(`${n}_1`)||e.fieldNames.includes(`${n}_11`)||e.fieldNames.includes(`${n}_111`)?"underscore":"brackets",a=function(t,e,n,i){const r=n?0:1;switch(e){case 1:return"brackets"===i?e=>`${t}[${e+r}]`:e=>`${t}_${e+r}`;case 2:return"brackets"===i?(e,n)=>`${t}[${e+r}][${n+r}]`:(e,n)=>`${t}_${e+r}${n+r}`;case 3:return"brackets"===i?(e,n,i)=>`${t}[${e+r}][${n+r}][${i+r}]`:(e,n,i)=>`${t}_${e+r}${n+r}${i+r}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(n,i.rank,r,o),l=e.getField(a(s,s,s))||lb.Undefined(e.rowCount,t),c=t=>function(t,e,n,i){const r=e.create();if(1===e.rank){const s=e.dimensions[0];for(let o=0;o<s;o++){const s=t.getField(i(o));e.set(r,o,s?s.float(n):0)}}else if(2===e.rank){const s=e.dimensions[0],o=e.dimensions[1];for(let a=0;a<s;a++)for(let s=0;s<o;s++){const o=t.getField(i(a,s));e.set(r,a,s,o?o.float(n):0)}}else{if(3!==e.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const s=e.dimensions[0],o=e.dimensions[1],a=e.dimensions[2];for(let l=0;l<s;l++)for(let s=0;s<o;s++)for(let o=0;o<a;o++){const a=t.getField(i(l,s,o));e.set(r,l,s,o,a?a.float(n):0)}}}return r}(e,i,t,a);return{schema:t,__array:void 0,isDefined:l.isDefined,rowCount:e.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(t,e)=>ab.areEqualExact(c(t),c(e)),toArray:t=>Gy(e.rowCount,c,t)}}!function(t){function e(t){return t.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}t.canonical=e,t.equal=function(t,n){return e(t)===e(n)},t.create=function(t,n,i=!1){const r=`${t}${n?`.${n}`:""}`;return i?e(r):r}}(tw||(tw={}));class ow{constructor(t,e,n){this._isDefined=n;const i=Object.keys(e);this._rowCount=t.rowCount,this._columns=i,this._schema=e;const r=Object.create(null);for(const n of i)Object.defineProperty(this,n,{get:function(){if(r[n])return r[n];const i=e[n];if("list"===i.valueType)r[n]=rw(i,t,n);else if("tensor"===i.valueType)r[n]=sw(i,t,n);else{const e=nw(i),s=t.getField(n);r[n]=s?e(s,t,n):lb.Undefined(t.rowCount,i)}return r[n]},enumerable:!0,configurable:!1})}}function aw(t,e,n,i){const r=tw.create(e,t),s=tw.canonical(r);if(s in n)return n[s];if(i&&r in i)for(const t of i[r]){const e=tw.canonical(t);if(e in n)return n[e]}}function lw(t,e,n,i){let r=n.categories[t];if(i){const s=function(t){const e=Object.create(null);for(const n of Object.keys(t.categories))for(const i of t.categories[n].fieldNames)e[tw.create(n,i,!0)]=t.categories[n].getField(i);return e}(n),o=Object.create(null),a=[];let l=0;for(const n of Object.keys(e)){const e=aw(n,t,s,i);e&&(o[n]=e,a.push(n),l=e.rowCount)}r={rowCount:l,name:t,fieldNames:[...a],getField:t=>o[t]}}return new ow(r||Hb.empty(t),e,!!r)}var cw=lb.Schema;const uw=cw.str,hw=cw.int,dw=cw.float,pw=cw.coord,fw=cw.Aliased,mw=cw.Matrix,gw=cw.Vector,_w=cw.lstr,vw=cw.List,yw={atom_site:{auth_asym_id:uw,auth_atom_id:uw,auth_comp_id:uw,auth_seq_id:hw,B_iso_or_equiv:dw,Cartn_x:pw,Cartn_y:pw,Cartn_z:pw,group_PDB:fw(uw),id:hw,label_alt_id:uw,label_asym_id:uw,label_atom_id:uw,label_comp_id:uw,label_entity_id:uw,label_seq_id:hw,occupancy:dw,type_symbol:uw,pdbx_PDB_ins_code:uw,pdbx_PDB_model_num:hw,pdbx_formal_charge:hw,pdbx_label_index:hw,pdbx_sifts_xref_db_name:uw,pdbx_sifts_xref_db_acc:uw,pdbx_sifts_xref_db_num:uw,pdbx_sifts_xref_db_res:uw,ihm_model_id:hw},atom_site_anisotrop:{id:hw,type_symbol:uw,U:mw(3,3),U_esd:mw(3,3),pdbx_auth_seq_id:uw,pdbx_auth_asym_id:uw,pdbx_auth_atom_id:uw,pdbx_auth_comp_id:uw,pdbx_label_seq_id:hw,pdbx_label_alt_id:uw,pdbx_label_asym_id:uw,pdbx_label_atom_id:uw,pdbx_label_comp_id:uw,pdbx_PDB_ins_code:uw},atom_sites:{entry_id:uw,fract_transf_matrix:mw(3,3),fract_transf_vector:gw(3)},audit_author:{name:uw,pdbx_ordinal:hw,identifier_ORCID:uw},audit_conform:{dict_location:uw,dict_name:uw,dict_version:uw},cell:{angle_alpha:dw,angle_beta:dw,angle_gamma:dw,entry_id:uw,length_a:dw,length_b:dw,length_c:dw,Z_PDB:hw,pdbx_unique_axis:uw},chem_comp:{formula:uw,formula_weight:dw,id:uw,mon_nstd_flag:fw(_w),name:uw,type:fw(_w),pdbx_synonyms:vw(";",(t=>t))},chem_comp_bond:{atom_id_1:uw,atom_id_2:uw,comp_id:uw,value_order:fw(_w),pdbx_ordinal:hw,pdbx_stereo_config:fw(_w),pdbx_aromatic_flag:fw(_w)},citation:{book_publisher:uw,country:uw,id:uw,journal_abbrev:uw,journal_id_ASTM:uw,journal_id_CSD:uw,journal_id_ISSN:uw,journal_volume:uw,page_first:uw,page_last:uw,title:uw,year:hw,pdbx_database_id_DOI:uw,pdbx_database_id_PubMed:hw},citation_author:{citation_id:uw,name:uw,ordinal:hw},database_2:{database_id:fw(_w),database_code:uw},entity:{details:uw,formula_weight:dw,id:uw,src_method:fw(_w),type:fw(_w),pdbx_description:vw(",",(t=>t)),pdbx_number_of_molecules:hw,pdbx_mutation:uw,pdbx_fragment:uw,pdbx_ec:vw(",",(t=>t))},entity_poly:{entity_id:uw,nstd_linkage:fw(_w),nstd_monomer:fw(_w),type:fw(uw),pdbx_strand_id:vw(",",(t=>t)),pdbx_seq_one_letter_code:uw,pdbx_seq_one_letter_code_can:uw,pdbx_target_identifier:uw},entity_poly_seq:{entity_id:uw,hetero:fw(_w),mon_id:uw,num:hw},entry:{id:uw},exptl:{entry_id:uw,method:fw(uw)},software:{classification:uw,date:uw,description:uw,name:uw,type:fw(_w),version:uw,pdbx_ordinal:hw},struct:{entry_id:uw,title:uw,pdbx_descriptor:uw},struct_asym:{details:uw,entity_id:uw,id:uw,pdbx_modified:uw,pdbx_blank_PDB_chainid_flag:fw(uw)},struct_conf:{beg_label_asym_id:uw,beg_label_comp_id:uw,beg_label_seq_id:hw,beg_auth_asym_id:uw,beg_auth_comp_id:uw,beg_auth_seq_id:hw,conf_type_id:fw(_w),details:uw,end_label_asym_id:uw,end_label_comp_id:uw,end_label_seq_id:hw,end_auth_asym_id:uw,end_auth_comp_id:uw,end_auth_seq_id:hw,id:uw,pdbx_beg_PDB_ins_code:uw,pdbx_end_PDB_ins_code:uw,pdbx_PDB_helix_class:uw,pdbx_PDB_helix_length:hw,pdbx_PDB_helix_id:uw},struct_conn:{conn_type_id:fw(_w),details:uw,id:uw,ptnr1_label_asym_id:uw,ptnr1_label_atom_id:uw,ptnr1_label_comp_id:uw,ptnr1_label_seq_id:hw,ptnr1_auth_asym_id:uw,ptnr1_auth_comp_id:uw,ptnr1_auth_seq_id:hw,ptnr1_symmetry:uw,ptnr2_label_asym_id:uw,ptnr2_label_atom_id:uw,ptnr2_label_comp_id:uw,ptnr2_label_seq_id:hw,ptnr2_auth_asym_id:uw,ptnr2_auth_comp_id:uw,ptnr2_auth_seq_id:hw,ptnr2_symmetry:uw,pdbx_ptnr1_PDB_ins_code:uw,pdbx_ptnr1_label_alt_id:uw,pdbx_ptnr1_standard_comp_id:uw,pdbx_ptnr2_PDB_ins_code:uw,pdbx_ptnr2_label_alt_id:uw,pdbx_ptnr3_PDB_ins_code:uw,pdbx_ptnr3_label_alt_id:uw,pdbx_ptnr3_label_asym_id:uw,pdbx_ptnr3_label_atom_id:uw,pdbx_ptnr3_label_comp_id:uw,pdbx_ptnr3_label_seq_id:hw,pdbx_PDB_id:uw,pdbx_dist_value:dw,pdbx_value_order:fw(_w)},struct_conn_type:{criteria:uw,id:fw(_w),reference:uw},struct_keywords:{entry_id:uw,text:vw(",",(t=>t)),pdbx_keywords:uw},struct_ncs_oper:{code:fw(uw),details:uw,id:hw,matrix:mw(3,3),vector:gw(3)},struct_sheet_range:{beg_label_asym_id:uw,beg_label_comp_id:uw,beg_label_seq_id:hw,end_label_asym_id:uw,end_label_comp_id:uw,end_label_seq_id:hw,beg_auth_asym_id:uw,beg_auth_comp_id:uw,beg_auth_seq_id:hw,end_auth_asym_id:uw,end_auth_comp_id:uw,end_auth_seq_id:hw,id:uw,sheet_id:uw,pdbx_beg_PDB_ins_code:uw,pdbx_end_PDB_ins_code:uw},struct_site:{details:uw,id:uw,pdbx_num_residues:hw,pdbx_evidence_code:uw,pdbx_auth_asym_id:uw,pdbx_auth_comp_id:uw,pdbx_auth_seq_id:uw,pdbx_auth_ins_code:uw},struct_site_gen:{details:uw,id:uw,label_alt_id:uw,label_asym_id:uw,label_atom_id:uw,label_comp_id:uw,label_seq_id:hw,auth_asym_id:uw,auth_comp_id:uw,auth_seq_id:uw,site_id:uw,symmetry:uw,pdbx_auth_ins_code:uw,pdbx_num_res:hw},symmetry:{entry_id:uw,cell_setting:fw(_w),Int_Tables_number:hw,space_group_name_Hall:uw,"space_group_name_H-M":uw},pdbx_database_status:{status_code:fw(uw),status_code_sf:fw(uw),status_code_mr:fw(uw),entry_id:uw,recvd_initial_deposition_date:uw,SG_entry:fw(_w),deposit_site:fw(uw),process_site:fw(uw),status_code_cs:fw(uw),methods_development_category:fw(uw),pdb_format_compatible:fw(_w)},pdbx_nonpoly_scheme:{asym_id:uw,entity_id:uw,mon_id:uw,pdb_strand_id:uw,ndb_seq_num:uw,pdb_seq_num:uw,auth_seq_num:uw,pdb_mon_id:uw,auth_mon_id:uw,pdb_ins_code:uw},pdbx_database_related:{db_name:uw,details:uw,db_id:uw,content_type:fw(uw)},pdbx_entity_nonpoly:{entity_id:uw,comp_id:uw,name:uw},pdbx_chem_comp_synonyms:{name:uw,comp_id:uw,provenance:fw(uw)},pdbx_chem_comp_identifier:{comp_id:uw,identifier:uw,type:fw(uw),program:uw,program_version:uw},pdbx_unobs_or_zero_occ_residues:{id:hw,polymer_flag:fw(_w),occupancy_flag:fw(hw),PDB_model_num:hw,auth_asym_id:uw,auth_comp_id:uw,auth_seq_id:uw,PDB_ins_code:uw,label_asym_id:uw,label_comp_id:uw,label_seq_id:hw},pdbx_struct_mod_residue:{id:hw,auth_asym_id:uw,auth_comp_id:uw,auth_seq_id:hw,PDB_ins_code:uw,label_asym_id:uw,label_comp_id:uw,label_seq_id:hw,parent_comp_id:uw,details:uw},pdbx_struct_oper_list:{id:uw,type:fw(uw),name:uw,symmetry_operation:uw,matrix:mw(3,3),vector:gw(3)},pdbx_struct_assembly:{method_details:uw,oligomeric_details:uw,oligomeric_count:hw,details:uw,id:uw},pdbx_struct_assembly_gen:{asym_id_list:vw(",",(t=>t)),assembly_id:uw,oper_expression:uw},pdbx_reference_entity_list:{prd_id:uw,ref_entity_id:uw,type:fw(_w),details:uw,component_id:hw},pdbx_reference_entity_link:{link_id:hw,prd_id:uw,details:uw,ref_entity_id_1:uw,ref_entity_id_2:uw,entity_seq_num_1:hw,entity_seq_num_2:hw,comp_id_1:uw,comp_id_2:uw,atom_id_1:uw,atom_id_2:uw,value_order:fw(_w),component_1:hw,component_2:hw,link_class:fw(uw)},pdbx_reference_entity_poly_link:{link_id:hw,prd_id:uw,ref_entity_id:uw,component_id:hw,entity_seq_num_1:hw,entity_seq_num_2:hw,comp_id_1:uw,comp_id_2:uw,atom_id_1:uw,atom_id_2:uw,value_order:fw(_w)},pdbx_molecule:{prd_id:uw,instance_id:hw,asym_id:uw},pdbx_molecule_features:{prd_id:uw,class:fw(_w),type:fw(_w),name:uw,details:uw},entity_src_nat:{entity_id:uw,pdbx_organism_scientific:uw,pdbx_plasmid_name:uw,pdbx_src_id:hw,pdbx_beg_seq_num:hw,pdbx_end_seq_num:hw},entity_src_gen:{entity_id:uw,pdbx_gene_src_gene:vw(",",(t=>t)),pdbx_gene_src_scientific_name:uw,plasmid_name:uw,pdbx_src_id:hw,pdbx_beg_seq_num:hw,pdbx_end_seq_num:hw},pdbx_entity_src_syn:{organism_scientific:uw,entity_id:uw,pdbx_src_id:hw,pdbx_beg_seq_num:hw,pdbx_end_seq_num:hw},pdbx_entity_branch_descriptor:{entity_id:uw,descriptor:uw,type:fw(_w),program:uw,program_version:uw,ordinal:hw},pdbx_entity_instance_feature:{details:uw,feature_type:fw(uw),auth_asym_id:uw,asym_id:uw,auth_seq_num:uw,seq_num:hw,comp_id:uw,auth_comp_id:uw,ordinal:hw},pdbx_entity_branch_list:{entity_id:uw,hetero:fw(_w),comp_id:uw,num:hw},pdbx_entity_branch_link:{link_id:hw,details:uw,entity_id:uw,entity_branch_list_num_1:hw,entity_branch_list_num_2:hw,comp_id_1:uw,comp_id_2:uw,atom_id_1:uw,leaving_atom_id_1:uw,atom_stereo_config_1:fw(_w),atom_id_2:uw,leaving_atom_id_2:uw,atom_stereo_config_2:fw(_w),value_order:fw(_w)},pdbx_entity_branch:{entity_id:uw,type:fw(uw)},pdbx_branch_scheme:{entity_id:uw,hetero:fw(_w),asym_id:uw,mon_id:uw,num:hw,pdb_asym_id:uw,pdb_seq_num:uw,pdb_mon_id:uw,auth_asym_id:uw,auth_seq_num:uw,auth_mon_id:uw},pdbx_chem_comp_related:{comp_id:uw,related_comp_id:uw,relationship_type:fw(uw),details:uw},ihm_starting_model_details:{starting_model_id:uw,entity_id:uw,entity_description:uw,asym_id:uw,entity_poly_segment_id:hw,starting_model_source:fw(uw),starting_model_auth_asym_id:uw,starting_model_sequence_offset:hw,dataset_list_id:hw},ihm_starting_comparative_models:{id:hw,starting_model_id:uw,starting_model_auth_asym_id:uw,starting_model_seq_id_begin:hw,starting_model_seq_id_end:hw,template_auth_asym_id:uw,template_seq_id_begin:hw,template_seq_id_end:hw,template_sequence_identity:dw,template_sequence_identity_denominator:fw(hw),template_dataset_list_id:hw,alignment_file_id:hw},ihm_starting_model_seq_dif:{id:hw,entity_id:uw,asym_id:uw,seq_id:hw,comp_id:uw,starting_model_id:uw,db_asym_id:uw,db_seq_id:hw,db_comp_id:uw,details:uw},ihm_model_representation:{id:hw,name:uw,details:uw},ihm_model_representation_details:{id:hw,representation_id:hw,entity_poly_segment_id:hw,entity_id:uw,entity_description:uw,entity_asym_id:uw,model_object_primitive:fw(uw),starting_model_id:uw,model_mode:fw(uw),model_granularity:fw(uw),model_object_count:hw},ihm_struct_assembly_details:{id:hw,assembly_id:hw,parent_assembly_id:hw,entity_description:uw,entity_id:uw,asym_id:uw,entity_poly_segment_id:hw},ihm_struct_assembly:{id:hw,name:uw,description:uw},ihm_modeling_protocol:{id:hw,num_steps:hw,protocol_name:uw},ihm_modeling_protocol_details:{id:hw,protocol_id:hw,step_id:hw,struct_assembly_id:hw,dataset_group_id:hw,struct_assembly_description:uw,step_name:uw,step_method:uw,num_models_begin:hw,num_models_end:hw,multi_scale_flag:fw(_w),multi_state_flag:fw(_w),ordered_flag:fw(_w),script_file_id:hw,software_id:hw},ihm_multi_state_modeling:{state_id:hw,state_group_id:hw,population_fraction:dw,population_fraction_sd:dw,state_type:uw,state_name:uw,experiment_type:fw(uw),details:uw},ihm_modeling_post_process:{id:hw,protocol_id:hw,analysis_id:hw,step_id:hw,type:fw(uw),feature:fw(uw),num_models_begin:hw,num_models_end:hw},ihm_ensemble_info:{ensemble_id:hw,ensemble_name:uw,post_process_id:hw,model_group_id:hw,ensemble_clustering_method:fw(uw),ensemble_clustering_feature:fw(uw),num_ensemble_models:hw,num_ensemble_models_deposited:hw,ensemble_precision_value:dw,ensemble_file_id:hw},ihm_model_list:{model_id:hw,model_name:uw,assembly_id:hw,protocol_id:hw,representation_id:hw},ihm_model_group:{id:hw,name:uw,details:uw},ihm_model_group_link:{model_id:hw,group_id:hw},ihm_model_representative:{id:hw,model_group_id:hw,model_id:hw,selection_criteria:fw(uw)},ihm_dataset_list:{id:hw,data_type:fw(uw),database_hosted:fw(_w)},ihm_dataset_group:{id:hw,name:uw,application:fw(uw),details:uw},ihm_dataset_group_link:{dataset_list_id:hw,group_id:hw},ihm_related_datasets:{dataset_list_id_derived:hw,dataset_list_id_primary:hw},ihm_dataset_related_db_reference:{id:hw,dataset_list_id:hw,db_name:fw(uw),accession_code:uw,version:uw,details:uw},ihm_external_reference_info:{reference_id:hw,reference_provider:uw,reference_type:fw(uw),reference:uw,refers_to:fw(uw),associated_url:uw},ihm_external_files:{id:hw,reference_id:hw,file_path:uw,content_type:fw(uw),file_size_bytes:dw,details:uw},ihm_dataset_external_reference:{id:hw,dataset_list_id:hw,file_id:hw},ihm_localization_density_files:{id:hw,file_id:hw,ensemble_id:hw,entity_id:uw,entity_poly_segment_id:hw,asym_id:uw},ihm_predicted_contact_restraint:{id:hw,group_id:hw,entity_id_1:uw,entity_id_2:uw,asym_id_1:uw,asym_id_2:uw,comp_id_1:uw,comp_id_2:uw,seq_id_1:hw,seq_id_2:hw,rep_atom_1:fw(uw),rep_atom_2:fw(uw),distance_lower_limit:dw,distance_upper_limit:dw,probability:dw,restraint_type:fw(uw),model_granularity:fw(uw),dataset_list_id:hw,software_id:hw},ihm_cross_link_list:{id:hw,group_id:hw,entity_description_1:uw,entity_description_2:uw,entity_id_1:uw,entity_id_2:uw,comp_id_1:uw,comp_id_2:uw,seq_id_1:hw,seq_id_2:hw,linker_type:fw(uw),dataset_list_id:hw},ihm_cross_link_restraint:{id:hw,group_id:hw,entity_id_1:uw,entity_id_2:uw,asym_id_1:uw,asym_id_2:uw,comp_id_1:uw,comp_id_2:uw,seq_id_1:hw,seq_id_2:hw,atom_id_1:uw,atom_id_2:uw,restraint_type:fw(uw),conditional_crosslink_flag:fw(uw),model_granularity:fw(uw),distance_threshold:dw,psi:dw,sigma_1:dw,sigma_2:dw},ihm_cross_link_result_parameters:{id:hw,restraint_id:hw,model_id:hw,psi:dw,sigma_1:dw,sigma_2:dw},ihm_2dem_class_average_restraint:{id:hw,dataset_list_id:hw,number_raw_micrographs:hw,pixel_size_width:dw,pixel_size_height:dw,image_resolution:dw,image_segment_flag:fw(_w),number_of_projections:hw,struct_assembly_id:hw,details:uw},ihm_2dem_class_average_fitting:{id:hw,restraint_id:hw,model_id:hw,cross_correlation_coefficient:dw,rot_matrix:mw(3,3),tr_vector:gw(3)},ihm_3dem_restraint:{id:hw,dataset_list_id:hw,model_id:hw,struct_assembly_id:hw,fitting_method:uw,number_of_gaussians:hw,cross_correlation_coefficient:dw},ihm_sas_restraint:{id:hw,dataset_list_id:hw,model_id:hw,struct_assembly_id:hw,profile_segment_flag:fw(_w),fitting_atom_type:uw,fitting_method:uw,fitting_state:fw(uw),radius_of_gyration:dw,chi_value:dw,details:uw},ihm_starting_model_coord:{ordinal_id:hw,starting_model_id:uw,group_PDB:fw(uw),id:hw,type_symbol:uw,entity_id:uw,atom_id:uw,comp_id:uw,seq_id:hw,asym_id:uw,Cartn_x:dw,Cartn_y:dw,Cartn_z:dw,B_iso_or_equiv:dw},ihm_sphere_obj_site:{id:hw,entity_id:uw,seq_id_begin:hw,seq_id_end:hw,asym_id:uw,Cartn_x:dw,Cartn_y:dw,Cartn_z:dw,object_radius:dw,rmsf:dw,model_id:hw},ihm_gaussian_obj_site:{id:hw,entity_id:uw,seq_id_begin:hw,seq_id_end:hw,asym_id:uw,mean_Cartn_x:dw,mean_Cartn_y:dw,mean_Cartn_z:dw,weight:dw,covariance_matrix:mw(3,3),model_id:hw},ihm_gaussian_obj_ensemble:{id:hw,entity_id:uw,seq_id_begin:hw,seq_id_end:hw,asym_id:uw,mean_Cartn_x:dw,mean_Cartn_y:dw,mean_Cartn_z:dw,weight:dw,covariance_matrix:mw(3,3),ensemble_id:hw},ihm_feature_list:{feature_id:hw,feature_type:fw(uw),entity_type:fw(uw)},ihm_poly_residue_feature:{ordinal_id:hw,feature_id:hw,entity_id:uw,asym_id:uw,comp_id_begin:uw,comp_id_end:uw,seq_id_begin:hw,seq_id_end:hw},ihm_derived_distance_restraint:{id:hw,group_id:hw,feature_id_1:hw,feature_id_2:hw,group_conditionality:fw(uw),random_exclusion_fraction:dw,distance_upper_limit:dw,restraint_type:fw(uw),dataset_list_id:hw},ma_model_list:{ordinal_id:hw,model_id:hw,model_group_id:hw,model_name:uw,model_group_name:uw,model_type:fw(uw),data_id:hw},ma_target_entity:{entity_id:uw,data_id:hw,origin:fw(uw)},ma_target_entity_instance:{asym_id:uw,entity_id:uw,details:uw},ma_target_ref_db_details:{target_entity_id:uw,db_name:fw(uw),db_code:uw,db_accession:uw,seq_db_isoform:uw,seq_db_align_begin:uw,seq_db_align_end:uw,ncbi_taxonomy_id:uw,organism_scientific:uw},ma_data:{id:hw,content_type:fw(uw),content_type_other_details:uw,name:uw},ma_software_group:{ordinal_id:hw,group_id:hw,software_id:hw},ma_qa_metric:{id:hw,name:uw,type:fw(uw),mode:fw(uw),software_group_id:hw},ma_qa_metric_global:{ordinal_id:hw,model_id:hw,metric_id:hw,metric_value:dw},ma_qa_metric_local:{ordinal_id:hw,model_id:hw,label_asym_id:uw,label_seq_id:hw,label_comp_id:uw,metric_id:hw,metric_value:dw}};var bw=lb.Schema;const xw=bw.str,ww=bw.float,Sw=bw.List,Aw=bw.lstr,Mw=bw.Aliased,Cw=bw.int,Ew=bw.coord,Tw={chem_comp:{formula:xw,formula_weight:ww,id:xw,mon_nstd_parent_comp_id:Sw(",",(t=>t)),name:xw,one_letter_code:xw,three_letter_code:xw,type:Mw(Aw),pdbx_synonyms:Sw(";",(t=>t)),pdbx_type:xw,pdbx_ambiguous_flag:xw,pdbx_replaced_by:xw,pdbx_replaces:xw,pdbx_formal_charge:Cw,pdbx_model_coordinates_details:xw,pdbx_model_coordinates_db_code:xw,pdbx_ideal_coordinates_details:xw,pdbx_ideal_coordinates_missing_flag:Mw(Aw),pdbx_model_coordinates_missing_flag:Mw(Aw),pdbx_initial_date:xw,pdbx_modified_date:xw,pdbx_release_status:Mw(xw),pdbx_processing_site:Mw(xw)},chem_comp_atom:{alt_atom_id:xw,atom_id:xw,charge:Cw,model_Cartn_x:Ew,model_Cartn_y:Ew,model_Cartn_z:Ew,comp_id:xw,type_symbol:xw,pdbx_align:Cw,pdbx_ordinal:Cw,pdbx_model_Cartn_x_ideal:Ew,pdbx_model_Cartn_y_ideal:Ew,pdbx_model_Cartn_z_ideal:Ew,pdbx_stereo_config:Mw(Aw),pdbx_aromatic_flag:Mw(Aw),pdbx_leaving_atom_flag:Mw(Aw)},chem_comp_bond:{atom_id_1:xw,atom_id_2:xw,comp_id:xw,value_order:Mw(Aw),pdbx_ordinal:Cw,pdbx_stereo_config:Mw(Aw),pdbx_aromatic_flag:Mw(Aw)},pdbx_chem_comp_descriptor:{comp_id:xw,descriptor:xw,type:Mw(Aw),program:xw,program_version:xw},pdbx_chem_comp_identifier:{comp_id:xw,identifier:xw,type:Mw(xw),program:xw,program_version:xw}};var Pw=lb.Schema;const Iw=Pw.str,Rw=Pw.float,kw=Pw.lstr,Dw=Pw.Aliased,Lw=Pw.int,Ow={pdbx_reference_molecule:{prd_id:Iw,formula_weight:Rw,formula:Iw,type:Dw(kw),type_evidence_code:Iw,class:Dw(kw),class_evidence_code:Iw,name:Iw,represent_as:Dw(kw),chem_comp_id:Iw,compound_details:Iw,description:Iw,representative_PDB_id_code:Iw,release_status:Dw(kw),replaces:Iw,replaced_by:Iw},pdbx_reference_entity_list:{prd_id:Iw,ref_entity_id:Iw,type:Dw(kw),details:Iw,component_id:Lw},pdbx_reference_entity_nonpoly:{prd_id:Iw,ref_entity_id:Iw,name:Iw,chem_comp_id:Iw},pdbx_reference_entity_link:{link_id:Lw,prd_id:Iw,details:Iw,ref_entity_id_1:Iw,ref_entity_id_2:Iw,entity_seq_num_1:Lw,entity_seq_num_2:Lw,comp_id_1:Iw,comp_id_2:Iw,atom_id_1:Iw,atom_id_2:Iw,value_order:Dw(kw),component_1:Lw,component_2:Lw,link_class:Dw(Iw)},pdbx_reference_entity_poly_link:{link_id:Lw,prd_id:Iw,ref_entity_id:Iw,component_id:Lw,entity_seq_num_1:Lw,entity_seq_num_2:Lw,comp_id_1:Iw,comp_id_2:Iw,atom_id_1:Iw,atom_id_2:Iw,value_order:Dw(kw)},pdbx_reference_entity_poly:{prd_id:Iw,ref_entity_id:Iw,type:Dw(Iw),db_code:Iw,db_name:Iw},pdbx_reference_entity_poly_seq:{prd_id:Iw,ref_entity_id:Iw,mon_id:Iw,parent_mon_id:Iw,num:Lw,observed:Dw(kw),hetero:Dw(kw)},pdbx_reference_entity_sequence:{prd_id:Iw,ref_entity_id:Iw,type:Dw(Iw),NRP_flag:Dw(Iw),one_letter_codes:Iw},pdbx_reference_entity_src_nat:{prd_id:Iw,ref_entity_id:Iw,ordinal:Lw,organism_scientific:Iw,taxid:Iw,db_code:Iw,db_name:Iw},pdbx_prd_audit:{prd_id:Iw,date:Iw,processing_site:Dw(Iw),action_type:Dw(Iw)}};var Nw=lb.Schema;const Fw=Nw.str,Bw={datablock:{id:Fw,description:Fw},dictionary:{title:Fw,datablock_id:Fw,version:Fw},dictionary_history:{version:Fw,update:Fw,revision:Fw},sub_category:{id:Fw,description:Fw},category_group_list:{id:Fw,parent_id:Fw,description:Fw},item_type_list:{code:Fw,primitive_code:Fw,construct:Fw,detail:Fw},item_units_list:{code:Fw,detail:Fw},item_units_conversion:{from_code:Fw,to_code:Fw,operator:Fw,factor:Nw.float}};var Uw=lb.Schema;const zw=Uw.str,Vw=Uw.int,Hw=Uw.float,Gw=Uw.Aliased,$w=Uw.Vector;Gw(zw),Gw(zw),Gw(zw),Gw(zw),$w(3),$w(3);const jw={volume_data_3d_info:{name:zw,axis_order:$w(3,Vw),origin:$w(3),dimensions:$w(3),sample_rate:Vw,sample_count:$w(3,Vw),spacegroup_number:Vw,spacegroup_cell_size:$w(3),spacegroup_cell_angles:$w(3),mean_source:Hw,mean_sampled:Hw,sigma_source:Hw,sigma_sampled:Hw,min_source:Hw,min_sampled:Hw,max_source:Hw,max_sampled:Hw},volume_data_3d:{values:Hw}};var Ww=lb.Schema;const qw=Ww.float,Xw=Ww.int,Yw=Ww.str,Kw={cell:{angle_alpha:qw,angle_beta:qw,angle_gamma:qw,formula_units_z:Xw,length_a:qw,length_b:qw,length_c:qw,volume:qw},chemical:{melting_point:qw,name_common:Yw,name_systematic:Yw},chemical_formula:{moiety:Yw,sum:Yw,weight:qw},space_group:{crystal_system:Yw,it_number:Xw,"name_h-m_full":Yw},space_group_symop:{operation_xyz:Yw},geom_bond:{atom_site_label_1:Yw,atom_site_label_2:Yw,distance:qw,publ_flag:Yw,site_symmetry_1:Yw,site_symmetry_2:Yw,valence:qw},audit:{block_doi:Yw},database_code:{cod:Yw,csd:Yw,depnum_ccdc_archive:Yw,depnum_ccdc_fiz:Yw,icsd:Yw,mdf:Yw,nbs:Yw},atom_site:{adp_type:Yw,calc_flag:Yw,disorder_assembly:Yw,disorder_group:Yw,fract_x:qw,fract_y:qw,fract_z:qw,label:Yw,occupancy:qw,refinement_flags:Yw,site_symmetry_multiplicity:Xw,type_symbol:Yw,u_iso_or_equiv:qw},atom_site_aniso:{label:Yw,u_11:qw,u:(0,Ww.Matrix)(3,3),u_12:qw,u_13:qw,u_22:qw,u_23:qw,u_33:qw},atom_type:{description:Yw,symbol:Yw},atom_type_scat:{dispersion_imag:qw,dispersion_real:qw,source:Yw}},Zw={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},Qw=lb.Schema.int,Jw={volume_data_3d_info:jw.volume_data_3d_info,segmentation_data_table:{set_id:Qw,segment_id:Qw},segmentation_data_3d:{values:Qw}},tS={parse:t=>"string"==typeof t?Px(t):Jx(t),parseText:Px,parseBinary:Jx,toDatabaseCollection:function(t,e,n){const i={};for(const r of e.blocks)i[r.header]=ew(t,r,n);return i},toDatabase:ew,schema:{mmCIF:t=>ew(yw,t),CCD:t=>ew(Tw,t),BIRD:t=>ew(Ow,t),dic:t=>ew(Bw,t),cifCore:t=>ew(Kw,t,Zw),densityServer:t=>ew(jw,t),segmentation:t=>ew(Jw,t)}};class eS{constructor(t,e){var n=e||{};this.streamer=t,this.name=Aa(n.name,""),this.path=Aa(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then((()=>Zg(this,void 0,void 0,(function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))))}_parse(){}_beforeParse(){}_afterParse(){Ql&&Yl.log(this[this.__objName])}}class nS extends eS{constructor(t,e){var n=e||{};super(t,n),this.firstModelOnly=Aa(n.firstModelOnly,!1),this.asTrajectory=Aa(n.asTrajectory,!1),this.cAlphaOnly=Aa(n.cAlphaOnly,!1),this.structure=new Fm(this.name,this.path),this.structureBuilder=new Qf(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class iS{constructor(t,e,n="",i,r=[]){this.structure=t,this.index=e,this.description=n,this.entityType=function(t){switch(t=t.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}}(i||""),this.chainIndexList=r,r.forEach((function(n){t.chainStore.entityIndex[n]=e}))}get type(){return function(t){switch(t){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}}(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return 1===this.entityType}isNonPolymer(){return 2===this.entityType}isMacrolide(){return 3===this.entityType}isWater(){return 4===this.entityType}eachChain(t){const e=this.structure.getChainProxy();this.chainIndexList.forEach((function(n){e.index=n,t(e)}))}}const rS={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class sS{constructor(t=rS){this.cartToFrac=new ze,this.fracToCart=new ze,this.a=t.a,this.b=t.b,this.c=t.c,this.alpha=t.alpha,this.beta=t.beta,this.gamma=t.gamma,this.spacegroup=t.spacegroup;const e=qa(this.alpha),n=qa(this.beta),i=qa(this.gamma),r=Math.cos(e),s=Math.cos(n),o=Math.cos(i),a=Math.sin(n),l=Math.sin(i);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-r*r-s*s-o*o+2*r*s*o),void 0===t.cartToFrac){const t=this.a*this.b*l/this.volume,e=(s*o-r)/(a*l);this.fracToCart.set(this.a,0,0,0,this.b*o,this.b*l,0,0,this.c*s,-this.c*a*e,1/t,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(t.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(t){const e=new Float32Array(24);if(t.unitcell){const n=t.unitcell,i=t.center.clone().applyMatrix4(n.cartToFrac).floor(),r=new ue;let s=0;const o=function(t,o,a){r.set(t,o,a).add(i).applyMatrix4(n.fracToCart).toArray(e,s),s+=3};o(0,0,0),o(1,0,0),o(0,1,0),o(0,0,1),o(1,1,0),o(1,0,1),o(0,1,1),o(1,1,1)}return e}getCenter(t){return function(t,e=new ue){const n=t.length;for(let i=0;i<n;i+=3)e.x+=t[i],e.y+=t[i+1],e.z+=t[i+2];return e.divideScalar(n/3),e}(this.getPosition(t))}getData(t,e={}){const n=Aa(e.colorValue,"orange"),i=Aa(e.radius,Math.cbrt(this.volume)/200),r=new Pn(n),s=new ue,o=this.getPosition(t),a=jc(8,r.r,r.g,r.b),l=$c(8,i),c=new Float32Array(36),u=new Float32Array(36),h=jc(12,r.r,r.g,r.b),d=$c(12,i);let p=0;function f(t,e){s.fromArray(o,3*t).toArray(c,p),s.fromArray(o,3*e).toArray(u,p),p+=3}f(0,1),f(0,2),f(0,3),f(1,4),f(1,5),f(2,6),f(3,5),f(4,7),f(5,7),f(2,4),f(7,6),f(3,6);const m=new vp(this,t);return{vertex:{position:o,color:a,radius:l,picking:m},edge:{position1:c,position2:u,color:h,color2:h,radius:d,picking:m}}}}const oS={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},aS=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],lS=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],cS=/\s+/;function uS(t,e,n){let i=`${t}`;return e&&(i+=`:${e}`),n&&(i+=`^${n}`),i}class hS extends nS{constructor(t,e){const n=e||{};super(t,n),this.hex=Aa(n.hex,!1),this.inferBonds=Aa(n.inferBonds,"all")}get type(){return"pdb"}_parse(){Ql&&Yl.time("PdbParser._parse "+this.name);let t=!1;const e=this.streamer.peekLines(1)[0],n=e.substr(62,4),i=e.substr(72,4);n===i&&i.trim()&&(t=!0);const r="pqr"===this.type,s="pdbqt"===this.type,o=this.structure,a=this.structureBuilder,l=this.hex;let c=10,u=10;const h=this.firstModelOnly,d=this.asTrajectory,p=this.cAlphaOnly,f=o.frames,m=o.boxes;let g,_,v=!1;const y=o.biomolDict;let b,x,w,S,A,M,C,E,T,P,I,R,k,D,L,O,N,F,B,U,z,V,H={};const G={},$={},j=[];let W,q;const X={},Y={},K={};let Z,Q,J,tt,et,nt,it;const rt={};let st;const ot={helices:[],sheets:[]},at=ot.helices,lt=ot.sheets,ct=o.atomMap,ut=o.atomStore;ut.resize(Math.round(this.streamer.data.length/80)),(r||s)&&ut.addField("partialCharge",1,"float32"),r&&ut.addField("radius",1,"float32");const ht=o.getAtomProxy(),dt=o.getAtomProxy();let pt=0,ft=0,mt=!0;this.streamer.eachChunkOfLines((function(e){!function(e,n,i){for(let e=0;e<n;++e)if(S=i[e],A=S.substr(0,6),"ATOM  "===A||"HETATM"===A){if(mt&&(d?(v?(g=new Float32Array(3*ut.count),f.push(g)):g=[],_=0):h||(H={}),Z=1,Q=Z.toString(),J=!0,mt=!1),h&&ft>0)continue;let e,n,i,o,m,y=0;if(r){if(o=S.split(cS),y=10===o.length?1:0,R=o[2],p&&"CA"!==R)continue;e=parseFloat(o[6-y]),n=parseFloat(o[7-y]),i=parseFloat(o[8-y])}else{if(R=S.substr(12,4).trim(),p&&"CA"!==R)continue;e=parseFloat(S.substr(30,8)),n=parseFloat(S.substr(38,8)),i=parseFloat(S.substr(46,8))}if(d){const t=3*_;if(g[t+0]=e,g[t+1]=n,g[t+2]=i,_+=1,v)continue}r?(M=parseInt(o[1]),m="",k="H"===S[0],C=y?"":o[4],E=parseInt(o[5-y]),I="",T=o[3],L="",P=1):(M=parseInt(S.substr(6,5),c),l&&99999===M&&(c=16),k="H"===S[0],C=S[21].trim(),E=parseInt(S.substr(22,4),u),l&&9999===E&&(u=16),I=S[26].trim(),T=S.substr(17,4).trim()||"MOL",D=parseFloat(S.substr(60,6)),L=S[16].trim(),P=parseFloat(S.substr(54,6)),t||(s?(m=S.substr(76,3).trim(),m in kd&&(m=kd[m])):(m=S.substr(76,2).trim(),C||(C=S.substr(72,4).trim())),O=parseInt((S.substr(79,1)+S.substr(78,1)).trim()))),ut.growIfFull(),ut.atomTypeId[pt]=ct.add(R,m),ut.x[pt]=e,ut.y[pt]=n,ut.z[pt]=i,ut.serial[pt]=M,ut.altloc[pt]=L.charCodeAt(0),ut.occupancy[pt]=isNaN(P)?0:P,r?(ut.partialCharge[pt]=parseFloat(o[9-y]),ut.radius[pt]=parseFloat(o[10-y])):(ut.bfactor[pt]=isNaN(D)?0:D,s&&(ut.partialCharge[pt]=parseFloat(S.substr(70,6))),isFinite(O)&&(ut.formalCharge||ut.addField("formalCharge",1,"int8"),ut.formalCharge[pt]=O));const b=uS(E,C,I);!k||Y[b]||aS.includes(T)?J||tt===C||(Z+=1,Q=Z.toString()):tt===C&&nt===T&&(Cd.includes(T)||et===E&&it===I)||(Z+=1,Q=Z.toString(),et=E,nt=T,it=I),a.addAtom(ft,C,Q,T,E,k,void 0,I),H[M]=pt,pt+=1,J=!1,tt=C}else if("CONECT"===A){const t=H[parseInt(S.substr(6,5))],e=[11,16,21,26],n={};if(void 0===t)continue;for(let i=0;i<4;++i){let r=parseInt(S.substr(e[i],5));if(!Number.isNaN(r)&&(r=H[r],void 0!==r))if(t<r?(ht.index=t,dt.index=r):(ht.index=r,dt.index=t),void 0!==n[r])o.bondStore.bondOrder[n[r]]+=1;else{const t=ht.index+"|"+dt.index;void 0===$[t]&&($[t]=!0,n[r]=o.bondStore.count,o.bondStore.addBond(ht,dt,1))}}}else if("HELIX "===A){N=S[19].trim(),F=parseInt(S.substr(21,4)),B=S[25].trim(),U=S[31].trim(),z=parseInt(S.substr(33,4)),V=S[37].trim();let t=parseInt(S.substr(39,1));t=(oS[t]||oS[0]).charCodeAt(0),at.push([N,F,B,U,z,V,t])}else if("SHEET "===A)N=S[21].trim(),F=parseInt(S.substr(22,4)),B=S[26].trim(),U=S[32].trim(),z=parseInt(S.substr(33,4)),V=S[37].trim(),lt.push([N,F,B,U,z,V]);else if("HETNAM"===A)X[S.substr(11,3)]=S.substr(15).trim();else if("SEQRES"===A){const t=S[11].trim();t!==st&&(rt[t]=[],st=t),rt[t].push(...S.substr(19).trim().split(cS))}else if("MODRES"===A){const t=S.substr(12,3).trim(),e=S[16].trim(),n=S[22].trim(),i=parseInt(S.substr(18,4).trim()),r=uS(i,e,n);Y[r]={resname:t,chainname:e,inscode:n,resno:i}}else if("COMPND"===A){const t=S.substr(10,70).trim(),e=t.indexOf(":"),n=t.substring(0,e);let i;lS.includes(n)?(q=n,i=t.substring(e+2)):i=t,i=i.replace(/;$/,""),"MOL_ID"===q?(W={chainList:[],name:""},j.push(W)):"MOLECULE"===q?(W.name&&(W.name+=" "),W.name+=i):"CHAIN"===q&&Array.prototype.push.apply(W.chainList,i.split(/\s*,\s*/))}else if(S.startsWith("TER")){const t=o.getChainProxy(o.chainStore.count-1);K[t.chainname]=t.index,Z+=1,Q=Z.toString(),J=!0}else if("REMARK"===A&&"350"===S.substr(7,3)){if("BIOMOLECULE:"===S.substr(11,12)){let t=S.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(t)&&(t="BU"+t),b=new Kf(t),y[t]=b}else if("BIOMT"===S.substr(13,5)){const t=S.split(/\s+/),e=parseInt(S[18])-1;0===e&&(w=new ze,x.matrixList.push(w));const n=w.elements;n[0+e]=parseFloat(t[4]),n[4+e]=parseFloat(t[5]),n[8+e]=parseFloat(t[6]),n[12+e]=parseFloat(t[7])}else if("APPLY THE FOLLOWING TO CHAINS:"===S.substr(11,30)||"                   AND CHAINS:"===S.substr(11,30)){"APPLY"===S.substr(11,5)&&(x=b.addPart());const t=S.substr(41,30).split(",");for(let e=0,n=t.length;e<n;++e){const n=t[e].trim();n&&x.chainList.push(n)}}}else if("HEADER"===A)o.id=S.substr(62,4);else if("TITLE "===A)o.title+=(o.title?" ":"")+S.substr(10,70).trim();else if("MODEL "===A)mt=!0;else if("ENDMDL"===A||"END"===S.trim()){if(mt)continue;d&&!v&&(f.push(new Float32Array(g)),v=!0),ft+=1,mt=!0}else if("MTRIX"===S.substr(0,5)){if("1"===S[59])continue;if(!b||"NCS"!==b.name){const t="NCS";b=new Kf(t),y[t]=b,x=b.addPart()}const t=S.split(/\s+/),e=parseInt(S[5])-1;0===e&&(w=new ze,x.matrixList.push(w));const n=w.elements;n[0+e]=parseFloat(t[2]),n[4+e]=parseFloat(t[3]),n[8+e]=parseFloat(t[4]),n[12+e]=parseFloat(t[5])}else if("ORIGX"===S.substr(0,5)){G.origx||(G.origx=new ze);const t=S.split(/\s+/),e=parseInt(S[5])-1,n=G.origx.elements;n[0+e]=parseFloat(t[1]),n[4+e]=parseFloat(t[2]),n[8+e]=parseFloat(t[3]),n[12+e]=parseFloat(t[4])}else if("SCALE"===S.substr(0,5)){G.scale||(G.scale=new ze);const t=S.split(/\s+/),e=parseInt(S[5])-1,n=G.scale.elements;n[0+e]=parseFloat(t[1]),n[4+e]=parseFloat(t[2]),n[8+e]=parseFloat(t[3]),n[12+e]=parseFloat(t[4])}else if("CRYST1"===A){const t=parseFloat(S.substr(6,9)),e=parseFloat(S.substr(15,9)),n=parseFloat(S.substr(24,9)),i=parseFloat(S.substr(33,7)),r=parseFloat(S.substr(40,7)),s=parseFloat(S.substr(47,7)),o=S.substr(55,11).trim(),a=new Float32Array(9);a[0]=t,a[4]=e,a[8]=n,m.push(a),0===ft&&(G.a=t,G.b=e,G.c=n,G.alpha=i,G.beta=r,G.gamma=s,G.spacegroup=o)}}(0,e.length,e)})),a.finalize();const gt=j.length;if(gt){o.eachChain((function(t){t.entityIndex=gt})),j.forEach((function(t,e){const n=t.chainList.map((function(t){return K[t]}));o.entityList.push(new iS(o,e,t.name,"polymer",n))}));let t=j.length;const e=o.getResidueProxy(),n={};o.eachChain((function(t){t.entityIndex===gt&&(e.index=t.residueOffset,n[e.resname]||(n[e.resname]=[]),n[e.resname].push(t.index))})),Object.keys(n).forEach((function(e){const i=n[e];let r="non-polymer",s=X[e]||e;Cd.includes(e)&&(s="water",r="water"),o.entityList.push(new iS(o,t,s,r,i)),t+=1}))}void 0!==G.a?o.unitcell=new sS(G):o.unitcell=void 0,(at.length||lt.length)&&Jf(o,ot),o.finalizeAtoms(),t||im(o),rm(o,this.inferBonds),o.finalizeBonds(),at.length||lt.length||tm(o),cm(o),Ql&&Yl.timeEnd("PdbParser._parse "+this.name)}}oc.add("pdb",hS),oc.add("pdb1",hS),oc.add("ent",hS);class dS{constructor(t){this.structure=t,this.dict={},this.structure=t}add(t,e,n){this.dict[t]={chemCompType:e},n&&(this.dict[t].bonds=n)}addBond(t,e,n,i){const r=this.dict[t];if(!r)return;r.bonds||(r.bonds={atom1:[],atom2:[],bondOrders:[]});const s=r.bonds;s.atom1.push(e),s.atom2.push(n),s.bondOrders.push(i)}getBonds(t,e){var n;const i=null===(n=this.dict[t])||void 0===n?void 0:n.bonds;if(!i)return;const r=this.structure.atomMap,s=new Map(e.map(((t,e)=>{var n;return[null===(n=r.get(t))||void 0===n?void 0:n.atomname,e]}))),o=[],a=[],l=[];let c,u;for(let t=0;t<i.atom1.length;t++)void 0!==(c=s.get(i.atom1[t]))&&void 0!==(u=s.get(i.atom2[t]))&&(o.push(c),a.push(u),l.push(i.bondOrders[t]));return{atomIndices1:o,atomIndices2:a,bondOrders:l}}}const pS=/^\D{1,2}/,fS={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},mS={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function gS(t){switch(t.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class _S extends nS{get type(){return"cif"}get isBinary(){return!1}_parse(){var t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b;return Zg(this,void 0,void 0,(function*(){Yl.time("CifParser._parse "+this.name);const x=this.structure,w=this.structureBuilder,S=this.firstModelOnly,A=this.asTrajectory,M=x.frames;let C,E;const T=this.isBinary?tS.parseBinary(this.streamer.data):tS.parseText(this.streamer.compressed?Na(this.streamer.data):this.streamer.data),P=yield T.run();if(P.isError)throw P;const I=P.result.blocks[0];if("chem_comp"in I.categories&&"chem_comp_atom"in I.categories&&!("struct"in I.categories))!function(t,e,n){const i=e.atomStore,r=e.atomMap;let s,o;const a=t.chem_comp,l=t.chem_comp_atom,c=t.chem_comp_bond;let u;a&&((u=a.getField("name"))&&(e.title=u.str(0)),(u=a.getField("id"))&&(e.id=u.str(0)));const h={};if(l){let t,e,s,a;o=l.rowCount,i.resize(2*o);const c=l.getField("atom_id"),u=l.getField("type_symbol"),d=l.getField("pdbx_component_comp_id"),p=l.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach((([f,m,g],_)=>{var v;const y=l.getField(f),b=l.getField(m),x=l.getField(g),w=_*o;for(let l=0;l<o;++l){const o=l+w;i.growIfFull(),t=null==c?void 0:c.str(l),e=null==u?void 0:u.str(l),h[t]=l,i.atomTypeId[o]=r.add(t,e),i.x[o]=y.float(l),i.y[o]=b.float(l),i.z[o]=x.float(l),i.serial[o]=l,s=d.str(l),a=null!==(v=null==p?void 0:p.int(l))&&void 0!==v?v:1,n.addAtom(_,"","",s,a,!0)}}))}if(l&&c){let t,n,i;o=c.rowCount;const r=l.rowCount,a=e.getAtomProxy(),u=e.getAtomProxy(),d=c.getField("atom_id_1"),p=c.getField("atom_id_2"),f=c.getField("value_order");for(s=0;s<o;++s)t=d.str(s),n=p.str(s),i=gS(f.str(s)),a.index=h[t],u.index=h[n],e.bondStore.growIfFull(),e.bondStore.addBond(a,u,i),a.index+=r,u.index+=r,e.bondStore.growIfFull(),e.bondStore.addBond(a,u,i)}}(I.categories,x,w),w.finalize(),x.finalizeAtoms(),x.finalizeBonds(),pm(x);else if("atom_site_type_symbol"in I.categories&&"atom_site_label"in I.categories&&"atom_site_fract_x"in I.categories)!function(t,e,n){var i,r,s=e.atomStore,o=e.atomMap;t.header&&(e.id=t.header,e.name=t.header),e.unitcell=new sS({a:t.getField("cell_length_a").float(0),b:t.getField("cell_length_b").float(0),c:t.getField("cell_length_c").float(0),alpha:t.getField("cell_angle_alpha").float(0),beta:t.getField("cell_angle_beta").float(0),gamma:t.getField("cell_angle_gamma").float(0),spacegroup:t.getField("symmetry_space_group_name_H-M").str(0)});const a=new ue,l=new ue,c=t.getField("atom_site_type_symbol");if(!c)return;const u=null!==(i=c.rowCount)&&void 0!==i?i:0,h=t.getField("atom_site_type_symbol"),d=t.getField("atom_site_fract_x"),p=t.getField("atom_site_fract_y"),f=t.getField("atom_site_fract_z"),m=t.getField("atom_site_occupancy"),g={};for(let t=0;t<u;++t){s.growIfFull();const i=h.str(t),u=c.str(t);let _=g[u];if(!_){const t=u.match(pS);g[u]=_=null!==(r=null==t?void 0:t[0])&&void 0!==r?r:u}s.atomTypeId[t]=o.add(i,_),a.set(d.float(t),p.float(t),f.float(t)),a.applyMatrix4(e.unitcell.fracToCart),l.add(a),s.x[t]=a.x,s.y[t]=a.y,s.z[t]=a.z,m&&(s.occupancy[t]=m.float(t)),s.serial[t]=t,n.addAtom(0,"","","HET",1,!0)}l.divideScalar(u),e.center=l,cm(e);const _=new ue,v=new ue,y=e.biomolDict.SUPERCELL.partList[0].matrixList;let b=u;function x(t){return o.get(s.atomTypeId[t]).covalent}const w=new ze;for(let t=0;t<u;++t){const e=x(t);a.set(s.x[t],s.y[t],s.z[t]),y.forEach((function(i){if(!w.equals(i)){_.copy(a),_.applyMatrix4(i);for(let i=0;i<u;++i){v.set(s.x[i],s.y[i],s.z[i]);const r=_.distanceToSquared(v),o=x(i)+e,a=o+.3,l=o-.5;if(r<a*a&&r>l*l)return s.growIfFull(),s.atomTypeId[b]=s.atomTypeId[t],s.x[b]=_.x,s.y[b]=_.y,s.z[b]=_.z,s.occupancy[b]=s.occupancy[t],s.serial[b]=b,s.altloc[b]="A".charCodeAt(0),n.addAtom(0,"","","HET",1,!0),void(b+=1)}}}))}}(I,x,w),w.finalize(),x.finalizeAtoms(),rm(x),x.finalizeBonds();else{const T={},P={},R=x.atomMap,k=x.atomStore,D=I.categories.atom_site;let L=D.rowCount;const O=D.getField("pdbx_PDB_model_num");if(null!==(t=null==O?void 0:O.areValuesEqual(0,L-1))&&void 0!==t&&!t&&(A||S)){const t=O.int(0);for(let e=0;e<L;e++)if(O.int(e)>t){L=e;break}}x.chemCompMap=new dS(x);const N=I.categories.chem_comp;let F=N.getField("id");const B=N.getField("type");for(let t=0;t<N.rowCount;t++)x.chemCompMap.add(F.str(t),B.str(t).toUpperCase());if(I.categoryNames.includes("chem_comp_bond")){const t=I.categories.chem_comp_bond;F=t.getField("comp_id");const e=t.getField("atom_id_1"),n=t.getField("atom_id_2"),i=t.getField("value_order");for(let r=0;r<t.rowCount;r++){const t=mS[i.str(r)];t&&x.chemCompMap.addBond(F.str(r),e.str(r),n.str(r),t)}}const U=(t,e,n)=>{const i=t.getField(e);return i?i.toFloatArray({array:Float32Array,start:0,end:n}):new Float32Array(n)};k.resize(L),k.x=U(D,"Cartn_x",L),k.y=U(D,"Cartn_y",L),k.z=U(D,"Cartn_z",L),k.serial=D.getField("id").toIntArray({start:0,end:L}),k.bfactor=U(D,"B_iso_or_equiv",L),k.occupancy=U(D,"occupancy",L);const z=D.getField("label_alt_id");(null==z?void 0:z.isDefined)&&(k.altloc=Uint8Array.from(z.toStringArray(),(t=>t.charCodeAt(0))));const V=D.getField("label_atom_id"),H=D.getField("type_symbol");F=D.getField("label_comp_id");const G=null!==(e=D.getField("auth_seq_id"))&&void 0!==e?e:D.getField("label_seq_id"),$=D.getField("pdbx_PDB_ins_code"),j=D.getField("auth_asym_id"),W=D.getField("label_asym_id"),q=D.getField("group_PDB"),X=D.getField("label_entity_id");for(let t=0;t<L;t++){const e=null!==(n=null==O?void 0:O.int(t))&&void 0!==n?n:1,c=null!==(i=null==j?void 0:j.str(t))&&void 0!==i?i:"",u=null!==(r=null==W?void 0:W.str(t))&&void 0!==r?r:"",h=null!==(s=null==F?void 0:F.str(t))&&void 0!==s?s:"",d=null!==(o=null==G?void 0:G.int(t))&&void 0!==o?o:0,p="H"===(null==q?void 0:q.str(t)[0]),f=null!==(a=null==$?void 0:$.str(t))&&void 0!==a?a:"",m=null!==(l=null==X?void 0:X.int(t))&&void 0!==l?l:1;k.atomTypeId[t]=R.add((null==V?void 0:V.str(t))||"",null==H?void 0:H.str(t)),w.addAtom(e-1,c,u,h,d,p,void 0,f),T[u]=c,P[m]||(P[m]=new Set),P[m].add(x.chainStore.count-1)}if(A){const t=D.rowCount/L|0,e=D.getField("Cartn_x"),n=D.getField("Cartn_y"),i=D.getField("Cartn_z");for(let r=0;r<t;r++){C=new Float32Array(3*L);const t=r*L,s=t+L;E=0;for(let r=t;r<s;r++)C[E+0]=e.float(r),C[E+1]=n.float(r),C[E+2]=i.float(r),E+=3;M.push(C)}}const Y=function(t,e,n){var i,r,s,o,a,l;const c=[],u=[];let h,d,p,f;const m=t.struct_conf;if(null==m?void 0:m.fieldNames.includes("pdbx_PDB_helix_class")){const t=m.getField("pdbx_beg_PDB_ins_code"),e=m.getField("pdbx_end_PDB_ins_code"),s=m.getField("pdbx_PDB_helix_class"),o=m.getField("beg_label_asym_id"),a=m.getField("end_label_asym_id"),l=m.getField("beg_auth_seq_id"),u=m.getField("end_auth_seq_id");for(h=0,d=m.rowCount;h<d;++h){const d=null==s?void 0:s.int(h);Number.isFinite(d)&&(p=null!==(i=null==t?void 0:t.str(h))&&void 0!==i?i:"",f=null!==(r=null==e?void 0:e.str(h))&&void 0!==r?r:"",c.push([n[o.str(h)],l.int(h),p,n[a.str(h)],u.int(h),f,(oS[d]||oS[0]).charCodeAt(0)]))}}else if(null==m?void 0:m.fieldNames.includes("conf_type_id")){const t=m.getField("conf_type_id"),e=m.getField("pdbx_beg_PDB_ins_code"),i=m.getField("pdbx_end_PDB_ins_code"),r=m.getField("beg_label_asym_id"),a=m.getField("end_label_asym_id"),l=m.getField("beg_auth_seq_id"),g=m.getField("end_auth_seq_id");let _;for(h=0,d=m.rowCount;h<d;++h){const d=t.str(h);(_=fS[d])&&(p=null!==(s=null==e?void 0:e.str(h))&&void 0!==s?s:"",f=null!==(o=null==i?void 0:i.str(h))&&void 0!==o?o:"","h"===_||"g"===_||"i"===_?c.push([n[r.str(h)],l.int(h),p,n[a.str(h)],g.int(h),f,_.charCodeAt(0)]):"e"===_&&u.push([n[r.str(h)],l.int(h),p,n[a.str(h)],g.int(h),f]))}}const g=t.struct_sheet_range;if(g&&0===u.length){const t=g.getField("pdbx_beg_PDB_ins_code"),e=g.getField("pdbx_end_PDB_ins_code"),i=g.getField("beg_label_asym_id"),r=g.getField("end_label_asym_id"),s=g.getField("beg_auth_seq_id"),o=g.getField("end_auth_seq_id");for(h=0,d=g.rowCount;h<d;++h)p=null!==(a=null==t?void 0:t.str(h))&&void 0!==a?a:"",f=null!==(l=null==e?void 0:e.str(h))&&void 0!==l?l:"",u.push([n[i.str(h)],s.int(h),p,n[r.str(h)],o.int(h),f])}return!(!m&&!g)&&{helices:c,sheets:u}}(I.categories,0,T);let K,Z;if(function(t,e,n){const i={},r=e.biomolDict;if(t.pdbx_struct_oper_list){const e=t.pdbx_struct_oper_list,n=e.getField("id"),r=e.getField("matrix[1][1]"),s=e.getField("matrix[1][2]"),o=e.getField("matrix[1][3]"),a=e.getField("matrix[2][1]"),l=e.getField("matrix[2][2]"),c=e.getField("matrix[2][3]"),u=e.getField("matrix[3][1]"),h=e.getField("matrix[3][2]"),d=e.getField("matrix[3][3]"),p=e.getField("vector[1]"),f=e.getField("vector[2]"),m=e.getField("vector[3]");for(let t=0;t<e.rowCount;t++){const e=new ze,g=e.elements;g[0]=r.float(t),g[1]=s.float(t),g[2]=o.float(t),g[4]=a.float(t),g[5]=l.float(t),g[6]=c.float(t),g[8]=u.float(t),g[9]=h.float(t),g[10]=d.float(t),g[3]=p.float(t),g[7]=f.float(t),g[11]=m.float(t),e.transpose(),i[n.str(t)]=e}}if(t.pdbx_struct_assembly_gen){const e=t.pdbx_struct_assembly_gen,s=function(t){const e={};return t.replace(/[()']/g,"").split(",").forEach((function(t){if(t.includes("-"))for(var n=t.split("-"),r=parseInt(n[0]),s=parseInt(n[1]);r<=s;++r)e[r]=i[r];else e[t]=i[t]})),e},o=e.getField("assembly_id"),a=e.getField("oper_expression"),l=e.getField("asym_id_list");for(let t=0;t<e.rowCount;t++){const e=o.int(t);let i={},c=a.str(t).replace(/['"]\(|['"]/g,"");if(c.includes(")(")||c.indexOf("(")>0){const[t,e]=c.split("(").filter((t=>!!t)),n=s(t),r=s(e);Object.keys(n).forEach((function(t){Object.keys(r).forEach((function(e){const s=new ze;s.multiplyMatrices(n[t],r[e]),i[t+"x"+e]=s}))}))}else i=s(c);const u=[];for(let t in i)u.push(i[t]);let h=""+e;/^(0|[1-9][0-9]*)$/.test(h)&&(h="BU"+h);const d=l.str(t).split(",").map((t=>n[t]));void 0===r[h]&&(r[h]=new Kf(h)),r[h].addPart(u,d)}}if(t.struct_ncs_oper){const e=t.struct_ncs_oper,n="NCS";r[n]=new Kf(n);const i=r[n].addPart(),s=e.getField("code"),o=e.getField("matrix[1][1]"),a=e.getField("matrix[1][2]"),l=e.getField("matrix[1][3]"),c=e.getField("matrix[2][1]"),u=e.getField("matrix[2][2]"),h=e.getField("matrix[2][3]"),d=e.getField("matrix[3][1]"),p=e.getField("matrix[3][2]"),f=e.getField("matrix[3][3]"),m=e.getField("vector[1]"),g=e.getField("vector[2]"),_=e.getField("vector[3]");for(let t=0;t<e.rowCount;t++){if("given"===s.str(t))return;const e=new ze,n=e.elements;n[0]=o.float(t),n[1]=a.float(t),n[2]=l.float(t),n[4]=c.float(t),n[5]=u.float(t),n[6]=h.float(t),n[8]=d.float(t),n[9]=p.float(t),n[10]=f.float(t),n[3]=m.float(t),n[7]=g.float(t),n[11]=_.float(t),e.transpose(),i.matrixList.push(e)}0===i.matrixList.length&&delete r[n]}const s={};if(t.cell){const n=t.cell,i=n.getField("length_a").float(0),r=n.getField("length_b").float(0),o=n.getField("length_c").float(0),a=new Float32Array(9);a[0]=i,a[4]=r,a[8]=o,e.boxes.push(a),s.a=i,s.b=r,s.c=o,s.alpha=n.getField("angle_alpha").float(0),s.beta=n.getField("angle_beta").float(0),s.gamma=n.getField("angle_gamma").float(0)}t.symmetry&&(s.spacegroup=t.symmetry.getField("space_group_name_H-M").str(0));const o=new ze;if(t.database_PDB_matrix){const e=t.database_PDB_matrix,n=o.elements,i=e.getField("origx[1][1]"),r=e.getField("origx[1][2]"),a=e.getField("origx[1][3]"),l=e.getField("origx[2][1]"),c=e.getField("origx[2][2]"),u=e.getField("origx[2][3]"),h=e.getField("origx[3][1]"),d=e.getField("origx[3][2]"),p=e.getField("origx[3][3]"),f=e.getField("origx_vector[1]"),m=e.getField("origx_vector[2]"),g=e.getField("origx_vector[3]");n[0]=i.float(0),n[1]=r.float(0),n[2]=a.float(0),n[4]=l.float(0),n[5]=c.float(0),n[6]=u.float(0),n[8]=h.float(0),n[9]=d.float(0),n[10]=p.float(0),n[3]=f.float(0),n[7]=m.float(0),n[11]=g.float(0),o.transpose(),s.origx=o}const a=new ze;if(t.atom_sites){const e=t.atom_sites,n=a.elements,i=e.getField("fract_transf_matrix[1][1]"),r=e.getField("fract_transf_matrix[1][2]"),o=e.getField("fract_transf_matrix[1][3]"),l=e.getField("fract_transf_matrix[2][1]"),c=e.getField("fract_transf_matrix[2][2]"),u=e.getField("fract_transf_matrix[2][3]"),h=e.getField("fract_transf_matrix[3][1]"),d=e.getField("fract_transf_matrix[3][2]"),p=e.getField("fract_transf_matrix[3][3]"),f=e.getField("fract_transf_vector[1]"),m=e.getField("fract_transf_vector[2]"),g=e.getField("fract_transf_vector[3]");n[0]=i.float(0),n[1]=r.float(0),n[2]=o.float(0),n[4]=l.float(0),n[5]=c.float(0),n[6]=u.float(0),n[8]=h.float(0),n[9]=d.float(0),n[10]=p.float(0),n[3]=f.float(0),n[7]=m.float(0),n[11]=g.float(0),a.transpose(),s.scale=a}void 0!==s.a?e.unitcell=new sS(s):e.unitcell=void 0}(I.categories,x,T),function(t,e,n){const i=t.struct_conn;if(i){const t=e.getAtomProxy(),o=e.getAtomProxy(),a={},l=i.getField("conn_type_id"),c=i.getField("ptnr1_symmetry"),u=i.getField("pdbx_ptnr1_PDB_ins_code"),h=i.getField("pdbx_ptnr1_label_alt_id"),d=i.getField("ptnr1_auth_seq_id"),p=i.getField("ptnr1_label_asym_id"),f=i.getField("ptnr1_label_atom_id"),m=i.getField("ptnr2_symmetry"),g=i.getField("pdbx_ptnr2_PDB_ins_code"),_=i.getField("pdbx_ptnr2_label_alt_id"),v=i.getField("ptnr2_auth_seq_id"),y=i.getField("ptnr2_label_asym_id"),b=i.getField("ptnr2_label_atom_id"),x=i.getField("pdbx_value_order");for(let w=0,S=i.rowCount;w<S;++w){const i=l.str(w);if("hydrog"===i||"mismat"===i||"saltbr"===i)continue;if("1_555"!==c.str(w)||"1_555"!==m.str(w))continue;const S=u.str(w),A=h.str(w),M=d.str(w)+(S?"^"+S:"")+":"+n[p.str(w)]+"."+f.str(w)+(A?"%"+A:"");let C=a[M];if(!C){const t=new Ll(M);if(t.selection.error){Ql&&Yl.warn("invalid selection for connection",M);continue}C=e.getAtomIndices(t),a[M]=C}const E=g.str(w),T=_.str(w),P=v.str(w)+(E?"^"+E:"")+":"+n[y.str(w)]+"."+b.str(w)+(T?"%"+T:"");let I=a[P];if(!I){const t=new Ll(P);if(t.selection.error){Ql&&Yl.warn("invalid selection for connection",P);continue}I=e.getAtomIndices(t),a[P]=I}var r=C.length,s=I.length;if(r>s&&([r,s]=[s,r],[C,I]=[I,C]),0!==r&&0!==s)for(let n=0;n<s;++n)t.index=C[n%r],o.index=I[n],t&&o?e.bondStore.addBond(t,o,gS(x.str(w))):Yl.log("atoms for connection not found");else Ql&&Yl.warn("no atoms found for",M,P)}}}(I.categories,x,T),function(t,e,n){var i;if(t.entity){const r=t.entity,s=r.getField("id"),o=r.getField("pdbx_description"),a=r.getField("type"),l=r.rowCount;for(let t=0;t<l;++t){const r=Array.from(null!==(i=n[s.int(t)])&&void 0!==i?i:[]);e.entityList[t]=new iS(e,t,null==o?void 0:o.str(t),a.str(t),r)}}}(I.categories,x,P),(K=null===(c=I.categories.struct)||void 0===c?void 0:c.getField("title"))&&(Z=K.str(0))&&(x.title=Z),(K=null===(u=I.categories.entry)||void 0===u?void 0:u.getField("id"))&&(Z=K.str(0))&&(x.id=Z),I.categories.pdbx_audit_revision_history){if(K=null===(h=I.categories.pdbx_audit_revision_history)||void 0===h?void 0:h.getField("revision_date"))for(let t=0;t<K.rowCount;t++)if(Z=K.str(t)){x.header.releaseDate=Z;break}if(K=null===(d=I.categories.pdbx_database_status)||void 0===d?void 0:d.getField("recvd_initial_deposition_date"))for(let t=0;t<K.rowCount;t++)if(Z=K.str(t)){x.header.depositionDate=Z;break}}else if(I.categories.database_PDB_rev){if(K=null===(p=I.categories.database_PDB_rev)||void 0===p?void 0:p.getField("date"))for(let t=0;t<K.rowCount;t++)if(Z=K.str(t)){x.header.releaseDate=Z;break}if(K=null===(f=I.categories.database_PDB_rev)||void 0===f?void 0:f.getField("date_original"))for(let t=0;t<K.rowCount;t++)if(Z=K.str(t)){x.header.depositionDate=Z;break}}(K=null!==(g=null===(m=I.categories.reflns)||void 0===m?void 0:m.getField("d_resolution_high"))&&void 0!==g?g:null===(_=I.categories.refine)||void 0===_?void 0:_.getField("ls_d_res_high"))&&0===K.valueKind(0)&&(x.header.resolution=K.float(0)),(K=null===(v=I.categories.refine)||void 0===v?void 0:v.getField("ls_R_factor_R_free"))&&0===K.valueKind(0)&&(x.header.rFree=K.float(0)),(K=null===(y=I.categories.refine)||void 0===y?void 0:y.getField("ls_R_factor_R_work"))&&0===K.valueKind(0)&&(x.header.rFree=K.float(0)),(K=null===(b=I.categories.exptl)||void 0===b?void 0:b.getField("method"))&&(x.header.experimentalMethods=K.toStringArray().slice()),w.finalize(),x.finalizeAtoms(),rm(x),x.finalizeBonds(),Y?Jf(x,Y):tm(x),cm(x),x.extraData.cif=I}Ql&&Yl.timeEnd("CifParser._parse "+this.name)}))}}oc.add("bcif",class extends _S{get type(){return"bcif"}get isBinary(){return!0}}),oc.add("cif",_S),oc.add("mcif",_S),oc.add("mmcif",_S),oc.add("gro",class extends nS{get type(){return"gro"}_parse(){Ql&&Yl.time("GroParser._parse "+this.name);var t,e,n=this.structure,i=this.structureBuilder,r=this.firstModelOnly,s=this.asTrajectory,o=this.cAlphaOnly,a=n.frames,l=n.boxes,c=this.streamer.peekLines(3);n.title=c[0].trim();var u,h,d,p,f=c[2].length-c[2].lastIndexOf(".")-1+5,m=20+f,g=20+2*f,_=parseInt(c[1]),v=_+3,y=n.atomMap,b=n.atomStore;b.resize(_);var x=0,w=0,S=0;this.streamer.eachChunkOfLines((function(n){!function(n,c,A){for(var M=0;M<c;++M){var C=++S-1,E=A[M];if(E)if(C%v==0)s&&(t=new Float32Array(3*_),a.push(t),e=0);else if(C%v==1);else if(C%v==v-1){var T=E.trim().split(/\s+/),P=new Float32Array(9);if(P[0]=10*parseFloat(T[0]),P[4]=10*parseFloat(T[1]),P[8]=10*parseFloat(T[2]),l.push(P),r)return!0;w+=1}else{if(u=E.substr(10,5).trim(),o&&"CA"!==u)continue;var I=10*parseFloat(E.substr(20,f)),R=10*parseFloat(E.substr(m,f)),k=10*parseFloat(E.substr(g,f));if(s){var D=3*e;if(t[D+0]=I,t[D+1]=R,t[D+2]=k,e+=1,C>v)continue}h=E.substr(5,5).trim(),d=parseInt(E.substr(0,5)),p=parseInt(E.substr(15,5)),b.growIfFull(),b.atomTypeId[x]=y.add(u),b.x[x]=I,b.y[x]=R,b.z[x]=k,b.serial[x]=p,i.addAtom(w,"","",h,d,!1,"l"),x+=1}}}(0,n.length,n)})),i.finalize(),n.finalizeAtoms(),im(n),rm(n),n.finalizeBonds(),tm(n),Ql&&Yl.timeEnd("GroParser._parse "+this.name)}});var vS=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function yS(t,e,n){return e?new t(e.buffer,e.byteOffset,e.byteLength/(n||1)):void 0}function bS(t){return yS(DataView,t)}function xS(t){return yS(Int8Array,t)}function wS(t){return yS(Int32Array,t,4)}function SS(t,e){var n=t.length/2;e||(e=new Int16Array(n));for(var i=0,r=0;i<n;++i,r+=2)e[i]=t[r]<<8^t[r+1];return e}function AS(t,e){var n=t.length/4;e||(e=new Int32Array(n));for(var i=0,r=0;i<n;++i,r+=4)e[i]=t[r]<<24^t[r+1]<<16^t[r+2]<<8^t[r+3];return e}function MS(t,e,n){var i=t.length,r=1/e;n||(n=new Float32Array(i));for(var s=0;s<i;++s)n[s]=t[s]*r;return n}function CS(t,e){var n,i;if(!e){var r=0;for(n=0,i=t.length;n<i;n+=2)r+=t[n+1];e=new t.constructor(r)}var s=0;for(n=0,i=t.length;n<i;n+=2)for(var o=t[n],a=t[n+1],l=0;l<a;++l)e[s]=o,++s;return e}function ES(t,e){var n=t.length;e||(e=new t.constructor(n)),n&&(e[0]=t[0]);for(var i=1;i<n;++i)e[i]=t[i]+e[i-1];return e}function TS(t,e){var n,i,r=t instanceof Int8Array?127:32767,s=-r-1,o=t.length;if(!e){var a=0;for(n=0;n<o;++n)t[n]<r&&t[n]>s&&++a;e=new Int32Array(a)}for(n=0,i=0;n<o;){for(var l=0;t[n]===r||t[n]===s;)l+=t[n],++n;l+=t[n],++n,e[i]=l,++i}return e}function PS(t,e,n){return MS(TS(t,wS(n)),e,n)}function IS(t){var e=0,n=new DataView(t.buffer);function i(t){for(var e={},n=0;n<t;n++)e[a()]=a();return e}function r(n){var i=t.subarray(e,e+n);return e+=n,i}function s(n){var i=t.subarray(e,e+n);e+=n;var r=65535;if(n>r){for(var s=[],o=0;o<i.length;o+=r)s.push(String.fromCharCode.apply(null,i.subarray(o,o+r)));return s.join("")}return String.fromCharCode.apply(null,i)}function o(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=a();return e}function a(){var a,l,c=t[e];if(!(128&c))return e++,c;if(128==(240&c))return e++,i(l=15&c);if(144==(240&c))return e++,o(l=15&c);if(160==(224&c))return e++,s(l=31&c);if(!(224&~c))return a=n.getInt8(e),e++,a;switch(c){case 192:return e++,null;case 194:return e++,!1;case 195:return e++,!0;case 196:return l=n.getUint8(e+1),e+=2,r(l);case 197:return l=n.getUint16(e+1),e+=3,r(l);case 198:return l=n.getUint32(e+1),e+=5,r(l);case 202:return a=n.getFloat32(e+1),e+=5,a;case 203:return a=n.getFloat64(e+1),e+=9,a;case 204:return a=t[e+1],e+=2,a;case 205:return a=n.getUint16(e+1),e+=3,a;case 206:return a=n.getUint32(e+1),e+=5,a;case 208:return a=n.getInt8(e+1),e+=2,a;case 209:return a=n.getInt16(e+1),e+=3,a;case 210:return a=n.getInt32(e+1),e+=5,a;case 217:return l=n.getUint8(e+1),e+=2,s(l);case 218:return l=n.getUint16(e+1),e+=3,s(l);case 219:return l=n.getUint32(e+1),e+=5,s(l);case 220:return l=n.getUint16(e+1),e+=3,o(l);case 221:return l=n.getUint32(e+1),e+=5,o(l);case 222:return l=n.getUint16(e+1),e+=3,i(l);case 223:return l=n.getUint32(e+1),e+=5,i(l)}throw new Error("Unknown type 0x"+c.toString(16))}return a()}function RS(t,e,n,i){switch(t){case 1:return function(t,e){var n=t.length;e||(e=new Float32Array(n/4));for(var i=bS(e),r=bS(t),s=0,o=0,a=n/4;s<a;++s,o+=4)i.setFloat32(o,r.getFloat32(o),!0);return e}(e);case 2:return xS(e);case 3:return SS(e);case 4:return AS(e);case 5:return yS(Uint8Array,e);case 6:return CS(AS(e),new Uint8Array(n));case 7:return CS(AS(e));case 8:return function(t){return ES(CS(t),void 0)}(AS(e));case 9:return r=AS(e),s=AS(i)[0],MS(CS(r,wS(o)),s,o);case 10:return function(t,e){var n=TS(t,wS(void 0));return function(t,e,n){return MS(ES(t,wS(n)),e,n)}(n,e,yS(Float32Array,n,4))}(SS(e),AS(i)[0]);case 11:return MS(SS(e),AS(i)[0]);case 12:return PS(SS(e),AS(i)[0]);case 13:return PS(xS(e),AS(i)[0]);case 14:return TS(SS(e));case 15:return TS(xS(e))}var r,s,o}const kS={0:"i".charCodeAt(0),1:"s".charCodeAt(0),2:"h".charCodeAt(0),3:"e".charCodeAt(0),4:"g".charCodeAt(0),5:"b".charCodeAt(0),6:"t".charCodeAt(0),7:"l".charCodeAt(0),"-1":"".charCodeAt(0)};oc.add("mmtf",class extends nS{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let t,e,n,i,r;Ql&&Yl.time("MmtfParser._parse "+this.name);const s=this.structure,o=function(t,e){var n=(e=e||{}).ignoreFields,i={};return vS.forEach((function(e){var r,s,o,a,l,c=!!n&&-1!==n.indexOf(e),u=t[e];c||void 0===u||(u instanceof Uint8Array?i[e]=RS.apply(null,(o=(s=bS(r=u)).getInt32(0),a=s.getInt32(4),l=r.subarray(8,12),[o,r=r.subarray(12),a,l])):i[e]=u)})),i}(IS(this.streamer.data));let a,l,c,u,h,d;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach((function(t){void 0!==o[t]&&(s.header[t]=o[t])})),s.id=o.structureId,s.title=o.title,s.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(h=1,u=o.chainsPerModel[0],c=0,t=0,e=u;t<e;++t)c+=o.groupsPerChain[t];for(l=0,t=0,e=c;t<e;++t)r=o.groupList[o.groupTypeList[t]],l+=r.atomNameList.length;a=o.numBonds,d=[u]}else a=o.numBonds,l=o.numAtoms,c=o.numGroups,u=o.numChains,h=o.numModels,d=o.chainsPerModel;if(a+=c,this.asTrajectory)for(t=0,e=o.numModels;t<e;++t){const e=new Float32Array(3*l),i=l*t;for(n=0;n<l;++n){const t=3*n,r=n+i;e[t]=o.xCoordList[r],e[t+1]=o.yCoordList[r],e[t+2]=o.zCoordList[r]}s.frames.push(e)}const p=new Uint32Array(a),f=new Uint32Array(a),m=new Uint8Array(a),g=new Uint32Array(l),_=new Int8Array(l),v=new Uint32Array(c),y=new Uint32Array(c),b=new Uint32Array(c),x=new Uint16Array(u),w=new Uint32Array(u),S=new Uint32Array(u),A=new Uint32Array(h),M=new Uint32Array(h);let C=0;for(t=0,e=h;t<e;++t){const e=d[t];for(A[t]=C,M[t]=e,n=0;n<e;++n)x[n+C]=t;C+=e}const E=o.groupsPerChain;let T=0;for(t=0,e=u;t<e;++t){const e=E[t];for(w[t]=T,S[t]=e,n=0;n<e;++n)v[n+T]=t;T+=e}let P=0,I=0;for(t=0,e=c;t<e;++t){r=o.groupList[o.groupTypeList[t]];const e=r.atomNameList.length,s=r.formalChargeList,a=r.bondAtomList,l=r.bondOrderList;for(n=0,i=l.length;n<i;++n)p[I]=P+a[2*n],f[I]=P+a[2*n+1],m[I]=l[n],I+=1;for(y[t]=P,b[t]=e,n=0;n<e;++n)g[P]=t,_[P]=s[n],P+=1}const R=o.bondAtomList;if(R)for(o.bondOrderList&&m.set(o.bondOrderList,I),t=0,e=R.length;t<e;t+=2){const e=R[t],n=R[t+1];e<l&&n<l&&(p[I]=e,f[I]=n,I+=1)}s.bondStore.length=m.length,s.bondStore.count=I,s.bondStore.atomIndex1=p,s.bondStore.atomIndex2=f,s.bondStore.bondOrder=m,s.atomStore.length=l,s.atomStore.count=l,s.atomStore.residueIndex=g,s.atomStore.atomTypeId=new Uint16Array(l),s.atomStore.x=o.xCoordList.subarray(0,l),s.atomStore.y=o.yCoordList.subarray(0,l),s.atomStore.z=o.zCoordList.subarray(0,l),s.atomStore.serial=o.atomIdList.subarray(0,l),s.atomStore.bfactor=o.bFactorList.subarray(0,l),s.atomStore.altloc=o.altLocList.subarray(0,l),s.atomStore.occupancy=o.occupancyList.subarray(0,l),s.atomStore.formalCharge=_,s.residueStore.length=c,s.residueStore.count=c,s.residueStore.chainIndex=v,s.residueStore.residueTypeId=o.groupTypeList,s.residueStore.atomOffset=y,s.residueStore.atomCount=b,s.residueStore.resno=o.groupIdList.subarray(0,c),s.residueStore.sstruc=o.secStructList.subarray(0,c),s.residueStore.inscode=o.insCodeList.subarray(0,c),s.chainStore.length=u,s.chainStore.count=u,s.chainStore.entityIndex=new Uint16Array(u),s.chainStore.modelIndex=x,s.chainStore.residueOffset=w,s.chainStore.residueCount=S,s.chainStore.chainname=o.chainNameList.subarray(0,4*u),s.chainStore.chainid=o.chainIdList.subarray(0,4*u),s.modelStore.length=h,s.modelStore.count=h,s.modelStore.chainOffset=A,s.modelStore.chainCount=M;let k={};for(t=0,e=o.groupList.length;t<e;++t){const e=o.groupList[t],r=[];for(n=0,i=e.atomNameList.length;n<i;++n){const t=e.elementList[n].toUpperCase(),i=e.atomNameList[n];r.push(s.atomMap.add(i,t))}const a=e.chemCompType.toUpperCase(),l=cd.includes(a),c=e.bondOrderList.length,u=new Array(c),h=new Array(c);for(n=0;n<c;++n)u[n]=e.bondAtomList[2*n],h[n]=e.bondAtomList[2*n+1];const d={atomIndices1:u,atomIndices2:h,bondOrders:e.bondOrderList};k[t]=s.residueMap.add(e.groupName,r,l,a,d)}for(t=0,e=c;t<e;++t)s.residueStore.residueTypeId[t]=k[s.residueStore.residueTypeId[t]];for(t=0,e=s.atomStore.count;t<e;++t){const e=s.atomStore.residueIndex[t],n=s.residueMap.list[s.residueStore.residueTypeId[e]],i=s.residueStore.atomOffset[e];s.atomStore.atomTypeId[t]=n.atomTypeIdList[t-i]}if(o.secStructList){const n=o.secStructList.length;for(t=0,e=s.residueStore.count;t<e;++t){const e=kS[s.residueStore.sstruc[t%n]];void 0!==e&&(s.residueStore.sstruc[t]=e)}}if(o.entityList&&o.entityList.forEach((function(t,e){s.entityList[e]=new iS(s,e,t.description,t.type,t.chainIndexList)})),o.bioAssemblyList&&o.bioAssemblyList.forEach((function(t,e){const n=e+1,i=new Kf(""+n);s.biomolDict["BU"+n]=i;let r={};t.transformList.forEach((function(t){const e=(new ze).fromArray(t.matrix).transpose(),n=t.chainIndexList.map((function(t){let e="";for(let n=0;n<4;++n){const i=o.chainNameList[4*t+n];if(!i)break;e+=String.fromCharCode(i)}return e})),s=r[n.toString()];s?s.matrixList.push(e):r[n.toString()]=i.addPart([e],n)}))})),o.ncsOperatorList){const t="NCS",e=new Kf(t),n=e.addPart();o.ncsOperatorList.forEach((function(t){const e=(new ze).fromArray(t).transpose();n.matrixList.push(e)})),n.matrixList.length>0&&(s.biomolDict[t]=e)}const D=o.unitCell;D&&Array.isArray(D)&&D[0]?s.unitcell=new sS({a:D[0],b:D[1],c:D[2],alpha:D[3],beta:D[4],gamma:D[5],spacegroup:o.spaceGroup}):s.unitcell=void 0,lm(s,!0),am(s,!0),s.finalizeAtoms(),s.finalizeBonds(),cm(s),Ql&&Yl.timeEnd("MmtfParser._parse "+this.name)}});const DS=/\s+/,LS={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};oc.add("mol2",class extends nS{get type(){return"mol2"}_parse(){Ql&&Yl.time("Mol2Parser._parse "+this.name);const t=this.structure,e=this.structureBuilder,n=this.firstModelOnly,i=this.asTrajectory,r=t.frames;let s,o,a=!1;const l=t.atomMap,c=t.atomStore;c.resize(Math.round(this.streamer.data.length/60)),c.addField("partialCharge",1,"float32");let u=0,h=0,d=0,p=-1,f=0,m=0;const g=t.getAtomProxy(),_=t.getAtomProxy();this.streamer.eachChunkOfLines((function(v){!function(v,y,b){for(let v=0;v<y;++v){const y=b[v].trim();if(""!==y&&"#"!==y[0])if("@"===y[0])"@<TRIPOS>MOLECULE"===y?(m=1,h=0,++p):"@<TRIPOS>ATOM"===y?(m=2,d=c.count,i&&(o=0,s=new Float32Array(3*f),r.push(s),p>0&&(a=!0))):m="@<TRIPOS>BOND"===y?3:0;else if(1===m){if(0===h)t.title=y,t.id=y;else if(1===h){const t=y.split(DS);f=parseInt(t[0])}++h}else if(2===m){const t=y.split(DS);if(n&&p>0)continue;const r=parseFloat(t[2]),h=parseFloat(t[3]),d=parseFloat(t[4]);if(i){const t=3*o;if(s[t+0]=r,s[t+1]=h,s[t+2]=d,o+=1,a)continue}const f=t[0],m=t[1],g=t[5].split(".")[0],_=t[6]?parseInt(t[6]):1,v=t[7]?t[7]:"",b=t[8]?parseFloat(t[8]):0;c.growIfFull(),c.atomTypeId[u]=l.add(m,g),c.x[u]=r,c.y[u]=h,c.z[u]=d,c.serial[u]=+f,c.partialCharge[u]=b,e.addAtom(p,"","",v,_,!0),u+=1}else if(3===m){if(n&&p>0)continue;if(i&&p>0)continue;const e=y.split(DS);g.index=parseInt(e[1])-1+d,_.index=parseInt(e[2])-1+d;const r=LS[e[3]];t.bondStore.addBond(g,_,r)}}}(0,v.length,v)})),e.finalize(),t.finalizeAtoms(),im(t),am(t,!0),lm(t,!0),t.finalizeBonds(),pm(t),tm(t),Ql&&Yl.timeEnd("Mol2Parser._parse "+this.name)}}),oc.add("pdbqt",class extends hS{get type(){return"pdbqt"}}),oc.add("pqr",class extends hS{get type(){return"pqr"}});const OS=/> +<(.+)>/;class NS extends nS{get type(){return"sdf"}_parse(){Ql&&Yl.time("SdfParser._parse "+this.name);const t=this.structure,e=this.structureBuilder,n=this.firstModelOnly,i=this.asTrajectory,r=this.streamer.peekLines(2);t.id=r[0].trim(),t.title=r[1].trim();const s=t.frames;let o,a,l=!1;const c=t.atomMap,u=t.atomStore;u.resize(Math.round(this.streamer.data.length/50)),u.addField("formalCharge",1,"int8");const h=t.getAtomProxy(),d=t.getAtomProxy();let p=0,f=0,m=0,g=0;const _=[];let v,y,b,x,w,S,A,M,C,E,T,P,I,R,k=!1,D={};t.extraData.sdf=_;let L=!1,O=!1,N=!1,F=[],B=[];const U=new Map;this.streamer.eachChunkOfLines((function(r){!function(r,z,V){for(let r=0;r<z;++r){const z=V[r];if(L&&z&&(F=z.substring(7).split(" "),B.length&&(F=[...B,...F],B=[]),"-"===F[F.length-1]))F.pop(),B=F;else{if("$$$$"===z.substr(0,4))f=-1,++m,g=u.count,_.push(D),D={},k=!1,L=!1;else if(3===f)L=z.indexOf(" V3000")>-1,L?U.clear():(y=parseInt(z.substr(0,3)),b=parseInt(z.substr(3,3)),x=4,w=x+y,S=w,A=S+b,i&&(a=0,o=new Float32Array(3*y),s.push(o),m>0&&(l=!0)));else if(L&&"COUNTS"===F[0])y=parseInt(F[1]),i&&(a=0,o=new Float32Array(3*y),s.push(o),m>0&&(l=!0));else if(L&&2==F.length)"ATOM"===F[1]?"BEGIN"===F[0]?O=!0:"END"===F[0]&&(O=!1):"BOND"===F[1]&&("BEGIN"===F[0]?N=!0:"END"===F[0]&&(N=!1));else if(O||!L&&f>=x&&f<w){if(n&&m>0)continue;let t=0;if(L){if(M=parseFloat(F[2]),C=parseFloat(F[3]),E=parseFloat(F[4]),P=F[1],I=parseInt(F[0]),U.set(I,p),T=P+I,F.length>6){let e=F.slice(6).find((t=>0===t.indexOf("CHG=")));e&&(t=parseInt(e.substring(4)))}}else M=parseFloat(z.substr(0,10)),C=parseFloat(z.substr(10,10)),E=parseFloat(z.substr(20,10)),P=z.substr(31,3).trim(),T=P+(p-g+1);if(i){const t=3*a;if(o[t+0]=M,o[t+1]=C,o[t+2]=E,a+=1,l)continue}u.growIfFull(),u.atomTypeId[p]=c.add(T,P),u.x[p]=M,u.y[p]=C,u.z[p]=E,u.serial[p]=L?I:p,u.formalCharge[p]=t,e.addAtom(m,"","","HET",1,!0),p+=1}else if(N||!L&&f>=S&&f<A){if(n&&m>0)continue;if(i&&m>0)continue;L?(h.index=U.get(parseInt(F[2])),d.index=U.get(parseInt(F[3])),R=parseInt(F[1])):(h.index=parseInt(z.substr(0,3))-1+g,d.index=parseInt(z.substr(3,3))-1+g,R=parseInt(z.substr(6,3))),t.bondStore.addBond(h,d,R)}else if("M  CHG"===z.substr(0,6)){const t=parseInt(z.substr(6,3));for(let e=0,n=10;e<t;++e,n+=8){const t=parseInt(z.substr(n,3))-1+g,e=parseInt(z.substr(n+4,3));u.formalCharge[t]=e}}else">"===z.charAt(0)&&(v=z.match(OS))?(k=v[1],D[k]=[]):!1!==k&&z&&D[k].push(z);++f}}}(0,r.length,r)})),e.finalize(),t.finalizeAtoms(),t.finalizeBonds(),pm(t),Ql&&Yl.timeEnd("SdfParser._parse "+this.name)}_postProcess(){pm(this.structure)}}function FS(t,e,n){return parseInt(t.substr(e,n).trim())}oc.add("sdf",NS),oc.add("sd",NS),oc.add("mol",NS);class BS extends nS{get type(){return"prmtop"}_parse(){Ql&&Yl.time("PrmtopParser._parse "+this.name);const t=this.structure,e=this.structureBuilder,n=t.atomMap,i=t.atomStore;i.addField("partialCharge",1,"float32"),i.addField("radius",1,"float32");const r=[],s={},o=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let a,l,c,u,h;o.forEach((t=>{s[t]=0}));let d,p,f,m,g,_=new Uint8Array(0);this.streamer.eachChunkOfLines((function(t){!function(t,e,n){for(let t=0;t<e;++t){const e=n[t],v=e.trim();if(v)if(e.startsWith("%FORMAT"));else if(e.startsWith("%FLAG")){const t=e.substr(5).trim();m=0,"TITLE"===t?f=0:"POINTERS"===t?f=1:"ATOM_NAME"===t?f=2:"CHARGE"===t?f=3:"MASS"===t?f=4:"RESIDUE_LABEL"===t?f=5:"RESIDUE_POINTER"===t?f=6:"BONDS_INC_HYDROGEN"===t?(g=0,f=7):"BONDS_WITHOUT_HYDROGEN"===t?(g=s.NBONH,f=8):f="RADII"===t?9:void 0}else if(0===f)r.push(v);else if(1===f){const t=Math.min(m+10,32);for(let n=0;m<t;++n,++m)s[o[m]]=parseInt(e.substr(8*n,8).trim());a=new Array(s.NATOM),l=new Float32Array(s.NATOM),c=new Float32Array(s.NATOM),i.resize(s.NATOM);const n=s.NBONH+s.MBONA;u=new Uint32Array(n),h=new Uint32Array(n),_=new Uint8Array(n),d=new Array(s.NRES),p=new Uint32Array(s.NRES)}else if(2===f){const t=Math.min(m+20,s.NATOM);for(let n=0;m<t;++n,++m)a[m]=e.substr(4*n,4).trim()}else if(3===f){const t=Math.min(m+5,s.NATOM);for(let n=0;m<t;++n,++m)l[m]=parseFloat(e.substr(16*n,16))/18.2223}else if(4===f);else if(5===f){const t=Math.min(m+20,s.NRES);for(let n=0;m<t;++n,++m)d[m]=e.substr(4*n,4).trim()}else if(6===f){const t=Math.min(m+10,s.NRES);for(let n=0;m<t;++n,++m)p[m]=FS(e,8*n,8)}else if(7===f){const t=Math.min(m+10,3*s.NBONH);for(let n=0;m<t;++n,++m){const t=m%3;0===t&&(u[g]=FS(e,8*n,8)/3),1===t&&(h[g]=FS(e,8*n,8)/3,_[g]=1,++g)}}else if(8===f){const t=Math.min(m+10,3*s.MBONA);for(let n=0;m<t;++n,++m){const t=m%3;0===t&&(u[g]=FS(e,8*n,8)/3),1===t&&(h[g]=FS(e,8*n,8)/3,_[g]=1,++g)}}else if(9===f){const t=Math.min(m+5,s.NATOM);for(let n=0;m<t;++n,++m)c[m]=parseFloat(e.substr(16*n,16))}}}(0,t.length,t)})),t.title=r.join(" ");const v=s.NATOM;let y=0,b=d[0],x=1;for(let t=0;t<v;++t)t+1===p[y+1]&&(++y,b=d[y],x=y+1),i.atomTypeId[t]=n.add(a[t]),i.serial[t]=t+1,e.addAtom(0,"","",b,x,!1);i.partialCharge.set(l),i.radius.set(c),t.bondStore.length=_.length,t.bondStore.count=_.length,t.bondStore.atomIndex1=u,t.bondStore.atomIndex2=h,t.bondStore.bondOrder=_,e.finalize(),t.finalizeAtoms(),t.finalizeBonds(),am(t,!0),lm(t,!0,!0),im(t,!0),pm(t),Ql&&Yl.timeEnd("PrmtopParser._parse "+this.name)}}oc.add("prmtop",BS),oc.add("parm7",BS);const US=/\s+/,zS=/(^\*|REMARK)*/;oc.add("psf",class extends nS{get type(){return"psf"}_parse(){Ql&&Yl.time("PsfParser._parse "+this.name);const t=this.structure,e=this.structureBuilder,n=t.atomMap,i=t.atomStore;i.addField("partialCharge",1,"float32");const r=[];let s,o,a,l,c,u,h=0,d=0,p=0;this.streamer.eachChunkOfLines((function(t){!function(t,f,m){for(let t=0;t<f;++t){const f=m[t].trim();if(f)if(2===s){const t=f.split(US),r=parseInt(t[0]),s=t[1],l=parseInt(t[2]),c=t[3],u=t[4],p=parseFloat(t[6]);s!==a&&(o=nm(d),++d),i.growIfFull(),i.atomTypeId[h]=n.add(u),i.serial[h]=r,i.partialCharge[h]=p,e.addAtom(0,o,o,c,l,!1),h+=1,a=s}else if(3===s){const t=f.split(US);for(let e=0,n=t.length;e<n;e+=2)l[p]=parseInt(t[e])-1,c[p]=parseInt(t[e+1])-1,u[p]=1,p+=1}else if(1===s)r.push(f.replace(zS,"").trim());else if(4===s);else if(5===s);else if(6===s);else if(f.includes("!NATOM")){s=2;const t=parseInt(f.split(US)[0]);i.resize(t)}else if(f.includes("!NBOND")){s=3;const t=parseInt(f.split(US)[0]);l=new Uint32Array(t),c=new Uint32Array(t),u=new Uint8Array(t)}else f.includes("!NTITLE")?s=1:f.includes("!NTHETA")?s=4:f.includes("!NPHI")?s=5:f.includes("!NIMPHI")&&(s=6);else s=void 0}}(0,t.length,t)})),t.title=r.join(" "),t.bondStore.length=u.length,t.bondStore.count=p,t.bondStore.atomIndex1=l,t.bondStore.atomIndex2=c,t.bondStore.bondOrder=u,e.finalize(),t.finalizeAtoms(),t.finalizeBonds(),am(t,!0),lm(t,!0,!0),pm(t),Ql&&Yl.timeEnd("PsfParser._parse "+this.name)}});const VS=/\[ (.+) \]/,HS=/\s+/;oc.add("top",class extends nS{get type(){return"top"}_parse(){Ql&&Yl.time("TopParser._parse "+this.name);const t=this.structure,e=this.structureBuilder,n=t.atomMap,i=t.bondStore,r=t.atomStore;r.addField("partialCharge",1,"float32");const s=[],o={};let a,l;this.streamer.eachChunkOfLines((function(e){!function(e,n,i){for(let e=0;e<n;++e){const n=i[e];let r=n.trim();if(!r||"*"===r[0]||";"===r[0])continue;if(r.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const c=n.match(VS);if(null!==c){const t=c[1];"moleculetype"===t?(l=2,a={atoms:[],bonds:[]}):l="atoms"===t?3:"bonds"===t?4:"system"===t?0:"molecules"===t?1:void 0;continue}const u=r.indexOf(";");if(-1!==u&&(r=r.substring(0,u).trim()),2===l){const t=r.split(HS)[0];o[t]=a}else if(3===l){const t=r.split(HS);a.atoms.push([parseInt(t[2]),t[3],t[4],parseFloat(t[6])])}else if(4===l){const t=r.split(HS);a.bonds.push([parseInt(t[0]),parseInt(t[1])])}else if(0===l)t.title=r;else if(1===l){const t=r.split(HS);s.push([t[0],parseInt(t[1])])}}}(0,e.length,e)}));let c=0,u=0;s.forEach((function(t){const[e,n]=t,i=o[e];c+=n*i.atoms.length,u+=n*i.bonds.length})),r.resize(c),i.resize(u);let h,d=0,p=0,f=0,m=0,g=0,_=0;s.forEach((function(t){const[s,a]=t,l=o[s],c=nm(m);for(let t=0;t<a;++t){h=-1;const t=Cd.includes(s)?c:nm(f);l.atoms.forEach((function(i){const[s,o,a,l]=i;s!==h&&++p,r.atomTypeId[d]=n.add(a),r.serial[d]=d+1,r.partialCharge[d]=l,e.addAtom(0,c,t,o,p+1,!1),++d,h=s})),l.bonds.forEach((function(t){i.atomIndex1[g]=_+t[0]-1,i.atomIndex2[g]=_+t[1]-1,++g})),++f,_+=l.atoms.length}++m})),i.count=u,e.finalize(),t.finalizeAtoms(),t.finalizeBonds(),am(t,!0),lm(t,!0,!0),pm(t),Ql&&Yl.timeEnd("TopParser._parse "+this.name)}});class GS extends eS{constructor(t,e){super(t,e),this.frames=new Cg(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function $S(t,e){if(t)throw new TypeError("Not a valid NetCDF v3.x file: "+e)}function jS(t){t.offset%4!=0&&t.skip(4-t.offset%4)}function WS(t){const e=t.readUint32(),n=t.readChars(e);return jS(t),n}oc.add("dcd",class extends GS{get type(){return"dcd"}get isBinary(){return!0}_parse(){Ql&&Yl.time("DcdParser._parse "+this.name);const t=Ua(this.streamer.data),e=new DataView(t),n=this.frames,i=n.coordinates,r=n.boxes,s={};let o=0;const a=new Int32Array(t,0,23),l=a[0]!==e.getInt32(0);if(84!==a[0]){const n=t.byteLength;for(let t=0;t<n;t+=4)e.setFloat32(t,e.getFloat32(t),!0)}84!==a[0]&&Yl.error("dcd bad format, header block start"),"CORD"!==String.fromCharCode(e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7))&&Yl.error("dcd bad format, format string");let c=!1,u=!1,h=!1;0!==a[22]&&(c=!0,0!==a[12]&&(u=!0),1===a[13]&&(h=!0)),s.NSET=a[2],s.ISTART=a[3],s.NSAVC=a[4],s.NAMNF=a[10],s.DELTA=c?e.getFloat32(44,l):e.getFloat64(44,l),84!==a[22]&&Yl.error("dcd bad format, header block end"),o=o+84+8;const d=e.getInt32(o,l),p=o+1;if((d-4)%80!=0&&Yl.error("dcd bad format, title block start"),s.TITLE=Na(new Uint8Array(t,p,d)),e.getInt32(p+d+4-1,l)!==d&&Yl.error("dcd bad format, title block end"),o=o+d+8,4!==e.getInt32(o,l)&&Yl.error("dcd bad format, natom block start"),s.NATOM=e.getInt32(o+4,l),4!==e.getInt32(o+8,l)&&Yl.error("dcd bad format, natom block end"),o=o+4+8,s.NAMNF>0)return void Yl.error("dcd format with fixed atoms unsupported, aborting");const f=s.NATOM,m=4*f;for(let n=0,a=s.NSET;n<a;++n){if(u){o+=4;const t=new Float32Array(9);t[0]=e.getFloat64(o,l),t[4]=e.getFloat64(o+16,l),t[8]=e.getFloat64(o+40,l),r.push(t),o+=48,o+=4}const s=new Float32Array(3*f);for(let i=0;i<3;++i){e.getInt32(o,l)!==m&&Yl.error("dcd bad format, coord block start",n,i),o+=4;const r=new Float32Array(t,o,f);for(let t=0;t<f;++t)s[3*t+i]=r[t];o+=m,e.getInt32(o,l)!==m&&Yl.error("dcd bad format, coord block end",n,i),o+=4}i.push(s),h&&(o+=4+e.getInt32(o,l)+4)}s.DELTA&&(n.deltaTime=20.45482949774598*s.DELTA),s.ISTART>=1&&(n.timeOffset=(s.ISTART-1)*n.deltaTime),Ql&&Yl.timeEnd("DcdParser._parse "+this.name)}});function qS(t){switch(Number(t)){case 1:return"byte";case 2:return"char";case 3:return"short";case 4:return"int";case 5:return"float";case 6:return"double";default:return"undefined"}}function XS(t){switch(Number(t)){case 1:case 2:return 1;case 3:return 2;case 4:case 5:return 4;case 6:return 8;default:return-1}}function YS(t){switch(String(t)){case"byte":return 1;case"char":return 2;case"short":return 3;case"int":return 4;case"float":return 5;case"double":return 6;default:return-1}}function KS(t,e){if(1!==t){const n=new Array(t);for(let i=0;i<t;i++)n[i]=e();return n}return e()}function ZS(t,e,n){switch(e){case 1:return t.readBytes(n);case 2:return function(t){return 0===t.charCodeAt(t.length-1)?t.substring(0,t.length-1):t}(t.readChars(n));case 3:return KS(n,t.readInt16.bind(t));case 4:return KS(n,t.readInt32.bind(t));case 5:return KS(n,t.readFloat32.bind(t));case 6:return KS(n,t.readFloat64.bind(t));default:return void $S(!0,"non valid type "+e)}}function QS(t){let e;const n=t.readUint32();if(0===n)return $S(0!==t.readUint32(),"wrong empty tag for list of attributes"),[];{$S(12!==n,"wrong tag for list of attributes");const i=t.readUint32();e=new Array(i);for(let n=0;n<i;n++){const i=WS(t),r=t.readUint32();$S(r<1||r>6,"non valid type "+r);const s=t.readUint32(),o=ZS(t,r,s);jS(t),e[n]={name:i,type:qS(r),value:o}}}return e}class JS{constructor(t){const e=new Ic(t);e.setBigEndian(),$S("CDF"!==e.readChars(3),"should start with CDF");const n=e.readByte();$S(n>2,"unknown version"),this.header=function(t,e){const n={recordDimension:{length:t.readUint32()}};n.version=e;const i=function(t){let e,n,i;const r=t.readUint32();if(0===r)return $S(0!==t.readUint32(),"wrong empty tag for list of dimensions"),[];{$S(10!==r,"wrong tag for list of dimensions");const s=t.readUint32();e=new Array(s);for(let r=0;r<s;r++){const s=WS(t),o=t.readUint32();0===o&&(n=r,i=s),e[r]={name:s,size:o}}return{dimensions:e,recordId:n,recordName:i}}}(t);n.recordDimension.id=i.recordId,n.recordDimension.name=i.recordName,n.dimensions=i.dimensions,n.globalAttributes=QS(t);const r=function(t,e,n){const i=t.readUint32();let r,s=0;if(0===i)return $S(0!==t.readUint32(),"wrong empty tag for list of variables"),[];{$S(11!==i,"wrong tag for list of variables");const o=t.readUint32();r=new Array(o);for(let i=0;i<o;i++){const o=WS(t),a=t.readUint32(),l=new Array(a);for(let e=0;e<a;e++)l[e]=t.readUint32();const c=QS(t),u=t.readUint32();$S(u<1&&u>6,"non valid type "+u);const h=t.readUint32();let d=t.readUint32();2===n&&($S(d>0,"offsets larger than 4GB not supported"),d=t.readUint32()),l[0]===e&&(s+=h),r[i]={name:o,dimensions:l,attributes:c,type:qS(u),size:h,offset:d,record:l[0]===e}}}return{variables:r,recordStep:s}}(t,i.recordId,e);return n.variables=r.variables,n.recordDimension.recordStep=r.recordStep,n}(e,n),this.buffer=e}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(t){return-1!==this.header.variables.findIndex((function(e){return e.name===t}))}getDataVariable(t){let e;return e="string"==typeof t?this.header.variables.find((function(e){return e.name===t})):t,$S(void 0===e,"variable not found"),this.buffer.seek(e.offset),e.record?function(t,e,n){const i=YS(e.type),r=e.size?e.size/XS(i):1,s=n.length,o=new Array(s),a=n.recordStep;for(let e=0;e<s;e++){const n=t.offset;o[e]=ZS(t,i,r),t.seek(n+a)}return o}(this.buffer,e,this.header.recordDimension):function(t,e){const n=YS(e.type),i=e.size/XS(n),r=new Array(i);for(let e=0;e<i;e++)r[e]=ZS(t,n,1);return r}(this.buffer,e)}}class tA extends GS{get type(){return"nctraj"}get isBinary(){return!0}_parse(){Ql&&Yl.time("NctrajParser._parse "+this.name);const t=new JS(this.streamer.data),e=this.frames,n=e.coordinates,i=e.boxes,r=e.times;t.getDataVariable("coordinates").forEach((function(t){n.push(new Float32Array(t))})),t.hasDataVariable("cell_lengths")&&t.getDataVariable("cell_lengths").forEach((function(t){i.push(new Float32Array(t))})),t.hasDataVariable("time")&&t.getDataVariable("time").forEach((function(t){r.push(t)})),r.length>=1&&(e.timeOffset=r[0]),r.length>=2&&(e.deltaTime=r[1]-r[0]),Ql&&Yl.timeEnd("NctrajParser._parse "+this.name)}}oc.add("nctraj",tA),oc.add("ncdf",tA),oc.add("nc",tA),oc.add("trr",class extends GS{get type(){return"trr"}get isBinary(){return!0}_parse(){Ql&&Yl.time("TrrParser._parse "+this.name);const t=Ua(this.streamer.data),e=new DataView(t),n=this.frames,i=n.coordinates,r=n.boxes,s=n.times;let o=0;for(;;){o+=8;const n=e.getInt32(o);o+=4,o+=n;const a=e.getInt32(o+8),l=e.getInt32(o+12),c=e.getInt32(o+16),u=e.getInt32(o+28),h=e.getInt32(o+32),d=e.getInt32(o+36),p=e.getInt32(o+40);o+=52;const f=a/9,m=3*p;if(8===f?s.push(e.getFloat64(o)):s.push(e.getFloat32(o)),o+=2*f,a){const t=new Float32Array(9);if(8===f)for(let n=0;n<9;++n)t[n]=10*e.getFloat64(o),o+=8;else for(let n=0;n<9;++n)t[n]=10*e.getFloat32(o),o+=4;r.push(t)}if(o+=l,o+=c,u){let n;if(8===f){n=new Float32Array(m);for(let t=0;t<m;++t)n[t]=10*e.getFloat64(o),o+=8}else{const e=new Uint32Array(t,o,m);for(let t=0;t<m;++t){const n=e[t];e[t]=(255&n)<<24|(65280&n)<<8|n>>8&65280|n>>24&255}n=new Float32Array(t,o,m);for(let t=0;t<m;++t)n[t]*=10,o+=4}i.push(n)}if(o+=h,o+=d,o>=t.byteLength)break}s.length>=1&&(n.timeOffset=s[0]),s.length>=2&&(n.deltaTime=s[1]-s[0]),Ql&&Yl.timeEnd("TrrParser._parse "+this.name)}});const eA=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function nA(t){let e=1,n=0;for(;t>=e&&n<32;)n++,e<<=1;return n}const iA=new Uint8Array(32);function rA(t,e){let n=1,i=0;iA[0]=1;for(let i=0;i<t;i++){let t,r=0;for(t=0;t<n;t++)r+=iA[t]*e[i],iA[t]=255&r,r>>=8;for(;0!==r;)iA[t++]=255&r,r>>=8;n=t}let r=1;for(n--;iA[n]>=r;)i++,r*=2;return i+8*n}function sA(t,e,n,i){const r=(1<<n)-1;let s=i[1],o=i[2],a=t[0],l=0;for(;n>=8;)o=o<<8|e[a++],l|=o>>s<<n-8,n-=8;return n>0&&(s<n&&(s+=8,o=o<<8|e[a++]),s-=n,l|=o>>s&(1<<n)-1),l&=r,t[0]=a,t[1]=s,t[2]=o,l}const oA=new Int32Array(32);function aA(t,e,n,i,r,s,o){let a=0;for(oA[1]=0,oA[2]=0,oA[3]=0;i>8;)oA[a++]=sA(t,e,8,o),i-=8;i>0&&(oA[a++]=sA(t,e,i,o));for(let t=n-1;t>0;t--){let e=0;for(let n=a-1;n>=0;n--){e=e<<8|oA[n];const i=e/r[t]|0;oA[n]=i,e-=i*r[t]}s[t]=e}s[0]=oA[0]|oA[1]<<8|oA[2]<<16|oA[3]<<24}oc.add("xtc",class extends GS{get type(){return"xtc"}get isBinary(){return!0}_parse(){Ql&&Yl.time("XtcParser._parse "+this.name);const t=Ua(this.streamer.data),e=new DataView(t),n=this.frames,i=n.coordinates,r=n.boxes,s=n.times,o=new Int32Array(6),a=new Int32Array(3),l=new Int32Array(3),c=new Uint32Array(3),u=new Float32Array(3),h=new Float32Array(3);let d=0;const p=new Int32Array(3),f=new Uint32Array(p.buffer);for(;;){let n;const m=e.getInt32(d+4);d+=12;const g=3*m;s.push(e.getFloat32(d)),d+=4;const _=new Float32Array(9);for(let t=0;t<9;++t)_[t]=10*e.getFloat32(d),d+=4;if(r.push(_),m<=9){n=new Float32Array(m);for(let t=0;t<m;++t)n[t]=e.getFloat32(d),d+=4}else{p[0]=p[1]=p[2]=0,a[0]=a[1]=a[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,h[0]=h[1]=h[2]=0,n=new Float32Array(g);let i=0;const r=e.getInt32(d);d+=4;const s=e.getFloat32(d);let m;d+=4,o[0]=e.getInt32(d),o[1]=e.getInt32(d+4),o[2]=e.getInt32(d+8),o[3]=e.getInt32(d+12),o[4]=e.getInt32(d+16),o[5]=e.getInt32(d+20),a[0]=o[3]-o[0]+1,a[1]=o[4]-o[1]+1,a[2]=o[5]-o[2]+1,d+=24,(a[0]|a[1]|a[2])>16777215?(l[0]=nA(a[0]),l[1]=nA(a[1]),l[2]=nA(a[2]),m=0):m=rA(3,a);let _=e.getInt32(d);d+=4;let v=_-1;v=9>v?9:v;let y=eA[v]/2|0,b=eA[_]/2|0;c[0]=c[1]=c[2]=eA[_];let x=4*Math.ceil(e.getInt32(d)/4);d+=4;const w=1/s;let S=0,A=0;const M=new Uint8Array(t,d);for(u[0]=u[1]=u[2]=0;A<r;){0===m?(u[0]=sA(p,M,l[0],f),u[1]=sA(p,M,l[1],f),u[2]=sA(p,M,l[2],f)):aA(p,M,3,m,a,u,f),A++,u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],h[0]=u[0],h[1]=u[1],h[2]=u[2];let t=0;if(1===sA(p,M,1,f)&&(S=sA(p,M,5,f),t=S%3,S-=t,t--),S>0){u[0]=u[1]=u[2]=0;for(let t=0;t<S;t+=3){if(aA(p,M,3,_,c,u,f),A++,u[0]+=h[0]-b,u[1]+=h[1]-b,u[2]+=h[2]-b,0===t){let t=u[0];u[0]=h[0],h[0]=t,t=u[1],u[1]=h[1],h[1]=t,t=u[2],u[2]=h[2],h[2]=t,n[i++]=h[0]*w,n[i++]=h[1]*w,n[i++]=h[2]*w}else h[0]=u[0],h[1]=u[1],h[2]=u[2];n[i++]=u[0]*w,n[i++]=u[1]*w,n[i++]=u[2]*w}}else n[i++]=u[0]*w,n[i++]=u[1]*w,n[i++]=u[2]*w;if(_+=t,t<0?(b=y,y=_>9?eA[_-1]/2|0:0):t>0&&(y=b,b=eA[_]/2|0),c[0]=c[1]=c[2]=eA[_],0===c[0]||0===c[1]||0===c[2])return void console.error("(xdrfile error) Undefined error.")}d+=x}for(let t=0;t<g;t++)n[t]*=10;if(i.push(n),d>=t.byteLength)break}s.length>=1&&(n.timeOffset=s[0]),s.length>=2&&(n.deltaTime=s[1]-s[0]),Ql&&Yl.timeEnd("XtcParser._parse "+this.name)}});class lA extends eS{constructor(t,e){const n=e||{};super(t,n),this.volume=new qp(this.name,this.path),this.voxelSize=Aa(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new ze}}const cA=/\s+/,uA=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,hA=.529177210859;class dA extends lA{get type(){return"cube"}_parse(){Ql&&Yl.time("CubeParser._parse "+this.name);const t=this.volume,e=this.streamer.peekLines(6),n={},i=hA*this.voxelSize;function r(t,n){var i=e[t].trim().split(cA)[n];return parseFloat(i)}n.atomCount=Math.abs(r(2,0)),n.originX=r(2,1)*hA,n.originY=r(2,2)*hA,n.originZ=r(2,3)*hA,n.NVX=r(3,0),n.NVY=r(4,0),n.NVZ=r(5,0),n.basisX=new ue(r(3,1),r(3,2),r(3,3)).multiplyScalar(i),n.basisY=new ue(r(4,1),r(4,2),r(4,3)).multiplyScalar(i),n.basisZ=new ue(r(5,1),r(5,2),r(5,3)).multiplyScalar(i);const s=new Float32Array(n.NVX*n.NVY*n.NVZ);let o=0,a=0;const l=r(2,0)>0?0:1;this.streamer.eachChunkOfLines((function(t){!function(t,e,i){for(let t=0;t<e;++t){const e=i[t].trim();if(""!==e&&a>=n.atomCount+6+l){const t=e.match(uA);for(let e=0,n=t.length;e<n;++e)s[o]=parseFloat(t[e]),++o}++a}}(0,t.length,t)})),t.header=n,t.setData(s,n.NVZ,n.NVY,n.NVX),Ql&&Yl.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const t=this.volume.header,e=new ze;return e.multiply((new ze).makeTranslation(t.originX,t.originY,t.originZ)),e.multiply((new ze).makeBasis(t.basisZ,t.basisY,t.basisX)),e}}oc.add("cub",dA),oc.add("cube",dA);class pA extends lA{get type(){return"dsn6"}get isBinary(){return!0}_parse(){Ql&&Yl.time("Dsn6Parser._parse "+this.name);const t=this.volume,e={};let n,i;const r=Ua(this.streamer.data),s=new Int16Array(r),o=new Uint8Array(r),a=String.fromCharCode.apply(null,o.subarray(0,512));if(a.startsWith(":-)"))e.xStart=parseInt(a.substr(10,5)),e.yStart=parseInt(a.substr(15,5)),e.zStart=parseInt(a.substr(20,5)),e.xExtent=parseInt(a.substr(32,5)),e.yExtent=parseInt(a.substr(38,5)),e.zExtent=parseInt(a.substr(42,5)),e.xRate=parseInt(a.substr(52,5)),e.yRate=parseInt(a.substr(58,5)),e.zRate=parseInt(a.substr(62,5)),e.xlen=parseFloat(a.substr(73,10))*this.voxelSize,e.ylen=parseFloat(a.substr(83,10))*this.voxelSize,e.zlen=parseFloat(a.substr(93,10))*this.voxelSize,e.alpha=parseFloat(a.substr(103,10)),e.beta=parseFloat(a.substr(113,10)),e.gamma=parseFloat(a.substr(123,10)),n=parseFloat(a.substr(138,12))/100,i=parseInt(a.substr(155,8)),e.sigma=100*parseFloat(a.substr(170,12));else{if(100!==s[18])for(let t=0,e=s.length;t<e;++t){const e=s[t];s[t]=(255&e)<<8|e>>8&255}e.xStart=s[0],e.yStart=s[1],e.zStart=s[2],e.xExtent=s[3],e.yExtent=s[4],e.zExtent=s[5],e.xRate=s[6],e.yRate=s[7],e.zRate=s[8];const t=1/s[17],r=t*this.voxelSize;e.xlen=s[9]*r,e.ylen=s[10]*r,e.zlen=s[11]*r,e.alpha=s[12]*t,e.beta=s[13]*t,e.gamma=s[14]*t,n=s[15]/100,i=s[16],e.gamma=s[14]*t}t.header=e,Ql&&Yl.log(e,n,i);const l=new Float32Array(e.xExtent*e.yExtent*e.zExtent);let c=512;const u=Math.ceil(e.xExtent/8),h=Math.ceil(e.yExtent/8),d=Math.ceil(e.zExtent/8);for(var p=0;p<d;++p)for(var f=0;f<h;++f)for(var m=0;m<u;++m)for(var g=0;g<8;++g)for(var _=8*p+g,v=0;v<8;++v)for(var y=8*f+v,b=0;b<8;++b){var x=8*m+b;if(!(x<e.xExtent&&y<e.yExtent&&_<e.zExtent)){c+=8-b;break}l[(x*e.yExtent+y)*e.zExtent+_]=(o[c]-i)/n,++c}t.setData(l,e.zExtent,e.yExtent,e.xExtent),e.sigma&&t.setStats(void 0,void 0,void 0,e.sigma),Ql&&Yl.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const t=this.volume.header,e=[t.xlen,0,0],n=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],i=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];i[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-i[1]*i[1]);const r=[[],e,n,i],s=[0,t.xRate,t.yRate,t.zRate],o=[0,1,2,3],a=new ze;return a.set(r[o[1]][0]/s[o[1]],r[o[2]][0]/s[o[2]],r[o[3]][0]/s[o[3]],0,r[o[1]][1]/s[o[1]],r[o[2]][1]/s[o[2]],r[o[3]][1]/s[o[3]],0,r[o[1]][2]/s[o[1]],r[o[2]][2]/s[o[2]],r[o[3]][2]/s[o[3]],0,0,0,0,1),a.multiply((new ze).makeRotationY(qa(90))),a.multiply((new ze).makeTranslation(-t.zStart,t.yStart,t.xStart)),a.multiply((new ze).makeScale(-1,1,1)),a}}oc.add("dsn6",pA),oc.add("brix",pA);const fA=/\s+/;class mA extends lA{get type(){return"dx"}_parse(){Ql&&Yl.time("DxParser._parse "+this.name);const t=this.volume,e=this.streamer.peekLines(30),n=this.parseHeaderLines(e),i=this.volume.header,r=n.dataLineStart,s=i.nx*i.ny*i.nz,o=new Float32Array(s);let a=0,l=0;this.streamer.eachChunkOfLines((function(t){!function(t,e,n){for(let t=0;t<e;++t){if(a<s&&l>r){const e=n[t].trim();if(""!==e){const t=e.split(fA);for(let e=0,n=t.length;e<n;++e)o[a]=parseFloat(t[e]),++a}}++l}}(0,t.length,t)})),t.setData(o,i.nz,i.ny,i.nx),Ql&&Yl.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(t){const e={},n=t.length;let i=0,r=0,s=0;for(let o=0;o<n;++o){let n;const a=t[o];if(a.startsWith("object 1"))n=a.split(fA),e.nx=parseInt(n[5]),e.ny=parseInt(n[6]),e.nz=parseInt(n[7]);else if(a.startsWith("origin"))n=a.split(fA),e.xmin=parseFloat(n[1]),e.ymin=parseFloat(n[2]),e.zmin=parseFloat(n[3]);else if(a.startsWith("delta"))n=a.split(fA),0===s?e.hx=parseFloat(n[1])*this.voxelSize:1===s?e.hy=parseFloat(n[2])*this.voxelSize:2===s&&(e.hz=parseFloat(n[3])*this.voxelSize),s+=1;else if(a.startsWith("object 3")){i=o,r+=a.length+1;break}r+=a.length+1}return this.volume.header=e,{dataLineStart:i,headerByteCount:r}}getMatrix(){const t=this.volume.header,e=new ze;return e.multiply((new ze).makeRotationY(qa(90))),e.multiply((new ze).makeTranslation(-t.zmin,t.ymin,t.xmin)),e.multiply((new ze).makeScale(-t.hz,t.hy,t.hx)),e}}oc.add("dx",mA),oc.add("dxbin",class extends mA{get type(){return"dxbin"}get isBinary(){return!0}_parse(){Ql&&Yl.time("DxbinParser._parse "+this.name);const t=Ua(this.streamer.data),e=function(t,e=10485760,n="\n"){let i="",r=[];for(let s=0;s<t.length;s+=e){const o=Na(t.subarray(s,s+e)),a=o.lastIndexOf(n);if(-1===a)i+=o;else{const t=i+o.substr(0,a);r=r.concat(t.split(n)),i=a===o.length-n.length?"":o.substr(a+n.length)}}return""!==i&&r.push(i),r}(new Uint8Array(t,0,1e3)),n=this.parseHeaderLines(e),i=this.volume.header,r=n.headerByteCount,s=i.nx*i.ny*i.nz,o=new DataView(t),a=new Float32Array(s);for(let t=0;t<s;++t)a[t]=o.getFloat64(8*t+r,!0);this.volume.setData(a,i.nz,i.ny,i.nx),Ql&&Yl.timeEnd("DxbinParser._parse "+this.name)}});class gA extends lA{get type(){return"mrc"}get isBinary(){return!0}_parse(){Ql&&Yl.time("MrcParser._parse "+this.name);const t=this.volume,e={},n=Ua(this.streamer.data),i=new Int32Array(n,0,56),r=new Float32Array(n,0,56),s=new DataView(n);if(e.MAP=String.fromCharCode(s.getUint8(208),s.getUint8(209),s.getUint8(210),s.getUint8(211)),e.MACHST=[s.getUint8(212),s.getUint8(213)],17===e.MACHST[0]&&17===e.MACHST[1]){const t=n.byteLength;for(let e=0;e<t;e+=4)s.setFloat32(e,s.getFloat32(e),!0)}let o;if(e.NX=i[0],e.NY=i[1],e.NZ=i[2],e.MODE=i[3],e.NXSTART=i[4],e.NYSTART=i[5],e.NZSTART=i[6],e.MX=i[7],e.MY=i[8],e.MZ=i[9],e.xlen=r[10]*this.voxelSize,e.ylen=r[11]*this.voxelSize,e.zlen=r[12]*this.voxelSize,e.alpha=r[13],e.beta=r[14],e.gamma=r[15],e.MAPC=i[16],e.MAPR=i[17],e.MAPS=i[18],e.DMIN=r[19],e.DMAX=r[20],e.DMEAN=r[21],e.ISPG=i[22],e.NSYMBT=i[23],e.LSKFLG=i[24],e.originX=r[49],e.originY=r[50],e.originZ=r[51],e.ARMS=r[54],t.header=e,2===e.MODE)o=new Float32Array(n,1024+e.NSYMBT,e.NX*e.NY*e.NZ);else if(0===e.MODE){if(o=new Float32Array(new Int8Array(n,1024+e.NSYMBT,e.NX*e.NY*e.NZ)),-128===i[39]&&127===i[40]){const t=(e.DMAX-e.DMIN)/255,n=.5*(e.DMIN+e.DMAX+t);for(let e=0,i=o.length;e<i;++e)o[e]=t*o[e]+n}}else Yl.error("MrcParser unknown mode",e.MODE);t.setData(o,e.NX,e.NY,e.NZ),0!==e.ARMS&&t.setStats(e.DMIN,e.DMAX,e.DMEAN,e.ARMS),Ql&&Yl.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const t=this.volume.header,e=[t.xlen,0,0],n=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],i=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];i[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-i[1]*i[1]);const r=[[],e,n,i],s=[0,t.MX,t.MY,t.MZ],o=[0,t.MAPC,t.MAPR,t.MAPS],a=new ze;return a.set(r[o[1]][0]/s[o[1]],r[o[2]][0]/s[o[2]],r[o[3]][0]/s[o[3]],0,r[o[1]][1]/s[o[1]],r[o[2]][1]/s[o[2]],r[o[3]][1]/s[o[3]],0,r[o[1]][2]/s[o[1]],r[o[2]][2]/s[o[2]],r[o[3]][2]/s[o[3]],0,0,0,0,1),a.setPosition(new ue(t.originX,t.originY,t.originZ)),a.multiply((new ze).makeTranslation(t.NXSTART,t.NYSTART,t.NZSTART)),a}}oc.add("mrc",gA),oc.add("ccp4",gA),oc.add("map",gA);const _A=/\s+/;function vA(t){return t.trim().split(_A).map(parseFloat)}class yA extends lA{get type(){return"xplor"}_parse(){Ql&&Yl.time("XplorParser._parse "+this.name);const t=this.volume,e=this.streamer.peekLines(8),n={};let i;i=e[2].startsWith("REMARKS")?parseInt(e[1].substring(0,8))+2:5;const r=i+3,s=vA(e[i]);n.NA=s[0],n.AMIN=s[1],n.AMAX=s[2],n.NB=s[3],n.BMIN=s[4],n.BMAX=s[5],n.NC=s[6],n.CMIN=s[7],n.CMAX=s[8];const o=vA(e[i+1]);n.a=o[0]*this.voxelSize,n.b=o[1]*this.voxelSize,n.c=o[2]*this.voxelSize,n.alpha=o[3],n.beta=o[4],n.gamma=o[5];const a=n.AMAX-n.AMIN+1,l=n.BMAX-n.BMIN+1,c=n.CMAX-n.CMIN+1,u=a*l*c,h=new Float32Array(u),d=Math.ceil(1+a*l/6);let p=0,f=0;this.streamer.eachChunkOfLines((function(t){!function(t,e,i){for(let t=0;t<e;++t){const e=i[t];if(f>=r&&(f-r)%d!=0&&p<u)for(let t=0,n=6;t<n;++t){const n=parseFloat(e.substr(12*t,12));if(isNaN(n))break;h[p++]=n}else if(p===u){const t=e.trim();if(t&&"-9999"!==t){const t=vA(e);n.RAVE=t[0],n.RSIGMA=t[1]}}++f}}(0,t.length,t)})),t.header=n,t.setData(h,a,l,c),0!==n.RAVE&&1!==n.RSIGMA&&t.setStats(void 0,void 0,n.RAVE,n.RSIGMA),Ql&&Yl.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const t=this.volume.header,e=[t.a,0,0],n=[t.b*Math.cos(Math.PI/180*t.gamma),t.b*Math.sin(Math.PI/180*t.gamma),0],i=[t.c*Math.cos(Math.PI/180*t.beta),t.c*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];i[2]=Math.sqrt(t.c*t.c*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-i[1]*i[1]);const r=[[],e,n,i],s=[0,t.NA,t.NB,t.NC],o=[0,1,2,3],a=new ze;return a.set(r[o[1]][0]/s[o[1]],r[o[2]][0]/s[o[2]],r[o[3]][0]/s[o[3]],0,r[o[1]][1]/s[o[1]],r[o[2]][1]/s[o[2]],r[o[3]][1]/s[o[3]],0,r[o[1]][2]/s[o[1]],r[o[2]][2]/s[o[2]],r[o[3]][2]/s[o[3]],0,0,0,0,1),a.multiply((new ze).makeTranslation(t.AMIN,t.BMIN,t.CMIN)),a}}function bA(t,e,n){let i,r,s;t/=360,e/=100,n/=100;const o=Math.floor(6*t),a=6*t-o,l=n*(1-e),c=n*(1-a*e),u=n*(1-(1-a)*e);switch(o%6){case 0:i=n,r=u,s=l;break;case 1:i=c,r=n,s=l;break;case 2:i=l,r=n,s=u;break;case 3:i=l,r=c,s=n;break;case 4:i=u,r=l,s=n;break;case 5:i=n,r=l,s=c}return[i,r,s]}oc.add("xplor",yA),oc.add("cns",yA);const xA={red:bA(0,100,100),orange:bA(20,100,100),gold:bA(40,100,100),yellow:bA(60,100,100),lime:bA(80,100,100),green:bA(120,80,100),sea:bA(150,100,100),cyan:bA(180,100,85),sky:bA(210,75,95),blue:bA(240,70,100),purple:bA(275,75,100),magenta:bA(300,95,100),hotpink:bA(335,100,100),pink:bA(350,55,100),peach:bA(25,75,100),lilac:bA(275,55,100),pinktint:bA(340,30,100),peachtint:bA(25,50,100),yellowtint:bA(60,50,100),greentint:bA(135,40,100),bluetint:bA(220,40,100),lilactint:bA(275,35,100),white:bA(0,0,100),gray:bA(0,0,50),brown:bA(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},wA=/[\s,]+/,SA=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,AA=/^{+|}+$/g,MA=/^['"]+|['"]+$/g,CA=/\s*=\s*/g;function EA(t){let e,n,i,r=[];const s=(t=t.replace(CA,"=")).match(SA);for(let t=1;t<s.length;++t){const o=s[t];if("{"===o[0])e=o.substring(1,o.length-1);else{const t=o.split("=");2===t.length&&("color"===t[0]?n=xA[t[1]]:"width"===t[0]?i=parseInt(t[1]):"master"===t[0]&&r.push(t[1].replace(AA,"")))}}return{listName:e,listColor:n,listMasters:r,listWidth:i}}function TA(t){const e=(t=t.trim()).indexOf("{"),n=t.indexOf("}"),i=t.substr(n+1).split(wA),r=t.substr(e+1,n-1),s=[parseFloat(i[i.length-3]),parseFloat(i[i.length-2]),parseFloat(i[i.length-1])];let o,a,l,c=!1,u=!1;for(let t=4;t<=i.length;t++){const e=i[i.length-t];e in xA&&(o=xA[i[i.length-t]]),e.startsWith("width")&&(a=parseInt(e.substring(5))),e.startsWith("r=")&&(l=parseFloat(e.split("=")[1])),e.startsWith("P")&&(c=!0),e.startsWith("X")&&(u=!0)}return{label:r,position:s,color:o,radius:l,width:a,isLineBreak:c,isTriangleBreak:u}}function PA(t){const e=t.indexOf("{"),n=t.indexOf("}");return t.substring(-1!==e?e+1:0,-1!==n?n:void 0).trim()}function IA(t){const e=t.indexOf("}");return-1===e?void 0:t.substr(e+1).trim()}function RA(t){let e="",n=[],i={};const r=(t=t.replace(CA,"=")).match(SA);for(let t=1;t<r.length;++t){const s=r[t];if("{"===s[0])e=s.substring(1,s.length-1);else{const t=s.split("=");2===t.length?"master"===t[0]?n.push(t[1].replace(AA,"")):i[t[0]]=t[1].replace(AA,""):i[t[0]]=!0}}return{groupName:e,groupFlags:i,groupMasters:n}}oc.add("kin",class extends eS{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){Ql&&Yl.time(`KinParser._parse ${this.name}`);const t={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let e,n;this.kinemage=t;let i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M=!1,C="",E=!1,T="",P=null,I=null,R=!1,k="",D=!1,L="",O=!1,N=!1;if(this.streamer.eachChunkOfLines((function(F){!function(F,B,U){for(let F=0;F<B;++F){const B=U[F];if("@"===B[0]&&(M=!1,E=!1,R=!1,D=!1,O=!1,N=!1),B)if(B.startsWith("@dotlist")){let{listColor:a,listName:l,listMasters:c}=EA(B);M=!0,C="",r=[],s=[],o=[],i=a,e&&(c=c.concat(e)),n&&(c=c.concat(n)),t.dotLists.push({name:l,masterArray:c,labelArray:r,positionArray:s,colorArray:o})}else if(B.startsWith("@vectorlist")){let{listMasters:i,listName:r,listWidth:s,listColor:o}=EA(B);i&&i.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})})),E=!0,T="",P=null,I=null,c=[],u=[],h=[],d=[],p=[],f=[],a=o,l=[],s&&l.push(s),e&&(i=i.concat(e)),n&&(i=i.concat(n)),t.vectorLists.push({name:r,masterArray:i,label1Array:c,label2Array:u,position1Array:h,position2Array:d,color1Array:p,color2Array:f,width:l})}else if(B.startsWith("@balllist")){let{listName:i,listColor:r,listMasters:s}=EA(B);s&&s.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})})),R=!0,k="",_=[],m=[],v=[],y=[],g=r,e&&(s=s.concat(e)),n&&(s=s.concat(n)),t.ballLists.push({name:i,masterArray:s,labelArray:_,radiusArray:m,positionArray:v,colorArray:y})}else if(B.startsWith("@ribbonlist")||B.startsWith("@trianglelist")){let{listMasters:i,listName:r,listColor:s}=EA(B);i&&i.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})})),D=!0,L="",x=[],w=[],S=[],A=[],b=s,e&&(i=i.concat(e)),n&&(i=i.concat(n)),t.ribbonLists.push({name:r,masterArray:i,labelArray:x,positionArray:w,breakArray:S,colorArray:A})}else if(B.startsWith("@text"))O=!0,t.texts.push(B.substr(5));else if(B.startsWith("@caption"))N=!0,t.captions.push(B.substr(8));else if(M){let{label:t,color:e,position:n}=TA(B);'"'===t?t=C:C=t,void 0===e&&(e=i),r.push(t),s.push(...n),o.push(...e)}else if(E){let t=B.replace(/(?!^){/g,"\n{").split(/\n/);for(var z=0;z<t.length;z++){let e=t[z],{label:n,color:i,width:r,position:s,isLineBreak:o}=TA(e);'"'===n?n=T:T=n,void 0===i&&(i=a),o||null!==P&&(r&&l.push(r),c.push(T),h.push(...P),p.push(...I),u.push(n),d.push(...s),f.push(...i)),T=n,P=s,I=i}}else if(R){let{label:t,radius:e,color:n,position:i}=TA(B);'"'===t?t=k:k=t,void 0===e&&(e=1),void 0===n&&(n=g),_.push(t),m.push(e),v.push(...i),y.push(...n)}else if(D){let{label:t,color:e,position:n,isTriangleBreak:i}=TA(B);'"'===t?t=L:L=t,void 0===e&&(e=b),x.push(t),w.push(...n),S.push(i),A.push(...e)}else if(O)t.texts.push(B);else if(N)t.captions.push(B);else if(B.startsWith("@kinemage"))t.kinemage=parseInt(B.substr(9).trim());else if(B.startsWith("@onewidth"))t.onewidth=!0;else if(B.startsWith("@1viewid"))t["1viewid"]=PA(B);else if(B.startsWith("@pdbfile"))t.pdbfile=PA(B);else if(B.startsWith("@group")){let{groupName:n,groupFlags:i,groupMasters:r}=RA(B);t.groupDict[n]||(t.groupDict[n]={dominant:!1,animate:!1},e=r),e&&e.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})}));for(let e in i)t.groupDict[n][e]=i[e]}else if(B.startsWith("@subgroup")){const{groupName:e,groupFlags:i,groupMasters:r}=RA(B);t.subgroupDict[e]||(t.subgroupDict[e]={dominant:!1,animate:!1},n=r),n&&n.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})}));for(let n in i)t.subgroupDict[e][n]=i[n]}else if(B.startsWith("@master")){const e=PA(B),n=IA(B);t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1}),"on"===n?t.masterDict[e].visible=!0:"off"===n?t.masterDict[e].visible=!1:"indent"===n&&(t.masterDict[e].indent=!0)}else if(B.startsWith("@pointmaster")){const{groupName:e,groupFlags:n}=RA(B);t.pointmasterDict[e]={id:Object.keys(n)[0].replace(MA,"")}}else console.log(B);else M=!1,E=!1,R=!1,D=!1}}(0,F.length,F)})),t.text=t.texts.join("\n").trim(),t.caption=t.captions.join("\n").trim(),t.ribbonLists){let e=[];t.ribbonLists.forEach((function(t){e.push(function(t){let{labelArray:e,positionArray:n,colorArray:i,breakArray:r}=t,s=[],o=[],a=[],l=[];for(let t=0;t<r.length/3;t++){let c=3*t,u=9*t;r[c+1]||r[c+2]||(s.push(e[c]),s.push(e[c+1]),s.push(e[c+2]),l.push(r[c]),l.push(r[c+1]),l.push(r[c+2]),o.push(n[u]),o.push(n[u+1]),o.push(n[u+2]),o.push(n[u+3]),o.push(n[u+4]),o.push(n[u+5]),o.push(n[u+6]),o.push(n[u+7]),o.push(n[u+8]),a.push(i[u]),a.push(i[u+1]),a.push(i[u+2]),a.push(i[u+3]),a.push(i[u+4]),a.push(i[u+5]),a.push(i[u+6]),a.push(i[u+7]),a.push(i[u+8]))}return{name:t.name,masterArray:t.masterArray,labelArray:s,positionArray:o,breakArray:l,colorArray:a}}(function(t){let{labelArray:e,positionArray:n,colorArray:i,breakArray:r}=t,s=[];for(let t=0;t<3*(e.length-2);++t)s[t]=e[t-2*Math.floor(t/3)];let o=[];for(let t=0;t<3*(r.length-2);++t)o[t]=r[t-2*Math.floor(t/3)];let a=[];for(let t=0;t<9*(n.length/3-2);++t)a[t]=n[t-6*Math.floor(t/9)];let l=[];for(let t=0;t<9*(i.length/3-2);++t)l[t]=i[t-6*Math.floor(t/9)];let c=[];for(let t=0;t<a.length/3;++t)c.push(new ue(a[3*t],a[3*t]+1,a[3*t]+2));return{name:t.name,masterArray:t.masterArray,labelArray:s,positionArray:a,breakArray:o,colorArray:l}}(t)))})),t.ribbonLists=e}Ql&&Yl.timeEnd(`KinParser._parse ${this.name}`)}});class kA extends eS{constructor(t,e){super(t,e),this.loader=this.getLoader(),this.surface=new jp(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var t=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(t)}}const DA=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};DA.prototype={constructor:DA,setPath:function(t){this.path=t},_createParserState:function(){var t={objects:[],object:{},vertices:[],normals:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);this.object={name:t||"",geometry:{vertices:[],normals:[]},fromDeclaration:!1!==e},this.objects.push(this.object)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},addVertex:function(t,e,n){var i=this.vertices,r=this.object.geometry.vertices;r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addVertexLine:function(t){var e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0]),n.push(e[t+1]),n.push(e[t+2])},addNormal:function(t,e,n){var i=this.normals,r=this.object.geometry.normals;r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addFace:function(t,e,n,i,r,s,o,a){var l,c=this.vertices.length,u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(e,c),d=this.parseVertexIndex(n,c);if(void 0===i?this.addVertex(u,h,d):(l=this.parseVertexIndex(i,c),this.addVertex(u,h,l),this.addVertex(h,d,l)),void 0!==r){var p=this.normals.length;u=this.parseNormalIndex(r,p),h=r===s?u:this.parseNormalIndex(s,p),d=r===o?u:this.parseNormalIndex(o,p),void 0===i?this.addNormal(u,h,d):(l=this.parseNormalIndex(a,p),this.addNormal(u,h,l),this.addNormal(h,d,l))}},addLineGeometry:function(t){this.object.geometry.type="Line";for(var e=this.vertices.length,n=0,i=t.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(t[n],e))}};return t.startObject("",!1),t},parse:function(t){var e,n,i=this._createParserState();-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));var r=t.split("\n"),s="",o="",a="",l=[],c="function"==typeof"".trimLeft;for(e=0,n=r.length;e<n;e++)if(s=r[e],0!==(s=c?s.trimLeft():s.trim()).length&&"#"!==(o=s.charAt(0)))if("v"===o){if(" "===(a=s.charAt(1))&&null!==(l=this.regexp.vertex_pattern.exec(s)))i.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("n"===a&&null!==(l=this.regexp.normal_pattern.exec(s)))i.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("t"!==a||null===this.regexp.uv_pattern.exec(s))throw new Error("Unexpected vertex/normal/uv line: '"+s+"'")}else if("f"===o)if(null!==(l=this.regexp.face_vertex_uv_normal.exec(s)))i.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(null!==this.regexp.face_vertex_uv.exec(s));else if(null!==(l=this.regexp.face_vertex_normal.exec(s)))i.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if(null===(l=this.regexp.face_vertex.exec(s)))throw new Error("Unexpected face line: '"+s+"'");i.addFace(l[1],l[2],l[3],l[4])}else if("l"===o){var u=s.substring(1).trim().split(" "),h=[],d=[];if(-1===s.indexOf("/"))h=u;else for(var p=0,f=u.length;p<f;p++){var m=u[p].split("/");""!==m[0]&&h.push(m[0]),""!==m[1]&&d.push(m[1])}i.addLineGeometry(h,d)}else if(null!==(l=this.regexp.object_pattern.exec(s))){var g=l[0].substr(1).trim();i.startObject(g)}else if(this.regexp.material_use_pattern.test(s));else if(this.regexp.material_library_pattern.test(s));else if(null===this.regexp.smoothing_pattern.exec(s)){if("\0"===s)continue;throw new Error("Unexpected line: '"+s+"'")}var _=[];for(e=0,n=i.objects.length;e<n;e++){var v=i.objects[e].geometry;if(0!==v.vertices.length){var y=new qn;y.setAttribute("position",new Nn(new Float32Array(v.vertices),3)),v.normals.length>0?y.setAttribute("normal",new Nn(new Float32Array(v.normals),3)):y.computeVertexNormals(),_.push(y)}}return _}},oc.add("obj",class extends kA{get type(){return"obj"}getLoader(){return new DA}});const LA=["int8","char","uint8","uchar","int16","short","uint16","ushort","int32","int","uint32","uint","float32","float","float64","double"];function OA(t){if(function(t){return LA.includes(t)}(t))return t;throw new Error(`Unsupported data type: ${t}`)}function NA(t){if("object"!=typeof t||null===t)throw new Error("Expected element to be an object");if("string"!=typeof t.name)throw new Error("Expected element.name to be a string");if("number"!=typeof t.count)throw new Error("Expected element.count to be a number");if(!Array.isArray(t.properties))throw new Error("Expected element.properties to be an array")}function FA(t,e,n){switch(e){case"int8":case"char":return{read:e=>t.getInt8(e),size:1};case"uint8":case"uchar":return{read:e=>t.getUint8(e),size:1};case"int16":case"short":return{read:e=>t.getInt16(e,n),size:2};case"uint16":case"ushort":return{read:e=>t.getUint16(e,n),size:2};case"int32":case"int":return{read:e=>t.getInt32(e,n),size:4};case"uint32":case"uint":return{read:e=>t.getUint32(e,n),size:4};case"float32":case"float":return{read:e=>t.getFloat32(e,n),size:4};case"float64":case"double":return{read:e=>t.getFloat64(e,n),size:8};default:throw new Error(`Unsupported data type: ${e}`)}}function BA(t,e){const n={};let i=0;for(let r=0;r<e.length;r++){const s=e[r],o=s.valueReader;if(s.isList){const e=[],r=s.countReader.read(t+i);i+=s.countReader.size;for(let n=0;n<r;n++)e.push(o.read(t+i)),i+=o.size;n[s.name]=e}else n[s.name]=o.read(t+i),i+=o.size}return[n,i]}class UA{constructor(){this._color=new Pn,this.propertyNameMapping={},this.customPropertyMapping={}}setPropertyNameMapping(t){this.propertyNameMapping=t}createBuffer(){const t={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const e of Object.keys(this.customPropertyMapping))t[e]=[];return t}extractHeaderText(t){let e=0,n=!0,i="";const r=[],s=(new TextDecoder).decode(t.subarray(0,5)),o=/^ply\r\n/.test(s);do{const s=String.fromCharCode(t[e++]);"\n"!==s&&"\r"!==s?i+=s:("end_header"===i&&(n=!1),""!==i&&(r.push(i),i=""))}while(n&&e<t.length);return!0===o&&e++,{headerText:r.join("\r")+"\r",headerLength:e}}handleElement(t,e,n,i){if("vertex"===e){t.vertices.push(n[i.attrX],n[i.attrY],n[i.attrZ]),null!==i.attrNX&&null!==i.attrNY&&null!==i.attrNZ&&t.normals.push(n[i.attrNX],n[i.attrNY],n[i.attrNZ]),null!==i.attrS&&null!==i.attrT&&t.uvs.push(n[i.attrS],n[i.attrT]),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),t.colors.push(this._color.r,this._color.g,this._color.b));for(const e of Object.keys(this.customPropertyMapping))for(const i of this.customPropertyMapping[e])t[e].push(n[i])}else if("face"===e){const e=n.vertex_indices||n.vertex_index,r=n.texcoord;3===e.length?(t.indices.push(e[0],e[1],e[2]),r&&6===r.length&&(t.faceVertexUvs.push(r[0],r[1]),t.faceVertexUvs.push(r[2],r[3]),t.faceVertexUvs.push(r[4],r[5]))):4===e.length&&(t.indices.push(e[0],e[1],e[3]),t.indices.push(e[1],e[2],e[3])),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),t.faceVertexColors.push(this._color.r,this._color.g,this._color.b),t.faceVertexColors.push(this._color.r,this._color.g,this._color.b),t.faceVertexColors.push(this._color.r,this._color.g,this._color.b))}}parse(t){let e;if(t instanceof ArrayBuffer){const n=new Uint8Array(t),{headerText:i,headerLength:r}=this.extractHeaderText(n),s=this.parseHeader(i,r);if("ascii"===s.format){const t=(new TextDecoder).decode(n);e=this.parseASCII(t,s)}else e=this.parseBinary(n,s)}else e=this.parseASCII(t,this.parseHeader(t));return e}parseHeader(t,e=0){let n="";const i=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(t);null!==i&&(n=i[1]);const r={comments:[],elements:[],headerLength:e,objInfo:"",format:"",version:""},s=n.split(/\r\n|\r|\n/);let o;for(let t=0;t<s.length;t++){let e=s[t];if(e=e.trim(),""===e)continue;const n=e.split(/\s+/),i=n.shift();switch(e=n.join(" "),i){case"format":r.format=n[0],r.version=n[1];break;case"comment":r.comments.push(e);break;case"element":void 0!==o&&(NA(o),r.elements.push(o)),o={name:n[0],count:parseInt(n[1]),properties:[]};break;case"property":if(void 0===o){console.warn("property without element");continue}o.properties.push(zA(n,this.propertyNameMapping));break;case"obj_info":r.objInfo=e;break;default:console.log("unhandled",i,n)}}return void 0!==o&&r.elements.push(o),r}parseASCII(t,e){const n=this.createBuffer();let i,r;i=null!==(r=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(t))?r[1].split(/\s+/):[];const s=new $A(i);t:for(let t=0;t<e.elements.length;t++){const i=e.elements[t],r=GA(i.properties);for(let t=0;t<i.count;t++){const t=HA(i.properties,s);if(!t)break t;this.handleElement(n,i.name,t,r)}}return this.postProcess(n)}parseBinary(t,e){const n=this.createBuffer(),i="binary_little_endian"===e.format,r=new DataView(t,e.headerLength);let s,o=0;for(let t=0;t<e.elements.length;t++){const a=e.elements[t],l=a.properties,c=GA(l),u=this.makeBinaryProperties(l,r,i);for(let t=0;t<a.count;t++){s=BA(o,u),o+=s[1];const t=s[0];this.handleElement(n,a.name,t,c)}}return this.postProcess(n)}postProcess(t){let e=new qn;t.indices.length>0&&e.setIndex(t.indices),e.setAttribute("position",new Un(t.vertices,3)),t.normals.length>0&&e.setAttribute("normal",new Un(t.normals,3)),t.uvs.length>0&&e.setAttribute("uv",new Un(t.uvs,2)),t.colors.length>0&&e.setAttribute("color",new Un(t.colors,3)),(t.faceVertexUvs.length>0||t.faceVertexColors.length>0)&&(e=e.toNonIndexed(),t.faceVertexUvs.length>0&&e.setAttribute("uv",new Un(t.faceVertexUvs,2)),t.faceVertexColors.length>0&&e.setAttribute("color",new Un(t.faceVertexColors,3)));for(const n of Object.keys(this.customPropertyMapping))t[n].length>0&&e.setAttribute(n,new Un(t[n],this.customPropertyMapping[n].length));return e.computeBoundingSphere(),e}makeBinaryProperties(t,e,n){const i=[];for(let r=0,s=t.length;r<s;r++){const s=t[r];s.isList?i.push(Object.assign(Object.assign({},s),{countReader:FA(e,s.countType,n),valueReader:FA(e,s.type,n)})):i.push(Object.assign(Object.assign({},s),{valueReader:FA(e,s.type,n)}))}return i}}function zA(t,e){const n=t[0];let i;return i="list"===n?{isList:!0,name:t[3],type:OA(t[2]),countType:OA(t[1])}:{isList:!1,name:t[1],type:OA(n)},i.name in e&&(i.name=e[i.name]),i}function VA(t,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(t);case"float":case"double":case"float32":case"float64":return parseFloat(t)}return 0}function HA(t,e){const n={name:"",type:""};for(let i=0;i<t.length;i++){if(e.empty())return null;const r=t[i];if(r.isList){const t=[],i=VA(e.next(),r.countType);for(let n=0;n<i;n++){if(e.empty())return null;t.push(VA(e.next(),r.type))}n[r.name]=t}else n[t[i].name]=VA(e.next(),t[i].type)}return n}function GA(t){const e=t.map((t=>t.name));function n(t){for(let n=0,i=t.length;n<i;n++){const i=t[n];if(e.includes(i))return i}return null}return{attrX:n(["x","px","posx"])||"x",attrY:n(["y","py","posy"])||"y",attrZ:n(["z","pz","posz"])||"z",attrNX:n(["nx","normalx"]),attrNY:n(["ny","normaly"]),attrNZ:n(["nz","normalz"]),attrS:n(["s","u","texture_u","tx"]),attrT:n(["t","v","texture_v","ty"]),attrR:n(["red","diffuse_red","r","diffuse_r"]),attrG:n(["green","diffuse_green","g","diffuse_g"]),attrB:n(["blue","diffuse_blue","b","diffuse_b"])}}class $A{constructor(t){this.arr=t,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}oc.add("ply",class extends kA{get type(){return"ply"}getLoader(){return new UA}}),oc.add("csv",class extends eS{constructor(t,e){const n=e||{};super(t,n),this.delimiter=Aa(n.delimiter,","),this.comment=Aa(n.comment,"#"),this.columnNames=Aa(n.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const t=this.table.data,e=new RegExp("\\s*"+this.delimiter+"\\s*");let n=0;this.streamer.eachChunkOfLines((i=>{const r=i.length;for(let s=0;s<r;++s){const r=i[s].trim();if(r.startsWith(this.comment))continue;const o=r.split(e);0===n?this.table.columnNames=o:r&&t.push(o),++n}}))}}),oc.add("json",class extends eS{constructor(t,e){const n=e||{};super(t,n),this.string=Aa(n.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}}),oc.add("msgpack",class extends eS{constructor(t,e){super(t,e||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){Ql&&Yl.time("MsgpackParser._parse "+this.name),this.msgpack.data=IS(this.streamer.data),Ql&&Yl.timeEnd("MsgpackParser._parse "+this.name)}}),oc.add("netcdf",class extends eS{constructor(t,e){super(t,e||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){Ql&&Yl.time("NetcdfParser._parse "+this.name),this.netcdf.data=new JS(this.streamer.data),Ql&&Yl.timeEnd("NetcdfParser._parse "+this.name)}});class jA extends eS{constructor(t,e){super(t,e),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}oc.add("txt",jA),oc.add("text",jA);const WA=/^['"]|['"]$/g,qA=/^<([\w-:.]+)\s*/,XA=/^([^<]*)/,YA=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;class KA extends eS{constructor(t,e){const n=e||{};super(t,n),this.useDomParser=Aa(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(t){return function(t){return t=t.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:function(){if(!n(/^<\?xml\s*/))return;const t={attributes:{}};for(;!i()&&!r("?>");){const n=e();if(!n)return t;t.attributes[n.name]=n.value}return n(/\?>\s*/),t}(),root:function t(){const s=n(qA);if(!s)return;const o={name:s[1],attributes:{},children:[]};for(;!(i()||r(">")||r("?>")||r("/>"));){const t=e();if(!t)return o;o.attributes[t.name]=t.value}if(n(/^\s*\/>\s*/))return o;let a;for(n(/\??>\s*/),o.content=function(){const t=n(XA);return t?t[1]:""}();a=t();)o.children.push(a);return n(/^<\/[\w-:.]+>\s*/),o}()};function e(){const t=n(YA);var e;if(t)return{name:t[1],value:(e=t[2],e.replace(WA,""))}}function n(e){const n=t.match(e);if(n)return t=t.slice(n[0].length),n}function i(){return 0===t.length}function r(e){return 0===t.indexOf(e)}}(t)}__domParser(t){return(new window.DOMParser).parseFromString(t,"text/xml")}_parse(){Ql&&Yl.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),Ql&&Yl.timeEnd("XmlParser._parse "+this.name)}}function ZA(t,e){const n=t.getNamedItem(e);return null!==n?n.value:""}function QA(t,e,n=!1){const i=ZA(t,"icode").trim(),r=ZA(t,"chain").trim(),s=ZA(t,"altcode");let o=ZA(t,"resnum");return i&&(o+="^"+i),r&&(o+=":"+r),e&&(o+="."+e),n&&s.trim()&&(o+="%"+s),o+="/"+(parseInt(ZA(t,"model"))-1),o}function JA(t){const e=ZA(t,"chain").trim();let n=`[${ZA(t,"rescode")}]${ZA(t,"resnum")}`;return e&&(n+=`:${e}`),n}function tM(t,e,n){void 0===t[e]?t[e]=n:t[e]|=n}function eM(t,e){return null!==t&&t.value===e}function nM(t,e,n){let i=0;const r=e.getElementsByTagName("clash");for(let e=0,n=r.length;e<n;++e)if(t[ZA(r[e].attributes,"cid")]){i+=1;break}return e.getElementsByTagName("angle-outlier").length>0&&(i+=1),e.getElementsByTagName("bond-outlier").length>0&&(i+=1),e.getElementsByTagName("plane-outlier").length>0&&(i+=1),eM(n.getNamedItem("rota"),"OUTLIER")&&(i+=1),eM(n.getNamedItem("rama"),"OUTLIER")&&(i+=1),eM(n.getNamedItem("RNApucker"),"outlier")&&(i+=1),i}oc.add("xml",KA);class iM{constructor(t,e){this.name=t,this.path=e,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(t){Ql&&Yl.time("Validation.fromXml");const e=this.rsrzDict,n=this.rsccDict,i=this.rciDict,r=this.clashDict,s=this.clashArray,o=this.geoDict,a=this.geoAtomDict,l=this.atomDict,c=t.getElementsByTagName("Entry");if(1===c.length){const t=c[0].getElementsByTagName("chemical_shift_list");if(1===t.length){const e=t[0].getElementsByTagName("random_coil_index");for(let t=0,n=e.length;t<n;++t){const n=e[t].attributes;i[JA(n)]=parseFloat(ZA(n,"value"))}}}const u=t.getElementsByTagName("ModelledSubgroup"),h={},d=[];Ql&&Yl.time("Validation.fromXml#clashDict");for(let i=0,o=u.length;i<o;++i){const o=u[i],a=o.attributes,c=QA(a);null!==a.getNamedItem("rsrz")&&(e[c]=parseFloat(ZA(a,"rsrz"))),null!==a.getNamedItem("rscc")&&(n[c]=parseFloat(ZA(a,"rscc")));const p=t.createAttribute("sele");p.value=c,a.setNamedItem(p);const f=o.getElementsByTagName("clash");for(let t=0,e=f.length;t<e;++t){const e=f[t].attributes,n=ZA(e,"atom");if("H"!==dm(n)){const t=ZA(e,"cid"),i=QA(a,n,!0);if(l[i]=!0,void 0===h[t])h[t]={sele1:i,res1:c};else{const e=h[t];e.res1!==c&&(e.sele2=i,e.res2=c,d.push(e.res1,c),r[t]=e,s.push(e))}}}}Ql&&Yl.timeEnd("Validation.fromXml#clashDict");for(let t=0,e=u.length;t<e;++t){const e=u[t],n=e.attributes,i=ZA(n,"sele");if("."!==ZA(n,"seq")){const t=nM(r,e,n);t>0&&(o[i]=t)}else{const t=e.getElementsByTagName("clash"),n=e.getElementsByTagName("mog-bond-outlier"),s=e.getElementsByTagName("mog-angle-outlier");if(n.length>0||s.length>0||t.length>0){const e={};a[i]=e;for(let n=0,i=t.length;n<i;++n){const i=t[n].attributes;r[ZA(i,"cid")]&&tM(e,ZA(i,"atom"),1)}for(let t=0,i=n.length;t<i;++t)ZA(n[t].attributes,"atoms").split(",").forEach((function(t){tM(e,t,2)}));for(let t=0,n=s.length;t<n;++t)ZA(s[t].attributes,"atoms").split(",").forEach((function(t){tM(e,t,4)}))}}}this.clashSele=d.length?d.join(" OR "):"NONE",Ql&&Yl.timeEnd("Validation.fromXml")}getClashData(t){Ql&&Yl.time("Validation.getClashData");const e=t||{},n=e.structure,i=n.atomSet,r=new Pn(Aa(e.color,"#f0027f")),s=n.getAtomProxy(),o=n.getAtomProxy(),a=new ue,l=new ue,c=new ue,u=this.clashArray,h=u.length,d=new Float32Array(3*h),p=new Float32Array(3*h),f=jc(h,r.r,r.g,r.b),m=new Float32Array(h),g=new Float32Array(h);Ql&&Yl.time("Validation.getClashData#atomDict");const _=this.atomDict;n.eachAtom((function(t){const e=function(t){const e=t.inscode,n=t.chainname,i=t.atomname,r=t.altloc;let s=t.resno+"";return e&&(s+="^"+e),n&&(s+=":"+n),i&&(s+="."+i),r&&(s+="%"+r),s+="/"+t.modelIndex,s}(t);!0===_[e]&&(_[e]=t.index)})),Ql&&Yl.timeEnd("Validation.getClashData#atomDict");let v=0;return u.forEach((function(t,e){if(s.index=_[t.sele1],o.index=_[t.sele2],void 0===s.index||void 0===o.index||!i.isSet(s.index,o.index))return;a.subVectors(o,s).setLength(s.vdw),l.copy(s).add(a),a.subVectors(s,o).setLength(o.vdw),c.copy(o).add(a);const n=s.distanceTo(o)/2,r=Math.sqrt(s.vdw*s.vdw-n*n),u=Math.sqrt(o.vdw*o.vdw-n*n);l.toArray(d,3*v),c.toArray(p,3*v),m[v]=(r+u)/2,g[v]=e,++v})),Ql&&Yl.timeEnd("Validation.getClashData"),{position1:d.subarray(0,3*v),position2:p.subarray(0,3*v),color:f.subarray(0,3*v),color2:f.subarray(0,3*v),radius:m.subarray(0,v),picking:new pp(g.subarray(0,v),this,n)}}}function rM(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)}function sM(t,e,n,i,r){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+i),r);else for(var s=0;s<i;s++)t[r+s]=e[n+s]}function oM(t,e,n,i){for(var r=65535&t,s=t>>>16&65535,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{s=s+(r=r+e[i++]|0)|0}while(--o);r%=65521,s%=65521}return r|s<<16}oc.add("validation",class extends KA{constructor(t,e){super(t,e||{}),this.useDomParser=!0,this.validation=new iM(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),Ql&&Yl.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),Ql&&Yl.timeEnd("ValidationParser._parse "+this.name)}});var aM=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();function lM(t,e,n,i){var r=aM,s=i+n;t^=-1;for(var o=i;o<s;o++)t=t>>>8^r[255&(t^e[o])];return~t}function cM(t,e){var n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C;n=t.state,i=t.next_in,M=t.input,r=i+(t.avail_in-5),s=t.next_out,C=t.output,o=s-(e-t.avail_out),a=s+(t.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,p=n.hold,f=n.bits,m=n.lencode,g=n.distcode,_=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;t:do{f<15&&(p+=M[i++]<<f,f+=8,p+=M[i++]<<f,f+=8),y=m[p&_];e:for(;;){if(p>>>=b=y>>>24,f-=b,0==(b=y>>>16&255))C[s++]=65535&y;else{if(!(16&b)){if(64&b){if(32&b){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}y=m[(65535&y)+(p&(1<<b)-1)];continue e}for(x=65535&y,(b&=15)&&(f<b&&(p+=M[i++]<<f,f+=8),x+=p&(1<<b)-1,p>>>=b,f-=b),f<15&&(p+=M[i++]<<f,f+=8,p+=M[i++]<<f,f+=8),y=g[p&v];;){if(p>>>=b=y>>>24,f-=b,16&(b=y>>>16&255)){if(w=65535&y,f<(b&=15)&&(p+=M[i++]<<f,(f+=8)<b&&(p+=M[i++]<<f,f+=8)),(w+=p&(1<<b)-1)>l){t.msg="invalid distance too far back",n.mode=30;break t}if(p>>>=b,f-=b,w>(b=s-o)){if((b=w-b)>u&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(S=0,A=d,0===h){if(S+=c-b,b<x){x-=b;do{C[s++]=d[S++]}while(--b);S=s-w,A=C}}else if(h<b){if(S+=c+h-b,(b-=h)<x){x-=b;do{C[s++]=d[S++]}while(--b);if(S=0,h<x){x-=b=h;do{C[s++]=d[S++]}while(--b);S=s-w,A=C}}}else if(S+=h-b,b<x){x-=b;do{C[s++]=d[S++]}while(--b);S=s-w,A=C}for(;x>2;)C[s++]=A[S++],C[s++]=A[S++],C[s++]=A[S++],x-=3;x&&(C[s++]=A[S++],x>1&&(C[s++]=A[S++]))}else{S=s-w;do{C[s++]=C[S++],C[s++]=C[S++],C[s++]=C[S++],x-=3}while(x>2);x&&(C[s++]=C[S++],x>1&&(C[s++]=C[S++]))}break}if(64&b){t.msg="invalid distance code",n.mode=30;break t}y=g[(65535&y)+(p&(1<<b)-1)]}}break}}while(i<r&&s<a);i-=x=f>>3,p&=(1<<(f-=x<<3))-1,t.next_in=i,t.next_out=s,t.avail_in=i<r?r-i+5:5-(i-r),t.avail_out=s<a?a-s+257:257-(s-a),n.hold=p,n.bits=f}var uM=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],hM=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dM=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],pM=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function fM(t,e,n,i,r,s,o,a){var l,c,u,h,d,p,f,m,g,_=a.bits,v=0,y=0,b=0,x=0,w=0,S=0,A=0,M=0,C=0,E=0,T=null,P=0,I=new Uint16Array(16),R=new Uint16Array(16),k=null,D=0;for(v=0;v<=15;v++)I[v]=0;for(y=0;y<i;y++)I[e[n+y]]++;for(w=_,x=15;x>=1&&0===I[x];x--);if(w>x&&(w=x),0===x)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(b=1;b<x&&0===I[b];b++);for(w<b&&(w=b),M=1,v=1;v<=15;v++)if(M<<=1,(M-=I[v])<0)return-1;if(M>0&&(0===t||1!==x))return-1;for(R[1]=0,v=1;v<15;v++)R[v+1]=R[v]+I[v];for(y=0;y<i;y++)0!==e[n+y]&&(o[R[e[n+y]]++]=y);if(0===t?(T=k=o,p=19):1===t?(T=uM,P-=257,k=hM,D-=257,p=256):(T=dM,k=pM,p=-1),E=0,y=0,v=b,d=s,S=w,A=0,u=-1,h=(C=1<<w)-1,1===t&&C>852||2===t&&C>592)return 1;for(;;){f=v-A,o[y]<p?(m=0,g=o[y]):o[y]>p?(m=k[D+o[y]],g=T[P+o[y]]):(m=96,g=0),l=1<<v-A,b=c=1<<S;do{r[d+(E>>A)+(c-=l)]=f<<24|m<<16|g}while(0!==c);for(l=1<<v-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,y++,0==--I[v]){if(v===x)break;v=e[n+o[y]]}if(v>w&&(E&h)!==u){for(0===A&&(A=w),d+=b,M=1<<(S=v-A);S+A<x&&!((M-=I[S+A])<=0);)S++,M<<=1;if(C+=1<<S,1===t&&C>852||2===t&&C>592)return 1;r[u=E&h]=w<<24|S<<16|d-s}}return 0!==E&&(r[d+E]=v-A<<24|64<<16),a.bits=w,0}var mM=-2,gM=12,_M=30;function vM(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function yM(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var bM,xM,wM=!0;function SM(t){if(wM){var e;for(bM=new Int32Array(512),xM=new Int32Array(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(fM(1,t.lens,0,288,bM,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;fM(2,t.lens,0,32,xM,0,t.work,{bits:5}),wM=!1}t.lencode=bM,t.lenbits=9,t.distcode=xM,t.distbits=5}function AM(t,e,n,i){var r,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(sM(s.window,e,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((r=s.wsize-s.wnext)>i&&(r=i),sM(s.window,e,n-i,r,s.wnext),(i-=r)?(sM(s.window,e,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0}function MM(t,e){var n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,_,v,y,b,x,w,S,A,M,C=0,E=new Uint8Array(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return mM;(n=t.state).mode===gM&&(n.mode=13),o=t.next_out,r=t.output,l=t.avail_out,s=t.next_in,i=t.input,a=t.avail_in,c=n.hold,u=n.bits,h=a,d=l,S=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(2&n.wrap&&35615===c){n.check=0,E[0]=255&c,E[1]=c>>>8&255,n.check=lM(n.check,E,2,0),c=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",n.mode=_M;break}if(8!=(15&c)){t.msg="unknown compression method",n.mode=_M;break}if(u-=4,w=8+(15&(c>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){t.msg="invalid window size",n.mode=_M;break}n.dmax=1<<w,t.adler=n.check=1,n.mode=512&c?10:gM,c=0,u=0;break;case 2:for(;u<16;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(n.flags=c,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=_M;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=_M;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,n.check=lM(n.check,E,2,0)),c=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,E[2]=c>>>16&255,E[3]=c>>>24&255,n.check=lM(n.check,E,4,0)),c=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,n.check=lM(n.check,E,2,0)),c=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(E[0]=255&c,E[1]=c>>>8&255,n.check=lM(n.check,E,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>a&&(p=a),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),sM(n.head.extra,i,s,p,w)),512&n.flags&&(n.check=lM(n.check,i,p,s)),a-=p,s+=p,n.length-=p),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break t;p=0;do{w=i[s+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<a);if(512&n.flags&&(n.check=lM(n.check,i,p,s)),a-=p,s+=p,w)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break t;p=0;do{w=i[s+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<a);if(512&n.flags&&(n.check=lM(n.check,i,p,s)),a-=p,s+=p,w)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(c!==(65535&n.check)){t.msg="header crc mismatch",n.mode=_M;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=gM;break;case 10:for(;u<32;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}t.adler=n.check=vM(c),c=0,u=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,n.hold=c,n.bits=u,2;t.adler=n.check=1,n.mode=gM;case gM:if(5===e||6===e)break t;case 13:if(n.last){c>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(SM(n),n.mode=20,6===e){c>>>=2,u-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=_M}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",n.mode=_M;break}if(n.length=65535&c,c=0,u=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(p=n.length){if(p>a&&(p=a),p>l&&(p=l),0===p)break t;sM(r,i,s,p,o),a-=p,s+=p,l-=p,o+=p,n.length-=p;break}n.mode=gM;break;case 17:for(;u<14;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=_M;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}n.lens[T[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[T[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},S=fM(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,S){t.msg="invalid code lengths set",n.mode=_M;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;_=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(M=g+2;u<M;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){t.msg="invalid bit length repeat",n.mode=_M;break}w=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(M=g+3;u<M;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}u-=g,w=0,p=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(M=g+7;u<M;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}u-=g,w=0,p=11+(127&(c>>>=g)),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=_M;break}for(;p--;)n.lens[n.have++]=w}}if(n.mode===_M)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=_M;break}if(n.lenbits=9,A={bits:n.lenbits},S=fM(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,S){t.msg="invalid literal/lengths set",n.mode=_M;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},S=fM(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,S){t.msg="invalid distances set",n.mode=_M;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(a>=6&&l>=258){t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,n.hold=c,n.bits=u,cM(t,d),o=t.next_out,r=t.output,l=t.avail_out,s=t.next_in,i=t.input,a=t.avail_in,c=n.hold,u=n.bits,n.mode===gM&&(n.back=-1);break}for(n.back=0;_=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(_&&!(240&_)){for(y=g,b=_,x=v;_=(C=n.lencode[x+((c&(1<<y+b)-1)>>y)])>>>16&255,v=65535&C,!(y+(g=C>>>24)<=u);){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===_){n.mode=26;break}if(32&_){n.back=-1,n.mode=gM;break}if(64&_){t.msg="invalid literal/length code",n.mode=_M;break}n.extra=15&_,n.mode=22;case 22:if(n.extra){for(M=n.extra;u<M;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;_=(C=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(!(240&_)){for(y=g,b=_,x=v;_=(C=n.distcode[x+((c&(1<<y+b)-1)>>y)])>>>16&255,v=65535&C,!(y+(g=C>>>24)<=u);){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=g,u-=g,n.back+=g,64&_){t.msg="invalid distance code",n.mode=_M;break}n.offset=v,n.extra=15&_,n.mode=24;case 24:if(n.extra){for(M=n.extra;u<M;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=_M;break}n.mode=25;case 25:if(0===l)break t;if(p=d-l,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=_M;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=r,f=o-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{r[o++]=m[f++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break t;r[o++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===a)break t;a--,c|=i[s++]<<u,u+=8}if(d-=l,t.total_out+=d,n.total+=d,d&&(t.adler=n.check=n.flags?lM(n.check,r,d,o-d):oM(n.check,r,d,o-d)),d=l,(n.flags?c:vM(c))!==n.check){t.msg="incorrect data check",n.mode=_M;break}c=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===a)break t;a--,c+=i[s++]<<u,u+=8}if(c!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=_M;break}c=0,u=0}n.mode=29;case 29:S=1;break t;case _M:S=-3;break t;case 31:return-4;default:return mM}return t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,n.hold=c,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<_M&&(n.mode<27||4!==e))&&AM(t,t.output,t.next_out,d-t.avail_out),h-=t.avail_in,d-=t.avail_out,t.total_in+=h,t.total_out+=d,n.total+=d,n.wrap&&d&&(t.adler=n.check=n.flags?lM(n.check,r,d,t.next_out-d):oM(n.check,r,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===gM?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===d||4===e)&&0===S&&(S=-5),S}function CM(t,e){var n,i=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?mM:11===n.mode&&oM(1,e,i,0)!==n.check?-3:AM(t,e,i,i)?(n.mode=31,-4):(n.havedict=1,0):mM}var EM=!0,TM=!0;try{String.fromCharCode.apply(null,[0])}catch(al){EM=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(al){TM=!1}for(var PM=new Uint8Array(256),IM=0;IM<256;IM++)PM[IM]=IM>=252?6:IM>=248?5:IM>=240?4:IM>=224?3:IM>=192?2:1;function RM(t){var e,n,i,r,s,o=t.length,a=0;for(r=0;r<o;r++)55296==(64512&(n=t.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,r=0;s<a;r++)55296==(64512&(n=t.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e}function kM(t,e){var n,i,r,s,o=e||t.length,a=new Array(2*o);for(i=0,n=0;n<o;)if((r=t[n++])<128)a[i++]=r;else if((s=PM[r])>4)a[i++]=65533,n+=s-1;else{for(r&=2===s?31:3===s?15:7;s>1&&n<o;)r=r<<6|63&t[n++],s--;s>1?a[i++]=65533:r<65536?a[i++]=r:(r-=65536,a[i++]=55296|r>>10&1023,a[i++]=56320|1023&r)}return function(t,e){if(e<65537&&(t.subarray&&TM||!t.subarray&&EM))return String.fromCharCode.apply(null,rM(t,e));for(var n="",i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n}(a,i)}function DM(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+PM[t[n]]>e?n:e}PM[254]=PM[254]=1;var LM={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function OM(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function NM(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var FM=Object.prototype.toString;function BM(t){if(!(this instanceof BM))return new BM(t);this.options=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}}return t}({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new OM,this.strm.avail_out=0;var n,i,r,s=function(t,e){var n,i;return t?(i=new yM,t.state=i,i.window=null,n=function(t,e){var n,i;return t&&t.state?(i=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?mM:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,function(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,function(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,0):mM}(t)):mM}(t))):mM}(t,e),0!==n&&(t.state=null),n):mM}(this.strm,e.windowBits);if(0!==s)throw new Error(LM[s]);this.header=new NM,n=this.strm,i=this.header,n&&n.state&&2&(r=n.state).wrap&&(r.head=i,i.done=!1)}BM.prototype.push=function(t,e){var n,i,r,s,o,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;i=e===~~e?e:!0===e?4:0,"string"==typeof t?l.input=function(t){for(var e=new Uint8Array(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e}(t):"[object ArrayBuffer]"===FM.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Uint8Array(c),l.next_out=0,l.avail_out=c),2===(n=MM(l,0))&&u&&(a="string"==typeof u?RM(u):"[object ArrayBuffer]"===FM.call(u)?new Uint8Array(u):u,n=CM(this.strm,a)),-5===n&&!0===h&&(n=0,h=!1),1!==n&&0!==n)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&1!==n&&(0!==l.avail_in||4!==i&&2!==i)||("string"===this.options.to?(r=DM(l.output,l.next_out),s=l.next_out-r,o=kM(l.output,r),l.next_out=s,l.avail_out=c-s,s&&sM(l.output,l.output,r,s,0),this.onData(o)):this.onData(rM(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&1!==n);return 1===n&&(i=4),4===i?(n=function(t){if(!t||!t.state)return mM;var e=t.state;return e.window&&(e.window=null),t.state=null,0}(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==i||(this.onEnd(0),l.avail_out=0,!0)},BM.prototype.onData=function(t){this.chunks.push(t)},BM.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=function(t){var e,n,i,r,s,o;for(i=0,e=0,n=t.length;e<n;e++)i+=t[e].length;for(o=new Uint8Array(i),r=0,e=0,n=t.length;e<n;e++)s=t[e],o.set(s,r),r+=s.length;return o}(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},lc.add("gz",(function(t){let e;t instanceof ArrayBuffer&&(t=new Uint8Array(t));try{e=function(t){var e=new BM(void 0);if(e.push(t,!0),e.err)throw e.msg;return e.result}(t)}catch(n){e=t}return e}));class UM{}const zM="https:";rc.add("rcsb",new class extends UM{getUrl(t){const e=Sc(t),n=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);return!["pdb","cif"].includes(e.ext)||!1!==e.compressed&&"gz"!==e.compressed?("mmtf"===e.ext&&(Yl.warn("MMTF files distribution has been discontinued by RCSB PDB as of July 2024.\n Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice"),e.base.endsWith(".bb")&&Yl.warn("Backbone only files are not available from RCSB PDB anymore."),e.ext=""),e.ext?Yl.warn("unsupported ext",e.ext):Yl.warn('mmCif files available from RCSB PDB lack connectivity information.\n Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.'),zM+"//models.rcsb.org/"+n+".bcif.gz"):zM+"//files.rcsb.org/download/"+e.path}getExt(t){return Sc(t).ext||"bcif"}});const VM="//www.ebi.ac.uk/pdbe/entry-files/download/";rc.add("pdbe",new class extends UM{getUrl(t){const e=Sc(t);let n,i=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);switch(e.ext){case"cif":n=VM+i+"_updated.cif";break;case"pdb":case"ent":i.startsWith("pdb")||(i="pdb"+i),n=VM+i+".ent";break;case"bcif":n=VM+e.path;break;case"":n=VM+i+".bcif";break;default:Yl.warn("unsupported ext",e.ext),n=VM+i+".bcif"}return"https://"+n}getExt(t){return Sc(t).ext||"bcif"}});const HM="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",GM="/SDF?record_type=3d";rc.add("pubchem",new class extends UM{getUrl(t){const e=Sc(t),n=e.name;let i;return e.ext&&"sdf"!==e.ext?(Yl.warn("unsupported ext",e.ext),i=HM+n+GM):i=HM+n+GM,function(){const t=window.location.protocol;return null===t.match(/http(s)?:/gi)?"http:":t}()+i}getExt(t){return Sc(t).ext||"sdf"}});class $M extends UM{getUrl(t){return t}getExt(t){return Sc(t).ext}}rc.add("ftp",new $M),rc.add("http",new $M),rc.add("https",new $M);const jM="//alphafold.ebi.ac.uk/files/AF-",WM="-F1-model_v4.pdb";rc.add("alphafold",new class extends UM{getUrl(t){const e=Sc(t),n=e.name;let i;return e.ext&&"pdb"!==e.ext?(Yl.warn("unsupported AF ext",e.ext),i=jM+n+WM):i=jM+n+WM,"https://"+i}getExt(t){return Sc(t).ext||"pdb"}});const qM=/^((http|https|ftp):)*\/\//;class XM extends UM{constructor(t=""){super(),this.baseUrl=t}getUrl(t){const e=Sc(t);let n=this.baseUrl+e.path;return qM.test(this.baseUrl)||(n=function(t){const e=window.location,n=e.pathname,i=n.substring(0,n.lastIndexOf("/")+1);return e.origin+i+t}(n)),n}getExt(t){return Sc(t).ext}}class YM extends UM{constructor(t=""){super(),this.baseUrl=t}getListing(t=""){let e=`${this.baseUrl}dir/${t}`;return"/"!==e[e.length-1]&&(e+="/"),Mc(e,{ext:"json"}).then((e=>({path:t,data:e.data})))}getUrl(t){const e=Sc(t);return`${this.baseUrl}file/${e.path}${e.query}`}getCountUrl(t){const e=Sc(t);return`${this.baseUrl}traj/numframes/${e.path}${e.query}`}getFrameUrl(t,e){const n=Sc(t);return`${this.baseUrl}traj/frame/${e}/${n.path}${n.query}`}getFrameParams(t,e){return`atomIndices=${e.join(";")}`}getPathUrl(t,e){const n=Sc(t);return`${this.baseUrl}traj/path/${e}/${n.path}${n.query}`}getExt(t){return Sc(t).ext}}function KM(t,e){return{type:"integer",max:t,min:e}}function ZM(t,e,n){return{type:"number",precision:t,max:e,min:n}}function QM(t,e,n){return{type:"range",step:t,max:e,min:n}}function JM(...t){return{type:"select",options:t.reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:e})),{})}}const tC={backgroundColor:{type:"color"},quality:JM("auto","low","medium","high"),sampleLevel:QM(1,5,-1),impostor:{type:"boolean"},workerDefault:{type:"boolean"},rotateSpeed:ZM(1,10,0),zoomSpeed:ZM(1,10,0),panSpeed:ZM(1,10,0),clipNear:QM(1,100,0),clipFar:QM(1,100,0),clipDist:KM(200,0),clipMode:JM("scene","camera"),clipScale:JM("relative","absolute"),fogNear:QM(1,100,0),fogFar:QM(1,100,0),cameraType:JM("perspective","orthographic","stereo"),cameraEyeSep:ZM(3,1,.01),cameraFov:QM(1,120,15),lightColor:{type:"color"},lightIntensity:ZM(2,10,0),ambientColor:{type:"color"},ambientIntensity:ZM(2,10,0),hoverTimeout:KM(1e4,-1),tooltip:{type:"boolean"},mousePreset:JM(...Object.keys(cf))},eC="2.4.0"},6407:function(t,e,n){var i;!function(){function r(t,e,n,i,r){this._listener=e,this._isOnce=n,this.context=i,this._signal=t,this._priority=r||0}function s(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function o(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){o.prototype.dispatch.apply(t,arguments)}}r.prototype={active:!0,params:null,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,n),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},o.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,n,i){var s,o=this._indexOfListener(t,n);if(-1!==o){if((s=this._bindings[o]).isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else s=new r(this,t,e,n,i),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(t){var e=this._bindings.length;do{--e}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===t&&n.context===e)return i;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,n){return s(t,"add"),this._registerListener(t,!1,e,n)},addOnce:function(t,e,n){return s(t,"addOnce"),this._registerListener(t,!0,e,n)},remove:function(t,e){s(t,"remove");var n=this._indexOfListener(t,e);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(t){if(this.active){var e,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){e=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(e[i]&&this._shouldPropagate&&!1!==e[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var a=o;a.Signal=o,void 0===(i=function(){return a}.call(e,n,e,t))||(t.exports=i)}()},2917:(t,e,n)=>{var i;!function(){"use strict";var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function s(t){return function(t,e){var n,i,o,a,l,c,u,h,d,p=1,f=t.length,m="";for(i=0;i<f;i++)if("string"==typeof t[i])m+=t[i];else if("object"==typeof t[i]){if((a=t[i]).keys)for(n=e[p],o=0;o<a.keys.length;o++){if(null==n)throw new Error(s('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?e[a.param_no]:e[p++];if(r.not_type.test(a.type)&&r.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),r.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(s("[sprintf] expecting number but found %T",n));switch(r.number.test(a.type)&&(h=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}r.json.test(a.type)?m+=n:(!r.number.test(a.type)||h&&!a.sign?d="":(d=h?"+":"-",n=n.toString().replace(r.sign,"")),c=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",u=a.width-(d+n).length,l=a.width&&u>0?c.repeat(u):"",m+=a.align?d+n+l:"0"===c?d+l+n:l+d+n)}return m}(function(t){if(a[t])return a[t];for(var e,n=t,i=[],s=0;n;){if(null!==(e=r.text.exec(n)))i.push(e[0]);else if(null!==(e=r.modulo.exec(n)))i.push("%");else{if(null===(e=r.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(e[2]){s|=1;var o=[],l=e[2],c=[];if(null===(c=r.key.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(c[1]);""!==(l=l.substring(c[0].length));)if(null!==(c=r.key_access.exec(l)))o.push(c[1]);else{if(null===(c=r.index_access.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(c[1])}e[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i.push({placeholder:e[0],param_no:e[1],keys:e[2],sign:e[3],pad_char:e[4],align:e[5],width:e[6],precision:e[7],type:e[8]})}n=n.substring(e[0].length)}return a[t]=i}(t),arguments)}function o(t,e){return s.apply(null,[t].concat(e||[]))}var a=Object.create(null);e.sprintf=s,e.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=s,window.vsprintf=o,void 0===(i=function(){return{sprintf:s,vsprintf:o}}.call(e,n,e,t))||(t.exports=i))}()},3457:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Accordion 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/accordion/#theming\n */\n.ui-accordion .ui-accordion-header {\n\tdisplay: block;\n\tcursor: pointer;\n\tposition: relative;\n\tmargin: 2px 0 0 0;\n\tpadding: .5em .5em .5em .7em;\n\tfont-size: 100%;\n}\n.ui-accordion .ui-accordion-content {\n\tpadding: 1em 2.2em;\n\tborder-top: 0;\n\toverflow: auto;\n}\n",""])},3774:(t,e,n)=>{(e=t.exports=n(742)()).i(n(5164),""),e.i(n(6028),""),e.push([t.id,"/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n */\n",""])},7047:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Autocomplete 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/autocomplete/#theming\n */\n.ui-autocomplete {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tcursor: default;\n}\n",""])},5164:(t,e,n)=>{(e=t.exports=n(742)()).i(n(7610),""),e.i(n(3457),""),e.i(n(7047),""),e.i(n(6519),""),e.i(n(2075),""),e.i(n(9839),""),e.i(n(6885),""),e.i(n(2275),""),e.i(n(6038),""),e.i(n(818),""),e.i(n(9871),""),e.i(n(9844),""),e.i(n(8611),""),e.i(n(7306),""),e.i(n(7783),""),e.i(n(988),""),e.i(n(4028),""),e.i(n(3303),""),e.i(n(1110),""),e.push([t.id,"/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n */\n",""])},6519:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Button 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/button/#theming\n */\n.ui-button {\n\tpadding: .4em 1em;\n\tdisplay: inline-block;\n\tposition: relative;\n\tline-height: normal;\n\tmargin-right: .1em;\n\tcursor: pointer;\n\tvertical-align: middle;\n\ttext-align: center;\n\t-webkit-user-select: none;\n\tuser-select: none;\n}\n\n.ui-button,\n.ui-button:link,\n.ui-button:visited,\n.ui-button:hover,\n.ui-button:active {\n\ttext-decoration: none;\n}\n\n/* to make room for the icon, a width needs to be set here */\n.ui-button-icon-only {\n\twidth: 2em;\n\tbox-sizing: border-box;\n\ttext-indent: -9999px;\n\twhite-space: nowrap;\n}\n\n/* no icon support for input elements */\ninput.ui-button.ui-button-icon-only {\n\ttext-indent: 0;\n}\n\n/* button icon element(s) */\n.ui-button-icon-only .ui-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\tmargin-top: -8px;\n\tmargin-left: -8px;\n}\n\n.ui-button.ui-icon-notext .ui-icon {\n\tpadding: 0;\n\twidth: 2.1em;\n\theight: 2.1em;\n\ttext-indent: -9999px;\n\twhite-space: nowrap;\n\n}\n\ninput.ui-button.ui-icon-notext .ui-icon {\n\twidth: auto;\n\theight: auto;\n\ttext-indent: 0;\n\twhite-space: normal;\n\tpadding: .4em 1em;\n}\n\n/* workarounds */\n/* Support: Firefox 5 - 125+ */\ninput.ui-button::-moz-focus-inner,\nbutton.ui-button::-moz-focus-inner {\n\tborder: 0;\n\tpadding: 0;\n}\n",""])},2075:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Checkboxradio 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/checkboxradio/#theming\n */\n\n.ui-checkboxradio-label .ui-icon-background {\n\tbox-shadow: inset 1px 1px 1px #ccc;\n\tborder-radius: .12em;\n\tborder: none;\n}\n.ui-checkboxradio-radio-label .ui-icon-background {\n\twidth: 16px;\n\theight: 16px;\n\tborder-radius: 1em;\n\toverflow: visible;\n\tborder: none;\n}\n.ui-checkboxradio-radio-label.ui-checkboxradio-checked .ui-icon,\n.ui-checkboxradio-radio-label.ui-checkboxradio-checked:hover .ui-icon {\n\tbackground-image: none;\n\twidth: 8px;\n\theight: 8px;\n\tborder-width: 4px;\n\tborder-style: solid;\n}\n.ui-checkboxradio-disabled {\n\tpointer-events: none;\n}\n",""])},9839:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Controlgroup 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/controlgroup/#theming\n */\n\n.ui-controlgroup {\n\tvertical-align: middle;\n\tdisplay: inline-block;\n}\n.ui-controlgroup > .ui-controlgroup-item {\n\tfloat: left;\n\tmargin-left: 0;\n\tmargin-right: 0;\n}\n.ui-controlgroup > .ui-controlgroup-item:focus,\n.ui-controlgroup > .ui-controlgroup-item.ui-visual-focus {\n\tz-index: 9999;\n}\n.ui-controlgroup-vertical > .ui-controlgroup-item {\n\tdisplay: block;\n\tfloat: none;\n\twidth: 100%;\n\tmargin-top: 0;\n\tmargin-bottom: 0;\n\ttext-align: left;\n}\n.ui-controlgroup-vertical .ui-controlgroup-item {\n\tbox-sizing: border-box;\n}\n.ui-controlgroup .ui-controlgroup-label {\n\tpadding: .4em 1em;\n}\n.ui-controlgroup .ui-controlgroup-label span {\n\tfont-size: 80%;\n}\n.ui-controlgroup-horizontal .ui-controlgroup-label + .ui-controlgroup-item {\n\tborder-left: none;\n}\n.ui-controlgroup-vertical .ui-controlgroup-label + .ui-controlgroup-item {\n\tborder-top: none;\n}\n.ui-controlgroup-horizontal .ui-controlgroup-label.ui-widget-content {\n\tborder-right: none;\n}\n.ui-controlgroup-vertical .ui-controlgroup-label.ui-widget-content {\n\tborder-bottom: none;\n}\n\n/* Spinner specific style fixes */\n.ui-controlgroup-vertical .ui-spinner-input {\n\twidth: calc( 100% - 2.4em );\n}\n.ui-controlgroup-vertical .ui-spinner .ui-spinner-up {\n\tborder-top-style: solid;\n}\n\n",""])},7610:(t,e,n)=>{(t.exports=n(742)()).push([t.id,'/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n */\n\n/* Layout helpers\n----------------------------------*/\n.ui-helper-hidden {\n\tdisplay: none;\n}\n.ui-helper-hidden-accessible {\n\tborder: 0;\n\tclip: rect(0 0 0 0);\n\theight: 1px;\n\tmargin: -1px;\n\toverflow: hidden;\n\tpadding: 0;\n\tposition: absolute;\n\twidth: 1px;\n}\n.ui-helper-reset {\n\tmargin: 0;\n\tpadding: 0;\n\tborder: 0;\n\toutline: 0;\n\tline-height: 1.3;\n\ttext-decoration: none;\n\tfont-size: 100%;\n\tlist-style: none;\n}\n.ui-helper-clearfix:before,\n.ui-helper-clearfix:after {\n\tcontent: "";\n\tdisplay: table;\n\tborder-collapse: collapse;\n}\n.ui-helper-clearfix:after {\n\tclear: both;\n}\n.ui-helper-zfix {\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\tposition: absolute;\n\topacity: 0;\n}\n\n.ui-front {\n\tz-index: 100;\n}\n\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-disabled {\n\tcursor: default !important;\n\tpointer-events: none;\n}\n\n\n/* Icons\n----------------------------------*/\n.ui-icon {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tmargin-top: -.25em;\n\tposition: relative;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n}\n\n.ui-widget-icon-block {\n\tleft: 50%;\n\tmargin-left: -8px;\n\tdisplay: block;\n}\n\n/* Misc visuals\n----------------------------------*/\n\n/* Overlays */\n.ui-widget-overlay {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n',""])},6885:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Datepicker 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/datepicker/#theming\n */\n.ui-datepicker {\n\twidth: 17em;\n\tpadding: .2em .2em 0;\n\tdisplay: none;\n}\n.ui-datepicker .ui-datepicker-header {\n\tposition: relative;\n\tpadding: .2em 0;\n}\n.ui-datepicker .ui-datepicker-prev,\n.ui-datepicker .ui-datepicker-next {\n\tposition: absolute;\n\ttop: 2px;\n\twidth: 1.8em;\n\theight: 1.8em;\n}\n.ui-datepicker .ui-datepicker-prev-hover,\n.ui-datepicker .ui-datepicker-next-hover {\n\ttop: 1px;\n}\n.ui-datepicker .ui-datepicker-prev {\n\tleft: 2px;\n}\n.ui-datepicker .ui-datepicker-next {\n\tright: 2px;\n}\n.ui-datepicker .ui-datepicker-prev-hover {\n\tleft: 1px;\n}\n.ui-datepicker .ui-datepicker-next-hover {\n\tright: 1px;\n}\n.ui-datepicker .ui-datepicker-prev span,\n.ui-datepicker .ui-datepicker-next span {\n\tdisplay: block;\n\tposition: absolute;\n\tleft: 50%;\n\tmargin-left: -8px;\n\ttop: 50%;\n\tmargin-top: -8px;\n}\n.ui-datepicker .ui-datepicker-title {\n\tmargin: 0 2.3em;\n\tline-height: 1.8em;\n\ttext-align: center;\n}\n.ui-datepicker .ui-datepicker-title select {\n\tfont-size: 1em;\n\tmargin: 1px 0;\n}\n.ui-datepicker select.ui-datepicker-month,\n.ui-datepicker select.ui-datepicker-year {\n\twidth: 45%;\n}\n.ui-datepicker table {\n\twidth: 100%;\n\tfont-size: .9em;\n\tborder-collapse: collapse;\n\tmargin: 0 0 .4em;\n}\n.ui-datepicker th {\n\tpadding: .7em .3em;\n\ttext-align: center;\n\tfont-weight: bold;\n\tborder: 0;\n}\n.ui-datepicker td {\n\tborder: 0;\n\tpadding: 1px;\n}\n.ui-datepicker td span,\n.ui-datepicker td a {\n\tdisplay: block;\n\tpadding: .2em;\n\ttext-align: right;\n\ttext-decoration: none;\n}\n.ui-datepicker .ui-datepicker-buttonpane {\n\tbackground-image: none;\n\tmargin: .7em 0 0 0;\n\tpadding: 0 .2em;\n\tborder-left: 0;\n\tborder-right: 0;\n\tborder-bottom: 0;\n}\n.ui-datepicker .ui-datepicker-buttonpane button {\n\tfloat: right;\n\tmargin: .5em .2em .4em;\n\tcursor: pointer;\n\tpadding: .2em .6em .3em .6em;\n\twidth: auto;\n\toverflow: visible;\n}\n.ui-datepicker .ui-datepicker-buttonpane button.ui-datepicker-current {\n\tfloat: left;\n}\n\n/* with multiple calendars */\n.ui-datepicker.ui-datepicker-multi {\n\twidth: auto;\n}\n.ui-datepicker-multi .ui-datepicker-group {\n\tfloat: left;\n}\n.ui-datepicker-multi .ui-datepicker-group table {\n\twidth: 95%;\n\tmargin: 0 auto .4em;\n}\n.ui-datepicker-multi-2 .ui-datepicker-group {\n\twidth: 50%;\n}\n.ui-datepicker-multi-3 .ui-datepicker-group {\n\twidth: 33.3%;\n}\n.ui-datepicker-multi-4 .ui-datepicker-group {\n\twidth: 25%;\n}\n.ui-datepicker-multi .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-multi .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-left-width: 0;\n}\n.ui-datepicker-multi .ui-datepicker-buttonpane {\n\tclear: left;\n}\n.ui-datepicker-row-break {\n\tclear: both;\n\twidth: 100%;\n\tfont-size: 0;\n}\n\n/* RTL support */\n.ui-datepicker-rtl {\n\tdirection: rtl;\n}\n.ui-datepicker-rtl .ui-datepicker-prev {\n\tright: 2px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next {\n\tleft: 2px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-prev:hover {\n\tright: 1px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next:hover {\n\tleft: 1px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane {\n\tclear: right;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button {\n\tfloat: left;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button.ui-datepicker-current,\n.ui-datepicker-rtl .ui-datepicker-group {\n\tfloat: right;\n}\n.ui-datepicker-rtl .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-rtl .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-right-width: 0;\n\tborder-left-width: 1px;\n}\n\n/* Icons */\n.ui-datepicker .ui-icon {\n\tdisplay: block;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n\tleft: .5em;\n\ttop: .3em;\n}\n",""])},2275:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Dialog 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/dialog/#theming\n */\n.ui-dialog {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tpadding: .2em;\n\toutline: 0;\n}\n.ui-dialog .ui-dialog-titlebar {\n\tpadding: .4em 1em;\n\tposition: relative;\n}\n.ui-dialog .ui-dialog-title {\n\tfloat: left;\n\tmargin: .1em 0;\n\twhite-space: nowrap;\n\twidth: 90%;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.ui-dialog .ui-dialog-titlebar-close {\n\tposition: absolute;\n\tright: .3em;\n\ttop: 50%;\n\twidth: 20px;\n\tmargin: -10px 0 0 0;\n\tpadding: 1px;\n\theight: 20px;\n}\n.ui-dialog .ui-dialog-content {\n\tposition: relative;\n\tborder: 0;\n\tpadding: .5em 1em;\n\tbackground: none;\n\toverflow: auto;\n}\n.ui-dialog .ui-dialog-buttonpane {\n\ttext-align: left;\n\tborder-width: 1px 0 0 0;\n\tbackground-image: none;\n\tmargin-top: .5em;\n\tpadding: .3em 1em .5em .4em;\n}\n.ui-dialog .ui-dialog-buttonpane .ui-dialog-buttonset {\n\tfloat: right;\n}\n.ui-dialog .ui-dialog-buttonpane button {\n\tmargin: .5em .4em .5em 0;\n\tcursor: pointer;\n}\n.ui-dialog .ui-resizable-n {\n\theight: 2px;\n\ttop: 0;\n}\n.ui-dialog .ui-resizable-e {\n\twidth: 2px;\n\tright: 0;\n}\n.ui-dialog .ui-resizable-s {\n\theight: 2px;\n\tbottom: 0;\n}\n.ui-dialog .ui-resizable-w {\n\twidth: 2px;\n\tleft: 0;\n}\n.ui-dialog .ui-resizable-se,\n.ui-dialog .ui-resizable-sw,\n.ui-dialog .ui-resizable-ne,\n.ui-dialog .ui-resizable-nw {\n\twidth: 7px;\n\theight: 7px;\n}\n.ui-dialog .ui-resizable-se {\n\tright: 0;\n\tbottom: 0;\n}\n.ui-dialog .ui-resizable-sw {\n\tleft: 0;\n\tbottom: 0;\n}\n.ui-dialog .ui-resizable-ne {\n\tright: 0;\n\ttop: 0;\n}\n.ui-dialog .ui-resizable-nw {\n\tleft: 0;\n\ttop: 0;\n}\n.ui-draggable .ui-dialog-titlebar {\n\tcursor: move;\n}\n",""])},6038:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Draggable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-draggable-handle {\n\ttouch-action: none;\n}\n",""])},818:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Menu 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/menu/#theming\n */\n.ui-menu {\n\tlist-style: none;\n\tpadding: 0;\n\tmargin: 0;\n\tdisplay: block;\n\toutline: 0;\n}\n.ui-menu .ui-menu {\n\tposition: absolute;\n}\n.ui-menu .ui-menu-item {\n\tmargin: 0;\n\tcursor: pointer;\n}\n.ui-menu .ui-menu-item-wrapper {\n\tposition: relative;\n\tpadding: 3px 1em 3px .4em;\n}\n.ui-menu .ui-menu-divider {\n\tmargin: 5px 0;\n\theight: 0;\n\tfont-size: 0;\n\tline-height: 0;\n\tborder-width: 1px 0 0 0;\n}\n.ui-menu .ui-state-focus,\n.ui-menu .ui-state-active {\n\tmargin: -1px;\n}\n\n/* icon support */\n.ui-menu-icons {\n\tposition: relative;\n}\n.ui-menu-icons .ui-menu-item-wrapper {\n\tpadding-left: 2em;\n}\n\n/* left-aligned */\n.ui-menu .ui-icon {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\tleft: .2em;\n\tmargin: auto 0;\n}\n\n/* right-aligned */\n.ui-menu .ui-menu-icon {\n\tleft: auto;\n\tright: 0;\n}\n",""])},9871:(t,e,n)=>{(t.exports=n(742)()).push([t.id,'/*!\n * jQuery UI Progressbar 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/progressbar/#theming\n */\n.ui-progressbar {\n\theight: 2em;\n\ttext-align: left;\n\toverflow: hidden;\n}\n.ui-progressbar .ui-progressbar-value {\n\tmargin: -1px;\n\theight: 100%;\n}\n.ui-progressbar .ui-progressbar-overlay {\n\tbackground: url("data:image/gif;base64,R0lGODlhKAAoAIABAAAAAP///yH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAQABACwAAAAAKAAoAAACkYwNqXrdC52DS06a7MFZI+4FHBCKoDeWKXqymPqGqxvJrXZbMx7Ttc+w9XgU2FB3lOyQRWET2IFGiU9m1frDVpxZZc6bfHwv4c1YXP6k1Vdy292Fb6UkuvFtXpvWSzA+HycXJHUXiGYIiMg2R6W459gnWGfHNdjIqDWVqemH2ekpObkpOlppWUqZiqr6edqqWQAAIfkECQEAAQAsAAAAACgAKAAAApSMgZnGfaqcg1E2uuzDmmHUBR8Qil95hiPKqWn3aqtLsS18y7G1SzNeowWBENtQd+T1JktP05nzPTdJZlR6vUxNWWjV+vUWhWNkWFwxl9VpZRedYcflIOLafaa28XdsH/ynlcc1uPVDZxQIR0K25+cICCmoqCe5mGhZOfeYSUh5yJcJyrkZWWpaR8doJ2o4NYq62lAAACH5BAkBAAEALAAAAAAoACgAAAKVDI4Yy22ZnINRNqosw0Bv7i1gyHUkFj7oSaWlu3ovC8GxNso5fluz3qLVhBVeT/Lz7ZTHyxL5dDalQWPVOsQWtRnuwXaFTj9jVVh8pma9JjZ4zYSj5ZOyma7uuolffh+IR5aW97cHuBUXKGKXlKjn+DiHWMcYJah4N0lYCMlJOXipGRr5qdgoSTrqWSq6WFl2ypoaUAAAIfkECQEAAQAsAAAAACgAKAAAApaEb6HLgd/iO7FNWtcFWe+ufODGjRfoiJ2akShbueb0wtI50zm02pbvwfWEMWBQ1zKGlLIhskiEPm9R6vRXxV4ZzWT2yHOGpWMyorblKlNp8HmHEb/lCXjcW7bmtXP8Xt229OVWR1fod2eWqNfHuMjXCPkIGNileOiImVmCOEmoSfn3yXlJWmoHGhqp6ilYuWYpmTqKUgAAIfkECQEAAQAsAAAAACgAKAAAApiEH6kb58biQ3FNWtMFWW3eNVcojuFGfqnZqSebuS06w5V80/X02pKe8zFwP6EFWOT1lDFk8rGERh1TTNOocQ61Hm4Xm2VexUHpzjymViHrFbiELsefVrn6XKfnt2Q9G/+Xdie499XHd2g4h7ioOGhXGJboGAnXSBnoBwKYyfioubZJ2Hn0RuRZaflZOil56Zp6iioKSXpUAAAh+QQJAQABACwAAAAAKAAoAAACkoQRqRvnxuI7kU1a1UU5bd5tnSeOZXhmn5lWK3qNTWvRdQxP8qvaC+/yaYQzXO7BMvaUEmJRd3TsiMAgswmNYrSgZdYrTX6tSHGZO73ezuAw2uxuQ+BbeZfMxsexY35+/Qe4J1inV0g4x3WHuMhIl2jXOKT2Q+VU5fgoSUI52VfZyfkJGkha6jmY+aaYdirq+lQAACH5BAkBAAEALAAAAAAoACgAAAKWBIKpYe0L3YNKToqswUlvznigd4wiR4KhZrKt9Upqip61i9E3vMvxRdHlbEFiEXfk9YARYxOZZD6VQ2pUunBmtRXo1Lf8hMVVcNl8JafV38aM2/Fu5V16Bn63r6xt97j09+MXSFi4BniGFae3hzbH9+hYBzkpuUh5aZmHuanZOZgIuvbGiNeomCnaxxap2upaCZsq+1kAACH5BAkBAAEALAAAAAAoACgAAAKXjI8By5zf4kOxTVrXNVlv1X0d8IGZGKLnNpYtm8Lr9cqVeuOSvfOW79D9aDHizNhDJidFZhNydEahOaDH6nomtJjp1tutKoNWkvA6JqfRVLHU/QUfau9l2x7G54d1fl995xcIGAdXqMfBNadoYrhH+Mg2KBlpVpbluCiXmMnZ2Sh4GBqJ+ckIOqqJ6LmKSllZmsoq6wpQAAAh+QQJAQABACwAAAAAKAAoAAAClYx/oLvoxuJDkU1a1YUZbJ59nSd2ZXhWqbRa2/gF8Gu2DY3iqs7yrq+xBYEkYvFSM8aSSObE+ZgRl1BHFZNr7pRCavZ5BW2142hY3AN/zWtsmf12p9XxxFl2lpLn1rseztfXZjdIWIf2s5dItwjYKBgo9yg5pHgzJXTEeGlZuenpyPmpGQoKOWkYmSpaSnqKileI2FAAACH5BAkBAAEALAAAAAAoACgAAAKVjB+gu+jG4kORTVrVhRlsnn2dJ3ZleFaptFrb+CXmO9OozeL5VfP99HvAWhpiUdcwkpBH3825AwYdU8xTqlLGhtCosArKMpvfa1mMRae9VvWZfeB2XfPkeLmm18lUcBj+p5dnN8jXZ3YIGEhYuOUn45aoCDkp16hl5IjYJvjWKcnoGQpqyPlpOhr3aElaqrq56Bq7VAAAOw==");\n\theight: 100%;\n\topacity: 0.25;\n}\n.ui-progressbar-indeterminate .ui-progressbar-value {\n\tbackground-image: none;\n}\n',""])},9844:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Resizable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-resizable {\n\tposition: relative;\n}\n.ui-resizable-handle {\n\tposition: absolute;\n\tfont-size: 0.1px;\n\tdisplay: block;\n\ttouch-action: none;\n}\n.ui-resizable-disabled .ui-resizable-handle,\n.ui-resizable-autohide .ui-resizable-handle {\n\tdisplay: none;\n}\n.ui-resizable-n {\n\tcursor: n-resize;\n\theight: 7px;\n\twidth: 100%;\n\ttop: -5px;\n\tleft: 0;\n}\n.ui-resizable-s {\n\tcursor: s-resize;\n\theight: 7px;\n\twidth: 100%;\n\tbottom: -5px;\n\tleft: 0;\n}\n.ui-resizable-e {\n\tcursor: e-resize;\n\twidth: 7px;\n\tright: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-w {\n\tcursor: w-resize;\n\twidth: 7px;\n\tleft: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-se {\n\tcursor: se-resize;\n\twidth: 12px;\n\theight: 12px;\n\tright: 1px;\n\tbottom: 1px;\n}\n.ui-resizable-sw {\n\tcursor: sw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\tbottom: -5px;\n}\n.ui-resizable-nw {\n\tcursor: nw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\ttop: -5px;\n}\n.ui-resizable-ne {\n\tcursor: ne-resize;\n\twidth: 9px;\n\theight: 9px;\n\tright: -5px;\n\ttop: -5px;\n}\n",""])},8611:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Selectable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-selectable {\n\ttouch-action: none;\n}\n.ui-selectable-helper {\n\tposition: absolute;\n\tz-index: 100;\n\tborder: 1px dotted black;\n}\n",""])},7306:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Selectmenu 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/selectmenu/#theming\n */\n.ui-selectmenu-menu {\n\tpadding: 0;\n\tmargin: 0;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tdisplay: none;\n}\n.ui-selectmenu-menu .ui-menu {\n\toverflow: auto;\n\toverflow-x: hidden;\n\tpadding-bottom: 1px;\n}\n.ui-selectmenu-menu .ui-menu .ui-selectmenu-optgroup {\n\tfont-size: 1em;\n\tfont-weight: bold;\n\tline-height: 1.5;\n\tpadding: 2px 0.4em;\n\tmargin: 0.5em 0 0 0;\n\theight: auto;\n\tborder: 0;\n}\n.ui-selectmenu-open {\n\tdisplay: block;\n}\n.ui-selectmenu-text {\n\tdisplay: block;\n\tmargin-right: 20px;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.ui-selectmenu-button.ui-button {\n\ttext-align: left;\n\twhite-space: nowrap;\n\twidth: 14em;\n}\n.ui-selectmenu-icon.ui-icon {\n\tfloat: right;\n\tmargin-top: 0;\n}\n",""])},988:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Slider 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/slider/#theming\n */\n.ui-slider {\n\tposition: relative;\n\ttext-align: left;\n}\n.ui-slider .ui-slider-handle {\n\tposition: absolute;\n\tz-index: 2;\n\twidth: 1.2em;\n\theight: 1.2em;\n\tcursor: pointer;\n\ttouch-action: none;\n}\n.ui-slider .ui-slider-range {\n\tposition: absolute;\n\tz-index: 1;\n\tfont-size: .7em;\n\tdisplay: block;\n\tborder: 0;\n\tbackground-position: 0 0;\n}\n\n.ui-slider-horizontal {\n\theight: .8em;\n}\n.ui-slider-horizontal .ui-slider-handle {\n\ttop: -.3em;\n\tmargin-left: -.6em;\n}\n.ui-slider-horizontal .ui-slider-range {\n\ttop: 0;\n\theight: 100%;\n}\n.ui-slider-horizontal .ui-slider-range-min {\n\tleft: 0;\n}\n.ui-slider-horizontal .ui-slider-range-max {\n\tright: 0;\n}\n\n.ui-slider-vertical {\n\twidth: .8em;\n\theight: 100px;\n}\n.ui-slider-vertical .ui-slider-handle {\n\tleft: -.3em;\n\tmargin-left: 0;\n\tmargin-bottom: -.6em;\n}\n.ui-slider-vertical .ui-slider-range {\n\tleft: 0;\n\twidth: 100%;\n}\n.ui-slider-vertical .ui-slider-range-min {\n\tbottom: 0;\n}\n.ui-slider-vertical .ui-slider-range-max {\n\ttop: 0;\n}\n",""])},7783:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Sortable 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n */\n.ui-sortable-handle {\n\ttouch-action: none;\n}\n",""])},4028:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Spinner 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/spinner/#theming\n */\n.ui-spinner {\n\tposition: relative;\n\tdisplay: inline-block;\n\toverflow: hidden;\n\tpadding: 0;\n\tvertical-align: middle;\n}\n.ui-spinner-input {\n\tborder: none;\n\tbackground: none;\n\tcolor: inherit;\n\tpadding: .222em 0;\n\tmargin: .2em 0;\n\tvertical-align: middle;\n\tmargin-left: .4em;\n\tmargin-right: 2em;\n}\n.ui-spinner-button {\n\twidth: 1.6em;\n\theight: 50%;\n\tfont-size: .5em;\n\tpadding: 0;\n\tmargin: 0;\n\ttext-align: center;\n\tposition: absolute;\n\tcursor: default;\n\tdisplay: block;\n\toverflow: hidden;\n\tright: 0;\n}\n/* more specificity required here to override default borders */\n.ui-spinner a.ui-spinner-button {\n\tborder-top-style: none;\n\tborder-bottom-style: none;\n\tborder-right-style: none;\n}\n.ui-spinner-up {\n\ttop: 0;\n}\n.ui-spinner-down {\n\tbottom: 0;\n}\n",""])},3303:(t,e,n)=>{(t.exports=n(742)()).push([t.id,'/*!\n * jQuery UI Tabs 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/tabs/#theming\n */\n.ui-tabs {\n\tposition: relative;/* position: relative prevents IE scroll bug (element with position: relative inside container with overflow: auto appear as "fixed") */\n\tpadding: .2em;\n}\n.ui-tabs .ui-tabs-nav {\n\tmargin: 0;\n\tpadding: .2em .2em 0;\n}\n.ui-tabs .ui-tabs-nav li {\n\tlist-style: none;\n\tfloat: left;\n\tposition: relative;\n\ttop: 0;\n\tmargin: 1px .2em 0 0;\n\tborder-bottom-width: 0;\n\tpadding: 0;\n\twhite-space: nowrap;\n}\n.ui-tabs .ui-tabs-nav .ui-tabs-anchor {\n\tfloat: left;\n\tpadding: .5em 1em;\n\ttext-decoration: none;\n}\n.ui-tabs .ui-tabs-nav li.ui-tabs-active {\n\tmargin-bottom: -1px;\n\tpadding-bottom: 1px;\n}\n.ui-tabs .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor,\n.ui-tabs .ui-tabs-nav li.ui-state-disabled .ui-tabs-anchor,\n.ui-tabs .ui-tabs-nav li.ui-tabs-loading .ui-tabs-anchor {\n\tcursor: text;\n}\n.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor {\n\tcursor: pointer;\n}\n.ui-tabs .ui-tabs-panel {\n\tdisplay: block;\n\tborder-width: 0;\n\tpadding: 1em 1.4em;\n\tbackground: none;\n}\n',""])},6028:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI CSS Framework 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/category/theming/\n *\n * To view and modify this theme, visit https://jqueryui.com/themeroller/\n */\n\n\n/* Component containers\n----------------------------------*/\n.ui-widget {\n\tfont-family: Arial,Helvetica,sans-serif/*{ffDefault}*/;\n\tfont-size: 1em/*{fsDefault}*/;\n}\n.ui-widget .ui-widget {\n\tfont-size: 1em;\n}\n.ui-widget input,\n.ui-widget select,\n.ui-widget textarea,\n.ui-widget button {\n\tfont-family: Arial,Helvetica,sans-serif/*{ffDefault}*/;\n\tfont-size: 1em;\n}\n.ui-widget.ui-widget-content {\n\tborder: 1px solid #c5c5c5/*{borderColorDefault}*/;\n}\n.ui-widget-content {\n\tborder: 1px solid #dddddd/*{borderColorContent}*/;\n\tbackground: #ffffff/*{bgColorContent}*/ /*{bgImgUrlContent}*/ /*{bgContentXPos}*/ /*{bgContentYPos}*/ /*{bgContentRepeat}*/;\n\tcolor: #333333/*{fcContent}*/;\n}\n.ui-widget-content a {\n\tcolor: #333333/*{fcContent}*/;\n}\n.ui-widget-header {\n\tborder: 1px solid #dddddd/*{borderColorHeader}*/;\n\tbackground: #e9e9e9/*{bgColorHeader}*/ /*{bgImgUrlHeader}*/ /*{bgHeaderXPos}*/ /*{bgHeaderYPos}*/ /*{bgHeaderRepeat}*/;\n\tcolor: #333333/*{fcHeader}*/;\n\tfont-weight: bold;\n}\n.ui-widget-header a {\n\tcolor: #333333/*{fcHeader}*/;\n}\n\n/* Interaction states\n----------------------------------*/\n.ui-state-default,\n.ui-widget-content .ui-state-default,\n.ui-widget-header .ui-state-default,\n.ui-button,\n\n/* We use html here because we need a greater specificity to make sure disabled\nworks properly when clicked or hovered */\nhtml .ui-button.ui-state-disabled:hover,\nhtml .ui-button.ui-state-disabled:active {\n\tborder: 1px solid #c5c5c5/*{borderColorDefault}*/;\n\tbackground: #f6f6f6/*{bgColorDefault}*/ /*{bgImgUrlDefault}*/ /*{bgDefaultXPos}*/ /*{bgDefaultYPos}*/ /*{bgDefaultRepeat}*/;\n\tfont-weight: normal/*{fwDefault}*/;\n\tcolor: #454545/*{fcDefault}*/;\n}\n.ui-state-default a,\n.ui-state-default a:link,\n.ui-state-default a:visited,\na.ui-button,\na:link.ui-button,\na:visited.ui-button,\n.ui-button {\n\tcolor: #454545/*{fcDefault}*/;\n\ttext-decoration: none;\n}\n.ui-state-hover,\n.ui-widget-content .ui-state-hover,\n.ui-widget-header .ui-state-hover,\n.ui-state-focus,\n.ui-widget-content .ui-state-focus,\n.ui-widget-header .ui-state-focus,\n.ui-button:hover,\n.ui-button:focus {\n\tborder: 1px solid #cccccc/*{borderColorHover}*/;\n\tbackground: #ededed/*{bgColorHover}*/ /*{bgImgUrlHover}*/ /*{bgHoverXPos}*/ /*{bgHoverYPos}*/ /*{bgHoverRepeat}*/;\n\tfont-weight: normal/*{fwDefault}*/;\n\tcolor: #2b2b2b/*{fcHover}*/;\n}\n.ui-state-hover a,\n.ui-state-hover a:hover,\n.ui-state-hover a:link,\n.ui-state-hover a:visited,\n.ui-state-focus a,\n.ui-state-focus a:hover,\n.ui-state-focus a:link,\n.ui-state-focus a:visited,\na.ui-button:hover,\na.ui-button:focus {\n\tcolor: #2b2b2b/*{fcHover}*/;\n\ttext-decoration: none;\n}\n\n.ui-visual-focus {\n\tbox-shadow: 0 0 3px 1px rgb(94, 158, 214);\n}\n.ui-state-active,\n.ui-widget-content .ui-state-active,\n.ui-widget-header .ui-state-active,\na.ui-button:active,\n.ui-button:active,\n.ui-button.ui-state-active:hover {\n\tborder: 1px solid #003eff/*{borderColorActive}*/;\n\tbackground: #007fff/*{bgColorActive}*/ /*{bgImgUrlActive}*/ /*{bgActiveXPos}*/ /*{bgActiveYPos}*/ /*{bgActiveRepeat}*/;\n\tfont-weight: normal/*{fwDefault}*/;\n\tcolor: #ffffff/*{fcActive}*/;\n}\n.ui-icon-background,\n.ui-state-active .ui-icon-background {\n\tborder: #003eff/*{borderColorActive}*/;\n\tbackground-color: #ffffff/*{fcActive}*/;\n}\n.ui-state-active a,\n.ui-state-active a:link,\n.ui-state-active a:visited {\n\tcolor: #ffffff/*{fcActive}*/;\n\ttext-decoration: none;\n}\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-highlight,\n.ui-widget-content .ui-state-highlight,\n.ui-widget-header .ui-state-highlight {\n\tborder: 1px solid #dad55e/*{borderColorHighlight}*/;\n\tbackground: #fffa90/*{bgColorHighlight}*/ /*{bgImgUrlHighlight}*/ /*{bgHighlightXPos}*/ /*{bgHighlightYPos}*/ /*{bgHighlightRepeat}*/;\n\tcolor: #777620/*{fcHighlight}*/;\n}\n.ui-state-checked {\n\tborder: 1px solid #dad55e/*{borderColorHighlight}*/;\n\tbackground: #fffa90/*{bgColorHighlight}*/;\n}\n.ui-state-highlight a,\n.ui-widget-content .ui-state-highlight a,\n.ui-widget-header .ui-state-highlight a {\n\tcolor: #777620/*{fcHighlight}*/;\n}\n.ui-state-error,\n.ui-widget-content .ui-state-error,\n.ui-widget-header .ui-state-error {\n\tborder: 1px solid #f1a899/*{borderColorError}*/;\n\tbackground: #fddfdf/*{bgColorError}*/ /*{bgImgUrlError}*/ /*{bgErrorXPos}*/ /*{bgErrorYPos}*/ /*{bgErrorRepeat}*/;\n\tcolor: #5f3f3f/*{fcError}*/;\n}\n.ui-state-error a,\n.ui-widget-content .ui-state-error a,\n.ui-widget-header .ui-state-error a {\n\tcolor: #5f3f3f/*{fcError}*/;\n}\n.ui-state-error-text,\n.ui-widget-content .ui-state-error-text,\n.ui-widget-header .ui-state-error-text {\n\tcolor: #5f3f3f/*{fcError}*/;\n}\n.ui-priority-primary,\n.ui-widget-content .ui-priority-primary,\n.ui-widget-header .ui-priority-primary {\n\tfont-weight: bold;\n}\n.ui-priority-secondary,\n.ui-widget-content .ui-priority-secondary,\n.ui-widget-header .ui-priority-secondary {\n\topacity: .7;\n\tfont-weight: normal;\n}\n.ui-state-disabled,\n.ui-widget-content .ui-state-disabled,\n.ui-widget-header .ui-state-disabled {\n\topacity: .35;\n\tbackground-image: none;\n}\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.ui-icon {\n\twidth: 16px;\n\theight: 16px;\n}\n.ui-icon,\n.ui-widget-content .ui-icon {\n\tbackground-image: url("+n(5310)+");\n}\n.ui-widget-header .ui-icon {\n\tbackground-image: url("+n(5310)+");\n}\n.ui-state-hover .ui-icon,\n.ui-state-focus .ui-icon,\n.ui-button:hover .ui-icon,\n.ui-button:focus .ui-icon {\n\tbackground-image: url("+n(6428)+");\n}\n.ui-state-active .ui-icon,\n.ui-button:active .ui-icon {\n\tbackground-image: url("+n(7513)+");\n}\n.ui-state-highlight .ui-icon,\n.ui-button .ui-state-highlight.ui-icon {\n\tbackground-image: url("+n(7745)+");\n}\n.ui-state-error .ui-icon,\n.ui-state-error-text .ui-icon {\n\tbackground-image: url("+n(4612)+");\n}\n.ui-button .ui-icon {\n\tbackground-image: url("+n(6504)+");\n}\n\n/* positioning */\n/* Three classes needed to override `.ui-button:hover .ui-icon` */\n.ui-icon-blank.ui-icon-blank.ui-icon-blank {\n\tbackground-image: none;\n}\n.ui-icon-caret-1-n { background-position: 0 0; }\n.ui-icon-caret-1-ne { background-position: -16px 0; }\n.ui-icon-caret-1-e { background-position: -32px 0; }\n.ui-icon-caret-1-se { background-position: -48px 0; }\n.ui-icon-caret-1-s { background-position: -65px 0; }\n.ui-icon-caret-1-sw { background-position: -80px 0; }\n.ui-icon-caret-1-w { background-position: -96px 0; }\n.ui-icon-caret-1-nw { background-position: -112px 0; }\n.ui-icon-caret-2-n-s { background-position: -128px 0; }\n.ui-icon-caret-2-e-w { background-position: -144px 0; }\n.ui-icon-triangle-1-n { background-position: 0 -16px; }\n.ui-icon-triangle-1-ne { background-position: -16px -16px; }\n.ui-icon-triangle-1-e { background-position: -32px -16px; }\n.ui-icon-triangle-1-se { background-position: -48px -16px; }\n.ui-icon-triangle-1-s { background-position: -65px -16px; }\n.ui-icon-triangle-1-sw { background-position: -80px -16px; }\n.ui-icon-triangle-1-w { background-position: -96px -16px; }\n.ui-icon-triangle-1-nw { background-position: -112px -16px; }\n.ui-icon-triangle-2-n-s { background-position: -128px -16px; }\n.ui-icon-triangle-2-e-w { background-position: -144px -16px; }\n.ui-icon-arrow-1-n { background-position: 0 -32px; }\n.ui-icon-arrow-1-ne { background-position: -16px -32px; }\n.ui-icon-arrow-1-e { background-position: -32px -32px; }\n.ui-icon-arrow-1-se { background-position: -48px -32px; }\n.ui-icon-arrow-1-s { background-position: -65px -32px; }\n.ui-icon-arrow-1-sw { background-position: -80px -32px; }\n.ui-icon-arrow-1-w { background-position: -96px -32px; }\n.ui-icon-arrow-1-nw { background-position: -112px -32px; }\n.ui-icon-arrow-2-n-s { background-position: -128px -32px; }\n.ui-icon-arrow-2-ne-sw { background-position: -144px -32px; }\n.ui-icon-arrow-2-e-w { background-position: -160px -32px; }\n.ui-icon-arrow-2-se-nw { background-position: -176px -32px; }\n.ui-icon-arrowstop-1-n { background-position: -192px -32px; }\n.ui-icon-arrowstop-1-e { background-position: -208px -32px; }\n.ui-icon-arrowstop-1-s { background-position: -224px -32px; }\n.ui-icon-arrowstop-1-w { background-position: -240px -32px; }\n.ui-icon-arrowthick-1-n { background-position: 1px -48px; }\n.ui-icon-arrowthick-1-ne { background-position: -16px -48px; }\n.ui-icon-arrowthick-1-e { background-position: -32px -48px; }\n.ui-icon-arrowthick-1-se { background-position: -48px -48px; }\n.ui-icon-arrowthick-1-s { background-position: -64px -48px; }\n.ui-icon-arrowthick-1-sw { background-position: -80px -48px; }\n.ui-icon-arrowthick-1-w { background-position: -96px -48px; }\n.ui-icon-arrowthick-1-nw { background-position: -112px -48px; }\n.ui-icon-arrowthick-2-n-s { background-position: -128px -48px; }\n.ui-icon-arrowthick-2-ne-sw { background-position: -144px -48px; }\n.ui-icon-arrowthick-2-e-w { background-position: -160px -48px; }\n.ui-icon-arrowthick-2-se-nw { background-position: -176px -48px; }\n.ui-icon-arrowthickstop-1-n { background-position: -192px -48px; }\n.ui-icon-arrowthickstop-1-e { background-position: -208px -48px; }\n.ui-icon-arrowthickstop-1-s { background-position: -224px -48px; }\n.ui-icon-arrowthickstop-1-w { background-position: -240px -48px; }\n.ui-icon-arrowreturnthick-1-w { background-position: 0 -64px; }\n.ui-icon-arrowreturnthick-1-n { background-position: -16px -64px; }\n.ui-icon-arrowreturnthick-1-e { background-position: -32px -64px; }\n.ui-icon-arrowreturnthick-1-s { background-position: -48px -64px; }\n.ui-icon-arrowreturn-1-w { background-position: -64px -64px; }\n.ui-icon-arrowreturn-1-n { background-position: -80px -64px; }\n.ui-icon-arrowreturn-1-e { background-position: -96px -64px; }\n.ui-icon-arrowreturn-1-s { background-position: -112px -64px; }\n.ui-icon-arrowrefresh-1-w { background-position: -128px -64px; }\n.ui-icon-arrowrefresh-1-n { background-position: -144px -64px; }\n.ui-icon-arrowrefresh-1-e { background-position: -160px -64px; }\n.ui-icon-arrowrefresh-1-s { background-position: -176px -64px; }\n.ui-icon-arrow-4 { background-position: 0 -80px; }\n.ui-icon-arrow-4-diag { background-position: -16px -80px; }\n.ui-icon-extlink { background-position: -32px -80px; }\n.ui-icon-newwin { background-position: -48px -80px; }\n.ui-icon-refresh { background-position: -64px -80px; }\n.ui-icon-shuffle { background-position: -80px -80px; }\n.ui-icon-transfer-e-w { background-position: -96px -80px; }\n.ui-icon-transferthick-e-w { background-position: -112px -80px; }\n.ui-icon-folder-collapsed { background-position: 0 -96px; }\n.ui-icon-folder-open { background-position: -16px -96px; }\n.ui-icon-document { background-position: -32px -96px; }\n.ui-icon-document-b { background-position: -48px -96px; }\n.ui-icon-note { background-position: -64px -96px; }\n.ui-icon-mail-closed { background-position: -80px -96px; }\n.ui-icon-mail-open { background-position: -96px -96px; }\n.ui-icon-suitcase { background-position: -112px -96px; }\n.ui-icon-comment { background-position: -128px -96px; }\n.ui-icon-person { background-position: -144px -96px; }\n.ui-icon-print { background-position: -160px -96px; }\n.ui-icon-trash { background-position: -176px -96px; }\n.ui-icon-locked { background-position: -192px -96px; }\n.ui-icon-unlocked { background-position: -208px -96px; }\n.ui-icon-bookmark { background-position: -224px -96px; }\n.ui-icon-tag { background-position: -240px -96px; }\n.ui-icon-home { background-position: 0 -112px; }\n.ui-icon-flag { background-position: -16px -112px; }\n.ui-icon-calendar { background-position: -32px -112px; }\n.ui-icon-cart { background-position: -48px -112px; }\n.ui-icon-pencil { background-position: -64px -112px; }\n.ui-icon-clock { background-position: -80px -112px; }\n.ui-icon-disk { background-position: -96px -112px; }\n.ui-icon-calculator { background-position: -112px -112px; }\n.ui-icon-zoomin { background-position: -128px -112px; }\n.ui-icon-zoomout { background-position: -144px -112px; }\n.ui-icon-search { background-position: -160px -112px; }\n.ui-icon-wrench { background-position: -176px -112px; }\n.ui-icon-gear { background-position: -192px -112px; }\n.ui-icon-heart { background-position: -208px -112px; }\n.ui-icon-star { background-position: -224px -112px; }\n.ui-icon-link { background-position: -240px -112px; }\n.ui-icon-cancel { background-position: 0 -128px; }\n.ui-icon-plus { background-position: -16px -128px; }\n.ui-icon-plusthick { background-position: -32px -128px; }\n.ui-icon-minus { background-position: -48px -128px; }\n.ui-icon-minusthick { background-position: -64px -128px; }\n.ui-icon-close { background-position: -80px -128px; }\n.ui-icon-closethick { background-position: -96px -128px; }\n.ui-icon-key { background-position: -112px -128px; }\n.ui-icon-lightbulb { background-position: -128px -128px; }\n.ui-icon-scissors { background-position: -144px -128px; }\n.ui-icon-clipboard { background-position: -160px -128px; }\n.ui-icon-copy { background-position: -176px -128px; }\n.ui-icon-contact { background-position: -192px -128px; }\n.ui-icon-image { background-position: -208px -128px; }\n.ui-icon-video { background-position: -224px -128px; }\n.ui-icon-script { background-position: -240px -128px; }\n.ui-icon-alert { background-position: 0 -144px; }\n.ui-icon-info { background-position: -16px -144px; }\n.ui-icon-notice { background-position: -32px -144px; }\n.ui-icon-help { background-position: -48px -144px; }\n.ui-icon-check { background-position: -64px -144px; }\n.ui-icon-bullet { background-position: -80px -144px; }\n.ui-icon-radio-on { background-position: -96px -144px; }\n.ui-icon-radio-off { background-position: -112px -144px; }\n.ui-icon-pin-w { background-position: -128px -144px; }\n.ui-icon-pin-s { background-position: -144px -144px; }\n.ui-icon-play { background-position: 0 -160px; }\n.ui-icon-pause { background-position: -16px -160px; }\n.ui-icon-seek-next { background-position: -32px -160px; }\n.ui-icon-seek-prev { background-position: -48px -160px; }\n.ui-icon-seek-end { background-position: -64px -160px; }\n.ui-icon-seek-start { background-position: -80px -160px; }\n/* ui-icon-seek-first is deprecated, use ui-icon-seek-start instead */\n.ui-icon-seek-first { background-position: -80px -160px; }\n.ui-icon-stop { background-position: -96px -160px; }\n.ui-icon-eject { background-position: -112px -160px; }\n.ui-icon-volume-off { background-position: -128px -160px; }\n.ui-icon-volume-on { background-position: -144px -160px; }\n.ui-icon-power { background-position: 0 -176px; }\n.ui-icon-signal-diag { background-position: -16px -176px; }\n.ui-icon-signal { background-position: -32px -176px; }\n.ui-icon-battery-0 { background-position: -48px -176px; }\n.ui-icon-battery-1 { background-position: -64px -176px; }\n.ui-icon-battery-2 { background-position: -80px -176px; }\n.ui-icon-battery-3 { background-position: -96px -176px; }\n.ui-icon-circle-plus { background-position: 0 -192px; }\n.ui-icon-circle-minus { background-position: -16px -192px; }\n.ui-icon-circle-close { background-position: -32px -192px; }\n.ui-icon-circle-triangle-e { background-position: -48px -192px; }\n.ui-icon-circle-triangle-s { background-position: -64px -192px; }\n.ui-icon-circle-triangle-w { background-position: -80px -192px; }\n.ui-icon-circle-triangle-n { background-position: -96px -192px; }\n.ui-icon-circle-arrow-e { background-position: -112px -192px; }\n.ui-icon-circle-arrow-s { background-position: -128px -192px; }\n.ui-icon-circle-arrow-w { background-position: -144px -192px; }\n.ui-icon-circle-arrow-n { background-position: -160px -192px; }\n.ui-icon-circle-zoomin { background-position: -176px -192px; }\n.ui-icon-circle-zoomout { background-position: -192px -192px; }\n.ui-icon-circle-check { background-position: -208px -192px; }\n.ui-icon-circlesmall-plus { background-position: 0 -208px; }\n.ui-icon-circlesmall-minus { background-position: -16px -208px; }\n.ui-icon-circlesmall-close { background-position: -32px -208px; }\n.ui-icon-squaresmall-plus { background-position: -48px -208px; }\n.ui-icon-squaresmall-minus { background-position: -64px -208px; }\n.ui-icon-squaresmall-close { background-position: -80px -208px; }\n.ui-icon-grip-dotted-vertical { background-position: 0 -224px; }\n.ui-icon-grip-dotted-horizontal { background-position: -16px -224px; }\n.ui-icon-grip-solid-vertical { background-position: -32px -224px; }\n.ui-icon-grip-solid-horizontal { background-position: -48px -224px; }\n.ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }\n.ui-icon-grip-diagonal-se { background-position: -80px -224px; }\n\n\n/* Misc visuals\n----------------------------------*/\n\n/* Corner radius */\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-left,\n.ui-corner-tl {\n\tborder-top-left-radius: 3px/*{cornerRadius}*/;\n}\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-right,\n.ui-corner-tr {\n\tborder-top-right-radius: 3px/*{cornerRadius}*/;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-left,\n.ui-corner-bl {\n\tborder-bottom-left-radius: 3px/*{cornerRadius}*/;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-right,\n.ui-corner-br {\n\tborder-bottom-right-radius: 3px/*{cornerRadius}*/;\n}\n\n/* Overlays */\n.ui-widget-overlay {\n\tbackground: #aaaaaa/*{bgColorOverlay}*/ /*{bgImgUrlOverlay}*/ /*{bgOverlayXPos}*/ /*{bgOverlayYPos}*/ /*{bgOverlayRepeat}*/;\n\topacity: .3/*{opacityOverlay}*/;\n}\n.ui-widget-shadow {\n\tbox-shadow: 0/*{offsetLeftShadow}*/ 0/*{offsetTopShadow}*/ 5px/*{thicknessShadow}*/ #666666/*{bgColorShadow}*/;\n}\n",""])},1110:(t,e,n)=>{(t.exports=n(742)()).push([t.id,"/*!\n * jQuery UI Tooltip 1.14.1\n * https://jqueryui.com\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license.\n * https://jquery.org/license\n *\n * https://api.jqueryui.com/tooltip/#theming\n */\n.ui-tooltip {\n\tpadding: 8px;\n\tposition: absolute;\n\tz-index: 9999;\n\tmax-width: 300px;\n}\nbody .ui-tooltip {\n\tborder-width: 2px;\n}\n",""])},5310:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"d1b818587c3bc65058fe43800e4a191c.png"},6428:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"35d57320d9df28ec0d0d8bd1b5c75983.png"},7745:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"f423048bf942a7a33b33b1b982ecdb51.png"},6504:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"f5d5fce2f36b5776eab8b314efc2dfd8.png"},4612:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"5cbbd560bcf30acb95dd3b0b0d61645a.png"},7513:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"92bef7e45fed3caba8dc9348edef4df2.png"},1023:t=>{var e={},n=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}},i=n((function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())})),r=n((function(){return document.head||document.getElementsByTagName("head")[0]})),s=null,o=0,a=[];function l(t,n){for(var i=0;i<t.length;i++){var r=t[i],s=e[r.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](r.parts[o]);for(;o<r.parts.length;o++)s.parts.push(p(r.parts[o],n))}else{var a=[];for(o=0;o<r.parts.length;o++)a.push(p(r.parts[o],n));e[r.id]={id:r.id,refs:1,parts:a}}}}function c(t){for(var e=[],n={},i=0;i<t.length;i++){var r=t[i],s=r[0],o={css:r[1],media:r[2],sourceMap:r[3]};n[s]?n[s].parts.push(o):e.push(n[s]={id:s,parts:[o]})}return e}function u(t,e){var n=r(),i=a[a.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),a.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(e)}}function h(t){t.parentNode.removeChild(t);var e=a.indexOf(t);e>=0&&a.splice(e,1)}function d(t){var e=document.createElement("style");return e.type="text/css",u(t,e),e}function p(t,e){var n,i,r;if(e.singleton){var a=o++;n=s||(s=d(e)),i=g.bind(null,n,a,!1),r=g.bind(null,n,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return e.rel="stylesheet",u(t,e),e}(e),i=v.bind(null,n),r=function(){h(n),n.href&&URL.revokeObjectURL(n.href)}):(n=d(e),i=_.bind(null,n),r=function(){h(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,n){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");void 0===(n=n||{}).singleton&&(n.singleton=i()),void 0===n.insertAt&&(n.insertAt="bottom");var r=c(t);return l(r,n),function(t){for(var i=[],s=0;s<r.length;s++){var o=r[s];(a=e[o.id]).refs--,i.push(a)}for(t&&l(c(t),n),s=0;s<i.length;s++){var a;if(0===(a=i[s]).refs){for(var u=0;u<a.parts.length;u++)a.parts[u]();delete e[a.id]}}}};var f,m=(f=[],function(t,e){return f[t]=e,f.filter(Boolean).join("\n")});function g(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=m(e,r);else{var s=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(s,o[e]):t.appendChild(s)}}function _(t,e){var n=e.css,i=e.media;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function v(t,e){var n=e.css,i=e.sourceMap;i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var r=new Blob([n],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(r),s&&URL.revokeObjectURL(s)}},9446:(t,e,n)=>{var i=n(3774);"string"==typeof i&&(i=[[t.id,i,""]]),n(1023)(i,{}),i.locals&&(t.exports=i.locals)},2055:t=>{"use strict";t.exports=__WEBPACK_EXTERNAL_MODULE__2055__},431:(t,e,n)=>{"use strict";n.r(e),n.d(e,{VERSION:()=>r,after:()=>Le,all:()=>tn,allKeys:()=>gt,any:()=>en,assign:()=>Lt,before:()=>Oe,bind:()=>we,bindAll:()=>Me,chain:()=>ve,chunk:()=>Bn,clone:()=>Bt,collect:()=>Xe,compact:()=>En,compose:()=>De,constant:()=>Q,contains:()=>nn,countBy:()=>_n,create:()=>Ft,debounce:()=>Ie,default:()=>Gn,defaults:()=>Ot,defer:()=>Te,delay:()=>Ee,detect:()=>je,difference:()=>Pn,drop:()=>Mn,each:()=>qe,escape:()=>oe,every:()=>tn,extend:()=>Dt,extendOwn:()=>Lt,filter:()=>Qe,find:()=>je,findIndex:()=>Ue,findKey:()=>Fe,findLastIndex:()=>ze,findWhere:()=>We,first:()=>An,flatten:()=>Tn,foldl:()=>Ke,foldr:()=>Ze,forEach:()=>qe,functions:()=>Rt,get:()=>Gt,groupBy:()=>mn,has:()=>$t,head:()=>An,identity:()=>jt,include:()=>nn,includes:()=>nn,indexBy:()=>gn,indexOf:()=>Ge,initial:()=>Sn,inject:()=>Ke,intersection:()=>Dn,invert:()=>It,invoke:()=>rn,isArguments:()=>Y,isArray:()=>W,isArrayBuffer:()=>F,isBoolean:()=>T,isDataView:()=>j,isDate:()=>D,isElement:()=>P,isEmpty:()=>lt,isEqual:()=>mt,isError:()=>O,isFinite:()=>K,isFunction:()=>z,isMap:()=>At,isMatch:()=>ct,isNaN:()=>Z,isNull:()=>C,isNumber:()=>k,isObject:()=>M,isRegExp:()=>L,isSet:()=>Ct,isString:()=>R,isSymbol:()=>N,isTypedArray:()=>rt,isUndefined:()=>E,isWeakMap:()=>Mt,isWeakSet:()=>Et,iteratee:()=>Kt,keys:()=>at,last:()=>Cn,lastIndexOf:()=>$e,map:()=>Xe,mapObject:()=>Qt,matcher:()=>Wt,matches:()=>Wt,max:()=>an,memoize:()=>Ce,methods:()=>Rt,min:()=>ln,mixin:()=>zn,negate:()=>ke,noop:()=>Jt,now:()=>ie,object:()=>Nn,omit:()=>wn,once:()=>Ne,pairs:()=>Pt,partial:()=>xe,partition:()=>vn,pick:()=>xn,pluck:()=>sn,property:()=>qt,propertyOf:()=>te,random:()=>ne,range:()=>Fn,reduce:()=>Ke,reduceRight:()=>Ze,reject:()=>Je,rest:()=>Mn,restArguments:()=>A,result:()=>me,sample:()=>hn,select:()=>Qe,shuffle:()=>dn,size:()=>yn,some:()=>en,sortBy:()=>pn,sortedIndex:()=>Ve,tail:()=>Mn,take:()=>An,tap:()=>Ut,template:()=>fe,templateSettings:()=>le,throttle:()=>Pe,times:()=>ee,toArray:()=>un,toPath:()=>zt,transpose:()=>Ln,unescape:()=>ae,union:()=>kn,uniq:()=>Rn,unique:()=>Rn,uniqueId:()=>_e,unzip:()=>Ln,values:()=>Tt,where:()=>on,without:()=>In,wrap:()=>Re,zip:()=>On});var i={};n.r(i),n.d(i,{VERSION:()=>r,after:()=>Le,all:()=>tn,allKeys:()=>gt,any:()=>en,assign:()=>Lt,before:()=>Oe,bind:()=>we,bindAll:()=>Me,chain:()=>ve,chunk:()=>Bn,clone:()=>Bt,collect:()=>Xe,compact:()=>En,compose:()=>De,constant:()=>Q,contains:()=>nn,countBy:()=>_n,create:()=>Ft,debounce:()=>Ie,default:()=>Vn,defaults:()=>Ot,defer:()=>Te,delay:()=>Ee,detect:()=>je,difference:()=>Pn,drop:()=>Mn,each:()=>qe,escape:()=>oe,every:()=>tn,extend:()=>Dt,extendOwn:()=>Lt,filter:()=>Qe,find:()=>je,findIndex:()=>Ue,findKey:()=>Fe,findLastIndex:()=>ze,findWhere:()=>We,first:()=>An,flatten:()=>Tn,foldl:()=>Ke,foldr:()=>Ze,forEach:()=>qe,functions:()=>Rt,get:()=>Gt,groupBy:()=>mn,has:()=>$t,head:()=>An,identity:()=>jt,include:()=>nn,includes:()=>nn,indexBy:()=>gn,indexOf:()=>Ge,initial:()=>Sn,inject:()=>Ke,intersection:()=>Dn,invert:()=>It,invoke:()=>rn,isArguments:()=>Y,isArray:()=>W,isArrayBuffer:()=>F,isBoolean:()=>T,isDataView:()=>j,isDate:()=>D,isElement:()=>P,isEmpty:()=>lt,isEqual:()=>mt,isError:()=>O,isFinite:()=>K,isFunction:()=>z,isMap:()=>At,isMatch:()=>ct,isNaN:()=>Z,isNull:()=>C,isNumber:()=>k,isObject:()=>M,isRegExp:()=>L,isSet:()=>Ct,isString:()=>R,isSymbol:()=>N,isTypedArray:()=>rt,isUndefined:()=>E,isWeakMap:()=>Mt,isWeakSet:()=>Et,iteratee:()=>Kt,keys:()=>at,last:()=>Cn,lastIndexOf:()=>$e,map:()=>Xe,mapObject:()=>Qt,matcher:()=>Wt,matches:()=>Wt,max:()=>an,memoize:()=>Ce,methods:()=>Rt,min:()=>ln,mixin:()=>zn,negate:()=>ke,noop:()=>Jt,now:()=>ie,object:()=>Nn,omit:()=>wn,once:()=>Ne,pairs:()=>Pt,partial:()=>xe,partition:()=>vn,pick:()=>xn,pluck:()=>sn,property:()=>qt,propertyOf:()=>te,random:()=>ne,range:()=>Fn,reduce:()=>Ke,reduceRight:()=>Ze,reject:()=>Je,rest:()=>Mn,restArguments:()=>A,result:()=>me,sample:()=>hn,select:()=>Qe,shuffle:()=>dn,size:()=>yn,some:()=>en,sortBy:()=>pn,sortedIndex:()=>Ve,tail:()=>Mn,take:()=>An,tap:()=>Ut,template:()=>fe,templateSettings:()=>le,throttle:()=>Pe,times:()=>ee,toArray:()=>un,toPath:()=>zt,transpose:()=>Ln,unescape:()=>ae,union:()=>kn,uniq:()=>Rn,unique:()=>Rn,uniqueId:()=>_e,unzip:()=>Ln,values:()=>Tt,where:()=>on,without:()=>In,wrap:()=>Re,zip:()=>On});var r="1.13.7",s="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},o=Array.prototype,a=Object.prototype,l="undefined"!=typeof Symbol?Symbol.prototype:null,c=o.push,u=o.slice,h=a.toString,d=a.hasOwnProperty,p="undefined"!=typeof ArrayBuffer,f="undefined"!=typeof DataView,m=Array.isArray,g=Object.keys,_=Object.create,v=p&&ArrayBuffer.isView,y=isNaN,b=isFinite,x=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],S=Math.pow(2,53)-1;function A(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var s=Array(e+1);for(r=0;r<e;r++)s[r]=arguments[r];return s[e]=i,t.apply(this,s)}}function M(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function C(t){return null===t}function E(t){return void 0===t}function T(t){return!0===t||!1===t||"[object Boolean]"===h.call(t)}function P(t){return!(!t||1!==t.nodeType)}function I(t){var e="[object "+t+"]";return function(t){return h.call(t)===e}}const R=I("String"),k=I("Number"),D=I("Date"),L=I("RegExp"),O=I("Error"),N=I("Symbol"),F=I("ArrayBuffer");var B=I("Function"),U=s.document&&s.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof U&&(B=function(t){return"function"==typeof t||!1});const z=B,V=I("Object");var H=f&&(!/\[native code\]/.test(String(DataView))||V(new DataView(new ArrayBuffer(8)))),G="undefined"!=typeof Map&&V(new Map),$=I("DataView");const j=H?function(t){return null!=t&&z(t.getInt8)&&F(t.buffer)}:$,W=m||I("Array");function q(t,e){return null!=t&&d.call(t,e)}var X=I("Arguments");!function(){X(arguments)||(X=function(t){return q(t,"callee")})}();const Y=X;function K(t){return!N(t)&&b(t)&&!isNaN(parseFloat(t))}function Z(t){return k(t)&&y(t)}function Q(t){return function(){return t}}function J(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=S}}function tt(t){return function(e){return null==e?void 0:e[t]}}const et=tt("byteLength"),nt=J(et);var it=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;const rt=p?function(t){return v?v(t)&&!j(t):nt(t)&&it.test(h.call(t))}:Q(!1),st=tt("length");function ot(t,e){e=function(t){for(var e={},n=t.length,i=0;i<n;++i)e[t[i]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var n=w.length,i=t.constructor,r=z(i)&&i.prototype||a,s="constructor";for(q(t,s)&&!e.contains(s)&&e.push(s);n--;)(s=w[n])in t&&t[s]!==r[s]&&!e.contains(s)&&e.push(s)}function at(t){if(!M(t))return[];if(g)return g(t);var e=[];for(var n in t)q(t,n)&&e.push(n);return x&&ot(t,e),e}function lt(t){if(null==t)return!0;var e=st(t);return"number"==typeof e&&(W(t)||R(t)||Y(t))?0===e:0===st(at(t))}function ct(t,e){var n=at(e),i=n.length;if(null==t)return!i;for(var r=Object(t),s=0;s<i;s++){var o=n[s];if(e[o]!==r[o]||!(o in r))return!1}return!0}function ut(t){return t instanceof ut?t:this instanceof ut?void(this._wrapped=t):new ut(t)}function ht(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,et(t))}ut.VERSION=r,ut.prototype.value=function(){return this._wrapped},ut.prototype.valueOf=ut.prototype.toJSON=ut.prototype.value,ut.prototype.toString=function(){return String(this._wrapped)};var dt="[object DataView]";function pt(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&ft(t,e,n,i)}function ft(t,e,n,i){t instanceof ut&&(t=t._wrapped),e instanceof ut&&(e=e._wrapped);var r=h.call(t);if(r!==h.call(e))return!1;if(H&&"[object Object]"==r&&j(t)){if(!j(e))return!1;r=dt}switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return l.valueOf.call(t)===l.valueOf.call(e);case"[object ArrayBuffer]":case dt:return ft(ht(t),ht(e),n,i)}var s="[object Array]"===r;if(!s&&rt(t)){if(et(t)!==et(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var o=t.constructor,a=e.constructor;if(o!==a&&!(z(o)&&o instanceof o&&z(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var c=(n=n||[]).length;c--;)if(n[c]===t)return i[c]===e;if(n.push(t),i.push(e),s){if((c=t.length)!==e.length)return!1;for(;c--;)if(!pt(t[c],e[c],n,i))return!1}else{var u,d=at(t);if(c=d.length,at(e).length!==c)return!1;for(;c--;)if(!q(e,u=d[c])||!pt(t[u],e[u],n,i))return!1}return n.pop(),i.pop(),!0}function mt(t,e){return pt(t,e)}function gt(t){if(!M(t))return[];var e=[];for(var n in t)e.push(n);return x&&ot(t,e),e}function _t(t){var e=st(t);return function(n){if(null==n)return!1;var i=gt(n);if(st(i))return!1;for(var r=0;r<e;r++)if(!z(n[t[r]]))return!1;return t!==wt||!z(n[vt])}}var vt="forEach",yt=["clear","delete"],bt=["get","has","set"],xt=yt.concat(vt,bt),wt=yt.concat(bt),St=["add"].concat(yt,vt,"has");const At=G?_t(xt):I("Map"),Mt=G?_t(wt):I("WeakMap"),Ct=G?_t(St):I("Set"),Et=I("WeakSet");function Tt(t){for(var e=at(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i}function Pt(t){for(var e=at(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i}function It(t){for(var e={},n=at(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e}function Rt(t){var e=[];for(var n in t)z(t[n])&&e.push(n);return e.sort()}function kt(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var s=arguments[r],o=t(s),a=o.length,l=0;l<a;l++){var c=o[l];e&&void 0!==n[c]||(n[c]=s[c])}return n}}const Dt=kt(gt),Lt=kt(at),Ot=kt(gt,!0);function Nt(t){if(!M(t))return{};if(_)return _(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function Ft(t,e){var n=Nt(t);return e&&Lt(n,e),n}function Bt(t){return M(t)?W(t)?t.slice():Dt({},t):t}function Ut(t,e){return e(t),t}function zt(t){return W(t)?t:[t]}function Vt(t){return ut.toPath(t)}function Ht(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}function Gt(t,e,n){var i=Ht(t,Vt(e));return E(i)?n:i}function $t(t,e){for(var n=(e=Vt(e)).length,i=0;i<n;i++){var r=e[i];if(!q(t,r))return!1;t=t[r]}return!!n}function jt(t){return t}function Wt(t){return t=Lt({},t),function(e){return ct(e,t)}}function qt(t){return t=Vt(t),function(e){return Ht(e,t)}}function Xt(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,s){return t.call(e,n,i,r,s)}}return function(){return t.apply(e,arguments)}}function Yt(t,e,n){return null==t?jt:z(t)?Xt(t,e,n):M(t)&&!W(t)?Wt(t):qt(t)}function Kt(t,e){return Yt(t,e,1/0)}function Zt(t,e,n){return ut.iteratee!==Kt?ut.iteratee(t,e):Yt(t,e,n)}function Qt(t,e,n){e=Zt(e,n);for(var i=at(t),r=i.length,s={},o=0;o<r;o++){var a=i[o];s[a]=e(t[a],a,t)}return s}function Jt(){}function te(t){return null==t?Jt:function(e){return Gt(t,e)}}function ee(t,e,n){var i=Array(Math.max(0,t));e=Xt(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i}function ne(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}ut.toPath=zt,ut.iteratee=Kt;const ie=Date.now||function(){return(new Date).getTime()};function re(t){var e=function(e){return t[e]},n="(?:"+at(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}}const se={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},oe=re(se),ae=re(It(se)),le=ut.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var ce=/(.)^/,ue={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},he=/\\|'|\r|\n|\u2028|\u2029/g;function de(t){return"\\"+ue[t]}var pe=/^\s*(\w|\$)+\s*$/;function fe(t,e,n){!e&&n&&(e=n),e=Ot({},e,ut.templateSettings);var i=RegExp([(e.escape||ce).source,(e.interpolate||ce).source,(e.evaluate||ce).source].join("|")+"|$","g"),r=0,s="__p+='";t.replace(i,(function(e,n,i,o,a){return s+=t.slice(r,a).replace(he,de),r=a+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),e})),s+="';\n";var o,a=e.variable;if(a){if(!pe.test(a))throw new Error("variable is not a bare identifier: "+a)}else s="with(obj||{}){\n"+s+"}\n",a="obj";s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{o=new Function(a,"_",s)}catch(t){throw t.source=s,t}var l=function(t){return o.call(this,t,ut)};return l.source="function("+a+"){\n"+s+"}",l}function me(t,e,n){var i=(e=Vt(e)).length;if(!i)return z(n)?n.call(t):n;for(var r=0;r<i;r++){var s=null==t?void 0:t[e[r]];void 0===s&&(s=n,r=i),t=z(s)?s.call(t):s}return t}var ge=0;function _e(t){var e=++ge+"";return t?t+e:e}function ve(t){var e=ut(t);return e._chain=!0,e}function ye(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var s=Nt(t.prototype),o=t.apply(s,r);return M(o)?o:s}var be=A((function(t,e){var n=be.placeholder,i=function(){for(var r=0,s=e.length,o=Array(s),a=0;a<s;a++)o[a]=e[a]===n?arguments[r++]:e[a];for(;r<arguments.length;)o.push(arguments[r++]);return ye(t,i,this,this,o)};return i}));be.placeholder=ut;const xe=be,we=A((function(t,e,n){if(!z(t))throw new TypeError("Bind must be called on a function");var i=A((function(r){return ye(t,i,e,this,n.concat(r))}));return i})),Se=J(st);function Ae(t,e,n,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=1/0;for(var r=i.length,s=0,o=st(t);s<o;s++){var a=t[s];if(Se(a)&&(W(a)||Y(a)))if(e>1)Ae(a,e-1,n,i),r=i.length;else for(var l=0,c=a.length;l<c;)i[r++]=a[l++];else n||(i[r++]=a)}return i}const Me=A((function(t,e){var n=(e=Ae(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=we(t[i],t)}return t}));function Ce(t,e){var n=function(i){var r=n.cache,s=""+(e?e.apply(this,arguments):i);return q(r,s)||(r[s]=t.apply(this,arguments)),r[s]};return n.cache={},n}const Ee=A((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),Te=xe(Ee,ut,1);function Pe(t,e,n){var i,r,s,o,a=0;n||(n={});var l=function(){a=!1===n.leading?0:ie(),i=null,o=t.apply(r,s),i||(r=s=null)},c=function(){var c=ie();a||!1!==n.leading||(a=c);var u=e-(c-a);return r=this,s=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),a=c,o=t.apply(r,s),i||(r=s=null)):i||!1===n.trailing||(i=setTimeout(l,u)),o};return c.cancel=function(){clearTimeout(i),a=0,i=r=s=null},c}function Ie(t,e,n){var i,r,s,o,a,l=function(){var c=ie()-r;e>c?i=setTimeout(l,e-c):(i=null,n||(o=t.apply(a,s)),i||(s=a=null))},c=A((function(c){return a=this,s=c,r=ie(),i||(i=setTimeout(l,e),n&&(o=t.apply(a,s))),o}));return c.cancel=function(){clearTimeout(i),i=s=a=null},c}function Re(t,e){return xe(e,t)}function ke(t){return function(){return!t.apply(this,arguments)}}function De(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}}function Le(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function Oe(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}const Ne=xe(Oe,2);function Fe(t,e,n){e=Zt(e,n);for(var i,r=at(t),s=0,o=r.length;s<o;s++)if(e(t[i=r[s]],i,t))return i}function Be(t){return function(e,n,i){n=Zt(n,i);for(var r=st(e),s=t>0?0:r-1;s>=0&&s<r;s+=t)if(n(e[s],s,e))return s;return-1}}const Ue=Be(1),ze=Be(-1);function Ve(t,e,n,i){for(var r=(n=Zt(n,i,1))(e),s=0,o=st(t);s<o;){var a=Math.floor((s+o)/2);n(t[a])<r?s=a+1:o=a}return s}function He(t,e,n){return function(i,r,s){var o=0,a=st(i);if("number"==typeof s)t>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return i[s=n(i,r)]===r?s:-1;if(r!=r)return(s=e(u.call(i,o,a),Z))>=0?s+o:-1;for(s=t>0?o:a-1;s>=0&&s<a;s+=t)if(i[s]===r)return s;return-1}}const Ge=He(1,Ue,Ve),$e=He(-1,ze);function je(t,e,n){var i=(Se(t)?Ue:Fe)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function We(t,e){return je(t,Wt(e))}function qe(t,e,n){var i,r;if(e=Xt(e,n),Se(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var s=at(t);for(i=0,r=s.length;i<r;i++)e(t[s[i]],s[i],t)}return t}function Xe(t,e,n){e=Zt(e,n);for(var i=!Se(t)&&at(t),r=(i||t).length,s=Array(r),o=0;o<r;o++){var a=i?i[o]:o;s[o]=e(t[a],a,t)}return s}function Ye(t){return function(e,n,i,r){var s=arguments.length>=3;return function(e,n,i,r){var s=!Se(e)&&at(e),o=(s||e).length,a=t>0?0:o-1;for(r||(i=e[s?s[a]:a],a+=t);a>=0&&a<o;a+=t){var l=s?s[a]:a;i=n(i,e[l],l,e)}return i}(e,Xt(n,r,4),i,s)}}const Ke=Ye(1),Ze=Ye(-1);function Qe(t,e,n){var i=[];return e=Zt(e,n),qe(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function Je(t,e,n){return Qe(t,ke(Zt(e)),n)}function tn(t,e,n){e=Zt(e,n);for(var i=!Se(t)&&at(t),r=(i||t).length,s=0;s<r;s++){var o=i?i[s]:s;if(!e(t[o],o,t))return!1}return!0}function en(t,e,n){e=Zt(e,n);for(var i=!Se(t)&&at(t),r=(i||t).length,s=0;s<r;s++){var o=i?i[s]:s;if(e(t[o],o,t))return!0}return!1}function nn(t,e,n,i){return Se(t)||(t=Tt(t)),("number"!=typeof n||i)&&(n=0),Ge(t,e,n)>=0}const rn=A((function(t,e,n){var i,r;return z(e)?r=e:(e=Vt(e),i=e.slice(0,-1),e=e[e.length-1]),Xe(t,(function(t){var s=r;if(!s){if(i&&i.length&&(t=Ht(t,i)),null==t)return;s=t[e]}return null==s?s:s.apply(t,n)}))}));function sn(t,e){return Xe(t,qt(e))}function on(t,e){return Qe(t,Wt(e))}function an(t,e,n){var i,r,s=-1/0,o=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,l=(t=Se(t)?t:Tt(t)).length;a<l;a++)null!=(i=t[a])&&i>s&&(s=i);else e=Zt(e,n),qe(t,(function(t,n,i){((r=e(t,n,i))>o||r===-1/0&&s===-1/0)&&(s=t,o=r)}));return s}function ln(t,e,n){var i,r,s=1/0,o=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,l=(t=Se(t)?t:Tt(t)).length;a<l;a++)null!=(i=t[a])&&i<s&&(s=i);else e=Zt(e,n),qe(t,(function(t,n,i){((r=e(t,n,i))<o||r===1/0&&s===1/0)&&(s=t,o=r)}));return s}var cn=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function un(t){return t?W(t)?u.call(t):R(t)?t.match(cn):Se(t)?Xe(t,jt):Tt(t):[]}function hn(t,e,n){if(null==e||n)return Se(t)||(t=Tt(t)),t[ne(t.length-1)];var i=un(t),r=st(i);e=Math.max(Math.min(e,r),0);for(var s=r-1,o=0;o<e;o++){var a=ne(o,s),l=i[o];i[o]=i[a],i[a]=l}return i.slice(0,e)}function dn(t){return hn(t,1/0)}function pn(t,e,n){var i=0;return e=Zt(e,n),sn(Xe(t,(function(t,n,r){return{value:t,index:i++,criteria:e(t,n,r)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),"value")}function fn(t,e){return function(n,i,r){var s=e?[[],[]]:{};return i=Zt(i,r),qe(n,(function(e,r){var o=i(e,r,n);t(s,e,o)})),s}}const mn=fn((function(t,e,n){q(t,n)?t[n].push(e):t[n]=[e]})),gn=fn((function(t,e,n){t[n]=e})),_n=fn((function(t,e,n){q(t,n)?t[n]++:t[n]=1})),vn=fn((function(t,e,n){t[n?0:1].push(e)}),!0);function yn(t){return null==t?0:Se(t)?t.length:at(t).length}function bn(t,e,n){return e in n}const xn=A((function(t,e){var n={},i=e[0];if(null==t)return n;z(i)?(e.length>1&&(i=Xt(i,e[1])),e=gt(t)):(i=bn,e=Ae(e,!1,!1),t=Object(t));for(var r=0,s=e.length;r<s;r++){var o=e[r],a=t[o];i(a,o,t)&&(n[o]=a)}return n})),wn=A((function(t,e){var n,i=e[0];return z(i)?(i=ke(i),e.length>1&&(n=e[1])):(e=Xe(Ae(e,!1,!1),String),i=function(t,n){return!nn(e,n)}),xn(t,i,n)}));function Sn(t,e,n){return u.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function An(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Sn(t,t.length-e)}function Mn(t,e,n){return u.call(t,null==e||n?1:e)}function Cn(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:Mn(t,Math.max(0,t.length-e))}function En(t){return Qe(t,Boolean)}function Tn(t,e){return Ae(t,e,!1)}const Pn=A((function(t,e){return e=Ae(e,!0,!0),Qe(t,(function(t){return!nn(e,t)}))})),In=A((function(t,e){return Pn(t,e)}));function Rn(t,e,n,i){T(e)||(i=n,n=e,e=!1),null!=n&&(n=Zt(n,i));for(var r=[],s=[],o=0,a=st(t);o<a;o++){var l=t[o],c=n?n(l,o,t):l;e&&!n?(o&&s===c||r.push(l),s=c):n?nn(s,c)||(s.push(c),r.push(l)):nn(r,l)||r.push(l)}return r}const kn=A((function(t){return Rn(Ae(t,!0,!0))}));function Dn(t){for(var e=[],n=arguments.length,i=0,r=st(t);i<r;i++){var s=t[i];if(!nn(e,s)){var o;for(o=1;o<n&&nn(arguments[o],s);o++);o===n&&e.push(s)}}return e}function Ln(t){for(var e=t&&an(t,st).length||0,n=Array(e),i=0;i<e;i++)n[i]=sn(t,i);return n}const On=A(Ln);function Nn(t,e){for(var n={},i=0,r=st(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n}function Fn(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),s=0;s<i;s++,t+=n)r[s]=t;return r}function Bn(t,e){if(null==e||e<1)return[];for(var n=[],i=0,r=t.length;i<r;)n.push(u.call(t,i,i+=e));return n}function Un(t,e){return t._chain?ut(e).chain():e}function zn(t){return qe(Rt(t),(function(e){var n=ut[e]=t[e];ut.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),Un(this,n.apply(ut,t))}})),ut}qe(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=o[t];ut.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0]),Un(this,n)}})),qe(["concat","join","slice"],(function(t){var e=o[t];ut.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Un(this,t)}}));const Vn=ut;var Hn=zn(i);Hn._=Hn;const Gn=Hn},8330:t=>{"use strict";t.exports={version:"3.1.5"}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;__webpack_require__.g.importScripts&&(t=__webpack_require__.g.location+"");var e=__webpack_require__.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=t})();var __webpack_exports__=__webpack_require__(9012);return __webpack_exports__})()));
//# sourceMappingURL=index.js.map